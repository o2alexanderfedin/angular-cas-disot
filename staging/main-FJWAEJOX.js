import{A as Ei,B as Ft,C as Cr,G as le,a as v,b as I,c as gr,d as gn,e as Mn,f as _r,g as es,h as f,i as C,j as k,k as J,l as O,m as q0,n as iN,o as sN,p as Ch,q as kw,r as aN,s as ts,t as rs,u as cN,v as lN,w as Sr,x as uN,y as K0,z as dN}from"./chunk-KQJLGZUB.js";var QV=gn((tLe,rA)=>{"use strict";var Jde=Object.prototype.hasOwnProperty,No="~";function Ay(){}Object.create&&(Ay.prototype=Object.create(null),new Ay().__proto__||(No=!1));function efe(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function XV(r,e,t,n,o){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new efe(t,n||r,o),s=No?No+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],i]:r._events[s].push(i):(r._events[s]=i,r._eventsCount++),r}function Z4(r,e){--r._eventsCount===0?r._events=new Ay:delete r._events[e]}function co(){this._events=new Ay,this._eventsCount=0}co.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Jde.call(t,n)&&e.push(No?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};co.prototype.listeners=function(e){var t=No?No+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s};co.prototype.listenerCount=function(e){var t=No?No+e:e,n=this._events[t];return n?n.fn?1:n.length:0};co.prototype.emit=function(e,t,n,o,i,s){var a=No?No+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,s),!0}for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var h=c.length,p;for(d=0;d<h;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,o);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[d].fn.apply(c[d].context,u)}}return!0};co.prototype.on=function(e,t,n){return XV(this,e,t,n,!1)};co.prototype.once=function(e,t,n){return XV(this,e,t,n,!0)};co.prototype.removeListener=function(e,t,n,o){var i=No?No+e:e;if(!this._events[i])return this;if(!t)return Z4(this,i),this;var s=this._events[i];if(s.fn)s.fn===t&&(!o||s.once)&&(!n||s.context===n)&&Z4(this,i);else{for(var a=0,c=[],l=s.length;a<l;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[i]=c.length===1?c[0]:c:Z4(this,i)}return this};co.prototype.removeAllListeners=function(e){var t;return e?(t=No?No+e:e,this._events[t]&&Z4(this,t)):(this._events=new Ay,this._eventsCount=0),this};co.prototype.off=co.prototype.removeListener;co.prototype.addListener=co.prototype.on;co.prefixed=No;co.EventEmitter=co;typeof rA<"u"&&(rA.exports=co)});var lj=gn((oFe,cj)=>{"use strict";cj.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function o(i,s){t[i]=s,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var s=t[i];if(s!==void 0)return s;if((s=n[i])!==void 0)return o(i,s),s},set:function(i,s){t[i]!==void 0?t[i]=s:o(i,s)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var Oq=gn(M2=>{"use strict";(function(){var r,e,t,n,o,i,s,a;a=function(c){var l,u,d,h;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,d=(c&65280)>>>8,h=c&255,[l,u,d,h].join(".")},s=function(c){var l,u,d,h,p,m;for(l=[],d=h=0;h<=3&&c.length!==0;d=++h){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}m=e(c),p=m[0],u=m[1],c=c.substring(u),l.push(p)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),o=t("A"),e=function(c){var l,u,d,h,p;for(h=0,l=10,u="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,u="7")),p=d;d<c.length;){if("0"<=c[d]&&c[d]<=u)h=h*l+(t(c[d])-n)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")h=h*l+(10+t(c[d])-i)>>>0;else if("A"<=c[d]&&c[d]<="F")h=h*l+(10+t(c[d])-o)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");d++}if(d===p)throw new Error("empty octet");return[h,d]},r=function(){function c(l,u){var d,h,p,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(m=l.split("/",2),l=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=s(u)}catch(w){throw d=w,new Error("Invalid mask: "+u)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(s(l)&this.maskLong)>>>0}catch(w){throw d=w,new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(s(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,d,h;for(h=s(this.first),d=s(this.last),u=0;h<=d;)l(a(h),h,u),u++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),M2.ip2long=s,M2.long2ip=a,M2.Netmask=r}).call(M2)});var i6=gn((jQe,UT)=>{"use strict";var VQe=function(){typeof UT<"u"&&(UT.exports=w);var r=86400,e=3200,t=146097*e/400,n=r*t,o=1e3*n,i=864e13,s=4294967296,a=1e6,c="000000000",l=Math.trunc||function(U){var P=U-U%1;return P==0&&(U<0||U===0&&1/U!=1/0)?-0:P},u=w.prototype,d=(w.fromDate=function(U){return new w(+U)},w.fromInt64BE=L(0,1,2,3,0,4),w.fromInt64LE=L(3,2,1,0,4,0),w.fromString=function(N){var P,R=new w,N=(N+="").replace(/^\s*[+\-]?\d+/,function(V){var V=+V,Z=1970+(V-1970)%400;return R.year=V-Z,Z}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(j,V,Z){return V<0&&(Z*=-1),P=6e4*(60*+V+ +Z),""}).replace(/\.\d+$/,function(j){return R.nano=+(j+c).substr(1,9),""}).split(/\D+/);if(1<N.length?N[1]--:N[1]=0,R.time=P=Date.UTC.apply(Date,N)-(P||0),isNaN(P))throw new TypeError("Invalid Date");return E(R)},w.fromTimeT=function(U){return A(U,0)},u.year=0,u.time=0,u.nano=0,u.addNano=function(U){return this.nano+=+U||0,this},u.getNano=function(){var U=E(this);return(U.time%1e3*a+ +U.nano+1e9)%1e9},u.getTimeT=function(){var P=E(this),U=Math.floor(P.time/1e3),P=P.year;return P&&(U+=P*t*r/e),U},u.getYear=function(){return this.toDate().getUTCFullYear()+this.year},u.toDate=function(){return S(E(this).time)},u.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},u.toString=function(U){var P=this,R=P.toDate(),N={H:function(){return Y(R.getUTCHours())},L:function(){return H(R.getUTCMilliseconds(),3)},M:function(){return Y(R.getUTCMinutes())},N:function(){return H(P.getNano(),9)},S:function(){return Y(R.getUTCSeconds())},Y:function(){var j=P.getYear();return 999999<j?"+"+j:9999<j?"+"+H(j,6):0<=j?H(j,4):-999999<=j?"-"+H(-j,6):j},a:function(){return p[R.getUTCDay()]},b:function(){return h[R.getUTCMonth()]},d:function(){return Y(R.getUTCDate())},e:function(){return function(j){return(9<j?"":" ")+(0|j)}(R.getUTCDate())},m:function(){return Y(R.getUTCMonth()+1)}};return function j(V){return V.replace(/%./g,function(Z){var te=Z[1],X=m[te],te=N[te];return X?j(X):te?te():Z})}(U||d)},u.writeInt64BE=M(0,1,2,3,0,4),u.writeInt64LE=M(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return w;function w(U,P,R){var N=this;if(!(N instanceof w))return new w(U,P,R);N.time=+U||0,N.nano=+P||0,N.year=+R||0,E(N)}function E(U){var P,R,N,j=U.year,V=U.time,Z=U.nano,X=((Z<0||a<=Z)&&(Z-=(R=Math.floor(Z/a))*a,V+=R,R=1),j%e);return(V<-i||i<V||X)&&((P=l(V/o))&&(j+=P*e,V-=P*o),(N=S(V)).setUTCFullYear(X+N.getUTCFullYear()),N=(V=+N)+(P=l((j-=X)/e))*o,P&&-i<=N&&N<=i&&(j-=P*e,V=N),R=1),R&&(U.year=j,U.time=V,U.nano=Z),U}function S(U){var P=new Date(0);return P.setTime(U),P}function A(j,N){j=+j||0;var R=l((N=(N|0)*s)/n)+l(j/n),N=N%n+j%n,j=l(N/n);return j&&(R+=j,N-=j*n),new w(1e3*N,0,R*e)}function M(U,P,R,N,j,V){return function(X,te){var fe=E(this);X=X||new Array(8),F(X,te|=0);var ue=Math.floor(fe.time/1e3),fe=fe.year*(t*r/e),ce=l(fe/s)+l(ue/s),fe=fe%s+ue%s,ue=Math.floor(fe/s);return ue&&(ce+=ue,fe-=ue*s),Z(X,te+j,ce),Z(X,te+V,fe),X};function Z(X,te,ce){X[te+U]=ce>>24&255,X[te+P]=ce>>16&255,X[te+R]=ce>>8&255,X[te+N]=255&ce}}function L(U,P,R,N,j,V){return function(X,te){F(X,te|=0);var ce=Z(X,te+j);return A(Z(X,te+V),ce)};function Z(X,te){return 16777216*X[te+U]+(X[te+P]<<16|X[te+R]<<8|X[te+N])}}function F(U,P){if(U=U&&U.length,U==null)throw new TypeError("Invalid Buffer");if(U<P+8)throw new RangeError("Out of range")}function Y(U){return(9<U?"":"0")+(0|U)}function H(U,P){return(c+(0|U)).substr(-P)}}()});var xK=gn((Stt,bK)=>{"use strict";function X0e(r){return r>=55296&&r<=56319}function Q0e(r){return r>=56320&&r<=57343}bK.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var o=t.length,i=0,s,a,c=0;c<o;c+=1){if(s=t.charCodeAt(c),a=t[c],X0e(s)&&Q0e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),i+=e(a),i===n)return t.slice(0,c+1);if(i>n)return t.slice(0,c-a.length+1)}return t}});var _K=gn((Ctt,EK)=>{"use strict";function Z0e(r){return r>=55296&&r<=56319}function J0e(r){return r>=56320&&r<=57343}EK.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,o=null,i=null,s=0;s<t;s++)o=e.charCodeAt(s),J0e(o)?i!=null&&Z0e(i)?n+=1:n+=3:o<=127?n+=1:o>=128&&o<=2047?n+=2:o>=2048&&o<=65535&&(n+=3),i=o;return n}});var CK=gn((Itt,SK)=>{"use strict";var e1e=xK(),t1e=_K();SK.exports=e1e.bind(null,t1e)});var DK=gn((Att,AK)=>{"use strict";var r1e=CK(),n1e=/[\/\?<>\\:\*\|"]/g,o1e=/[\x00-\x1f\x80-\x9f]/g,i1e=/^\.+$/,s1e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,a1e=/[\. ]+$/;function IK(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(n1e,e).replace(o1e,e).replace(i1e,e).replace(s1e,e).replace(a1e,e);return r1e(t,255)}AK.exports=function(r,e){var t=e&&e.replacement||"",n=IK(r,t);return t===""?n:IK(n,"")}});var Dl=gn(kg=>{"use strict";var l1e="[object ArrayBuffer]",Al=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===l1e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),o=r.toUint8Array(t);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let s of t)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of t){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},eP="string",u1e=/^[0-9a-f\s]+$/i,d1e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,f1e=/^[a-zA-Z0-9-_]+$/,w6=class{static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n.buffer}static toString(e){let t=Al.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}},Is=class{static toString(e,t=!1){let n=Al.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),t);return n}},p1e=(()=>{class r{static isHex(t){return typeof t===eP&&u1e.test(t)}static isBase64(t){return typeof t===eP&&d1e.test(t)}static isBase64Url(t){return typeof t===eP&&f1e.test(t)}static ToString(t,n="utf8"){let o=Al.toUint8Array(t);switch(n.toLowerCase()){case"utf8":return this.ToUtf8String(o);case"binary":return this.ToBinary(o);case"hex":return this.ToHex(o);case"base64":return this.ToBase64(o);case"base64url":return this.ToBase64Url(o);case"utf16le":return Is.toString(o,!0);case"utf16":case"utf16be":return Is.toString(o);default:throw new Error(`Unknown type of encoding '${n}'`)}}static FromString(t,n="utf8"){if(!t)return new ArrayBuffer(0);switch(n.toLowerCase()){case"utf8":return this.FromUtf8String(t);case"binary":return this.FromBinary(t);case"hex":return this.FromHex(t);case"base64":return this.FromBase64(t);case"base64url":return this.FromBase64Url(t);case"utf16le":return Is.fromString(t,!0);case"utf16":case"utf16be":return Is.fromString(t);default:throw new Error(`Unknown type of encoding '${n}'`)}}static ToBase64(t){let n=Al.toUint8Array(t);if(typeof btoa<"u"){let o=this.ToString(n,"binary");return btoa(o)}else return Buffer.from(n).toString("base64")}static FromBase64(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isBase64(n))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(n)):new Uint8Array(Buffer.from(n,"base64")).buffer}static FromBase64Url(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isBase64Url(n))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(n.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(t){return this.ToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(t,n=r.DEFAULT_UTF8_ENCODING){switch(n){case"ascii":return this.FromBinary(t);case"utf8":return w6.fromString(t);case"utf16":case"utf16be":return Is.fromString(t);case"utf16le":case"usc2":return Is.fromString(t,!0);default:throw new Error(`Unknown type of encoding '${n}'`)}}static ToUtf8String(t,n=r.DEFAULT_UTF8_ENCODING){switch(n){case"ascii":return this.ToBinary(t);case"utf8":return w6.toString(t);case"utf16":case"utf16be":return Is.toString(t);case"utf16le":case"usc2":return Is.toString(t,!0);default:throw new Error(`Unknown type of encoding '${n}'`)}}static FromBinary(t){let n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o.buffer}static ToBinary(t){let n=Al.toUint8Array(t),o="";for(let i=0;i<n.length;i++)o+=String.fromCharCode(n[i]);return o}static ToHex(t){let n=Al.toUint8Array(t),o="",i=n.length;for(let s=0;s<i;s++){let a=n[s];a<16&&(o+="0"),o+=a.toString(16)}return o}static FromHex(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isHex(n))throw new TypeError("Argument 'hexString' is not HEX encoded");n.length%2&&(n=`0${n}`);let o=new Uint8Array(n.length/2);for(let i=0;i<n.length;i=i+2){let s=n.slice(i,i+2);o[i/2]=parseInt(s,16)}return o.buffer}static ToUtf16String(t,n=!1){return Is.toString(t,n)}static FromUtf16String(t,n=!1){return Is.fromString(t,n)}static Base64Padding(t){let n=4-t.length%4;if(n<4)for(let o=0;o<n;o++)t+="=";return t}static formatString(t){return t?.replace(/[\n\r\t ]/g,"")||""}}return r.DEFAULT_UTF8_ENCODING="utf8",r})();function h1e(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)t[i]=o[i]}return t}function m1e(...r){let e=r.map(o=>o.byteLength).reduce((o,i)=>o+i),t=new Uint8Array(e),n=0;return r.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)t[n++]=i}),t.buffer}function g1e(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}kg.BufferSourceConverter=Al;kg.Convert=p1e;kg.assign=h1e;kg.combine=m1e;kg.isEqual=g1e});var ZG=gn((Qit,QG)=>{"use strict";function Ms(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}QG.exports=Ms;Ms.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ms.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ms.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ms.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ms.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Ms.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Ms.prototype.start=Ms.prototype.try;Ms.prototype.errors=function(){return this._errors};Ms.prototype.attempts=function(){return this._attempts};Ms.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,s=(r[i]||0)+1;r[i]=s,s>=t&&(e=o,t=s)}return e}});var JG=gn(Ip=>{"use strict";var Fye=ZG();Ip.operation=function(r){var e=Ip.timeouts(r);return new Fye(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Ip.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<e.retries;o++)n.push(this.createTimeout(o,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(o,e)),n.sort(function(i,s){return i-s}),n};Ip.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Ip.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var o=0;o<t.length;o++){var i=t[o],s=r[i];r[i]=(function(c){var l=Ip.operation(e),u=Array.prototype.slice.call(arguments,1),d=u.pop();u.push(function(h){l.retry(h)||(h&&(arguments[0]=l.mainError()),d.apply(this,arguments))}),l.attempt(function(){c.apply(r,u)})}).bind(r,s),r[i].options=e}}});var tW=gn((Jit,eW)=>{"use strict";eW.exports=JG()});var sQ=gn(()=>{"use strict";var iQ;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(r);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function o(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return BS(Object.create(null))}:c?function(){return BS({__proto__:null})}:function(){return BS({})},has:l?function($,K){return n.call($,K)}:function($,K){return K in $},get:l?function($,K){return n.call($,K)?$[K]:void 0}:function($,K){return $[K]}},d=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Pte(),p=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Mte(),m=typeof WeakMap=="function"?WeakMap:kte(),w=o?Symbol.for("@reflect-metadata:registry"):void 0,E=Ate(),S=Dte(E);function A($,K,re,ge){if(ae(re)){if(!Ji($))throw new TypeError;if(!ZR(K))throw new TypeError;return j($,K)}else{if(!Ji($))throw new TypeError;if(!He(K))throw new TypeError;if(!He(ge)&&!ae(ge)&&!pt(ge))throw new TypeError;return pt(ge)&&(ge=void 0),re=Pn(re),V($,K,re,ge)}}e("decorate",A);function M($,K){function re(ge,We){if(!He(ge))throw new TypeError;if(!ae(We)&&!Cte(We))throw new TypeError;fe($,K,ge,We)}return re}e("metadata",M);function L($,K,re,ge){if(!He(re))throw new TypeError;return ae(ge)||(ge=Pn(ge)),fe($,K,re,ge)}e("defineMetadata",L);function F($,K,re){if(!He(K))throw new TypeError;return ae(re)||(re=Pn(re)),Z($,K,re)}e("hasMetadata",F);function Y($,K,re){if(!He(K))throw new TypeError;return ae(re)||(re=Pn(re)),X($,K,re)}e("hasOwnMetadata",Y);function H($,K,re){if(!He(K))throw new TypeError;return ae(re)||(re=Pn(re)),te($,K,re)}e("getMetadata",H);function U($,K,re){if(!He(K))throw new TypeError;return ae(re)||(re=Pn(re)),ce($,K,re)}e("getOwnMetadata",U);function P($,K){if(!He($))throw new TypeError;return ae(K)||(K=Pn(K)),ue($,K)}e("getMetadataKeys",P);function R($,K){if(!He($))throw new TypeError;return ae(K)||(K=Pn(K)),Ue($,K)}e("getOwnMetadataKeys",R);function N($,K,re){if(!He(K))throw new TypeError;if(ae(re)||(re=Pn(re)),!He(K))throw new TypeError;ae(re)||(re=Pn(re));var ge=z0(K,re,!1);return ae(ge)?!1:ge.OrdinaryDeleteMetadata($,K,re)}e("deleteMetadata",N);function j($,K){for(var re=$.length-1;re>=0;--re){var ge=$[re],We=ge(K);if(!ae(We)&&!pt(We)){if(!ZR(We))throw new TypeError;K=We}}return K}function V($,K,re,ge){for(var We=$.length-1;We>=0;--We){var Lr=$[We],cn=Lr(K,re,ge);if(!ae(cn)&&!pt(cn)){if(!He(cn))throw new TypeError;ge=cn}}return ge}function Z($,K,re){var ge=X($,K,re);if(ge)return!0;var We=FS(K);return pt(We)?!1:Z($,We,re)}function X($,K,re){var ge=z0(K,re,!1);return ae(ge)?!1:sn(ge.OrdinaryHasOwnMetadata($,K,re))}function te($,K,re){var ge=X($,K,re);if(ge)return ce($,K,re);var We=FS(K);if(!pt(We))return te($,We,re)}function ce($,K,re){var ge=z0(K,re,!1);if(!ae(ge))return ge.OrdinaryGetOwnMetadata($,K,re)}function fe($,K,re,ge){var We=z0(re,ge,!0);We.OrdinaryDefineOwnMetadata($,K,re,ge)}function ue($,K){var re=Ue($,K),ge=FS($);if(ge===null)return re;var We=ue(ge,K);if(We.length<=0)return re;if(re.length<=0)return We;for(var Lr=new p,cn=[],vt=0,Ie=re;vt<Ie.length;vt++){var Pe=Ie[vt],ke=Lr.has(Pe);ke||(Lr.add(Pe),cn.push(Pe))}for(var Fe=0,_t=We;Fe<_t.length;Fe++){var Pe=_t[Fe],ke=Lr.has(Pe);ke||(Lr.add(Pe),cn.push(Pe))}return cn}function Ue($,K){var re=z0($,K,!1);return re?re.OrdinaryOwnMetadataKeys($,K):[]}function Ce($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function ae($){return $===void 0}function pt($){return $===null}function zt($){return typeof $=="symbol"}function He($){return typeof $=="object"?$!==null:typeof $=="function"}function er($,K){switch(Ce($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var re=K===3?"string":K===5?"number":"default",ge=JR($,i);if(ge!==void 0){var We=ge.call($,re);if(He(We))throw new TypeError;return We}return Jn($,re==="default"?"number":re)}function Jn($,K){if(K==="string"){var re=$.toString;if(Sh(re)){var ge=re.call($);if(!He(ge))return ge}var We=$.valueOf;if(Sh(We)){var ge=We.call($);if(!He(ge))return ge}}else{var We=$.valueOf;if(Sh(We)){var ge=We.call($);if(!He(ge))return ge}var Lr=$.toString;if(Sh(Lr)){var ge=Lr.call($);if(!He(ge))return ge}}throw new TypeError}function sn($){return!!$}function an($){return""+$}function Pn($){var K=er($,3);return zt(K)?K:an(K)}function Ji($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function Sh($){return typeof $=="function"}function ZR($){return typeof $=="function"}function Cte($){switch(Ce($)){case 3:return!0;case 4:return!0;default:return!1}}function LS($,K){return $===K||$!==$&&K!==K}function JR($,K){var re=$[K];if(re!=null){if(!Sh(re))throw new TypeError;return re}}function eN($){var K=JR($,s);if(!Sh(K))throw new TypeError;var re=K.call($);if(!He(re))throw new TypeError;return re}function tN($){return $.value}function rN($){var K=$.next();return K.done?!1:K}function nN($){var K=$.return;K&&K.call($)}function FS($){var K=Object.getPrototypeOf($);if(typeof $!="function"||$===d||K!==d)return K;var re=$.prototype,ge=re&&Object.getPrototypeOf(re);if(ge==null||ge===Object.prototype)return K;var We=ge.constructor;return typeof We!="function"||We===$?K:We}function Ite(){var $;!ae(w)&&typeof t.Reflect<"u"&&!(w in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&($=Tte(t.Reflect));var K,re,ge,We=new m,Lr={registerProvider:cn,getProvider:Ie,setProvider:ke};return Lr;function cn(Fe){if(!Object.isExtensible(Lr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case $===Fe:break;case ae(K):K=Fe;break;case K===Fe:break;case ae(re):re=Fe;break;case re===Fe:break;default:ge===void 0&&(ge=new p),ge.add(Fe);break}}function vt(Fe,_t){if(!ae(K)){if(K.isProviderFor(Fe,_t))return K;if(!ae(re)){if(re.isProviderFor(Fe,_t))return K;if(!ae(ge))for(var sr=eN(ge);;){var Fr=rN(sr);if(!Fr)return;var js=tN(Fr);if(js.isProviderFor(Fe,_t))return nN(sr),js}}}if(!ae($)&&$.isProviderFor(Fe,_t))return $}function Ie(Fe,_t){var sr=We.get(Fe),Fr;return ae(sr)||(Fr=sr.get(_t)),ae(Fr)&&(Fr=vt(Fe,_t),ae(Fr)||(ae(sr)&&(sr=new h,We.set(Fe,sr)),sr.set(_t,Fr))),Fr}function Pe(Fe){if(ae(Fe))throw new TypeError;return K===Fe||re===Fe||!ae(ge)&&ge.has(Fe)}function ke(Fe,_t,sr){if(!Pe(sr))throw new Error("Metadata provider not registered.");var Fr=Ie(Fe,_t);if(Fr!==sr){if(!ae(Fr))return!1;var js=We.get(Fe);ae(js)&&(js=new h,We.set(Fe,js)),js.set(_t,sr)}return!0}}function Ate(){var $;return!ae(w)&&He(t.Reflect)&&Object.isExtensible(t.Reflect)&&($=t.Reflect[w]),ae($)&&($=Ite()),!ae(w)&&He(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,w,{enumerable:!1,configurable:!1,writable:!1,value:$}),$}function Dte($){var K=new m,re={isProviderFor:function(Pe,ke){var Fe=K.get(Pe);return ae(Fe)?!1:Fe.has(ke)},OrdinaryDefineOwnMetadata:cn,OrdinaryHasOwnMetadata:We,OrdinaryGetOwnMetadata:Lr,OrdinaryOwnMetadataKeys:vt,OrdinaryDeleteMetadata:Ie};return E.registerProvider(re),re;function ge(Pe,ke,Fe){var _t=K.get(Pe),sr=!1;if(ae(_t)){if(!Fe)return;_t=new h,K.set(Pe,_t),sr=!0}var Fr=_t.get(ke);if(ae(Fr)){if(!Fe)return;if(Fr=new h,_t.set(ke,Fr),!$.setProvider(Pe,ke,re))throw _t.delete(ke),sr&&K.delete(Pe),new Error("Wrong provider for target.")}return Fr}function We(Pe,ke,Fe){var _t=ge(ke,Fe,!1);return ae(_t)?!1:sn(_t.has(Pe))}function Lr(Pe,ke,Fe){var _t=ge(ke,Fe,!1);if(!ae(_t))return _t.get(Pe)}function cn(Pe,ke,Fe,_t){var sr=ge(Fe,_t,!0);sr.set(Pe,ke)}function vt(Pe,ke){var Fe=[],_t=ge(Pe,ke,!1);if(ae(_t))return Fe;for(var sr=_t.keys(),Fr=eN(sr),js=0;;){var oN=rN(Fr);if(!oN)return Fe.length=js,Fe;var Rte=tN(oN);try{Fe[js]=Rte}catch(Nte){try{nN(Fr)}finally{throw Nte}}js++}}function Ie(Pe,ke,Fe){var _t=ge(ke,Fe,!1);if(ae(_t)||!_t.delete(Pe))return!1;if(_t.size===0){var sr=K.get(ke);ae(sr)||(sr.delete(Fe),sr.size===0&&K.delete(sr))}return!0}}function Tte($){var K=$.defineMetadata,re=$.hasOwnMetadata,ge=$.getOwnMetadata,We=$.getOwnMetadataKeys,Lr=$.deleteMetadata,cn=new m,vt={isProviderFor:function(Ie,Pe){var ke=cn.get(Ie);return!ae(ke)&&ke.has(Pe)?!0:We(Ie,Pe).length?(ae(ke)&&(ke=new p,cn.set(Ie,ke)),ke.add(Pe),!0):!1},OrdinaryDefineOwnMetadata:K,OrdinaryHasOwnMetadata:re,OrdinaryGetOwnMetadata:ge,OrdinaryOwnMetadataKeys:We,OrdinaryDeleteMetadata:Lr};return vt}function z0($,K,re){var ge=E.getProvider($,K);if(!ae(ge))return ge;if(re){if(E.setProvider($,K,S))return S;throw new Error("Illegal state.")}}function Pte(){var $={},K=[],re=function(){function vt(Ie,Pe,ke){this._index=0,this._keys=Ie,this._values=Pe,this._selector=ke}return vt.prototype["@@iterator"]=function(){return this},vt.prototype[s]=function(){return this},vt.prototype.next=function(){var Ie=this._index;if(Ie>=0&&Ie<this._keys.length){var Pe=this._selector(this._keys[Ie],this._values[Ie]);return Ie+1>=this._keys.length?(this._index=-1,this._keys=K,this._values=K):this._index++,{value:Pe,done:!1}}return{value:void 0,done:!0}},vt.prototype.throw=function(Ie){throw this._index>=0&&(this._index=-1,this._keys=K,this._values=K),Ie},vt.prototype.return=function(Ie){return this._index>=0&&(this._index=-1,this._keys=K,this._values=K),{value:Ie,done:!0}},vt}(),ge=function(){function vt(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(vt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),vt.prototype.has=function(Ie){return this._find(Ie,!1)>=0},vt.prototype.get=function(Ie){var Pe=this._find(Ie,!1);return Pe>=0?this._values[Pe]:void 0},vt.prototype.set=function(Ie,Pe){var ke=this._find(Ie,!0);return this._values[ke]=Pe,this},vt.prototype.delete=function(Ie){var Pe=this._find(Ie,!1);if(Pe>=0){for(var ke=this._keys.length,Fe=Pe+1;Fe<ke;Fe++)this._keys[Fe-1]=this._keys[Fe],this._values[Fe-1]=this._values[Fe];return this._keys.length--,this._values.length--,LS(Ie,this._cacheKey)&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},vt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},vt.prototype.keys=function(){return new re(this._keys,this._values,We)},vt.prototype.values=function(){return new re(this._keys,this._values,Lr)},vt.prototype.entries=function(){return new re(this._keys,this._values,cn)},vt.prototype["@@iterator"]=function(){return this.entries()},vt.prototype[s]=function(){return this.entries()},vt.prototype._find=function(Ie,Pe){if(!LS(this._cacheKey,Ie)){this._cacheIndex=-1;for(var ke=0;ke<this._keys.length;ke++)if(LS(this._keys[ke],Ie)){this._cacheIndex=ke;break}}return this._cacheIndex<0&&Pe&&(this._cacheIndex=this._keys.length,this._keys.push(Ie),this._values.push(void 0)),this._cacheIndex},vt}();return ge;function We(vt,Ie){return vt}function Lr(vt,Ie){return Ie}function cn(vt,Ie){return[vt,Ie]}}function Mte(){var $=function(){function K(){this._map=new h}return Object.defineProperty(K.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),K.prototype.has=function(re){return this._map.has(re)},K.prototype.add=function(re){return this._map.set(re,re),this},K.prototype.delete=function(re){return this._map.delete(re)},K.prototype.clear=function(){this._map.clear()},K.prototype.keys=function(){return this._map.keys()},K.prototype.values=function(){return this._map.keys()},K.prototype.entries=function(){return this._map.entries()},K.prototype["@@iterator"]=function(){return this.keys()},K.prototype[s]=function(){return this.keys()},K}();return $}function kte(){var $=16,K=u.create(),re=ge();return function(){function Ie(){this._key=ge()}return Ie.prototype.has=function(Pe){var ke=We(Pe,!1);return ke!==void 0?u.has(ke,this._key):!1},Ie.prototype.get=function(Pe){var ke=We(Pe,!1);return ke!==void 0?u.get(ke,this._key):void 0},Ie.prototype.set=function(Pe,ke){var Fe=We(Pe,!0);return Fe[this._key]=ke,this},Ie.prototype.delete=function(Pe){var ke=We(Pe,!1);return ke!==void 0?delete ke[this._key]:!1},Ie.prototype.clear=function(){this._key=ge()},Ie}();function ge(){var Ie;do Ie="@@WeakMap@@"+vt();while(u.has(K,Ie));return K[Ie]=!0,Ie}function We(Ie,Pe){if(!n.call(Ie,re)){if(!Pe)return;Object.defineProperty(Ie,re,{value:u.create()})}return Ie[re]}function Lr(Ie,Pe){for(var ke=0;ke<Pe;++ke)Ie[ke]=Math.random()*255|0;return Ie}function cn(Ie){if(typeof Uint8Array=="function"){var Pe=new Uint8Array(Ie);return typeof crypto<"u"?crypto.getRandomValues(Pe):typeof msCrypto<"u"?msCrypto.getRandomValues(Pe):Lr(Pe,Ie),Pe}return Lr(new Array(Ie),Ie)}function vt(){var Ie=cn($);Ie[6]=Ie[6]&79|64,Ie[8]=Ie[8]&191|128;for(var Pe="",ke=0;ke<$;++ke){var Fe=Ie[ke];(ke===4||ke===6||ke===8)&&(Pe+="-"),Fe<16&&(Pe+="0"),Pe+=Fe.toString(16).toLowerCase()}return Pe}}function BS($){return $.__=void 0,delete $.__,$}})})(iQ||(iQ={}))});var CJ=gn(J_=>{"use strict";Object.defineProperty(J_,"__esModule",{value:!0});var PR=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,o)=>{this.pullQueue.push({resolve:n,reject:o})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},Z_=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let o=new PR;o.highWaterMark=t,o.lowWaterMark=n,o.removeCallback=e({push:i=>o.push(i),stop:()=>o.stop(),fail:i=>o.fail(i),on:(i,s)=>{o.eventHandlers[i]=s}})||(()=>{}),this[Symbol.asyncIterator]=()=>o[Symbol.asyncIterator](),Object.freeze(this)}};J_.EventIterator=Z_;J_.default=Z_});var IJ=gn(xw=>{"use strict";Object.defineProperty(xw,"__esModule",{value:!0});var MR=CJ();xw.EventIterator=MR.EventIterator;function gbe(r,e,t){return new MR.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}xw.subscribe=gbe;xw.default=MR.EventIterator});var see=gn((Aw,rS)=>{"use strict";(function(r,e){"use strict";var t={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(p){if(!Array.isArray(p)&&!ArrayBuffer.isView(p))return!1;for(var m=0;m<p.length;m++)if(!Number.isInteger(p[m])||p[m]<0||p[m]>255)return!1;return!0}function o(p,m){return(p&65535)*m+(((p>>>16)*m&65535)<<16)}function i(p,m){return p<<m|p>>>32-m}function s(p){return p^=p>>>16,p=o(p,2246822507),p^=p>>>13,p=o(p,3266489909),p^=p>>>16,p}function a(p,m){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var w=[0,0,0,0];return w[3]+=p[3]+m[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=p[2]+m[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=p[1]+m[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=p[0]+m[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function c(p,m){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var w=[0,0,0,0];return w[3]+=p[3]*m[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=p[2]*m[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=p[3]*m[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=p[1]*m[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=p[2]*m[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=p[3]*m[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=p[0]*m[3]+p[1]*m[2]+p[2]*m[1]+p[3]*m[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function l(p,m){return m%=64,m===32?[p[1],p[0]]:m<32?[p[0]<<m|p[1]>>>32-m,p[1]<<m|p[0]>>>32-m]:(m-=32,[p[1]<<m|p[0]>>>32-m,p[0]<<m|p[1]>>>32-m])}function u(p,m){return m%=64,m===0?p:m<32?[p[0]<<m|p[1]>>>32-m,p[1]<<m]:[p[1]<<m-32,0]}function d(p,m){return[p[0]^m[0],p[1]^m[1]]}function h(p){return p=d(p,[0,p[0]>>>1]),p=c(p,[4283543511,3981806797]),p=d(p,[0,p[0]>>>1]),p=c(p,[3301882366,444984403]),p=d(p,[0,p[0]>>>1]),p}t.x86.hash32=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var w=p.length%4,E=p.length-w,S=m,A=0,M=3432918353,L=461845907,F=0;F<E;F=F+4)A=p[F]|p[F+1]<<8|p[F+2]<<16|p[F+3]<<24,A=o(A,M),A=i(A,15),A=o(A,L),S^=A,S=i(S,13),S=o(S,5)+3864292196;switch(A=0,w){case 3:A^=p[F+2]<<16;case 2:A^=p[F+1]<<8;case 1:A^=p[F],A=o(A,M),A=i(A,15),A=o(A,L),S^=A}return S^=p.length,S=s(S),S>>>0},t.x86.hash128=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var w=p.length%16,E=p.length-w,S=m,A=m,M=m,L=m,F=0,Y=0,H=0,U=0,P=597399067,R=2869860233,N=951274213,j=2716044179,V=0;V<E;V=V+16)F=p[V]|p[V+1]<<8|p[V+2]<<16|p[V+3]<<24,Y=p[V+4]|p[V+5]<<8|p[V+6]<<16|p[V+7]<<24,H=p[V+8]|p[V+9]<<8|p[V+10]<<16|p[V+11]<<24,U=p[V+12]|p[V+13]<<8|p[V+14]<<16|p[V+15]<<24,F=o(F,P),F=i(F,15),F=o(F,R),S^=F,S=i(S,19),S+=A,S=o(S,5)+1444728091,Y=o(Y,R),Y=i(Y,16),Y=o(Y,N),A^=Y,A=i(A,17),A+=M,A=o(A,5)+197830471,H=o(H,N),H=i(H,17),H=o(H,j),M^=H,M=i(M,15),M+=L,M=o(M,5)+2530024501,U=o(U,j),U=i(U,18),U=o(U,P),L^=U,L=i(L,13),L+=S,L=o(L,5)+850148119;switch(F=0,Y=0,H=0,U=0,w){case 15:U^=p[V+14]<<16;case 14:U^=p[V+13]<<8;case 13:U^=p[V+12],U=o(U,j),U=i(U,18),U=o(U,P),L^=U;case 12:H^=p[V+11]<<24;case 11:H^=p[V+10]<<16;case 10:H^=p[V+9]<<8;case 9:H^=p[V+8],H=o(H,N),H=i(H,17),H=o(H,j),M^=H;case 8:Y^=p[V+7]<<24;case 7:Y^=p[V+6]<<16;case 6:Y^=p[V+5]<<8;case 5:Y^=p[V+4],Y=o(Y,R),Y=i(Y,16),Y=o(Y,N),A^=Y;case 4:F^=p[V+3]<<24;case 3:F^=p[V+2]<<16;case 2:F^=p[V+1]<<8;case 1:F^=p[V],F=o(F,P),F=i(F,15),F=o(F,R),S^=F}return S^=p.length,A^=p.length,M^=p.length,L^=p.length,S+=A,S+=M,S+=L,A+=S,M+=S,L+=S,S=s(S),A=s(A),M=s(M),L=s(L),S+=A,S+=M,S+=L,A+=S,M+=S,L+=S,("00000000"+(S>>>0).toString(16)).slice(-8)+("00000000"+(A>>>0).toString(16)).slice(-8)+("00000000"+(M>>>0).toString(16)).slice(-8)+("00000000"+(L>>>0).toString(16)).slice(-8)},t.x64.hash128=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var w=p.length%16,E=p.length-w,S=[0,m],A=[0,m],M=[0,0],L=[0,0],F=[2277735313,289559509],Y=[1291169091,658871167],H=0;H<E;H=H+16)M=[p[H+4]|p[H+5]<<8|p[H+6]<<16|p[H+7]<<24,p[H]|p[H+1]<<8|p[H+2]<<16|p[H+3]<<24],L=[p[H+12]|p[H+13]<<8|p[H+14]<<16|p[H+15]<<24,p[H+8]|p[H+9]<<8|p[H+10]<<16|p[H+11]<<24],M=c(M,F),M=l(M,31),M=c(M,Y),S=d(S,M),S=l(S,27),S=a(S,A),S=a(c(S,[0,5]),[0,1390208809]),L=c(L,Y),L=l(L,33),L=c(L,F),A=d(A,L),A=l(A,31),A=a(A,S),A=a(c(A,[0,5]),[0,944331445]);switch(M=[0,0],L=[0,0],w){case 15:L=d(L,u([0,p[H+14]],48));case 14:L=d(L,u([0,p[H+13]],40));case 13:L=d(L,u([0,p[H+12]],32));case 12:L=d(L,u([0,p[H+11]],24));case 11:L=d(L,u([0,p[H+10]],16));case 10:L=d(L,u([0,p[H+9]],8));case 9:L=d(L,[0,p[H+8]]),L=c(L,Y),L=l(L,33),L=c(L,F),A=d(A,L);case 8:M=d(M,u([0,p[H+7]],56));case 7:M=d(M,u([0,p[H+6]],48));case 6:M=d(M,u([0,p[H+5]],40));case 5:M=d(M,u([0,p[H+4]],32));case 4:M=d(M,u([0,p[H+3]],24));case 3:M=d(M,u([0,p[H+2]],16));case 2:M=d(M,u([0,p[H+1]],8));case 1:M=d(M,[0,p[H]]),M=c(M,F),M=l(M,31),M=c(M,Y),S=d(S,M)}return S=d(S,[0,p.length]),A=d(A,[0,p.length]),S=a(S,A),A=a(A,S),S=h(S),A=h(A),S=a(S,A),A=a(A,S),("00000000"+(S[0]>>>0).toString(16)).slice(-8)+("00000000"+(S[1]>>>0).toString(16)).slice(-8)+("00000000"+(A[0]>>>0).toString(16)).slice(-8)+("00000000"+(A[1]>>>0).toString(16)).slice(-8)},typeof Aw<"u"?(typeof rS<"u"&&rS.exports&&(Aw=rS.exports=t),Aw.murmurHash3=t):typeof define=="function"&&define.amd?define([],function(){return t}):(t._murmurHash3=r.murmurHash3,t.noConflict=function(){return r.murmurHash3=t._murmurHash3,t._murmurHash3=e,t.noConflict=e,t},r.murmurHash3=t)})(Aw)});var cee=gn((iRt,aee)=>{"use strict";aee.exports=see()});var oS=gn((fRt,uee)=>{"use strict";uee.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let o=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):o=!0,this._setInternalPos(n,e,t,o),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,o=t;for(;n<this.length;){let i=this.get(n);o=e(o,i,n),n++}return o}find(e){let t=0,n,o;for(;t<this.length&&!n;)o=this.get(t),n=e(o),t++;return n?o:void 0}_internalPositionFor(e,t){let n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;let o=this._bitArrays[n],i=e-n*7;if(!((o&1<<i)>0))return-1;let a=this._bitArrays.slice(0,n).reduce(kbe,0),c=~(4294967295<<i+1),l=lee(o&c);return a+l-1}_bytePosFor(e,t){let n=Math.floor(e/7),o=n+1;for(;!t&&this._bitArrays.length<o;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*7}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*7)}_setInternalPos(e,t,n,o){let i=this._data,s=[t,n];if(o)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let a=Math.round(i.length/2);this._data=i.slice(0,a).concat(s).concat(i.slice(a))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(Rbe),this._changedData=!1}bitField(){let e=[],t=8,n=0,o=0,i,s=this._bitArrays.slice();for(;s.length||n;){n===0&&(i=s.shift(),n=7);let c=Math.min(n,t),l=~(255<<c),u=i&l;o|=u<<8-t,i=i>>>c,n-=c,t-=c,(!t||!n&&!s.length)&&(e.push(o),o=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(Nbe)}};function kbe(r,e){return r+lee(e)}function lee(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function Rbe(r,e){return r[0]-e[0]}function Nbe(r){return r[1]}});var US;function VS(){return US}function Fc(r){let e=US;return US=r,e}var Ote=Symbol("NotFound"),Rw=class extends Error{name="\u0275NotFound";constructor(e){super(e)}};function Ih(r){return r===Ote||r?.name==="\u0275NotFound"}function Bw(r,e){return Object.is(r,e)}var ln=null,Nw=!1,jS=1,Lte=null,eo=Symbol("SIGNAL");function lt(r){let e=ln;return ln=r,e}function Uw(){return ln}var kd={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Ah(r){if(Nw)throw new Error("");if(ln===null)return;ln.consumerOnSignalRead(r);let e=ln.nextProducerIndex++;if($w(ln),e<ln.producerNode.length&&ln.producerNode[e]!==r&&W0(ln)){let t=ln.producerNode[e];Hw(t,ln.producerIndexOfThis[e])}ln.producerNode[e]!==r&&(ln.producerNode[e]=r,ln.producerIndexOfThis[e]=W0(ln)?pN(r,ln,e):0),ln.producerLastReadVersion[e]=r.version}function fN(){jS++}function Vw(r){if(!(W0(r)&&!r.dirty)&&!(!r.dirty&&r.lastCleanEpoch===jS)){if(!r.producerMustRecompute(r)&&!Y0(r)){Fw(r);return}r.producerRecomputeValue(r),Fw(r)}}function HS(r){if(r.liveConsumerNode===void 0)return;let e=Nw;Nw=!0;try{for(let t of r.liveConsumerNode)t.dirty||Fte(t)}finally{Nw=e}}function $S(){return ln?.consumerAllowSignalWrites!==!1}function Fte(r){r.dirty=!0,HS(r),r.consumerMarkedDirty?.(r)}function Fw(r){r.dirty=!1,r.lastCleanEpoch=jS}function Rd(r){return r&&(r.nextProducerIndex=0),lt(r)}function Dh(r,e){if(lt(e),!(!r||r.producerNode===void 0||r.producerIndexOfThis===void 0||r.producerLastReadVersion===void 0)){if(W0(r))for(let t=r.nextProducerIndex;t<r.producerNode.length;t++)Hw(r.producerNode[t],r.producerIndexOfThis[t]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function Y0(r){$w(r);for(let e=0;e<r.producerNode.length;e++){let t=r.producerNode[e],n=r.producerLastReadVersion[e];if(n!==t.version||(Vw(t),n!==t.version))return!0}return!1}function jw(r){if($w(r),W0(r))for(let e=0;e<r.producerNode.length;e++)Hw(r.producerNode[e],r.producerIndexOfThis[e]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function pN(r,e,t){if(hN(r),r.liveConsumerNode.length===0&&mN(r))for(let n=0;n<r.producerNode.length;n++)r.producerIndexOfThis[n]=pN(r.producerNode[n],r,n);return r.liveConsumerIndexOfThis.push(t),r.liveConsumerNode.push(e)-1}function Hw(r,e){if(hN(r),r.liveConsumerNode.length===1&&mN(r))for(let n=0;n<r.producerNode.length;n++)Hw(r.producerNode[n],r.producerIndexOfThis[n]);let t=r.liveConsumerNode.length-1;if(r.liveConsumerNode[e]=r.liveConsumerNode[t],r.liveConsumerIndexOfThis[e]=r.liveConsumerIndexOfThis[t],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,e<r.liveConsumerNode.length){let n=r.liveConsumerIndexOfThis[e],o=r.liveConsumerNode[e];$w(o),o.producerIndexOfThis[n]=e}}function W0(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function $w(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}function hN(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}function mN(r){return r.producerNode!==void 0}function zw(r){Lte?.(r)}function qw(r,e){let t=Object.create(Bte);t.computation=r,e!==void 0&&(t.equal=e);let n=()=>{if(Vw(t),Ah(t),t.value===G0)throw t.error;return t.value};return n[eo]=t,zw(t),n}var Ow=Symbol("UNSET"),Lw=Symbol("COMPUTING"),G0=Symbol("ERRORED"),Bte=I(v({},kd),{value:Ow,dirty:!0,error:null,equal:Bw,kind:"computed",producerMustRecompute(r){return r.value===Ow||r.value===Lw},producerRecomputeValue(r){if(r.value===Lw)throw new Error("");let e=r.value;r.value=Lw;let t=Rd(r),n,o=!1;try{n=r.computation(),lt(null),o=e!==Ow&&e!==G0&&n!==G0&&r.equal(e,n)}catch(i){n=G0,r.error=i}finally{Dh(r,t)}if(o){r.value=e;return}r.value=n,r.version++}});function Ute(){throw new Error}var gN=Ute;function yN(r){gN(r)}function zS(r){gN=r}var Vte=null;function qS(r,e){let t=Object.create(Kw);t.value=r,e!==void 0&&(t.equal=e);let n=()=>vN(t);return n[eo]=t,zw(t),[n,s=>Th(t,s),s=>KS(t,s)]}function vN(r){return Ah(r),r.value}function Th(r,e){$S()||yN(r),r.equal(r.value,e)||(r.value=e,jte(r))}function KS(r,e){$S()||yN(r),Th(r,e(r.value))}var Kw=I(v({},kd),{equal:Bw,value:void 0,kind:"signal"});function jte(r){r.version++,fN(),HS(r),Vte?.(r)}function it(r){return typeof r=="function"}function zl(r){let t=r(n=>{Error.call(n),n.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Gw=zl(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((n,o)=>`${o+1}) ${n.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Nd(r,e){if(r){let t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Ir=class r{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let i of t)i.remove(this);else t.remove(this);let{initialTeardown:n}=this;if(it(n))try{n()}catch(i){e=i instanceof Gw?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{wN(i)}catch(s){e=e??[],s instanceof Gw?e=[...e,...s.errors]:e.push(s)}}if(e)throw new Gw(e)}}add(e){var t;if(e&&e!==this)if(this.closed)wN(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Nd(t,e)}remove(e){let{_finalizers:t}=this;t&&Nd(t,e),e instanceof r&&e._removeParent(this)}};Ir.EMPTY=(()=>{let r=new Ir;return r.closed=!0,r})();var GS=Ir.EMPTY;function Ww(r){return r instanceof Ir||r&&"closed"in r&&it(r.remove)&&it(r.add)&&it(r.unsubscribe)}function wN(r){it(r)?r():r.unsubscribe()}var Hs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ph={setTimeout(r,e,...t){let{delegate:n}=Ph;return n?.setTimeout?n.setTimeout(r,e,...t):setTimeout(r,e,...t)},clearTimeout(r){let{delegate:e}=Ph;return(e?.clearTimeout||clearTimeout)(r)},delegate:void 0};function Yw(r){Ph.setTimeout(()=>{let{onUnhandledError:e}=Hs;if(e)e(r);else throw r})}function X0(){}var bN=WS("C",void 0,void 0);function xN(r){return WS("E",void 0,r)}function EN(r){return WS("N",r,void 0)}function WS(r,e,t){return{kind:r,value:e,error:t}}var Od=null;function Mh(r){if(Hs.useDeprecatedSynchronousErrorHandling){let e=!Od;if(e&&(Od={errorThrown:!1,error:null}),r(),e){let{errorThrown:t,error:n}=Od;if(Od=null,t)throw n}}else r()}function _N(r){Hs.useDeprecatedSynchronousErrorHandling&&Od&&(Od.errorThrown=!0,Od.error=r)}var Ld=class extends Ir{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Ww(e)&&e.add(this)):this.destination=zte}static create(e,t,n){return new ql(e,t,n)}next(e){this.isStopped?XS(EN(e),this):this._next(e)}error(e){this.isStopped?XS(xN(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?XS(bN,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Hte=Function.prototype.bind;function YS(r,e){return Hte.call(r,e)}var QS=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(n){Xw(n)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(n){Xw(n)}else Xw(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Xw(t)}}},ql=class extends Ld{constructor(e,t,n){super();let o;if(it(e)||!e)o={next:e??void 0,error:t??void 0,complete:n??void 0};else{let i;this&&Hs.useDeprecatedNextContext?(i=Object.create(e),i.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&YS(e.next,i),error:e.error&&YS(e.error,i),complete:e.complete&&YS(e.complete,i)}):o=e}this.destination=new QS(o)}};function Xw(r){Hs.useDeprecatedSynchronousErrorHandling?_N(r):Yw(r)}function $te(r){throw r}function XS(r,e){let{onStoppedNotification:t}=Hs;t&&Ph.setTimeout(()=>t(r,e))}var zte={closed:!0,next:X0,error:$te,complete:X0};var kh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function _i(r){return r}function ZS(...r){return JS(r)}function JS(r){return r.length===0?_i:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}var ht=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){let n=new r;return n.source=this,n.operator=t,n}subscribe(t,n,o){let i=Kte(t)?t:new ql(t,n,o);return Mh(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return n=SN(n),new n((o,i)=>{let s=new ql({next:a=>{try{t(a)}catch(c){i(c),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)}[kh](){return this}pipe(...t){return JS(t)(this)}toPromise(t){return t=SN(t),new t((n,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>n(i))})}}return r.create=e=>new r(e),r})();function SN(r){var e;return(e=r??Hs.Promise)!==null&&e!==void 0?e:Promise}function qte(r){return r&&it(r.next)&&it(r.error)&&it(r.complete)}function Kte(r){return r&&r instanceof Ld||qte(r)&&Ww(r)}function eC(r){return it(r?.lift)}function St(r){return e=>{if(eC(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function gt(r,e,t,n,o){return new tC(r,e,t,n,o)}var tC=class extends Ld{constructor(e,t,n,o,i,s){super(e),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=o?function(a){try{o(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Rh(){return St((r,e)=>{let t=null;r._refCount++;let n=gt(e,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount){t=null;return}let o=r._connection,i=t;t=null,o&&(!i||o===i)&&o.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var Nh=class extends ht{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,eC(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Ir;let t=this.getSubject();e.add(this.source.subscribe(gt(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Ir.EMPTY)}return e}refCount(){return Rh()(this)}};var CN=zl(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var qt=(()=>{class r extends ht{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let n=new Qw(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new CN}next(t){Mh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let n of this.currentObservers)n.next(t)}})}error(t){Mh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){Mh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:n,isStopped:o,observers:i}=this;return n||o?GS:(this.currentObservers=null,i.push(t),new Ir(()=>{this.currentObservers=null,Nd(i,t)}))}_checkFinalizedStatuses(t){let{hasError:n,thrownError:o,isStopped:i}=this;n?t.error(o):i&&t.complete()}asObservable(){let t=new ht;return t.source=this,t}}return r.create=(e,t)=>new Qw(e,t),r})(),Qw=class extends qt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.next)===null||n===void 0||n.call(t,e)}error(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.error)===null||n===void 0||n.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,n;return(n=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&n!==void 0?n:GS}};var un=class extends qt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}};var rC={now(){return(rC.delegate||Date).now()},delegate:void 0};var Zw=class extends Ir{constructor(e,t){super()}schedule(e,t=0){return this}};var Q0={setInterval(r,e,...t){let{delegate:n}=Q0;return n?.setInterval?n.setInterval(r,e,...t):setInterval(r,e,...t)},clearInterval(r){let{delegate:e}=Q0;return(e?.clearInterval||clearInterval)(r)},delegate:void 0};var Jw=class extends Zw{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var n;if(this.closed)return this;this.state=e;let o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,t)),this.pending=!0,this.delay=t,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,n=0){return Q0.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(n!=null&&this.delay===n&&this.pending===!1)return t;t!=null&&Q0.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let n=this._execute(e,t);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n=!1,o;try{this.work(e)}catch(i){n=!0,o=i||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Nd(n,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var Oh=class r{constructor(e,t=r.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}};Oh.now=rC.now;var eb=class extends Oh{constructor(e,t=Oh.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}};var nC=new eb(Jw),IN=nC;var Ko=new ht(r=>r.complete());function tb(r){return r&&it(r.schedule)}function AN(r){return r[r.length-1]}function rb(r){return it(AN(r))?r.pop():void 0}function Kl(r){return tb(AN(r))?r.pop():void 0}function g(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}function TN(r,e,t,n){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function DN(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fd(r){return this instanceof Fd?(this.v=r,this):new Fd(r)}function PN(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(p){return function(m){return Promise.resolve(m).then(p,d)}}function a(p,m){n[p]&&(o[p]=function(w){return new Promise(function(E,S){i.push([p,w,E,S])>1||c(p,w)})},m&&(o[p]=m(o[p])))}function c(p,m){try{l(n[p](m))}catch(w){h(i[0][3],w)}}function l(p){p.value instanceof Fd?Promise.resolve(p.value.v).then(u,d):h(i[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function h(p,m){p(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function MN(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof DN=="function"?DN(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(s){return new Promise(function(a,c){s=r[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},s)}}var nb=r=>r&&typeof r.length=="number"&&typeof r!="function";function ob(r){return it(r?.then)}function ib(r){return it(r[kh])}function sb(r){return Symbol.asyncIterator&&it(r?.[Symbol.asyncIterator])}function ab(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Gte(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var cb=Gte();function lb(r){return it(r?.[cb])}function ub(r){return PN(this,arguments,function*(){let t=r.getReader();try{for(;;){let{value:n,done:o}=yield Fd(t.read());if(o)return yield Fd(void 0);yield yield Fd(n)}}finally{t.releaseLock()}})}function db(r){return it(r?.getReader)}function Ar(r){if(r instanceof ht)return r;if(r!=null){if(ib(r))return Wte(r);if(nb(r))return Yte(r);if(ob(r))return Xte(r);if(sb(r))return kN(r);if(lb(r))return Qte(r);if(db(r))return Zte(r)}throw ab(r)}function Wte(r){return new ht(e=>{let t=r[kh]();if(it(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Yte(r){return new ht(e=>{for(let t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function Xte(r){return new ht(e=>{r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Yw)})}function Qte(r){return new ht(e=>{for(let t of r)if(e.next(t),e.closed)return;e.complete()})}function kN(r){return new ht(e=>{Jte(r,e).catch(t=>e.error(t))})}function Zte(r){return kN(ub(r))}function Jte(r,e){var t,n,o,i;return TN(this,void 0,void 0,function*(){try{for(t=MN(r);n=yield t.next(),!n.done;){let s=n.value;if(e.next(s),e.closed)return}}catch(s){o={error:s}}finally{try{n&&!n.done&&(i=t.return)&&(yield i.call(t))}finally{if(o)throw o.error}}e.complete()})}function to(r,e,t,n=0,o=!1){let i=e.schedule(function(){t(),o?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(i),!o)return i}function fb(r,e=0){return St((t,n)=>{t.subscribe(gt(n,o=>to(n,r,()=>n.next(o),e),()=>to(n,r,()=>n.complete(),e),o=>to(n,r,()=>n.error(o),e)))})}function pb(r,e=0){return St((t,n)=>{n.add(r.schedule(()=>t.subscribe(n),e))})}function RN(r,e){return Ar(r).pipe(pb(e),fb(e))}function NN(r,e){return Ar(r).pipe(pb(e),fb(e))}function ON(r,e){return new ht(t=>{let n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function LN(r,e){return new ht(t=>{let n;return to(t,e,()=>{n=r[cb](),to(t,e,()=>{let o,i;try{({value:o,done:i}=n.next())}catch(s){t.error(s);return}i?t.complete():t.next(o)},0,!0)}),()=>it(n?.return)&&n.return()})}function hb(r,e){if(!r)throw new Error("Iterable cannot be null");return new ht(t=>{to(t,e,()=>{let n=r[Symbol.asyncIterator]();to(t,e,()=>{n.next().then(o=>{o.done?t.complete():t.next(o.value)})},0,!0)})})}function FN(r,e){return hb(ub(r),e)}function BN(r,e){if(r!=null){if(ib(r))return RN(r,e);if(nb(r))return ON(r,e);if(ob(r))return NN(r,e);if(sb(r))return hb(r,e);if(lb(r))return LN(r,e);if(db(r))return FN(r,e)}throw ab(r)}function yr(r,e){return e?BN(r,e):Ar(r)}function Ve(...r){let e=Kl(r);return yr(r,e)}function Si(r,e){let t=it(r)?r:()=>r,n=o=>o.error(t());return new ht(e?o=>e.schedule(n,0,o):n)}function oC(r){return!!r&&(r instanceof ht||it(r.lift)&&it(r.subscribe))}var $s=zl(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function Z0(r,e){let t=typeof e=="object";return new Promise((n,o)=>{let i=new ql({next:s=>{n(s),i.unsubscribe()},error:o,complete:()=>{t?n(e.defaultValue):o(new $s)}});r.subscribe(i)})}function mb(r){return r instanceof Date&&!isNaN(r)}var ere=zl(r=>function(t=null){r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t});function Bc(r,e){let{first:t,each:n,with:o=tre,scheduler:i=e??nC,meta:s=null}=mb(r)?{first:r}:typeof r=="number"?{each:r}:r;if(t==null&&n==null)throw new TypeError("No timeout provided.");return St((a,c)=>{let l,u,d=null,h=0,p=m=>{u=to(c,i,()=>{try{l.unsubscribe(),Ar(o({meta:s,lastValue:d,seen:h})).subscribe(c)}catch(w){c.error(w)}},m)};l=a.subscribe(gt(c,m=>{u?.unsubscribe(),h++,c.next(d=m),n>0&&p(n)},void 0,void 0,()=>{u?.closed||u?.unsubscribe(),d=null})),!h&&p(t!=null?typeof t=="number"?t:+t-i.now():n)})}function tre(r){throw new ere(r)}function Je(r,e){return St((t,n)=>{let o=0;t.subscribe(gt(n,i=>{n.next(r.call(e,i,o++))}))})}var{isArray:rre}=Array;function nre(r,e){return rre(e)?r(...e):r(e)}function gb(r){return Je(e=>nre(r,e))}var{isArray:ore}=Array,{getPrototypeOf:ire,prototype:sre,keys:are}=Object;function yb(r){if(r.length===1){let e=r[0];if(ore(e))return{args:e,keys:null};if(cre(e)){let t=are(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:r,keys:null}}function cre(r){return r&&typeof r=="object"&&ire(r)===sre}function vb(r,e){return r.reduce((t,n,o)=>(t[n]=e[o],t),{})}function wb(...r){let e=Kl(r),t=rb(r),{args:n,keys:o}=yb(r);if(n.length===0)return yr([],e);let i=new ht(lre(n,e,o?s=>vb(o,s):_i));return t?i.pipe(gb(t)):i}function lre(r,e,t=_i){return n=>{UN(e,()=>{let{length:o}=r,i=new Array(o),s=o,a=o;for(let c=0;c<o;c++)UN(e,()=>{let l=yr(r[c],e),u=!1;l.subscribe(gt(n,d=>{i[c]=d,u||(u=!0,a--),a||n.next(t(i.slice()))},()=>{--s||n.complete()}))},n)},n)}}function UN(r,e,t){r?to(t,r,e):e()}function VN(r,e,t,n,o,i,s,a){let c=[],l=0,u=0,d=!1,h=()=>{d&&!c.length&&!l&&e.complete()},p=w=>l<n?m(w):c.push(w),m=w=>{i&&e.next(w),l++;let E=!1;Ar(t(w,u++)).subscribe(gt(e,S=>{o?.(S),i?p(S):e.next(S)},()=>{E=!0},void 0,()=>{if(E)try{for(l--;c.length&&l<n;){let S=c.shift();s?to(e,s,()=>m(S)):m(S)}h()}catch(S){e.error(S)}}))};return r.subscribe(gt(e,p,()=>{d=!0,h()})),()=>{a?.()}}function qr(r,e,t=1/0){return it(e)?qr((n,o)=>Je((i,s)=>e(n,i,o,s))(Ar(r(n,o))),t):(typeof e=="number"&&(t=e),St((n,o)=>VN(n,o,r,t)))}function Lh(r=1/0){return qr(_i,r)}function jN(){return Lh(1)}function Fh(...r){return jN()(yr(r,Kl(r)))}function J0(r){return new ht(e=>{Ar(r()).subscribe(e)})}function iC(...r){let e=rb(r),{args:t,keys:n}=yb(r),o=new ht(i=>{let{length:s}=t;if(!s){i.complete();return}let a=new Array(s),c=s,l=s;for(let u=0;u<s;u++){let d=!1;Ar(t[u]).subscribe(gt(i,h=>{d||(d=!0,l--),a[u]=h},()=>c--,void 0,()=>{(!c||!d)&&(l||i.next(n?vb(n,a):a),i.complete())}))}});return e?o.pipe(gb(e)):o}function sC(r=0,e,t=IN){let n=-1;return e!=null&&(tb(e)?t=e:n=e),new ht(o=>{let i=mb(r)?+r-t.now():r;i<0&&(i=0);let s=0;return t.schedule(function(){o.closed||(o.next(s++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function _o(r,e){return St((t,n)=>{let o=0;t.subscribe(gt(n,i=>r.call(e,i,o++)&&n.next(i)))})}function dn(r){return St((e,t)=>{let n=null,o=!1,i;n=e.subscribe(gt(t,void 0,void 0,s=>{i=Ar(r(s,dn(r)(e))),n?(n.unsubscribe(),n=null,i.subscribe(t)):o=!0})),o&&(n.unsubscribe(),n=null,i.subscribe(t))})}function HN(r,e,t,n,o){return(i,s)=>{let a=t,c=e,l=0;i.subscribe(gt(s,u=>{let d=l++;c=a?r(c,u,d):(a=!0,u),n&&s.next(c)},o&&(()=>{a&&s.next(c),s.complete()})))}}function Uc(r,e){return it(e)?qr(r,e,1):qr(r,1)}function Gl(r){return St((e,t)=>{let n=!1;e.subscribe(gt(t,o=>{n=!0,t.next(o)},()=>{n||t.next(r),t.complete()}))})}function Vc(r){return r<=0?()=>Ko:St((e,t)=>{let n=0;e.subscribe(gt(t,o=>{++n<=r&&(t.next(o),r<=n&&t.complete())}))})}function bb(r=ure){return St((e,t)=>{let n=!1;e.subscribe(gt(t,o=>{n=!0,t.next(o)},()=>n?t.complete():t.error(r())))})}function ure(){return new $s}function Bd(r){return St((e,t)=>{try{e.subscribe(t)}finally{t.add(r)}})}function jc(r,e){let t=arguments.length>=2;return n=>n.pipe(r?_o((o,i)=>r(o,i,n)):_i,Vc(1),t?Gl(e):bb(()=>new $s))}function Bh(r){return r<=0?()=>Ko:St((e,t)=>{let n=[];e.subscribe(gt(t,o=>{n.push(o),r<n.length&&n.shift()},()=>{for(let o of n)t.next(o);t.complete()},void 0,()=>{n=null}))})}function aC(r,e){let t=arguments.length>=2;return n=>n.pipe(r?_o((o,i)=>r(o,i,n)):_i,Bh(1),t?Gl(e):bb(()=>new $s))}function cC(r,e){return St(HN(r,e,arguments.length>=2,!0))}function lC(...r){let e=Kl(r);return St((t,n)=>{(e?Fh(r,t,e):Fh(r,t)).subscribe(n)})}function ro(r,e){return St((t,n)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&n.complete();t.subscribe(gt(n,c=>{o?.unsubscribe();let l=0,u=i++;Ar(r(c,u)).subscribe(o=gt(n,d=>n.next(e?e(c,d,u,l++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function Hc(r){return St((e,t)=>{Ar(r).subscribe(gt(t,()=>t.complete(),X0)),!t.closed&&e.subscribe(t)})}function yn(r,e,t){let n=it(r)||e||t?{next:r,error:e,complete:t}:r;return n?St((o,i)=>{var s;(s=n.subscribe)===null||s===void 0||s.call(n);let a=!0;o.subscribe(gt(i,c=>{var l;(l=n.next)===null||l===void 0||l.call(n,c),i.next(c)},()=>{var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),i.complete()},c=>{var l;a=!1,(l=n.error)===null||l===void 0||l.call(n,c),i.error(c)},()=>{var c,l;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(l=n.finalize)===null||l===void 0||l.call(n)}))}):_i}function $N(r){let e=lt(null);try{return r()}finally{lt(e)}}var Cb="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",be=class extends Error{code;constructor(e,t){super(Ib(e,t)),this.code=e}};function dre(r){return`NG0${Math.abs(r)}`}function Ib(r,e){return`${dre(r)}${e?": "+e:""}`}var zc=globalThis;function dr(r){for(let e in r)if(r[e]===dr)return e;throw Error("")}function GN(r,e){for(let t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function Go(r){if(typeof r=="string")return r;if(Array.isArray(r))return`[${r.map(Go).join(", ")}]`;if(r==null)return""+r;let e=r.overriddenName||r.name;if(e)return`${e}`;let t=r.toString();if(t==null)return""+t;let n=t.indexOf(`
`);return n>=0?t.slice(0,n):t}function Ab(r,e){return r?e?`${r} ${e}`:r:e||""}var fre=dr({__forward_ref__:dr});function wn(r){return r.__forward_ref__=wn,r.toString=function(){return Go(this())},r}function kn(r){return EC(r)?r():r}function EC(r){return typeof r=="function"&&r.hasOwnProperty(fre)&&r.__forward_ref__===wn}function WN(r,e,t,n){throw new Error(`ASSERTION ERROR: ${r}`+(n==null?"":` [Expected=> ${t} ${n} ${e} <=Actual]`))}function he(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Wo(r){return{providers:r.providers||[],imports:r.imports||[]}}function n1(r){return pre(r,Db)}function _C(r){return n1(r)!==null}function pre(r,e){return r.hasOwnProperty(e)&&r[e]||null}function hre(r){let e=r?.[Db]??null;return e||null}function dC(r){return r&&r.hasOwnProperty(Eb)?r[Eb]:null}var Db=dr({\u0275prov:dr}),Eb=dr({\u0275inj:dr}),De=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=he({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function SC(r){return r&&!!r.\u0275providers}var CC=dr({\u0275cmp:dr}),IC=dr({\u0275dir:dr}),AC=dr({\u0275pipe:dr}),DC=dr({\u0275mod:dr}),t1=dr({\u0275fac:dr}),$d=dr({__NG_ELEMENT_ID__:dr}),zN=dr({__NG_ENV_ID__:dr});function Ql(r){return typeof r=="string"?r:r==null?"":String(r)}function YN(r){return typeof r=="function"?r.name||r.toString():typeof r=="object"&&r!=null&&typeof r.type=="function"?r.type.name||r.type.toString():Ql(r)}function TC(r,e){throw new be(-200,r)}function Tb(r,e){throw new be(-201,!1)}var fC;function XN(){return fC}function So(r){let e=fC;return fC=r,e}function PC(r,e,t){let n=n1(r);if(n&&n.providedIn=="root")return n.value===void 0?n.value=n.factory():n.value;if(t&8)return null;if(e!==void 0)return e;Tb(r,"Injector")}var mre={},Ud=mre,pC="__NG_DI_FLAG__",hC=class{injector;constructor(e){this.injector=e}retrieve(e,t){let n=Vd(t)||0;try{return this.injector.get(e,n&8?null:Ud,n)}catch(o){if(Ih(o))return o;throw o}}},_b="ngTempTokenPath",gre="ngTokenPath",yre=/\n/gm,vre="\u0275",qN="__source";function wre(r,e=0){let t=VS();if(t===void 0)throw new be(-203,!1);if(t===null)return PC(r,void 0,e);{let n=bre(e),o=t.retrieve(r,n);if(Ih(o)){if(n.optional)return null;throw o}return o}}function xe(r,e=0){return(XN()||wre)(kn(r),e)}function ie(r,e){return xe(r,Vd(e))}function Vd(r){return typeof r>"u"||typeof r=="number"?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function bre(r){return{optional:!!(r&8),host:!!(r&1),self:!!(r&2),skipSelf:!!(r&4)}}function mC(r){let e=[];for(let t=0;t<r.length;t++){let n=kn(r[t]);if(Array.isArray(n)){if(n.length===0)throw new be(900,!1);let o,i=0;for(let s=0;s<n.length;s++){let a=n[s],c=xre(a);typeof c=="number"?c===-1?o=a.token:i|=c:o=a}e.push(xe(o,i))}else e.push(xe(n))}return e}function MC(r,e){return r[pC]=e,r.prototype[pC]=e,r}function xre(r){return r[pC]}function Ere(r,e,t,n){let o=r[_b];throw e[qN]&&o.unshift(e[qN]),r.message=_re(`
`+r.message,o,t,n),r[gre]=o,r[_b]=null,r}function _re(r,e,t,n=null){r=r&&r.charAt(0)===`
`&&r.charAt(1)==vre?r.slice(2):r;let o=Go(e);if(Array.isArray(e))o=e.map(Go).join(" -> ");else if(typeof e=="object"){let i=[];for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Go(a)))}o=`{${i.join(", ")}}`}return`${t}${n?"("+n+")":""}[${o}]: ${r.replace(yre,`
  `)}`}function Wl(r,e){let t=r.hasOwnProperty(t1);return t?r[t1]:null}function QN(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++){let o=r[n],i=e[n];if(t&&(o=t(o),i=t(i)),i!==o)return!1}return!0}function ZN(r){return r.flat(Number.POSITIVE_INFINITY)}function Pb(r,e){r.forEach(t=>Array.isArray(t)?Pb(t,e):e(t))}function kC(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function o1(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function JN(r,e,t,n){let o=r.length;if(o==e)r.push(t,n);else if(o===1)r.push(n,r[0]),r[0]=t;else{for(o--,r.push(r[o-1],r[o]);o>e;){let i=o-2;r[o]=r[i],o--}r[e]=t,r[e+1]=n}}function Mb(r,e,t){let n=Vh(r,e);return n>=0?r[n|1]=t:(n=~n,JN(r,n,e,t)),n}function kb(r,e){let t=Vh(r,e);if(t>=0)return r[t|1]}function Vh(r,e){return Sre(r,e,1)}function Sre(r,e,t){let n=0,o=r.length>>t;for(;o!==n;){let i=n+(o-n>>1),s=r[i<<t];if(e===s)return i<<t;s>e?o=i:n=i+1}return~(o<<t)}var Zl={},Co=[],qc=new De(""),RC=new De("",-1),NC=new De(""),r1=class{get(e,t=Ud){if(t===Ud)throw new Rw(`NullInjectorError: No provider for ${Go(e)}!`);return t}};function OC(r){return r[DC]||null}function Jl(r){return r[CC]||null}function LC(r){return r[IC]||null}function eO(r){return r[AC]||null}function Kc(r){return{\u0275providers:r}}function tO(r){return Kc([{provide:qc,multi:!0,useValue:r}])}function rO(...r){return{\u0275providers:FC(!0,r),\u0275fromNgModule:!0}}function FC(r,...e){let t=[],n=new Set,o,i=s=>{t.push(s)};return Pb(e,s=>{let a=s;Sb(a,i,[],n)&&(o||=[],o.push(a))}),o!==void 0&&nO(o,i),t}function nO(r,e){for(let t=0;t<r.length;t++){let{ngModule:n,providers:o}=r[t];BC(o,i=>{e(i,n)})}}function Sb(r,e,t,n){if(r=kn(r),!r)return!1;let o=null,i=dC(r),s=!i&&Jl(r);if(!i&&!s){let c=r.ngModule;if(i=dC(c),i)o=c;else return!1}else{if(s&&!s.standalone)return!1;o=r}let a=n.has(o);if(s){if(a)return!1;if(n.add(o),s.dependencies){let c=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let l of c)Sb(l,e,t,n)}}else if(i){if(i.imports!=null&&!a){n.add(o);let l;try{Pb(i.imports,u=>{Sb(u,e,t,n)&&(l||=[],l.push(u))})}finally{}l!==void 0&&nO(l,e)}if(!a){let l=Wl(o)||(()=>new o);e({provide:o,useFactory:l,deps:Co},o),e({provide:NC,useValue:o,multi:!0},o),e({provide:qc,useValue:()=>xe(o),multi:!0},o)}let c=i.providers;if(c!=null&&!a){let l=r;BC(c,u=>{e(u,l)})}}else return!1;return o!==r&&r.providers!==void 0}function BC(r,e){for(let t of r)SC(t)&&(t=t.\u0275providers),Array.isArray(t)?BC(t,e):e(t)}var Cre=dr({provide:String,useValue:dr});function oO(r){return r!==null&&typeof r=="object"&&Cre in r}function Ire(r){return!!(r&&r.useExisting)}function Are(r){return!!(r&&r.useFactory)}function jd(r){return typeof r=="function"}function iO(r){return!!r.useClass}var i1=new De(""),xb={},KN={},uC;function s1(){return uC===void 0&&(uC=new r1),uC}var Kr=class{},Hd=class extends Kr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,n,o){super(),this.parent=t,this.source=n,this.scopes=o,yC(e,s=>this.processProvider(s)),this.records.set(RC,Uh(void 0,this)),o.has("environment")&&this.records.set(Kr,Uh(void 0,this));let i=this.records.get(i1);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(NC,Co,{self:!0}))}retrieve(e,t){let n=Vd(t)||0;try{return this.get(e,Ud,n)}catch(o){if(Ih(o))return o;throw o}}destroy(){e1(this),this._destroyed=!0;let e=lt(null);try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),lt(e)}}onDestroy(e){return e1(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){e1(this);let t=Fc(this),n=So(void 0),o;try{return e()}finally{Fc(t),So(n)}}get(e,t=Ud,n){if(e1(this),e.hasOwnProperty(zN))return e[zN](this);let o=Vd(n),i,s=Fc(this),a=So(void 0);try{if(!(o&4)){let l=this.records.get(e);if(l===void 0){let u=kre(e)&&n1(e);u&&this.injectableDefInScope(u)?l=Uh(gC(e),xb):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l)}let c=o&2?s1():this.parent;return t=o&8&&t===Ud?null:t,c.get(e,t)}catch(c){if(Ih(c)){if((c[_b]=c[_b]||[]).unshift(Go(e)),s)throw c;return Ere(c,e,"R3InjectorError",this.source)}else throw c}finally{So(a),Fc(s)}}resolveInjectorInitializers(){let e=lt(null),t=Fc(this),n=So(void 0),o;try{let i=this.get(qc,Co,{self:!0});for(let s of i)s()}finally{Fc(t),So(n),lt(e)}}toString(){let e=[],t=this.records;for(let n of t.keys())e.push(Go(n));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=kn(e);let t=jd(e)?e:kn(e&&e.provide),n=Tre(e);if(!jd(e)&&e.multi===!0){let o=this.records.get(t);o||(o=Uh(void 0,xb,!0),o.factory=()=>mC(o.multi),this.records.set(t,o)),t=e,o.multi.push(e)}this.records.set(t,n)}hydrate(e,t){let n=lt(null);try{return t.value===KN?TC(Go(e)):t.value===xb&&(t.value=KN,t.value=t.factory()),typeof t.value=="object"&&t.value&&Mre(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{lt(n)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=kn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function gC(r){let e=n1(r),t=e!==null?e.factory:Wl(r);if(t!==null)return t;if(r instanceof De)throw new be(204,!1);if(r instanceof Function)return Dre(r);throw new be(204,!1)}function Dre(r){if(r.length>0)throw new be(204,!1);let t=hre(r);return t!==null?()=>t.factory(r):()=>new r}function Tre(r){if(oO(r))return Uh(void 0,r.useValue);{let e=UC(r);return Uh(e,xb)}}function UC(r,e,t){let n;if(jd(r)){let o=kn(r);return Wl(o)||gC(o)}else if(oO(r))n=()=>kn(r.useValue);else if(Are(r))n=()=>r.useFactory(...mC(r.deps||[]));else if(Ire(r))n=()=>xe(kn(r.useExisting));else{let o=kn(r&&(r.useClass||r.provide));if(Pre(r))n=()=>new o(...mC(r.deps));else return Wl(o)||gC(o)}return n}function e1(r){if(r.destroyed)throw new be(205,!1)}function Uh(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function Pre(r){return!!r.deps}function Mre(r){return r!==null&&typeof r=="object"&&typeof r.ngOnDestroy=="function"}function kre(r){return typeof r=="function"||typeof r=="object"&&r.ngMetadataName==="InjectionToken"}function yC(r,e){for(let t of r)Array.isArray(t)?yC(t,e):t&&SC(t)?yC(t.\u0275providers,e):e(t)}function Io(r,e){let t;r instanceof Hd?(e1(r),t=r):t=new hC(r);let n,o=Fc(t),i=So(void 0);try{return e()}finally{Fc(o),So(i)}}function sO(){return XN()!==void 0||VS()!=null}var zs=0,at=1,ot=2,vn=3,os=4,is=5,a1=6,jh=7,no=8,zd=9,Ha=10,Dr=11,Hh=12,VC=13,qd=14,ss=15,eu=16,Kd=17,$a=18,c1=19,jC=20,$c=21,Rb=22,l1=23,Ci=24,Nb=25,Ao=26,aO=1;var tu=7,u1=8,Gd=9,Do=10;function za(r){return Array.isArray(r)&&typeof r[aO]=="object"}function qs(r){return Array.isArray(r)&&r[aO]===!0}function HC(r){return(r.flags&4)!==0}function ru(r){return r.componentOffset>-1}function Ob(r){return(r.flags&1)===1}function qa(r){return!!r.template}function $h(r){return(r[ot]&512)!==0}function Wd(r){return(r[ot]&256)===256}var cO="svg",lO="math";function as(r){for(;Array.isArray(r);)r=r[zs];return r}function $C(r,e){return as(e[r])}function Ks(r,e){return as(e[r.index])}function Lb(r,e){return r.data[e]}function Fb(r,e){return r[e]}function zC(r,e,t,n){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),e[t]=n}function cs(r,e){let t=e[r];return za(t)?t:t[zs]}function uO(r){return(r[ot]&4)===4}function Bb(r){return(r[ot]&128)===128}function dO(r){return qs(r[vn])}function d1(r,e){return e==null?null:r[e]}function qC(r){r[Kd]=0}function KC(r){r[ot]&1024||(r[ot]|=1024,Bb(r)&&p1(r))}function fO(r,e){for(;r>0;)e=e[qd],r--;return e}function f1(r){return!!(r[ot]&9216||r[Ci]?.dirty)}function Ub(r){r[Ha].changeDetectionScheduler?.notify(8),r[ot]&64&&(r[ot]|=1024),f1(r)&&p1(r)}function p1(r){r[Ha].changeDetectionScheduler?.notify(0);let e=Yl(r);for(;e!==null&&!(e[ot]&8192||(e[ot]|=8192,!Bb(e)));)e=Yl(e)}function GC(r,e){if(Wd(r))throw new be(911,!1);r[$c]===null&&(r[$c]=[]),r[$c].push(e)}function pO(r,e){if(r[$c]===null)return;let t=r[$c].indexOf(e);t!==-1&&r[$c].splice(t,1)}function Yl(r){let e=r[vn];return qs(e)?e[vn]:e}function WC(r){return r[jh]??=[]}function YC(r){return r.cleanup??=[]}function hO(r,e,t,n){let o=WC(e);o.push(t),r.firstCreatePass&&YC(r).push(n,o.length-1)}var ft={lFrame:MO(null),bindingsEnabled:!0,skipHydrationRootTNode:null},h1=function(r){return r[r.Off=0]="Off",r[r.Exhaustive=1]="Exhaustive",r[r.OnlyDirtyViews=2]="OnlyDirtyViews",r}(h1||{}),Rre=0,vC=!1;function mO(){return ft.lFrame.elementDepthCount}function gO(){ft.lFrame.elementDepthCount++}function yO(){ft.lFrame.elementDepthCount--}function XC(){return ft.bindingsEnabled}function vO(){return ft.skipHydrationRootTNode!==null}function wO(r){return ft.skipHydrationRootTNode===r}function bO(){ft.skipHydrationRootTNode=null}function wt(){return ft.lFrame.lView}function bn(){return ft.lFrame.tView}function Re(r){return ft.lFrame.contextLView=r,r[no]}function Ne(r){return ft.lFrame.contextLView=null,r}function oo(){let r=QC();for(;r!==null&&r.type===64;)r=r.parent;return r}function QC(){return ft.lFrame.currentTNode}function xO(){let r=ft.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}function zh(r,e){let t=ft.lFrame;t.currentTNode=r,t.isParent=e}function ZC(){return ft.lFrame.isParent}function EO(){ft.lFrame.isParent=!1}function _O(){return ft.lFrame.contextLView}function JC(r){WN("Must never be called in production mode"),Rre=r}function e7(){return vC}function t7(r){let e=vC;return vC=r,e}function m1(){let r=ft.lFrame,e=r.bindingRootIndex;return e===-1&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}function SO(){return ft.lFrame.bindingIndex}function CO(r){return ft.lFrame.bindingIndex=r}function qh(){return ft.lFrame.bindingIndex++}function Vb(r){let e=ft.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}function IO(){return ft.lFrame.inI18n}function AO(r,e){let t=ft.lFrame;t.bindingIndex=t.bindingRootIndex=r,jb(e)}function DO(){return ft.lFrame.currentDirectiveIndex}function jb(r){ft.lFrame.currentDirectiveIndex=r}function TO(r){let e=ft.lFrame.currentDirectiveIndex;return e===-1?null:r[e]}function r7(){return ft.lFrame.currentQueryIndex}function Hb(r){ft.lFrame.currentQueryIndex=r}function Nre(r){let e=r[at];return e.type===2?e.declTNode:e.type===1?r[is]:null}function n7(r,e,t){if(t&4){let o=e,i=r;for(;o=o.parent,o===null&&!(t&1);)if(o=Nre(i),o===null||(i=i[qd],o.type&10))break;if(o===null)return!1;e=o,r=i}let n=ft.lFrame=PO();return n.currentTNode=e,n.lView=r,!0}function $b(r){let e=PO(),t=r[at];ft.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function PO(){let r=ft.lFrame,e=r===null?null:r.child;return e===null?MO(r):e}function MO(r){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return r!==null&&(r.child=e),e}function kO(){let r=ft.lFrame;return ft.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}var o7=kO;function zb(){let r=kO();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function RO(r){return(ft.lFrame.contextLView=fO(r,ft.lFrame.contextLView))[no]}function Gc(){return ft.lFrame.selectedIndex}function nu(r){ft.lFrame.selectedIndex=r}function qb(){let r=ft.lFrame;return Lb(r.tView,r.selectedIndex)}function NO(){return ft.lFrame.currentNamespace}var OO=!0;function Kb(){return OO}function Gb(r){OO=r}function wC(r,e=null,t=null,n){let o=i7(r,e,t,n);return o.resolveInjectorInitializers(),o}function i7(r,e=null,t=null,n,o=new Set){let i=[t||Co,rO(r)];return n=n||(typeof r=="object"?void 0:Go(r)),new Hd(i,e||s1(),n||null,o)}var ns=class r{static THROW_IF_NOT_FOUND=Ud;static NULL=new r1;static create(e,t){if(Array.isArray(e))return wC({name:""},t,e,"");{let n=e.name??"";return wC({name:n},e.parent,e.providers,n)}}static \u0275prov=he({token:r,providedIn:"any",factory:()=>xe(RC)});static __NG_ELEMENT_ID__=-1},Gr=new De(""),ou=(()=>{class r{static __NG_ELEMENT_ID__=Ore;static __NG_ENV_ID__=t=>t}return r})(),bC=class extends ou{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Wd(this._lView)}onDestroy(e){let t=this._lView;return GC(t,e),()=>pO(t,e)}};function Ore(){return new bC(wt())}var ja=class{_console=console;handleError(e){this._console.error("ERROR",e)}},To=new De("",{providedIn:"root",factory:()=>{let r=ie(Kr),e;return t=>{r.destroyed&&!e?setTimeout(()=>{throw t}):(e??=r.get(ja),e.handleError(t))}}}),LO={provide:qc,useValue:()=>void ie(ja),multi:!0},Lre=new De("",{providedIn:"root",factory:()=>{let r=ie(Gr).defaultView;if(!r)return;let e=ie(To),t=i=>{e(i.reason),i.preventDefault()},n=i=>{i.error?e(i.error):e(new Error(i.message,{cause:i})),i.preventDefault()},o=()=>{r.addEventListener("unhandledrejection",t),r.addEventListener("error",n)};typeof Zone<"u"?Zone.root.run(o):o(),ie(ou).onDestroy(()=>{r.removeEventListener("error",n),r.removeEventListener("unhandledrejection",t)})}});function s7(){return Kc([tO(()=>void ie(Lre))])}function a7(r){return typeof r=="function"&&r[eo]!==void 0}function Wc(r,e){let[t,n,o]=qS(r,e?.equal),i=t,s=i[eo];return i.set=n,i.update=o,i.asReadonly=FO.bind(i),i}function FO(){let r=this[eo];if(r.readonlyFn===void 0){let e=()=>this();e[eo]=r,r.readonlyFn=e}return r.readonlyFn}function c7(r){return a7(r)&&typeof r.set=="function"}var Xl=class{},g1=new De("",{providedIn:"root",factory:()=>!1});var l7=new De(""),u7=new De("");var Yc=(()=>{class r{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new un(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new ht(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=he({token:r,providedIn:"root",factory:()=>new r})}return r})(),Wb=(()=>{class r{internalPendingTasks=ie(Yc);scheduler=ie(Xl);errorHandler=ie(To);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let n=this.add();t().catch(this.errorHandler).finally(n)}static \u0275prov=he({token:r,providedIn:"root",factory:()=>new r})}return r})();function y1(...r){}var d7=(()=>{class r{static \u0275prov=he({token:r,providedIn:"root",factory:()=>new xC})}return r})(),xC=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,n=this.queues.get(t);n.has(e)&&(n.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let n=this.queues.get(t);n.has(e)||n.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,n]of this.queues)t===null?e||=this.flushQueue(n):e||=t.run(()=>this.flushQueue(n));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let n of e)n.dirty&&(this.dirtyEffectCount--,t=!0,n.run());return t}};function Xh(r){return{toString:r}.toString()}var Yb="__parameters__";function qre(r){return function(...t){if(r){let n=r(...t);for(let o in n)this[o]=n[o]}}}function hL(r,e,t){return Xh(()=>{let n=qre(e);function o(...i){if(this instanceof o)return n.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(c,l,u){let d=c.hasOwnProperty(Yb)?c[Yb]:Object.defineProperty(c,Yb,{value:[]})[Yb];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),c}}return o.prototype.ngMetadataName=r,o.annotationCls=o,o})}var mL=MC(hL("Optional"),8);var gL=MC(hL("SkipSelf"),4);function Kre(r){return typeof r=="function"}var r3=class{previousValue;currentValue;firstChange;constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}};function yL(r,e,t,n){e!==null?e.applyValueToInputSignal(e,n):r[t]=n}var ls=(()=>{let r=()=>vL;return r.ngInherit=!0,r})();function vL(r){return r.type.prototype.ngOnChanges&&(r.setInput=Wre),Gre}function Gre(){let r=bL(this),e=r?.current;if(e){let t=r.previous;if(t===Zl)r.previous=e;else for(let n in e)t[n]=e[n];r.current=null,this.ngOnChanges(e)}}function Wre(r,e,t,n,o){let i=this.declaredInputs[n],s=bL(r)||Yre(r,{previous:Zl,current:null}),a=s.current||(s.current={}),c=s.previous,l=c[i];a[i]=new r3(l&&l.currentValue,t,c===Zl),yL(r,e,o,t)}var wL="__ngSimpleChanges__";function bL(r){return r[wL]||null}function Yre(r,e){return r[wL]=e}var BO=[];var Xt=function(r,e=null,t){for(let n=0;n<BO.length;n++){let o=BO[n];o(r,e,t)}};function Xre(r,e,t){let{ngOnChanges:n,ngOnInit:o,ngDoCheck:i}=e.type.prototype;if(n){let s=vL(e);(t.preOrderHooks??=[]).push(r,s),(t.preOrderCheckHooks??=[]).push(r,s)}o&&(t.preOrderHooks??=[]).push(0-r,o),i&&((t.preOrderHooks??=[]).push(r,i),(t.preOrderCheckHooks??=[]).push(r,i))}function xL(r,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){let i=r.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=i;s&&(r.contentHooks??=[]).push(-t,s),a&&((r.contentHooks??=[]).push(t,a),(r.contentCheckHooks??=[]).push(t,a)),c&&(r.viewHooks??=[]).push(-t,c),l&&((r.viewHooks??=[]).push(t,l),(r.viewCheckHooks??=[]).push(t,l)),u!=null&&(r.destroyHooks??=[]).push(t,u)}}function Zb(r,e,t){EL(r,e,3,t)}function Jb(r,e,t,n){(r[ot]&3)===t&&EL(r,e,t,n)}function f7(r,e){let t=r[ot];(t&3)===e&&(t&=16383,t+=1,r[ot]=t)}function EL(r,e,t,n){let o=n!==void 0?r[Kd]&65535:0,i=n??-1,s=e.length-1,a=0;for(let c=o;c<s;c++)if(typeof e[c+1]=="number"){if(a=e[c],n!=null&&a>=n)break}else e[c]<0&&(r[Kd]+=65536),(a<i||i==-1)&&(Qre(r,t,e,c),r[Kd]=(r[Kd]&4294901760)+c+2),c++}function UO(r,e){Xt(4,r,e);let t=lt(null);try{e.call(r)}finally{lt(t),Xt(5,r,e)}}function Qre(r,e,t,n){let o=t[n]<0,i=t[n+1],s=o?-t[n]:t[n],a=r[s];o?r[ot]>>14<r[Kd]>>16&&(r[ot]&3)===e&&(r[ot]+=16384,UO(a,i)):UO(a,i)}var Gh=-1,Qd=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,n){this.factory=e,this.canSeeViewProviders=t,this.injectImpl=n}};function Zre(r){return(r.flags&8)!==0}function Jre(r){return(r.flags&16)!==0}function ene(r,e,t){let n=0;for(;n<t.length;){let o=t[n];if(typeof o=="number"){if(o!==0)break;n++;let i=t[n++],s=t[n++],a=t[n++];r.setAttribute(e,s,a,i)}else{let i=o,s=t[++n];tne(i)?r.setProperty(e,i,s):r.setAttribute(e,i,s),n++}}return n}function _L(r){return r===3||r===4||r===6}function tne(r){return r.charCodeAt(0)===64}function b1(r,e){if(!(e===null||e.length===0))if(r===null||r.length===0)r=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){let o=e[n];typeof o=="number"?t=o:t===0||(t===-1||t===2?VO(r,t,o,null,e[++n]):VO(r,t,o,null,null))}}return r}function VO(r,e,t,n,o){let i=0,s=r.length;if(e===-1)s=-1;else for(;i<r.length;){let a=r[i++];if(typeof a=="number"){if(a===e){s=-1;break}else if(a>e){s=i-1;break}}}for(;i<r.length;){let a=r[i];if(typeof a=="number")break;if(a===t){o!==null&&(r[i+1]=o);return}i++,o!==null&&i++}s!==-1&&(r.splice(s,0,e),i=s+1),r.splice(i++,0,t),o!==null&&r.splice(i++,0,o)}function SL(r){return r!==Gh}function n3(r){return r&32767}function rne(r){return r>>16}function o3(r,e){let t=rne(r),n=e;for(;t>0;)n=n[qd],t--;return n}var _7=!0;function i3(r){let e=_7;return _7=r,e}var nne=256,CL=nne-1,IL=5,one=0,Ka={};function ine(r,e,t){let n;typeof t=="string"?n=t.charCodeAt(0)||0:t.hasOwnProperty($d)&&(n=t[$d]),n==null&&(n=t[$d]=one++);let o=n&CL,i=1<<o;e.data[r+(o>>IL)]|=i}function s3(r,e){let t=AL(r,e);if(t!==-1)return t;let n=e[at];n.firstCreatePass&&(r.injectorIndex=e.length,p7(n.data,r),p7(e,null),p7(n.blueprint,null));let o=Y7(r,e),i=r.injectorIndex;if(SL(o)){let s=n3(o),a=o3(o,e),c=a[at].data;for(let l=0;l<8;l++)e[i+l]=a[s+l]|c[s+l]}return e[i+8]=o,i}function p7(r,e){r.push(0,0,0,0,0,0,0,0,e)}function AL(r,e){return r.injectorIndex===-1||r.parent&&r.parent.injectorIndex===r.injectorIndex||e[r.injectorIndex+8]===null?-1:r.injectorIndex}function Y7(r,e){if(r.parent&&r.parent.injectorIndex!==-1)return r.parent.injectorIndex;let t=0,n=null,o=e;for(;o!==null;){if(n=kL(o),n===null)return Gh;if(t++,o=o[qd],n.injectorIndex!==-1)return n.injectorIndex|t<<16}return Gh}function S7(r,e,t){ine(r,e,t)}function sne(r,e){if(e==="class")return r.classes;if(e==="style")return r.styles;let t=r.attrs;if(t){let n=t.length,o=0;for(;o<n;){let i=t[o];if(_L(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<n&&typeof t[o]=="string";)o++;else{if(i===e)return t[o+1];o=o+2}}}return null}function DL(r,e,t){if(t&8||r!==void 0)return r;Tb(e,"NodeInjector")}function TL(r,e,t,n){if(t&8&&n===void 0&&(n=null),(t&3)===0){let o=r[zd],i=So(void 0);try{return o?o.get(e,n,t&8):PC(e,n,t&8)}finally{So(i)}}return DL(n,e,t)}function PL(r,e,t,n=0,o){if(r!==null){if(e[ot]&2048&&!(n&2)){let s=une(r,e,t,n,Ka);if(s!==Ka)return s}let i=ML(r,e,t,n,Ka);if(i!==Ka)return i}return TL(e,t,n,o)}function ML(r,e,t,n,o){let i=cne(t);if(typeof i=="function"){if(!n7(e,r,n))return n&1?DL(o,t,n):TL(e,t,n,o);try{let s;if(s=i(n),s==null&&!(n&8))Tb(t);else return s}finally{o7()}}else if(typeof i=="number"){let s=null,a=AL(r,e),c=Gh,l=n&1?e[ss][is]:null;for((a===-1||n&4)&&(c=a===-1?Y7(r,e):e[a+8],c===Gh||!HO(n,!1)?a=-1:(s=e[at],a=n3(c),e=o3(c,e)));a!==-1;){let u=e[at];if(jO(i,a,u.data)){let d=ane(a,e,t,s,n,l);if(d!==Ka)return d}c=e[a+8],c!==Gh&&HO(n,e[at].data[a+8]===l)&&jO(i,a,e)?(s=u,a=n3(c),e=o3(c,e)):a=-1}}return o}function ane(r,e,t,n,o,i){let s=e[at],a=s.data[r+8],c=n==null?ru(a)&&_7:n!=s&&(a.type&3)!==0,l=o&1&&i===a,u=e3(a,s,t,c,l);return u!==null?x1(e,s,u,a):Ka}function e3(r,e,t,n,o){let i=r.providerIndexes,s=e.data,a=i&1048575,c=r.directiveStart,l=r.directiveEnd,u=i>>20,d=n?a:a+u,h=o?a+u:l;for(let p=d;p<h;p++){let m=s[p];if(p<c&&t===m||p>=c&&m.type===t)return p}if(o){let p=s[c];if(p&&qa(p)&&p.type===t)return c}return null}function x1(r,e,t,n){let o=r[t],i=e.data;if(o instanceof Qd){let s=o;s.resolving&&TC(YN(i[t]));let a=i3(s.canSeeViewProviders);s.resolving=!0;let c=i[t].type||i[t],l,u=s.injectImpl?So(s.injectImpl):null,d=n7(r,n,0);try{o=r[t]=s.factory(void 0,i,r,n),e.firstCreatePass&&t>=n.directiveStart&&Xre(t,i[t],e)}finally{u!==null&&So(u),i3(a),s.resolving=!1,o7()}}return o}function cne(r){if(typeof r=="string")return r.charCodeAt(0)||0;let e=r.hasOwnProperty($d)?r[$d]:void 0;return typeof e=="number"?e>=0?e&CL:lne:e}function jO(r,e,t){let n=1<<r;return!!(t[e+(r>>IL)]&n)}function HO(r,e){return!(r&2)&&!(r&1&&e)}var Xd=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return PL(this._tNode,this._lView,e,Vd(n),t)}};function lne(){return new Xd(oo(),wt())}function Ii(r){return Xh(()=>{let e=r.prototype.constructor,t=e[t1]||C7(e),n=Object.prototype,o=Object.getPrototypeOf(r.prototype).constructor;for(;o&&o!==n;){let i=o[t1]||C7(o);if(i&&i!==t)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function C7(r){return EC(r)?()=>{let e=C7(kn(r));return e&&e()}:Wl(r)}function une(r,e,t,n,o){let i=r,s=e;for(;i!==null&&s!==null&&s[ot]&2048&&!$h(s);){let a=ML(i,s,t,n|2,Ka);if(a!==Ka)return a;let c=i.parent;if(!c){let l=s[jC];if(l){let u=l.get(t,Ka,n);if(u!==Ka)return u}c=kL(s),s=s[qd]}i=c}return o}function kL(r){let e=r[at],t=e.type;return t===2?e.declTNode:t===1?r[is]:null}function C1(r){return sne(oo(),r)}function dne(){return Qh(oo(),wt())}function Qh(r,e){return new io(Ks(r,e))}var io=(()=>{class r{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=dne}return r})();function fne(r){return r instanceof io?r.nativeElement:r}function pne(){return this._results[Symbol.iterator]()}var a3=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new qt}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let n=ZN(e);(this._changesDetected=!QN(this._results,n,t))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=pne};function RL(r){return(r.flags&128)===128}var X7=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(X7||{}),NL=new Map,hne=0;function mne(){return hne++}function gne(r){NL.set(r[c1],r)}function I7(r){NL.delete(r[c1])}var $O="__ngContext__";function I1(r,e){za(e)?(r[$O]=e[c1],gne(e)):r[$O]=e}function OL(r){return FL(r[Hh])}function LL(r){return FL(r[os])}function FL(r){for(;r!==null&&!qs(r);)r=r[os];return r}var A7;function Q7(r){A7=r}function BL(){if(A7!==void 0)return A7;if(typeof document<"u")return document;throw new be(210,!1)}var v3=new De("",{providedIn:"root",factory:()=>yne}),yne="ng",w3=new De(""),Zh=new De("",{providedIn:"platform",factory:()=>"unknown"});var b3=new De("",{providedIn:"root",factory:()=>BL().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var vne="h",wne="b";var UL=!1,VL=new De("",{providedIn:"root",factory:()=>UL});var bne=(r,e,t,n)=>{};function xne(r,e,t,n){bne(r,e,t,n)}var Ene=()=>null;function jL(r,e,t=!1){return Ene(r,e,t)}function HL(r,e){let t=r.contentQueries;if(t!==null){let n=lt(null);try{for(let o=0;o<t.length;o+=2){let i=t[o],s=t[o+1];if(s!==-1){let a=r.data[s];Hb(i),a.contentQueries(2,e[s],s)}}}finally{lt(n)}}}function D7(r,e,t){Hb(0);let n=lt(null);try{e(r,t)}finally{lt(n)}}function $L(r,e,t){if(HC(e)){let n=lt(null);try{let o=e.directiveStart,i=e.directiveEnd;for(let s=o;s<i;s++){let a=r.data[s];if(a.contentQueries){let c=t[s];a.contentQueries(1,c,s)}}}finally{lt(n)}}}var Xc=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Xc||{});var Xb;function _ne(){if(Xb===void 0&&(Xb=null,zc.trustedTypes))try{Xb=zc.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Xb}function zO(r){return _ne()?.createScriptURL(r)||r}var c3=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Cb})`}};function A1(r){return r instanceof c3?r.changingThisBreaksApplicationSecurity:r}function Z7(r,e){let t=zL(r);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${Cb})`)}return t===e}function zL(r){return r instanceof c3&&r.getTypeName()||null}var Sne=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function qL(r){return r=String(r),r.match(Sne)?r:"unsafe:"+r}var x3=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(x3||{});function au(r){let e=GL();return e?e.sanitize(x3.URL,r)||"":Z7(r,"URL")?A1(r):qL(Ql(r))}function KL(r){let e=GL();if(e)return zO(e.sanitize(x3.RESOURCE_URL,r)||"");if(Z7(r,"ResourceURL"))return zO(A1(r));throw new be(904,!1)}function Cne(r,e){return e==="src"&&(r==="embed"||r==="frame"||r==="iframe"||r==="media"||r==="script")||e==="href"&&(r==="base"||r==="link")?KL:au}function J7(r,e,t){return Cne(e,t)(r)}function GL(){let r=wt();return r&&r[Ha].sanitizer}function WL(r){return r instanceof Function?r():r}function Ine(r,e,t){let n=r.length;for(;;){let o=r.indexOf(e,t);if(o===-1)return o;if(o===0||r.charCodeAt(o-1)<=32){let i=e.length;if(o+i===n||r.charCodeAt(o+i)<=32)return o}t=o+1}}var YL="ng-template";function Ane(r,e,t,n){let o=0;if(n){for(;o<e.length&&typeof e[o]=="string";o+=2)if(e[o]==="class"&&Ine(e[o+1].toLowerCase(),t,0)!==-1)return!0}else if(eI(r))return!1;if(o=e.indexOf(1,o),o>-1){let i;for(;++o<e.length&&typeof(i=e[o])=="string";)if(i.toLowerCase()===t)return!0}return!1}function eI(r){return r.type===4&&r.value!==YL}function Dne(r,e,t){let n=r.type===4&&!t?YL:r.value;return e===n}function Tne(r,e,t){let n=4,o=r.attrs,i=o!==null?kne(o):0,s=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!s&&!Gs(n)&&!Gs(c))return!1;if(s&&Gs(c))continue;s=!1,n=c|n&1;continue}if(!s)if(n&4){if(n=2|n&1,c!==""&&!Dne(r,c,t)||c===""&&e.length===1){if(Gs(n))return!1;s=!0}}else if(n&8){if(o===null||!Ane(r,o,c,t)){if(Gs(n))return!1;s=!0}}else{let l=e[++a],u=Pne(c,o,eI(r),t);if(u===-1){if(Gs(n))return!1;s=!0;continue}if(l!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),n&2&&l!==d){if(Gs(n))return!1;s=!0}}}}return Gs(n)||s}function Gs(r){return(r&1)===0}function Pne(r,e,t,n){if(e===null)return-1;let o=0;if(n||!t){let i=!1;for(;o<e.length;){let s=e[o];if(s===r)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=e[++o];for(;typeof a=="string";)a=e[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return Rne(e,r)}function Mne(r,e,t=!1){for(let n=0;n<e.length;n++)if(Tne(r,e[n],t))return!0;return!1}function kne(r){for(let e=0;e<r.length;e++){let t=r[e];if(_L(t))return e}return r.length}function Rne(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){let n=r[t];if(typeof n=="number")return-1;if(n===e)return t;t++}return-1}function qO(r,e){return r?":not("+e.trim()+")":e}function Nne(r){let e=r[0],t=1,n=2,o="",i=!1;for(;t<r.length;){let s=r[t];if(typeof s=="string")if(n&2){let a=r[++t];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else n&8?o+="."+s:n&4&&(o+=" "+s);else o!==""&&!Gs(s)&&(e+=qO(i,o),o=""),n=s,i=i||!Gs(n);t++}return o!==""&&(e+=qO(i,o)),e}function One(r){return r.map(Nne).join(",")}function Lne(r){let e=[],t=[],n=1,o=2;for(;n<r.length;){let i=r[n];if(typeof i=="string")o===2?i!==""&&e.push(i,r[++n]):o===8&&t.push(i);else{if(!Gs(o))break;o=i}n++}return t.length&&e.push(1,...t),e}var Po={};function Fne(r,e){return r.createText(e)}function Bne(r,e,t){r.setValue(e,t)}function XL(r,e,t){return r.createElement(e,t)}function l3(r,e,t,n,o){r.insertBefore(e,t,n,o)}function QL(r,e,t){r.appendChild(e,t)}function KO(r,e,t,n,o){n!==null?l3(r,e,t,n,o):QL(r,e,t)}function Une(r,e,t){r.removeChild(null,e,t)}function Vne(r,e,t){r.setAttribute(e,"style",t)}function jne(r,e,t){t===""?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t)}function ZL(r,e,t){let{mergedAttrs:n,classes:o,styles:i}=t;n!==null&&ene(r,e,n),o!==null&&jne(r,e,o),i!==null&&Vne(r,e,i)}function tI(r,e,t,n,o,i,s,a,c,l,u){let d=Ao+n,h=d+o,p=Hne(d,h),m=typeof l=="function"?l():l;return p[at]={type:r,blueprint:p,template:t,queries:null,viewQuery:a,declTNode:e,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:c,consts:m,incompleteFirstPass:!1,ssrId:u}}function Hne(r,e){let t=[];for(let n=0;n<e;n++)t.push(n<r?null:Po);return t}function $ne(r){let e=r.tView;return e===null||e.incompleteFirstPass?r.tView=tI(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):e}function rI(r,e,t,n,o,i,s,a,c,l,u){let d=e.blueprint.slice();return d[zs]=o,d[ot]=n|4|128|8|64|1024,(l!==null||r&&r[ot]&2048)&&(d[ot]|=2048),qC(d),d[vn]=d[qd]=r,d[no]=t,d[Ha]=s||r&&r[Ha],d[Dr]=a||r&&r[Dr],d[zd]=c||r&&r[zd]||null,d[is]=i,d[c1]=mne(),d[a1]=u,d[jC]=l,d[ss]=e.type==2?r[ss]:d,d}function zne(r,e,t){let n=Ks(e,r),o=$ne(t),i=r[Ha].rendererFactory,s=nI(r,rI(r,o,null,JL(t),n,e,null,i.createRenderer(n,t),null,null,null));return r[e.index]=s}function JL(r){let e=16;return r.signals?e=4096:r.onPush&&(e=64),e}function eF(r,e,t,n){if(t===0)return-1;let o=e.length;for(let i=0;i<t;i++)e.push(n),r.blueprint.push(n),r.data.push(null);return o}function nI(r,e){return r[Hh]?r[VC][os]=e:r[Hh]=e,r[VC]=e,e}function D(r=1){tF(bn(),wt(),Gc()+r,!1)}function tF(r,e,t,n){if(!n)if((e[ot]&3)===3){let i=r.preOrderCheckHooks;i!==null&&Zb(e,i,t)}else{let i=r.preOrderHooks;i!==null&&Jb(e,i,0,t)}nu(t)}var E3=function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r}(E3||{});function T7(r,e,t,n){let o=lt(null);try{let[i,s,a]=r.inputs[t],c=null;(s&E3.SignalBased)!==0&&(c=e[i][eo]),c!==null&&c.transformFn!==void 0?n=c.transformFn(n):a!==null&&(n=a.call(e,n)),r.setInput!==null?r.setInput(e,c,n,t,i):yL(e,c,i,n)}finally{lt(o)}}function rF(r,e,t,n,o){let i=Gc(),s=n&2;try{nu(-1),s&&e.length>Ao&&tF(r,e,Ao,!1),Xt(s?2:0,o,t),t(n,o)}finally{nu(i),Xt(s?3:1,o,t)}}function oI(r,e,t){Qne(r,e,t),(t.flags&64)===64&&Zne(r,e,t)}function nF(r,e,t=Ks){let n=e.localNames;if(n!==null){let o=e.index+1;for(let i=0;i<n.length;i+=2){let s=n[i+1],a=s===-1?t(e,r):r[s];r[o++]=a}}}function qne(r,e,t,n){let i=n.get(VL,UL)||t===Xc.ShadowDom,s=r.selectRootElement(e,i);return Kne(s),s}function Kne(r){Gne(r)}var Gne=()=>null;function Wne(r){return r==="class"?"className":r==="for"?"htmlFor":r==="formaction"?"formAction":r==="innerHtml"?"innerHTML":r==="readonly"?"readOnly":r==="tabindex"?"tabIndex":r}function oF(r,e,t,n,o,i){let s=e[at];if(iI(r,s,e,t,n)){ru(r)&&Xne(e,r.index);return}Yne(r,e,t,n,o,i)}function Yne(r,e,t,n,o,i){if(r.type&3){let s=Ks(r,e);t=Wne(t),n=i!=null?i(n,r.value||"",t):n,o.setProperty(s,t,n)}else r.type&12}function Xne(r,e){let t=cs(e,r);t[ot]&16||(t[ot]|=64)}function Qne(r,e,t){let n=t.directiveStart,o=t.directiveEnd;ru(t)&&zne(e,t,r.data[n+t.componentOffset]),r.firstCreatePass||s3(t,e);let i=t.initialInputs;for(let s=n;s<o;s++){let a=r.data[s],c=x1(e,r,s,t);if(I1(c,e),i!==null&&roe(e,s-n,c,a,t,i),qa(a)){let l=cs(t.index,e);l[no]=x1(e,r,s,t)}}}function Zne(r,e,t){let n=t.directiveStart,o=t.directiveEnd,i=t.index,s=DO();try{nu(i);for(let a=n;a<o;a++){let c=r.data[a],l=e[a];jb(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&Jne(c,l)}}finally{nu(-1),jb(s)}}function Jne(r,e){r.hostBindings!==null&&r.hostBindings(1,e)}function iF(r,e){let t=r.directiveRegistry,n=null;if(t)for(let o=0;o<t.length;o++){let i=t[o];Mne(e,i.selectors,!1)&&(n??=[],qa(i)?n.unshift(i):n.push(i))}return n}function eoe(r,e,t,n,o,i){let s=Ks(r,e);toe(e[Dr],s,i,r.value,t,n,o)}function toe(r,e,t,n,o,i,s){if(i==null)r.removeAttribute(e,o,t);else{let a=s==null?Ql(i):s(i,n||"",o);r.setAttribute(e,o,a,t)}}function roe(r,e,t,n,o,i){let s=i[e];if(s!==null)for(let a=0;a<s.length;a+=2){let c=s[a],l=s[a+1];T7(n,t,c,l)}}function noe(r,e){let t=r[zd];if(!t)return;t.get(To,null)?.(e)}function iI(r,e,t,n,o){let i=r.inputs?.[n],s=r.hostDirectiveInputs?.[n],a=!1;if(s)for(let c=0;c<s.length;c+=2){let l=s[c],u=s[c+1],d=e.data[l];T7(d,t[l],u,o),a=!0}if(i)for(let c of i){let l=t[c],u=e.data[c];T7(u,l,n,o),a=!0}return a}function ooe(r,e){let t=cs(e,r),n=t[at];ioe(n,t);let o=t[zs];o!==null&&t[a1]===null&&(t[a1]=jL(o,t[zd])),Xt(18),sI(n,t,t[no]),Xt(19,t[no])}function ioe(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])}function sI(r,e,t){$b(e);try{let n=r.viewQuery;n!==null&&D7(1,n,t);let o=r.template;o!==null&&rF(r,e,o,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),e[$a]?.finishViewCreation(r),r.staticContentQueries&&HL(r,e),r.staticViewQueries&&D7(2,r.viewQuery,t);let i=r.components;i!==null&&soe(e,i)}catch(n){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),n}finally{e[ot]&=-5,zb()}}function soe(r,e){for(let t=0;t<e.length;t++)ooe(r,e[t])}function aoe(r,e,t,n){let o=lt(null);try{let i=e.tView,a=r[ot]&4096?4096:16,c=rI(r,i,t,a,null,e,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null),l=r[e.index];c[eu]=l;let u=r[$a];return u!==null&&(c[$a]=u.createEmbeddedView(i)),sI(i,c,t),c}finally{lt(o)}}function GO(r,e){return!e||e.firstChild===null||RL(r)}var WO=!1,coe=new De(""),loe;function aI(r,e){return loe(r,e)}var Ga=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(Ga||{});function cI(r){return(r.flags&32)===32}function Kh(r,e,t,n,o){if(n!=null){let i,s=!1;qs(n)?i=n:za(n)&&(s=!0,n=n[zs]);let a=as(n);r===0&&t!==null?o==null?QL(e,t,a):l3(e,t,a,o||null,!0):r===1&&t!==null?l3(e,t,a,o||null,!0):r===2?Une(e,a,s):r===3&&e.destroyNode(a),i!=null&&xoe(e,r,i,t,o)}}function uoe(r,e){sF(r,e),e[zs]=null,e[is]=null}function doe(r,e,t,n,o,i){n[zs]=o,n[is]=e,_3(r,n,t,1,o,i)}function sF(r,e){e[Ha].changeDetectionScheduler?.notify(9),_3(r,e,e[Dr],2,null,null)}function foe(r){let e=r[Hh];if(!e)return h7(r[at],r);for(;e;){let t=null;if(za(e))t=e[Hh];else{let n=e[Do];n&&(t=n)}if(!t){for(;e&&!e[os]&&e!==r;)za(e)&&h7(e[at],e),e=e[vn];e===null&&(e=r),za(e)&&h7(e[at],e),t=e&&e[os]}e=t}}function lI(r,e){let t=r[Gd],n=t.indexOf(e);t.splice(n,1)}function aF(r,e){if(Wd(e))return;let t=e[Dr];t.destroyNode&&_3(r,e,t,3,null,null),foe(e)}function h7(r,e){if(Wd(e))return;let t=lt(null);try{e[ot]&=-129,e[ot]|=256,e[Ci]&&jw(e[Ci]),hoe(r,e),poe(r,e),e[at].type===1&&e[Dr].destroy();let n=e[eu];if(n!==null&&qs(e[vn])){n!==e[vn]&&lI(n,e);let o=e[$a];o!==null&&o.detachView(r)}I7(e)}finally{lt(t)}}function poe(r,e){let t=r.cleanup,n=e[jh];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let a=t[s+3];a>=0?n[a]():n[-a].unsubscribe(),s+=2}else{let a=n[t[s+1]];t[s].call(a)}n!==null&&(e[jh]=null);let o=e[$c];if(o!==null){e[$c]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=e[l1];if(i!==null){e[l1]=null;for(let s of i)s.destroy()}}function hoe(r,e){let t;if(r!=null&&(t=r.destroyHooks)!=null)for(let n=0;n<t.length;n+=2){let o=e[t[n]];if(!(o instanceof Qd)){let i=t[n+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],c=i[s+1];Xt(4,a,c);try{c.call(a)}finally{Xt(5,a,c)}}else{Xt(4,o,i);try{i.call(o)}finally{Xt(5,o,i)}}}}}function moe(r,e,t){return goe(r,e.parent,t)}function goe(r,e,t){let n=e;for(;n!==null&&n.type&168;)e=n,n=e.parent;if(n===null)return t[zs];if(ru(n)){let{encapsulation:o}=r.data[n.directiveStart+n.componentOffset];if(o===Xc.None||o===Xc.Emulated)return null}return Ks(n,t)}function yoe(r,e,t){return woe(r,e,t)}function voe(r,e,t){return r.type&40?Ks(r,t):null}var woe=voe,YO;function uI(r,e,t,n){let o=moe(r,n,e),i=e[Dr],s=n.parent||e[is],a=yoe(s,n,e);if(o!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)KO(i,o,t[c],a,!1);else KO(i,o,t,a,!1);YO!==void 0&&YO(i,n,e,t,o)}function v1(r,e){if(e!==null){let t=e.type;if(t&3)return Ks(e,r);if(t&4)return P7(-1,r[e.index]);if(t&8){let n=e.child;if(n!==null)return v1(r,n);{let o=r[e.index];return qs(o)?P7(-1,o):as(o)}}else{if(t&128)return v1(r,e.next);if(t&32)return aI(e,r)()||as(r[e.index]);{let n=cF(r,e);if(n!==null){if(Array.isArray(n))return n[0];let o=Yl(r[ss]);return v1(o,n)}else return v1(r,e.next)}}}return null}function cF(r,e){if(e!==null){let n=r[ss][is],o=e.projection;return n.projection[o]}return null}function P7(r,e){let t=Do+r+1;if(t<e.length){let n=e[t],o=n[at].firstChild;if(o!==null)return v1(n,o)}return e[tu]}function dI(r,e,t,n,o,i,s){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=n[t.index],c=t.type;if(s&&e===0&&(a&&I1(as(a),n),t.flags|=2),!cI(t))if(c&8)dI(r,e,t.child,n,o,i,!1),Kh(e,r,o,a,i);else if(c&32){let l=aI(t,n),u;for(;u=l();)Kh(e,r,o,u,i);Kh(e,r,o,a,i)}else c&16?boe(r,e,n,t,o,i):Kh(e,r,o,a,i);t=s?t.projectionNext:t.next}}function _3(r,e,t,n,o,i){dI(t,n,r.firstChild,e,o,i,!1)}function boe(r,e,t,n,o,i){let s=t[ss],c=s[is].projection[n.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let u=c[l];Kh(e,r,o,u,i)}else{let l=c,u=s[vn];RL(n)&&(l.flags|=128),dI(r,e,l,u,o,i,!0)}}function xoe(r,e,t,n,o){let i=t[tu],s=as(t);i!==s&&Kh(e,r,n,i,o);for(let a=Do;a<t.length;a++){let c=t[a];_3(c[at],c,r,e,n,i)}}function Eoe(r,e,t,n,o){if(e)o?r.addClass(t,n):r.removeClass(t,n);else{let i=n.indexOf("-")===-1?void 0:Ga.DashCase;o==null?r.removeStyle(t,n,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=Ga.Important),r.setStyle(t,n,o,i))}}function E1(r,e,t,n,o=!1){for(;t!==null;){if(t.type===128){t=o?t.projectionNext:t.next;continue}let i=e[t.index];i!==null&&n.push(as(i)),qs(i)&&lF(i,n);let s=t.type;if(s&8)E1(r,e,t.child,n);else if(s&32){let a=aI(t,e),c;for(;c=a();)n.push(c)}else if(s&16){let a=cF(e,t);if(Array.isArray(a))n.push(...a);else{let c=Yl(e[ss]);E1(c[at],c,a,n,!0)}}t=o?t.projectionNext:t.next}return n}function lF(r,e){for(let t=Do;t<r.length;t++){let n=r[t],o=n[at].firstChild;o!==null&&E1(n[at],n,o,e)}r[tu]!==r[zs]&&e.push(r[tu])}function uF(r){if(r[Nb]!==null){for(let e of r[Nb])e.impl.addSequence(e);r[Nb].length=0}}var dF=[];function _oe(r){return r[Ci]??Soe(r)}function Soe(r){let e=dF.pop()??Object.create(Ioe);return e.lView=r,e}function Coe(r){r.lView[Ci]!==r&&(r.lView=null,dF.push(r))}var Ioe=I(v({},kd),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{p1(r.lView)},consumerOnSignalRead(){this.lView[Ci]=this}});function Aoe(r){let e=r[Ci]??Object.create(Doe);return e.lView=r,e}var Doe=I(v({},kd),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{let e=Yl(r.lView);for(;e&&!fF(e[at]);)e=Yl(e);e&&KC(e)},consumerOnSignalRead(){this.lView[Ci]=this}});function fF(r){return r.type!==2}function pF(r){if(r[l1]===null)return;let e=!0;for(;e;){let t=!1;for(let n of r[l1])n.dirty&&(t=!0,n.zone===null||Zone.current===n.zone?n.run():n.zone.run(()=>n.run()));e=t&&!!(r[ot]&8192)}}var Toe=100;function fI(r,e=0){let n=r[Ha].rendererFactory,o=!1;o||n.begin?.();try{Poe(r,e)}finally{o||n.end?.()}}function Poe(r,e){let t=e7();try{t7(!0),M7(r,e);let n=0;for(;f1(r);){if(n===Toe)throw new be(103,!1);n++,M7(r,1)}}finally{t7(t)}}function hF(r,e){JC(e?h1.Exhaustive:h1.OnlyDirtyViews);try{fI(r)}finally{JC(h1.Off)}}function Moe(r,e,t,n){if(Wd(e))return;let o=e[ot],i=!1,s=!1;$b(e);let a=!0,c=null,l=null;i||(fF(r)?(l=_oe(e),c=Rd(l)):Uw()===null?(a=!1,l=Aoe(e),c=Rd(l)):e[Ci]&&(jw(e[Ci]),e[Ci]=null));try{qC(e),CO(r.bindingStartIndex),t!==null&&rF(r,e,t,2,n);let u=(o&3)===3;if(!i)if(u){let p=r.preOrderCheckHooks;p!==null&&Zb(e,p,null)}else{let p=r.preOrderHooks;p!==null&&Jb(e,p,0,null),f7(e,0)}if(s||koe(e),pF(e),mF(e,0),r.contentQueries!==null&&HL(r,e),!i)if(u){let p=r.contentCheckHooks;p!==null&&Zb(e,p)}else{let p=r.contentHooks;p!==null&&Jb(e,p,1),f7(e,1)}Noe(r,e);let d=r.components;d!==null&&yF(e,d,0);let h=r.viewQuery;if(h!==null&&D7(2,h,n),!i)if(u){let p=r.viewCheckHooks;p!==null&&Zb(e,p)}else{let p=r.viewHooks;p!==null&&Jb(e,p,2),f7(e,2)}if(r.firstUpdatePass===!0&&(r.firstUpdatePass=!1),e[Rb]){for(let p of e[Rb])p();e[Rb]=null}i||(uF(e),e[ot]&=-73)}catch(u){throw i||p1(e),u}finally{l!==null&&(Dh(l,c),a&&Coe(l)),zb()}}function mF(r,e){for(let t=OL(r);t!==null;t=LL(t))for(let n=Do;n<t.length;n++){let o=t[n];gF(o,e)}}function koe(r){for(let e=OL(r);e!==null;e=LL(e)){if(!(e[ot]&2))continue;let t=e[Gd];for(let n=0;n<t.length;n++){let o=t[n];KC(o)}}}function Roe(r,e,t){Xt(18);let n=cs(e,r);gF(n,t),Xt(19,n[no])}function gF(r,e){Bb(r)&&M7(r,e)}function M7(r,e){let n=r[at],o=r[ot],i=r[Ci],s=!!(e===0&&o&16);if(s||=!!(o&64&&e===0),s||=!!(o&1024),s||=!!(i?.dirty&&Y0(i)),s||=!1,i&&(i.dirty=!1),r[ot]&=-9217,s)Moe(n,r,n.template,r[no]);else if(o&8192){let a=lt(null);try{pF(r),mF(r,1);let c=n.components;c!==null&&yF(r,c,1),uF(r)}finally{lt(a)}}}function yF(r,e,t){for(let n=0;n<e.length;n++)Roe(r,e[n],t)}function Noe(r,e){let t=r.hostBindingOpCodes;if(t!==null)try{for(let n=0;n<t.length;n++){let o=t[n];if(o<0)nu(~o);else{let i=o,s=t[++n],a=t[++n];AO(s,i);let c=e[i];Xt(24,c),a(2,c),Xt(25,c)}}}finally{nu(-1)}}function pI(r,e){let t=e7()?64:1088;for(r[Ha].changeDetectionScheduler?.notify(e);r;){r[ot]|=t;let n=Yl(r);if($h(r)&&!n)return r;r=n}return null}function vF(r,e,t,n){return[r,!0,0,e,null,n,null,t,null,null]}function Ooe(r,e,t,n=!0){let o=e[at];if(Loe(o,e,r,t),n){let s=P7(t,r),a=e[Dr],c=a.parentNode(r[tu]);c!==null&&doe(o,r[is],a,e,c,s)}let i=e[a1];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function k7(r,e){if(r.length<=Do)return;let t=Do+e,n=r[t];if(n){let o=n[eu];o!==null&&o!==r&&lI(o,n),e>0&&(r[t-1][os]=n[os]);let i=o1(r,Do+e);uoe(n[at],n);let s=i[$a];s!==null&&s.detachView(i[at]),n[vn]=null,n[os]=null,n[ot]&=-129}return n}function Loe(r,e,t,n){let o=Do+n,i=t.length;n>0&&(t[o-1][os]=e),n<i-Do?(e[os]=t[o],kC(t,Do+n,e)):(t.push(e),e[os]=null),e[vn]=t;let s=e[eu];s!==null&&t!==s&&wF(s,e);let a=e[$a];a!==null&&a.insertView(r),Ub(e),e[ot]|=128}function wF(r,e){let t=r[Gd],n=e[vn];if(za(n))r[ot]|=2;else{let o=n[vn][ss];e[ss]!==o&&(r[ot]|=2)}t===null?r[Gd]=[e]:t.push(e)}var iu=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[at];return E1(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[no]}set context(e){this._lView[no]=e}get destroyed(){return Wd(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[vn];if(qs(e)){let t=e[u1],n=t?t.indexOf(this):-1;n>-1&&(k7(e,n),o1(t,n))}this._attachedToViewContainer=!1}aF(this._lView[at],this._lView)}onDestroy(e){GC(this._lView,e)}markForCheck(){pI(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ot]&=-129}reattach(){Ub(this._lView),this._lView[ot]|=128}detectChanges(){this._lView[ot]|=1024,fI(this._lView)}checkNoChanges(){return;try{this.exhaustive??=this._lView[zd].get(coe,WO)}catch{this.exhaustive=WO}}attachToViewContainerRef(){if(this._appRef)throw new be(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=$h(this._lView),t=this._lView[eu];t!==null&&!e&&lI(t,this._lView),sF(this._lView[at],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new be(902,!1);this._appRef=e;let t=$h(this._lView),n=this._lView[eu];n!==null&&!t&&wF(n,this._lView),Ub(this._lView)}};var su=(()=>{class r{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=Foe;constructor(t,n,o){this._declarationLView=t,this._declarationTContainer=n,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,o){let i=aoe(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:o});return new iu(i)}}return r})();function Foe(){return hI(oo(),wt())}function hI(r,e){return r.type&4?new su(e,r,Qh(r,e)):null}function mI(r,e,t,n,o){let i=r.data[e];if(i===null)i=Boe(r,e,t,n,o),IO()&&(i.flags|=32);else if(i.type&64){i.type=t,i.value=n,i.attrs=o;let s=xO();i.injectorIndex=s===null?-1:s.injectorIndex}return zh(i,!0),i}function Boe(r,e,t,n,o){let i=QC(),s=ZC(),a=s?i:i&&i.parent,c=r.data[e]=Voe(r,a,t,e,n,o);return Uoe(r,c,i,s),c}function Uoe(r,e,t,n){r.firstChild===null&&(r.firstChild=e),t!==null&&(n?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function Voe(r,e,t,n,o,i){let s=e?e.injectorIndex:-1,a=0;return vO()&&(a|=128),{type:t,index:n,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var ZCe=new RegExp(`^(\\d+)*(${wne}|${vne})*(.*)`);var joe=()=>null;function XO(r,e){return joe(r,e)}var bF=class{},S3=class{},R7=class{resolveComponentFactory(e){throw new be(917,!1)}},D1=class{static NULL=new R7},Zd=class{},us=(()=>{class r{destroyNode=null;static __NG_ELEMENT_ID__=()=>Hoe()}return r})();function Hoe(){let r=wt(),e=oo(),t=cs(e.index,r);return(za(t)?t:r)[Dr]}var xF=(()=>{class r{static \u0275prov=he({token:r,providedIn:"root",factory:()=>null})}return r})();var t3={},N7=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,n){let o=this.injector.get(e,t3,n);return o!==t3||t===t3?o:this.parentInjector.get(e,t,n)}};function QO(r,e,t){let n=t?r.styles:null,o=t?r.classes:null,i=0;if(e!==null)for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")i=a;else if(i==1)o=Ab(o,a);else if(i==2){let c=a,l=e[++s];n=Ab(n,c+": "+l+";")}}t?r.styles=n:r.stylesWithoutHost=n,t?r.classes=o:r.classesWithoutHost=o}function oe(r,e=0){let t=wt();if(t===null)return xe(r,e);let n=oo();return PL(n,t,kn(r),e)}function EF(r,e,t,n,o){let i=n===null?null:{"":-1},s=o(r,t);if(s!==null){let a=s,c=null,l=null;for(let u of s)if(u.resolveHostDirectives!==null){[a,c,l]=u.resolveHostDirectives(s);break}qoe(r,e,t,a,i,c,l)}i!==null&&n!==null&&$oe(t,n,i)}function $oe(r,e,t){let n=r.localNames=[];for(let o=0;o<e.length;o+=2){let i=t[e[o+1]];if(i==null)throw new be(-301,!1);n.push(e[o],i)}}function zoe(r,e,t){e.componentOffset=t,(r.components??=[]).push(e.index)}function qoe(r,e,t,n,o,i,s){let a=n.length,c=!1;for(let h=0;h<a;h++){let p=n[h];!c&&qa(p)&&(c=!0,zoe(r,t,h)),S7(s3(t,e),r,p.type)}Qoe(t,r.data.length,a);for(let h=0;h<a;h++){let p=n[h];p.providersResolver&&p.providersResolver(p)}let l=!1,u=!1,d=eF(r,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let h=0;h<a;h++){let p=n[h];if(t.mergedAttrs=b1(t.mergedAttrs,p.hostAttrs),Goe(r,t,e,d,p),Xoe(d,p,o),s!==null&&s.has(p)){let[w,E]=s.get(p);t.directiveToIndex.set(p.type,[d,w+t.directiveStart,E+t.directiveStart])}else(i===null||!i.has(p))&&t.directiveToIndex.set(p.type,d);p.contentQueries!==null&&(t.flags|=4),(p.hostBindings!==null||p.hostAttrs!==null||p.hostVars!==0)&&(t.flags|=64);let m=p.type.prototype;!l&&(m.ngOnChanges||m.ngOnInit||m.ngDoCheck)&&((r.preOrderHooks??=[]).push(t.index),l=!0),!u&&(m.ngOnChanges||m.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(t.index),u=!0),d++}Koe(r,t,i)}function Koe(r,e,t){for(let n=e.directiveStart;n<e.directiveEnd;n++){let o=r.data[n];if(t===null||!t.has(o))ZO(0,e,o,n),ZO(1,e,o,n),eL(e,n,!1);else{let i=t.get(o);JO(0,e,i,n),JO(1,e,i,n),eL(e,n,!0)}}}function ZO(r,e,t,n){let o=r===0?t.inputs:t.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s;r===0?s=e.inputs??={}:s=e.outputs??={},s[i]??=[],s[i].push(n),_F(e,i)}}function JO(r,e,t,n){let o=r===0?t.inputs:t.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s=o[i],a;r===0?a=e.hostDirectiveInputs??={}:a=e.hostDirectiveOutputs??={},a[s]??=[],a[s].push(n,i),_F(e,s)}}function _F(r,e){e==="class"?r.flags|=8:e==="style"&&(r.flags|=16)}function eL(r,e,t){let{attrs:n,inputs:o,hostDirectiveInputs:i}=r;if(n===null||!t&&o===null||t&&i===null||eI(r)){r.initialInputs??=[],r.initialInputs.push(null);return}let s=null,a=0;for(;a<n.length;){let c=n[a];if(c===0){a+=4;continue}else if(c===5){a+=2;continue}else if(typeof c=="number")break;if(!t&&o.hasOwnProperty(c)){let l=o[c];for(let u of l)if(u===e){s??=[],s.push(c,n[a+1]);break}}else if(t&&i.hasOwnProperty(c)){let l=i[c];for(let u=0;u<l.length;u+=2)if(l[u]===e){s??=[],s.push(l[u+1],n[a+1]);break}}a+=2}r.initialInputs??=[],r.initialInputs.push(s)}function Goe(r,e,t,n,o){r.data[n]=o;let i=o.factory||(o.factory=Wl(o.type,!0)),s=new Qd(i,qa(o),oe);r.blueprint[n]=s,t[n]=s,Woe(r,e,n,eF(r,t,o.hostVars,Po),o)}function Woe(r,e,t,n,o){let i=o.hostBindings;if(i){let s=r.hostBindingOpCodes;s===null&&(s=r.hostBindingOpCodes=[]);let a=~e.index;Yoe(s)!=a&&s.push(a),s.push(t,n,i)}}function Yoe(r){let e=r.length;for(;e>0;){let t=r[--e];if(typeof t=="number"&&t<0)return t}return 0}function Xoe(r,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=r;qa(e)&&(t[""]=r)}}function Qoe(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function SF(r,e,t,n,o,i,s,a){let c=e.consts,l=d1(c,s),u=mI(e,r,2,n,l);return i&&EF(e,t,u,d1(c,a),o),u.mergedAttrs=b1(u.mergedAttrs,u.attrs),u.attrs!==null&&QO(u,u.attrs,!1),u.mergedAttrs!==null&&QO(u,u.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,u),u}function CF(r,e){xL(r,e),HC(e)&&r.queries.elementEnd(e)}function gI(r){return AF(r)?Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r:!1}function IF(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{let t=r[Symbol.iterator](),n;for(;!(n=t.next()).done;)e(n.value)}}function AF(r){return r!==null&&(typeof r=="function"||typeof r=="object")}function yI(r,e,t){return r[e]=t}function Zoe(r,e){return r[e]}function Wa(r,e,t){if(t===Po)return!1;let n=r[e];return Object.is(n,t)?!1:(r[e]=t,!0)}function DF(r,e,t,n){let o=Wa(r,e,t);return Wa(r,e+1,n)||o}function m7(r,e,t){return function n(o){let i=ru(r)?cs(r.index,e):e;pI(i,5);let s=e[no],a=tL(e,s,t,o),c=n.__ngNextListenerFn__;for(;c;)a=tL(e,s,c,o)&&a,c=c.__ngNextListenerFn__;return a}}function tL(r,e,t,n){let o=lt(null);try{return Xt(6,e,t),t(n)!==!1}catch(i){return noe(r,i),!1}finally{Xt(7,e,t),lt(o)}}function Joe(r,e,t,n,o,i,s,a){let c=Ob(r),l=!1,u=null;if(!n&&c&&(u=eie(e,t,i,r.index)),u!==null){let d=u.__ngLastListenerFn__||u;d.__ngNextListenerFn__=s,u.__ngLastListenerFn__=s,l=!0}else{let d=Ks(r,t),h=n?n(d):d;xne(t,h,i,a);let p=o.listen(h,i,a),m=n?w=>n(as(w[r.index])):r.index;TF(m,e,t,i,a,p,!1)}return l}function eie(r,e,t,n){let o=r.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===t&&o[i+1]===n){let a=e[jh],c=o[i+2];return a&&a.length>c?a[c]:null}typeof s=="string"&&(i+=2)}return null}function TF(r,e,t,n,o,i,s){let a=e.firstCreatePass?YC(e):null,c=WC(t),l=c.length;c.push(o,i),a&&a.push(n,r,l,(l+1)*(s?-1:1))}function rL(r,e,t,n,o,i){let s=e[t],a=e[at],l=a.data[t].outputs[n],d=s[l].subscribe(i);TF(r.index,a,e,o,i,d,!0)}var O7=Symbol("BINDING");var u3=class extends D1{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Jl(e);return new Wh(t,this.ngModule)}};function tie(r){return Object.keys(r).map(e=>{let[t,n,o]=r[e],i={propName:t,templateName:e,isSignal:(n&E3.SignalBased)!==0};return o&&(i.transform=o),i})}function rie(r){return Object.keys(r).map(e=>({propName:r[e],templateName:e}))}function nie(r,e,t){let n=e instanceof Kr?e:e?.injector;return n&&r.getStandaloneInjector!==null&&(n=r.getStandaloneInjector(n)||n),n?new N7(t,n):t}function oie(r){let e=r.get(Zd,null);if(e===null)throw new be(407,!1);let t=r.get(xF,null),n=r.get(Xl,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:n,ngReflect:!1}}function iie(r,e){let t=(r.selectors[0][0]||"div").toLowerCase();return XL(e,t,t==="svg"?cO:t==="math"?lO:null)}var Wh=class extends S3{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=tie(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=rie(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=One(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,n,o,i,s){Xt(22);let a=lt(null);try{let c=this.componentDef,l=sie(n,c,s,i),u=nie(c,o||this.ngModule,e),d=oie(u),h=d.rendererFactory.createRenderer(null,c),p=n?qne(h,n,c.encapsulation,u):iie(c,h),m=s?.some(nL)||i?.some(S=>typeof S!="function"&&S.bindings.some(nL)),w=rI(null,l,null,512|JL(c),null,null,d,h,u,null,jL(p,u,!0));w[Ao]=p,$b(w);let E=null;try{let S=SF(Ao,l,w,"#host",()=>l.directiveRegistry,!0,0);p&&(ZL(h,p,S),I1(p,w)),oI(l,w,S),$L(l,S,w),CF(l,S),t!==void 0&&cie(S,this.ngContentSelectors,t),E=cs(S.index,w),w[no]=E[no],sI(l,w,null)}catch(S){throw E!==null&&I7(E),I7(w),S}finally{Xt(23),zb()}return new d3(this.componentType,w,!!m)}finally{lt(a)}}};function sie(r,e,t,n){let o=r?["ng-version","20.0.6"]:Lne(e.selectors[0]),i=null,s=null,a=0;if(t)for(let u of t)a+=u[O7].requiredVars,u.create&&(u.targetIdx=0,(i??=[]).push(u)),u.update&&(u.targetIdx=0,(s??=[]).push(u));if(n)for(let u=0;u<n.length;u++){let d=n[u];if(typeof d!="function")for(let h of d.bindings){a+=h[O7].requiredVars;let p=u+1;h.create&&(h.targetIdx=p,(i??=[]).push(h)),h.update&&(h.targetIdx=p,(s??=[]).push(h))}}let c=[e];if(n)for(let u of n){let d=typeof u=="function"?u:u.type,h=LC(d);c.push(h)}return tI(0,null,aie(i,s),1,a,c,null,null,null,[o],null)}function aie(r,e){return!r&&!e?null:t=>{if(t&1&&r)for(let n of r)n.create();if(t&2&&e)for(let n of e)n.update()}}function nL(r){let e=r[O7].kind;return e==="input"||e==="twoWay"}var d3=class extends bF{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,n){super(),this._rootLView=t,this._hasInputBindings=n,this._tNode=Lb(t[at],Ao),this.location=Qh(this._tNode,t),this.instance=cs(this._tNode.index,t)[no],this.hostView=this.changeDetectorRef=new iu(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let n=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let o=this._rootLView,i=iI(n,o[at],o,e,t);this.previousInputValues.set(e,t);let s=cs(n.index,o);pI(s,1)}get injector(){return new Xd(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function cie(r,e,t){let n=r.projection=[];for(let o=0;o<e.length;o++){let i=t[o];n.push(i!=null&&i.length?Array.from(i):null)}}var Qc=(()=>{class r{static __NG_ELEMENT_ID__=lie}return r})();function lie(){let r=oo();return MF(r,wt())}var uie=Qc,PF=class extends uie{_lContainer;_hostTNode;_hostLView;constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Qh(this._hostTNode,this._hostLView)}get injector(){return new Xd(this._hostTNode,this._hostLView)}get parentInjector(){let e=Y7(this._hostTNode,this._hostLView);if(SL(e)){let t=o3(e,this._hostLView),n=n3(e),o=t[at].data[n+8];return new Xd(o,t)}else return new Xd(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=oL(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Do}createEmbeddedView(e,t,n){let o,i;typeof n=="number"?o=n:n!=null&&(o=n.index,i=n.injector);let s=XO(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},i,s);return this.insertImpl(a,o,GO(this._hostTNode,s)),a}createComponent(e,t,n,o,i,s,a){let c=e&&!Kre(e),l;if(c)l=t;else{let E=t||{};l=E.index,n=E.injector,o=E.projectableNodes,i=E.environmentInjector||E.ngModuleRef,s=E.directives,a=E.bindings}let u=c?e:new Wh(Jl(e)),d=n||this.parentInjector;if(!i&&u.ngModule==null){let S=(c?d:this.parentInjector).get(Kr,null);S&&(i=S)}let h=Jl(u.componentType??{}),p=XO(this._lContainer,h?.id??null),m=p?.firstChild??null,w=u.create(d,o,m,i,s,a);return this.insertImpl(w.hostView,l,GO(this._hostTNode,p)),w}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,n){let o=e._lView;if(dO(o)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=o[vn],l=new PF(c,c[is],c[vn]);l.detach(l.indexOf(e))}}let i=this._adjustIndex(t),s=this._lContainer;return Ooe(s,o,i,n),e.attachToViewContainerRef(),kC(g7(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=oL(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),n=k7(this._lContainer,t);n&&(o1(g7(this._lContainer),t),aF(n[at],n))}detach(e){let t=this._adjustIndex(e,-1),n=k7(this._lContainer,t);return n&&o1(g7(this._lContainer),t)!=null?new iu(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function oL(r){return r[u1]}function g7(r){return r[u1]||(r[u1]=[])}function MF(r,e){let t,n=e[r.index];return qs(n)?t=n:(t=vF(n,e,null,r),e[r.index]=t,nI(e,t)),fie(t,e,r,n),new PF(t,r,e)}function die(r,e){let t=r[Dr],n=t.createComment(""),o=Ks(e,r),i=t.parentNode(o);return l3(t,i,n,t.nextSibling(o),!1),n}var fie=mie,pie=()=>!1;function hie(r,e,t){return pie(r,e,t)}function mie(r,e,t,n){if(r[tu])return;let o;t.type&8?o=as(n):o=die(e,t),r[tu]=o}var L7=class r{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new r(this.queryList)}setDirty(){this.queryList.setDirty()}},F7=class r{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let n=e.contentQueries!==null?e.contentQueries[0]:t.length,o=[];for(let i=0;i<n;i++){let s=t.getByIndex(i),a=this.queries[s.indexInDeclarationView];o.push(a.clone())}return new r(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)vI(e,t).matches!==null&&this.queries[t].setDirty()}},B7=class{flags;read;predicate;constructor(e,t,n=null){this.flags=t,this.read=n,typeof e=="string"?this.predicate=_ie(e):this.predicate=e}},U7=class r{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){let o=t!==null?t.length:0,i=this.getByIndex(n).embeddedTView(e,o);i&&(i.indexInDeclarationView=n,t!==null?t.push(i):t=[i])}return t!==null?new r(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},V7=class r{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new r(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,n=e.parent;for(;n!==null&&n.type&8&&n.index!==t;)n=n.parent;return t===(n!==null?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let n=this.metadata.predicate;if(Array.isArray(n))for(let o=0;o<n.length;o++){let i=n[o];this.matchTNodeWithReadOption(e,t,gie(t,i)),this.matchTNodeWithReadOption(e,t,e3(t,e,i,!1,!1))}else n===su?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,e3(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(n!==null){let o=this.metadata.read;if(o!==null)if(o===io||o===Qc||o===su&&t.type&4)this.addMatch(t.index,-2);else{let i=e3(t,e,o,!1,!1);i!==null&&this.addMatch(t.index,i)}else this.addMatch(t.index,n)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function gie(r,e){let t=r.localNames;if(t!==null){for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1]}return null}function yie(r,e){return r.type&11?Qh(r,e):r.type&4?hI(r,e):null}function vie(r,e,t,n){return t===-1?yie(e,r):t===-2?wie(r,e,n):x1(r,r[at],t,e)}function wie(r,e,t){if(t===io)return Qh(e,r);if(t===su)return hI(e,r);if(t===Qc)return MF(e,r)}function kF(r,e,t,n){let o=e[$a].queries[n];if(o.matches===null){let i=r.data,s=t.matches,a=[];for(let c=0;s!==null&&c<s.length;c+=2){let l=s[c];if(l<0)a.push(null);else{let u=i[l];a.push(vie(e,u,s[c+1],t.metadata.read))}}o.matches=a}return o.matches}function j7(r,e,t,n){let o=r.queries.getByIndex(t),i=o.matches;if(i!==null){let s=kF(r,e,o,t);for(let a=0;a<i.length;a+=2){let c=i[a];if(c>0)n.push(s[a/2]);else{let l=i[a+1],u=e[-c];for(let d=Do;d<u.length;d++){let h=u[d];h[eu]===h[vn]&&j7(h[at],h,l,n)}if(u[Gd]!==null){let d=u[Gd];for(let h=0;h<d.length;h++){let p=d[h];j7(p[at],p,l,n)}}}}}return n}function bie(r,e){return r[$a].queries[e].queryList}function xie(r,e,t){let n=new a3((t&4)===4);return hO(r,e,n,n.destroy),(e[$a]??=new F7).queries.push(new L7(n))-1}function Eie(r,e,t,n){let o=bn();if(o.firstCreatePass){let i=oo();Sie(o,new B7(e,t,n),i.index),Cie(o,r),(t&2)===2&&(o.staticContentQueries=!0)}return xie(o,wt(),t)}function _ie(r){return r.split(",").map(e=>e.trim())}function Sie(r,e,t){r.queries===null&&(r.queries=new U7),r.queries.track(new V7(e,t))}function Cie(r,e){let t=r.contentQueries||(r.contentQueries=[]),n=t.length?t[t.length-1]:-1;e!==n&&t.push(r.queries.length-1,e)}function vI(r,e){return r.queries.getByIndex(e)}function Iie(r,e){let t=r[at],n=vI(t,e);return n.crossesNgTemplate?j7(t,r,e,[]):kF(t,r,n,e)}var iL=new Set;function C3(r){iL.has(r)||(iL.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}var Jd=class{},I3=class{};var f3=class extends Jd{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new u3(this);constructor(e,t,n,o=!0){super(),this.ngModuleType=e,this._parent=t;let i=OC(e);this._bootstrapComponents=WL(i.bootstrap),this._r3Injector=i7(e,t,[{provide:Jd,useValue:this},{provide:D1,useValue:this.componentFactoryResolver},...n],Go(e),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},p3=class extends I3{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new f3(this.moduleType,e,[])}};var _1=class extends Jd{injector;componentFactoryResolver=new u3(this);instance=null;constructor(e){super();let t=new Hd([...e.providers,{provide:Jd,useValue:this},{provide:D1,useValue:this.componentFactoryResolver}],e.parent||s1(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function T1(r,e,t=null){return new _1({providers:r,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var Aie=(()=>{class r{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let n=FC(!1,t.type),o=n.length>0?T1([n],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,o)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=he({token:r,providedIn:"environment",factory:()=>new r(xe(Kr))})}return r})();function Qt(r){return Xh(()=>{let e=RF(r),t=I(v({},e),{decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===X7.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&r.dependencies||null,getStandaloneInjector:e.standalone?o=>o.get(Aie).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Xc.Emulated,styles:r.styles||Co,_:null,schemas:r.schemas||null,tView:null,id:""});e.standalone&&C3("NgStandalone"),NF(t);let n=r.dependencies;return t.directiveDefs=sL(n,!1),t.pipeDefs=sL(n,!0),t.id=kie(t),t})}function Die(r){return Jl(r)||LC(r)}function Tie(r){return r!==null}function Ai(r){return Xh(()=>({type:r.type,bootstrap:r.bootstrap||Co,declarations:r.declarations||Co,imports:r.imports||Co,exports:r.exports||Co,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function Pie(r,e){if(r==null)return Zl;let t={};for(let n in r)if(r.hasOwnProperty(n)){let o=r[n],i,s,a,c;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i,c=o[3]||null):(i=o,s=o,a=E3.None,c=null),t[i]=[n,a,c],e[i]=s}return t}function Mie(r){if(r==null)return Zl;let e={};for(let t in r)r.hasOwnProperty(t)&&(e[r[t]]=t);return e}function Tt(r){return Xh(()=>{let e=RF(r);return NF(e),e})}function P1(r){return{type:r.type,name:r.name,factory:null,pure:r.pure!==!1,standalone:r.standalone??!0,onDestroy:r.type.prototype.ngOnDestroy||null}}function RF(r){let e={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:e,inputConfig:r.inputs||Zl,exportAs:r.exportAs||null,standalone:r.standalone??!0,signals:r.signals===!0,selectors:r.selectors||Co,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:Pie(r.inputs,e),outputs:Mie(r.outputs),debugInfo:null}}function NF(r){r.features?.forEach(e=>e(r))}function sL(r,e){if(!r)return null;let t=e?eO:Die;return()=>(typeof r=="function"?r():r).map(n=>t(n)).filter(Tie)}function kie(r){let e=0,t=typeof r.consts=="function"?"":r.consts,n=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,t,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery];for(let i of n.join("|"))e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Rie(r){return Object.getPrototypeOf(r.prototype).constructor}function Yr(r){let e=Rie(r.type),t=!0,n=[r];for(;e;){let o;if(qa(r))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new be(903,!1);o=e.\u0275dir}if(o){if(t){n.push(o);let s=r;s.inputs=y7(r.inputs),s.declaredInputs=y7(r.declaredInputs),s.outputs=y7(r.outputs);let a=o.hostBindings;a&&Bie(r,a);let c=o.viewQuery,l=o.contentQueries;if(c&&Lie(r,c),l&&Fie(r,l),Nie(r,o),GN(r.outputs,o.outputs),qa(o)&&o.data.animation){let u=r.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(r),a===Yr&&(t=!1)}}e=Object.getPrototypeOf(e)}Oie(n)}function Nie(r,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||r.inputs.hasOwnProperty(t))continue;let n=e.inputs[t];n!==void 0&&(r.inputs[t]=n,r.declaredInputs[t]=e.declaredInputs[t])}}function Oie(r){let e=0,t=null;for(let n=r.length-1;n>=0;n--){let o=r[n];o.hostVars=e+=o.hostVars,o.hostAttrs=b1(o.hostAttrs,t=b1(t,o.hostAttrs))}}function y7(r){return r===Zl?{}:r===Co?[]:r}function Lie(r,e){let t=r.viewQuery;t?r.viewQuery=(n,o)=>{e(n,o),t(n,o)}:r.viewQuery=e}function Fie(r,e){let t=r.contentQueries;t?r.contentQueries=(n,o,i)=>{e(n,o,i),t(n,o,i)}:r.contentQueries=e}function Bie(r,e){let t=r.hostBindings;t?r.hostBindings=(n,o)=>{e(n,o),t(n,o)}:r.hostBindings=e}function Uie(r,e,t,n,o,i,s,a,c){let l=e.consts,u=mI(e,r,4,s||null,a||null);XC()&&EF(e,t,u,d1(l,c),iF),u.mergedAttrs=b1(u.mergedAttrs,u.attrs),xL(e,u);let d=u.tView=tI(2,u,n,o,i,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return e.queries!==null&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}function Vie(r,e,t,n,o,i,s,a,c,l,u){let d=t+Ao,h=e.firstCreatePass?Uie(d,e,r,n,o,i,s,a,l):e.data[d];c&&(h.flags|=c),zh(h,!1);let p=jie(e,r,h,t);Kb()&&uI(e,r,p,h),I1(p,r);let m=vF(p,r,p,h);return r[d]=m,nI(r,m),hie(m,h,r),Ob(h)&&oI(e,r,h),l!=null&&nF(r,h,u),h}function ye(r,e,t,n,o,i,s,a){let c=wt(),l=bn(),u=d1(l.consts,i);return Vie(c,l,r,e,t,n,o,u,void 0,s,a),ye}var jie=Hie;function Hie(r,e,t,n){return Gb(!0),e[Dr].createComment("")}var wI=function(r){return r[r.CHANGE_DETECTION=0]="CHANGE_DETECTION",r[r.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",r}(wI||{}),M1=new De(""),OF=!1,H7=class extends qt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,sO()&&(this.destroyRef=ie(ou,{optional:!0})??void 0,this.pendingTasks=ie(Yc,{optional:!0})??void 0)}emit(e){let t=lt(null);try{super.next(e)}finally{lt(t)}}subscribe(e,t,n){let o=e,i=t||(()=>null),s=n;if(e&&typeof e=="object"){let c=e;o=c.next?.bind(c),i=c.error?.bind(c),s=c.complete?.bind(c)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return e instanceof Ir&&e.add(a),a}wrapInTimeout(e){return t=>{let n=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{n!==void 0&&this.pendingTasks?.remove(n)}})}}},Rt=H7;function LF(r){let e,t;function n(){r=y1;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{r(),n()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{r(),n()})),()=>n()}function aL(r){return queueMicrotask(()=>r()),()=>{r=y1}}var bI="isAngularZone",h3=bI+"_ID",$ie=0,Wr=class r{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Rt(!1);onMicrotaskEmpty=new Rt(!1);onStable=new Rt(!1);onError=new Rt(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=OF}=e;if(typeof Zone>"u")throw new be(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&n,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,Kie(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(bI)===!0}static assertInAngularZone(){if(!r.isInAngularZone())throw new be(909,!1)}static assertNotInAngularZone(){if(r.isInAngularZone())throw new be(909,!1)}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,e,zie,y1,y1);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}},zie={};function xI(r){if(r._nesting==0&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function qie(r){if(r.isCheckStableRunning||r.callbackScheduled)return;r.callbackScheduled=!0;function e(){LF(()=>{r.callbackScheduled=!1,$7(r),r.isCheckStableRunning=!0,xI(r),r.isCheckStableRunning=!1})}r.scheduleInRootZone?Zone.root.run(()=>{e()}):r._outer.run(()=>{e()}),$7(r)}function Kie(r){let e=()=>{qie(r)},t=$ie++;r._inner=r._inner.fork({name:"angular",properties:{[bI]:!0,[h3]:t,[h3+t]:!0},onInvokeTask:(n,o,i,s,a,c)=>{if(Gie(c))return n.invokeTask(i,s,a,c);try{return cL(r),n.invokeTask(i,s,a,c)}finally{(r.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||r.shouldCoalesceRunChangeDetection)&&e(),lL(r)}},onInvoke:(n,o,i,s,a,c,l)=>{try{return cL(r),n.invoke(i,s,a,c,l)}finally{r.shouldCoalesceRunChangeDetection&&!r.callbackScheduled&&!Wie(c)&&e(),lL(r)}},onHasTask:(n,o,i,s)=>{n.hasTask(i,s),o===i&&(s.change=="microTask"?(r._hasPendingMicrotasks=s.microTask,$7(r),xI(r)):s.change=="macroTask"&&(r.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,o,i,s)=>(n.handleError(i,s),r.runOutsideAngular(()=>r.onError.emit(s)),!1)})}function $7(r){r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&r.callbackScheduled===!0?r.hasPendingMicrotasks=!0:r.hasPendingMicrotasks=!1}function cL(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function lL(r){r._nesting--,xI(r)}var m3=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Rt;onMicrotaskEmpty=new Rt;onStable=new Rt;onError=new Rt;run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,o){return e.apply(t,n)}};function Gie(r){return FF(r,"__ignore_ng_zone__")}function Wie(r){return FF(r,"__scheduler_tick__")}function FF(r,e){return!Array.isArray(r)||r.length!==1?!1:r[0]?.data?.[e]===!0}var BF=(()=>{class r{impl=null;execute(){this.impl?.execute()}static \u0275prov=he({token:r,providedIn:"root",factory:()=>new r})}return r})();var EI=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();var _I=new De("");function cu(r){return!!r&&typeof r.then=="function"}function SI(r){return!!r&&typeof r.subscribe=="function"}var UF=new De("");var CI=(()=>{class r{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,n)=>{this.resolve=t,this.reject=n});appInits=ie(UF,{optional:!0})??[];injector=ie(ns);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let o of this.appInits){let i=Io(this.injector,o);if(cu(i))t.push(i);else if(SI(i)){let s=new Promise((a,c)=>{i.subscribe({complete:a,error:c})});t.push(s)}}let n=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{n()}).catch(o=>{this.reject(o)}),t.length===0&&n(),this.initialized=!0}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),A3=new De("");function VF(){zS(()=>{let r="";throw new be(600,r)})}function jF(r){return r.isBoundToModule}var Yie=10;var tf=(()=>{class r{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ie(To);afterRenderManager=ie(BF);zonelessEnabled=ie(g1);rootEffectScheduler=ie(d7);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new qt;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=ie(Yc);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Je(t=>!t))}constructor(){ie(M1,{optional:!0})}whenStable(){let t;return new Promise(n=>{t=this.isStable.subscribe({next:o=>{o&&n()}})}).finally(()=>{t.unsubscribe()})}_injector=ie(Kr);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,n){return this.bootstrapImpl(t,n)}bootstrapImpl(t,n,o=ns.NULL){return this._injector.get(Wr).run(()=>{Xt(10);let s=t instanceof S3;if(!this._injector.get(CI).done){let m="";throw new be(405,m)}let c;s?c=t:c=this._injector.get(D1).resolveComponentFactory(t),this.componentTypes.push(c.componentType);let l=jF(c)?void 0:this._injector.get(Jd),u=n||c.selector,d=c.create(o,[],u,l),h=d.location.nativeElement,p=d.injector.get(_I,null);return p?.registerApplication(h),d.onDestroy(()=>{this.detachView(d.hostView),w1(this.components,d),p?.unregisterApplication(h)}),this._loadComponent(d),Xt(11,d),d})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Xt(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(wI.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new be(101,!1);let t=lt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,lt(t),this.afterTick.next(),Xt(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Zd,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<Yie;)Xt(14),this.synchronizeOnce(),Xt(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let n=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:o}of this.allViews){if(!n&&!f1(o))continue;let i=n&&!this.zonelessEnabled?0:1;fI(o,i),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>f1(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let n=t;this._views.push(n),n.attachToAppRef(this)}detachView(t){let n=t;w1(this._views,n),n.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(o){this.internalErrorHandler(o)}this.components.push(t),this._injector.get(A3,[]).forEach(o=>o(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>w1(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new be(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function w1(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function rf(r,e,t,n){let o=wt(),i=qh();if(Wa(o,i,e)){let s=bn(),a=qb();eoe(a,o,r,e,t,n)}return rf}function z(r,e,t){let n=wt(),o=qh();if(Wa(n,o,e)){let i=bn(),s=qb();oF(s,n,r,e,n[Dr],t)}return z}function z7(r,e,t,n,o){iI(e,r,t,o?"class":"style",n)}function b(r,e,t,n){let o=wt(),i=bn(),s=Ao+r,a=o[Dr],c=i.firstCreatePass?SF(s,i,o,e,iF,XC(),t,n):i.data[s],l=Xie(i,o,c,a,e,r);o[s]=l;let u=Ob(c);return zh(c,!0),ZL(a,l,c),!cI(c)&&Kb()&&uI(i,o,l,c),(mO()===0||u)&&I1(l,o),gO(),u&&(oI(i,o,c),$L(i,c,o)),n!==null&&nF(o,c),b}function y(){let r=oo();ZC()?EO():(r=r.parent,zh(r,!1));let e=r;wO(e)&&bO(),yO();let t=bn();return t.firstCreatePass&&CF(t,e),e.classesWithoutHost!=null&&Zre(e)&&z7(t,e,wt(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&Jre(e)&&z7(t,e,wt(),e.stylesWithoutHost,!1),y}function Bt(r,e,t,n){return b(r,e,t,n),y(),Bt}var Xie=(r,e,t,n,o,i)=>(Gb(!0),XL(n,o,NO()));function nt(){return wt()}var Yd=void 0;function Qie(r){let e=Math.floor(Math.abs(r)),t=r.toString().replace(/^[^.]*\.?/,"").length;return e===1&&t===0?1:5}var Zie=["en",[["a","p"],["AM","PM"],Yd],[["AM","PM"],Yd,Yd],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Yd,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Yd,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Yd,"{1} 'at' {0}",Yd],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",Qie],v7={};function Di(r){let e=Jie(r),t=uL(e);if(t)return t;let n=e.split("-")[0];if(t=uL(n),t)return t;if(n==="en")return Zie;throw new be(701,!1)}function uL(r){return r in v7||(v7[r]=zc.ng&&zc.ng.common&&zc.ng.common.locales&&zc.ng.common.locales[r]),v7[r]}var Br=function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r}(Br||{});function Jie(r){return r.toLowerCase().replace(/_/g,"-")}var k1="en-US";var ese=k1;function HF(r){typeof r=="string"&&(ese=r.toLowerCase().replace(/_/g,"-"))}function _e(r,e,t){let n=wt(),o=bn(),i=oo();return $F(o,n,n[Dr],i,r,e,t),_e}function $F(r,e,t,n,o,i,s){let a=!0,c=null;if((n.type&3||s)&&(c??=m7(n,e,i),Joe(n,r,e,s,t,o,i,c)&&(a=!1)),a){let l=n.outputs?.[o],u=n.hostDirectiveOutputs?.[o];if(u&&u.length)for(let d=0;d<u.length;d+=2){let h=u[d],p=u[d+1];c??=m7(n,e,i),rL(n,e,h,p,o,c)}if(l&&l.length)for(let d of l)c??=m7(n,e,i),rL(n,e,d,o,o,c)}}function G(r=1){return RO(r)}function II(r,e,t,n){Eie(r,e,t,n)}function AI(r){let e=wt(),t=bn(),n=r7();Hb(n+1);let o=vI(t,n);if(r.dirty&&uO(e)===((o.metadata.flags&2)===2)){if(o.matches===null)r.reset([]);else{let i=Iie(e,n);r.reset(i,fne),r.notifyOnChanges()}return!0}return!1}function DI(){return bie(wt(),r7())}function TI(r){let e=_O();return Fb(e,Ao+r)}function Qb(r,e){return r<<17|e<<2}function ef(r){return r>>17&32767}function tse(r){return(r&2)==2}function rse(r,e){return r&131071|e<<17}function q7(r){return r|2}function Yh(r){return(r&131068)>>2}function w7(r,e){return r&-131069|e<<2}function nse(r){return(r&1)===1}function K7(r){return r|1}function ose(r,e,t,n,o,i){let s=i?e.classBindings:e.styleBindings,a=ef(s),c=Yh(s);r[n]=t;let l=!1,u;if(Array.isArray(t)){let d=t;u=d[1],(u===null||Vh(d,u)>0)&&(l=!0)}else u=t;if(o)if(c!==0){let h=ef(r[a+1]);r[n+1]=Qb(h,a),h!==0&&(r[h+1]=w7(r[h+1],n)),r[a+1]=rse(r[a+1],n)}else r[n+1]=Qb(a,0),a!==0&&(r[a+1]=w7(r[a+1],n)),a=n;else r[n+1]=Qb(c,0),a===0?a=n:r[c+1]=w7(r[c+1],n),c=n;l&&(r[n+1]=q7(r[n+1])),dL(r,u,n,!0),dL(r,u,n,!1),ise(e,u,r,n,i),s=Qb(a,c),i?e.classBindings=s:e.styleBindings=s}function ise(r,e,t,n,o){let i=o?r.residualClasses:r.residualStyles;i!=null&&typeof e=="string"&&Vh(i,e)>=0&&(t[n+1]=K7(t[n+1]))}function dL(r,e,t,n){let o=r[t+1],i=e===null,s=n?ef(o):Yh(o),a=!1;for(;s!==0&&(a===!1||i);){let c=r[s],l=r[s+1];sse(c,e)&&(a=!0,r[s+1]=n?K7(l):q7(l)),s=n?ef(l):Yh(l)}a&&(r[t+1]=n?q7(o):K7(o))}function sse(r,e){return r===null||e==null||(Array.isArray(r)?r[1]:r)===e?!0:Array.isArray(r)&&typeof e=="string"?Vh(r,e)>=0:!1}var Ws={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function ase(r){return r.substring(Ws.key,Ws.keyEnd)}function cse(r){return lse(r),zF(r,qF(r,0,Ws.textEnd))}function zF(r,e){let t=Ws.textEnd;return t===e?-1:(e=Ws.keyEnd=use(r,Ws.key=e,t),qF(r,e,t))}function lse(r){Ws.key=0,Ws.keyEnd=0,Ws.value=0,Ws.valueEnd=0,Ws.textEnd=r.length}function qF(r,e,t){for(;e<t&&r.charCodeAt(e)<=32;)e++;return e}function use(r,e,t){for(;e<t&&r.charCodeAt(e)>32;)e++;return e}function D3(r,e,t){return KF(r,e,t,!1),D3}function Rn(r,e){return KF(r,e,null,!0),Rn}function PI(r){fse(vse,dse,r,!0)}function dse(r,e){for(let t=cse(e);t>=0;t=zF(e,t))Mb(r,ase(e),!0)}function KF(r,e,t,n){let o=wt(),i=bn(),s=Vb(2);if(i.firstUpdatePass&&WF(i,r,s,n),e!==Po&&Wa(o,s,e)){let a=i.data[Gc()];YF(i,a,o,o[Dr],r,o[s+1]=bse(e,t),n,s)}}function fse(r,e,t,n){let o=bn(),i=Vb(2);o.firstUpdatePass&&WF(o,null,i,n);let s=wt();if(t!==Po&&Wa(s,i,t)){let a=o.data[Gc()];if(XF(a,n)&&!GF(o,i)){let c=n?a.classesWithoutHost:a.stylesWithoutHost;c!==null&&(t=Ab(c,t||"")),z7(o,a,s,t,n)}else wse(o,a,s,s[Dr],s[i+1],s[i+1]=yse(r,e,t),n,i)}}function GF(r,e){return e>=r.expandoStartIndex}function WF(r,e,t,n){let o=r.data;if(o[t+1]===null){let i=o[Gc()],s=GF(r,t);XF(i,n)&&e===null&&!s&&(e=!1),e=pse(o,i,e,n),ose(o,i,e,t,s,n)}}function pse(r,e,t,n){let o=TO(r),i=n?e.residualClasses:e.residualStyles;if(o===null)(n?e.classBindings:e.styleBindings)===0&&(t=b7(null,r,e,t,n),t=S1(t,e.attrs,n),i=null);else{let s=e.directiveStylingLast;if(s===-1||r[s]!==o)if(t=b7(o,r,e,t,n),i===null){let c=hse(r,e,n);c!==void 0&&Array.isArray(c)&&(c=b7(null,r,e,c[1],n),c=S1(c,e.attrs,n),mse(r,e,n,c))}else i=gse(r,e,n)}return i!==void 0&&(n?e.residualClasses=i:e.residualStyles=i),t}function hse(r,e,t){let n=t?e.classBindings:e.styleBindings;if(Yh(n)!==0)return r[ef(n)]}function mse(r,e,t,n){let o=t?e.classBindings:e.styleBindings;r[ef(o)]=n}function gse(r,e,t){let n,o=e.directiveEnd;for(let i=1+e.directiveStylingLast;i<o;i++){let s=r[i].hostAttrs;n=S1(n,s,t)}return S1(n,e.attrs,t)}function b7(r,e,t,n,o){let i=null,s=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<s&&(i=e[a],n=S1(n,i.hostAttrs,o),i!==r);)a++;return r!==null&&(t.directiveStylingLast=a),n}function S1(r,e,t){let n=t?1:2,o=-1;if(e!==null)for(let i=0;i<e.length;i++){let s=e[i];typeof s=="number"?o=s:o===n&&(Array.isArray(r)||(r=r===void 0?[]:["",r]),Mb(r,s,t?!0:e[++i]))}return r===void 0?null:r}function yse(r,e,t){if(t==null||t==="")return Co;let n=[],o=A1(t);if(Array.isArray(o))for(let i=0;i<o.length;i++)r(n,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&r(n,i,o[i]);else typeof o=="string"&&e(n,o);return n}function vse(r,e,t){let n=String(e);n!==""&&!n.includes(" ")&&Mb(r,n,t)}function wse(r,e,t,n,o,i,s,a){o===Po&&(o=Co);let c=0,l=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let h=c<o.length?o[c+1]:void 0,p=l<i.length?i[l+1]:void 0,m=null,w;u===d?(c+=2,l+=2,h!==p&&(m=d,w=p)):d===null||u!==null&&u<d?(c+=2,m=u):(l+=2,m=d,w=p),m!==null&&YF(r,e,t,n,m,w,s,a),u=c<o.length?o[c]:null,d=l<i.length?i[l]:null}}function YF(r,e,t,n,o,i,s,a){if(!(e.type&3))return;let c=r.data,l=c[a+1],u=nse(l)?fL(c,e,t,o,Yh(l),s):void 0;if(!g3(u)){g3(i)||tse(l)&&(i=fL(c,null,t,o,a,s));let d=$C(Gc(),t);Eoe(n,s,d,o,i)}}function fL(r,e,t,n,o,i){let s=e===null,a;for(;o>0;){let c=r[o],l=Array.isArray(c),u=l?c[1]:c,d=u===null,h=t[o+1];h===Po&&(h=d?Co:void 0);let p=d?kb(h,n):u===n?h:void 0;if(l&&!g3(p)&&(p=kb(c,n)),g3(p)&&(a=p,s))return a;let m=r[o+1];o=s?ef(m):Yh(m)}if(e!==null){let c=i?e.residualClasses:e.residualStyles;c!=null&&(a=kb(c,n))}return a}function g3(r){return r!==void 0}function bse(r,e){return r==null||r===""||(typeof e=="string"?r=r+e:typeof r=="object"&&(r=Go(A1(r)))),r}function XF(r,e){return(r.flags&(e?8:16))!==0}function _(r,e=""){let t=wt(),n=bn(),o=r+Ao,i=n.firstCreatePass?mI(n,o,1,e,null):n.data[o],s=xse(n,t,i,e,r);t[o]=s,Kb()&&uI(n,t,s,i),zh(i,!1)}var xse=(r,e,t,n,o)=>(Gb(!0),Fne(e[Dr],n));function Ese(r,e,t,n=""){return Wa(r,qh(),t)?e+Ql(t)+n:Po}function _se(r,e,t,n,o,i=""){let s=SO(),a=DF(r,s,t,o);return Vb(2),a?e+Ql(t)+n+Ql(o)+i:Po}function Se(r){return je("",r),Se}function je(r,e,t){let n=wt(),o=Ese(n,r,e,t);return o!==Po&&QF(n,Gc(),o),je}function R1(r,e,t,n,o){let i=wt(),s=_se(i,r,e,t,n,o);return s!==Po&&QF(i,Gc(),s),R1}function QF(r,e,t){let n=$C(e,r);Bne(r[Dr],n,t)}function vr(r,e,t){c7(e)&&(e=e());let n=wt(),o=qh();if(Wa(n,o,e)){let i=bn(),s=qb();oF(s,n,r,e,n[Dr],t)}return vr}function Tr(r,e){let t=c7(r);return t&&r.set(e),t}function wr(r,e){let t=wt(),n=bn(),o=oo();return $F(n,t,t[Dr],o,r,e),wr}function MI(r){return Wa(wt(),qh(),r)?Ql(r):Po}function Sse(r,e,t){let n=bn();if(n.firstCreatePass){let o=qa(r);G7(t,n.data,n.blueprint,o,!0),G7(e,n.data,n.blueprint,o,!1)}}function G7(r,e,t,n,o){if(r=kn(r),Array.isArray(r))for(let i=0;i<r.length;i++)G7(r[i],e,t,n,o);else{let i=bn(),s=wt(),a=oo(),c=jd(r)?r:kn(r.provide),l=UC(r),u=a.providerIndexes&1048575,d=a.directiveStart,h=a.providerIndexes>>20;if(jd(r)||!r.multi){let p=new Qd(l,o,oe),m=E7(c,e,o?u:u+h,d);m===-1?(S7(s3(a,s),i,c),x7(i,r,e.length),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(p),s.push(p)):(t[m]=p,s[m]=p)}else{let p=E7(c,e,u+h,d),m=E7(c,e,u,u+h),w=p>=0&&t[p],E=m>=0&&t[m];if(o&&!E||!o&&!w){S7(s3(a,s),i,c);let S=Ase(o?Ise:Cse,t.length,o,n,l);!o&&E&&(t[m].providerFactory=S),x7(i,r,e.length,0),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(S),s.push(S)}else{let S=ZF(t[o?m:p],l,!o&&n);x7(i,r,p>-1?p:m,S)}!o&&n&&E&&t[m].componentProviders++}}}function x7(r,e,t,n){let o=jd(e),i=iO(e);if(o||i){let c=(i?kn(e.useClass):e).prototype.ngOnDestroy;if(c){let l=r.destroyHooks||(r.destroyHooks=[]);if(!o&&e.multi){let u=l.indexOf(t);u===-1?l.push(t,[n,c]):l[u+1].push(n,c)}else l.push(t,c)}}}function ZF(r,e,t){return t&&r.componentProviders++,r.multi.push(e)-1}function E7(r,e,t,n){for(let o=t;o<n;o++)if(e[o]===r)return o;return-1}function Cse(r,e,t,n){return W7(this.multi,[])}function Ise(r,e,t,n){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=x1(t,t[at],this.providerFactory.index,n);i=a.slice(0,s),W7(o,i);for(let c=s;c<a.length;c++)i.push(a[c])}else i=[],W7(o,i);return i}function W7(r,e){for(let t=0;t<r.length;t++){let n=r[t];e.push(n())}return e}function Ase(r,e,t,n,o){let i=new Qd(r,t,oe);return i.multi=[],i.index=e,i.componentProviders=0,ZF(i,o,n&&!t),i}function Mo(r,e=[]){return t=>{t.providersResolver=(n,o)=>Sse(n,o?o(r):r,e)}}function kI(r,e,t){let n=m1()+r,o=wt();return o[n]===Po?yI(o,n,t?e.call(t):e()):Zoe(o,n)}function T3(r,e,t,n){return eB(wt(),m1(),r,e,t,n)}function JF(r,e){let t=r[e];return t===Po?void 0:t}function eB(r,e,t,n,o,i){let s=e+t;return Wa(r,s,o)?yI(r,s+1,i?n.call(i,o):n(o)):JF(r,s+1)}function Dse(r,e,t,n,o,i,s){let a=e+t;return DF(r,a,o,i)?yI(r,a+2,s?n.call(s,o,i):n(o,i)):JF(r,a+2)}function Ti(r,e){let t=bn(),n,o=r+Ao;t.firstCreatePass?(n=Tse(e,t.pipeRegistry),t.data[o]=n,n.onDestroy&&(t.destroyHooks??=[]).push(o,n.onDestroy)):n=t.data[o];let i=n.factory||(n.factory=Wl(n.type,!0)),s,a=So(oe);try{let c=i3(!1),l=i();return i3(c),zC(t,wt(),o,l),l}finally{So(a)}}function Tse(r,e){if(e)for(let t=e.length-1;t>=0;t--){let n=e[t];if(r===n.name)return n}}function Zc(r,e,t){let n=r+Ao,o=wt(),i=Fb(o,n);return tB(o,n)?eB(o,m1(),e,i.transform,t,i):i.transform(t)}function lu(r,e,t,n){let o=r+Ao,i=wt(),s=Fb(i,o);return tB(i,o)?Dse(i,m1(),e,s.transform,t,n,s):s.transform(t,n)}function tB(r,e){return r[at].data[e].pure}var y3=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},RI=(()=>{class r{compileModuleSync(t){return new p3(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let n=this.compileModuleSync(t),o=OC(t),i=WL(o.declarations).reduce((s,a)=>{let c=Jl(a);return c&&s.push(new Wh(c)),s},[]);return new y3(n,i)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Pse=(()=>{class r{zone=ie(Wr);changeDetectionScheduler=ie(Xl);applicationRef=ie(tf);applicationErrorHandler=ie(To);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),rB=new De("",{factory:()=>!1});function NI({ngZoneFactory:r,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return r??=()=>new Wr(I(v({},LI()),{scheduleInRootZone:t})),[{provide:Wr,useFactory:r},{provide:qc,multi:!0,useFactory:()=>{let n=ie(Pse,{optional:!0});return()=>n.initialize()}},{provide:qc,multi:!0,useFactory:()=>{let n=ie(Mse);return()=>{n.initialize()}}},e===!0?{provide:l7,useValue:!0}:[],{provide:u7,useValue:t??OF},{provide:To,useFactory:()=>{let n=ie(Wr),o=ie(Kr),i;return s=>{n.runOutsideAngular(()=>{o.destroyed&&!i?setTimeout(()=>{throw s}):(i??=o.get(ja),i.handleError(s))})}}}]}function OI(r){let e=r?.ignoreChangesOutsideZone,t=r?.scheduleInRootZone,n=NI({ngZoneFactory:()=>{let o=LI(r);return o.scheduleInRootZone=t,o.shouldCoalesceEventChangeDetection&&C3("NgZone_CoalesceEvent"),new Wr(o)},ignoreChangesOutsideZone:e,scheduleInRootZone:t});return Kc([{provide:rB,useValue:!0},{provide:g1,useValue:!1},n])}function LI(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}var Mse=(()=>{class r{subscription=new Ir;initialized=!1;zone=ie(Wr);pendingTasks=ie(Yc);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Wr.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Wr.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var nB=(()=>{class r{applicationErrorHandler=ie(To);appRef=ie(tf);taskService=ie(Yc);ngZone=ie(Wr);zonelessEnabled=ie(g1);tracing=ie(M1,{optional:!0});disableScheduling=ie(l7,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Ir;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(h3):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ie(u7,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof m3||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let n=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,n=!0;break}case 12:{this.appRef.dirtyFlags|=16,n=!0;break}case 13:{this.appRef.dirtyFlags|=2,n=!0;break}case 11:{n=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(n))return;let o=this.useMicrotaskScheduler?aL:LF;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(h3+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(n){this.taskService.remove(t),this.applicationErrorHandler(n)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,aL(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function kse(){return typeof $localize<"u"&&$localize.locale||k1}var N1=new De("",{providedIn:"root",factory:()=>ie(N1,{optional:!0,skipSelf:!0})||kse()});function ds(r){return $N(r)}function Jh(r,e){return qw(r,e?.equal)}var oB=class{[eo];constructor(e){this[eo]=e}destroy(){this[eo].destroy()}};var cB=Symbol("InputSignalNode#UNSET"),Kse=I(v({},Kw),{transformFn:void 0,applyValueToInputSignal(r,e){Th(r,e)}});function lB(r,e){let t=Object.create(Kse);t.value=r,t.transformFn=e?.transform;function n(){if(Ah(t),t.value===cB){let o=null;throw new be(-950,o)}return t.value}return n[eo]=t,n}var M3=class{attributeName;constructor(e){this.attributeName=e}__NG_ELEMENT_ID__=()=>C1(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},Gse=new De("");Gse.__NG_ELEMENT_ID__=r=>{let e=oo();if(e===null)throw new be(204,!1);if(e.type&2)return e.value;if(r&8)return null;throw new be(204,!1)};function iB(r,e){return lB(r,e)}function Wse(r){return lB(cB,r)}var uB=(iB.required=Wse,iB);var FI=new De(""),Yse=new De("");function O1(r){return!r.moduleRef}function Xse(r){let e=O1(r)?r.r3Injector:r.moduleRef.injector,t=e.get(Wr);return t.run(()=>{O1(r)?r.r3Injector.resolveInjectorInitializers():r.moduleRef.resolveInjectorInitializers();let n=e.get(To),o;if(t.runOutsideAngular(()=>{o=t.onError.subscribe({next:n})}),O1(r)){let i=()=>e.destroy(),s=r.platformInjector.get(FI);s.add(i),e.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>r.moduleRef.destroy(),s=r.platformInjector.get(FI);s.add(i),r.moduleRef.onDestroy(()=>{w1(r.allPlatformModules,r.moduleRef),o.unsubscribe(),s.delete(i)})}return Zse(n,t,()=>{let i=e.get(CI);return i.runInitializers(),i.donePromise.then(()=>{let s=e.get(N1,k1);if(HF(s||k1),!e.get(Yse,!0))return O1(r)?e.get(tf):(r.allPlatformModules.push(r.moduleRef),r.moduleRef);if(O1(r)){let c=e.get(tf);return r.rootComponent!==void 0&&c.bootstrap(r.rootComponent),c}else return Qse?.(r.moduleRef,r.allPlatformModules),r.moduleRef})})})}var Qse;function Zse(r,e,t){try{let n=t();return cu(n)?n.catch(o=>{throw e.runOutsideAngular(()=>r(o)),o}):n}catch(n){throw e.runOutsideAngular(()=>r(n)),n}}var P3=null;function Jse(r=[],e){return ns.create({name:e,providers:[{provide:i1,useValue:"platform"},{provide:FI,useValue:new Set([()=>P3=null])},...r]})}function eae(r=[]){if(P3)return P3;let e=Jse(r);return P3=e,VF(),tae(e),e}function tae(r){let e=r.get(w3,null);Io(r,()=>{e?.forEach(t=>t())})}var nf=(()=>{class r{static __NG_ELEMENT_ID__=rae}return r})();function rae(r){return nae(oo(),wt(),(r&16)===16)}function nae(r,e,t){if(ru(r)&&!t){let n=cs(r.index,e);return new iu(n,n)}else if(r.type&175){let n=e[ss];return new iu(n,e)}return null}var BI=class{constructor(){}supports(e){return gI(e)}create(e){return new UI(e)}},oae=(r,e)=>e,UI=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||oae}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,o=0,i=null;for(;t||n;){let s=!n||t&&t.currentIndex<sB(n,o,i)?t:n,a=sB(s,o,i),c=s.currentIndex;if(s===n)o--,n=n._nextRemoved;else if(t=t._next,s.previousIndex==null)o++;else{i||(i=[]);let l=a-o,u=c-o;if(l!=u){for(let h=0;h<l;h++){let p=h<i.length?i[h]:i[h]=0,m=p+h;u<=m&&m<l&&(i[h]=p+1)}let d=s.previousIndex;i[d]=u-l}}a!==c&&e(s,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!gI(e))throw new be(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,n=!1,o,i,s;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)i=e[a],s=this._trackByFn(a,i),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,i,s,a),n=!0):(n&&(t=this._verifyReinsertion(t,i,s,a)),Object.is(t.item,i)||this._addIdentityChange(t,i)),t=t._next}else o=0,IF(e,a=>{s=this._trackByFn(o,a),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,a,s,o),n=!0):(n&&(t=this._verifyReinsertion(t,a,s,o)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,o){let i;return e===null?i=this._itTail:(i=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,o)):(e=this._linkedRecords===null?null:this._linkedRecords.get(n,o),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,o)):e=this._addAfter(new VI(t,n),i,o)),e}_verifyReinsertion(e,t,n,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null);return i!==null?e=this._reinsertAfter(i,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let o=e._prevRemoved,i=e._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){let o=t===null?this._itHead:t._next;return e._next=o,e._prev=t,o===null?this._itTail=e:o._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new k3),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,n=e._next;return t===null?this._itHead=n:t._next=n,n===null?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new k3),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},VI=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}},jI=class{_head=null;_tail=null;add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;n!==null;n=n._nextDup)if((t===null||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){let t=e._prevDup,n=e._nextDup;return t===null?this._head=n:t._nextDup=n,n===null?this._tail=t:n._prevDup=t,this._head===null}},k3=class{map=new Map;put(e){let t=e.trackById,n=this.map.get(t);n||(n=new jI,this.map.set(t,n)),n.add(e)}get(e,t){let n=e,o=this.map.get(n);return o?o.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function sB(r,e,t){let n=r.previousIndex;if(n===null)return n;let o=0;return t&&n<t.length&&(o=t[n]),n+e+o}function aB(){return new HI([new BI])}var HI=(()=>{class r{factories;static \u0275prov=he({token:r,providedIn:"root",factory:aB});constructor(t){this.factories=t}static create(t,n){if(n!=null){let o=n.factories.slice();t=t.concat(o)}return new r(t)}static extend(t){return{provide:r,useFactory:n=>r.create(t,n||aB()),deps:[[r,new gL,new mL]]}}find(t){let n=this.factories.find(o=>o.supports(t));if(n!=null)return n;throw new be(901,!1)}}return r})();function dB(r){Xt(8);try{let{rootComponent:e,appProviders:t,platformProviders:n}=r,o=eae(n),i=[NI({}),{provide:Xl,useExisting:nB},LO,...t||[]],s=new _1({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return Xse({r3Injector:s.injector,platformInjector:o,rootComponent:e})}catch(e){return Promise.reject(e)}finally{Xt(9)}}function em(r){return typeof r=="boolean"?r:r!=null&&r!=="false"}var hB=null;function ps(){return hB}function $I(r){hB??=r}var L1=class{},zI=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(mB),providedIn:"platform"})}return r})();var mB=(()=>{class r extends zI{_location;_history;_doc=ie(Gr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ps().getBaseHref(this._doc)}onPopState(t){let n=ps().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){let n=ps().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,n,o){this._history.pushState(t,n,o)}replaceState(t,n,o){this._history.replaceState(t,n,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>new r,providedIn:"platform"})}return r})();function gB(r,e){return r?e?r.endsWith("/")?e.startsWith("/")?r+e.slice(1):r+e:e.startsWith("/")?r+e:`${r}/${e}`:r:e}function fB(r){let e=r.search(/#|\?|$/);return r[e-1]==="/"?r.slice(0,e-1)+r.slice(e):r}function uu(r){return r&&r[0]!=="?"?`?${r}`:r}var tm=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(vB),providedIn:"root"})}return r})(),yB=new De(""),vB=(()=>{class r extends tm{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,n){super(),this._platformLocation=t,this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??ie(Gr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return gB(this._baseHref,t)}path(t=!1){let n=this._platformLocation.pathname+uu(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${n}${o}`:n}pushState(t,n,o,i){let s=this.prepareExternalUrl(o+uu(i));this._platformLocation.pushState(t,n,s)}replaceState(t,n,o,i){let s=this.prepareExternalUrl(o+uu(i));this._platformLocation.replaceState(t,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(n){return new(n||r)(xe(zI),xe(yB,8))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),rm=(()=>{class r{_subject=new qt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let n=this._locationStrategy.getBaseHref();this._basePath=aae(fB(pB(n))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+uu(n))}normalize(t){return r.stripTrailingSlash(sae(this._basePath,pB(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,n="",o=null){this._locationStrategy.pushState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+uu(n)),o)}replaceState(t,n="",o=null){this._locationStrategy.replaceState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+uu(n)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{let n=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(n,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(o=>o(t,n))}subscribe(t,n,o){return this._subject.subscribe({next:t,error:n??void 0,complete:o??void 0})}static normalizeQueryParams=uu;static joinWithSlash=gB;static stripTrailingSlash=fB;static \u0275fac=function(n){return new(n||r)(xe(tm))};static \u0275prov=he({token:r,factory:()=>iae(),providedIn:"root"})}return r})();function iae(){return new rm(xe(tm))}function sae(r,e){if(!r||!e.startsWith(r))return e;let t=e.substring(r.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function pB(r){return r.replace(/\/index.html$/,"")}function aae(r){if(new RegExp("^(https?:)?//").test(r)){let[,t]=r.split(/\/\/[^\/]+/);return t}return r}var so=function(r){return r[r.Format=0]="Format",r[r.Standalone=1]="Standalone",r}(so||{}),Kt=function(r){return r[r.Narrow=0]="Narrow",r[r.Abbreviated=1]="Abbreviated",r[r.Wide=2]="Wide",r[r.Short=3]="Short",r}(Kt||{}),Yo=function(r){return r[r.Short=0]="Short",r[r.Medium=1]="Medium",r[r.Long=2]="Long",r[r.Full=3]="Full",r}(Yo||{}),el={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function _B(r){return Di(r)[Br.LocaleId]}function SB(r,e,t){let n=Di(r),o=[n[Br.DayPeriodsFormat],n[Br.DayPeriodsStandalone]],i=hs(o,e);return hs(i,t)}function CB(r,e,t){let n=Di(r),o=[n[Br.DaysFormat],n[Br.DaysStandalone]],i=hs(o,e);return hs(i,t)}function IB(r,e,t){let n=Di(r),o=[n[Br.MonthsFormat],n[Br.MonthsStandalone]],i=hs(o,e);return hs(i,t)}function AB(r,e){let n=Di(r)[Br.Eras];return hs(n,e)}function F1(r,e){let t=Di(r);return hs(t[Br.DateFormat],e)}function B1(r,e){let t=Di(r);return hs(t[Br.TimeFormat],e)}function U1(r,e){let n=Di(r)[Br.DateTimeFormat];return hs(n,e)}function V1(r,e){let t=Di(r),n=t[Br.NumberSymbols][e];if(typeof n>"u"){if(e===el.CurrencyDecimal)return t[Br.NumberSymbols][el.Decimal];if(e===el.CurrencyGroup)return t[Br.NumberSymbols][el.Group]}return n}function DB(r){if(!r[Br.ExtraData])throw new be(2303,!1)}function TB(r){let e=Di(r);return DB(e),(e[Br.ExtraData][2]||[]).map(n=>typeof n=="string"?qI(n):[qI(n[0]),qI(n[1])])}function PB(r,e,t){let n=Di(r);DB(n);let o=[n[Br.ExtraData][0],n[Br.ExtraData][1]],i=hs(o,e)||[];return hs(i,t)||[]}function hs(r,e){for(let t=e;t>-1;t--)if(typeof r[t]<"u")return r[t];throw new be(2304,!1)}function qI(r){let[e,t]=r.split(":");return{hours:+e,minutes:+t}}var cae=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,R3={},lae=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function MB(r,e,t,n){let o=vae(r);e=Jc(t,e)||e;let s=[],a;for(;e;)if(a=lae.exec(e),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;e=u}else{s.push(e);break}let c=o.getTimezoneOffset();n&&(c=RB(n,c),o=yae(o,n));let l="";return s.forEach(u=>{let d=mae(u);l+=d?d(o,t,c):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function B3(r,e,t){let n=new Date(0);return n.setFullYear(r,e,t),n.setHours(0,0,0),n}function Jc(r,e){let t=_B(r);if(R3[t]??={},R3[t][e])return R3[t][e];let n="";switch(e){case"shortDate":n=F1(r,Yo.Short);break;case"mediumDate":n=F1(r,Yo.Medium);break;case"longDate":n=F1(r,Yo.Long);break;case"fullDate":n=F1(r,Yo.Full);break;case"shortTime":n=B1(r,Yo.Short);break;case"mediumTime":n=B1(r,Yo.Medium);break;case"longTime":n=B1(r,Yo.Long);break;case"fullTime":n=B1(r,Yo.Full);break;case"short":let o=Jc(r,"shortTime"),i=Jc(r,"shortDate");n=N3(U1(r,Yo.Short),[o,i]);break;case"medium":let s=Jc(r,"mediumTime"),a=Jc(r,"mediumDate");n=N3(U1(r,Yo.Medium),[s,a]);break;case"long":let c=Jc(r,"longTime"),l=Jc(r,"longDate");n=N3(U1(r,Yo.Long),[c,l]);break;case"full":let u=Jc(r,"fullTime"),d=Jc(r,"fullDate");n=N3(U1(r,Yo.Full),[u,d]);break}return n&&(R3[t][e]=n),n}function N3(r,e){return e&&(r=r.replace(/\{([^}]+)}/g,function(t,n){return e!=null&&n in e?e[n]:t})),r}function Ys(r,e,t="-",n,o){let i="";(r<0||o&&r<=0)&&(o?r=-r+1:(r=-r,i=t));let s=String(r);for(;s.length<e;)s="0"+s;return n&&(s=s.slice(s.length-e)),i+s}function uae(r,e){return Ys(r,3).substring(0,e)}function Xr(r,e,t=0,n=!1,o=!1){return function(i,s){let a=dae(r,i);if((t>0||a>-t)&&(a+=t),r===3)a===0&&t===-12&&(a=12);else if(r===6)return uae(a,e);let c=V1(s,el.MinusSign);return Ys(a,e,c,n,o)}}function dae(r,e){switch(r){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new be(2301,!1)}}function tr(r,e,t=so.Format,n=!1){return function(o,i){return fae(o,i,r,e,t,n)}}function fae(r,e,t,n,o,i){switch(t){case 2:return IB(e,o,n)[r.getMonth()];case 1:return CB(e,o,n)[r.getDay()];case 0:let s=r.getHours(),a=r.getMinutes();if(i){let l=TB(e),u=PB(e,o,n),d=l.findIndex(h=>{if(Array.isArray(h)){let[p,m]=h,w=s>=p.hours&&a>=p.minutes,E=s<m.hours||s===m.hours&&a<m.minutes;if(p.hours<m.hours){if(w&&E)return!0}else if(w||E)return!0}else if(h.hours===s&&h.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return SB(e,o,n)[s<12?0:1];case 3:return AB(e,n)[r.getFullYear()<=0?0:1];default:let c=t;throw new be(2302,!1)}}function O3(r){return function(e,t,n){let o=-1*n,i=V1(t,el.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(r){case 0:return(o>=0?"+":"")+Ys(s,2,i)+Ys(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Ys(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Ys(s,2,i)+":"+Ys(Math.abs(o%60),2,i);case 3:return n===0?"Z":(o>=0?"+":"")+Ys(s,2,i)+":"+Ys(Math.abs(o%60),2,i);default:throw new be(2302,!1)}}}var pae=0,F3=4;function hae(r){let e=B3(r,pae,1).getDay();return B3(r,0,1+(e<=F3?F3:F3+7)-e)}function kB(r){let e=r.getDay(),t=e===0?-3:F3-e;return B3(r.getFullYear(),r.getMonth(),r.getDate()+t)}function KI(r,e=!1){return function(t,n){let o;if(e){let i=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,s=t.getDate();o=1+Math.floor((s+i)/7)}else{let i=kB(t),s=hae(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Ys(o,r,V1(n,el.MinusSign))}}function L3(r,e=!1){return function(t,n){let i=kB(t).getFullYear();return Ys(i,r,V1(n,el.MinusSign),e)}}var GI={};function mae(r){if(GI[r])return GI[r];let e;switch(r){case"G":case"GG":case"GGG":e=tr(3,Kt.Abbreviated);break;case"GGGG":e=tr(3,Kt.Wide);break;case"GGGGG":e=tr(3,Kt.Narrow);break;case"y":e=Xr(0,1,0,!1,!0);break;case"yy":e=Xr(0,2,0,!0,!0);break;case"yyy":e=Xr(0,3,0,!1,!0);break;case"yyyy":e=Xr(0,4,0,!1,!0);break;case"Y":e=L3(1);break;case"YY":e=L3(2,!0);break;case"YYY":e=L3(3);break;case"YYYY":e=L3(4);break;case"M":case"L":e=Xr(1,1,1);break;case"MM":case"LL":e=Xr(1,2,1);break;case"MMM":e=tr(2,Kt.Abbreviated);break;case"MMMM":e=tr(2,Kt.Wide);break;case"MMMMM":e=tr(2,Kt.Narrow);break;case"LLL":e=tr(2,Kt.Abbreviated,so.Standalone);break;case"LLLL":e=tr(2,Kt.Wide,so.Standalone);break;case"LLLLL":e=tr(2,Kt.Narrow,so.Standalone);break;case"w":e=KI(1);break;case"ww":e=KI(2);break;case"W":e=KI(1,!0);break;case"d":e=Xr(2,1);break;case"dd":e=Xr(2,2);break;case"c":case"cc":e=Xr(7,1);break;case"ccc":e=tr(1,Kt.Abbreviated,so.Standalone);break;case"cccc":e=tr(1,Kt.Wide,so.Standalone);break;case"ccccc":e=tr(1,Kt.Narrow,so.Standalone);break;case"cccccc":e=tr(1,Kt.Short,so.Standalone);break;case"E":case"EE":case"EEE":e=tr(1,Kt.Abbreviated);break;case"EEEE":e=tr(1,Kt.Wide);break;case"EEEEE":e=tr(1,Kt.Narrow);break;case"EEEEEE":e=tr(1,Kt.Short);break;case"a":case"aa":case"aaa":e=tr(0,Kt.Abbreviated);break;case"aaaa":e=tr(0,Kt.Wide);break;case"aaaaa":e=tr(0,Kt.Narrow);break;case"b":case"bb":case"bbb":e=tr(0,Kt.Abbreviated,so.Standalone,!0);break;case"bbbb":e=tr(0,Kt.Wide,so.Standalone,!0);break;case"bbbbb":e=tr(0,Kt.Narrow,so.Standalone,!0);break;case"B":case"BB":case"BBB":e=tr(0,Kt.Abbreviated,so.Format,!0);break;case"BBBB":e=tr(0,Kt.Wide,so.Format,!0);break;case"BBBBB":e=tr(0,Kt.Narrow,so.Format,!0);break;case"h":e=Xr(3,1,-12);break;case"hh":e=Xr(3,2,-12);break;case"H":e=Xr(3,1);break;case"HH":e=Xr(3,2);break;case"m":e=Xr(4,1);break;case"mm":e=Xr(4,2);break;case"s":e=Xr(5,1);break;case"ss":e=Xr(5,2);break;case"S":e=Xr(6,1);break;case"SS":e=Xr(6,2);break;case"SSS":e=Xr(6,3);break;case"Z":case"ZZ":case"ZZZ":e=O3(0);break;case"ZZZZZ":e=O3(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=O3(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=O3(2);break;default:return null}return GI[r]=e,e}function RB(r,e){r=r.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+r)/6e4;return isNaN(t)?e:t}function gae(r,e){return r=new Date(r.getTime()),r.setMinutes(r.getMinutes()+e),r}function yae(r,e,t){let o=r.getTimezoneOffset(),i=RB(e,o);return gae(r,-1*(i-o))}function vae(r){if(wB(r))return r;if(typeof r=="number"&&!isNaN(r))return new Date(r);if(typeof r=="string"){if(r=r.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(r)){let[o,i=1,s=1]=r.split("-").map(a=>+a);return B3(o,i-1,s)}let t=parseFloat(r);if(!isNaN(r-t))return new Date(t);let n;if(n=r.match(cae))return wae(n)}let e=new Date(r);if(!wB(e))throw new be(2302,!1);return e}function wae(r){let e=new Date(0),t=0,n=0,o=r[8]?e.setUTCFullYear:e.setFullYear,i=r[8]?e.setUTCHours:e.setHours;r[9]&&(t=Number(r[9]+r[10]),n=Number(r[9]+r[11])),o.call(e,Number(r[1]),Number(r[2])-1,Number(r[3]));let s=Number(r[4]||0)-t,a=Number(r[5]||0)-n,c=Number(r[6]||0),l=Math.floor(parseFloat("0."+(r[7]||0))*1e3);return i.call(e,s,a,c,l),e}function wB(r){return r instanceof Date&&!isNaN(r.valueOf())}var WI=/\s+/,bB=[],of=(()=>{class r{_ngEl;_renderer;initialClasses=bB;rawClass;stateMap=new Map;constructor(t,n){this._ngEl=t,this._renderer=n}set klass(t){this.initialClasses=t!=null?t.trim().split(WI):bB}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(WI):t}ngDoCheck(){for(let n of this.initialClasses)this._updateState(n,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let n of t)this._updateState(n,!0);else if(t!=null)for(let n of Object.keys(t))this._updateState(n,!!t[n]);this._applyStateDiff()}_updateState(t,n){let o=this.stateMap.get(t);o!==void 0?(o.enabled!==n&&(o.changed=!0,o.enabled=n),o.touched=!0):this.stateMap.set(t,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let n=t[0],o=t[1];o.changed?(this._toggleClass(n,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),o.touched=!1}}_toggleClass(t,n){t=t.trim(),t.length>0&&t.split(WI).forEach(o=>{n?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(n){return new(n||r)(oe(io),oe(us))};static \u0275dir=Tt({type:r,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return r})();var U3=class{$implicit;ngForOf;index;count;constructor(e,t,n,o){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Xo=(()=>{class r{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,n,o){this._viewContainer=t,this._template=n,this._differs=o}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let n=this._viewContainer;t.forEachOperation((o,i,s)=>{if(o.previousIndex==null)n.createEmbeddedView(this._template,new U3(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)n.remove(i===null?void 0:i);else if(i!==null){let a=n.get(i);n.move(a,s),xB(a,o)}});for(let o=0,i=n.length;o<i;o++){let a=n.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{let i=n.get(o.currentIndex);xB(i,o)})}static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||r)(oe(Qc),oe(su),oe(HI))};static \u0275dir=Tt({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return r})();function xB(r,e){r.context.$implicit=e.item}var Ur=(()=>{class r{_viewContainer;_context=new V3;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,n){this._viewContainer=t,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){EB(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){EB(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||r)(oe(Qc),oe(su))};static \u0275dir=Tt({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return r})(),V3=class{$implicit=null;ngIf=null};function EB(r,e){if(r&&!r.createEmbeddedView)throw new be(2020,!1)}function YI(r,e){return new be(2100,!1)}var bae=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g,XI=(()=>{class r{transform(t){if(t==null)return null;if(typeof t!="string")throw YI(r,t);return t.replace(bae,n=>n[0].toUpperCase()+n.slice(1).toLowerCase())}static \u0275fac=function(n){return new(n||r)};static \u0275pipe=P1({name:"titlecase",type:r,pure:!0})}return r})(),sf=(()=>{class r{transform(t){if(t==null)return null;if(typeof t!="string")throw YI(r,t);return t.toUpperCase()}static \u0275fac=function(n){return new(n||r)};static \u0275pipe=P1({name:"uppercase",type:r,pure:!0})}return r})(),xae="mediumDate",NB=new De(""),OB=new De(""),af=(()=>{class r{locale;defaultTimezone;defaultOptions;constructor(t,n,o){this.locale=t,this.defaultTimezone=n,this.defaultOptions=o}transform(t,n,o,i){if(t==null||t===""||t!==t)return null;try{let s=n??this.defaultOptions?.dateFormat??xae,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return MB(t,s,i||this.locale,a)}catch(s){throw YI(r,s.message)}}static \u0275fac=function(n){return new(n||r)(oe(N1,16),oe(NB,24),oe(OB,24))};static \u0275pipe=P1({name:"date",type:r,pure:!0})}return r})();var Zt=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=Ai({type:r});static \u0275inj=Wo({})}return r})();function j1(r,e){e=encodeURIComponent(e);for(let t of r.split(";")){let n=t.indexOf("="),[o,i]=n==-1?[t,""]:[t.slice(0,n),t.slice(n+1)];if(o.trim()===e)return decodeURIComponent(i)}return null}var cf=class{};var LB="browser",Eae="server";function FB(r){return r===Eae}var $3=new De(""),e9=(()=>{class r{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,n){this._zone=n,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,o,i){return this._findPluginFor(n).addEventListener(t,n,o,i)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(i=>i.supports(t)),!n)throw new be(5101,!1);return this._eventNameToPlugin.set(t,n),n}static \u0275fac=function(n){return new(n||r)(xe($3),xe(Wr))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),H1=class{_doc;constructor(e){this._doc=e}manager},j3="ng-app-id";function BB(r){for(let e of r)e.remove()}function UB(r,e){let t=e.createElement("style");return t.textContent=r,t}function _ae(r,e,t,n){let o=r.head?.querySelectorAll(`style[${j3}="${e}"],link[${j3}="${e}"]`);if(o)for(let i of o)i.removeAttribute(j3),i instanceof HTMLLinkElement?n.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&t.set(i.textContent,{usage:0,elements:[i]})}function ZI(r,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",r),t}var t9=(()=>{class r{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(t,n,o,i={}){this.doc=t,this.appId=n,this.nonce=o,this.isServer=FB(i),_ae(t,n,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,n){for(let o of t)this.addUsage(o,this.inline,UB);n?.forEach(o=>this.addUsage(o,this.external,ZI))}removeStyles(t,n){for(let o of t)this.removeUsage(o,this.inline);n?.forEach(o=>this.removeUsage(o,this.external))}addUsage(t,n,o){let i=n.get(t);i?i.usage++:n.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(t,this.doc)))})}removeUsage(t,n){let o=n.get(t);o&&(o.usage--,o.usage<=0&&(BB(o.elements),n.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])BB(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[n,{elements:o}]of this.inline)o.push(this.addElement(t,UB(n,this.doc)));for(let[n,{elements:o}]of this.external)o.push(this.addElement(t,ZI(n,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,n){return this.nonce&&n.setAttribute("nonce",this.nonce),this.isServer&&n.setAttribute(j3,this.appId),t.appendChild(n)}static \u0275fac=function(n){return new(n||r)(xe(Gr),xe(v3),xe(b3,8),xe(Zh))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),QI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},r9=/%COMP%/g;var jB="%COMP%",Sae=`_nghost-${jB}`,Cae=`_ngcontent-${jB}`,Iae=!0,Aae=new De("",{providedIn:"root",factory:()=>Iae});function Dae(r){return Cae.replace(r9,r)}function Tae(r){return Sae.replace(r9,r)}function HB(r,e){return e.map(t=>t.replace(r9,r))}var n9=(()=>{class r{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,n,o,i,s,a,c,l=null,u=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=c,this.nonce=l,this.tracingService=u,this.platformIsServer=!1,this.defaultRenderer=new $1(t,s,c,this.platformIsServer,this.tracingService)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;let o=this.getOrCreateRenderer(t,n);return o instanceof H3?o.applyToHost(t):o instanceof z1&&o.applyStyles(),o}getOrCreateRenderer(t,n){let o=this.rendererByCompId,i=o.get(n.id);if(!i){let s=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,h=this.tracingService;switch(n.encapsulation){case Xc.Emulated:i=new H3(c,l,n,this.appId,u,s,a,d,h);break;case Xc.ShadowDom:return new JI(c,l,t,n,s,a,this.nonce,d,h);default:i=new z1(c,l,n,u,s,a,d,h);break}o.set(n.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(n){return new(n||r)(xe(e9),xe(t9),xe(v3),xe(Aae),xe(Gr),xe(Zh),xe(Wr),xe(b3),xe(M1,8))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),$1=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,n,o,i){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(QI[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(VB(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(VB(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new be(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,o){if(o){t=o+":"+t;let i=QI[o];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let o=QI[n];o?e.removeAttributeNS(o,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,o){o&(Ga.DashCase|Ga.Important)?e.style.setProperty(t,n,o&Ga.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Ga.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n,o){if(typeof e=="string"&&(e=ps().getGlobalEventTarget(this.doc,e),!e))throw new be(5102,!1);let i=this.decoratePreventDefault(n);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(e,t,i)),this.eventManager.addEventListener(e,t,i,o)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function VB(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var JI=class extends $1{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,n,o,i,s,a,c,l){super(e,i,s,c,l),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=HB(o.id,u);for(let h of u){let p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=h,this.shadowRoot.appendChild(p)}let d=o.getExternalStyles?.();if(d)for(let h of d){let p=ZI(h,i);a&&p.setAttribute("nonce",a),this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},z1=class extends $1{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,n,o,i,s,a,c,l){super(e,i,s,a,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=o;let u=n.styles;this.styles=l?HB(l,u):u,this.styleUrls=n.getExternalStyles?.(l)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},H3=class extends z1{contentAttr;hostAttr;constructor(e,t,n,o,i,s,a,c,l){let u=o+"-"+n.id;super(e,t,n,i,s,a,c,l,u),this.contentAttr=Dae(u),this.hostAttr=Tae(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}};var z3=class r extends L1{supportsDOMEvents=!0;static makeCurrent(){$I(new r)}onAndCancel(e,t,n,o){return e.addEventListener(t,n,o),()=>{e.removeEventListener(t,n,o)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=Pae();return t==null?null:Mae(t)}resetBaseElement(){q1=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return j1(document.cookie,e)}},q1=null;function Pae(){return q1=q1||document.head.querySelector("base"),q1?q1.getAttribute("href"):null}function Mae(r){return new URL(r,document.baseURI).pathname}var kae=(()=>{class r{build(){return new XMLHttpRequest}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),zB=(()=>{class r extends H1{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,o,i){return t.addEventListener(n,o,i),()=>this.removeEventListener(t,n,o,i)}removeEventListener(t,n,o,i){return t.removeEventListener(n,o,i)}static \u0275fac=function(n){return new(n||r)(xe(Gr))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),$B=["alt","control","meta","shift"],Rae={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nae={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},qB=(()=>{class r extends H1{constructor(t){super(t)}supports(t){return r.parseEventName(t)!=null}addEventListener(t,n,o,i){let s=r.parseEventName(n),a=r.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ps().onAndCancel(t,s.domEventName,a,i))}static parseEventName(t){let n=t.toLowerCase().split("."),o=n.shift();if(n.length===0||!(o==="keydown"||o==="keyup"))return null;let i=r._normalizeKey(n.pop()),s="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),s="code."),$B.forEach(l=>{let u=n.indexOf(l);u>-1&&(n.splice(u,1),s+=l+".")}),s+=i,n.length!=0||i.length===0)return null;let c={};return c.domEventName=o,c.fullKey=s,c}static matchEventFullKeyCode(t,n){let o=Rae[t.key]||t.key,i="";return n.indexOf("code.")>-1&&(o=t.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),$B.forEach(s=>{if(s!==o){let a=Nae[s];a(t)&&(i+=s+".")}}),i+=o,i===n)}static eventCallback(t,n,o){return i=>{r.matchEventFullKeyCode(i,t)&&o.runGuarded(()=>n(i))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(n){return new(n||r)(xe(Gr))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})();function o9(r,e){return dB(v({rootComponent:r},Oae(e)))}function Oae(r){return{appProviders:[...Vae,...r?.providers??[]],platformProviders:Uae}}function Lae(){z3.makeCurrent()}function Fae(){return new ja}function Bae(){return Q7(document),document}var Uae=[{provide:Zh,useValue:LB},{provide:w3,useValue:Lae,multi:!0},{provide:Gr,useFactory:Bae}];var Vae=[{provide:i1,useValue:"root"},{provide:ja,useFactory:Fae},{provide:$3,useClass:zB,multi:!0,deps:[Gr]},{provide:$3,useClass:qB,multi:!0,deps:[Gr]},n9,t9,e9,{provide:Zd,useExisting:n9},{provide:cf,useClass:kae},[]];var om=class{},K1=class{},du=class r{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let n=t.indexOf(":");if(n>0){let o=t.slice(0,n),i=t.slice(n+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,n)=>{this.addHeaderEntry(n,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,n])=>{this.setHeaderEntries(t,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof r?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new r;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof r?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(e.name,t);let o=(e.op==="a"?this.headers.get(t):void 0)||[];o.push(...n),this.headers.set(t,o);break;case"d":let i=e.value;if(!i)this.headers.delete(t),this.normalizedNames.delete(t);else{let s=this.headers.get(t);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,s)}break}}addHeaderEntry(e,t){let n=e.toLowerCase();this.maybeSetNormalizedName(e,n),this.headers.has(n)?this.headers.get(n).push(t):this.headers.set(n,[t])}setHeaderEntries(e,t){let n=(Array.isArray(t)?t:[t]).map(i=>i.toString()),o=e.toLowerCase();this.headers.set(o,n),this.maybeSetNormalizedName(e,o)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var K3=class{encodeKey(e){return KB(e)}encodeValue(e){return KB(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function jae(r,e){let t=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,i)),e.decodeValue(o.slice(i+1))],c=t.get(s)||[];c.push(a),t.set(s,c)}),t}var Hae=/%(\d[a-f0-9])/gi,$ae={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function KB(r){return encodeURIComponent(r).replace(Hae,(e,t)=>$ae[t]??e)}function q3(r){return`${r}`}var tl=class r{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new K3,e.fromString){if(e.fromObject)throw new be(2805,!1);this.map=jae(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let n=e.fromObject[t],o=Array.isArray(n)?n.map(q3):[q3(n)];this.map.set(t,o)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(n=>{let o=e[n];Array.isArray(o)?o.forEach(i=>{t.push({param:n,value:i,op:"a"})}):t.push({param:n,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(n=>t+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new r({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(q3(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let n=this.map.get(e.param)||[],o=n.indexOf(q3(e.value));o!==-1&&n.splice(o,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var G3=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function zae(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function GB(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function WB(r){return typeof Blob<"u"&&r instanceof Blob}function YB(r){return typeof FormData<"u"&&r instanceof FormData}function qae(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}var XB="Content-Type",QB="Accept",ZB="X-Request-URL",JB="text/plain",eU="application/json",Kae=`${eU}, ${JB}, */*`,nm=class r{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;keepalive=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(e,t,n,o){this.url=t,this.method=e.toUpperCase();let i;if(zae(this.method)||o?(this.body=n!==void 0?n:null,i=o):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,this.keepalive=!!i.keepalive,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new du,this.context??=new G3,!this.params)this.params=new tl,this.urlWithParams=t;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),c=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+c+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||GB(this.body)||WB(this.body)||YB(this.body)||qae(this.body)?this.body:this.body instanceof tl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||YB(this.body)?null:WB(this.body)?this.body.type||null:GB(this.body)?null:typeof this.body=="string"?JB:this.body instanceof tl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?eU:null}clone(e={}){let t=e.method||this.method,n=e.url||this.url,o=e.responseType||this.responseType,i=e.keepalive??this.keepalive,s=e.transferCache??this.transferCache,a=e.body!==void 0?e.body:this.body,c=e.withCredentials??this.withCredentials,l=e.reportProgress??this.reportProgress,u=e.headers||this.headers,d=e.params||this.params,h=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((p,m)=>p.set(m,e.setHeaders[m]),u)),e.setParams&&(d=Object.keys(e.setParams).reduce((p,m)=>p.set(m,e.setParams[m]),d)),new r(t,n,a,{params:d,headers:u,context:h,reportProgress:l,responseType:o,withCredentials:c,transferCache:s,keepalive:i})}},lf=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(lf||{}),im=class{headers;status;statusText;url;ok;type;constructor(e,t=200,n="OK"){this.headers=e.headers||new du,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},W3=class r extends im{constructor(e={}){super(e)}type=lf.ResponseHeader;clone(e={}){return new r({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},G1=class r extends im{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=lf.Response;clone(e={}){return new r({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},W1=class extends im{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Gae=200,Wae=204;function i9(r,e){return{body:e,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive}}var sm=(()=>{class r{handler;constructor(t){this.handler=t}request(t,n,o={}){let i;if(t instanceof nm)i=t;else{let c;o.headers instanceof du?c=o.headers:c=new du(o.headers);let l;o.params&&(o.params instanceof tl?l=o.params:l=new tl({fromObject:o.params})),i=new nm(t,n,o.body!==void 0?o.body:null,{headers:c,context:o.context,params:l,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache,keepalive:o.keepalive})}let s=Ve(i).pipe(Uc(c=>this.handler.handle(c)));if(t instanceof nm||o.observe==="events")return s;let a=s.pipe(_o(c=>c instanceof G1));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(Je(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new be(2806,!1);return c.body}));case"blob":return a.pipe(Je(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new be(2807,!1);return c.body}));case"text":return a.pipe(Je(c=>{if(c.body!==null&&typeof c.body!="string")throw new be(2808,!1);return c.body}));case"json":default:return a.pipe(Je(c=>c.body))}case"response":return a;default:throw new be(2809,!1)}}delete(t,n={}){return this.request("DELETE",t,n)}get(t,n={}){return this.request("GET",t,n)}head(t,n={}){return this.request("HEAD",t,n)}jsonp(t,n){return this.request("JSONP",t,{params:new tl().append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,n={}){return this.request("OPTIONS",t,n)}patch(t,n,o={}){return this.request("PATCH",t,i9(o,n))}post(t,n,o={}){return this.request("POST",t,i9(o,n))}put(t,n,o={}){return this.request("PUT",t,i9(o,n))}static \u0275fac=function(n){return new(n||r)(xe(om))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})();var Yae=new De("");function Xae(r,e){return e(r)}function Qae(r,e,t){return(n,o)=>Io(t,()=>e(n,i=>r(i,o)))}var tU=new De(""),rU=new De(""),nU=new De("",{providedIn:"root",factory:()=>!0});var Y3=(()=>{class r extends om{backend;injector;chain=null;pendingTasks=ie(Wb);contributeToStability=ie(nU);constructor(t,n){super(),this.backend=t,this.injector=n}handle(t){if(this.chain===null){let n=Array.from(new Set([...this.injector.get(tU),...this.injector.get(rU,[])]));this.chain=n.reduceRight((o,i)=>Qae(o,i,this.injector),Xae)}if(this.contributeToStability){let n=this.pendingTasks.add();return this.chain(t,o=>this.backend.handle(o)).pipe(Bd(n))}else return this.chain(t,n=>this.backend.handle(n))}static \u0275fac=function(n){return new(n||r)(xe(K1),xe(Kr))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})();var Zae=/^\)\]\}',?\n/,Jae=RegExp(`^${ZB}:`,"m");function ece(r){return"responseURL"in r&&r.responseURL?r.responseURL:Jae.test(r.getAllResponseHeaders())?r.getResponseHeader(ZB):null}var s9=(()=>{class r{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new be(-2800,!1);t.keepalive;let n=this.xhrFactory;return Ve(null).pipe(ro(()=>new ht(i=>{let s=n.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((w,E)=>s.setRequestHeader(w,E.join(","))),t.headers.has(QB)||s.setRequestHeader(QB,Kae),!t.headers.has(XB)){let w=t.detectContentTypeHeader();w!==null&&s.setRequestHeader(XB,w)}if(t.responseType){let w=t.responseType.toLowerCase();s.responseType=w!=="json"?w:"text"}let a=t.serializeBody(),c=null,l=()=>{if(c!==null)return c;let w=s.statusText||"OK",E=new du(s.getAllResponseHeaders()),S=ece(s)||t.url;return c=new W3({headers:E,status:s.status,statusText:w,url:S}),c},u=()=>{let{headers:w,status:E,statusText:S,url:A}=l(),M=null;E!==Wae&&(M=typeof s.response>"u"?s.responseText:s.response),E===0&&(E=M?Gae:0);let L=E>=200&&E<300;if(t.responseType==="json"&&typeof M=="string"){let F=M;M=M.replace(Zae,"");try{M=M!==""?JSON.parse(M):null}catch(Y){M=F,L&&(L=!1,M={error:Y,text:M})}}L?(i.next(new G1({body:M,headers:w,status:E,statusText:S,url:A||void 0})),i.complete()):i.error(new W1({error:M,headers:w,status:E,statusText:S,url:A||void 0}))},d=w=>{let{url:E}=l(),S=new W1({error:w,status:s.status||0,statusText:s.statusText||"Unknown Error",url:E||void 0});i.error(S)},h=!1,p=w=>{h||(i.next(l()),h=!0);let E={type:lf.DownloadProgress,loaded:w.loaded};w.lengthComputable&&(E.total=w.total),t.responseType==="text"&&s.responseText&&(E.partialText=s.responseText),i.next(E)},m=w=>{let E={type:lf.UploadProgress,loaded:w.loaded};w.lengthComputable&&(E.total=w.total),i.next(E)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),t.reportProgress&&(s.addEventListener("progress",p),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:lf.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),t.reportProgress&&(s.removeEventListener("progress",p),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(n){return new(n||r)(xe(cf))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})(),oU=new De(""),tce="XSRF-TOKEN",rce=new De("",{providedIn:"root",factory:()=>tce}),nce="X-XSRF-TOKEN",oce=new De("",{providedIn:"root",factory:()=>nce}),Y1=class{},ice=(()=>{class r{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,n){this.doc=t,this.cookieName=n}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=j1(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(n){return new(n||r)(xe(Gr),xe(rce))};static \u0275prov=he({token:r,factory:r.\u0275fac})}return r})();function sce(r,e){let t=r.url.toLowerCase();if(!ie(oU)||r.method==="GET"||r.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(r);let n=ie(Y1).getToken(),o=ie(oce);return n!=null&&!r.headers.has(o)&&(r=r.clone({headers:r.headers.set(o,n)})),e(r)}function a9(...r){let e=[sm,s9,Y3,{provide:om,useExisting:Y3},{provide:K1,useFactory:()=>ie(Yae,{optional:!0})??ie(s9)},{provide:tU,useValue:sce,multi:!0},{provide:oU,useValue:!0},{provide:Y1,useClass:ice}];for(let t of r)e.push(...t.\u0275providers);return Kc(e)}var sU=(()=>{class r{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(n){return new(n||r)(xe(Gr))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var ct="primary",uy=Symbol("RouteTitle"),f9=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function ff(r){return new f9(r)}function hU(r,e,t){let n=t.path.split("/");if(n.length>r.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<r.length))return null;let o={};for(let i=0;i<n.length;i++){let s=n[i],a=r[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:r.slice(0,n.length),posParams:o}}function cce(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!Ya(r[t],e[t]))return!1;return!0}function Ya(r,e){let t=r?p9(r):void 0,n=e?p9(e):void 0;if(!t||!n||t.length!=n.length)return!1;let o;for(let i=0;i<t.length;i++)if(o=t[i],!mU(r[o],e[o]))return!1;return!0}function p9(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function mU(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;let t=[...r].sort(),n=[...e].sort();return t.every((o,i)=>n[i]===o)}else return r===e}function gU(r){return r.length>0?r[r.length-1]:null}function nl(r){return oC(r)?r:cu(r)?yr(Promise.resolve(r)):Ve(r)}var lce={exact:vU,subset:wU},yU={exact:uce,subset:dce,ignored:()=>!0};function aU(r,e,t){return lce[t.paths](r.root,e.root,t.matrixParams)&&yU[t.queryParams](r.queryParams,e.queryParams)&&!(t.fragment==="exact"&&r.fragment!==e.fragment)}function uce(r,e){return Ya(r,e)}function vU(r,e,t){if(!uf(r.segments,e.segments)||!Z3(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!r.children[n]||!vU(r.children[n],e.children[n],t))return!1;return!0}function dce(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>mU(r[t],e[t]))}function wU(r,e,t){return bU(r,e,e.segments,t)}function bU(r,e,t,n){if(r.segments.length>t.length){let o=r.segments.slice(0,t.length);return!(!uf(o,t)||e.hasChildren()||!Z3(o,t,n))}else if(r.segments.length===t.length){if(!uf(r.segments,t)||!Z3(r.segments,t,n))return!1;for(let o in e.children)if(!r.children[o]||!wU(r.children[o],e.children[o],n))return!1;return!0}else{let o=t.slice(0,r.segments.length),i=t.slice(r.segments.length);return!uf(r.segments,o)||!Z3(r.segments,o,n)||!r.children[ct]?!1:bU(r.children[ct],e,i,n)}}function Z3(r,e,t){return e.every((n,o)=>yU[t](r[o].parameters,n.parameters))}var Qa=class{root;queryParams;fragment;_queryParamMap;constructor(e=new Nt([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=ff(this.queryParams),this._queryParamMap}toString(){return hce.serialize(this)}},Nt=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return J3(this)}},fu=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=ff(this.parameters),this._parameterMap}toString(){return EU(this)}};function fce(r,e){return uf(r,e)&&r.every((t,n)=>Ya(t.parameters,e[n].parameters))}function uf(r,e){return r.length!==e.length?!1:r.every((t,n)=>t.path===e[n].path)}function pce(r,e){let t=[];return Object.entries(r.children).forEach(([n,o])=>{n===ct&&(t=t.concat(e(o,n)))}),Object.entries(r.children).forEach(([n,o])=>{n!==ct&&(t=t.concat(e(o,n)))}),t}var dy=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>new pf,providedIn:"root"})}return r})(),pf=class{parse(e){let t=new m9(e);return new Qa(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${X1(e.root,!0)}`,n=yce(e.queryParams),o=typeof e.fragment=="string"?`#${mce(e.fragment)}`:"";return`${t}${n}${o}`}},hce=new pf;function J3(r){return r.segments.map(e=>EU(e)).join("/")}function X1(r,e){if(!r.hasChildren())return J3(r);if(e){let t=r.children[ct]?X1(r.children[ct],!1):"",n=[];return Object.entries(r.children).forEach(([o,i])=>{o!==ct&&n.push(`${o}:${X1(i,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=pce(r,(n,o)=>o===ct?[X1(r.children[ct],!1)]:[`${o}:${X1(n,!1)}`]);return Object.keys(r.children).length===1&&r.children[ct]!=null?`${J3(r)}/${t[0]}`:`${J3(r)}/(${t.join("//")})`}}function xU(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function X3(r){return xU(r).replace(/%3B/gi,";")}function mce(r){return encodeURI(r)}function h9(r){return xU(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function e4(r){return decodeURIComponent(r)}function cU(r){return e4(r.replace(/\+/g,"%20"))}function EU(r){return`${h9(r.path)}${gce(r.parameters)}`}function gce(r){return Object.entries(r).map(([e,t])=>`;${h9(e)}=${h9(t)}`).join("")}function yce(r){let e=Object.entries(r).map(([t,n])=>Array.isArray(n)?n.map(o=>`${X3(t)}=${X3(o)}`).join("&"):`${X3(t)}=${X3(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var vce=/^[^\/()?;#]+/;function c9(r){let e=r.match(vce);return e?e[0]:""}var wce=/^[^\/()?;=#]+/;function bce(r){let e=r.match(wce);return e?e[0]:""}var xce=/^[^=?&#]+/;function Ece(r){let e=r.match(xce);return e?e[0]:""}var _ce=/^[^&#]+/;function Sce(r){let e=r.match(_ce);return e?e[0]:""}var m9=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Nt([],{}):new Nt([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[ct]=new Nt(e,t)),n}parseSegment(){let e=c9(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new be(4009,!1);return this.capture(e),new fu(e4(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=bce(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let o=c9(this.remaining);o&&(n=o,this.capture(n))}e[e4(t)]=e4(n)}parseQueryParam(e){let t=Ece(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let s=Sce(this.remaining);s&&(n=s,this.capture(n))}let o=cU(t),i=cU(n);if(e.hasOwnProperty(o)){let s=e[o];Array.isArray(s)||(s=[s],e[o]=s),s.push(i)}else e[o]=i}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=c9(this.remaining),o=this.remaining[n.length];if(o!=="/"&&o!==")"&&o!==";")throw new be(4010,!1);let i;n.indexOf(":")>-1?(i=n.slice(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=ct);let s=this.parseChildren();t[i]=Object.keys(s).length===1?s[ct]:new Nt([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new be(4011,!1)}};function _U(r){return r.segments.length>0?new Nt([],{[ct]:r}):r}function SU(r){let e={};for(let[n,o]of Object.entries(r.children)){let i=SU(o);if(n===ct&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))e[s]=a;else(i.segments.length>0||i.hasChildren())&&(e[n]=i)}let t=new Nt(r.segments,e);return Cce(t)}function Cce(r){if(r.numberOfChildren===1&&r.children[ct]){let e=r.children[ct];return new Nt(r.segments.concat(e.segments),e.children)}return r}function pu(r){return r instanceof Qa}function CU(r,e,t=null,n=null){let o=IU(r);return AU(o,e,t,n)}function IU(r){let e;function t(i){let s={};for(let c of i.children){let l=t(c);s[c.outlet]=l}let a=new Nt(i.url,s);return i===r&&(e=a),a}let n=t(r.root),o=_U(n);return e??o}function AU(r,e,t,n){let o=r;for(;o.parent;)o=o.parent;if(e.length===0)return l9(o,o,o,t,n);let i=Ice(e);if(i.toRoot())return l9(o,o,new Nt([],{}),t,n);let s=Ace(i,o,r),a=s.processChildren?Z1(s.segmentGroup,s.index,i.commands):TU(s.segmentGroup,s.index,i.commands);return l9(o,s.segmentGroup,a,t,n)}function t4(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function ty(r){return typeof r=="object"&&r!=null&&r.outlets}function l9(r,e,t,n,o){let i={};n&&Object.entries(n).forEach(([c,l])=>{i[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`});let s;r===e?s=t:s=DU(r,e,t);let a=_U(SU(s));return new Qa(a,i,o)}function DU(r,e,t){let n={};return Object.entries(r.children).forEach(([o,i])=>{i===e?n[o]=t:n[o]=DU(i,e,t)}),new Nt(r.segments,n)}var r4=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&t4(n[0]))throw new be(4003,!1);let o=n.find(ty);if(o&&o!==gU(n))throw new be(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Ice(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new r4(!0,0,r);let e=0,t=!1,n=r.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new r4(t,e,n)}var lm=class{segmentGroup;processChildren;index;constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function Ace(r,e,t){if(r.isAbsolute)return new lm(e,!0,0);if(!t)return new lm(e,!1,NaN);if(t.parent===null)return new lm(t,!0,0);let n=t4(r.commands[0])?0:1,o=t.segments.length-1+n;return Dce(t,o,r.numberOfDoubleDots)}function Dce(r,e,t){let n=r,o=e,i=t;for(;i>o;){if(i-=o,n=n.parent,!n)throw new be(4005,!1);o=n.segments.length}return new lm(n,!1,o-i)}function Tce(r){return ty(r[0])?r[0].outlets:{[ct]:r}}function TU(r,e,t){if(r??=new Nt([],{}),r.segments.length===0&&r.hasChildren())return Z1(r,e,t);let n=Pce(r,e,t),o=t.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){let i=new Nt(r.segments.slice(0,n.pathIndex),{});return i.children[ct]=new Nt(r.segments.slice(n.pathIndex),r.children),Z1(i,0,o)}else return n.match&&o.length===0?new Nt(r.segments,{}):n.match&&!r.hasChildren()?g9(r,e,t):n.match?Z1(r,0,o):g9(r,e,t)}function Z1(r,e,t){if(t.length===0)return new Nt(r.segments,{});{let n=Tce(t),o={};if(Object.keys(n).some(i=>i!==ct)&&r.children[ct]&&r.numberOfChildren===1&&r.children[ct].segments.length===0){let i=Z1(r.children[ct],e,t);return new Nt(r.segments,i.children)}return Object.entries(n).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=TU(r.children[i],e,s))}),Object.entries(r.children).forEach(([i,s])=>{n[i]===void 0&&(o[i]=s)}),new Nt(r.segments,o)}}function Pce(r,e,t){let n=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};for(;o<r.segments.length;){if(n>=t.length)return i;let s=r.segments[o],a=t[n];if(ty(a))break;let c=`${a}`,l=n<t.length-1?t[n+1]:null;if(o>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!uU(c,l,s))return i;n+=2}else{if(!uU(c,{},s))return i;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}function g9(r,e,t){let n=r.segments.slice(0,e),o=0;for(;o<t.length;){let i=t[o];if(ty(i)){let c=Mce(i.outlets);return new Nt(n,c)}if(o===0&&t4(t[0])){let c=r.segments[e];n.push(new fu(c.path,lU(t[0]))),o++;continue}let s=ty(i)?i.outlets[ct]:`${i}`,a=o<t.length-1?t[o+1]:null;s&&a&&t4(a)?(n.push(new fu(s,lU(a))),o+=2):(n.push(new fu(s,{})),o++)}return new Nt(n,{})}function Mce(r){let e={};return Object.entries(r).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=g9(new Nt([],{}),0,n))}),e}function lU(r){let e={};return Object.entries(r).forEach(([t,n])=>e[t]=`${n}`),e}function uU(r,e,t){return r==t.path&&Ya(e,t.parameters)}var J1="imperative",xn=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(xn||{}),Mi=class{id;url;constructor(e,t){this.id=e,this.url=t}},hf=class extends Mi{type=xn.NavigationStart;navigationTrigger;restoredState;constructor(e,t,n="imperative",o=null){super(e,t),this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Zs=class extends Mi{urlAfterRedirects;type=xn.NavigationEnd;constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ko=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r[r.Aborted=4]="Aborted",r}(ko||{}),ry=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(ry||{}),Xa=class extends Mi{reason;code;type=xn.NavigationCancel;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},rl=class extends Mi{reason;code;type=xn.NavigationSkipped;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}},dm=class extends Mi{error;target;type=xn.NavigationError;constructor(e,t,n,o){super(e,t),this.error=n,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ny=class extends Mi{urlAfterRedirects;state;type=xn.RoutesRecognized;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},n4=class extends Mi{urlAfterRedirects;state;type=xn.GuardsCheckStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},o4=class extends Mi{urlAfterRedirects;state;shouldActivate;type=xn.GuardsCheckEnd;constructor(e,t,n,o,i){super(e,t),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},i4=class extends Mi{urlAfterRedirects;state;type=xn.ResolveStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},s4=class extends Mi{urlAfterRedirects;state;type=xn.ResolveEnd;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},a4=class{route;type=xn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},c4=class{route;type=xn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},l4=class{snapshot;type=xn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},u4=class{snapshot;type=xn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},d4=class{snapshot;type=xn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},f4=class{snapshot;type=xn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var oy=class{},fm=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function kce(r){return!(r instanceof oy)&&!(r instanceof fm)}function Rce(r,e){return r.providers&&!r._injector&&(r._injector=T1(r.providers,e,`Route: ${r.path}`)),r._injector??e}function Qs(r){return r.outlet||ct}function Nce(r,e){let t=r.filter(n=>Qs(n)===e);return t.push(...r.filter(n=>Qs(n)!==e)),t}function fy(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let e=r.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var p4=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return fy(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new mm(this.rootInjector)}},mm=(()=>{class r{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,n){let o=this.getOrCreateContext(t);o.outlet=n,this.contexts.set(t,o)}onChildOutletDestroyed(t){let n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new p4(this.rootInjector),this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(n){return new(n||r)(xe(Kr))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),h4=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=y9(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=y9(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=v9(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return v9(e,this._root).map(t=>t.value)}};function y9(r,e){if(r===e.value)return e;for(let t of e.children){let n=y9(r,t);if(n)return n}return null}function v9(r,e){if(r===e.value)return[e];for(let t of e.children){let n=v9(r,t);if(n.length)return n.unshift(e),n}return[]}var Pi=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function cm(r){let e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}var iy=class extends h4{snapshot;constructor(e,t){super(e),this.snapshot=t,I9(this,e)}toString(){return this.snapshot.toString()}};function PU(r){let e=Oce(r),t=new un([new fu("",{})]),n=new un({}),o=new un({}),i=new un({}),s=new un(""),a=new Js(t,n,i,s,o,ct,r,e.root);return a.snapshot=e.root,new iy(new Pi(a,[]),e)}function Oce(r){let e={},t={},n={},o="",i=new df([],e,n,o,t,ct,r,null,{});return new sy("",new Pi(i,[]))}var Js=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,n,o,i,s,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(Je(l=>l[uy]))??Ve(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Je(e=>ff(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Je(e=>ff(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function m4(r,e,t="emptyOnly"){let n,{routeConfig:o}=r;return e!==null&&(t==="always"||o?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:v(v({},e.params),r.params),data:v(v({},e.data),r.data),resolve:v(v(v(v({},r.data),e.data),o?.data),r._resolvedData)}:n={params:v({},r.params),data:v({},r.data),resolve:v(v({},r.data),r._resolvedData??{})},o&&kU(o)&&(n.resolve[uy]=o.title),n}var df=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[uy]}constructor(e,t,n,o,i,s,a,c,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=ff(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=ff(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},sy=class extends h4{url;constructor(e,t){super(t),this.url=e,I9(this,t)}toString(){return MU(this._root)}};function I9(r,e){e.value._routerState=r,e.children.forEach(t=>I9(r,t))}function MU(r){let e=r.children.length>0?` { ${r.children.map(MU).join(", ")} } `:"";return`${r.value}${e}`}function u9(r){if(r.snapshot){let e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,Ya(e.queryParams,t.queryParams)||r.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&r.fragmentSubject.next(t.fragment),Ya(e.params,t.params)||r.paramsSubject.next(t.params),cce(e.url,t.url)||r.urlSubject.next(t.url),Ya(e.data,t.data)||r.dataSubject.next(t.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function w9(r,e){let t=Ya(r.params,e.params)&&fce(r.url,e.url),n=!r.parent!=!e.parent;return t&&!n&&(!r.parent||w9(r.parent,e.parent))}function kU(r){return typeof r.title=="string"||r.title===null}var RU=new De(""),py=(()=>{class r{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=ct;activateEvents=new Rt;deactivateEvents=new Rt;attachEvents=new Rt;detachEvents=new Rt;routerOutletData=uB(void 0);parentContexts=ie(mm);location=ie(Qc);changeDetector=ie(nf);inputBinder=ie(w4,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:n,previousValue:o}=t.name;if(n)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new be(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new be(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new be(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new be(4013,!1);this._activatedRoute=t;let o=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new b9(t,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:c,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(n){return new(n||r)};static \u0275dir=Tt({type:r,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[ls]})}return r})(),b9=class{route;childContexts;parent;outletData;constructor(e,t,n,o){this.route=e,this.childContexts=t,this.parent=n,this.outletData=o}get(e,t){return e===Js?this.route:e===mm?this.childContexts:e===RU?this.outletData:this.parent.get(e,t)}},w4=new De("");var A9=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Qt({type:r,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(n,o){n&1&&Bt(0,"router-outlet")},dependencies:[py],encapsulation:2})}return r})();function D9(r){let e=r.children&&r.children.map(D9),t=e?I(v({},r),{children:e}):v({},r);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ct&&(t.component=A9),t}function Lce(r,e,t){let n=ay(r,e._root,t?t._root:void 0);return new iy(n,e)}function ay(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let o=Fce(r,e,t);return new Pi(n,o)}else{if(r.shouldAttach(e.value)){let i=r.retrieve(e.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>ay(r,a)),s}}let n=Bce(e.value),o=e.children.map(i=>ay(r,i));return new Pi(n,o)}}function Fce(r,e,t){return e.children.map(n=>{for(let o of t.children)if(r.shouldReuseRoute(n.value,o.value.snapshot))return ay(r,n,o);return ay(r,n)})}function Bce(r){return new Js(new un(r.url),new un(r.params),new un(r.queryParams),new un(r.fragment),new un(r.data),r.outlet,r.component,r)}var pm=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},NU="ngNavigationCancelingError";function g4(r,e){let{redirectTo:t,navigationBehaviorOptions:n}=pu(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=OU(!1,ko.Redirect);return o.url=t,o.navigationBehaviorOptions=n,o}function OU(r,e){let t=new Error(`NavigationCancelingError: ${r||""}`);return t[NU]=!0,t.cancellationCode=e,t}function Uce(r){return LU(r)&&pu(r.url)}function LU(r){return!!r&&r[NU]}var Vce=(r,e,t,n)=>Je(o=>(new x9(e,o.targetRouterState,o.currentRouterState,t,n).activate(r),o)),x9=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,n,o,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=i}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),u9(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let o=cm(t);e.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],n),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,n)})}deactivateRoutes(e,t,n){let o=e.value,i=t?t.value:null;if(o===i)if(o.component){let s=n.getContext(o.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,i=cm(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(n&&n.outlet){let s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,i=cm(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let o=cm(t);e.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],n),this.forwardEvent(new f4(i.value.snapshot))}),e.children.length&&this.forwardEvent(new u4(e.value.snapshot))}activateRoutes(e,t,n){let o=e.value,i=t?t.value:null;if(u9(o),o===i)if(o.component){let s=n.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,n);else if(o.component){let s=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),u9(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,n)}},y4=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},um=class{component;route;constructor(e,t){this.component=e,this.route=t}};function jce(r,e,t){let n=r._root,o=e?e._root:null;return Q1(n,o,t,[n.value])}function Hce(r){let e=r.routeConfig?r.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:r,guards:e}}function gm(r,e){let t=Symbol(),n=e.get(r,t);return n===t?typeof r=="function"&&!_C(r)?r:e.get(r):n}function Q1(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=cm(e);return r.children.forEach(s=>{$ce(s,i[s.value.outlet],t,n.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>ey(a,t.getContext(s),o)),o}function $ce(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=r.value,s=e?e.value:null,a=t?t.getContext(r.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let c=zce(s,i,i.routeConfig.runGuardsAndResolvers);c?o.canActivateChecks.push(new y4(n)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Q1(r,e,a?a.children:null,n,o):Q1(r,e,t,n,o),c&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new um(a.outlet.component,s))}else s&&ey(e,a,o),o.canActivateChecks.push(new y4(n)),i.component?Q1(r,null,a?a.children:null,n,o):Q1(r,null,t,n,o);return o}function zce(r,e,t){if(typeof t=="function")return t(r,e);switch(t){case"pathParamsChange":return!uf(r.url,e.url);case"pathParamsOrQueryParamsChange":return!uf(r.url,e.url)||!Ya(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!w9(r,e)||!Ya(r.queryParams,e.queryParams);case"paramsChange":default:return!w9(r,e)}}function ey(r,e,t){let n=cm(r),o=r.value;Object.entries(n).forEach(([i,s])=>{o.component?e?ey(s,e.children.getContext(i),t):ey(s,null,t):ey(s,e,t)}),o.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new um(e.outlet.component,o)):t.canDeactivateChecks.push(new um(null,o)):t.canDeactivateChecks.push(new um(null,o))}function hy(r){return typeof r=="function"}function qce(r){return typeof r=="boolean"}function Kce(r){return r&&hy(r.canLoad)}function Gce(r){return r&&hy(r.canActivate)}function Wce(r){return r&&hy(r.canActivateChild)}function Yce(r){return r&&hy(r.canDeactivate)}function Xce(r){return r&&hy(r.canMatch)}function FU(r){return r instanceof $s||r?.name==="EmptyError"}var Q3=Symbol("INITIAL_VALUE");function hm(){return ro(r=>wb(r.map(e=>e.pipe(Vc(1),lC(Q3)))).pipe(Je(e=>{for(let t of e)if(t!==!0){if(t===Q3)return Q3;if(t===!1||Qce(t))return t}return!0}),_o(e=>e!==Q3),Vc(1)))}function Qce(r){return pu(r)||r instanceof pm}function Zce(r,e){return qr(t=>{let{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=t;return s.length===0&&i.length===0?Ve(I(v({},t),{guardsResult:!0})):Jce(s,n,o,r).pipe(qr(a=>a&&qce(a)?ele(n,i,r,e):Ve(a)),Je(a=>I(v({},t),{guardsResult:a})))})}function Jce(r,e,t,n){return yr(r).pipe(qr(o=>ile(o.component,o.route,t,e,n)),jc(o=>o!==!0,!0))}function ele(r,e,t,n){return yr(e).pipe(Uc(o=>Fh(rle(o.route.parent,n),tle(o.route,n),ole(r,o.path,t),nle(r,o.route,t))),jc(o=>o!==!0,!0))}function tle(r,e){return r!==null&&e&&e(new d4(r)),Ve(!0)}function rle(r,e){return r!==null&&e&&e(new l4(r)),Ve(!0)}function nle(r,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return Ve(!0);let o=n.map(i=>J0(()=>{let s=fy(e)??t,a=gm(i,s),c=Gce(a)?a.canActivate(e,r):Io(s,()=>a(e,r));return nl(c).pipe(jc())}));return Ve(o).pipe(hm())}function ole(r,e,t){let n=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(s=>Hce(s)).filter(s=>s!==null).map(s=>J0(()=>{let a=s.guards.map(c=>{let l=fy(s.node)??t,u=gm(c,l),d=Wce(u)?u.canActivateChild(n,r):Io(l,()=>u(n,r));return nl(d).pipe(jc())});return Ve(a).pipe(hm())}));return Ve(i).pipe(hm())}function ile(r,e,t,n,o){let i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!i||i.length===0)return Ve(!0);let s=i.map(a=>{let c=fy(e)??o,l=gm(a,c),u=Yce(l)?l.canDeactivate(r,e,t,n):Io(c,()=>l(r,e,t,n));return nl(u).pipe(jc())});return Ve(s).pipe(hm())}function sle(r,e,t,n){let o=e.canLoad;if(o===void 0||o.length===0)return Ve(!0);let i=o.map(s=>{let a=gm(s,r),c=Kce(a)?a.canLoad(e,t):Io(r,()=>a(e,t));return nl(c)});return Ve(i).pipe(hm(),BU(n))}function BU(r){return ZS(yn(e=>{if(typeof e!="boolean")throw g4(r,e)}),Je(e=>e===!0))}function ale(r,e,t,n){let o=e.canMatch;if(!o||o.length===0)return Ve(!0);let i=o.map(s=>{let a=gm(s,r),c=Xce(a)?a.canMatch(e,t):Io(r,()=>a(e,t));return nl(c)});return Ve(i).pipe(hm(),BU(n))}var cy=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},ly=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function am(r){return Si(new cy(r))}function cle(r){return Si(new be(4e3,!1))}function lle(r){return Si(OU(!1,ko.GuardRejected))}var E9=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],o=t.root;for(;;){if(n=n.concat(o.segments),o.numberOfChildren===0)return Ve(n);if(o.numberOfChildren>1||!o.children[ct])return cle(`${e.redirectTo}`);o=o.children[ct]}}applyRedirectCommands(e,t,n,o,i){return ule(t,o,i).pipe(Je(s=>{if(s instanceof Qa)throw new ly(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),e,n);if(s[0]==="/")throw new ly(a);return a}))}applyRedirectCreateUrlTree(e,t,n,o){let i=this.createSegmentGroup(e,t.root,n,o);return new Qa(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);n[o]=t[a]}else n[o]=i}),n}createSegmentGroup(e,t,n,o){let i=this.createSegments(e,t.segments,n,o),s={};return Object.entries(t.children).forEach(([a,c])=>{s[a]=this.createSegmentGroup(e,c,n,o)}),new Nt(i,s)}createSegments(e,t,n,o){return t.map(i=>i.path[0]===":"?this.findPosParam(e,i,o):this.findOrReturn(i,n))}findPosParam(e,t,n){let o=n[t.path.substring(1)];if(!o)throw new be(4001,!1);return o}findOrReturn(e,t){let n=0;for(let o of t){if(o.path===e.path)return t.splice(n),o;n++}return e}};function ule(r,e,t){if(typeof r=="string")return Ve(r);let n=r,{queryParams:o,fragment:i,routeConfig:s,url:a,outlet:c,params:l,data:u,title:d}=e;return nl(Io(t,()=>n({params:l,data:u,queryParams:o,fragment:i,routeConfig:s,url:a,outlet:c,title:d})))}var _9={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function dle(r,e,t,n,o){let i=UU(r,e,t);return i.matched?(n=Rce(e,n),ale(n,e,t,o).pipe(Je(s=>s===!0?i:v({},_9)))):Ve(i)}function UU(r,e,t){if(e.path==="**")return fle(t);if(e.path==="")return e.pathMatch==="full"&&(r.hasChildren()||t.length>0)?v({},_9):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let o=(e.matcher||hU)(t,r,e);if(!o)return v({},_9);let i={};Object.entries(o.posParams??{}).forEach(([a,c])=>{i[a]=c.path});let s=o.consumed.length>0?v(v({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function fle(r){return{matched:!0,parameters:r.length>0?gU(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function dU(r,e,t,n){return t.length>0&&mle(r,t,n)?{segmentGroup:new Nt(e,hle(n,new Nt(t,r.children))),slicedSegments:[]}:t.length===0&&gle(r,t,n)?{segmentGroup:new Nt(r.segments,ple(r,t,n,r.children)),slicedSegments:t}:{segmentGroup:new Nt(r.segments,r.children),slicedSegments:t}}function ple(r,e,t,n){let o={};for(let i of t)if(b4(r,e,i)&&!n[Qs(i)]){let s=new Nt([],{});o[Qs(i)]=s}return v(v({},n),o)}function hle(r,e){let t={};t[ct]=e;for(let n of r)if(n.path===""&&Qs(n)!==ct){let o=new Nt([],{});t[Qs(n)]=o}return t}function mle(r,e,t){return t.some(n=>b4(r,e,n)&&Qs(n)!==ct)}function gle(r,e,t){return t.some(n=>b4(r,e,n))}function b4(r,e,t){return(r.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function yle(r,e,t){return e.length===0&&!r.children[t]}var S9=class{};function vle(r,e,t,n,o,i,s="emptyOnly"){return new C9(r,e,t,n,o,s,i).recognize()}var wle=31,C9=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,n,o,i,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new E9(this.urlSerializer,this.urlTree)}noMatchError(e){return new be(4002,`'${e.segmentGroup}'`)}recognize(){let e=dU(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Je(({children:t,rootSnapshot:n})=>{let o=new Pi(n,t),i=new sy("",o),s=CU(n,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(e){let t=new df([],Object.freeze({}),Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ct,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,ct,t).pipe(Je(n=>({children:n,rootSnapshot:t})),dn(n=>{if(n instanceof ly)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof cy?this.noMatchError(n):n}))}processSegmentGroup(e,t,n,o,i){return n.segments.length===0&&n.hasChildren()?this.processChildren(e,t,n,i):this.processSegment(e,t,n,n.segments,o,!0,i).pipe(Je(s=>s instanceof Pi?[s]:[]))}processChildren(e,t,n,o){let i=[];for(let s of Object.keys(n.children))s==="primary"?i.unshift(s):i.push(s);return yr(i).pipe(Uc(s=>{let a=n.children[s],c=Nce(t,s);return this.processSegmentGroup(e,c,a,s,o)}),cC((s,a)=>(s.push(...a),s)),Gl(null),aC(),qr(s=>{if(s===null)return am(n);let a=VU(s);return ble(a),Ve(a)}))}processSegment(e,t,n,o,i,s,a){return yr(t).pipe(Uc(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,n,o,i,s,a).pipe(dn(l=>{if(l instanceof cy)return Ve(null);throw l}))),jc(c=>!!c),dn(c=>{if(FU(c))return yle(n,o,i)?Ve(new S9):am(n);throw c}))}processSegmentAgainstRoute(e,t,n,o,i,s,a,c){return Qs(n)!==s&&(s===ct||!b4(o,i,n))?am(o):n.redirectTo===void 0?this.matchSegmentAgainstRoute(e,o,n,i,s,c):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,o,t,n,i,s,c):am(o)}expandSegmentAgainstRouteUsingRedirect(e,t,n,o,i,s,a){let{matched:c,parameters:l,consumedSegments:u,positionalParamSegments:d,remainingSegments:h}=UU(t,o,i);if(!c)return am(t);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>wle&&(this.allowRedirects=!1));let p=new df(i,l,Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,fU(o),Qs(o),o.component??o._loadedComponent??null,o,pU(o)),m=m4(p,a,this.paramsInheritanceStrategy);return p.params=Object.freeze(m.params),p.data=Object.freeze(m.data),this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,p,e).pipe(ro(E=>this.applyRedirects.lineralizeSegments(o,E)),qr(E=>this.processSegment(e,n,t,E.concat(h),s,!1,a)))}matchSegmentAgainstRoute(e,t,n,o,i,s){let a=dle(t,n,o,e,this.urlSerializer);return n.path==="**"&&(t.children={}),a.pipe(ro(c=>c.matched?(e=n._injector??e,this.getChildConfig(e,n,o).pipe(ro(({routes:l})=>{let u=n._loadedInjector??e,{parameters:d,consumedSegments:h,remainingSegments:p}=c,m=new df(h,d,Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,fU(n),Qs(n),n.component??n._loadedComponent??null,n,pU(n)),w=m4(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(w.params),m.data=Object.freeze(w.data);let{segmentGroup:E,slicedSegments:S}=dU(t,h,p,l);if(S.length===0&&E.hasChildren())return this.processChildren(u,l,E,m).pipe(Je(M=>new Pi(m,M)));if(l.length===0&&S.length===0)return Ve(new Pi(m,[]));let A=Qs(n)===i;return this.processSegment(u,l,E,S,A?ct:i,!0,m).pipe(Je(M=>new Pi(m,M instanceof Pi?[M]:[])))}))):am(t)))}getChildConfig(e,t,n){return t.children?Ve({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Ve({routes:t._loadedRoutes,injector:t._loadedInjector}):sle(e,t,n,this.urlSerializer).pipe(qr(o=>o?this.configLoader.loadChildren(e,t).pipe(yn(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):lle(t))):Ve({routes:[],injector:e})}};function ble(r){r.sort((e,t)=>e.value.outlet===ct?-1:t.value.outlet===ct?1:e.value.outlet.localeCompare(t.value.outlet))}function xle(r){let e=r.value.routeConfig;return e&&e.path===""}function VU(r){let e=[],t=new Set;for(let n of r){if(!xle(n)){e.push(n);continue}let o=e.find(i=>n.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...n.children),t.add(o)):e.push(n)}for(let n of t){let o=VU(n.children);e.push(new Pi(n.value,o))}return e.filter(n=>!t.has(n))}function fU(r){return r.data||{}}function pU(r){return r.resolve||{}}function Ele(r,e,t,n,o,i){return qr(s=>vle(r,e,t,n,s.extractedUrl,o,i).pipe(Je(({state:a,tree:c})=>I(v({},s),{targetSnapshot:a,urlAfterRedirects:c}))))}function _le(r,e){return qr(t=>{let{targetSnapshot:n,guards:{canActivateChecks:o}}=t;if(!o.length)return Ve(t);let i=new Set(o.map(c=>c.route)),s=new Set;for(let c of i)if(!s.has(c))for(let l of jU(c))s.add(l);let a=0;return yr(s).pipe(Uc(c=>i.has(c)?Sle(c,n,r,e):(c.data=m4(c,c.parent,r).resolve,Ve(void 0))),yn(()=>a++),Bh(1),qr(c=>a===s.size?Ve(t):Ko))})}function jU(r){let e=r.children.map(t=>jU(t)).flat();return[r,...e]}function Sle(r,e,t,n){let o=r.routeConfig,i=r._resolve;return o?.title!==void 0&&!kU(o)&&(i[uy]=o.title),J0(()=>(r.data=m4(r,r.parent,t).resolve,Cle(i,r,e,n).pipe(Je(s=>(r._resolvedData=s,r.data=v(v({},r.data),s),null)))))}function Cle(r,e,t,n){let o=p9(r);if(o.length===0)return Ve({});let i={};return yr(o).pipe(qr(s=>Ile(r[s],e,t,n).pipe(jc(),yn(a=>{if(a instanceof pm)throw g4(new pf,a);i[s]=a}))),Bh(1),Je(()=>i),dn(s=>FU(s)?Ko:Si(s)))}function Ile(r,e,t,n){let o=fy(e)??n,i=gm(r,o),s=i.resolve?i.resolve(e,t):Io(o,()=>i(e,t));return nl(s)}function d9(r){return ro(e=>{let t=r(e);return t?yr(t).pipe(Je(()=>e)):Ve(e)})}var T9=(()=>{class r{buildTitle(t){let n,o=t.root;for(;o!==void 0;)n=this.getResolvedTitleForRoute(o)??n,o=o.children.find(i=>i.outlet===ct);return n}getResolvedTitleForRoute(t){return t.data[uy]}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(HU),providedIn:"root"})}return r})(),HU=(()=>{class r extends T9{title;constructor(t){super(),this.title=t}updateTitle(t){let n=this.buildTitle(t);n!==void 0&&this.title.setTitle(n)}static \u0275fac=function(n){return new(n||r)(xe(sU))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),ym=new De("",{providedIn:"root",factory:()=>({})}),my=new De(""),$U=(()=>{class r{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ie(RI);loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Ve(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let n=nl(t.loadComponent()).pipe(Je(qU),yn(i=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=i}),Bd(()=>{this.componentLoaders.delete(t)})),o=new Nh(n,()=>new qt).pipe(Rh());return this.componentLoaders.set(t,o),o}loadChildren(t,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Ve({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);let i=zU(n,this.compiler,t,this.onLoadEndListener).pipe(Bd(()=>{this.childrenLoaders.delete(n)})),s=new Nh(i,()=>new qt).pipe(Rh());return this.childrenLoaders.set(n,s),s}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function zU(r,e,t,n){return nl(r.loadChildren()).pipe(Je(qU),qr(o=>o instanceof I3||Array.isArray(o)?Ve(o):yr(e.compileModuleAsync(o))),Je(o=>{n&&n(r);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(t).injector,s=i.get(my,[],{optional:!0,self:!0}).flat()),{routes:s.map(D9),injector:i}}))}function Ale(r){return r&&typeof r=="object"&&"default"in r}function qU(r){return Ale(r)?r.default:r}var x4=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(Dle),providedIn:"root"})}return r})(),Dle=(()=>{class r{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),KU=new De("");var GU=new De(""),WU=(()=>{class r{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new qt;transitionAbortWithErrorSubject=new qt;configLoader=ie($U);environmentInjector=ie(Kr);destroyRef=ie(ou);urlSerializer=ie(dy);rootContexts=ie(mm);location=ie(rm);inputBindingEnabled=ie(w4,{optional:!0})!==null;titleStrategy=ie(T9);options=ie(ym,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ie(x4);createViewTransition=ie(KU,{optional:!0});navigationErrorHandler=ie(GU,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ve(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=o=>this.events.next(new a4(o)),n=o=>this.events.next(new c4(o));this.configLoader.onLoadEndListener=n,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let n=++this.navigationId;this.transitions?.next(I(v({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:n}))}setupNavigations(t){return this.transitions=new un(null),this.transitions.pipe(_o(n=>n!==null),ro(n=>{let o=!1;return Ve(n).pipe(ro(i=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",ko.SupersededByNewNavigation),Ko;this.currentTransition=n,this.currentNavigation={id:i.id,initialUrl:i.rawUrl,extractedUrl:i.extractedUrl,targetBrowserUrl:typeof i.extras.browserUrl=="string"?this.urlSerializer.parse(i.extras.browserUrl):i.extras.browserUrl,trigger:i.source,extras:i.extras,previousNavigation:this.lastSuccessfulNavigation?I(v({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>i.abortController.abort()};let s=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=i.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!s&&a!=="reload"){let c="";return this.events.next(new rl(i.id,this.urlSerializer.serialize(i.rawUrl),c,ry.IgnoredSameUrlNavigation)),i.resolve(!1),Ko}if(this.urlHandlingStrategy.shouldProcessUrl(i.rawUrl))return Ve(i).pipe(ro(c=>(this.events.next(new hf(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?Ko:Promise.resolve(c))),Ele(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),yn(c=>{n.targetSnapshot=c.targetSnapshot,n.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation=I(v({},this.currentNavigation),{finalUrl:c.urlAfterRedirects});let l=new ny(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(i.currentRawUrl)){let{id:c,extractedUrl:l,source:u,restoredState:d,extras:h}=i,p=new hf(c,this.urlSerializer.serialize(l),u,d);this.events.next(p);let m=PU(this.rootComponentType).snapshot;return this.currentTransition=n=I(v({},i),{targetSnapshot:m,urlAfterRedirects:l,extras:I(v({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=l,Ve(n)}else{let c="";return this.events.next(new rl(i.id,this.urlSerializer.serialize(i.extractedUrl),c,ry.IgnoredByUrlHandlingStrategy)),i.resolve(!1),Ko}}),yn(i=>{let s=new n4(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot);this.events.next(s)}),Je(i=>(this.currentTransition=n=I(v({},i),{guards:jce(i.targetSnapshot,i.currentSnapshot,this.rootContexts)}),n)),Zce(this.environmentInjector,i=>this.events.next(i)),yn(i=>{if(n.guardsResult=i.guardsResult,i.guardsResult&&typeof i.guardsResult!="boolean")throw g4(this.urlSerializer,i.guardsResult);let s=new o4(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot,!!i.guardsResult);this.events.next(s)}),_o(i=>i.guardsResult?!0:(this.cancelNavigationTransition(i,"",ko.GuardRejected),!1)),d9(i=>{if(i.guards.canActivateChecks.length!==0)return Ve(i).pipe(yn(s=>{let a=new i4(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),ro(s=>{let a=!1;return Ve(s).pipe(_le(this.paramsInheritanceStrategy,this.environmentInjector),yn({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",ko.NoDataFromResolver)}}))}),yn(s=>{let a=new s4(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),d9(i=>{let s=a=>{let c=[];a.routeConfig?.loadComponent&&!a.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(a.routeConfig).pipe(yn(l=>{a.component=l}),Je(()=>{})));for(let l of a.children)c.push(...s(l));return c};return wb(s(i.targetSnapshot.root)).pipe(Gl(null),Vc(1))}),d9(()=>this.afterPreactivation()),ro(()=>{let{currentSnapshot:i,targetSnapshot:s}=n,a=this.createViewTransition?.(this.environmentInjector,i.root,s.root);return a?yr(a).pipe(Je(()=>n)):Ve(n)}),Je(i=>{let s=Lce(t.routeReuseStrategy,i.targetSnapshot,i.currentRouterState);return this.currentTransition=n=I(v({},i),{targetRouterState:s}),this.currentNavigation.targetRouterState=s,n}),yn(()=>{this.events.next(new oy)}),Vce(this.rootContexts,t.routeReuseStrategy,i=>this.events.next(i),this.inputBindingEnabled),Vc(1),Hc(new ht(i=>{let s=n.abortController.signal,a=()=>i.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(_o(()=>!o&&!n.targetRouterState),yn(()=>{this.cancelNavigationTransition(n,n.abortController.signal.reason+"",ko.Aborted)}))),yn({next:i=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Zs(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects))),this.titleStrategy?.updateTitle(i.targetRouterState.snapshot),i.resolve(!0)},complete:()=>{o=!0}}),Hc(this.transitionAbortWithErrorSubject.pipe(yn(i=>{throw i}))),Bd(()=>{o||this.cancelNavigationTransition(n,"",ko.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),dn(i=>{if(this.destroyed)return n.resolve(!1),Ko;if(o=!0,LU(i))this.events.next(new Xa(n.id,this.urlSerializer.serialize(n.extractedUrl),i.message,i.cancellationCode)),Uce(i)?this.events.next(new fm(i.url,i.navigationBehaviorOptions)):n.resolve(!1);else{let s=new dm(n.id,this.urlSerializer.serialize(n.extractedUrl),i,n.targetSnapshot??void 0);try{let a=Io(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof pm){let{message:c,cancellationCode:l}=g4(this.urlSerializer,a);this.events.next(new Xa(n.id,this.urlSerializer.serialize(n.extractedUrl),c,l)),this.events.next(new fm(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),i}catch(a){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(a)}}return Ko}))}))}cancelNavigationTransition(t,n,o){let i=new Xa(t.id,this.urlSerializer.serialize(t.extractedUrl),n,o);this.events.next(i),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==n?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Tle(r){return r!==J1}var YU=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(Ple),providedIn:"root"})}return r})(),v4=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},Ple=(()=>{class r extends v4{static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),XU=(()=>{class r{urlSerializer=ie(dy);options=ie(ym,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=ie(rm);urlHandlingStrategy=ie(x4);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Qa;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:n,targetBrowserUrl:o}){let i=t!==void 0?this.urlHandlingStrategy.merge(t,n):n,s=o??i;return s instanceof Qa?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:t,finalUrl:n,initialUrl:o}){n&&t?(this.currentUrlTree=n,this.rawUrlTree=this.urlHandlingStrategy.merge(n,o),this.routerState=t):this.rawUrlTree=o}routerState=PU(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:()=>ie(Mle),providedIn:"root"})}return r})(),Mle=(()=>{class r extends XU{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(n=>{n.type==="popstate"&&setTimeout(()=>{t(n.url,n.state,"popstate")})})}handleRouterEvent(t,n){t instanceof hf?this.updateStateMemento():t instanceof rl?this.commitTransition(n):t instanceof ny?this.urlUpdateStrategy==="eager"&&(n.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof oy?(this.commitTransition(n),this.urlUpdateStrategy==="deferred"&&!n.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof Xa&&t.code!==ko.SupersededByNewNavigation&&t.code!==ko.Redirect?this.restoreHistory(n):t instanceof dm?this.restoreHistory(n,!0):t instanceof Zs&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:n,id:o}){let{replaceUrl:i,state:s}=n;if(this.location.isCurrentPathEqualTo(t)||i){let a=this.browserPageId,c=v(v({},s),this.generateNgRouterState(o,a));this.location.replaceState(t,"",c)}else{let a=v(v({},s),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(t,"",a)}}restoreHistory(t,n=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.getCurrentUrlTree()===t.finalUrl&&i===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(n&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,n){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function P9(r,e){r.events.pipe(_o(t=>t instanceof Zs||t instanceof Xa||t instanceof dm||t instanceof rl),Je(t=>t instanceof Zs||t instanceof rl?0:(t instanceof Xa?t.code===ko.Redirect||t.code===ko.SupersededByNewNavigation:!1)?2:1),_o(t=>t!==2),Vc(1)).subscribe(()=>{e()})}var kle={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Rle={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Za=(()=>{class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ie(EI);stateManager=ie(XU);options=ie(ym,{optional:!0})||{};pendingTasks=ie(Yc);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ie(WU);urlSerializer=ie(dy);location=ie(rm);urlHandlingStrategy=ie(x4);injector=ie(Kr);_events=new qt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ie(YU);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ie(my,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ie(w4,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Ir;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(n=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(n,i),n instanceof Xa&&n.code!==ko.Redirect&&n.code!==ko.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof Zs)this.navigated=!0;else if(n instanceof fm){let s=n.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(n.url,o.currentRawUrl),c=v({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Tle(o.source)},s);this.scheduleNavigation(a,J1,null,c,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}kce(n)&&this._events.next(n)}catch(o){this.navigationTransitions.transitionAbortWithErrorSubject.next(o)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),J1,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,n,o)=>{this.navigateToSyncWithBrowser(t,o,n)})}navigateToSyncWithBrowser(t,n,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let c=v({},o);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(i.state=c)}let a=this.parseUrl(t);this.scheduleNavigation(a,n,s,i).catch(c=>{this.injector.get(To)(c)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(D9),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,n={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:c}=n,l=c?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=v(v({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let h=o?o.snapshot:this.routerState.snapshot.root;d=IU(h)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),d=this.currentUrlTree.root}return AU(d,t,u,l??null)}navigateByUrl(t,n={skipLocationChange:!1}){let o=pu(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,J1,null,n)}navigate(t,n={skipLocationChange:!1}){return Nle(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,n){let o;if(n===!0?o=v({},kle):n===!1?o=v({},Rle):o=n,pu(t))return aU(this.currentUrlTree,t,o);let i=this.parseUrl(t);return aU(this.currentUrlTree,i,o)}removeEmptyProps(t){return Object.entries(t).reduce((n,[o,i])=>(i!=null&&(n[o]=i),n),{})}scheduleNavigation(t,n,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,c,l;s?(a=s.resolve,c=s.reject,l=s.promise):l=new Promise((d,h)=>{a=d,c=h});let u=this.pendingTasks.add();return P9(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Nle(r){for(let e=0;e<r.length;e++)if(r[e]==null)throw new be(4008,!1)}var ms=(()=>{class r{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Wc(null);get href(){return ds(this.reactiveHref)}set href(t){this.reactiveHref.set(t)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new qt;applicationErrorHandler=ie(To);options=ie(ym,{optional:!0});constructor(t,n,o,i,s,a){this.router=t,this.route=n,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a,this.reactiveHref.set(ie(new M3("href"),{optional:!0}));let c=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area"||!!(typeof customElements=="object"&&customElements.get(c)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let t=this.preserveFragment,n=o=>o==="merge"||o==="preserve";t||=n(this.queryParamsHandling),t||=!this.queryParamsHandling&&!n(this.options?.defaultQueryParamsHandling),t&&(this.subscription=this.router.events.subscribe(o=>{o instanceof Zs&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(pu(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,n,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||n||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,c)?.catch(l=>{this.applicationErrorHandler(l)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.reactiveHref.set(t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t))??"":null)}applyAttributeValue(t,n){let o=this.renderer,i=this.el.nativeElement;n!==null?o.setAttribute(i,t,n):o.removeAttribute(i,t)}get urlTree(){return this.routerLinkInput===null?null:pu(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(n){return new(n||r)(oe(Za),oe(Js),C1("tabindex"),oe(us),oe(io),oe(tm))};static \u0275dir=Tt({type:r,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(n,o){n&1&&_e("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),n&2&&rf("href",o.reactiveHref(),J7)("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",em],skipLocationChange:[2,"skipLocationChange","skipLocationChange",em],replaceUrl:[2,"replaceUrl","replaceUrl",em],routerLink:"routerLink"},features:[ls]})}return r})(),M9=(()=>{class r{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new Rt;constructor(t,n,o,i,s){this.router=t,this.element=n,this.renderer=o,this.cdr=i,this.link=s,this.routerEventsSubscription=t.events.subscribe(a=>{a instanceof Zs&&this.update()})}ngAfterContentInit(){Ve(this.links.changes,Ve(null)).pipe(Lh()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let t=[...this.links.toArray(),this.link].filter(n=>!!n).map(n=>n.onChanges);this.linkInputChangesSubscription=yr(t).pipe(Lh()).subscribe(n=>{this._isActive!==this.isLinkActive(this.router)(n)&&this.update()})}set routerLinkActive(t){let n=Array.isArray(t)?t:t.split(" ");this.classes=n.filter(o=>!!o)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let t=this.hasActiveLinks();this.classes.forEach(n=>{t?this.renderer.addClass(this.element.nativeElement,n):this.renderer.removeClass(this.element.nativeElement,n)}),t&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){let n=Lle(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return o=>{let i=o.urlTree;return i?t.isActive(i,n):!1}}hasActiveLinks(){let t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static \u0275fac=function(n){return new(n||r)(oe(Za),oe(io),oe(us),oe(nf),oe(ms,8))};static \u0275dir=Tt({type:r,selectors:[["","routerLinkActive",""]],contentQueries:function(n,o,i){if(n&1&&II(i,ms,5),n&2){let s;AI(s=DI())&&(o.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[ls]})}return r})();function Lle(r){return!!r.paths}var Fle=new De("");function k9(r,...e){return Kc([{provide:my,multi:!0,useValue:r},[],{provide:Js,useFactory:Ble,deps:[Za]},{provide:A3,multi:!0,useFactory:Ule},e.map(t=>t.\u0275providers)])}function Ble(r){return r.routerState.root}function Ule(){let r=ie(ns);return e=>{let t=r.get(tf);if(e!==t.components[0])return;let n=r.get(Za),o=r.get(Vle);r.get(jle)===1&&n.initialNavigation(),r.get(Hle,null,{optional:!0})?.setUpPreloading(),r.get(Fle,null,{optional:!0})?.init(),n.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var Vle=new De("",{factory:()=>new qt}),jle=new De("",{providedIn:"root",factory:()=>1});var Hle=new De("");var gs=new De("storage.provider"),hu=(o=>(o.IN_MEMORY="in-memory",o.INDEXED_DB="indexed-db",o.IPFS="ipfs",o.HELIA="helia",o))(hu||{});function QU(r,e,t,n,o="in-memory"){switch(o){case"indexed-db":return e;case"ipfs":return t;case"helia":return n;case"in-memory":default:return r}}var ea=new De("storage.type");function ZU(){if(typeof window<"u"){let r=localStorage.getItem("cas-storage-type");if(r==="indexed-db"||r==="ipfs"||r==="helia"||r==="in-memory")return r;if("indexedDB"in window)return"indexed-db"}return"in-memory"}function $le(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G(3);D(),Se(t.getHealthyMessage())}}function zle(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G(3);D(),Se(t.errorMessage)}}function qle(r,e){if(r&1&&(b(0,"div",6),ye(1,$le,2,1,"p",7)(2,zle,2,1,"p",7),y()),r&2){let t=G(2);D(),z("ngIf",t.isConnected),D(),z("ngIf",!t.isConnected&&t.errorMessage)}}function Kle(r,e){if(r&1&&(b(0,"div",1)(1,"div",2),Bt(2,"span",3),b(3,"span",4),_(4),y()(),ye(5,qle,3,2,"div",5),y()),r&2){let t=G();D(),Rn("connected",t.isConnected)("disconnected",!t.isConnected),D(3),Se(t.getStatusText()),D(),z("ngIf",t.showDetails)}}var vm=class r{constructor(e,t){this.storageType=e;this.storageProvider=t}StorageType=hu;isConnected=!1;showDetails=!1;errorMessage="";destroy$=new qt;checkInterval=3e4;ngOnInit(){(this.storageType==="ipfs"||this.storageType==="helia")&&(this.checkConnection(),sC(0,this.checkInterval).pipe(Hc(this.destroy$),ro(()=>this.checkProviderHealth()),dn(e=>(this.errorMessage=e.message||"Connection failed",Ve(!1)))).subscribe(e=>{this.isConnected=e,e&&(this.errorMessage="")}))}checkProviderHealth(){return f(this,null,function*(){return"isHealthy"in this.storageProvider&&typeof this.storageProvider.isHealthy=="function"?yield this.storageProvider.isHealthy():!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}checkConnection(){return f(this,null,function*(){try{this.isConnected=yield this.checkProviderHealth(),this.isConnected&&(this.errorMessage="")}catch(e){this.isConnected=!1,this.errorMessage=e instanceof Error?e.message:"Connection failed"}})}toggleDetails(){this.showDetails=!this.showDetails}getStatusText(){return this.storageType==="ipfs"?`IPFS: ${this.isConnected?"Connected":"Disconnected"}`:this.storageType==="helia"?`Helia: ${this.isConnected?"Active":"Inactive"}`:""}getHealthyMessage(){return this.storageType==="ipfs"?"Node is healthy":this.storageType==="helia"?"Browser IPFS is running":""}static \u0275fac=function(t){return new(t||r)(oe(ea),oe(gs))};static \u0275cmp=Qt({type:r,selectors:[["app-ipfs-status-indicator"]],decls:1,vars:1,consts:[["class","ipfs-status",4,"ngIf"],[1,"ipfs-status"],[1,"status-indicator"],[1,"status-dot"],[1,"status-text"],["class","status-details",4,"ngIf"],[1,"status-details"],[4,"ngIf"]],template:function(t,n){t&1&&ye(0,Kle,6,6,"div",0),t&2&&z("ngIf",n.storageType===n.StorageType.IPFS||n.storageType===n.StorageType.HELIA)},dependencies:[Zt,Ur],styles:[".ipfs-status[_ngcontent-%COMP%]{display:inline-block;padding:8px 12px;background-color:#f0f0f0;border-radius:4px;font-size:14px}.status-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer}.status-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;transition:background-color .3s}.connected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background-color:#27ae60;animation:_ngcontent-%COMP%_pulse 2s infinite}.disconnected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background-color:#e74c3c}.status-text[_ngcontent-%COMP%]{font-weight:500}.connected[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{color:#27ae60}.disconnected[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{color:#e74c3c}.status-details[_ngcontent-%COMP%]{margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:12px;color:#666}.status-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #27ae6066}70%{box-shadow:0 0 0 10px #27ae6000}to{box-shadow:0 0 #27ae6000}}"]})};var E4=class r{coverageData={statements:73.81,branches:53.1,functions:83.13,lines:75.5};getCoverageData(){return Ve(this.coverageData)}getStatementsCoverage(){return this.coverageData.statements}getFormattedStatementsCoverage(){return`${this.coverageData.statements}%`}static \u0275fac=function(t){return new(t||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var gy=class r{constructor(e){this.coverageService=e}coveragePercentage="0%";ngOnInit(){this.coveragePercentage=this.coverageService.getFormattedStatementsCoverage()}static \u0275fac=function(t){return new(t||r)(oe(E4))};static \u0275cmp=Qt({type:r,selectors:[["app-home"]],decls:195,vars:1,consts:[[1,"home-container"],[1,"ai-hive-disclaimer-top"],[1,"ai-built"],["href","https://o2.services","target","_blank","rel","noopener",1,"ai-link"],[1,"ai-description"],[1,"hero-section"],[1,"hero-header"],[1,"hero-title"],[1,"hero-subtitle"],[1,"hero-actions"],["href","https://github.com/o2alexanderfedin/angular-cas-disot","target","_blank","rel","noopener",1,"hero-button","primary"],[1,"button-icon"],["href","/angular-cas-disot/coverage/cas-app/","target","_blank","rel","noopener",1,"hero-button","secondary"],[1,"intro-section"],[1,"intro-card"],[1,"key-features"],[1,"feature"],[1,"feature-icon"],[1,"how-it-works"],[1,"workflow-grid"],[1,"workflow-step"],[1,"step-number"],["routerLink","/content/upload",1,"action-button"],["routerLink","/disot/create",1,"action-button"],["routerLink","/disot/verify",1,"action-button"],[1,"use-cases"],[1,"use-case-grid"],[1,"use-case-card"],[1,"technical-section"],[1,"tech-grid"],[1,"tech-card"],["href","/angular-cas-disot/coverage/cas-app/","target","_blank","rel","noopener"],[1,"getting-started"],[1,"steps-container"],[1,"step-card"],["routerLink","/settings"],["routerLink","/content/upload"],["routerLink","/disot/create"],[1,"home-footer"],["href","https://github.com/o2alexanderfedin/angular-cas-disot","target","_blank","rel","noopener"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"div",1)(2,"p",2),_(3," Built with "),b(4,"a",3),_(5,"O2.services AI Hive"),y()(),b(6,"p",4),_(7," AI Hive is a dynamic swarm of AI agents that transform customer requirements into shipped products, handling every phase of the software engineering lifecycle. "),y()(),b(8,"header",5)(9,"div",6)(10,"h1",7),_(11,"CAS/DISOT System"),y(),Bt(12,"app-ipfs-status-indicator"),y(),b(13,"p",8),_(14,"Content Addressable Storage with Decentralized Immutable Source of Truth"),y(),b(15,"div",9)(16,"a",10)(17,"span",11),_(18,"\u{1F4C1}"),y(),_(19," View Source Code "),y(),b(20,"a",12)(21,"span",11),_(22,"\u{1F4CA}"),y(),_(23),y()()(),b(24,"section",13)(25,"div",14)(26,"h2"),_(27,"What is CAS/DISOT?"),y(),b(28,"p"),_(29," CAS/DISOT is a decentralized content management system that combines content-addressable storage (CAS) with cryptographic signatures to create an immutable source of truth (DISOT). "),y(),b(30,"div",15)(31,"div",16)(32,"span",17),_(33,"\u{1F510}"),y(),b(34,"strong"),_(35,"Content Addressing:"),y(),_(36," Files are stored and retrieved using their SHA-256 hash "),y(),b(37,"div",16)(38,"span",17),_(39,"\u270D\uFE0F"),y(),b(40,"strong"),_(41,"Digital Signatures:"),y(),_(42," Create signed entries that prove authorship and timestamp "),y(),b(43,"div",16)(44,"span",17),_(45,"\u{1F50D}"),y(),b(46,"strong"),_(47,"Verification:"),y(),_(48," Verify the integrity and authenticity of any content "),y()()()(),b(49,"section",18)(50,"h2"),_(51,"How It Works"),y(),b(52,"div",19)(53,"div",20)(54,"div",21),_(55,"1"),y(),b(56,"h3"),_(57,"Upload Content"),y(),b(58,"p"),_(59,"Upload any file to the system. It will be hashed using SHA-256 and stored by its content hash."),y(),b(60,"button",22),_(61,"Upload Files"),y()(),b(62,"div",20)(63,"div",21),_(64,"2"),y(),b(65,"h3"),_(66,"Create DISOT Entry"),y(),b(67,"p"),_(68,"Sign your content with a cryptographic key to create a timestamped, verifiable entry."),y(),b(69,"button",23),_(70,"Create Entry"),y()(),b(71,"div",20)(72,"div",21),_(73,"3"),y(),b(74,"h3"),_(75,"Share & Verify"),y(),b(76,"p"),_(77,"Share your signed entries. Anyone can verify the authenticity and timestamp of your content."),y(),b(78,"button",24),_(79,"Verify Entries"),y()()()(),b(80,"section",25)(81,"h2"),_(82,"Use Cases"),y(),b(83,"div",26)(84,"div",27)(85,"h3"),_(86,"\u{1F4DD} Blog Posts"),y(),b(87,"p"),_(88,"Create immutable blog posts with verified authorship and timestamps"),y()(),b(89,"div",27)(90,"h3"),_(91,"\u{1F4C4} Documents"),y(),b(92,"p"),_(93,"Store important documents with cryptographic proof of existence"),y()(),b(94,"div",27)(95,"h3"),_(96,"\u{1F5BC}\uFE0F Digital Art"),y(),b(97,"p"),_(98,"Prove ownership and creation date of digital artwork"),y()(),b(99,"div",27)(100,"h3"),_(101,"\u{1F4CA} Research Data"),y(),b(102,"p"),_(103,"Create verifiable research data with immutable timestamps"),y()()()(),b(104,"section",28)(105,"h2"),_(106,"Technical Details"),y(),b(107,"div",29)(108,"div",30)(109,"h3"),_(110,"Content Addressing"),y(),b(111,"ul")(112,"li"),_(113,"SHA-256 hashing ensures unique content identification"),y(),b(114,"li"),_(115,"Automatic deduplication - identical files share the same hash"),y(),b(116,"li"),_(117,"Content integrity verification built-in"),y()()(),b(118,"div",30)(119,"h3"),_(120,"Storage Options"),y(),b(121,"ul")(122,"li")(123,"strong"),_(124,"In-Memory:"),y(),_(125," Fast temporary storage (default)"),y(),b(126,"li")(127,"strong"),_(128,"IndexedDB:"),y(),_(129," Persistent browser storage"),y(),b(130,"li")(131,"strong"),_(132,"IPFS:"),y(),_(133," Distributed storage network"),y(),b(134,"li")(135,"strong"),_(136,"Helia:"),y(),_(137," Browser-native IPFS implementation"),y()()(),b(138,"div",30)(139,"h3"),_(140,"Cryptography"),y(),b(141,"ul")(142,"li"),_(143,"secp256k1 key pairs for digital signatures"),y(),b(144,"li"),_(145,"Timestamp included in signed entries"),y(),b(146,"li"),_(147,"Signature verification for authenticity"),y()()(),b(148,"div",30)(149,"h3"),_(150,"Quality & Testing"),y(),b(151,"ul")(152,"li"),_(153,"402 unit tests ensuring reliability"),y(),b(154,"li"),_(155,"Test-driven development approach"),y(),b(156,"li")(157,"a",31),_(158,"\u{1F4CA} View Code Coverage"),y()()()()()(),b(159,"section",32)(160,"h2"),_(161,"Getting Started"),y(),b(162,"div",33)(163,"div",34)(164,"h3"),_(165,"Step 1: Configure Storage"),y(),b(166,"p"),_(167,"Go to "),b(168,"a",35),_(169,"Settings"),y(),_(170," and choose your preferred storage provider."),y()(),b(171,"div",34)(172,"h3"),_(173,"Step 2: Upload Content"),y(),b(174,"p"),_(175,"Upload files through the "),b(176,"a",36),_(177,"Upload page"),y(),_(178," or drag & drop interface."),y()(),b(179,"div",34)(180,"h3"),_(181,"Step 3: Create Entries"),y(),b(182,"p"),_(183,"Sign your content with "),b(184,"a",37),_(185,"DISOT entries"),y(),_(186," for verifiable authorship."),y()()()(),b(187,"footer",38)(188,"p"),_(189," CAS/DISOT is an open-source project. "),b(190,"a",39),_(191," View on GitHub "),y(),_(192," | "),b(193,"a",31),_(194," \u{1F4CA} Coverage Report "),y()()()()),t&2&&(D(23),je(" Code Coverage (",n.coveragePercentage,") "))},dependencies:[ms,vm],styles:['@charset "UTF-8";.home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.ai-hive-disclaimer-top[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;padding:2rem;border-radius:1rem;margin-bottom:2rem;text-align:center;box-shadow:0 10px 30px #8b5cf64d;position:relative;overflow:hidden}.ai-hive-disclaimer-top[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.1) 50%,transparent 70%);animation:_ngcontent-%COMP%_shimmer 3s infinite}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-built[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1.4rem;font-weight:600;position:relative;z-index:1}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-description[_ngcontent-%COMP%]{margin:0 auto;font-size:1rem;line-height:1.6;max-width:700px;opacity:.95;position:relative;z-index:1}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]{color:#fff;font-weight:700;text-decoration:none;border-bottom:2px solid rgba(255,255,255,.5);transition:all .3s ease}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]:after{content:"\\2728";margin-left:.5rem;display:inline-block;animation:_ngcontent-%COMP%_sparkle 2s ease-in-out infinite;font-size:1.2em}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]:hover{border-bottom-color:#fff;text-shadow:0 0 20px rgba(255,255,255,.8)}@keyframes _ngcontent-%COMP%_shimmer{0%{transform:translate(-100%) translateY(-100%) rotate(45deg)}to{transform:translate(100%) translateY(100%) rotate(45deg)}}.hero-section[_ngcontent-%COMP%]{text-align:center;padding:3rem 0;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:1rem;margin-bottom:3rem}.hero-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:2rem;flex-wrap:wrap;margin-bottom:1rem}.hero-title[_ngcontent-%COMP%]{font-size:3rem;font-weight:700;margin:0}.hero-subtitle[_ngcontent-%COMP%]{font-size:1.25rem;opacity:.9;margin-bottom:2rem}.hero-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}.hero-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;font-size:1rem;transition:all .2s ease;border:2px solid transparent}.hero-button[_ngcontent-%COMP%]   .button-icon[_ngcontent-%COMP%]{font-size:1.1rem}.hero-button.primary[_ngcontent-%COMP%]{background:#ffffff26;color:#fff;border-color:#ffffff4d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.hero-button.primary[_ngcontent-%COMP%]:hover{background:#ffffff40;border-color:#ffffff80;transform:translateY(-2px)}.hero-button.secondary[_ngcontent-%COMP%]{background:#ffffffe6;color:#667eea;border-color:#ffffffe6}.hero-button.secondary[_ngcontent-%COMP%]:hover{background:#fff;color:#5a67d8;transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.intro-section[_ngcontent-%COMP%]{margin-bottom:3rem}.intro-card[_ngcontent-%COMP%]{background:#f8f9fa;padding:2rem;border-radius:.5rem;box-shadow:0 2px 4px #0000001a}.intro-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}.intro-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.6;color:#555;margin-bottom:1.5rem}.key-features[_ngcontent-%COMP%]{display:grid;gap:1rem}@media (min-width: 768px){.key-features[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.feature[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem}.feature[_ngcontent-%COMP%]   .feature-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.feature[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;color:#333}.how-it-works[_ngcontent-%COMP%]{margin-bottom:3rem}.how-it-works[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.workflow-grid[_ngcontent-%COMP%]{display:grid;gap:2rem}@media (min-width: 768px){.workflow-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.workflow-step[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#fff;border-radius:.5rem;box-shadow:0 2px 8px #0000001a;transition:transform .2s}.workflow-step[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.workflow-step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:50px;height:50px;background:#667eea;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.workflow-step[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}.workflow-step[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin-bottom:1.5rem;line-height:1.6}.action-button[_ngcontent-%COMP%]{background:#667eea;color:#fff;border:none;padding:.75rem 1.5rem;border-radius:.25rem;cursor:pointer;font-size:1rem;transition:background .2s}.action-button[_ngcontent-%COMP%]:hover{background:#5a67d8}.use-cases[_ngcontent-%COMP%]{margin-bottom:3rem}.use-cases[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.use-case-grid[_ngcontent-%COMP%]{display:grid;gap:1.5rem}@media (min-width: 768px){.use-case-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.use-case-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}}.use-case-card[_ngcontent-%COMP%]{background:#f8f9fa;padding:1.5rem;border-radius:.5rem;text-align:center}.use-case-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem;font-size:1.1rem}.use-case-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:.9rem;line-height:1.5}.technical-section[_ngcontent-%COMP%]{margin-bottom:3rem}.technical-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.tech-grid[_ngcontent-%COMP%]{display:grid;gap:2rem}@media (min-width: 768px){.tech-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.tech-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:.5rem;box-shadow:0 2px 4px #0000001a}.tech-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#667eea;margin-bottom:1rem}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding-left:1.5rem;position:relative;margin-bottom:.5rem;color:#666;line-height:1.5}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:"\\2022";color:#667eea;position:absolute;left:.5rem}.getting-started[_ngcontent-%COMP%]{margin-bottom:3rem}.getting-started[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.steps-container[_ngcontent-%COMP%]{display:grid;gap:1.5rem}@media (min-width: 768px){.steps-container[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.step-card[_ngcontent-%COMP%]{background:#e9ecef;padding:1.5rem;border-radius:.5rem;border-left:4px solid #667eea}.step-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem}.step-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;line-height:1.5}.step-card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:500}.step-card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.home-footer[_ngcontent-%COMP%]{text-align:center;padding:2rem;border-top:1px solid #e9ecef;margin-top:3rem}.home-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666}.home-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:500}.home-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}@keyframes _ngcontent-%COMP%_sparkle{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}']})};var cV=(()=>{class r{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||r)(oe(us),oe(io))};static \u0275dir=Tt({type:r})}return r})(),Em=(()=>{class r extends cV{static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,features:[Yr]})}return r})(),yu=new De(""),Wle={provide:yu,useExisting:wn(()=>V9),multi:!0},V9=(()=>{class r extends Em{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,o){n&1&&_e("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Mo([Wle]),Yr]})}return r})(),Yle={provide:yu,useExisting:wn(()=>Qo),multi:!0};function Xle(){let r=ps()?ps().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var Qle=new De(""),Qo=(()=>{class r extends cV{_compositionMode;_composing=!1;constructor(t,n,o){super(t,n),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Xle())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||r)(oe(us),oe(io),oe(Qle,8))};static \u0275dir=Tt({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){n&1&&_e("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Mo([Yle]),Yr]})}return r})();function j9(r){return r==null||H9(r)===0}function H9(r){return r==null?null:Array.isArray(r)||typeof r=="string"?r.length:r instanceof Set?r.size:null}var mf=new De(""),Ey=new De(""),Zle=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ol=class{static min(e){return lV(e)}static max(e){return uV(e)}static required(e){return Jle(e)}static requiredTrue(e){return eue(e)}static email(e){return tue(e)}static minLength(e){return rue(e)}static maxLength(e){return nue(e)}static pattern(e){return oue(e)}static nullValidator(e){return S4()}static compose(e){return gV(e)}static composeAsync(e){return vV(e)}};function lV(r){return e=>{if(e.value==null||r==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}function uV(r){return e=>{if(e.value==null||r==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}function Jle(r){return j9(r.value)?{required:!0}:null}function eue(r){return r.value===!0?null:{required:!0}}function tue(r){return j9(r.value)||Zle.test(r.value)?null:{email:!0}}function rue(r){return e=>{let t=e.value?.length??H9(e.value);return t===null||t===0?null:t<r?{minlength:{requiredLength:r,actualLength:t}}:null}}function nue(r){return e=>{let t=e.value?.length??H9(e.value);return t!==null&&t>r?{maxlength:{requiredLength:r,actualLength:t}}:null}}function oue(r){if(!r)return S4;let e,t;return typeof r=="string"?(t="",r.charAt(0)!=="^"&&(t+="^"),t+=r,r.charAt(r.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=r.toString(),e=r),n=>{if(j9(n.value))return null;let o=n.value;return e.test(o)?null:{pattern:{requiredPattern:t,actualValue:o}}}}function S4(r){return null}function dV(r){return r!=null}function fV(r){return cu(r)?yr(r):r}function pV(r){let e={};return r.forEach(t=>{e=t!=null?v(v({},e),t):e}),Object.keys(e).length===0?null:e}function hV(r,e){return e.map(t=>t(r))}function iue(r){return!r.validate}function mV(r){return r.map(e=>iue(e)?e:t=>e.validate(t))}function gV(r){if(!r)return null;let e=r.filter(dV);return e.length==0?null:function(t){return pV(hV(t,e))}}function yV(r){return r!=null?gV(mV(r)):null}function vV(r){if(!r)return null;let e=r.filter(dV);return e.length==0?null:function(t){let n=hV(t,e).map(fV);return iC(n).pipe(Je(pV))}}function wV(r){return r!=null?vV(mV(r)):null}function JU(r,e){return r===null?[e]:Array.isArray(r)?[...r,e]:[r,e]}function bV(r){return r._rawValidators}function xV(r){return r._rawAsyncValidators}function N9(r){return r?Array.isArray(r)?r:[r]:[]}function C4(r,e){return Array.isArray(r)?r.includes(e):r===e}function eV(r,e){let t=N9(e);return N9(r).forEach(o=>{C4(t,o)||t.push(o)}),t}function tV(r,e){return N9(e).filter(t=>!C4(r,t))}var I4=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=yV(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=wV(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ki=class extends I4{name;get formDirective(){return null}get path(){return null}},mu=class extends I4{_parent=null;name=null;valueAccessor=null},A4=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},sue={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},YRe=I(v({},sue),{"[class.ng-submitted]":"isSubmitted"}),ys=(()=>{class r extends A4{constructor(t){super(t)}static \u0275fac=function(n){return new(n||r)(oe(mu,2))};static \u0275dir=Tt({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){n&2&&Rn("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Yr]})}return r})(),EV=(()=>{class r extends A4{constructor(t){super(t)}static \u0275fac=function(n){return new(n||r)(oe(ki,10))};static \u0275dir=Tt({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,o){n&2&&Rn("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[Yr]})}return r})();var yy="VALID",_4="INVALID",wm="PENDING",vy="DISABLED",gu=class{},D4=class extends gu{value;source;constructor(e,t){super(),this.value=e,this.source=t}},wy=class extends gu{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},by=class extends gu{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},bm=class extends gu{status;source;constructor(e,t){super(),this.status=e,this.source=t}},O9=class extends gu{source;constructor(e){super(),this.source=e}},L9=class extends gu{source;constructor(e){super(),this.source=e}};function $9(r){return(k4(r)?r.validators:r)||null}function aue(r){return Array.isArray(r)?yV(r):r||null}function z9(r,e){return(k4(e)?e.asyncValidators:r)||null}function cue(r){return Array.isArray(r)?wV(r):r||null}function k4(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function _V(r,e,t){let n=r.controls;if(!(e?Object.keys(n):n).length)throw new be(1e3,"");if(!n[t])throw new be(1001,"")}function SV(r,e,t){r._forEachChild((n,o)=>{if(t[o]===void 0)throw new be(1002,"")})}var xm=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return ds(this.statusReactive)}set status(e){ds(()=>this.statusReactive.set(e))}_status=Jh(()=>this.statusReactive());statusReactive=Wc(void 0);get valid(){return this.status===yy}get invalid(){return this.status===_4}get pending(){return this.status==wm}get disabled(){return this.status===vy}get enabled(){return this.status!==vy}errors;get pristine(){return ds(this.pristineReactive)}set pristine(e){ds(()=>this.pristineReactive.set(e))}_pristine=Jh(()=>this.pristineReactive());pristineReactive=Wc(!0);get dirty(){return!this.pristine}get touched(){return ds(this.touchedReactive)}set touched(e){ds(()=>this.touchedReactive.set(e))}_touched=Jh(()=>this.touchedReactive());touchedReactive=Wc(!1);get untouched(){return!this.touched}_events=new qt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(eV(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(eV(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(tV(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(tV(e,this._rawAsyncValidators))}hasValidator(e){return C4(this._rawValidators,e)}hasAsyncValidator(e){return C4(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(I(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new by(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new by(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(I(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new wy(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new wy(!0,n))}markAsPending(e={}){this.status=wm;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new bm(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(I(v({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=vy,this.errors=null,this._forEachChild(o=>{o.disable(I(v({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new D4(this.value,n)),this._events.next(new bm(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(I(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=yy,this._forEachChild(n=>{n.enable(I(v({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(I(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===yy||this.status===wm)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new D4(this.value,t)),this._events.next(new bm(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(I(v({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?vy:yy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=wm,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let n=fV(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,o)=>n&&n._find(o),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new bm(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new Rt,this.statusChanges=new Rt}_calculateStatus(){return this._allControlsDisabled()?vy:this.errors?_4:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(wm)?wm:this._anyControlsHaveStatus(_4)?_4:yy}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new wy(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new by(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){k4(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=aue(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=cue(this._rawAsyncValidators)}},T4=class extends xm{constructor(e,t,n){super($9(t),z9(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){SV(this,!0,e),Object.keys(e).forEach(n=>{_V(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let o=this.controls[n];o&&o.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,o)=>{n.reset(e?e[o]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,o)=>((n.enabled||this.disabled)&&(t[o]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((o,i)=>{n=t(n,o,i)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var F9=class extends T4{};var _y=new De("",{providedIn:"root",factory:()=>Sy}),Sy="always";function R4(r,e){return[...e.path,r]}function B9(r,e,t=Sy){q9(r,e),e.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(r.disabled),uue(r,e),fue(r,e),due(r,e),lue(r,e)}function rV(r,e,t=!0){let n=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(n),e.valueAccessor.registerOnTouched(n)),M4(r,e),r&&(e._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function P4(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function lue(r,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function q9(r,e){let t=bV(r);e.validator!==null?r.setValidators(JU(t,e.validator)):typeof t=="function"&&r.setValidators([t]);let n=xV(r);e.asyncValidator!==null?r.setAsyncValidators(JU(n,e.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let o=()=>r.updateValueAndValidity();P4(e._rawValidators,o),P4(e._rawAsyncValidators,o)}function M4(r,e){let t=!1;if(r!==null){if(e.validator!==null){let o=bV(r);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==e.validator);i.length!==o.length&&(t=!0,r.setValidators(i))}}if(e.asyncValidator!==null){let o=xV(r);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==e.asyncValidator);i.length!==o.length&&(t=!0,r.setAsyncValidators(i))}}}let n=()=>{};return P4(e._rawValidators,n),P4(e._rawAsyncValidators,n),t}function uue(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&CV(r,e)})}function due(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&CV(r,e),r.updateOn!=="submit"&&r.markAsTouched()})}function CV(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function fue(r,e){let t=(n,o)=>{e.valueAccessor.writeValue(n),o&&e.viewToModelUpdate(n)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function pue(r,e){r==null,q9(r,e)}function hue(r,e){return M4(r,e)}function IV(r,e){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function mue(r){return Object.getPrototypeOf(r.constructor)===Em}function gue(r,e){r._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function AV(r,e){if(!e)return null;Array.isArray(e);let t,n,o;return e.forEach(i=>{i.constructor===Qo?t=i:mue(i)?n=i:o=i}),o||n||t||null}function yue(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function nV(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function oV(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var xy=class extends xm{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super($9(t),z9(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),k4(t)&&(t.nonNullable||t.initialValueIsDefault)&&(oV(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){nV(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){nV(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){oV(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var vue=r=>r instanceof xy,wue=(()=>{class r extends ki{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return R4(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,standalone:!1,features:[Yr]})}return r})();var bue={provide:mu,useExisting:wn(()=>ta)},iV=Promise.resolve(),ta=(()=>{class r extends mu{_changeDetectorRef;callSetDisabledState;control=new xy;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Rt;constructor(t,n,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=t,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=AV(this,i)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),IV(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){B9(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){iV.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,o=n!==0&&em(n);iV.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?R4(t,this._parent):[t]}static \u0275fac=function(n){return new(n||r)(oe(ki,9),oe(mf,10),oe(Ey,10),oe(yu,10),oe(nf,8),oe(_y,8))};static \u0275dir=Tt({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Mo([bue]),Yr,ls]})}return r})();var DV=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275dir=Tt({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return r})(),xue={provide:yu,useExisting:wn(()=>K9),multi:!0},K9=(()=>{class r extends Em{writeValue(t){let n=t??"";this.setProperty("value",n)}registerOnChange(t){this.onChange=n=>{t(n==""?null:parseFloat(n))}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,o){n&1&&_e("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Mo([xue]),Yr]})}return r})(),Eue={provide:yu,useExisting:wn(()=>G9),multi:!0};var _ue=(()=>{class r{_accessors=[];add(t,n){this._accessors.push([t,n])}remove(t){for(let n=this._accessors.length-1;n>=0;--n)if(this._accessors[n][1]===t){this._accessors.splice(n,1);return}}select(t){this._accessors.forEach(n=>{this._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)})}_isSameGroup(t,n){return t[0].control?t[0]._parent===n._control._parent&&t[1].name===n.name:!1}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),G9=(()=>{class r extends Em{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=ie(_y,{optional:!0})??Sy;constructor(t,n,o,i){super(t,n),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(mu),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this.setProperty("checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}setDisabledState(t){(this.setDisabledStateFired||t||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",t),this.setDisabledStateFired=!0}fireUncheck(t){this.writeValue(t)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(n){return new(n||r)(oe(us),oe(io),oe(_ue),oe(ns))};static \u0275dir=Tt({type:r,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(n,o){n&1&&_e("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Mo([Eue]),Yr]})}return r})();var TV=new De("");var Sue={provide:ki,useExisting:wn(()=>N4)},N4=(()=>{class r extends ki{callSetDisabledState;get submitted(){return ds(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}_submitted=Jh(()=>this._submittedReactive());_submittedReactive=Wc(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Rt;constructor(t,n,o){super(),this.callSetDisabledState=o,this._setValidators(t),this._setAsyncValidators(n)}ngOnChanges(t){t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(M4(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let n=this.form.get(t.path);return B9(n,t,this.callSetDisabledState),n.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),n}getControl(t){return this.form.get(t.path)}removeControl(t){rV(t.control||null,t,!1),yue(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,n){this.form.get(t.path).setValue(n)}onSubmit(t){return this._submittedReactive.set(!0),gue(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new O9(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0,n={}){this.form.reset(t,n),this._submittedReactive.set(!1),n?.emitEvent!==!1&&this.form._events.next(new L9(this.form))}_updateDomValue(){this.directives.forEach(t=>{let n=t.control,o=this.form.get(t.path);n!==o&&(rV(n||null,t),vue(o)&&(B9(o,t,this.callSetDisabledState),t.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let n=this.form.get(t.path);pue(n,t),n.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let n=this.form.get(t.path);n&&hue(n,t)&&n.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){q9(this.form,this),this._oldForm&&M4(this._oldForm,this)}static \u0275fac=function(n){return new(n||r)(oe(mf,10),oe(Ey,10),oe(_y,8))};static \u0275dir=Tt({type:r,selectors:[["","formGroup",""]],hostBindings:function(n,o){n&1&&_e("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Mo([Sue]),Yr,ls]})}return r})(),Cue={provide:ki,useExisting:wn(()=>O4)},O4=(()=>{class r extends wue{name=null;constructor(t,n,o){super(),this._parent=t,this._setValidators(n),this._setAsyncValidators(o)}_checkParentType(){PV(this._parent)}static \u0275fac=function(n){return new(n||r)(oe(ki,13),oe(mf,10),oe(Ey,10))};static \u0275dir=Tt({type:r,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Mo([Cue]),Yr]})}return r})(),Iue={provide:ki,useExisting:wn(()=>L4)},L4=(()=>{class r extends ki{_parent;name=null;constructor(t,n,o){super(),this._parent=t,this._setValidators(n),this._setAsyncValidators(o)}ngOnInit(){PV(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return R4(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(n){return new(n||r)(oe(ki,13),oe(mf,10),oe(Ey,10))};static \u0275dir=Tt({type:r,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Mo([Iue]),Yr]})}return r})();function PV(r){return!(r instanceof O4)&&!(r instanceof N4)&&!(r instanceof L4)}var Aue={provide:mu,useExisting:wn(()=>W9)},W9=(()=>{class r extends mu{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(t){}model;update=new Rt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(t,n,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=t,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=AV(this,i)}ngOnChanges(t){this._added||this._setUpControl(),IV(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return R4(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(n){return new(n||r)(oe(ki,13),oe(mf,10),oe(Ey,10),oe(yu,10),oe(TV,8))};static \u0275dir=Tt({type:r,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Mo([Aue]),Yr,ls]})}return r})();var Due={provide:yu,useExisting:wn(()=>vs),multi:!0};function MV(r,e){return r==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${r}: ${e}`.slice(0,50))}function Tue(r){return r.split(":")[0]}var vs=(()=>{class r extends Em{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let n=this._getOptionId(t),o=MV(n,t);this.setProperty("value",o)}registerOnChange(t){this.onChange=n=>{this.value=this._getOptionValue(n),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),t))return n;return null}_getOptionValue(t){let n=Tue(t);return this._optionMap.has(n)?this._optionMap.get(n):t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,o){n&1&&_e("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Mo([Due]),Yr]})}return r})(),Ja=(()=>{class r{_element;_renderer;_select;id;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(MV(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||r)(oe(io),oe(us),oe(vs,9))};static \u0275dir=Tt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return r})(),Pue={provide:yu,useExisting:wn(()=>kV),multi:!0};function sV(r,e){return r==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${r}: ${e}`.slice(0,50))}function Mue(r){return r.split(":")[0]}var kV=(()=>{class r extends Em{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let n;if(Array.isArray(t)){let o=t.map(i=>this._getOptionId(i));n=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else n=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(t){this.onChange=n=>{let o=[],i=n.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let c=s[a],l=this._getOptionValue(c.value);o.push(l)}}else{let s=n.options;for(let a=0;a<s.length;a++){let c=s[a];if(c.selected){let l=this._getOptionValue(c.value);o.push(l)}}}this.value=o,t(o)}}_registerOption(t){let n=(this._idCounter++).toString();return this._optionMap.set(n,t),n}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,t))return n;return null}_getOptionValue(t){let n=Mue(t);return this._optionMap.has(n)?this._optionMap.get(n)._value:t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,o){n&1&&_e("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Mo([Pue]),Yr]})}return r})(),ec=(()=>{class r{_element;_renderer;_select;id;_value;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(sV(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(sV(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||r)(oe(io),oe(us),oe(kV,9))};static \u0275dir=Tt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return r})();function RV(r){return typeof r=="number"?r:parseFloat(r)}var NV=(()=>{class r{_validator=S4;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let n=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(n),this._validator=this._enabled?this.createValidator(n):S4,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(n){return new(n||r)};static \u0275dir=Tt({type:r,features:[ls]})}return r})(),kue={provide:mf,useExisting:wn(()=>Y9),multi:!0},Y9=(()=>{class r extends NV{max;inputName="max";normalizeInput=t=>RV(t);createValidator=t=>uV(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&rf("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[Mo([kue]),Yr]})}return r})(),Rue={provide:mf,useExisting:wn(()=>X9),multi:!0},X9=(()=>{class r extends NV{min;inputName="min";normalizeInput=t=>RV(t);createValidator=t=>lV(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=Ii(r)))(o||r)}})();static \u0275dir=Tt({type:r,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&rf("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Mo([Rue]),Yr]})}return r})();var OV=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=Ai({type:r});static \u0275inj=Wo({})}return r})(),U9=class extends xm{constructor(e,t,n){super($9(t),z9(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){let n=this._adjustIndex(e);n<0&&(n=0),this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){let o=this._adjustIndex(e);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),t&&(this.controls.splice(o,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){SV(this,!1,e),e.forEach((n,o)=>{_V(this,!1,o),this.at(o).setValue(n,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((n,o)=>{this.at(o)&&this.at(o).patchValue(n,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,o)=>{n.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,n)=>n._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function aV(r){return!!r&&(r.asyncValidators!==void 0||r.validators!==void 0||r.updateOn!==void 0)}var LV=(()=>{class r{useNonNullable=!1;get nonNullable(){let t=new r;return t.useNonNullable=!0,t}group(t,n=null){let o=this._reduceControls(t),i={};return aV(n)?i=n:n!==null&&(i.validators=n.validator,i.asyncValidators=n.asyncValidator),new T4(o,i)}record(t,n=null){let o=this._reduceControls(t);return new F9(o,n)}control(t,n,o){let i={};return this.useNonNullable?(aV(n)?i=n:(i.validators=n,i.asyncValidators=o),new xy(t,I(v({},i),{nonNullable:!0}))):new xy(t,n,o)}array(t,n,o){let i=t.map(s=>this._createControl(s));return new U9(i,n,o)}_reduceControls(t){let n={};return Object.keys(t).forEach(o=>{n[o]=this._createControl(t[o])}),n}_createControl(t){if(t instanceof xy)return t;if(t instanceof xm)return t;if(Array.isArray(t)){let n=t[0],o=t.length>1?t[1]:null,i=t.length>2?t[2]:null;return this.control(n,o,i)}else return this.control(t)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ro=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:_y,useValue:t.callSetDisabledState??Sy}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Ai({type:r});static \u0275inj=Wo({imports:[OV]})}return r})(),FV=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:TV,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:_y,useValue:t.callSetDisabledState??Sy}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Ai({type:r});static \u0275inj=Wo({imports:[OV]})}return r})();var vu=class r{hash(e){return f(this,null,function*(){let t=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")})}verify(e,t){return f(this,null,function*(){return(yield this.hash(e))===t})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var Zo=class r{constructor(e,t){this.hashService=e;this.storageService=t}store(e){return f(this,null,function*(){let n={algorithm:"sha256",value:yield this.hashService.hash(e.data)},o=this.getPath(n);return(yield this.storageService.exists(o))||(yield this.storageService.write(o,e.data)),n})}retrieve(e){return f(this,null,function*(){let t=this.getPath(e);try{return{data:yield this.storageService.read(t),hash:e}}catch{throw new Error("Content not found")}})}exists(e){return f(this,null,function*(){let t=this.getPath(e);return this.storageService.exists(t)})}getMetadata(e){return f(this,null,function*(){let t=yield this.retrieve(e);return{hash:e,size:t.data.length,createdAt:new Date}})}getAllContent(){return f(this,null,function*(){let e=yield this.storageService.list(),t="cas/",n=e.filter(i=>i.startsWith(t)).map(i=>f(this,null,function*(){try{let s=yield this.storageService.read(i),a=i.split("/");if(a.length>=3){let c=a[1],l=a[2];return{content:{data:s},hash:{algorithm:c,value:l}}}return null}catch(s){return console.error(`Error reading path ${i}:`,s),null}}));return(yield Promise.all(n)).filter(i=>i!==null)})}getPath(e){return`cas/${e.algorithm}/${e.value}`}static \u0275fac=function(t){return new(t||r)(xe(vu),xe(gs))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var Cm=class r{detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}formatHashForDisplay(e,t=16){return e.length<=t?e:`${e.substring(0,6)}...${e.substring(e.length-8)}`}generatePreview(e,t,n=1e3){switch(t){case"text":try{let c=new TextDecoder("utf-8",{fatal:!0}).decode(e);return c.length>n?c.substring(0,n)+"...":c}catch{return"Unable to decode as text"}case"json":try{let c=new TextDecoder().decode(e),l=JSON.parse(c),u=JSON.stringify(l,null,2);return u.length>n?u.substring(0,n)+"...":u}catch{return"Invalid JSON"}case"hex":let o=Math.min(e.length,256),i=Array.from(e.slice(0,o)).map(c=>c.toString(16).padStart(2,"0")).join(" ").toUpperCase();return e.length>o&&(i+=" ..."),i;case"base64":let s=Math.min(e.length,1e3),a=btoa(String.fromCharCode(...e.slice(0,s)));return e.length>s&&(a+="..."),a;default:return"Unsupported format"}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};function Nue(r,e){r&1&&(b(0,"div",11),_(1," Loading content... "),y())}function Oue(r,e){r&1&&(b(0,"div",12)(1,"p"),_(2,"No content found"),y()())}function Lue(r,e){if(r&1&&(b(0,"span"),_(1),y()),r&2){let t=G().$implicit;D(),je("\u2022 ",t.metadata.contentType)}}function Fue(r,e){if(r&1&&(b(0,"span",37),_(1),y()),r&2){let t=G(3).$implicit;D(),je("(Detected: ",t.detectedType,")")}}function Bue(r,e){if(r&1){let t=nt();b(0,"div",29)(1,"label"),_(2,"Preview as: "),y(),b(3,"select",30),wr("ngModelChange",function(o){Re(t);let i=G(2).$implicit;return Tr(i.previewType,o)||(i.previewType=o),Ne(o)}),_e("change",function(){Re(t);let o=G(2).$implicit,i=G();return Ne(i.updatePreview(o))}),b(4,"option",31),_(5,"Text"),y(),b(6,"option",32),_(7,"JSON"),y(),b(8,"option",33),_(9,"Hex"),y(),b(10,"option",34),_(11,"Base64"),y(),b(12,"option",35),_(13,"Image"),y()(),ye(14,Fue,2,1,"span",36),y()}if(r&2){let t=G(2).$implicit;D(3),vr("ngModel",t.previewType),D(11),z("ngIf",t.detectedType)}}function Uue(r,e){if(r&1&&(b(0,"pre"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function Vue(r,e){if(r&1&&(b(0,"code"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function jue(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function Hue(r,e){if(r&1&&Bt(0,"img",38),r&2){let t=G(2).$implicit;z("src",t.previewData,au)}}function $ue(r,e){if(r&1&&(b(0,"div",25),ye(1,Bue,15,2,"div",26),b(2,"div",27),ye(3,Uue,2,1,"pre",20)(4,Vue,2,1,"code",20)(5,jue,2,1,"p",20)(6,Hue,1,1,"img",28),y()()),r&2){let t=G().$implicit,n=G();D(),z("ngIf",!n.simplePreview),D(),z("ngClass","preview-"+t.previewType),D(),z("ngIf",t.previewType==="json"),D(),z("ngIf",t.previewType==="hex"||t.previewType==="base64"),D(),z("ngIf",t.previewType==="text"),D(),z("ngIf",t.previewType==="image")}}function zue(r,e){if(r&1){let t=nt();b(0,"button",39),_e("click",function(o){Re(t);let i=G().$implicit;return G().selectContent(i.hash),Ne(o.stopPropagation())}),_(1),y()}if(r&2){let t=G(2);D(),je(" ",t.selectButtonText," ")}}function que(r,e){if(r&1){let t=nt();b(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),_(4),Ti(5,"uppercase"),y(),b(6,"span",17),_(7),y()(),b(8,"div",18)(9,"code"),_(10),y()(),b(11,"div",19)(12,"span"),_(13),Ti(14,"date"),y(),ye(15,Lue,2,1,"span",20),y()(),ye(16,$ue,7,6,"div",21),b(17,"div",22),ye(18,zue,2,1,"button",23),b(19,"button",24),_e("click",function(o){let i=Re(t).$implicit;return G().togglePreview(i),Ne(o.stopPropagation())}),_(20),y()()()}if(r&2){let t=e.$implicit,n=G();D(4),Se(Zc(5,9,t.hash.algorithm)),D(3),Se(n.previewService.formatFileSize(t.metadata.size||0)),D(3),Se(t.hash.value),D(3),Se(lu(14,11,t.metadata.createdAt,"short")),D(2),z("ngIf",t.metadata.contentType),D(),z("ngIf",t.previewData),D(2),z("ngIf",n.selectable),D(),z("disabled",t.isLoadingPreview),D(),je(" ",t.isLoadingPreview?"Loading...":t.previewData?"Hide Preview":"Show Preview"," ")}}var wu=class r{constructor(e,t){this.casService=e;this.previewService=t}title="Select Content";searchPlaceholder="Search by hash...";selectable=!0;selectButtonText="Select";simplePreview=!1;filterByContentType;contentSelected=new Rt;closed=new Rt;contentItems=[];filteredItems=[];searchTerm="";isLoading=!1;ngOnInit(){this.loadContent()}loadContent(){return f(this,null,function*(){this.isLoading=!0;try{let e=yield this.casService.getAllContent();this.contentItems=[];for(let t of e){let n=yield this.casService.getMetadata(t.hash);this.contentItems.push({hash:t.hash,metadata:n,previewData:null,previewType:null,isLoadingPreview:!1})}this.filterContent()}catch(e){console.error("Failed to load content:",e)}finally{this.isLoading=!1}})}filterContent(){let e=[...this.contentItems];if(this.filterByContentType&&(e=e.filter(t=>t.metadata.contentType===this.filterByContentType)),this.searchTerm){let t=this.searchTerm.toLowerCase();e=e.filter(n=>n.hash.value.toLowerCase().includes(t)||n.metadata.contentType&&n.metadata.contentType.toLowerCase().includes(t))}this.filteredItems=e}selectContent(e){this.contentSelected.emit(e),this.close()}close(){this.closed.emit()}togglePreview(e){return f(this,null,function*(){e.previewData?(e.previewData=null,e.previewType=null,e.detectedType=void 0):yield this.loadPreview(e)})}loadPreview(e){return f(this,null,function*(){if(!e.isLoadingPreview){e.isLoadingPreview=!0;try{let t=yield this.casService.retrieve(e.hash),n=this.detectContentType(t.data);e.detectedType=n,e.previewType=this.getInitialPreviewType(n,t.data),this.updatePreviewData(e,t.data)}catch(t){console.error("Failed to preview content:",t)}finally{e.isLoadingPreview=!1}}})}detectContentType(e){return this.previewService.detectContentType(e)}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updatePreview(e){e.previewData&&this.casService.retrieve(e.hash).then(t=>{this.updatePreviewData(e,t.data)}).catch(t=>{console.error("Failed to update preview:",t)})}updatePreviewData(e,t){if(e.previewType==="image"){let n=new Blob([t]),o=new FileReader;o.onload=()=>{e.previewData=o.result},o.readAsDataURL(n)}else e.previewType&&(e.previewData=this.previewService.generatePreview(t,e.previewType))}static \u0275fac=function(t){return new(t||r)(oe(Zo),oe(Cm))};static \u0275cmp=Qt({type:r,selectors:[["app-content-selection-modal"]],inputs:{title:"title",searchPlaceholder:"searchPlaceholder",selectable:"selectable",selectButtonText:"selectButtonText",simplePreview:"simplePreview",filterByContentType:"filterByContentType"},outputs:{contentSelected:"contentSelected",closed:"closed"},decls:14,vars:7,consts:[[1,"modal-backdrop",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-button",3,"click"],[1,"modal-body"],[1,"search-bar"],["type","text",1,"search-input",3,"ngModelChange","ngModel","placeholder"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"content-list"],["class","content-item",4,"ngFor","ngForOf"],[1,"loading"],[1,"empty-state"],[1,"content-item"],[1,"item-clickable"],[1,"item-header"],[1,"algorithm"],[1,"size"],[1,"hash-value"],[1,"metadata"],[4,"ngIf"],["class","preview-section",4,"ngIf"],[1,"item-actions"],["class","select-button",3,"click",4,"ngIf"],[1,"preview-button",3,"click","disabled"],[1,"preview-section"],["class","preview-controls",4,"ngIf"],[1,"preview",3,"ngClass"],["alt","Preview",3,"src",4,"ngIf"],[1,"preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"],[1,"select-button",3,"click"]],template:function(t,n){t&1&&(b(0,"div",0),_e("click",function(){return n.close()}),b(1,"div",1),_e("click",function(i){return i.stopPropagation()}),b(2,"div",2)(3,"h2"),_(4),y(),b(5,"button",3),_e("click",function(){return n.close()}),_(6,"\xD7"),y()(),b(7,"div",4)(8,"div",5)(9,"input",6),wr("ngModelChange",function(i){return Tr(n.searchTerm,i)||(n.searchTerm=i),i}),_e("ngModelChange",function(){return n.filterContent()}),y()(),ye(10,Nue,2,0,"div",7)(11,Oue,3,0,"div",8),b(12,"div",9),ye(13,que,21,14,"div",10),y()()()()),t&2&&(D(4),Se(n.title),D(5),z("placeholder",MI(n.searchPlaceholder)),vr("ngModel",n.searchTerm),D(),z("ngIf",n.isLoading),D(),z("ngIf",!n.isLoading&&n.filteredItems.length===0),D(2),z("ngForOf",n.filteredItems))},dependencies:[Zt,of,Xo,Ur,sf,af,Ro,Ja,ec,Qo,vs,ys,ta],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;max-width:800px;width:90%;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 4px 20px #00000026}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #e0e0e0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:30px;color:#999;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.close-button[_ngcontent-%COMP%]:hover{color:#333}.modal-body[_ngcontent-%COMP%]{padding:20px;overflow-y:auto;flex:1}.search-bar[_ngcontent-%COMP%]{margin-bottom:20px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.content-list[_ngcontent-%COMP%]{display:grid;gap:10px}.content-item[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;transition:all .2s;background-color:#f9f9f9;overflow:hidden}.item-clickable[_ngcontent-%COMP%]{padding:15px}.content-item[_ngcontent-%COMP%]:hover   .item-clickable[_ngcontent-%COMP%]{background-color:#e3f2fd}.content-item[_ngcontent-%COMP%]:hover{border-color:#2196f3;transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.algorithm[_ngcontent-%COMP%]{font-weight:600;color:#2196f3;font-size:14px}.size[_ngcontent-%COMP%]{color:#666;font-size:14px}.hash-value[_ngcontent-%COMP%]{margin-bottom:8px;padding:8px;background-color:#fff;border-radius:4px;border:1px solid #e0e0e0}.hash-value[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace;font-size:12px;word-break:break-all;color:#333}.metadata[_ngcontent-%COMP%]{font-size:12px;color:#666;display:flex;gap:10px}.preview-section[_ngcontent-%COMP%]{padding:15px;background-color:#f5f5f5;border-top:1px solid #e0e0e0}.preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.preview-type-select[_ngcontent-%COMP%]{padding:5px;border:1px solid #ddd;border-radius:4px;font-size:14px}.detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}.item-actions[_ngcontent-%COMP%]{padding:10px 15px;background-color:#f9f9f9;border-top:1px solid #e0e0e0;display:flex;gap:10px}.select-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background-color .2s}.select-button[_ngcontent-%COMP%]:hover{background-color:#218838}.preview-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .2s}.preview-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.preview-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};var ws=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=Ai({type:r});static \u0275inj=Wo({imports:[Zt,Ro,wu,vm,Zt,Ro]})};function Gue(r,e){r&1&&(b(0,"div",7),_(1," Loading content... "),y())}function Wue(r,e){r&1&&(b(0,"div",8)(1,"p"),_(2,"No content found"),y()())}function Yue(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G().$implicit;D(),je("Type: ",t.metadata.contentType)}}function Xue(r,e){if(r&1&&(b(0,"span",30),_(1),y()),r&2){let t=G(2).$implicit;D(),je("(Detected: ",t.detectedType,")")}}function Que(r,e){if(r&1&&(b(0,"pre"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function Zue(r,e){if(r&1&&(b(0,"code"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function Jue(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G(2).$implicit;D(),Se(t.previewData)}}function ede(r,e){if(r&1&&Bt(0,"img",31),r&2){let t=G(2).$implicit;z("src",t.previewData,au)}}function tde(r,e){if(r&1){let t=nt();b(0,"div",19)(1,"div",20)(2,"label"),_(3,"Preview as: "),y(),b(4,"select",21),wr("ngModelChange",function(o){Re(t);let i=G().$implicit;return Tr(i.previewType,o)||(i.previewType=o),Ne(o)}),_e("change",function(){Re(t);let o=G().$implicit,i=G();return Ne(i.updatePreview(o))}),b(5,"option",22),_(6,"Text"),y(),b(7,"option",23),_(8,"JSON"),y(),b(9,"option",24),_(10,"Hex"),y(),b(11,"option",25),_(12,"Base64"),y(),b(13,"option",26),_(14,"Image"),y()(),ye(15,Xue,2,1,"span",27),y(),b(16,"div",28),ye(17,Que,2,1,"pre",14)(18,Zue,2,1,"code",14)(19,Jue,2,1,"p",14)(20,ede,1,1,"img",29),y()()}if(r&2){let t=G().$implicit;D(4),vr("ngModel",t.previewType),D(11),z("ngIf",t.detectedType),D(),z("ngClass","preview-"+t.previewType),D(),z("ngIf",t.previewType==="json"),D(),z("ngIf",t.previewType==="hex"||t.previewType==="base64"),D(),z("ngIf",t.previewType==="text"),D(),z("ngIf",t.previewType==="image")}}function rde(r,e){if(r&1){let t=nt();b(0,"div",9)(1,"div",10)(2,"h3"),_(3),Ti(4,"uppercase"),y(),b(5,"span",11),_(6),y()(),b(7,"div",12)(8,"code"),_(9),y()(),b(10,"div",13)(11,"p"),_(12),Ti(13,"date"),y(),ye(14,Yue,2,1,"p",14),y(),ye(15,tde,21,7,"div",15),b(16,"div",16)(17,"button",17),_e("click",function(){let o=Re(t).$implicit,i=G();return Ne(i.previewContent(o))}),_(18),y(),b(19,"button",18),_e("click",function(){let o=Re(t).$implicit,i=G();return Ne(i.downloadContent(o.hash))}),_(20," Download "),y()()()}if(r&2){let t=e.$implicit,n=G();D(3),Se(Zc(4,8,t.hash.algorithm)),D(3),Se(n.formatFileSize(t.metadata.size||0)),D(3),Se(t.hash.value),D(3),je("Created: ",lu(13,10,t.metadata.createdAt,"short")),D(2),z("ngIf",t.metadata.contentType),D(),z("ngIf",t.previewData),D(2),z("disabled",t.previewData!==null),D(),je(" ",t.previewData!==null?"Preview Loaded":"Load Preview"," ")}}var F4=class r{constructor(e){this.casService=e}filter;contentSelected=new Rt;contentItems=[];filteredItems=[];searchTerm="";isLoading=!1;ngOnInit(){this.loadContentItems()}loadContentItems(){return f(this,null,function*(){this.isLoading=!0;try{let e=yield this.casService.getAllContent();this.contentItems=[];for(let t of e){let n=yield this.casService.getMetadata(t.hash);this.contentItems.push({hash:t.hash,metadata:n,previewData:null,previewType:null})}this.filterContent()}catch(e){console.error("Failed to load content items:",e)}finally{this.isLoading=!1}})}addContentItem(e,t){let n={hash:e,metadata:t,previewData:null,previewType:null};this.contentItems.push(n),this.filterContent()}filterContent(){if(!this.searchTerm)this.filteredItems=[...this.contentItems];else{let e=this.searchTerm.toLowerCase();this.filteredItems=this.contentItems.filter(t=>t.hash.value.toLowerCase().includes(e))}}selectContent(e){this.contentSelected.emit(e)}previewContent(e){return f(this,null,function*(){if(e.previewData===null)try{let t=yield this.casService.retrieve(e.hash),n=this.detectContentType(t.data);e.detectedType=n,e.previewType||(e.previewType=this.getInitialPreviewType(n,t.data)),this.updatePreviewData(e,t.data)}catch(t){console.error("Failed to preview content:",t)}})}detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updatePreview(e){e.previewData&&this.casService.retrieve(e.hash).then(t=>{this.updatePreviewData(e,t.data)}).catch(t=>{console.error("Failed to update preview:",t)})}updatePreviewData(e,t){switch(e.previewType){case"text":try{let c=new TextDecoder().decode(t);e.previewData=c.length>1e3?c.substring(0,1e3)+"...":c}catch{e.previewData="Unable to decode as text"}break;case"json":try{let c=new TextDecoder().decode(t),l=JSON.parse(c);e.previewData=JSON.stringify(l,null,2),e.previewData.length>1e3&&(e.previewData=e.previewData.substring(0,1e3)+"...")}catch{e.previewData="Invalid JSON"}break;case"hex":let o=Math.min(t.length,256);e.previewData=Array.from(t.slice(0,o)).map(c=>c.toString(16).padStart(2,"0")).join(" ").toUpperCase(),t.length>o&&(e.previewData+=" ...");break;case"base64":let i=Math.min(t.length,1e3);e.previewData=btoa(String.fromCharCode(...t.slice(0,i))),t.length>i&&(e.previewData+="...");break;case"image":let s=new Blob([t]),a=new FileReader;a.onload=()=>{e.previewData=a.result},a.readAsDataURL(s);break}}downloadContent(e){return f(this,null,function*(){try{let t=yield this.casService.retrieve(e);this.downloadFile(t.data,e.value)}catch(t){console.error("Failed to download content:",t)}})}downloadFile(e,t){let n=new Blob([e]),o=window.URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}static \u0275fac=function(t){return new(t||r)(oe(Zo))};static \u0275cmp=Qt({type:r,selectors:[["app-content-list"]],inputs:{filter:"filter"},outputs:{contentSelected:"contentSelected"},decls:9,vars:4,consts:[[1,"content-list"],[1,"search-bar"],["type","text","placeholder","Search by hash...",1,"search-input",3,"ngModelChange","ngModel"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"content-grid"],["class","content-card",4,"ngFor","ngForOf"],[1,"loading"],[1,"empty-state"],[1,"content-card"],[1,"card-header"],[1,"file-size"],[1,"hash-value"],[1,"metadata"],[4,"ngIf"],["class","preview-section",4,"ngIf"],[1,"actions"],[1,"action-button",3,"click","disabled"],[1,"action-button",3,"click"],[1,"preview-section"],[1,"preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"preview",3,"ngClass"],["alt","Preview",3,"src",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"h2"),_(2,"Stored Content"),y(),b(3,"div",1)(4,"input",2),wr("ngModelChange",function(i){return Tr(n.searchTerm,i)||(n.searchTerm=i),i}),_e("ngModelChange",function(){return n.filterContent()}),y()(),ye(5,Gue,2,0,"div",3)(6,Wue,3,0,"div",4),b(7,"div",5),ye(8,rde,21,13,"div",6),y()()),t&2&&(D(4),vr("ngModel",n.searchTerm),D(),z("ngIf",n.isLoading),D(),z("ngIf",!n.isLoading&&n.filteredItems.length===0),D(2),z("ngForOf",n.filteredItems))},dependencies:[Zt,of,Xo,Ur,sf,af,ws,Ja,ec,Qo,vs,ys,ta,Ro],styles:[".content-list[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.search-bar[_ngcontent-%COMP%]{margin-bottom:20px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}.content-card[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;background-color:#f9f9f9}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.file-size[_ngcontent-%COMP%]{color:#666;font-size:14px}.hash-value[_ngcontent-%COMP%]{margin-bottom:15px;padding:10px;background-color:#e9ecef;border-radius:4px;overflow-wrap:break-word}.hash-value[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace;font-size:12px}.metadata[_ngcontent-%COMP%]{margin-bottom:15px;font-size:14px;color:#666}.metadata[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.preview-section[_ngcontent-%COMP%]{margin-bottom:15px}.preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.preview-type-select[_ngcontent-%COMP%]{padding:5px;border:1px solid #ddd;border-radius:4px;font-size:14px}.detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}.actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-button[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:none;border-radius:4px;cursor:pointer;font-size:14px;background-color:#007bff;color:#fff;transition:background-color .3s}.action-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};function nde(r,e){if(r&1&&(b(0,"div",8)(1,"p"),_(2),y(),b(3,"p"),_(4),y(),b(5,"p"),_(6),y()()),r&2){let t=G();D(2),je("Selected: ",t.selectedFile.name),D(2),je("Size: ",t.formatFileSize(t.selectedFile.size)),D(2),je("Type: ",t.selectedFile.type||"Unknown")}}function ode(r,e){if(r&1&&(b(0,"div",9),_(1),y()),r&2){let t=G();D(),je(" ",t.errorMessage," ")}}function ide(r,e){if(r&1){let t=nt();b(0,"div",10)(1,"h3"),_(2,"Content Stored Successfully!"),y(),b(3,"p"),_(4),y(),b(5,"p"),_(6,"Hash: "),b(7,"code"),_(8),y()(),b(9,"button",11),_e("click",function(){Re(t);let o=G();return Ne(o.navigateToContentList())}),_(10," View All Content "),y()()}if(r&2){let t=G();D(4),je("Algorithm: ",t.uploadedHash.algorithm),D(4),Se(t.uploadedHash.value)}}var B4=class r{constructor(e,t){this.casService=e;this.router=t}contentStored=new Rt;selectedFile=null;uploadedHash=null;isUploading=!1;errorMessage="";onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&(this.selectedFile=t.files[0],this.errorMessage="",this.uploadedHash=null)}uploadFile(){return f(this,null,function*(){if(!this.selectedFile){this.errorMessage="Please select a file";return}this.isUploading=!0,this.errorMessage="";try{let e=yield this.readFileAsArrayBuffer(this.selectedFile),t={data:new Uint8Array(e)};this.uploadedHash=yield this.casService.store(t),this.contentStored.emit(this.uploadedHash)}catch(e){this.errorMessage=`Upload failed: ${e instanceof Error?e.message:"Unknown error"}`}finally{this.isUploading=!1}})}readFileAsArrayBuffer(e){return new Promise((t,n)=>{let o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>n(new Error("Failed to read file")),o.readAsArrayBuffer(e)})}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}navigateToContentList(){this.router.navigate(["/content"])}static \u0275fac=function(t){return new(t||r)(oe(Zo),oe(Za))};static \u0275cmp=Qt({type:r,selectors:[["app-content-upload"]],outputs:{contentStored:"contentStored"},decls:11,vars:6,consts:[["fileInput",""],[1,"content-upload"],[1,"upload-area"],["type","file",1,"file-input",3,"change","disabled"],["class","file-info",4,"ngIf"],[1,"upload-button",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],[1,"file-info"],[1,"error-message"],[1,"success-message"],[1,"view-content-button",3,"click"]],template:function(t,n){if(t&1){let o=nt();b(0,"div",1)(1,"h2"),_(2,"Upload Content to CAS"),y(),b(3,"div",2)(4,"input",3,0),_e("change",function(s){return Re(o),Ne(n.onFileSelected(s))}),y(),ye(6,nde,7,3,"div",4),b(7,"button",5),_e("click",function(){return Re(o),Ne(n.uploadFile())}),_(8),y(),ye(9,ode,2,1,"div",6)(10,ide,11,2,"div",7),y()()}t&2&&(D(4),z("disabled",n.isUploading),D(2),z("ngIf",n.selectedFile),D(),z("disabled",!n.selectedFile||n.isUploading),D(),je(" ",n.isUploading?"Uploading...":"Upload to CAS"," "),D(),z("ngIf",n.errorMessage),D(),z("ngIf",n.uploadedHash))},dependencies:[Zt,Ur,ws],styles:[".content-upload[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.upload-area[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:30px;text-align:center;background-color:#f9f9f9}.file-input[_ngcontent-%COMP%]{margin-bottom:20px}.file-info[_ngcontent-%COMP%]{margin:20px 0;padding:15px;background-color:#e9ecef;border-radius:4px;text-align:left}.file-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.upload-button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px}.upload-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{color:#dc3545;margin-top:15px;padding:10px;background-color:#f8d7da;border-radius:4px}.success-message[_ngcontent-%COMP%]{color:#155724;margin-top:15px;padding:15px;background-color:#d4edda;border-radius:4px;text-align:left}.success-message[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;word-break:break-all}.view-content-button[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin-top:15px}.view-content-button[_ngcontent-%COMP%]:hover{background-color:#218838}"]})};var bu=class r{constructor(e){this.hashService=e}generateKeyPair(){return f(this,null,function*(){let e=yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),t=yield crypto.subtle.exportKey("jwk",e.privateKey),n=yield crypto.subtle.exportKey("jwk",e.publicKey),o=this.jwkToHex(t),i=this.jwkToHex(n);return{privateKey:o,publicKey:i}})}sign(e,t){return f(this,null,function*(){let n=yield this.hashService.hash(e),o=yield this.hashService.hash(new TextEncoder().encode(n+t)),i=yield this.hashService.hash(new TextEncoder().encode(t+"_public"));return{value:o,algorithm:"secp256k1",publicKey:i}})}verify(e,t){return f(this,null,function*(){try{return yield this.hashService.hash(e),t.algorithm==="secp256k1"&&t.value.length===64&&t.publicKey.length===64&&/^[a-f0-9]{64}$/.test(t.value)}catch{return!1}})}jwkToHex(e){let t=JSON.stringify(e,Object.keys(e).sort());return Array.from(new TextEncoder().encode(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}static \u0275fac=function(t){return new(t||r)(xe(vu))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var tc=class r{constructor(e,t,n){this.casService=e;this.signatureService=t;this.hashService=n}entries=new Map;createEntry(e,t,n,o){return f(this,null,function*(){let i=new Date,s,a;if(this.isContentHash(e))s=e;else{let m=new TextEncoder().encode(JSON.stringify(e));s={algorithm:"sha256",value:yield this.hashService.hash(m)},a=e}o&&(a=v(v({},a),o));let c=v({contentHash:s,type:t,timestamp:i.toISOString()},a&&{metadata:a}),l=new TextEncoder().encode(JSON.stringify(c)),u=yield this.signatureService.sign(l,n),d=v({id:"",contentHash:s,signature:u,timestamp:i,type:t},a&&{metadata:a}),h=new TextEncoder().encode(JSON.stringify(d)),p=yield this.casService.store({data:h});return d.id=p.value,this.entries.set(d.id,d),d})}isContentHash(e){return e&&typeof e.algorithm=="string"&&typeof e.value=="string"}verifyEntry(e){return f(this,null,function*(){let t=v({contentHash:e.contentHash,type:e.type,timestamp:e.timestamp.toISOString()},e.metadata&&{metadata:e.metadata}),n=new TextEncoder().encode(JSON.stringify(t));return this.signatureService.verify(n,e.signature)})}getEntry(e){return f(this,null,function*(){if(this.entries.has(e))return this.entries.get(e);try{let t=yield this.casService.retrieve({algorithm:"sha256",value:e}),n=new TextDecoder().decode(t.data),o=JSON.parse(n);return o.timestamp=new Date(o.timestamp),this.entries.set(e,o),o}catch{throw new Error("DISOT entry not found")}})}listEntries(e){return f(this,null,function*(){let t=Array.from(this.entries.values());return e&&(e.type&&(t=t.filter(n=>n.type===e.type)),e.publicKey&&(t=t.filter(n=>n.signature.publicKey===e.publicKey)),e.fromDate&&(t=t.filter(n=>n.timestamp>=e.fromDate)),e.toDate&&(t=t.filter(n=>n.timestamp<=e.toDate))),t.sort((n,o)=>o.timestamp.getTime()-n.timestamp.getTime())})}static \u0275fac=function(t){return new(t||r)(xe(Zo),xe(bu),xe(vu))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};function ade(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",18),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onContentSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.showContentModal=!1)}),y()}}function cde(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",19),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onAuthorSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.showAuthorModal=!1)}),y()}r&2&&z("title","Select Author Entry")("searchPlaceholder","Search by public key or entry ID...")("filterByContentType","author")}function lde(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",20),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onPreviousVersionSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.showPreviousVersionModal=!1)}),y()}r&2&&z("title","Select Previous Version")("searchPlaceholder","Search by entry ID or content hash...")}function ude(r,e){if(r&1){let t=nt();b(0,"div",21)(1,"p")(2,"strong"),_(3,"Algorithm:"),y(),_(4),Ti(5,"uppercase"),y(),b(6,"p")(7,"strong"),_(8,"Hash:"),y(),b(9,"code"),_(10),y()(),b(11,"button",22),_e("click",function(){Re(t);let o=G();return Ne(o.clearContent())}),_(12,"Clear Selection"),y()()}if(r&2){let t=G();D(4),je(" ",Zc(5,2,t.contentHash.algorithm)),D(6),Se(t.contentHash.value)}}function dde(r,e){if(r&1){let t=nt();b(0,"div",23)(1,"p"),_(2,"No content selected. Please select content from the content list."),y(),b(3,"button",24),_e("click",function(){Re(t);let o=G();return Ne(o.selectContent())}),_(4,"Select Content"),y()()}}function fde(r,e){if(r&1&&(b(0,"option",25),_(1),y()),r&2){let t=e.$implicit,n=G();z("value",t),D(),je(" ",n.formatEntryType(t)," ")}}function pde(r,e){if(r&1&&(b(0,"div",26)(1,"p")(2,"strong"),_(3,"Public Key:"),y()(),b(4,"code"),_(5),y()()),r&2){let t=G();D(5),Se(t.publicKey)}}function hde(r,e){if(r&1){let t=nt();b(0,"div",4)(1,"h3"),_(2,"Blog Post Content"),y(),b(3,"textarea",27),wr("ngModelChange",function(o){Re(t);let i=G();return Tr(i.blogPostContent,o)||(i.blogPostContent=o),Ne(o)}),y()()}if(r&2){let t=G();D(3),vr("ngModel",t.blogPostContent),z("disabled",t.isCreating)}}function mde(r,e){if(r&1){let t=nt();b(0,"div",21)(1,"p")(2,"strong"),_(3,"Author ID:"),y(),b(4,"code"),_(5),y()(),b(6,"button",22),_e("click",function(){Re(t);let o=G();return Ne(o.clearAuthor())}),_(7,"Clear Selection"),y()()}if(r&2){let t=G();D(5),Se(t.selectedAuthor)}}function gde(r,e){if(r&1){let t=nt();b(0,"div",23)(1,"p"),_(2,"No author selected. Optionally select an author entry."),y(),b(3,"button",24),_e("click",function(){Re(t);let o=G();return Ne(o.selectAuthor())}),_(4,"Select Author"),y()()}}function yde(r,e){if(r&1){let t=nt();b(0,"div",21)(1,"p")(2,"strong"),_(3,"Previous Version ID:"),y(),b(4,"code"),_(5),y()(),b(6,"button",22),_e("click",function(){Re(t);let o=G();return Ne(o.clearPreviousVersion())}),_(7,"Clear Selection"),y()()}if(r&2){let t=G();D(5),Se(t.selectedPreviousVersion)}}function vde(r,e){if(r&1){let t=nt();b(0,"div",23)(1,"p"),_(2,"No previous version selected. Optionally link to a previous version."),y(),b(3,"button",24),_e("click",function(){Re(t);let o=G();return Ne(o.selectPreviousVersion())}),_(4,"Select Previous Version"),y()()}}function wde(r,e){if(r&1&&(b(0,"div",28),_(1),y()),r&2){let t=G();D(),je(" ",t.errorMessage," ")}}function bde(r,e){if(r&1&&(b(0,"div",29)(1,"h3"),_(2,"Entry Created Successfully!"),y(),b(3,"div",30)(4,"p")(5,"strong"),_(6,"Entry ID:"),y(),b(7,"code"),_(8),y()(),b(9,"p")(10,"strong"),_(11,"Type:"),y(),_(12),y(),b(13,"p")(14,"strong"),_(15,"Timestamp:"),y(),_(16),Ti(17,"date"),y(),b(18,"p")(19,"strong"),_(20,"Public Key:"),y(),b(21,"code"),_(22),y()(),b(23,"p")(24,"strong"),_(25,"Signature:"),y(),b(26,"code"),_(27),y()()()()),r&2){let t=G();D(8),Se(t.createdEntry.id),D(4),je(" ",t.formatEntryType(t.createdEntry.type)),D(4),je(" ",lu(17,5,t.createdEntry.timestamp,"medium")),D(6),Se(t.createdEntry.signature.publicKey),D(5),Se(t.createdEntry.signature.value)}}function xde(r,e){if(r&1&&(b(0,"span",53),_(1),y()),r&2){let t,n=G(2).$implicit,o=G(2);D(),je("(Detected: ",(t=o.getEntryPreview(n.id))==null?null:t.detectedType,")")}}function Ede(r,e){if(r&1&&(b(0,"pre"),_(1),y()),r&2){let t,n=G(2).$implicit,o=G(2);D(),Se((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function _de(r,e){if(r&1&&(b(0,"code"),_(1),y()),r&2){let t,n=G(2).$implicit,o=G(2);D(),Se((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function Sde(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t,n=G(2).$implicit,o=G(2);D(),Se((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function Cde(r,e){if(r&1&&Bt(0,"img",54),r&2){let t,n=G(2).$implicit,o=G(2);z("src",(t=o.getEntryPreview(n.id))==null?null:t.previewData,au)}}function Ide(r,e){if(r&1){let t=nt();b(0,"div",41)(1,"div",42)(2,"label"),_(3,"Preview as: "),y(),b(4,"select",43),wr("ngModelChange",function(o){Re(t);let i=G().$implicit,s=G(2);return Tr(s.getEntryPreview(i.id).previewType,o)||(s.getEntryPreview(i.id).previewType=o),Ne(o)}),_e("change",function(){Re(t);let o=G().$implicit,i=G(2);return Ne(i.updateEntryPreview(o))}),b(5,"option",44),_(6,"Text"),y(),b(7,"option",45),_(8,"JSON"),y(),b(9,"option",46),_(10,"Hex"),y(),b(11,"option",47),_(12,"Base64"),y(),b(13,"option",48),_(14,"Image"),y()(),ye(15,xde,2,1,"span",49),y(),b(16,"div",50),ye(17,Ede,2,1,"pre",51)(18,_de,2,1,"code",51)(19,Sde,2,1,"p",51)(20,Cde,1,1,"img",52),y()()}if(r&2){let t,n,o,i,s,a,c=G().$implicit,l=G(2);D(4),vr("ngModel",l.getEntryPreview(c.id).previewType),D(11),z("ngIf",(t=l.getEntryPreview(c.id))==null?null:t.detectedType),D(),z("ngClass","preview-"+((n=l.getEntryPreview(c.id))==null?null:n.previewType)),D(),z("ngIf",((o=l.getEntryPreview(c.id))==null?null:o.previewType)==="json"),D(),z("ngIf",((i=l.getEntryPreview(c.id))==null?null:i.previewType)==="hex"||((i=l.getEntryPreview(c.id))==null?null:i.previewType)==="base64"),D(),z("ngIf",((s=l.getEntryPreview(c.id))==null?null:s.previewType)==="text"),D(),z("ngIf",((a=l.getEntryPreview(c.id))==null?null:a.previewType)==="image")}}function Ade(r,e){if(r&1){let t=nt();b(0,"div",34)(1,"div",35)(2,"div",36)(3,"p")(4,"strong"),_(5,"Type:"),y(),_(6),y(),b(7,"p")(8,"strong"),_(9,"Time:"),y(),_(10),Ti(11,"date"),y(),b(12,"p")(13,"strong"),_(14,"ID:"),y(),b(15,"code",37),_(16),y()(),b(17,"p")(18,"strong"),_(19,"Content Hash:"),y(),b(20,"code",37),_(21),y()()(),b(22,"div",38)(23,"button",39),_e("click",function(){let o=Re(t).$implicit,i=G(2);return Ne(i.toggleEntryPreview(o))}),_(24),y()()(),ye(25,Ide,21,7,"div",40),y()}if(r&2){let t,n,o,i=e.$implicit,s=G(2);D(6),je(" ",s.formatEntryType(i.type)),D(4),je(" ",lu(11,7,i.timestamp,"short")),D(6),Se(i.id),D(5),Se(i.contentHash.value),D(2),z("disabled",(t=s.getEntryPreview(i.id))==null?null:t.isLoading),D(),je(" ",(n=s.getEntryPreview(i.id))!=null&&n.isLoading?"Loading...":(n=s.getEntryPreview(i.id))!=null&&n.previewData?"Hide Preview":"Show Preview"," "),D(),z("ngIf",(o=s.getEntryPreview(i.id))==null?null:o.previewData)}}function Dde(r,e){if(r&1&&(b(0,"div",31)(1,"h3"),_(2,"Previous Entries"),y(),b(3,"div",32),ye(4,Ade,26,10,"div",33),y()()),r&2){let t=G();D(4),z("ngForOf",t.previousEntries)}}var V4=class r{constructor(e,t,n){this.disotService=e;this.signatureService=t;this.casService=n}contentHash=null;entryCreated=new Rt;selectedType="document";privateKey="";publicKey="";blogPostContent="";isCreating=!1;errorMessage="";createdEntry=null;previousEntries=[];showContentModal=!1;showAuthorModal=!1;showPreviousVersionModal=!1;selectedAuthor=null;selectedPreviousVersion=null;entryPreviews=new Map;entryTypes=["blog_post","document","image","signature"];ngOnInit(){this.loadPreviousEntries()}generateKeyPair(){return f(this,null,function*(){try{let e=yield this.signatureService.generateKeyPair();this.privateKey=e.privateKey,this.publicKey=e.publicKey,this.errorMessage=""}catch{this.errorMessage="Failed to generate key pair"}})}createEntry(){return f(this,null,function*(){if(!this.privateKey){this.errorMessage="Please enter or generate a private key";return}if(this.selectedType==="blog_post"){if(!this.blogPostContent.trim()){this.errorMessage="Please enter blog post content";return}}else if(!this.contentHash){this.errorMessage="Please select content first";return}this.isCreating=!0,this.errorMessage="";try{let e=this.contentHash;if(this.selectedType==="blog_post"){let n={blogPost:this.blogPostContent},o=JSON.stringify(n),i=new TextEncoder().encode(o);e=yield this.casService.store({data:i})}if(!e)throw new Error("No content hash available");let t={};this.selectedAuthor&&(t.author=this.selectedAuthor),this.selectedPreviousVersion&&(t.previousVersion=this.selectedPreviousVersion),this.createdEntry=yield this.disotService.createEntry(e,this.selectedType,this.privateKey,t),this.entryCreated.emit(this.createdEntry),yield this.loadPreviousEntries()}catch(e){this.errorMessage=`Failed to create entry: ${e instanceof Error?e.message:"Unknown error"}`,this.createdEntry=null}finally{this.isCreating=!1}})}formatEntryType(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}clearContent(){this.contentHash=null}selectContent(){this.showContentModal=!0}onContentSelected(e){this.contentHash=e,this.showContentModal=!1}selectAuthor(){this.showAuthorModal=!0}onAuthorSelected(e){this.selectedAuthor=e.value,this.showAuthorModal=!1}clearAuthor(){this.selectedAuthor=null}selectPreviousVersion(){this.showPreviousVersionModal=!0}onPreviousVersionSelected(e){this.selectedPreviousVersion=e.value,this.showPreviousVersionModal=!1}clearPreviousVersion(){this.selectedPreviousVersion=null}loadPreviousEntries(){return f(this,null,function*(){try{this.previousEntries=yield this.disotService.listEntries()}catch(e){console.error("Failed to load previous entries:",e)}})}getEntryPreview(e){return this.entryPreviews.get(e)}toggleEntryPreview(e){return f(this,null,function*(){this.entryPreviews.get(e.id)?.previewData?this.entryPreviews.delete(e.id):yield this.loadEntryPreview(e)})}loadEntryPreview(e){return f(this,null,function*(){let t=this.entryPreviews.get(e.id)||{previewData:null,previewType:null,isLoading:!1};if(!t.isLoading){t.isLoading=!0,this.entryPreviews.set(e.id,t);try{let n=yield this.casService.retrieve(e.contentHash),o=this.detectContentType(n.data);t.detectedType=o,t.previewType=this.getInitialPreviewType(o,n.data),this.updateEntryPreviewData(e.id,n.data)}catch(n){console.error("Failed to preview entry content:",n),t.previewData="Failed to load content",t.previewType="text"}finally{t.isLoading=!1,this.entryPreviews.set(e.id,t)}}})}detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updateEntryPreview(e){this.entryPreviews.get(e.id)?.previewData&&this.casService.retrieve(e.contentHash).then(n=>{this.updateEntryPreviewData(e.id,n.data)}).catch(n=>{console.error("Failed to update entry preview:",n)})}updateEntryPreviewData(e,t){let n=this.entryPreviews.get(e);if(!n)return;let o=1e3;switch(n.previewType){case"text":try{let l=new TextDecoder().decode(t);n.previewData=l.length>o?l.substring(0,o)+"...":l}catch{n.previewData="Unable to decode as text"}break;case"json":try{let l=new TextDecoder().decode(t),u=JSON.parse(l);n.previewData=JSON.stringify(u,null,2),n.previewData.length>o&&(n.previewData=n.previewData.substring(0,o)+"...")}catch{n.previewData="Invalid JSON"}break;case"hex":let i=Math.min(t.length,256);n.previewData=Array.from(t.slice(0,i)).map(l=>l.toString(16).padStart(2,"0")).join(" ").toUpperCase(),t.length>i&&(n.previewData+=" ...");break;case"base64":let s=Math.min(t.length,1e3);n.previewData=btoa(String.fromCharCode(...t.slice(0,s))),t.length>s&&(n.previewData+="...");break;case"image":let a=new Blob([t]),c=new FileReader;c.onload=()=>{n.previewData=c.result,this.entryPreviews.set(e,n)},c.readAsDataURL(a);return}this.entryPreviews.set(e,n)}static \u0275fac=function(t){return new(t||r)(oe(tc),oe(bu),oe(Zo))};static \u0275cmp=Qt({type:r,selectors:[["app-disot-entry"]],inputs:{contentHash:"contentHash"},outputs:{entryCreated:"entryCreated"},decls:40,vars:21,consts:[[1,"disot-entry"],[3,"contentSelected","closed",4,"ngIf"],[3,"title","searchPlaceholder","filterByContentType","contentSelected","closed",4,"ngIf"],[3,"title","searchPlaceholder","contentSelected","closed",4,"ngIf"],[1,"form-section"],["class","content-info",4,"ngIf"],["class","no-content",4,"ngIf"],[1,"type-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"key-section"],["placeholder","Enter your private key...","rows","3",1,"key-input",3,"ngModelChange","ngModel","disabled"],[1,"generate-button",3,"click","disabled"],["class","public-key-display",4,"ngIf"],["class","form-section",4,"ngIf"],[1,"create-button",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","success-section",4,"ngIf"],["class","entries-section",4,"ngIf"],[3,"contentSelected","closed"],[3,"contentSelected","closed","title","searchPlaceholder","filterByContentType"],[3,"contentSelected","closed","title","searchPlaceholder"],[1,"content-info"],[1,"clear-button",3,"click"],[1,"no-content"],[1,"select-button",3,"click"],[3,"value"],[1,"public-key-display"],["placeholder","Enter your blog post content...","rows","6",1,"blog-input",3,"ngModelChange","ngModel","disabled"],[1,"error-message"],[1,"success-section"],[1,"entry-details"],[1,"entries-section"],[1,"entries-list"],["class","entry-item",4,"ngFor","ngForOf"],[1,"entry-item"],[1,"entry-header"],[1,"entry-info"],[1,"small-code"],[1,"entry-actions"],[1,"preview-entry-button",3,"click","disabled"],["class","entry-preview-section",4,"ngIf"],[1,"entry-preview-section"],[1,"entry-preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"entry-preview",3,"ngClass"],[4,"ngIf"],["alt","Preview",3,"src",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"h2"),_(2,"Create DISOT Entry"),y(),ye(3,ade,1,0,"app-content-selection-modal",1)(4,cde,1,3,"app-content-selection-modal",2)(5,lde,1,2,"app-content-selection-modal",3),b(6,"div",4)(7,"h3"),_(8,"Content Information"),y(),ye(9,ude,13,4,"div",5)(10,dde,5,0,"div",6),y(),b(11,"div",4)(12,"h3"),_(13,"Entry Type"),y(),b(14,"select",7),wr("ngModelChange",function(i){return Tr(n.selectedType,i)||(n.selectedType=i),i}),ye(15,fde,2,2,"option",8),y()(),b(16,"div",4)(17,"h3"),_(18,"Signing Key"),y(),b(19,"div",9)(20,"textarea",10),wr("ngModelChange",function(i){return Tr(n.privateKey,i)||(n.privateKey=i),i}),y(),b(21,"button",11),_e("click",function(){return n.generateKeyPair()}),_(22," Generate New Key Pair "),y(),ye(23,pde,6,1,"div",12),y()(),ye(24,hde,4,2,"div",13),b(25,"div",4)(26,"h3"),_(27,"Author (Optional)"),y(),ye(28,mde,8,1,"div",5)(29,gde,5,0,"div",6),y(),b(30,"div",4)(31,"h3"),_(32,"Previous Version (Optional)"),y(),ye(33,yde,8,1,"div",5)(34,vde,5,0,"div",6),y(),b(35,"button",14),_e("click",function(){return n.createEntry()}),_(36),y(),ye(37,wde,2,1,"div",15)(38,bde,28,8,"div",16)(39,Dde,5,1,"div",17),y()),t&2&&(D(3),z("ngIf",n.showContentModal),D(),z("ngIf",n.showAuthorModal),D(),z("ngIf",n.showPreviousVersionModal),D(4),z("ngIf",n.contentHash),D(),z("ngIf",!n.contentHash),D(4),vr("ngModel",n.selectedType),D(),z("ngForOf",n.entryTypes),D(5),vr("ngModel",n.privateKey),z("disabled",n.isCreating),D(),z("disabled",n.isCreating),D(2),z("ngIf",n.publicKey),D(),z("ngIf",n.selectedType==="blog_post"),D(4),z("ngIf",n.selectedAuthor),D(),z("ngIf",!n.selectedAuthor),D(4),z("ngIf",n.selectedPreviousVersion),D(),z("ngIf",!n.selectedPreviousVersion),D(),z("disabled",!n.contentHash||!n.privateKey||n.isCreating),D(),je(" ",n.isCreating?"Creating...":"Create Entry"," "),D(),z("ngIf",n.errorMessage),D(),z("ngIf",n.createdEntry),D(),z("ngIf",n.previousEntries.length>0))},dependencies:[Zt,of,Xo,Ur,sf,af,ws,Ja,ec,Qo,vs,ys,ta,wu,Ro],styles:[".disot-entry[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{margin-bottom:25px;padding:20px;background-color:#f9f9f9;border-radius:8px}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.content-info[_ngcontent-%COMP%], .no-content[_ngcontent-%COMP%]{padding:15px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px}.content-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.content-info[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;word-break:break-all}.no-content[_ngcontent-%COMP%]{color:#666;font-style:italic}.type-select[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px;background-color:#fff}.key-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.key-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-family:monospace;font-size:14px;border:1px solid #ddd;border-radius:4px;resize:vertical}.generate-button[_ngcontent-%COMP%]{align-self:flex-start;padding:8px 16px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer}.generate-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.clear-button[_ngcontent-%COMP%], .select-button[_ngcontent-%COMP%]{margin-top:10px;padding:8px 16px;border:none;border-radius:4px;cursor:pointer}.clear-button[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.clear-button[_ngcontent-%COMP%]:hover{background-color:#c82333}.select-button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.select-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.public-key-display[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background-color:#e9ecef;border-radius:4px}.public-key-display[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 5px}.public-key-display[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;word-break:break-all;font-family:monospace;font-size:12px}.blog-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:14px;border:1px solid #ddd;border-radius:4px;resize:vertical}.create-button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:18px;background-color:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer}.create-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.create-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f8d7da;color:#721c24;border-radius:4px}.success-section[_ngcontent-%COMP%]{margin-top:20px;padding:20px;background-color:#d4edda;border-radius:8px}.success-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#155724}.entry-details[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px;margin-top:10px}.entry-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;word-break:break-all}.entry-details[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;font-size:12px}.entries-section[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background-color:#f9f9f9;border-radius:8px}.entries-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.entries-list[_ngcontent-%COMP%]{display:grid;gap:10px}.entry-item[_ngcontent-%COMP%]{background-color:#fff;padding:10px;border:1px solid #e0e0e0;border-radius:4px}.entry-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:14px}.small-code[_ngcontent-%COMP%]{font-size:11px!important;word-break:break-all}.entry-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:15px}.entry-info[_ngcontent-%COMP%]{flex:1}.entry-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:14px}.entry-actions[_ngcontent-%COMP%]{flex-shrink:0}.preview-entry-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:background-color .2s}.preview-entry-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.preview-entry-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.entry-preview-section[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f5f5f5;border-radius:4px}.entry-preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.entry-preview-controls[_ngcontent-%COMP%]   .preview-type-select[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.entry-preview-controls[_ngcontent-%COMP%]   .detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.entry-preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.entry-preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.entry-preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.entry-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.entry-preview.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .entry-preview.preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}"]})};function Tde(r,e){if(r&1){let t=nt();b(0,"div",10)(1,"h3"),_(2,"Entry Details"),y(),b(3,"div",11)(4,"div",12)(5,"span",13),_(6,"Entry ID:"),y(),b(7,"code"),_(8),y()(),b(9,"div",12)(10,"span",13),_(11,"Type:"),y(),b(12,"span"),_(13),y()(),b(14,"div",12)(15,"span",13),_(16,"Timestamp:"),y(),b(17,"span"),_(18),y()(),b(19,"div",12)(20,"span",13),_(21,"Content Hash:"),y(),b(22,"code"),_(23),y()(),b(24,"div",12)(25,"span",13),_(26,"Public Key:"),y(),b(27,"code"),_(28),y()(),b(29,"div",12)(30,"span",13),_(31,"Signature:"),y(),b(32,"code"),_(33),y()()(),b(34,"button",14),_e("click",function(){Re(t);let o=G();return Ne(o.verifySignature())}),_(35),y()()}if(r&2){let t=G();D(8),Se(t.disotEntry.id),D(5),Se(t.formatEntryType(t.disotEntry.type)),D(5),Se(t.formatTimestamp(t.disotEntry.timestamp)),D(5),Se(t.disotEntry.contentHash.value),D(5),Se(t.disotEntry.signature.publicKey),D(5),Se(t.disotEntry.signature.value),D(),z("disabled",t.isVerifying),D(),je(" ",t.isVerifying?"Verifying...":"Verify Signature"," ")}}function Pde(r,e){r&1&&(b(0,"div",15)(1,"p"),_(2,"No entry loaded. Enter an entry ID above or select an entry from the list."),y()())}function Mde(r,e){if(r&1&&(b(0,"div",16),_(1),y()),r&2){let t=G();D(),je(" ",t.errorMessage," ")}}function kde(r,e){r&1&&(b(0,"span"),_(1,"\u2713"),y())}function Rde(r,e){r&1&&(b(0,"span"),_(1,"\u2717"),y())}function Nde(r,e){if(r&1&&(b(0,"div",17)(1,"div",18),ye(2,kde,2,0,"span",19)(3,Rde,2,0,"span",19),y(),b(4,"div",20)(5,"h3"),_(6),y(),b(7,"p"),_(8),y()()()),r&2){let t=G();Rn("valid",t.verificationResult)("invalid",!t.verificationResult),D(2),z("ngIf",t.verificationResult),D(),z("ngIf",!t.verificationResult),D(3),Se(t.verificationResult?"Signature Valid":"Signature Invalid"),D(2),Se(t.verificationResult?"The signature has been successfully verified.":"The signature verification failed. The entry may have been tampered with.")}}var j4=class r{constructor(e){this.disotService=e}disotEntry=null;isVerifying=!1;verificationResult=null;errorMessage="";verifyById(e){return f(this,null,function*(){if(!e.trim()){this.errorMessage="Please enter an entry ID";return}this.isVerifying=!0,this.errorMessage="",this.verificationResult=null;try{this.disotEntry=yield this.disotService.getEntry(e),yield this.verifySignature()}catch(t){this.errorMessage=`Failed to load entry: ${t instanceof Error?t.message:"Unknown error"}`,this.disotEntry=null}finally{this.isVerifying=!1}})}verifySignature(){return f(this,null,function*(){if(!this.disotEntry){this.errorMessage="No entry to verify";return}this.isVerifying=!0,this.errorMessage="",this.verificationResult=null;try{this.verificationResult=yield this.disotService.verifyEntry(this.disotEntry)}catch(e){this.errorMessage=`Verification failed: ${e instanceof Error?e.message:"Unknown error"}`,this.verificationResult=null}finally{this.isVerifying=!1}})}formatEntryType(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}formatTimestamp(e){return new Date(e).toLocaleString()}static \u0275fac=function(t){return new(t||r)(oe(tc))};static \u0275cmp=Qt({type:r,selectors:[["app-signature-verification"]],inputs:{disotEntry:"disotEntry"},decls:15,vars:6,consts:[["entryIdInput",""],[1,"signature-verification"],[1,"lookup-section"],[1,"id-input-group"],["type","text","placeholder","Enter DISOT entry ID...",1,"id-input",3,"disabled"],[1,"lookup-button",3,"click","disabled"],["class","entry-section",4,"ngIf"],["class","no-entry",4,"ngIf"],["class","error-message",4,"ngIf"],["class","verification-result",3,"valid","invalid",4,"ngIf"],[1,"entry-section"],[1,"entry-info"],[1,"info-row"],[1,"label"],[1,"verify-button",3,"click","disabled"],[1,"no-entry"],[1,"error-message"],[1,"verification-result"],[1,"result-icon"],[4,"ngIf"],[1,"result-text"]],template:function(t,n){if(t&1){let o=nt();b(0,"div",1)(1,"h2"),_(2,"Signature Verification"),y(),b(3,"div",2)(4,"h3"),_(5,"Verify by Entry ID"),y(),b(6,"div",3),Bt(7,"input",4,0),b(9,"button",5),_e("click",function(){Re(o);let s=TI(8);return Ne(n.verifyById(s.value))}),_(10," Load & Verify "),y()()(),ye(11,Tde,36,8,"div",6)(12,Pde,3,0,"div",7)(13,Mde,2,1,"div",8)(14,Nde,9,8,"div",9),y()}t&2&&(D(7),z("disabled",n.isVerifying),D(2),z("disabled",n.isVerifying),D(2),z("ngIf",n.disotEntry),D(),z("ngIf",!n.disotEntry&&!n.errorMessage),D(),z("ngIf",n.errorMessage),D(),z("ngIf",n.verificationResult!==null))},dependencies:[Zt,Ur,ws,Ro],styles:[".signature-verification[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.lookup-section[_ngcontent-%COMP%], .entry-section[_ngcontent-%COMP%]{margin-bottom:25px;padding:20px;background-color:#f9f9f9;border-radius:8px}.lookup-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .entry-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.id-input-group[_ngcontent-%COMP%]{display:flex;gap:10px}.id-input[_ngcontent-%COMP%]{flex:1;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.lookup-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#17a2b8;color:#fff;border:none;border-radius:4px;cursor:pointer;white-space:nowrap}.lookup-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#138496}.entry-info[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px;margin-bottom:20px}.info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:10px;align-items:flex-start}.info-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.label[_ngcontent-%COMP%]{font-weight:700;min-width:120px;margin-right:10px}.info-row[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;font-size:12px;word-break:break-all}.verify-button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:18px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.verify-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.verify-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.no-entry[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666;font-style:italic}.error-message[_ngcontent-%COMP%]{padding:15px;background-color:#f8d7da;color:#721c24;border-radius:4px;margin-bottom:20px}.verification-result[_ngcontent-%COMP%]{padding:20px;border-radius:8px;display:flex;align-items:center;gap:20px}.verification-result.valid[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.verification-result.invalid[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.result-icon[_ngcontent-%COMP%]{font-size:48px;font-weight:700}.result-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 10px}.result-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})};var H4=class r{constructor(e,t){this.http=e;if(this.config=t,t.mode==="api")this.baseUrl=t.apiEndpoint?t.apiEndpoint+"/api/v0":"/api/v0";else if(t.mode==="gateway"){if(!t.gateway)throw new Error("Invalid IPFS configuration: gateway URL required for gateway mode");this.baseUrl=t.gateway}else throw new Error("Invalid IPFS configuration: unsupported mode")}config;baseUrl;add(e){if(this.config.mode==="gateway")return Si(()=>new Error("Gateway mode does not support uploads"));let t=new FormData,n=new Blob([e],{type:"application/octet-stream"});return t.append("file",n),this.http.post(`${this.baseUrl}/add`,t,{params:{pin:"true"},headers:{}}).pipe(Bc(this.config.timeout),Je(o=>({cid:o.Hash,size:o.Size||e.length,timestamp:new Date,pinned:!0})),dn(o=>(console.error("IPFS add failed:",o),Si(()=>new Error(`Failed to add to IPFS: ${o.message}`)))))}get(e){let t;return this.config.mode==="api"?this.http.post(`${this.baseUrl}/cat`,null,{params:{arg:e},responseType:"arraybuffer"}).pipe(Bc(this.config.timeout),Je(n=>new Uint8Array(n)),dn(n=>(console.error("IPFS get failed:",n),Si(()=>new Error(`Failed to get from IPFS: ${n.message}`))))):(t=`${this.config.gateway}/ipfs/${e}`,this.http.get(t,{responseType:"arraybuffer"}).pipe(Bc(this.config.timeout),Je(n=>new Uint8Array(n)),dn(n=>(console.error("IPFS gateway get failed:",n),Si(()=>new Error(`Failed to get from IPFS gateway: ${n.message}`))))))}pin(e){return this.config.mode==="gateway"?Si(()=>new Error("Gateway mode does not support pinning")):this.http.post(`${this.baseUrl}/pin/add`,null,{params:{arg:e}}).pipe(Bc(this.config.timeout),Je(()=>!0),dn(t=>(console.error("IPFS pin failed:",t),Ve(!1))))}unpin(e){return this.config.mode==="gateway"?Si(()=>new Error("Gateway mode does not support unpinning")):this.http.post(`${this.baseUrl}/pin/rm`,null,{params:{arg:e}}).pipe(Bc(this.config.timeout),Je(()=>!0),dn(t=>(console.error("IPFS unpin failed:",t),Ve(!1))))}isHealthy(){return this.config.mode==="api"?this.http.post(`${this.baseUrl}/version`,null,{headers:{"Content-Type":"application/json"}}).pipe(Bc(5e3),Je(()=>!0),dn(e=>(console.error("IPFS health check failed:",e),Ve(!1)))):this.http.head(this.config.gateway).pipe(Bc(5e3),Je(()=>!0),dn(()=>Ve(!1)))}getType(){return this.config.mode}static \u0275fac=function(t){return new(t||r)(xe(sm),xe(ra))};static \u0275prov=he({token:r,factory:r.\u0275fac})};var Im=class r{dbName="cas-storage";storeName="content";version=1;db=null;initializationError=null;initializationPromise;constructor(){this.initializationPromise=this.initializeDb().catch(()=>{})}initializeDb(){return f(this,null,function*(){return new Promise((e,t)=>{let n=indexedDB.open(this.dbName,this.version);n.onerror=()=>{let o=new Error("Failed to open IndexedDB");this.initializationError=o,t(o)},n.onsuccess=o=>{this.db=o.target.result,e()},n.onupgradeneeded=o=>{let i=o.target.result;i.objectStoreNames.contains(this.storeName)||i.createObjectStore(this.storeName)}}).catch(e=>{throw this.initializationError=e,e})})}ensureDb(){return f(this,null,function*(){if(this.initializationError)throw new Error("IndexedDB not available");if(!this.db)try{yield this.initializationPromise}catch{throw new Error("IndexedDB not available")}if(!this.db)throw new Error("IndexedDB not available");return this.db})}read(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);a.onsuccess=()=>{let c=a.result;c&&c instanceof Uint8Array?n(c):c?n(new Uint8Array(c)):o(new Error(`Path not found: ${e}`))},a.onerror=()=>{o(new Error(`Failed to read path: ${e}`))}})})}write(e,t){return f(this,null,function*(){let n=yield this.ensureDb();return new Promise((o,i)=>{let c=n.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(t,e);c.onsuccess=()=>{o()},c.onerror=()=>{i(new Error(`Failed to write path: ${e}`))}})})}exists(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).count(e);a.onsuccess=()=>{n(a.result>0)},a.onerror=()=>{o(new Error(`Failed to check existence: ${e}`))}})})}list(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let s=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();s.onsuccess=()=>{let a=s.result;t(a.map(c=>String(c)))},s.onerror=()=>{n(new Error("Failed to list paths"))}})})}delete(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);a.onsuccess=()=>{n()},a.onerror=()=>{o(new Error(`Failed to delete path: ${e}`))}})})}clear(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let s=e.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>{t()},s.onerror=()=>{n(new Error("Failed to clear storage"))}})})}getSize(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let i=e.transaction([this.storeName],"readonly").objectStore(this.storeName),s=0,a=i.openCursor();a.onsuccess=c=>{let l=c.target.result;l?(l.value instanceof Uint8Array&&(s+=l.value.byteLength),l.continue()):t(s)},a.onerror=()=>{n(new Error("Failed to calculate storage size"))}})})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var Am=class r{constructor(e){this.config=e}publicGateways=["https://ipfs.io","https://gateway.ipfs.io","https://cloudflare-ipfs.com","https://gateway.pinata.cloud","https://ipfs.fleek.co","https://ipfs.infura.io"];generateShareLink(e,t={}){let o=`${t.gateway||this.getDefaultGateway()}/ipfs/${e}`;return t.filename&&(o+=`?filename=${encodeURIComponent(t.filename)}`),t.download&&(o+=t.filename?"&":"?",o+="download=true"),o}generateMultipleShareLinks(e,t={}){return this.publicGateways.map(n=>this.generateShareLink(e,I(v({},t),{gateway:n})))}generateLocalShareLink(e,t={}){let n=this.config.gateway||"http://127.0.0.1:8080";return this.generateShareLink(e,I(v({},t),{gateway:n}))}checkGatewayAvailability(e,t){return f(this,null,function*(){let n=this.generateShareLink(e,{gateway:t});try{return(yield fetch(n,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}})}findAvailableGateway(e){return f(this,null,function*(){if(yield this.checkGatewayAvailability(e,this.config.gateway))return this.config.gateway||"http://127.0.0.1:8080";for(let t of this.publicGateways)if(yield this.checkGatewayAvailability(e,t))return t;return null})}getDefaultGateway(){return this.config.mode==="gateway"&&this.config.gateway?this.config.gateway:this.publicGateways[0]}getPublicGateways(){return[...this.publicGateways]}formatBytes(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}generateProtocolLink(e){return`ipfs://${e}`}generateIPNSLink(e){return`ipns://${e}`}static \u0275fac=function(t){return new(t||r)(xe(ra))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var ra="IPFS_CONFIG",xu=class r{constructor(e,t,n,o){this.shareLinkService=o;this.ipfsClient=new H4(t,e),this.localCache=n,this.loadCidMappings()}ipfsClient;localCache;cidToPathMap=new Map;pathToCidMap=new Map;write(e,t){return f(this,null,function*(){try{yield this.localCache.write(e,t);let n=yield Z0(this.ipfsClient.add(t));this.cidToPathMap.set(n.cid,e),this.pathToCidMap.set(e,n.cid),yield this.saveCidMappings(),console.log(`Stored ${e} with CID: ${n.cid}`)}catch(n){throw console.error("Failed to write to IPFS:",n),n}})}read(e){return f(this,null,function*(){try{if(yield this.localCache.exists(e))return yield this.localCache.read(e);let t=this.pathToCidMap.get(e);if(!t)throw new Error(`No CID mapping found for path: ${e}`);let n=yield Z0(this.ipfsClient.get(t));return yield this.localCache.write(e,n),n}catch(t){throw console.error("Failed to read from IPFS:",t),t}})}exists(e){return f(this,null,function*(){return(yield this.localCache.exists(e))?!0:this.pathToCidMap.has(e)})}delete(e){return f(this,null,function*(){yield this.localCache.delete(e);let t=this.pathToCidMap.get(e);t&&(this.pathToCidMap.delete(e),this.cidToPathMap.delete(t),yield this.saveCidMappings())})}list(){return f(this,null,function*(){let e=yield this.localCache.list(),t=Array.from(this.pathToCidMap.keys());return Array.from(new Set([...e,...t]))})}loadCidMappings(){return f(this,null,function*(){try{let e=yield this.localCache.read("_ipfs_mappings"),t=JSON.parse(new TextDecoder().decode(e));this.cidToPathMap=new Map(t.cidToPath),this.pathToCidMap=new Map(t.pathToCid)}catch{console.log("No existing CID mappings found")}})}saveCidMappings(){return f(this,null,function*(){let e={cidToPath:Array.from(this.cidToPathMap.entries()),pathToCid:Array.from(this.pathToCidMap.entries())},t=new TextEncoder().encode(JSON.stringify(e));yield this.localCache.write("_ipfs_mappings",t)})}getCidForPath(e){return this.pathToCidMap.get(e)}isHealthy(){return f(this,null,function*(){try{return yield Z0(this.ipfsClient.isHealthy())}catch{return!1}})}generateShareLink(e,t){let n=this.getCidForPath(e);return n?this.shareLinkService.generateShareLink(n,{filename:t}):null}generateMultipleShareLinks(e,t){let n=this.getCidForPath(e);return n?this.shareLinkService.generateMultipleShareLinks(n,{filename:t}):[]}getShareLinkService(){return this.shareLinkService}static \u0275fac=function(t){return new(t||r)(xe(ra),xe(sm),xe(Im),xe(Am))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var VV=Symbol.for("@libp2p/connection");var rc=Symbol.for("@libp2p/content-routing");var gf=Symbol.for("@libp2p/peer-discovery");var $4=Symbol.for("@libp2p/peer-id");function bs(r){return!!r?.[$4]}var nc=Symbol.for("@libp2p/peer-routing");var Eu="keep-alive";var _u=Symbol.for("@libp2p/transport");var Dm=function(r){return r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL",r}(Dm||{});var Nn=(()=>{class r extends Error{static name="AbortError";constructor(t="The operation was aborted"){super(t),this.name="AbortError"}}return r})(),jV=(()=>{class r extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}}return r})(),HV=(()=>{class r extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}}return r})(),Q=(()=>{class r extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}}return r})(),yf=(()=>{class r extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}}return r})(),J9=(()=>{class r extends Error{static name="InvalidPrivateKeyError";constructor(t="Invalid private key"){super(t),this.name="InvalidPrivateKeyError"}}return r})();var $V=(()=>{class r extends Error{static name="ConnectionClosingError";constructor(t="The connection is closing"){super(t),this.name="ConnectionClosingError"}}return r})(),z4=(()=>{class r extends Error{static name="ConnectionClosedError";constructor(t="The connection is closed"){super(t),this.name="ConnectionClosedError"}}return r})(),q4=(()=>{class r extends Error{static name="ConnectionFailedError";constructor(t="Connection failed"){super(t),this.name="ConnectionFailedError"}}return r})(),Su=(()=>{class r extends Error{static name="MuxerClosedError";constructor(t="The muxer is closed"){super(t),this.name="MuxerClosedError"}}return r})(),zV=(()=>{class r extends Error{static name="StreamResetError";constructor(t="The stream has been reset"){super(t),this.name="StreamResetError"}}return r})(),Cy=(()=>{class r extends Error{static name="StreamStateError";constructor(t="The stream is in an invalid state"){super(t),this.name="StreamStateError"}}return r})(),Ot=(()=>{class r extends Error{static name="NotFoundError";constructor(t="Not found"){super(t),this.name="NotFoundError"}}return r})(),K4=(()=>{class r extends Error{static name="InvalidPeerIdError";constructor(t="Invalid PeerID"){super(t),this.name="InvalidPeerIdError"}}return r})(),Tm=(()=>{class r extends Error{static name="InvalidMultiaddrError";constructor(t="Invalid multiaddr"){super(t),this.name="InvalidMultiaddrError"}}return r})(),qV=(()=>{class r extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}}return r})(),Pm=(()=>{class r extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}}return r})(),vf=(()=>{class r extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}}return r})(),bt=(()=>{class r extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}}return r})(),KV=(()=>{class r extends Error{static name="ProtocolError";constructor(t="Protocol error"){super(t),this.name="ProtocolError"}}return r})(),oc=(()=>{class r extends Error{static name="TimeoutError";constructor(t="Timed out"){super(t),this.name="TimeoutError"}}return r})(),na=(()=>{class r extends Error{static name="NotStartedError";constructor(t="Not started"){super(t),this.name="NotStartedError"}}return r})();var wf=(()=>{class r extends Error{static name="DialError";constructor(t="Dial error"){super(t),this.name="DialError"}}return r})(),Iy=(()=>{class r extends Error{static name="ListenError";constructor(t="Listen error"){super(t),this.name="ListenError"}}return r})(),G4=(()=>{class r extends Error{static name="LimitedConnectionError";constructor(t="Limited connection"){super(t),this.name="LimitedConnectionError"}}return r})(),GV=(()=>{class r extends Error{static name="TooManyInboundProtocolStreamsError";constructor(t="Too many inbound protocol streams"){super(t),this.name="TooManyInboundProtocolStreamsError"}}return r})(),Mm=(()=>{class r extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(t="Too many outbound protocol streams"){super(t),this.name="TooManyOutboundProtocolStreamsError"}}return r})(),il=(()=>{class r extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}}return r})();var st=class extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let o=this.#e.get(e);o==null&&(o=[],this.#e.set(e,o)),o.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let o=this.#e.get(e);o!=null&&(o=o.filter(({callback:i})=>i!==t),this.#e.set(e,o))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:o})=>!o),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}};function W4(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}function On(...r){return f(this,null,function*(){let e=[];for(let t of r)W4(t)&&e.push(t);yield Promise.all(e.map(t=>f(null,null,function*(){t.beforeStart!=null&&(yield t.beforeStart())}))),yield Promise.all(e.map(t=>f(null,null,function*(){yield t.start()}))),yield Promise.all(e.map(t=>f(null,null,function*(){t.afterStart!=null&&(yield t.afterStart())})))})}function ao(...r){return f(this,null,function*(){let e=[];for(let t of r)W4(t)&&e.push(t);yield Promise.all(e.map(t=>f(null,null,function*(){t.beforeStop!=null&&(yield t.beforeStop())}))),yield Promise.all(e.map(t=>f(null,null,function*(){yield t.stop()}))),yield Promise.all(e.map(t=>f(null,null,function*(){t.afterStop!=null&&(yield t.afterStop())})))})}var Pt=Symbol.for("@libp2p/service-capabilities"),Ri=Symbol.for("@libp2p/service-dependencies");var eA={};Mn(eA,{base64:()=>Qr,base64pad:()=>Fde,base64url:()=>sl,base64urlpad:()=>Bde});var Qr=ts({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fde=ts({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sl=ts({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bde=ts({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Ude(r,e){try{if(typeof r=="string"&&r.length>0)return Vde(r);if(typeof r=="number"&&isFinite(r))return e?.long?Hde(r):jde(r);throw new Error("Value is not a string or number.")}catch(t){let n=$de(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function Vde(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");let e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;let t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*315576e5;case"weeks":case"week":case"w":return t*6048e5;case"days":case"day":case"d":return t*864e5;case"hours":case"hour":case"hrs":case"hr":case"h":return t*36e5;case"minutes":case"minute":case"mins":case"min":case"m":return t*6e4;case"seconds":case"second":case"secs":case"sec":case"s":return t*1e3;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}var X4=Ude;function jde(r){let e=Math.abs(r);return e>=864e5?`${Math.round(r/864e5)}d`:e>=36e5?`${Math.round(r/36e5)}h`:e>=6e4?`${Math.round(r/6e4)}m`:e>=1e3?`${Math.round(r/1e3)}s`:`${r}ms`}function Hde(r){let e=Math.abs(r);return e>=864e5?Y4(r,e,864e5,"day"):e>=36e5?Y4(r,e,36e5,"hour"):e>=6e4?Y4(r,e,6e4,"minute"):e>=1e3?Y4(r,e,1e3,"second"):`${r} ms`}function Y4(r,e,t,n){let o=e>=t*1.5;return`${Math.round(r/t)} ${n}${o?"s":""}`}function $de(r){return typeof r=="object"&&r!==null&&"message"in r}function tA(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=o,t.enabled=s,t.humanize=X4,t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,p,m;function w(...E){if(!w.enabled)return;let S=w,A=Number(new Date),M=A-(d||A);S.diff=M,S.prev=d,S.curr=A,d=A,E[0]=t.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let L=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(Y,H)=>{if(Y==="%%")return"%";L++;let U=t.formatters[H];if(typeof U=="function"){let P=E[L];Y=U.call(S,P),E.splice(L,1),L--}return Y}),t.formatArgs.call(S,E),(S.log||t.log).apply(S,E)}return w.namespace=u,w.useColors=t.useColors(),w.color=t.selectColor(u),w.extend=n,w.destroy=t.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,m=t.enabled(u)),m),set:E=>{h=E}}),typeof t.init=="function"&&t.init(w),w}function n(u,d){let h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function o(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d,h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(u))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Q4=Xde(),zde=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function qde(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function Kde(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+X4(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(n=t))}),r.splice(n,0,e)}var Gde=console.debug??console.log??(()=>{});function Wde(r){try{r?Q4?.setItem("debug",r):Q4?.removeItem("debug")}catch{}}function Yde(){let r;try{r=Q4?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=globalThis.process.env.DEBUG),r}function Xde(){try{return localStorage}catch{}}function Qde(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}var WV=tA({formatArgs:Kde,save:Wde,load:Yde,useColors:qde,setupFormatters:Qde,colors:zde,storage:Q4,log:Gde});var Jo=WV;Jo.formatters.b=r=>r==null?"undefined":Sr.baseEncode(r);Jo.formatters.t=r=>r==null?"undefined":rs.baseEncode(r);Jo.formatters.m=r=>r==null?"undefined":Qr.baseEncode(r);Jo.formatters.p=r=>r==null?"undefined":r.toString();Jo.formatters.c=r=>r==null?"undefined":r.toString();Jo.formatters.k=r=>r==null?"undefined":r.toString();Jo.formatters.a=r=>r==null?"undefined":r.toString();Jo.formatters.e=r=>r==null?"undefined":YV(r.stack)??YV(r.message)??r.toString();function Zde(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Cu(){return{forComponent(r){return Mt(r)}}}function Mt(r){let e=Zde(`${r}:trace`);return Jo.enabled(`${r}:trace`)&&Jo.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Jo(`${r}:trace`)),Object.assign(Jo(r),{error:Jo(`${r}:error`),trace:e})}function YV(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}var pe=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}};var nA=_r(QV(),1);var Dy=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},oA=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ZV=r=>globalThis.DOMException===void 0?new oA(r):new DOMException(r),JV=r=>{let e=r.reason===void 0?ZV("This operation was aborted."):r.reason;return e instanceof Error?e:ZV(e)};function al(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a,l=new Promise((u,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:p}=e;p.aborted&&d(JV(p)),a=()=>{d(JV(p))},p.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,d);return}let h=new Dy;s=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(p){d(p)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?u():o instanceof Error?d(o):(h.message=o??`Promise timed out after ${t} milliseconds`,d(h))},t),f(null,null,function*(){try{u(yield r)}catch(p){d(p)}})}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},l}function iA(r,e,t){let n=0,o=r.length;for(;o>0;){let i=Math.trunc(o/2),s=n+i;t(r[s],e)<=0?(n=++s,o-=i+1):o=i}return n}var J4=class{#e=[];enqueue(e,t){t=v({priority:0},t);let n={priority:t.priority,id:t.id,run:e};if(this.size===0||this.#e[this.size-1].priority>=t.priority){this.#e.push(n);return}let o=iA(this.#e,n,(i,s)=>s.priority-i.priority);this.#e.splice(o,0,n)}setPriority(e,t){let n=this.#e.findIndex(i=>i.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[o]=this.#e.splice(n,1);this.enqueue(o.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}};var Iu=class extends nA.default{#e;#t;#r=0;#a;#s;#l=0;#o;#u;#n;#m;#i=0;#d;#c;#g;#w=1n;timeout;constructor(e){if(super(),e=v({carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:J4},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#a=e.intervalCap,this.#s=e.interval,this.#n=new e.queueClass,this.#m=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#g=e.throwOnTimeout===!0,this.#c=e.autoStart===!1}get#b(){return this.#t||this.#r<this.#a}get#x(){return this.#i<this.#d}#E(){this.#i--,this.#f(),this.emit("next")}#_(){this.#v(),this.#y(),this.#u=void 0}get#S(){let e=Date.now();if(this.#o===void 0){let t=this.#l-e;if(t<0)this.#r=this.#e?this.#i:0;else return this.#u===void 0&&(this.#u=setTimeout(()=>{this.#_()},t)),!0}return!1}#f(){if(this.#n.size===0)return this.#o&&clearInterval(this.#o),this.#o=void 0,this.emit("empty"),this.#i===0&&this.emit("idle"),!1;if(!this.#c){let e=!this.#S;if(this.#b&&this.#x){let t=this.#n.dequeue();return t?(this.emit("active"),t(),e&&this.#y(),!0):!1}}return!1}#y(){this.#t||this.#o!==void 0||(this.#o=setInterval(()=>{this.#v()},this.#s),this.#l=Date.now()+this.#s)}#v(){this.#r===0&&this.#i===0&&this.#o&&(clearInterval(this.#o),this.#o=void 0),this.#r=this.#e?this.#i:0,this.#p()}#p(){for(;this.#f(););}get concurrency(){return this.#d}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#d=e,this.#p()}#C(e){return f(this,null,function*(){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})})}setPriority(e,t){this.#n.setPriority(e,t)}add(n){return f(this,arguments,function*(e,t={}){return t.id??=(this.#w++).toString(),t=v({timeout:this.timeout,throwOnTimeout:this.#g},t),new Promise((o,i)=>{this.#n.enqueue(()=>f(this,null,function*(){this.#i++,this.#r++;try{t.signal?.throwIfAborted();let s=e({signal:t.signal});t.timeout&&(s=al(Promise.resolve(s),{milliseconds:t.timeout})),t.signal&&(s=Promise.race([s,this.#C(t.signal)]));let a=yield s;o(a),this.emit("completed",a)}catch(s){if(s instanceof Dy&&!t.throwOnTimeout){o();return}i(s),this.emit("error",s)}finally{this.#E()}}),t),this.emit("add"),this.#f()})})}addAll(e,t){return f(this,null,function*(){return Promise.all(e.map(n=>f(this,null,function*(){return this.add(n,t)})))})}start(){return this.#c?(this.#c=!1,this.#p(),this):this}pause(){this.#c=!0}clear(){this.#n=new this.#m}onEmpty(){return f(this,null,function*(){this.#n.size!==0&&(yield this.#h("empty"))})}onSizeLessThan(e){return f(this,null,function*(){this.#n.size<e||(yield this.#h("next",()=>this.#n.size<e))})}onIdle(){return f(this,null,function*(){this.#i===0&&this.#n.size===0||(yield this.#h("idle"))})}#h(e,t){return f(this,null,function*(){return new Promise(n=>{let o=()=>{t&&!t()||(this.off(e,o),n())};this.on(e,o)})})}get size(){return this.#n.size}sizeBy(e){return this.#n.filter(e).length}get pending(){return this.#i}get isPaused(){return this.#c}};function ex(r){let e=[xs.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}var sA={};Mn(sA,{base10:()=>tfe});var tfe=aN({prefix:"9",name:"base10",alphabet:"0123456789"});var aA={};Mn(aA,{base16:()=>rfe,base16upper:()=>nfe});var rfe=ts({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nfe=ts({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cA={};Mn(cA,{base2:()=>ofe});var ofe=ts({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var lA={};Mn(lA,{base256emoji:()=>lfe});var ej=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ife=ej.reduce((r,e,t)=>(r[t]=e,r),[]),sfe=ej.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function afe(r){return r.reduce((e,t)=>(e+=ife[t],e),"")}function cfe(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let o=sfe[n];if(o==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(o)}return new Uint8Array(e)}var lfe=kw({prefix:"\u{1F680}",name:"base256emoji",encode:afe,decode:cfe});var uA={};Mn(uA,{base8:()=>ufe});var ufe=ts({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var dA={};Mn(dA,{identity:()=>dfe});var dfe=kw({prefix:"\0",name:"identity",encode:r=>sN(r),decode:r=>iN(r)});var km={};Mn(km,{code:()=>Ty,decode:()=>fA,encode:()=>mfe,name:()=>hfe});var ffe=new TextEncoder,pfe=new TextDecoder,hfe="json",Ty=512;function mfe(r){return ffe.encode(JSON.stringify(r))}function fA(r){return JSON.parse(pfe.decode(r))}var Oo={};Mn(Oo,{code:()=>Pr,decode:()=>vfe,encode:()=>yfe,name:()=>gfe});var gfe="raw",Pr=85;function yfe(r){return q0(r)}function vfe(r){return q0(r)}var pA={};Mn(pA,{identity:()=>En});var tj=0,wfe="identity",rj=q0;function bfe(r){return Ei(tj,rj(r))}var En={code:tj,name:wfe,encode:rj,digest:bfe};var mA={};Mn(mA,{sha256:()=>xt,sha512:()=>tx});function bf({name:r,code:e,encode:t}){return new hA(r,e,t)}var hA=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ei(this.code,t):t.then(n=>Ei(this.code,n))}else throw Error("Unknown type, must be binary type")}};function oj(r){return e=>f(null,null,function*(){return new Uint8Array(yield crypto.subtle.digest(r,e))})}var xt=bf({name:"sha2-256",code:18,encode:oj("SHA-256")}),tx=bf({name:"sha2-512",code:19,encode:oj("SHA-512")});var xf=v(v(v(v(v(v(v(v(v(v({},dA),cA),uA),sA),aA),lN),dN),uN),eA),lA),LLe=v(v({},mA),pA);function et(r=0){return new Uint8Array(r)}function br(r=0){return new Uint8Array(r)}function sj(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var ij=sj("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),gA=sj("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=br(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Efe=v({utf8:ij,"utf-8":ij,hex:xf.base16,latin1:gA,ascii:gA,binary:gA},xf),rx=Efe;function ne(r,e="utf8"){let t=rx[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var yA=60;function nx(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:xs[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:xs[e.type],TTL:e.TTL??e.ttl??yA,data:e.data instanceof Uint8Array?ne(e.data):e.data}))}}var _fe=4;function vA(r,e={}){let t=new Iu({concurrency:e.queryConcurrency??_fe});return(i,...s)=>f(null,[i,...s],function*(n,o={}){let a=new URLSearchParams;a.set("name",n),ex(o.types).forEach(l=>{a.append("type",xs[l])}),o.onProgress?.(new pe("dns:query",{detail:n}));let c=yield t.add(()=>f(null,null,function*(){let l=yield fetch(`${r}?${a}`,{headers:{accept:"application/dns-json"},signal:o?.signal});if(l.status!==200)throw new Error(`Unexpected HTTP status: ${l.status} - ${l.statusText}`);let u=nx(yield l.json());return o.onProgress?.(new pe("dns:response",{detail:u})),u}),{signal:o.signal});if(c==null)throw new Error("No DNS response received");return c})}function aj(){return[vA("https://cloudflare-dns.com/dns-query"),vA("https://dns.google/resolve")]}var uj=_r(lj(),1);var wA=class{lru;constructor(e){this.lru=(0,uj.default)(e)}get(e,t){let n=!0,o=[];for(let i of t){let s=this.getAnswers(e,i);if(s.length===0){n=!1;break}o.push(...s)}if(n)return nx({answers:o})}getAnswers(e,t){let n=`${e.toLowerCase()}-${t}`,o=this.lru.get(n);if(o!=null){let i=o.filter(s=>s.expires>Date.now()).map(({expires:s,value:a})=>I(v({},a),{TTL:Math.round((s-Date.now())/1e3),type:xs[a.type]}));return i.length===0&&this.lru.remove(n),i}return[]}add(e,t){let n=`${e.toLowerCase()}-${t.type}`,o=this.lru.get(n)??[];o.push({expires:Date.now()+(t.TTL??yA)*1e3,value:t}),this.lru.set(n,o)}remove(e,t){let n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}};function dj(r){return new wA(r)}var Sfe=1e3,ox=class{resolvers;cache;constructor(e){this.resolvers={},this.cache=dj(e.cacheSize??Sfe),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=aj())}query(n){return f(this,arguments,function*(e,t={}){let o=ex(t.types),i=t.cached!==!1?this.cache.get(e,o):void 0;if(i!=null)return t.onProgress?.(new pe("dns:cache",{detail:i})),i;let s=`${e.split(".").pop()}.`,a=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),c=[];for(let l of a){if(t.signal?.aborted===!0)break;try{let u=yield l(e,I(v({},t),{types:o}));for(let d of u.Answer)this.cache.add(e,d);return u}catch(u){c.push(u),t.onProgress?.(new pe("dns:error",{detail:u}))}}throw c.length===1?c[0]:new AggregateError(c,`DNS lookup of ${e} ${o} failed`)})}};var xs=function(r){return r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA",r}(xs||{});function ix(r={}){return new ox(r)}function Cfe(r){return r[Symbol.asyncIterator]!=null}function Ife(r){if(Cfe(r))return f(null,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield e.next()).done;t=!1){let i=n.value;;}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield n.call(e))}finally{if(o)throw o[0]}}});for(let e of r);}var ei=Ife;function Ye(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var sx=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Rm=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new sx(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new sx(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var bA=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Zr(r={}){return Afe(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Afe(r,e){e=e??{};let t=e.onEnd,n=new Rm,o,i,s,a=Ye(),c=()=>f(null,null,function*(){try{return n.isEmpty()?s?{done:!0}:yield new Promise((E,S)=>{i=A=>{i=null,n.push(A);try{E(r(n))}catch(M){S(M)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ye()})}}),l=E=>i!=null?i(E):(n.push(E),o),u=E=>(n=new Rm,i!=null?i({error:E}):(n.push({error:E}),o)),d=E=>{if(s)return o;if(e?.objectMode!==!0&&E?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:E})},h=E=>s?o:(s=!0,E!=null?u(E):l({done:!0})),p=()=>(n=new Rm,h(),{done:!0}),m=E=>(h(E),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:p,throw:m,push:d,end:h,get readableLength(){return n.size},onEmpty:E=>f(null,null,function*(){let S=E?.signal;if(S?.throwIfAborted(),n.isEmpty())return;let A,M;S!=null&&(A=new Promise((L,F)=>{M=()=>{F(new bA)},S.addEventListener("abort",M)}));try{yield Promise.race([a.promise,A])}finally{M!=null&&S!=null&&S?.removeEventListener("abort",M)}})},t==null)return o;let w=o;return o={[Symbol.asyncIterator](){return this},next(){return w.next()},throw(E){return w.throw(E),t!=null&&(t(E),t=void 0),{done:!0}},return(){return w.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(E){return w.end(E),t!=null&&(t(E),t=void 0),o},get readableLength(){return w.readableLength},onEmpty:E=>w.onEmpty(E)},o}var xA=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}};function Mr(r,e,t,n){return f(this,null,function*(){let o=new xA(n?.errorMessage,n?.errorCode);return t?.aborted===!0?Promise.reject(o):new Promise((i,s)=>{function a(){t?.removeEventListener("abort",u),r.removeEventListener(e,c),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,l)}let c=d=>{try{if(n?.filter?.(d)===!1)return}catch(h){a(),s(h);return}a(),i(d)},l=d=>{a(),s(d.detail)},u=()=>{a(),s(o)};t?.addEventListener("abort",u),r.addEventListener(e,c),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,l)})})}function cl(r,e){let t,n=function(){let o=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(o,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}var ax=class extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}},fj=(()=>{class r extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}}return r})();var cx=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};function ut(r,e,t){return f(this,null,function*(){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new cx(t?.errorMessage,t?.errorCode,t?.errorName));let n,o=new cx(t?.errorMessage,t?.errorCode,t?.errorName);try{return yield Promise.race([r,new Promise((i,s)=>{n=()=>{s(o)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}})}var lx=class{deferred;signal;constructor(e){this.signal=e,this.deferred=Ye(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new Nn)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function Dfe(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var ux=class{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=Dfe(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new Nn),this.cleanup())}join(){return f(this,arguments,function*(e={}){let t=new lx(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise})}run(){return f(this,null,function*(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=yield ut(this.fn(I(v({},this.options??{}),{signal:this.controller.signal})),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}})}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}};var Ln=class extends st{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,e.metricName!=null&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[],this.emitEmpty=cl(this.emitEmpty.bind(this),1),this.emitIdle=cl(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}add(e,t){return f(this,null,function*(){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new fj;let n=new ux(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(t).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:n,result:o}}),o)).catch(o=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:n,error:o}}),o})})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new Nn)}),this.clear()}onEmpty(e){return f(this,null,function*(){this.size!==0&&(yield Mr(this,"empty",e?.signal))})}onSizeLessThan(e,t){return f(this,null,function*(){this.size<e||(yield Mr(this,"next",t?.signal,{filter:()=>this.size<e}))})}onIdle(e){return f(this,null,function*(){this.pending===0&&this.size===0||(yield Mr(this,"idle",e?.signal))})}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}toGenerator(e){return k(this,null,function*(){e?.signal?.throwIfAborted();let t=Zr({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},o=c=>{c.detail!=null&&t.push(c.detail)},i=c=>{n(c.detail)},s=()=>{n()},a=()=>{n(new Nn("Queue aborted"))};this.addEventListener("completed",o),this.addEventListener("error",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",a);try{yield*J(t)}finally{this.removeEventListener("completed",o),this.removeEventListener("error",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",a),n()}})}};var Tfe=["string","number","bigint","symbol"],Pfe=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function pj(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(Tfe.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(Mfe(r))return"Buffer";let t=kfe(r);return t||"Object"}function Mfe(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function kfe(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(Pfe.includes(e))return e}var B=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};B.uint=new B(0,"uint",!0);B.negint=new B(1,"negint",!0);B.bytes=new B(2,"bytes",!0);B.string=new B(3,"string",!0);B.array=new B(4,"array",!1);B.map=new B(5,"map",!1);B.tag=new B(6,"tag",!1);B.float=new B(7,"float",!0);B.false=new B(7,"false",!0);B.true=new B(7,"true",!0);B.null=new B(7,"null",!0);B.undefined=new B(7,"undefined",!0);B.break=new B(7,"break",!0);var se=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Nm=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Rfe=new TextDecoder,Nfe=new TextEncoder;function dx(r){return Nm&&globalThis.Buffer.isBuffer(r)}function Py(r){return r instanceof Uint8Array?dx(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var yj=Nm?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):mj(r,e,t):(r,e,t)=>t-e>64?Rfe.decode(r.subarray(e,t)):mj(r,e,t),fx=Nm?r=>r.length>64?globalThis.Buffer.from(r):hj(r):r=>r.length>64?Nfe.encode(r):hj(r),ic=r=>Uint8Array.from(r),Om=Nm?(r,e,t)=>dx(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),vj=Nm?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Py(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let o of r)n+o.length>t.length&&(o=o.subarray(0,t.length-n)),t.set(o,n),n+=o.length;return t},wj=Nm?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function bj(r,e){if(dx(r)&&dx(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function hj(r){let e=[],t=0;for(let n=0;n<r.length;n++){let o=r.charCodeAt(n);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(o=65536+((o&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128)}return e}function mj(r,e,t){let n=[];for(;e<t;){let o=r[e],i=null,s=o>239?4:o>223?3:o>191?2:1;if(e+s<=t){let a,c,l,u;switch(s){case 1:o<128&&(i=o);break;case 2:a=r[e+1],(a&192)===128&&(u=(o&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(o&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(o&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=s}return EA(n)}var gj=4096;function EA(r){let e=r.length;if(e<=gj)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=gj));return t}var Ofe=256,My=class{constructor(e=Ofe){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let o=t.length-(this.maxCursor-this.cursor)-1;t.set(e,o)}else{if(t){let o=t.length-(this.maxCursor-this.cursor)-1;o<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=wj(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Om(n,0,this.cursor)}else t=vj(this.chunks,this.cursor);return e&&this.reset(),t}};var Oe="CBOR decode error:",ll="CBOR encode error:",ky=[];ky[23]=1;ky[24]=2;ky[25]=3;ky[26]=5;ky[27]=9;function ul(r,e,t){if(r.length-e<t)throw new Error(`${Oe} not enough data for type`)}var _n=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ni(r,e,t){ul(r,e,1);let n=r[e];if(t.strict===!0&&n<_n[0])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function Oi(r,e,t){ul(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<_n[1])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function Li(r,e,t){ul(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<_n[2])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function Fi(r,e,t){ul(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],o=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(t.strict===!0&&i<_n[3])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${Oe} integers outside of the safe integer range are not supported`)}function xj(r,e,t,n){return new se(B.uint,Ni(r,e+1,n),2)}function Ej(r,e,t,n){return new se(B.uint,Oi(r,e+1,n),3)}function _j(r,e,t,n){return new se(B.uint,Li(r,e+1,n),5)}function Sj(r,e,t,n){return new se(B.uint,Fi(r,e+1,n),9)}function Es(r,e){return Fn(r,0,e.value)}function Fn(r,e,t){if(t<_n[0]){let n=Number(t);r.push([e|n])}else if(t<_n[1]){let n=Number(t);r.push([e|24,n])}else if(t<_n[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<_n[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<_n[4]){let o=[e|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,r.push(o)}else throw new Error(`${Oe} encountered BigInt larger than allowable range`)}}Es.encodedSize=function(e){return Fn.encodedSize(e.value)};Fn.encodedSize=function(e){return e<_n[0]?1:e<_n[1]?2:e<_n[2]?3:e<_n[3]?5:9};Es.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Cj(r,e,t,n){return new se(B.negint,-1-Ni(r,e+1,n),2)}function Ij(r,e,t,n){return new se(B.negint,-1-Oi(r,e+1,n),3)}function Aj(r,e,t,n){return new se(B.negint,-1-Li(r,e+1,n),5)}var _A=BigInt(-1),Dj=BigInt(1);function Tj(r,e,t,n){let o=Fi(r,e+1,n);if(typeof o!="bigint"){let i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new se(B.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${Oe} integers outside of the safe integer range are not supported`);return new se(B.negint,_A-BigInt(o),9)}function px(r,e){let t=e.value,n=typeof t=="bigint"?t*_A-Dj:t*-1-1;Fn(r,e.type.majorEncoded,n)}px.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*_A-Dj:t*-1-1;return n<_n[0]?1:n<_n[1]?2:n<_n[2]?3:n<_n[3]?5:9};px.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Ry(r,e,t,n){ul(r,e,t+n);let o=Om(r,e+t,e+t+n);return new se(B.bytes,o,t+n)}function Pj(r,e,t,n){return Ry(r,e,1,t)}function Mj(r,e,t,n){return Ry(r,e,2,Ni(r,e+1,n))}function kj(r,e,t,n){return Ry(r,e,3,Oi(r,e+1,n))}function Rj(r,e,t,n){return Ry(r,e,5,Li(r,e+1,n))}function Nj(r,e,t,n){let o=Fi(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Oe} 64-bit integer bytes lengths not supported`);return Ry(r,e,9,o)}function hx(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===B.string?fx(r.value):r.value),r.encodedBytes}function Lm(r,e){let t=hx(e);Fn(r,e.type.majorEncoded,t.length),r.push(t)}Lm.encodedSize=function(e){let t=hx(e);return Fn.encodedSize(t.length)+t.length};Lm.compareTokens=function(e,t){return Ffe(hx(e),hx(t))};function Ffe(r,e){return r.length<e.length?-1:r.length>e.length?1:bj(r,e)}function Ny(r,e,t,n,o){let i=t+n;ul(r,e,i);let s=new se(B.string,yj(r,e+t,e+i),i);return o.retainStringBytes===!0&&(s.byteValue=Om(r,e+t,e+i)),s}function Oj(r,e,t,n){return Ny(r,e,1,t,n)}function Lj(r,e,t,n){return Ny(r,e,2,Ni(r,e+1,n),n)}function Fj(r,e,t,n){return Ny(r,e,3,Oi(r,e+1,n),n)}function Bj(r,e,t,n){return Ny(r,e,5,Li(r,e+1,n),n)}function Uj(r,e,t,n){let o=Fi(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Oe} 64-bit integer string lengths not supported`);return Ny(r,e,9,o,n)}var Vj=Lm;function Fm(r,e,t,n){return new se(B.array,n,t)}function jj(r,e,t,n){return Fm(r,e,1,t)}function Hj(r,e,t,n){return Fm(r,e,2,Ni(r,e+1,n))}function $j(r,e,t,n){return Fm(r,e,3,Oi(r,e+1,n))}function zj(r,e,t,n){return Fm(r,e,5,Li(r,e+1,n))}function qj(r,e,t,n){let o=Fi(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Oe} 64-bit integer array lengths not supported`);return Fm(r,e,9,o)}function Kj(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return Fm(r,e,1,1/0)}function mx(r,e){Fn(r,B.array.majorEncoded,e.value)}mx.compareTokens=Es.compareTokens;mx.encodedSize=function(e){return Fn.encodedSize(e.value)};function Bm(r,e,t,n){return new se(B.map,n,t)}function Gj(r,e,t,n){return Bm(r,e,1,t)}function Wj(r,e,t,n){return Bm(r,e,2,Ni(r,e+1,n))}function Yj(r,e,t,n){return Bm(r,e,3,Oi(r,e+1,n))}function Xj(r,e,t,n){return Bm(r,e,5,Li(r,e+1,n))}function Qj(r,e,t,n){let o=Fi(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Oe} 64-bit integer map lengths not supported`);return Bm(r,e,9,o)}function Zj(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return Bm(r,e,1,1/0)}function gx(r,e){Fn(r,B.map.majorEncoded,e.value)}gx.compareTokens=Es.compareTokens;gx.encodedSize=function(e){return Fn.encodedSize(e.value)};function Jj(r,e,t,n){return new se(B.tag,t,1)}function eH(r,e,t,n){return new se(B.tag,Ni(r,e+1,n),2)}function tH(r,e,t,n){return new se(B.tag,Oi(r,e+1,n),3)}function rH(r,e,t,n){return new se(B.tag,Li(r,e+1,n),5)}function nH(r,e,t,n){return new se(B.tag,Fi(r,e+1,n),9)}function yx(r,e){Fn(r,B.tag.majorEncoded,e.value)}yx.compareTokens=Es.compareTokens;yx.encodedSize=function(e){return Fn.encodedSize(e.value)};var $fe=20,zfe=21,qfe=22,Kfe=23;function oH(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Oe} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new se(B.null,null,1):new se(B.undefined,void 0,1)}function iH(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return new se(B.break,void 0,1)}function SA(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Oe} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Oe} Infinity values are not supported`)}return new se(B.float,r,e)}function sH(r,e,t,n){return SA(CA(r,e+1),3,n)}function aH(r,e,t,n){return SA(IA(r,e+1),5,n)}function cH(r,e,t,n){return SA(fH(r,e+1),9,n)}function vx(r,e,t){let n=e.value;if(n===!1)r.push([B.float.majorEncoded|$fe]);else if(n===!0)r.push([B.float.majorEncoded|zfe]);else if(n===null)r.push([B.float.majorEncoded|qfe]);else if(n===void 0)r.push([B.float.majorEncoded|Kfe]);else{let o,i=!1;(!t||t.float64!==!0)&&(uH(n),o=CA(oa,1),n===o||Number.isNaN(n)?(oa[0]=249,r.push(oa.slice(0,3)),i=!0):(dH(n),o=IA(oa,1),n===o&&(oa[0]=250,r.push(oa.slice(0,5)),i=!0))),i||(Gfe(n),o=fH(oa,1),oa[0]=251,r.push(oa.slice(0,9)))}}vx.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){uH(n);let o=CA(oa,1);if(n===o||Number.isNaN(n))return 3;if(dH(n),o=IA(oa,1),n===o)return 5}return 9};var lH=new ArrayBuffer(9),_s=new DataView(lH,1),oa=new Uint8Array(lH,0);function uH(r){if(r===1/0)_s.setUint16(0,31744,!1);else if(r===-1/0)_s.setUint16(0,64512,!1);else if(Number.isNaN(r))_s.setUint16(0,32256,!1);else{_s.setFloat32(0,r);let e=_s.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)_s.setUint16(0,31744,!1);else if(t===0)_s.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let o=t-127;o<-24?_s.setUint16(0,0):o<-14?_s.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):_s.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function CA(r,e){if(r.length-e<2)throw new Error(`${Oe} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,o=t&1023,i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,t&32768?-i:i}function dH(r){_s.setFloat32(0,r,!1)}function IA(r,e){if(r.length-e<4)throw new Error(`${Oe} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Gfe(r){_s.setFloat64(0,r,!1)}function fH(r,e){if(r.length-e<8)throw new Error(`${Oe} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}vx.compareTokens=Es.compareTokens;function kt(r,e,t){throw new Error(`${Oe} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function wx(r){return()=>{throw new Error(`${Oe} ${r}`)}}var we=[];for(let r=0;r<=23;r++)we[r]=kt;we[24]=xj;we[25]=Ej;we[26]=_j;we[27]=Sj;we[28]=kt;we[29]=kt;we[30]=kt;we[31]=kt;for(let r=32;r<=55;r++)we[r]=kt;we[56]=Cj;we[57]=Ij;we[58]=Aj;we[59]=Tj;we[60]=kt;we[61]=kt;we[62]=kt;we[63]=kt;for(let r=64;r<=87;r++)we[r]=Pj;we[88]=Mj;we[89]=kj;we[90]=Rj;we[91]=Nj;we[92]=kt;we[93]=kt;we[94]=kt;we[95]=wx("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)we[r]=Oj;we[120]=Lj;we[121]=Fj;we[122]=Bj;we[123]=Uj;we[124]=kt;we[125]=kt;we[126]=kt;we[127]=wx("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)we[r]=jj;we[152]=Hj;we[153]=$j;we[154]=zj;we[155]=qj;we[156]=kt;we[157]=kt;we[158]=kt;we[159]=Kj;for(let r=160;r<=183;r++)we[r]=Gj;we[184]=Wj;we[185]=Yj;we[186]=Xj;we[187]=Qj;we[188]=kt;we[189]=kt;we[190]=kt;we[191]=Zj;for(let r=192;r<=215;r++)we[r]=Jj;we[216]=eH;we[217]=tH;we[218]=rH;we[219]=nH;we[220]=kt;we[221]=kt;we[222]=kt;we[223]=kt;for(let r=224;r<=243;r++)we[r]=wx("simple values are not supported");we[244]=kt;we[245]=kt;we[246]=kt;we[247]=oH;we[248]=wx("simple values are not supported");we[249]=sH;we[250]=aH;we[251]=cH;we[252]=kt;we[253]=kt;we[254]=kt;we[255]=iH;var ia=[];for(let r=0;r<24;r++)ia[r]=new se(B.uint,r,1);for(let r=-1;r>=-24;r--)ia[31-r]=new se(B.negint,r,1);ia[64]=new se(B.bytes,new Uint8Array(0),1);ia[96]=new se(B.string,"",1);ia[128]=new se(B.array,0,1);ia[160]=new se(B.map,0,1);ia[244]=new se(B.false,!1,1);ia[245]=new se(B.true,!0,1);ia[246]=new se(B.null,null,1);function pH(r){switch(r.type){case B.false:return ic([244]);case B.true:return ic([245]);case B.null:return ic([246]);case B.bytes:return r.value.length?void 0:ic([64]);case B.string:return r.value===""?ic([96]):void 0;case B.array:return r.value===0?ic([128]):void 0;case B.map:return r.value===0?ic([160]):void 0;case B.uint:return r.value<24?ic([Number(r.value)]):void 0;case B.negint:if(r.value>=-24)return ic([31-Number(r.value)])}}var Yfe={float64:!1,mapSorter:Zfe,quickEncodeToken:pH};function Xfe(){let r=[];return r[B.uint.major]=Es,r[B.negint.major]=px,r[B.bytes.major]=Lm,r[B.string.major]=Vj,r[B.array.major]=mx,r[B.map.major]=gx,r[B.tag.major]=yx,r[B.float.major]=vx,r}var hH=Xfe(),AA=new My,xx=class r{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${ll} object contains circular references`);return new r(t,e)}},Au={null:new se(B.null,null),undefined:new se(B.undefined,void 0),true:new se(B.true,!0),false:new se(B.false,!1),emptyArray:new se(B.array,0),emptyMap:new se(B.map,0)},Du={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new se(B.float,r):r>=0?new se(B.uint,r):new se(B.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new se(B.uint,r):new se(B.negint,r)},Uint8Array(r,e,t,n){return new se(B.bytes,r)},string(r,e,t,n){return new se(B.string,r)},boolean(r,e,t,n){return r?Au.true:Au.false},null(r,e,t,n){return Au.null},undefined(r,e,t,n){return Au.undefined},ArrayBuffer(r,e,t,n){return new se(B.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new se(B.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[Au.emptyArray,new se(B.break)]:Au.emptyArray;n=xx.createCheck(n,r);let o=[],i=0;for(let s of r)o[i++]=bx(s,t,n);return t.addBreakTokens?[new se(B.array,r.length),o,new se(B.break)]:[new se(B.array,r.length),o]},Object(r,e,t,n){let o=e!=="Object",i=o?r.keys():Object.keys(r),s=o?r.size:i.length;if(!s)return t.addBreakTokens===!0?[Au.emptyMap,new se(B.break)]:Au.emptyMap;n=xx.createCheck(n,r);let a=[],c=0;for(let l of i)a[c++]=[bx(l,t,n),bx(o?r.get(l):r[l],t,n)];return Qfe(a,t),t.addBreakTokens?[new se(B.map,s),a,new se(B.break)]:[new se(B.map,s),a]}};Du.Map=Du.Object;Du.Buffer=Du.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Du[`${r}Array`]=Du.DataView;function bx(r,e={},t){let n=pj(r),o=e&&e.typeEncoders&&e.typeEncoders[n]||Du[n];if(typeof o=="function"){let s=o(r,n,e,t);if(s!=null)return s}let i=Du[n];if(!i)throw new Error(`${ll} unsupported type: ${n}`);return i(r,n,e,t)}function Qfe(r,e){e.mapSorter&&r.sort(e.mapSorter)}function Zfe(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let o=t.type.major,i=hH[o].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function mH(r,e,t,n){if(Array.isArray(e))for(let o of e)mH(r,o,t,n);else t[e.type.major](r,e,n)}function DA(r,e,t){let n=bx(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let o=t.quickEncodeToken(n);if(o)return o;let i=e[n.type.major];if(i.encodedSize){let s=i.encodedSize(n,t),a=new My(s);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Py(a.chunks[0])}}return AA.reset(),mH(AA,n,e,t),AA.toBytes(!0)}function Tu(r,e){return e=Object.assign({},Yfe,e),DA(r,hH,e)}var Jfe={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Ex=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=ia[e];if(t===void 0){let n=we[e];if(!n)throw new Error(`${Oe} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let o=e&31;t=n(this.data,this._pos,o,this.options)}return this._pos+=t.encodedLength,t}},Oy=Symbol.for("DONE"),_x=Symbol.for("BREAK");function epe(r,e,t){let n=[];for(let o=0;o<r.value;o++){let i=Um(e,t);if(i===_x){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed array`)}if(i===Oy)throw new Error(`${Oe} found array but not enough entries (got ${o}, expected ${r.value})`);n[o]=i}return n}function tpe(r,e,t){let n=t.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=Um(e,t);if(a===_x){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed map`)}if(a===Oy)throw new Error(`${Oe} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Oe} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in o))throw new Error(`${Oe} found repeat map key "${a}"`);let c=Um(e,t);if(c===Oy)throw new Error(`${Oe} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function Um(r,e){if(r.done())return Oy;let t=r.next();if(t.type===B.break)return _x;if(t.type.terminal)return t.value;if(t.type===B.array)return epe(t,r,e);if(t.type===B.map)return tpe(t,r,e);if(t.type===B.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=Um(r,e);return e.tags[t.value](n)}throw new Error(`${Oe} tag not supported (${t.value})`)}throw new Error("unsupported")}function TA(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Oe} data to decode must be a Uint8Array`);e=Object.assign({},Jfe,e);let t=e.tokenizer||new Ex(r,e),n=Um(t,e);if(n===Oy)throw new Error(`${Oe} did not find any content to decode`);if(n===_x)throw new Error(`${Oe} got unexpected break`);return[n,r.subarray(t.pos())]}function Bi(r,e){let[t,n]=TA(r,e);if(n.length>0)throw new Error(`${Oe} too many terminals, data makes no sense`);return t}function ee(r,e="utf8"){let t=rx[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}var dl="/",gH=new TextEncoder().encode(dl),Sx=gH[0],Ut=class r{_buf;constructor(e,t){if(typeof e=="string")this._buf=ee(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Sx)throw new Error("Invalid key")}toString(e="utf8"){return ne(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new r(e.join(dl))}static random(){return new r(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new r(e):typeof e.uint8Array=="function"?new r(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=gH),this._buf[0]!==Sx){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Sx,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Sx;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(dl).slice(1)}type(){return rpe(this.baseNamespace())}name(){return npe(this.baseNamespace())}instance(e){return new r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(dl)||(e+=dl),e+=this.type(),new r(e)}parent(){let e=this.list();return e.length===1?new r(dl):new r(e.slice(0,-1).join(dl))}child(e){return this.toString()===dl?e:e.toString()===dl?this:new r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return r.withNamespaces([...this.namespaces(),...ope(e.map(t=>t.namespaces()))])}};function rpe(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function npe(r){let e=r.split(":");return e[e.length-1]}function ope(r){return[].concat(...r)}function Cx({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*ipe(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t],i=le.asCID(n);i!=null?yield[o.join("/"),i]:typeof n=="object"&&(yield*J(MA(n,o)))}else{let t=le.asCID(e);t!=null?yield[r.join("/"),t]:yield*J(MA(e,r))}}function*MA(r,e){if(r==null||r instanceof Uint8Array)return;let t=le.asCID(r);t!=null&&(yield[e.join("/"),t]);for(let[n,o]of Object.entries(r)){let i=[...e,n];yield*J(ipe(i,o))}}function*spe(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t];yield o.join("/"),typeof n=="object"&&le.asCID(n)==null&&(yield*J(kA(n,o)))}else yield*J(kA(e,r))}function*kA(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let o=[...e,t];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&le.asCID(n)==null&&(yield*J(spe(o,n)))}}function ape(r,e){let t=r;for(let[n,o]of e.entries()){if(t=t[o],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let i=le.asCID(t);if(i!=null)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}var RA=class{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:n}){if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Cx(),bytes:Cx(),value:Cx(),asBlock:Cx()})}links(){return MA(this.value,[])}tree(){return kA(this.value,[])}get(e="/"){return ape(this.value,e.split("/").filter(Boolean))}};function yH({bytes:r,cid:e,value:t,codec:n}){let o=t!==void 0?t:n?.decode(r);if(o===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new RA({cid:e,bytes:r,value:o})}function Le(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var bH="/pin/",vH="/pinned-block/",NA=K0,wH=1;function Ix(r){return r.version===0&&(r=r.toV1()),new Ut(`${bH}${r.toString(NA)}`)}var Ax=class{datastore;blockstore;getCodec;constructor(e,t,n){this.datastore=e,this.blockstore=t,this.getCodec=n}add(n){return k(this,arguments,function*(e,t={}){let o=Ix(e);if(yield new C(this.datastore.has(o)))throw new Error("Already pinned");let i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");let s=new Ln({concurrency:wH});try{for(var c=O(this.#e(e,s,I(v({},t),{depth:i}))),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let h=u.value;yield new C(this.#t(h,p=>p.pinnedBy.find(m=>Le(m,e.bytes))!=null?!1:(p.pinCount++,p.pinnedBy.push(e.bytes),!0),t)),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}let a={depth:i,metadata:t.metadata??{}};yield new C(this.datastore.put(o,Tu(a),t))})}#e(e,t,n){return k(this,null,function*(){if(n.depth===-1)return;let o=yield new C(this.getCodec(e.code)),i=yield new C(this.blockstore.get(e,n)),s=yH({bytes:i,cid:e,codec:o});yield e;for(let[,a]of s.links())yield*J(yield new C(t.add(()=>f(this,null,function*(){return this.#e(a,t,I(v({},n),{depth:n.depth-1}))}))))})}#t(e,t,n){return f(this,null,function*(){let o=new Ut(`${vH}${NA.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=Bi(yield this.datastore.get(o,n))}catch(a){if(a.name!=="NotFoundError")throw a}if(t(i)){if(i.pinCount===0&&(yield this.datastore.has(o))){yield this.datastore.delete(o);return}yield this.datastore.put(o,Tu(i),n),n.onProgress?.(new pe("helia:pin:add",e))}})}rm(n){return k(this,arguments,function*(e,t={}){let o=Ix(e),i=yield new C(this.datastore.get(o,t)),s=Bi(i);yield new C(this.datastore.delete(o,t));let a=new Ln({concurrency:wH});try{for(var c=O(this.#e(e,a,I(v({},t),{depth:s.depth}))),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let h=u.value;yield new C(this.#t(h,p=>(p.pinCount--,p.pinnedBy=p.pinnedBy.filter(m=>Le(m,e.bytes)),!0),I(v({},t),{depth:s.depth}))),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}})}ls(){return k(this,arguments,function*(e={}){try{for(var t=O(this.datastore.query({prefix:bH+(e.cid!=null?`${e.cid.toString(K0)}`:"")},e)),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let{key:s,value:a}=o.value;let c=le.parse(s.toString().substring(5),K0),l=Bi(a);yield v({cid:c},l)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})}isPinned(n){return f(this,arguments,function*(e,t={}){let o=new Ut(`${vH}${NA.encode(e.multihash.bytes)}`);return this.datastore.has(o,t)})}get(e,t){return f(this,null,function*(){let n=Ix(e),o=yield this.datastore.get(n,t);return Bi(o)})}setMetadata(e,t,n){return f(this,null,function*(){let o=Ix(e),i=yield this.datastore.get(o,n),s=Bi(i);s.metadata=t??{},yield this.datastore.put(o,Tu(s),n)})}};var xH=(()=>{class r extends Error{static name="InsufficientProvidersError";constructor(t="Insufficient providers found"){super(t),this.name="InsufficientProvidersError"}}return r})(),Ly=(()=>{class r extends Error{static name="NoRoutersAvailableError";constructor(t="No routers available"){super(t),this.name="NoRoutersAvailableError"}}return r})(),EH=(()=>{class r extends Error{static name="UnknownHashAlgorithmError";constructor(t="Unknown hash algorithm"){super(t),this.name="UnknownHashAlgorithmError"}}return r})(),_H=(()=>{class r extends Error{static name="UnknownCodecError";constructor(t="Unknown codec"){super(t),this.name="UnknownCodecError"}}return r})();var Bn=class extends Ln{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}};var OA=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Ye(),this.haveNext=Ye()}[Symbol.asyncIterator](){return this}next(){return f(this,null,function*(){if(this.nextResult==null&&(yield this.haveNext.promise),this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ye(),e})}throw(e){return f(this,null,function*(){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}})}return(){return f(this,null,function*(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e})}push(e,t){return f(this,null,function*(){yield this._push(e,t)})}end(e,t){return f(this,null,function*(){e!=null?yield this.throw(e):yield this._push(void 0,t)})}_push(e,t){return f(this,null,function*(){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)yield this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ye(),yield ut(this.readNext.promise,t?.signal,t)})}};function Dx(){return new OA}function cpe(r){return r[Symbol.asyncIterator]!=null}function lpe(r,e,t){return f(this,null,function*(){try{yield Promise.all(r.map(n=>f(null,null,function*(){try{for(var o=O(n),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;yield e.push(c,{signal:t}),t.throwIfAborted()}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}}))),yield e.end(void 0,{signal:t})}catch(n){yield e.end(n,{signal:t}).catch(()=>{})}})}function upe(r){return k(this,null,function*(){let e=new AbortController,t=Dx();lpe(r,t,e.signal).catch(()=>{});try{yield*J(t)}finally{e.abort()}})}function*dpe(r){for(let e of r)yield*J(e)}function fpe(...r){let e=[];for(let t of r)cpe(t)||e.push(t);return e.length===r.length?dpe(e):upe(r)}var Lo=fpe;var ppe=5,Tx=class{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??ppe,this.findProviders=e.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=e.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=e.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=e.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=e.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}start(){return f(this,null,function*(){yield On(...this.routers)})}stop(){return f(this,null,function*(){yield ao(...this.routers)})}findProviders(n){return k(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Ly("No content routers available");let o=new Bn({concurrency:this.providerLookupConcurrency});o.addEventListener("error",()=>{});try{for(var i=O(Lo(o.toGenerator(),..._f(this.routers,"findProviders").map(u=>u.findProviders(e,t)))),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let l=a.value;if(l!=null){if(l.multiaddrs.length===0){if(o.find(l.id)!=null)continue;o.add(()=>f(this,null,function*(){try{let u=yield this.findPeer(l.id,t);return u.multiaddrs.length===0?null:u}catch(u){return this.log.error("could not load multiaddrs for peer %p",l.id,u),null}}),{peerId:l.id,signal:t.signal}).catch(u=>{this.log.error("could not load multiaddrs for peer %p",l.id,u)})}yield l}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}})}provide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Ly("No content routers available");yield Promise.all(_f(this.routers,"provide").map(o=>f(this,null,function*(){yield o.provide(e,t)})))})}cancelReprovide(n){return f(this,arguments,function*(e,t={}){yield Promise.all(_f(this.routers,"cancelReprovide").map(o=>f(this,null,function*(){yield o.cancelReprovide(e,t)})))})}put(e,t,n){return f(this,null,function*(){yield Promise.all(_f(this.routers,"put").map(o=>f(this,null,function*(){yield o.put(e,t,n)})))})}get(e,t){return f(this,null,function*(){return Promise.any(_f(this.routers,"get").map(n=>f(this,null,function*(){return n.get(e,t)})))})}findPeer(e,t){return f(this,null,function*(){if(this.routers.length===0)throw new Ly("No peer routers available");let n=this,o=Lo(..._f(this.routers,"findPeer").map(l=>function(){return k(this,null,function*(){try{yield yield new C(l.findPeer(e,t))}catch(u){n.log.error(u)}})}()));try{for(var i=O(o),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;if(l!=null)return l}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw new Ot("Could not find peer in routing")})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Ly("No peer routers available");try{for(var o=O(Lo(..._f(this.routers,"getClosestPeers").map(l=>l.getClosestPeers(e,t)))),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;c!=null&&(yield c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}};function _f(r,e){return r.filter(t=>t[e]!=null)}var fl=(()=>{class r extends Error{static name="AbortError";name="AbortError";constructor(t="The operation was aborted",...n){super(t,...n)}}return r})();var SH=(()=>{class r extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}}return r})();var Px=class{deferred;signal;constructor(e){this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new fl)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function hpe(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var Mx=class{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=hpe(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new fl),this.cleanup())}join(){return f(this,arguments,function*(e={}){let t=new Px(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise})}run(){return f(this,null,function*(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=yield ut(this.fn(I(v({},this.options??{}),{signal:this.controller.signal})),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}})}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}};function LA(r,e){let t,n=function(){let o=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(o,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}var Fy=class extends st{concurrency;maxSize;queue;pending;sort;autoStart;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=e.autoStart??!0,this.sort=e.sort,this.queue=[],this.emitEmpty=LA(this.emitEmpty.bind(this),1),this.emitIdle=LA(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}add(e,t){return f(this,null,function*(){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new SH;let n=new Mx(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),n.join(t).then(o=>(this.safeDispatchEvent("success",{detail:{job:n,result:o}}),o)).catch(o=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:n,error:o}}),o})})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new fl)}),this.clear()}onEmpty(e){return f(this,null,function*(){this.size!==0&&(yield Mr(this,"empty",e?.signal))})}onSizeLessThan(e,t){return f(this,null,function*(){this.size<e||(yield Mr(this,"next",t?.signal,{filter:()=>this.size<e}))})}onIdle(e){return f(this,null,function*(){this.pending===0&&this.size===0||(yield Mr(this,"idle",e?.signal))})}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}toGenerator(e){return k(this,null,function*(){e?.signal?.throwIfAborted();let t=Zr({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},o=c=>{c.detail!=null&&t.push(c.detail.result)},i=c=>{n(c.detail.error)},s=()=>{n()},a=()=>{n(new fl("Queue aborted"))};this.addEventListener("success",o),this.addEventListener("failure",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",a);try{yield*J(t)}finally{this.removeEventListener("success",o),this.removeEventListener("failure",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",a),n()}})}};var kx="lock:worker:request-read",Rx="lock:worker:abort-read-request",Nx="lock:worker:release-read",Ox="lock:master:grant-read",Lx="lock:master:error-read",Fx="lock:worker:request-write",Bx="lock:worker:abort-write-request",Ux="lock:worker:release-write",Vx="lock:master:grant-write",jx="lock:master:error-write",Hx="lock:worker:finalize",$x="mortice",CH={singleProcess:!1};var FA=(r,e,t,n,o,i,s,a,c)=>l=>{if(l.data==null)return;let u={type:l.data.type,name:l.data.name,identifier:l.data.identifier};u.type===o&&r.safeDispatchEvent(t,{detail:{name:u.name,identifier:u.identifier,handler:()=>f(null,null,function*(){e.postMessage({type:c,name:u.name,identifier:u.identifier}),yield new Promise(d=>{let h=p=>{if(p?.data==null)return;let m={type:p.data.type,name:p.data.name,identifier:p.data.identifier};m.type===a&&m.identifier===u.identifier&&(e.removeEventListener("message",h),d())};e.addEventListener("message",h)})}),onError:d=>{e.postMessage({type:s,name:u.name,identifier:u.identifier,error:{message:d.message,name:d.name,stack:d.stack}})}}}),u.type===i&&r.safeDispatchEvent(n,{detail:{name:u.name,identifier:u.identifier}}),u.type===Hx&&r.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})};var IH=(r=10)=>Math.random().toString().substring(2,r+2);var zx=class{name;channel;constructor(e){this.name=e,this.channel=new BroadcastChannel($x)}readLock(e){return this.sendRequest(kx,Rx,Ox,Lx,Nx,e)}writeLock(e){return this.sendRequest(Fx,Bx,Vx,jx,Ux,e)}finalize(){this.channel.postMessage({type:Hx,name:this.name}),this.channel.close()}sendRequest(e,t,n,o,i,s){return f(this,null,function*(){s?.signal?.throwIfAborted();let a=IH();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((c,l)=>{let u=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};s?.signal?.addEventListener("abort",u,{once:!0});let d=h=>{if(h.data?.identifier===a&&(h.data?.type===n&&(this.channel.removeEventListener("message",d),s?.signal?.removeEventListener("abort",u),c(()=>{this.channel.postMessage({type:i,identifier:a,name:this.name})})),h.data.type===o)){this.channel.removeEventListener("message",d),s?.signal?.removeEventListener("abort",u);let p=new Error;h.data.error!=null&&(p.message=h.data.error.message,p.name=h.data.error.name,p.stack=h.data.error.stack),l(p)}};this.channel.addEventListener("message",d)})})}};var AH=r=>{if(r=Object.assign({},CH,r),!!globalThis.document||r.singleProcess){let t=new BroadcastChannel($x),n=new st;return t.addEventListener("message",FA(n,t,"requestReadLock","abortReadLockRequest",kx,Rx,Lx,Nx,Ox)),t.addEventListener("message",FA(n,t,"requestWriteLock","abortWriteLockRequest",Fx,Bx,jx,Ux,Vx)),n}return new zx(r.name)};var Sf=new Map,By;function DH(r){return typeof r?.readLock=="function"&&typeof r?.writeLock=="function"}function mpe(r){if(By==null&&(By=AH(r),!DH(By))){let e=By;e.addEventListener("requestReadLock",t=>{let n=t.detail.name,o=t.detail.identifier,i=Sf.get(n);if(i==null)return;let s=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==o||s.abort()};e.addEventListener("abortReadLockRequest",a),i.readLock({signal:s.signal}).then(c=>f(null,null,function*(){yield t.detail.handler().finally(()=>{c()})})).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{let n=t.detail.name,o=t.detail.identifier,i=Sf.get(n);if(i==null)return;let s=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==o||s.abort()};e.addEventListener("abortWriteLockRequest",a),i.writeLock({signal:s.signal}).then(c=>f(null,null,function*(){yield t.detail.handler().finally(()=>{c()})})).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{let n=t.detail.name,o=Sf.get(n);o?.finalize()})}return By}function BA(r,e){return f(this,null,function*(){let t,n,o=new Promise((s,a)=>{t=s,n=a}),i=()=>{n(new fl)};return e?.signal?.addEventListener("abort",i,{once:!0}),r.add(()=>f(null,null,function*(){yield new Promise(s=>{t(()=>{e?.signal?.removeEventListener("abort",i),s()})})}),{signal:e?.signal}).catch(s=>{n(s)}),o})}var TH=(r,e)=>{let t=Sf.get(r);if(t!=null)return t;let n=mpe(e);if(DH(n))return t=n,Sf.set(r,t),t;let o=new Fy({concurrency:1}),i;return t={readLock(a){return f(this,null,function*(){if(i!=null)return BA(i,a);i=new Fy({concurrency:e.concurrency,autoStart:!1});let c=i,l=BA(i,a);return o.add(()=>f(null,null,function*(){c.start(),yield c.onIdle().then(()=>{i===c&&(i=null)})})),l})},writeLock(a){return f(this,null,function*(){return i=null,BA(o,a)})},finalize:()=>{Sf.delete(r)},queue:o},Sf.set(r,t),e.autoFinalize===!0&&o.addEventListener("idle",()=>{t.finalize()},{once:!0}),t};var gpe={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function Uy(r){let e=Object.assign({},gpe,r);return TH(e.name,e)}var qx=class{lock;child;pins;started;constructor(e,t,n={}){this.child=e,this.pins=t,this.lock=Uy({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield On(this.child),this.started=!0})}stop(){return f(this,null,function*(){yield ao(this.child),this.started=!1})}unwrap(){return this.child}put(o,i){return f(this,arguments,function*(e,t,n={}){n?.signal?.throwIfAborted();let s=yield this.lock.readLock();try{return yield this.child.put(e,t,n)}finally{s()}})}putMany(n){return k(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new C(this.lock.readLock());try{yield*J(this.child.putMany(e,t))}finally{o()}})}get(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.readLock();try{return yield this.child.get(e,t)}finally{o()}})}getMany(n){return k(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new C(this.lock.readLock());try{yield*J(this.child.getMany(e,t))}finally{o()}})}delete(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.writeLock();try{if(yield this.pins.isPinned(e))throw new Error("CID was pinned");yield this.child.delete(e,t)}finally{o()}})}deleteMany(n){return k(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new C(this.lock.writeLock());try{let i=this;yield*J(this.child.deleteMany(function(){return k(this,null,function*(){try{for(var s=O(e),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;if(yield new C(i.pins.isPinned(u)))throw new Error("CID was pinned");yield u}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}})}(),t))}finally{o()}})}has(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.readLock();try{return yield this.child.has(e,t)}finally{o()}})}getAll(){return k(this,arguments,function*(e={}){e?.signal?.throwIfAborted();let t=yield new C(this.lock.readLock());try{yield*J(this.child.getAll(e))}finally{t()}})}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}};var UA=new Ut("/version"),PH=1;function MH(r){return f(this,null,function*(){if(!(yield r.has(UA))){yield r.put(UA,ee(`${PH}`));return}let e=yield r.get(UA),t=ne(e);if(parseInt(t,10)!==PH)throw new Error("Unknown datastore version, a datastore migration may be required")})}var jy={};Mn(jy,{code:()=>Vy,decode:()=>jA,decodeOptions:()=>Epe,encode:()=>Spe,encodeOptions:()=>bpe,name:()=>_pe,toByteView:()=>RH});var kH=42;function RH(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function ype(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=le.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new se(B.tag,kH),new se(B.bytes,t)]}function vpe(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function wpe(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var VA={float64:!0,typeEncoders:{Object:ype,undefined:vpe,number:wpe}},bpe=I(v({},VA),{typeEncoders:v({},VA.typeEncoders)});function xpe(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return le.decode(r.subarray(1))}var Kx={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Kx.tags[kH]=xpe;var Epe=I(v({},Kx),{tags:Kx.tags.slice()}),_pe="dag-cbor",Vy=113,Spe=r=>Tu(r,VA),jA=r=>Bi(RH(r),Kx);var $y={};Mn($y,{code:()=>Hy,decode:()=>Wx,encode:()=>NH,format:()=>Ope,name:()=>Npe,parse:()=>Fpe,stringify:()=>Ope});var HA=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===B.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===B.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[B.uint.major](e,t){this.prefix(e);let n=String(t.value),o=[];for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);e.push(o)}[B.negint.major](e,t){this[B.uint.major](e,t)}[B.bytes.major](e,t){throw new Error(`${ll} unsupported type: Uint8Array`)}[B.string.major](e,t){this.prefix(e);let n=fx(JSON.stringify(t.value));e.push(n.length>32?Py(n):n)}[B.array.major](e,t){this.prefix(e),this.inRecursive.push({type:B.array,elements:0}),e.push([91])}[B.map.major](e,t){this.prefix(e),this.inRecursive.push({type:B.map,elements:0}),e.push([123])}[B.tag.major](e,t){}[B.float.major](e,t){if(t.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===B.array)e.push([93]);else if(s.type===B.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${ll} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),o=[],i=!1;for(let s=0;s<n.length;s++)o[s]=n.charCodeAt(s),!i&&(o[s]===46||o[s]===101||o[s]===69)&&(i=!0);i||(o.push(46),o.push(48)),e.push(o)}};function Cpe(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${ll} complex map keys are not supported`);let t=r[0],n=e[0];if(t.type!==B.string||n.type!==B.string)throw new Error(`${ll} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${ll} unexpected duplicate map keys, this is not supported`)}var Ipe={addBreakTokens:!0,mapSorter:Cpe};function $A(r,e){return e=Object.assign({},Ipe,e),DA(r,new HA,e)}var Vm=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Oe} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Oe} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,n=!1,o=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new se(B.uint,0,this._pos-e);if(o([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Oe} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Oe} unexpected token at position ${this._pos}`);n=!0,this._pos++,o([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,o([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return n?new se(B.float,s,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new se(s>=0?B.uint:B.negint,s,this._pos-e):new se(s>=0?B.uint:B.negint,BigInt(i),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Oe} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let i=this._pos,s=0;i<this.data.length&&s<65536;i++,s++){let a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new se(B.string,c,s)}}let e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Oe} unexpected end of unicode escape sequence at position ${this._pos}`);let i=0;for(let s=0;s<4;s++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Oe} unexpected unicode escape character at position ${this._pos}`);i=i*16+a,this._pos++}return i},o=()=>{let i=this.ch(),s=null,a=i>239?4:i>223?3:i>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Oe} unexpected unicode sequence at position ${this._pos}`);let c,l,u,d;switch(a){case 1:i<128&&(s=i);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(d=(i&31)<<6|c&63,d>127&&(s=d));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(d=(i&15)<<12|(c&63)<<6|l&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],u=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(d=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,d>65535&&d<1114112&&(s=d))}s===null?(s=65533,a=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|s&1023),t.push(s),this._pos+=a};for(;!this.done();){let i=this.ch(),s;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${Oe} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Oe} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new se(B.string,EA(t),this._pos-e);default:if(i<32)throw new Error(`${Oe} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):o()}}throw new Error(`${Oe} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new se(B.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new se(B.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new se(B.null,null,4);case 102:return this.expect([102,97,108,115,101]),new se(B.false,!1,5);case 116:return this.expect([116,114,117,101]),new se(B.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Oe} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new se(B.break,void 0,1);if(this.ch()!==44)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new se(B.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new se(B.break,void 0,1);if(this.ch()!==44)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new se(B.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Oe} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function zA(r,e){return e=Object.assign({tokenizer:new Vm(r,e)},e),Bi(r,e)}function Dpe(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Tpe(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=le.asCID(r);if(!e)return null;let t=e.toString();return[new se(B.map,1/0,1),new se(B.string,"/",1),new se(B.string,t,t.length),new se(B.break,void 0,1)]}function Gx(r){let e=Qr.encode(r).slice(1);return[new se(B.map,1/0,1),new se(B.string,"/",1),new se(B.map,1/0,1),new se(B.string,"bytes",5),new se(B.string,e,e.length),new se(B.break,void 0,1),new se(B.break,void 0,1)]}function sa(r){return Gx(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Ppe(r){return Gx(new Uint8Array(r))}function Mpe(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function kpe(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Rpe={typeEncoders:{Object:Tpe,Buffer:Gx,Uint8Array:Gx,Int8Array:sa,Uint16Array:sa,Int16Array:sa,Uint32Array:sa,Int32Array:sa,Float32Array:sa,Float64Array:sa,Uint8ClampedArray:sa,BigInt64Array:sa,BigUint64Array:sa,DataView:sa,ArrayBuffer:Ppe,undefined:Mpe,number:kpe}},qA=class extends Vm{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===B.map){let t=this._next();if(t.type===B.string&&t.value==="/"){let n=this._next();if(n.type===B.string){if(this._next().type!==B.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new se(B.tag,42,0)}if(n.type===B.map){let o=this._next();if(o.type===B.string&&o.value==="bytes"){let i=this._next();if(i.type===B.string){for(let a=0;a<2;a++)if(this._next().type!==B.break)throw new Error("Invalid encoded Bytes form");let s=Qr.decode(`m${i.value}`);return new se(B.bytes,s,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(o)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},KA={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};KA.tags[42]=le.parse;var Npe="dag-json",Hy=297,NH=r=>$A(r,Rpe),Wx=r=>{let e=Dpe(r),t=Object.assign(KA,{tokenizer:new qA(e,KA)});return zA(e,t)},Ope=r=>Lpe.decode(NH(r));var Lpe=new TextDecoder,Fpe=r=>Wx(Bpe.encode(r)),Bpe=new TextEncoder;var jr={};Mn(jr,{code:()=>fn,createLink:()=>zH,createNode:()=>$H,decode:()=>Vr,encode:()=>At,name:()=>Ype,prepare:()=>kr,validate:()=>YA});var Upe=new TextDecoder;function GA(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let o=r[e++];if(t+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[t,e]}function Yx(r,e){let t;[t,e]=GA(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function OH(r,e){let t;return[t,e]=GA(r,e),[t&7,t>>3,e]}function Vpe(r){let e={},t=r.length,n=0;for(;n<t;){let o,i;if([o,i,n]=OH(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Yx(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=Yx(r,n),e.Name=Upe.decode(s)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=GA(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function LH(r){let e=r.length,t=0,n,o=!1,i;for(;t<e;){let a,c;if([a,c,t]=OH(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=Yx(r,t),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=Yx(r,t),n.push(Vpe(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return i&&(s.Data=i),s.Links=n||[],s}var BH=new TextEncoder,FH=2**32,jpe=2**31;function Hpe(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=zy(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=BH.encode(r.Name);t-=n.length,e.set(n,t),t=zy(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=zy(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function UH(r){let e=zpe(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=zy(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let o=r.Links.length-1;o>=0;o--){let i=Hpe(r.Links[o],t.subarray(0,n));n-=i,n=zy(t,n,i)-1,t[n]=18}return t}function $pe(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+jm(t)}if(typeof r.Name=="string"){let t=BH.encode(r.Name).length;e+=1+t+jm(t)}return typeof r.Tsize=="number"&&(e+=1+jm(r.Tsize)),e}function zpe(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+jm(t)}if(r.Links)for(let t of r.Links){let n=$pe(t);e+=1+n+jm(n)}return e}function zy(r,e,t){e-=jm(t);let n=e;for(;t>=jpe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function jm(r){return r%2===0&&r++,Math.floor((qpe(r)+6)/7)}function qpe(r){let e=0;return r>=FH&&(r=Math.floor(r/FH),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Kpe[r]}var Kpe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var Gpe=["Data","Links"],Wpe=["Hash","Name","Tsize"],WA=new TextEncoder;function jH(r,e){if(r===e)return 0;let t=r.Name?WA.encode(r.Name):[],n=e.Name?WA.encode(e.Name):[],o=t.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(t[s]!==n[s]){o=t[s],i=n[s];break}return o<i?-1:i<o?1:0}function VH(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function HH(r){if(typeof r.asCID=="object"){let t=le.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Hash){let t=le.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=le.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=le.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function kr(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=WA.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(HH),e.Links.sort(jH);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function YA(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!VH(r,Gpe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!VH(t,Wpe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&jH(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function $H(r,e=[]){return kr({Data:r,Links:e})}function zH(r,e,t){return HH({Hash:t,Name:r,Tsize:e})}function qH(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}var Ype="dag-pb",fn=112;function At(r){YA(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),UH(e)}function Vr(r){let e=qH(r),t=LH(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(o=>{let i={};try{i.Hash=le.decode(o.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return o.Name!==void 0&&(i.Name=o.Name),o.Tsize!==void 0&&(i.Tsize=o.Tsize),i})),n}function Hm(r){return r?.then!=null}function KH(r=[],e){let t={[fn]:jr,[Pr]:Oo,[Vy]:jy,[Hy]:$y,[Ty]:km};return r.forEach(n=>{t[n.code]=n}),n=>f(null,null,function*(){let o=t[n];if(o==null&&e!=null){let i=e(n);Hm(i)?o=yield i:o=i,t[o.code]=o}if(o!=null)return o;throw new _H(`Could not load codec for ${n}`)})}function GH(r=[],e){let t={[xt.code]:xt,[tx.code]:tx,[En.code]:En};return r.forEach(n=>{t[n.code]=n}),n=>f(null,null,function*(){let o=t[n];if(o==null&&e!=null){let i=e(n);Hm(i)?o=yield i:o=i,t[o.code]=o}if(o!=null)return o;throw new EH(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)})}function tt(r){let e=new globalThis.AbortController;function t(){e.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(let i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}let o=e.signal;return o.clear=n,o}var qy=(()=>{class r extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=r.name;code=r.code;constructor(t="Open failed"){super(t)}}return r})();var Pu=(()=>{class r extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=r.name;code=r.code;constructor(t="Put failed"){super(t)}}return r})(),XA=(()=>{class r extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=r.name;code=r.code;constructor(t="Get failed"){super(t)}}return r})(),QA=(()=>{class r extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=r.name;code=r.code;constructor(t="Delete failed"){super(t)}}return r})();var ti=(()=>{class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(t="Not Found"){super(t)}}return r})();var aa=class{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}putMany(e,t){return k(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let{cid:a,block:c}=i.value;yield new C(this.put(a,c,t)),yield a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}get(e,t){return Promise.reject(new Error(".get is not implemented"))}getMany(e,t){return k(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;yield{cid:a,block:yield new C(this.get(a,t))}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}deleteMany(e,t){return k(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;yield new C(this.delete(a,t)),yield a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}getAll(e){return k(this,null,function*(){throw new Error(".getAll is not implemented")})}};var Xx=0,Qx=class extends aa{child;constructor(e){super(),this.child=e}put(e,t,n){return e.multihash.code===Xx||this.child==null?(n?.signal?.throwIfAborted(),e):this.child.put(e,t,n)}get(e,t){if(e.multihash.code===Xx)return t?.signal?.throwIfAborted(),e.multihash.digest;if(this.child==null)throw t?.signal?.throwIfAborted(),new ti;return this.child.get(e,t)}has(e,t){return e.multihash.code===Xx?(t?.signal?.throwIfAborted(),!0):this.child==null?(t?.signal?.throwIfAborted(),!1):this.child.has(e,t)}delete(e,t){if(e.code===Xx){t?.signal?.throwIfAborted();return}if(this.child!=null)return this.child.delete(e,t)}getAll(e){return this.child!=null?this.child.getAll(e):(e?.signal?.throwIfAborted(),[])}};function Xpe(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:o=>{n.push(o)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}var $m=Xpe;function Qpe(r){return r[Symbol.asyncIterator]!=null}function Zpe(r,e){let t=0;if(Qpe(r))return function(){return k(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let h=u.value;(yield new C(e(h,t++)))&&(yield h)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=$m(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=e(o,t++);if(typeof s.then=="function")return function(){return k(this,null,function*(){(yield new C(s))&&(yield o);for(let c of n)(yield new C(e(c,t++)))&&(yield c)})}();let a=e;return function*(){s===!0&&(yield o);for(let c of n)a(c,t++)&&(yield c)}()}var lo=Zpe;function Jpe(r){return r[Symbol.asyncIterator]!=null}function WH(r){return r?.then!=null}function ehe(r,e){let t=0;if(Jpe(r))return function(){return k(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let h=u.value;let p=e(h,t++);WH(p)&&(yield new C(p)),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=$m(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();if(typeof e(o,t++)?.then=="function")return function(){return k(this,null,function*(){yield o;for(let c of n){let l=e(c,t++);WH(l)&&(yield new C(l)),yield c}})}();let a=e;return function*(){yield o;for(let c of n)a(c,t++),yield c}()}var Cf=ehe;var Zx=class{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new Qx(e.blockstore),this.getHasher=e.getHasher}put(o,i){return f(this,arguments,function*(e,t,n={}){return(yield this.child.has(e,n))?(n.onProgress?.(new pe("blocks:put:duplicate",e)),e):(n.onProgress?.(new pe("blocks:put:providers:notify",e)),yield Promise.all(this.components.blockBrokers.map(s=>f(this,null,function*(){return s.announce?.(e,t,n)}))),n.onProgress?.(new pe("blocks:put:blockstore:put",e)),this.child.put(e,t,n))})}putMany(n){return k(this,arguments,function*(e,t={}){let o=lo(e,a=>f(this,[a],function*({cid:s}){let c=yield this.child.has(s,t);return c&&t.onProgress?.(new pe("blocks:put-many:duplicate",s)),!c})),i=Cf(o,c=>f(this,[c],function*({cid:s,block:a}){t.onProgress?.(new pe("blocks:put-many:providers:notify",s)),yield Promise.all(this.components.blockBrokers.map(l=>f(this,null,function*(){return l.announce?.(s,a,t)})))}));t.onProgress?.(new pe("blocks:put-many:blockstore:put-many")),yield*J(this.child.putMany(i,t))})}get(n){return f(this,arguments,function*(e,t={}){if(t.offline!==!0&&!(yield this.child.has(e,t))){let o=yield this.getHasher(e.multihash.code);t.onProgress?.(new pe("blocks:get:providers:get",e));let i=yield YH(e,this.components.blockBrokers,o,I(v({},t),{log:this.log}));return t.onProgress?.(new pe("blocks:get:blockstore:put",e)),yield this.child.put(e,i,t),t.onProgress?.(new pe("blocks:get:providers:notify",e)),yield Promise.all(this.components.blockBrokers.map(s=>f(this,null,function*(){return s.announce?.(e,i,t)}))),i}return t.onProgress?.(new pe("blocks:get:blockstore:get",e)),this.child.get(e,t)})}getMany(n){return k(this,arguments,function*(e,t={}){t.onProgress?.(new pe("blocks:get-many:blockstore:get-many")),yield*J(this.child.getMany(Cf(e,o=>f(this,null,function*(){if(t.offline!==!0&&!(yield this.child.has(o,t))){let i=yield this.getHasher(o.multihash.code);t.onProgress?.(new pe("blocks:get-many:providers:get",o));let s=yield YH(o,this.components.blockBrokers,i,I(v({},t),{log:this.log}));t.onProgress?.(new pe("blocks:get-many:blockstore:put",o)),yield this.child.put(o,s,t),t.onProgress?.(new pe("blocks:get-many:providers:notify",o)),yield Promise.all(this.components.blockBrokers.map(a=>f(this,null,function*(){return a.announce?.(o,s,t)})))}}))))})}delete(n){return f(this,arguments,function*(e,t={}){t.onProgress?.(new pe("blocks:delete:blockstore:delete",e)),yield this.child.delete(e,t)})}deleteMany(n){return k(this,arguments,function*(e,t={}){t.onProgress?.(new pe("blocks:delete-many:blockstore:delete-many")),yield*J(this.child.deleteMany(function(){return k(this,null,function*(){try{for(var o=O(e),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}(),t))})}has(n){return f(this,arguments,function*(e,t={}){return this.child.has(e,t)})}getAll(){return k(this,arguments,function*(e={}){e.onProgress?.(new pe("blocks:get-all:blockstore:get-many")),yield*J(this.child.getAll(e))})}},Jx=class extends Zx{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield On(this.child,...this.components.blockBrokers),this.started=!0})}stop(){return f(this,null,function*(){yield ao(this.child,...this.components.blockBrokers),this.started=!1})}unwrap(){return this.child}createSession(e,t){let n=this.components.blockBrokers.map(o=>o.createSession==null?o:o.createSession(t));return new ZA({blockstore:this.child,blockBrokers:n,getHasher:this.getHasher,logger:this.logger},{root:e})}},ZA=class r extends Zx{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}put(o,i){return f(this,arguments,function*(e,t,n={}){let s=tt([this.closeController.signal,n.signal]);try{return yield es(r.prototype,this,"put").call(this,e,t,I(v({},n),{signal:s}))}finally{s.clear()}})}putMany(n){return k(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{yield*J(es(r.prototype,this,"putMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}get(n){return f(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{return yield es(r.prototype,this,"get").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}getMany(n){return k(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{yield*J(es(r.prototype,this,"getMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}delete(n){return f(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{yield es(r.prototype,this,"delete").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}deleteMany(n){return k(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{yield*J(es(r.prototype,this,"deleteMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}has(n){return f(this,arguments,function*(e,t={}){let o=tt([this.closeController.signal,t.signal]);try{return yield es(r.prototype,this,"has").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}getAll(){return k(this,arguments,function*(e={}){let t=tt([this.closeController.signal,e.signal]);try{yield*J(es(r.prototype,this,"getAll").call(this,I(v({},e),{signal:t})))}finally{t.clear()}})}};function the(r){return typeof r.retrieve=="function"}var rhe=(r,e)=>{if(e==null)throw new Q(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return t=>f(null,null,function*(){let n,o=e.digest(t);if(Hm(o)?n=yield o:n=o,!Le(n.digest,r.multihash.digest))throw new Pm("Hash of downloaded block did not match multihash from passed CID")})};function YH(r,e,t,n){return f(this,null,function*(){let o=rhe(r,t),i=new AbortController,s=tt([i.signal,n.signal]);i.signal;let a=[];for(let c of e)the(c)&&a.push(c);try{return yield Promise.any(a.map(c=>f(null,null,function*(){try{let l=!1,u=yield c.retrieve(r,I(v({},n),{signal:s,validateFn:d=>f(null,null,function*(){yield o(d),l=!0})}));return l||(yield o(u)),u}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}})))}finally{i.abort(),s.clear()}})}var Ky=class extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}},Gy=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},eE=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};var XH={get(r=globalThis){let e=r.crypto;if(e?.subtle==null)throw new eE("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};var Jr=XH;function Gt(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=br(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var ZH=Symbol.for("@achingbrain/uint8arraylist");function QH(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let o=t+n.byteLength;if(e<o)return{buf:n,index:e-t};t=o}throw new RangeError("index is out of bounds")}function zm(r){return!!r?.[ZH]}var Ke=class r{bufs;length;[ZH]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*J(this.bufs)}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(zm(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(zm(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=QH(this.bufs,e);return t.buf[t.index]}set(e,t){let n=QH(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(zm(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:o}=this._subList(e,t);return Gt(n,o)}subarray(e,t){let{bufs:n,length:o}=this._subList(e,t);return n.length===1?n[0]:Gt(n,o)}sublist(e,t){let{bufs:n,length:o}=this._subList(e,t),i=new r;return i.length=o,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,e>=c)continue;let l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(s);break}let d=e-a;n.push(s.subarray(d,d+(t-e)));break}if(l){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(u){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!zm(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let d=0;d<i;d++)s[d]=-1;for(let d=0;d<o;d++)s[n[d]]=d;let a=s,c=this.byteLength-n.byteLength,l=n.byteLength-1,u;for(let d=t;d<=c;d+=u){u=0;for(let h=l;h>=0;h--){let p=this.get(d+h);if(n[h]!==p){u=Math.max(1,h-a[p]);break}}if(u===0)return d}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=br(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let o=et(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,t,n),this.write(o,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let o=et(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,t,n),this.write(o,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let o=et(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,t,n),this.write(o,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=br(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let o=et(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,t,n),this.write(o,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let o=et(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,t,n),this.write(o,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let o=et(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,t,n),this.write(o,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let o=et(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,t,n),this.write(o,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let o=et(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,t,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof r)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Le(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new r;return n.bufs=e,t==null&&(t=e.reduce((o,i)=>o+i.byteLength,0)),n.length=t,n}};var ohe=parseInt("11111",2),JA=parseInt("10000000",2),ihe=parseInt("01111111",2),JH={0:Wy,1:Wy,2:she,3:lhe,4:uhe,5:che,6:ahe,16:Wy,22:Wy,48:Wy};function Ss(r,e={offset:0}){let t=r[e.offset]&ohe;if(e.offset++,JH[t]!=null)return JH[t](r,e);throw new Error("No decoder for tag "+t)}function Yy(r,e){let t=0;if((r[e.offset]&JA)===JA){let n=r[e.offset]&ihe,o="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)o+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(o,16)}else t=r[e.offset],e.offset++;return t}function Wy(r,e){Yy(r,e);let t=[];for(;!(e.offset>=r.byteLength);){let n=Ss(r,e);if(n===null)break;t.push(n)}return t}function she(r,e){let t=Yy(r,e),n=e.offset,o=e.offset+t,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return e.offset+=t,Uint8Array.from(i)}function ahe(r,e){let t=Yy(r,e),n=e.offset+t,o=r[e.offset];e.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;e.offset<n;){let l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let d=0;d<c.length;d++)u+=c[d]<<d*7;a+=`.${u}`,c=[]}}return a}function che(r,e){return e.offset++,null}function lhe(r,e){let t=Yy(r,e),n=r[e.offset];e.offset++;let o=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function uhe(r,e){let t=Yy(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function dhe(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);let t=new Ke;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function tE(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let e=dhe(r.byteLength);return new Ke(Uint8Array.from([e.byteLength|JA]),e)}function Fo(r){let e=new Ke,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Ke(Uint8Array.from([2]),tE(e),e)}function Xy(r){let e=Uint8Array.from([0]),t=new Ke(e,r);return new Ke(Uint8Array.from([3]),tE(t),t)}function e$(r){return new Ke(Uint8Array.from([4]),tE(r),r)}function ca(r,e=48){let t=new Ke;for(let n of r)t.append(n);return new Ke(Uint8Array.from([e]),tE(t),t)}var t$="1.2.840.10045.3.1.7",r$="1.3.132.0.34",n$="1.3.132.0.35";function o$(r="P-256"){return f(this,null,function*(){let e=yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:yield crypto.subtle.exportKey("jwk",e.publicKey),privateKey:yield crypto.subtle.exportKey("jwk",e.privateKey)}})}function i$(r,e,t){return f(this,null,function*(){let n=yield crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);t?.signal?.throwIfAborted();let o=yield crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)})}function s$(r,e,t,n){return f(this,null,function*(){let o=yield crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let i=yield crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,e,t.subarray());return n?.signal?.throwIfAborted(),i})}var fhe=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),phe=Uint8Array.from([6,5,43,129,4,0,34]),hhe=Uint8Array.from([6,5,43,129,4,0,35]),a$={ext:!0,kty:"EC",crv:"P-256"},c$={ext:!0,kty:"EC",crv:"P-384"},l$={ext:!0,kty:"EC",crv:"P-521"},qm=32,Km=48,Gm=66;function u$(r){let e=Ss(r);return eD(e)}function eD(r){let e=r[1],t=ne(e,"base64url"),n=r[2][1][0],o=1,i,s;if(e.byteLength===qm)return i=ne(n.subarray(o,o+qm),"base64url"),s=ne(n.subarray(o+qm),"base64url"),new Af(I(v({},a$),{key_ops:["sign"],d:t,x:i,y:s}));if(e.byteLength===Km)return i=ne(n.subarray(o,o+Km),"base64url"),s=ne(n.subarray(o+Km),"base64url"),new Af(I(v({},c$),{key_ops:["sign"],d:t,x:i,y:s}));if(e.byteLength===Gm)return i=ne(n.subarray(o,o+Gm),"base64url"),s=ne(n.subarray(o+Gm),"base64url"),new Af(I(v({},l$),{key_ops:["sign"],d:t,x:i,y:s}));throw new Q(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function tD(r){let e=Ss(r);return d$(e)}function d$(r){let e=r[1][1][0],t=1,n,o;if(e.byteLength===qm*2+1)return n=ne(e.subarray(t,t+qm),"base64url"),o=ne(e.subarray(t+qm),"base64url"),new If(I(v({},a$),{key_ops:["verify"],x:n,y:o}));if(e.byteLength===Km*2+1)return n=ne(e.subarray(t,t+Km),"base64url"),o=ne(e.subarray(t+Km),"base64url"),new If(I(v({},c$),{key_ops:["verify"],x:n,y:o}));if(e.byteLength===Gm*2+1)return n=ne(e.subarray(t,t+Gm),"base64url"),o=ne(e.subarray(t+Gm),"base64url"),new If(I(v({},l$),{key_ops:["verify"],x:n,y:o}));throw new Q(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function f$(r){return ca([Fo(Uint8Array.from([1])),e$(ee(r.d??"","base64url")),ca([h$(r.crv)],160),ca([Xy(new Ke(Uint8Array.from([4]),ee(r.x??"","base64url"),ee(r.y??"","base64url")))],161)]).subarray()}function p$(r){return ca([Fo(Uint8Array.from([1])),ca([h$(r.crv)],160),ca([Xy(new Ke(Uint8Array.from([4]),ee(r.x??"","base64url"),ee(r.y??"","base64url")))],161)]).subarray()}function h$(r){if(r==="P-256")return fhe;if(r==="P-384")return phe;if(r==="P-521")return hhe;throw new Q(`Invalid curve ${r}`)}function m$(r="P-256"){return f(this,null,function*(){let e=yield o$(r);return new Af(e.privateKey)})}var If=class{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=p$(this.jwk)),this._raw}toMultihash(){return En.digest(Sn(this))}toCID(){return le.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}verify(e,t,n){return f(this,null,function*(){return s$(this.jwk,t,e,n)})}},Af=class{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new If({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=f$(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}sign(e,t){return f(this,null,function*(){return i$(this.jwk,e,t)})}};var Df=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ym(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function la(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Un(r,...e){if(!Ym(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Tf(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");la(r.outputLen),la(r.blockLen)}function Xm(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function y$(r,e){Un(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function uo(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Pf(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ua(r,e){return r<<32-e|r>>>e}function rE(r,e){return r<<e|r>>>32-e>>>0}var v$=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",mhe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function sc(r){if(Un(r),v$)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=mhe[r[t]];return e}var pl={_0:48,_9:57,A:65,F:70,a:97,f:102};function g$(r){if(r>=pl._0&&r<=pl._9)return r-pl._0;if(r>=pl.A&&r<=pl.F)return r-(pl.A-10);if(r>=pl.a&&r<=pl.f)return r-(pl.a-10)}function Qm(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(v$)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,i=0;o<t;o++,i+=2){let s=g$(r.charCodeAt(i)),a=g$(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}var ghe=()=>f(null,null,function*(){});function w$(r,e,t){return f(this,null,function*(){let n=Date.now();for(let o=0;o<r;o++){t(o);let i=Date.now()-n;i>=0&&i<e||(yield ghe(),n+=i)}})}function rD(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Mu(r){return typeof r=="string"&&(r=rD(r)),Un(r),r}function nD(r){return typeof r=="string"&&(r=rD(r)),Un(r),r}function Vi(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];Un(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}function b$(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}var Wm=class{};function Qy(r){let e=n=>r().update(Mu(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function hl(r=32){if(Df&&typeof Df.getRandomValues=="function")return Df.getRandomValues(new Uint8Array(r));if(Df&&typeof Df.randomBytes=="function")return Uint8Array.from(Df.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function yhe(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function nE(r,e,t){return r&e^~r&t}function oE(r,e,t){return r&e^r&t^e&t}var Mf=class extends Wm{constructor(e,t,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=Pf(this.buffer)}update(e){Xm(this),e=Mu(e),Un(e);let{view:t,buffer:n,blockLen:o}=this,i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Pf(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Xm(this),y$(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;t[s++]=128,uo(this.buffer.subarray(s)),this.padOffset>o-s&&(this.process(n,0),s=0);for(let d=s;d<o;d++)t[d]=0;yhe(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Pf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=i,e.length=o,e.pos=a,o%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},ml=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Vn=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var iE=BigInt(4294967295),x$=BigInt(32);function vhe(r,e=!1){return e?{h:Number(r&iE),l:Number(r>>x$&iE)}:{h:Number(r>>x$&iE)|0,l:Number(r&iE)|0}}function E$(r,e=!1){let t=r.length,n=new Uint32Array(t),o=new Uint32Array(t);for(let i=0;i<t;i++){let{h:s,l:a}=vhe(r[i],e);[n[i],o[i]]=[s,a]}return[n,o]}var oD=(r,e,t)=>r>>>t,iD=(r,e,t)=>r<<32-t|e>>>t,kf=(r,e,t)=>r>>>t|e<<32-t,Rf=(r,e,t)=>r<<32-t|e>>>t,Zy=(r,e,t)=>r<<64-t|e>>>t-32,Jy=(r,e,t)=>r>>>t-32|e<<64-t;function ac(r,e,t,n){let o=(e>>>0)+(n>>>0);return{h:r+t+(o/2**32|0)|0,l:o|0}}var _$=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),S$=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,C$=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),I$=(r,e,t,n,o)=>e+t+n+o+(r/2**32|0)|0,A$=(r,e,t,n,o)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),D$=(r,e,t,n,o,i)=>e+t+n+o+i+(r/2**32|0)|0;var bhe=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ku=new Uint32Array(64),sE=class extends Mf{constructor(e=32){super(64,e,8,!1),this.A=ml[0]|0,this.B=ml[1]|0,this.C=ml[2]|0,this.D=ml[3]|0,this.E=ml[4]|0,this.F=ml[5]|0,this.G=ml[6]|0,this.H=ml[7]|0}get(){let{A:e,B:t,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,t,n,o,i,s,a,c]}set(e,t,n,o,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)ku[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let h=ku[d-15],p=ku[d-2],m=ua(h,7)^ua(h,18)^h>>>3,w=ua(p,17)^ua(p,19)^p>>>10;ku[d]=w+ku[d-7]+m+ku[d-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){let h=ua(a,6)^ua(a,11)^ua(a,25),p=u+h+nE(a,c,l)+bhe[d]+ku[d]|0,w=(ua(n,2)^ua(n,13)^ua(n,22))+oE(n,o,i)|0;u=l,l=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+w|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,o,i,s,a,c,l,u)}roundClean(){uo(ku)}destroy(){this.set(0,0,0,0,0,0,0,0),uo(this.buffer)}};var T$=E$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),xhe=T$[0],Ehe=T$[1],Ru=new Uint32Array(80),Nu=new Uint32Array(80),aE=class extends Mf{constructor(e=64){super(128,e,16,!1),this.Ah=Vn[0]|0,this.Al=Vn[1]|0,this.Bh=Vn[2]|0,this.Bl=Vn[3]|0,this.Ch=Vn[4]|0,this.Cl=Vn[5]|0,this.Dh=Vn[6]|0,this.Dl=Vn[7]|0,this.Eh=Vn[8]|0,this.El=Vn[9]|0,this.Fh=Vn[10]|0,this.Fl=Vn[11]|0,this.Gh=Vn[12]|0,this.Gl=Vn[13]|0,this.Hh=Vn[14]|0,this.Hl=Vn[15]|0}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:p,Gl:m,Hh:w,Hl:E}=this;return[e,t,n,o,i,s,a,c,l,u,d,h,p,m,w,E]}set(e,t,n,o,i,s,a,c,l,u,d,h,p,m,w,E){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=p|0,this.Gl=m|0,this.Hh=w|0,this.Hl=E|0}process(e,t){for(let M=0;M<16;M++,t+=4)Ru[M]=e.getUint32(t),Nu[M]=e.getUint32(t+=4);for(let M=16;M<80;M++){let L=Ru[M-15]|0,F=Nu[M-15]|0,Y=kf(L,F,1)^kf(L,F,8)^oD(L,F,7),H=Rf(L,F,1)^Rf(L,F,8)^iD(L,F,7),U=Ru[M-2]|0,P=Nu[M-2]|0,R=kf(U,P,19)^Zy(U,P,61)^oD(U,P,6),N=Rf(U,P,19)^Jy(U,P,61)^iD(U,P,6),j=C$(H,N,Nu[M-7],Nu[M-16]),V=I$(j,Y,R,Ru[M-7],Ru[M-16]);Ru[M]=V|0,Nu[M]=j|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:p,Fl:m,Gh:w,Gl:E,Hh:S,Hl:A}=this;for(let M=0;M<80;M++){let L=kf(d,h,14)^kf(d,h,18)^Zy(d,h,41),F=Rf(d,h,14)^Rf(d,h,18)^Jy(d,h,41),Y=d&p^~d&w,H=h&m^~h&E,U=A$(A,F,H,Ehe[M],Nu[M]),P=D$(U,S,L,Y,xhe[M],Ru[M]),R=U|0,N=kf(n,o,28)^Zy(n,o,34)^Zy(n,o,39),j=Rf(n,o,28)^Jy(n,o,34)^Jy(n,o,39),V=n&i^n&a^i&a,Z=o&s^o&c^s&c;S=w|0,A=E|0,w=p|0,E=m|0,p=d|0,m=h|0,{h:d,l:h}=ac(l|0,u|0,P|0,R|0),l=a|0,u=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let X=_$(R,j,Z);n=S$(X,P,N,V),o=X|0}({h:n,l:o}=ac(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=ac(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=ac(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ac(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=ac(this.Eh|0,this.El|0,d|0,h|0),{h:p,l:m}=ac(this.Fh|0,this.Fl|0,p|0,m|0),{h:w,l:E}=ac(this.Gh|0,this.Gl|0,w|0,E|0),{h:S,l:A}=ac(this.Hh|0,this.Hl|0,S|0,A|0),this.set(n,o,i,s,a,c,l,u,d,h,p,m,w,E,S,A)}roundClean(){uo(Ru,Nu)}destroy(){uo(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var cE=Qy(()=>new sE);var lE=Qy(()=>new aE);var cD=BigInt(0),aD=BigInt(1);function gl(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function e2(r){let e=r.toString(16);return e.length&1?"0"+e:e}function P$(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?cD:BigInt("0x"+r)}function Zm(r){return P$(sc(r))}function cc(r){return Un(r),P$(sc(Uint8Array.from(r).reverse()))}function uE(r,e){return Qm(r.toString(16).padStart(e*2,"0"))}function Ou(r,e){return uE(r,e).reverse()}function Jt(r,e,t){let n;if(typeof e=="string")try{n=Qm(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(Ym(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof t=="number"&&o!==t)throw new Error(r+" of length "+t+" expected, got "+o);return n}var sD=r=>typeof r=="bigint"&&cD<=r;function M$(r,e,t){return sD(r)&&sD(e)&&sD(t)&&e<=r&&r<t}function da(r,e,t,n){if(!M$(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function k$(r){let e;for(e=0;r>cD;r>>=aD,e+=1);return e}var Nf=r=>(aD<<BigInt(r))-aD;function R$(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),i=n(r),s=n(r),a=0,c=()=>{i.fill(1),s.fill(0),a=0},l=(...p)=>t(s,i,...p),u=(p=n(0))=>{s=l(o(0),p),i=l(),p.length!==0&&(s=l(o(1),p),i=l())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,m=[];for(;p<e;){i=l();let w=i.slice();m.push(w),p+=i.length}return Vi(...m)};return(p,m)=>{c(),u(p);let w;for(;!(w=m(d()));)u();return c(),w}}function lc(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(o,i,s){let a=r[o];if(s&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${o}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([o,i])=>n(o,i,!1)),Object.entries(t).forEach(([o,i])=>n(o,i,!0))}function Jm(r){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let i=r(t,...n);return e.set(t,i),i}}var Bo=BigInt(0),Cn=BigInt(1),Of=BigInt(2),_he=BigInt(3),L$=BigInt(4),F$=BigInt(5),B$=BigInt(8);function rr(r,e){let t=r%e;return t>=Bo?t:e+t}function ar(r,e,t){let n=r;for(;e-- >Bo;)n*=n,n%=t;return n}function N$(r,e){if(r===Bo)throw new Error("invert: expected non-zero number");if(e<=Bo)throw new Error("invert: expected positive modulus, got "+e);let t=rr(r,e),n=e,o=Bo,i=Cn,s=Cn,a=Bo;for(;t!==Bo;){let l=n/t,u=n%t,d=o-s*l,h=i-a*l;n=t,t=u,o=s,i=a,s=d,a=h}if(n!==Cn)throw new Error("invert: does not exist");return rr(o,e)}function U$(r,e){let t=(r.ORDER+Cn)/L$,n=r.pow(e,t);if(!r.eql(r.sqr(n),e))throw new Error("Cannot find square root");return n}function She(r,e){let t=(r.ORDER-F$)/B$,n=r.mul(e,Of),o=r.pow(n,t),i=r.mul(e,o),s=r.mul(r.mul(i,Of),o),a=r.mul(i,r.sub(s,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function Che(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-Cn,t=0;for(;e%Of===Bo;)e/=Of,t++;let n=Of,o=fa(r);for(;O$(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return U$;let i=o.pow(n,e),s=(e+Cn)/Of;return function(c,l){if(c.is0(l))return l;if(O$(c,l)!==1)throw new Error("Cannot find square root");let u=t,d=c.mul(c.ONE,i),h=c.pow(l,e),p=c.pow(l,s);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let m=1,w=c.sqr(h);for(;!c.eql(w,c.ONE);)if(m++,w=c.sqr(w),m===u)throw new Error("Cannot find square root");let E=Cn<<BigInt(u-m-1),S=c.pow(d,E);u=m,d=c.sqr(S),h=c.mul(h,d),p=c.mul(p,S)}return p}}function Ihe(r){return r%L$===_he?U$:r%B$===F$?She:Che(r)}var V$=(r,e)=>(rr(r,e)&Cn)===Cn,Ahe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lD(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=Ahe.reduce((n,o)=>(n[o]="function",n),e);return lc(r,t),r}function Dhe(r,e,t){if(t<Bo)throw new Error("invalid exponent, negatives unsupported");if(t===Bo)return r.ONE;if(t===Cn)return e;let n=r.ONE,o=e;for(;t>Bo;)t&Cn&&(n=r.mul(n,o)),o=r.sqr(o),t>>=Cn;return n}function t2(r,e,t=!1){let n=new Array(e.length).fill(t?r.ZERO:void 0),o=e.reduce((s,a,c)=>r.is0(a)?s:(n[c]=s,r.mul(s,a)),r.ONE),i=r.inv(o);return e.reduceRight((s,a,c)=>r.is0(a)?s:(n[c]=r.mul(s,n[c]),r.mul(s,a)),i),n}function O$(r,e){let t=(r.ORDER-Cn)/Of,n=r.pow(e,t),o=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),s=r.eql(n,r.neg(r.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function j$(r,e){e!==void 0&&la(e);let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function fa(r,e,t=!1,n={}){if(r<=Bo)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,i;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");let u=e;u.BITS&&(o=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(t=u.isLE)}else typeof e=="number"&&(o=e),n.sqrt&&(i=n.sqrt);let{nBitLength:s,nByteLength:a}=j$(r,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,l=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:a,MASK:Nf(s),ZERO:Bo,ONE:Cn,create:u=>rr(u,r),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Bo<=u&&u<r},is0:u=>u===Bo,isValidNot0:u=>!l.is0(u)&&l.isValid(u),isOdd:u=>(u&Cn)===Cn,neg:u=>rr(-u,r),eql:(u,d)=>u===d,sqr:u=>rr(u*u,r),add:(u,d)=>rr(u+d,r),sub:(u,d)=>rr(u-d,r),mul:(u,d)=>rr(u*d,r),pow:(u,d)=>Dhe(l,u,d),div:(u,d)=>rr(u*N$(d,r),r),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>N$(u,r),sqrt:i||(u=>(c||(c=Ihe(r)),c(l,u))),toBytes:u=>t?Ou(u,a):uE(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return t?cc(u):Zm(u)},invertBatch:u=>t2(l,u),cmov:(u,d,h)=>h?d:u});return Object.freeze(l)}function H$(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function uD(r){let e=H$(r);return e+Math.ceil(e/2)}function $$(r,e,t=!1){let n=r.length,o=H$(e),i=uD(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=t?cc(r):Zm(r),a=rr(s,e-Cn)+Cn;return t?Ou(a,o):uE(a,o)}var tg=BigInt(0),Lf=BigInt(1);function eg(r,e){let t=e.negate();return r?t:e}function dE(r,e,t){let n=e==="pz"?s=>s.pz:s=>s.ez,o=t2(r.Fp,t.map(n));return t.map((s,a)=>s.toAffine(o[a])).map(r.fromAffine)}function G$(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function dD(r,e){G$(r,e);let t=Math.ceil(e/r)+1,n=2**(r-1),o=2**r,i=Nf(r),s=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:o,shiftBy:s}}function z$(r,e,t){let{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=t,a=Number(r&o),c=r>>s;a>n&&(a-=i,c+=Lf);let l=e*n,u=l+Math.abs(a)-1,d=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:p,offsetF:l}}function The(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Phe(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}var fD=new WeakMap,W$=new WeakMap;function pD(r){return W$.get(r)||1}function q$(r){if(r!==tg)throw new Error("invalid wNAF")}function fE(r,e){return{constTimeNegate:eg,hasPrecomputes(t){return pD(t)!==1},unsafeLadder(t,n,o=r.ZERO){let i=t;for(;n>tg;)n&Lf&&(o=o.add(i)),i=i.double(),n>>=Lf;return o},precomputeWindow(t,n){let{windows:o,windowSize:i}=dD(n,e),s=[],a=t,c=a;for(let l=0;l<o;l++){c=a,s.push(c);for(let u=1;u<i;u++)c=c.add(a),s.push(c);a=c.double()}return s},wNAF(t,n,o){let i=r.ZERO,s=r.BASE,a=dD(t,e);for(let c=0;c<a.windows;c++){let{nextN:l,offset:u,isZero:d,isNeg:h,isNegF:p,offsetF:m}=z$(o,c,a);o=l,d?s=s.add(eg(p,n[m])):i=i.add(eg(h,n[u]))}return q$(o),{p:i,f:s}},wNAFUnsafe(t,n,o,i=r.ZERO){let s=dD(t,e);for(let a=0;a<s.windows&&o!==tg;a++){let{nextN:c,offset:l,isZero:u,isNeg:d}=z$(o,a,s);if(o=c,!u){let h=n[l];i=i.add(d?h.negate():h)}}return q$(o),i},getPrecomputes(t,n,o){let i=fD.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof o=="function"&&(i=o(i)),fD.set(n,i))),i},wNAFCached(t,n,o){let i=pD(t);return this.wNAF(i,this.getPrecomputes(i,t,o),n)},wNAFCachedUnsafe(t,n,o,i){let s=pD(t);return s===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,o),n,i)},setWindowSize(t,n){G$(n,e),W$.set(t,n),fD.delete(t)}}}function Y$(r,e,t,n){let o=e,i=r.ZERO,s=r.ZERO;for(;t>tg||n>tg;)t&Lf&&(i=i.add(o)),n&Lf&&(s=s.add(o)),o=o.double(),t>>=Lf,n>>=Lf;return{p1:i,p2:s}}function pE(r,e,t,n){The(t,r),Phe(n,e);let o=t.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");let s=r.ZERO,a=k$(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Nf(c),u=new Array(Number(l)+1).fill(s),d=Math.floor((e.BITS-1)/c)*c,h=s;for(let p=d;p>=0;p-=c){u.fill(s);for(let w=0;w<i;w++){let E=n[w],S=Number(E>>BigInt(p)&l);u[S]=u[S].add(t[w])}let m=s;for(let w=u.length-1,E=s;w>0;w--)E=E.add(u[w]),m=m.add(E);if(h=h.add(m),p!==0)for(let w=0;w<c;w++)h=h.double()}return h}function K$(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return lD(e),e}else return fa(r)}function hE(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>tg))throw new Error(`CURVE.${a} must be positive bigint`)}let n=K$(e.p,t.Fp),o=K$(e.n,t.Fn),s=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(let a of s)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var uc=BigInt(0),Uo=BigInt(1),hD=BigInt(2),Mhe=BigInt(8),khe={zip215:!0};function Rhe(r,e,t,n){let o=r.sqr(t),i=r.sqr(n),s=r.add(r.mul(e.a,o),i),a=r.add(r.ONE,r.mul(e.d,r.mul(o,i)));return r.eql(s,a)}function Nhe(r,e={}){let{Fp:t,Fn:n}=hE("edwards",r,e),{h:o,n:i}=r;lc(e,{},{uvRatio:"function"});let s=hD<<BigInt(n.BYTES*8)-Uo,a=w=>t.create(w),c=e.uvRatio||((w,E)=>{try{return{isValid:!0,value:t.sqrt(t.div(w,E))}}catch{return{isValid:!1,value:uc}}});if(!Rhe(t,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function l(w,E,S=!1){let A=S?Uo:uc;return da("coordinate "+w,E,A,s),E}function u(w){if(!(w instanceof p))throw new Error("ExtendedPoint expected")}let d=Jm((w,E)=>{let{ex:S,ey:A,ez:M}=w,L=w.is0();E==null&&(E=L?Mhe:t.inv(M));let F=a(S*E),Y=a(A*E),H=a(M*E);if(L)return{x:uc,y:Uo};if(H!==Uo)throw new Error("invZ was invalid");return{x:F,y:Y}}),h=Jm(w=>{let{a:E,d:S}=r;if(w.is0())throw new Error("bad point: ZERO");let{ex:A,ey:M,ez:L,et:F}=w,Y=a(A*A),H=a(M*M),U=a(L*L),P=a(U*U),R=a(Y*E),N=a(U*a(R+H)),j=a(P+a(S*a(Y*H)));if(N!==j)throw new Error("bad point: equation left != right (1)");let V=a(A*M),Z=a(L*F);if(V!==Z)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(E,S,A,M){this.ex=l("x",E),this.ey=l("y",S),this.ez=l("z",A,!0),this.et=l("t",M),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(E){if(E instanceof p)throw new Error("extended point not allowed");let{x:S,y:A}=E||{};return l("x",S),l("y",A),new p(S,A,Uo,a(S*A))}static normalizeZ(E){return dE(p,"ez",E)}static msm(E,S){return pE(p,n,E,S)}_setWindowSize(E){this.precompute(E)}precompute(E=8,S=!0){return m.setWindowSize(this,E),S||this.multiply(hD),this}assertValidity(){h(this)}equals(E){u(E);let{ex:S,ey:A,ez:M}=this,{ex:L,ey:F,ez:Y}=E,H=a(S*Y),U=a(L*M),P=a(A*Y),R=a(F*M);return H===U&&P===R}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:E}=r,{ex:S,ey:A,ez:M}=this,L=a(S*S),F=a(A*A),Y=a(hD*a(M*M)),H=a(E*L),U=S+A,P=a(a(U*U)-L-F),R=H+F,N=R-Y,j=H-F,V=a(P*N),Z=a(R*j),X=a(P*j),te=a(N*R);return new p(V,Z,te,X)}add(E){u(E);let{a:S,d:A}=r,{ex:M,ey:L,ez:F,et:Y}=this,{ex:H,ey:U,ez:P,et:R}=E,N=a(M*H),j=a(L*U),V=a(Y*A*R),Z=a(F*P),X=a((M+L)*(H+U)-N-j),te=Z-V,ce=Z+V,fe=a(j-S*N),ue=a(X*te),Ue=a(ce*fe),Ce=a(X*fe),ae=a(te*ce);return new p(ue,Ue,ae,Ce)}subtract(E){return this.add(E.negate())}multiply(E){let S=E;da("scalar",S,Uo,i);let{p:A,f:M}=m.wNAFCached(this,S,p.normalizeZ);return p.normalizeZ([A,M])[0]}multiplyUnsafe(E,S=p.ZERO){let A=E;return da("scalar",A,uc,i),A===uc?p.ZERO:this.is0()||A===Uo?this:m.wNAFCachedUnsafe(this,A,p.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return m.wNAFCachedUnsafe(this,i).is0()}toAffine(E){return d(this,E)}clearCofactor(){return o===Uo?this:this.multiplyUnsafe(o)}static fromBytes(E,S=!1){return Un(E),this.fromHex(E,S)}static fromHex(E,S=!1){let{d:A,a:M}=r,L=t.BYTES;E=Jt("pointHex",E,L),gl("zip215",S);let F=E.slice(),Y=E[L-1];F[L-1]=Y&-129;let H=cc(F),U=S?s:t.ORDER;da("pointHex.y",H,uc,U);let P=a(H*H),R=a(P-Uo),N=a(A*P-M),{isValid:j,value:V}=c(R,N);if(!j)throw new Error("Point.fromHex: invalid y coordinate");let Z=(V&Uo)===Uo,X=(Y&128)!==0;if(!S&&V===uc&&X)throw new Error("Point.fromHex: x=0 and x_0=1");return X!==Z&&(V=a(-V)),p.fromAffine({x:V,y:H})}static fromPrivateScalar(E){return p.BASE.multiply(E)}toBytes(){let{x:E,y:S}=this.toAffine(),A=Ou(S,t.BYTES);return A[A.length-1]|=E&Uo?128:0,A}toRawBytes(){return this.toBytes()}toHex(){return sc(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(r.Gx,r.Gy,Uo,a(r.Gx*r.Gy)),p.ZERO=new p(uc,Uo,Uo,uc),p.Fp=t,p.Fn=n;let m=fE(p,n.BYTES*8);return p}function Ohe(r,e){lc(e,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:t,hash:n}=e,{BASE:o,Fp:i,Fn:s}=r,a=s.ORDER,c=e.randomBytes||hl,l=e.adjustScalarBytes||(F=>F),u=e.domain||((F,Y,H)=>{if(gl("phflag",H),Y.length||H)throw new Error("Contexts/pre-hash are not supported");return F});function d(F){return s.create(F)}function h(F){return d(cc(F))}function p(F){let Y=i.BYTES;F=Jt("private key",F,Y);let H=Jt("hashed private key",n(F),2*Y),U=l(H.slice(0,Y)),P=H.slice(Y,2*Y),R=h(U);return{head:U,prefix:P,scalar:R}}function m(F){let{head:Y,prefix:H,scalar:U}=p(F),P=o.multiply(U),R=P.toBytes();return{head:Y,prefix:H,scalar:U,point:P,pointBytes:R}}function w(F){return m(F).pointBytes}function E(F=Uint8Array.of(),...Y){let H=Vi(...Y);return h(n(u(H,Jt("context",F),!!t)))}function S(F,Y,H={}){F=Jt("message",F),t&&(F=t(F));let{prefix:U,scalar:P,pointBytes:R}=m(Y),N=E(H.context,U,F),j=o.multiply(N).toBytes(),V=E(H.context,j,R,F),Z=d(N+V*P);da("signature.s",Z,uc,a);let X=i.BYTES,te=Vi(j,Ou(Z,X));return Jt("result",te,X*2)}let A=khe;function M(F,Y,H,U=A){let{context:P,zip215:R}=U,N=i.BYTES;F=Jt("signature",F,2*N),Y=Jt("message",Y),H=Jt("publicKey",H,N),R!==void 0&&gl("zip215",R),t&&(Y=t(Y));let j=cc(F.slice(N,2*N)),V,Z,X;try{V=r.fromHex(H,R),Z=r.fromHex(F.slice(0,N),R),X=o.multiplyUnsafe(j)}catch{return!1}if(!R&&V.isSmallOrder())return!1;let te=E(P,Z.toBytes(),V.toBytes(),Y);return Z.add(V.multiplyUnsafe(te)).subtract(X).clearCofactor().is0()}return o.precompute(8),{getPublicKey:w,sign:S,verify:M,utils:{getExtendedPublicKey:m,randomPrivateKey:()=>c(i.BYTES),precompute(F=8,Y=r.BASE){return Y.precompute(F,!1)}},Point:r}}function Lhe(r){let e={a:r.a,d:r.d,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=fa(e.n,r.nBitLength,!0),o={Fp:t,Fn:n,uvRatio:r.uvRatio},i={hash:r.hash,randomBytes:r.randomBytes,adjustScalarBytes:r.adjustScalarBytes,domain:r.domain,prehash:r.prehash,mapToCurve:r.mapToCurve};return{CURVE:e,curveOpts:o,eddsaOpts:i}}function Fhe(r,e){return Object.assign({},e,{ExtendedPoint:e.Point,CURVE:r})}function X$(r){let{CURVE:e,curveOpts:t,eddsaOpts:n}=Lhe(r),o=Nhe(e,t),i=Ohe(o,n);return Fhe(r,i)}var r2=BigInt(0),rg=BigInt(1),mE=BigInt(2);function Bhe(r){return lc(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(v({},r))}function Q$(r){let e=Bhe(r),{P:t,type:n,adjustScalarBytes:o,powPminus2:i,randomBytes:s}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=s||hl,l=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),p=a?mE**BigInt(254):mE**BigInt(447),m=a?BigInt(8)*mE**BigInt(251)-rg:BigInt(4)*mE**BigInt(445)-rg,w=p+m+rg,E=P=>rr(P,t),S=A(d);function A(P){return Ou(E(P),u)}function M(P){let R=Jt("u coordinate",P,u);return a&&(R[31]&=127),E(cc(R))}function L(P){return cc(o(Jt("scalar",P,u)))}function F(P,R){let N=U(M(R),L(P));if(N===r2)throw new Error("invalid private or public key received");return A(N)}function Y(P){return F(P,S)}function H(P,R,N){let j=E(P*(R-N));return R=E(R-j),N=E(N+j),{x_2:R,x_3:N}}function U(P,R){da("u",P,r2,t),da("scalar",R,p,w);let N=R,j=P,V=rg,Z=r2,X=P,te=rg,ce=r2;for(let ue=BigInt(l-1);ue>=r2;ue--){let Ue=N>>ue&rg;ce^=Ue,{x_2:V,x_3:X}=H(ce,V,X),{x_2:Z,x_3:te}=H(ce,Z,te),ce=Ue;let Ce=V+Z,ae=E(Ce*Ce),pt=V-Z,zt=E(pt*pt),He=ae-zt,er=X+te,Jn=X-te,sn=E(Jn*Ce),an=E(er*pt),Pn=sn+an,Ji=sn-an;X=E(Pn*Pn),te=E(j*E(Ji*Ji)),V=E(ae*zt),Z=E(He*(ae+E(h*He)))}({x_2:V,x_3:X}=H(ce,V,X)),{x_2:Z,x_3:te}=H(ce,Z,te);let fe=i(Z);return E(V*fe)}return{scalarMult:F,scalarMultBase:Y,getSharedSecret:(P,R)=>F(P,R),getPublicKey:P=>Y(P),utils:{randomPrivateKey:()=>c(u)},GuBytes:S.slice()}}var XHe=BigInt(0),Uhe=BigInt(1),Z$=BigInt(2),Vhe=BigInt(3),jhe=BigInt(5),Hhe=BigInt(8),n2={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Hhe,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ez(r){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),i=n2.p,a=r*r%i*r%i,c=ar(a,Z$,i)*a%i,l=ar(c,Uhe,i)*r%i,u=ar(l,jhe,i)*l%i,d=ar(u,e,i)*u%i,h=ar(d,t,i)*d%i,p=ar(h,n,i)*h%i,m=ar(p,o,i)*p%i,w=ar(m,o,i)*p%i,E=ar(w,e,i)*u%i;return{pow_p_5_8:ar(E,Z$,i)*r%i,b2:a}}function tz(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var J$=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function $he(r,e){let t=n2.p,n=rr(e*e*e,t),o=rr(n*n*e,t),i=ez(r*o).pow_p_5_8,s=rr(r*n*i,t),a=rr(e*s*s,t),c=s,l=rr(s*J$,t),u=a===r,d=a===rr(-r,t),h=a===rr(-r*J$,t);return u&&(s=c),(d||h)&&(s=l),V$(s,t)&&(s=rr(-s,t)),{isValid:u||d,value:s}}var zhe=fa(n2.p,void 0,!0),qhe=I(v({},n2),{Fp:zhe,hash:lE,adjustScalarBytes:tz,uvRatio:$he}),o2=X$(qhe);var i2=(()=>{let r=n2.p;return Q$({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:n}=ez(e);return rr(ar(t,Vhe,r)*n,r)},adjustScalarBytes:tz})})();var Ff=32,ji=64,mD=32;var ng,rz=f(null,null,function*(){try{return yield Jr.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}});function nz(){let r=o2.utils.randomPrivateKey(),e=o2.getPublicKey(r);return{privateKey:Xhe(r,e),publicKey:e}}function Khe(r,e){return f(this,null,function*(){let t;r.length===ji?t=r.subarray(0,32):t=r;let n={crv:"Ed25519",kty:"OKP",x:ne(r.subarray(32),"base64url"),d:ne(t,"base64url"),ext:!0,key_ops:["sign"]},o=yield Jr.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=yield Jr.get().subtle.sign({name:"Ed25519"},o,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)})}function Ghe(r,e){let t=r.subarray(0,mD);return o2.sign(e instanceof Uint8Array?e:e.subarray(),t)}function oz(r,e){return f(this,null,function*(){return ng==null&&(ng=yield rz),ng?Khe(r,e):Ghe(r,e)})}function Whe(r,e,t){return f(this,null,function*(){if(r.buffer instanceof ArrayBuffer){let n=yield Jr.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return yield Jr.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")})}function Yhe(r,e,t){return o2.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function iz(r,e,t){return f(this,null,function*(){return ng==null&&(ng=yield rz),ng?Whe(r,e,t):Yhe(r,e,t)})}function Xhe(r,e){let t=new Uint8Array(ji);for(let n=0;n<mD;n++)t[n]=r[n],t[mD+n]=e[n];return t}function og(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var s2=class{type="Ed25519";raw;constructor(e){this.raw=sg(e,Ff)}toMultihash(){return En.digest(Sn(this))}toCID(){return le.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}verify(e,t,n){n?.signal?.throwIfAborted();let o=iz(this.raw,t,e);return og(o)?o.then(i=>(n?.signal?.throwIfAborted(),i)):o}},ig=class{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=sg(e,ji),this.publicKey=new s2(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();let n=oz(this.raw,e);return og(n)?n.then(o=>(t?.signal?.throwIfAborted(),o)):(t?.signal?.throwIfAborted(),n)}};function gD(r){if(r.length>ji){r=sg(r,ji+Ff);let n=r.subarray(0,ji),o=r.subarray(ji,r.length);return new ig(n,o)}r=sg(r,ji);let e=r.subarray(0,ji),t=r.subarray(Ff);return new ig(e,t)}function yD(r){return r=sg(r,Ff),new s2(r)}function az(){return f(this,null,function*(){let{privateKey:r,publicKey:e}=nz();return new ig(r,e)})}function sg(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Q(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}var Qhe=Math.pow(2,7),Zhe=Math.pow(2,14),Jhe=Math.pow(2,21),vD=Math.pow(2,28),wD=Math.pow(2,35),bD=Math.pow(2,42),xD=Math.pow(2,49),Vt=128,fo=127;function It(r){if(r<Qhe)return 1;if(r<Zhe)return 2;if(r<Jhe)return 3;if(r<vD)return 4;if(r<wD)return 5;if(r<bD)return 6;if(r<xD)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ag(r,e,t=0){switch(It(r)){case 8:e[t++]=r&255|Vt,r/=128;case 7:e[t++]=r&255|Vt,r/=128;case 6:e[t++]=r&255|Vt,r/=128;case 5:e[t++]=r&255|Vt,r/=128;case 4:e[t++]=r&255|Vt,r>>>=7;case 3:e[t++]=r&255|Vt,r>>>=7;case 2:e[t++]=r&255|Vt,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function eme(r,e,t=0){switch(It(r)){case 8:e.set(t++,r&255|Vt),r/=128;case 7:e.set(t++,r&255|Vt),r/=128;case 6:e.set(t++,r&255|Vt),r/=128;case 5:e.set(t++,r&255|Vt),r/=128;case 4:e.set(t++,r&255|Vt),r>>>=7;case 3:e.set(t++,r&255|Vt),r>>>=7;case 2:e.set(t++,r&255|Vt),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function ED(r,e){let t=r[e],n=0;if(n+=t&fo,t<Vt||(t=r[e+1],n+=(t&fo)<<7,t<Vt)||(t=r[e+2],n+=(t&fo)<<14,t<Vt)||(t=r[e+3],n+=(t&fo)<<21,t<Vt)||(t=r[e+4],n+=(t&fo)*vD,t<Vt)||(t=r[e+5],n+=(t&fo)*wD,t<Vt)||(t=r[e+6],n+=(t&fo)*bD,t<Vt)||(t=r[e+7],n+=(t&fo)*xD,t<Vt))return n;throw new RangeError("Could not decode varint")}function tme(r,e){let t=r.get(e),n=0;if(n+=t&fo,t<Vt||(t=r.get(e+1),n+=(t&fo)<<7,t<Vt)||(t=r.get(e+2),n+=(t&fo)<<14,t<Vt)||(t=r.get(e+3),n+=(t&fo)<<21,t<Vt)||(t=r.get(e+4),n+=(t&fo)*vD,t<Vt)||(t=r.get(e+5),n+=(t&fo)*wD,t<Vt)||(t=r.get(e+6),n+=(t&fo)*bD,t<Vt)||(t=r.get(e+7),n+=(t&fo)*xD,t<Vt))return n;throw new RangeError("Could not decode varint")}function In(r,e,t=0){return e==null&&(e=br(It(r))),e instanceof Uint8Array?ag(r,e,t):eme(r,e,t)}function pa(r,e=0){return r instanceof Uint8Array?ED(r,e):tme(r,e)}var _D=new Float32Array([-0]),Lu=new Uint8Array(_D.buffer);function cz(r,e,t){_D[0]=r,e[t]=Lu[0],e[t+1]=Lu[1],e[t+2]=Lu[2],e[t+3]=Lu[3]}function lz(r,e){return Lu[0]=r[e],Lu[1]=r[e+1],Lu[2]=r[e+2],Lu[3]=r[e+3],_D[0]}var SD=new Float64Array([-0]),po=new Uint8Array(SD.buffer);function uz(r,e,t){SD[0]=r,e[t]=po[0],e[t+1]=po[1],e[t+2]=po[2],e[t+3]=po[3],e[t+4]=po[4],e[t+5]=po[5],e[t+6]=po[6],e[t+7]=po[7]}function dz(r,e){return po[0]=r[e],po[1]=r[e+1],po[2]=r[e+2],po[3]=r[e+3],po[4]=r[e+4],po[5]=r[e+5],po[6]=r[e+6],po[7]=r[e+7],SD[0]}var rme=BigInt(Number.MAX_SAFE_INTEGER),nme=BigInt(Number.MIN_SAFE_INTEGER),Hi=class r{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Bf;if(e<rme&&e>nme)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,o=e-(n<<32n);return t&&(n=~n|0n,o=~o|0n,++o>fz&&(o=0n,++n>fz&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(e){if(e===0)return Bf;let t=e<0;t&&(e=-e);let n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(e){return typeof e=="number"?r.fromNumber(e):typeof e=="bigint"?r.fromBigInt(e):typeof e=="string"?r.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new r(e.low>>>0,e.high>>>0):Bf}},Bf=new Hi(0,0);Bf.toBigInt=function(){return 0n};Bf.zzEncode=Bf.zzDecode=function(){return this};Bf.length=function(){return 1};var fz=4294967296n;function pz(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function hz(r,e,t){if(t-e<1)return"";let o,i=[],s=0,a;for(;e<t;)a=r[e++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function CD(r,e,t){let n=t,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128);return t-n}function ha(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function gE(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var ID=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ha(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw ha(this,4);return gE(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ha(this,4);return gE(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw ha(this,4);let e=lz(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw ha(this,4);let e=dz(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ha(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return hz(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ha(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ha(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Hi(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw ha(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw ha(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ha(this,8);let e=gE(this.buf,this.pos+=4),t=gE(this.buf,this.pos+=4);return new Hi(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=ED(this.buf,this.pos);return this.pos+=It(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function AD(r){return new ID(r instanceof Uint8Array?r:r.subarray())}function $e(r,e,t){let n=AD(r);return e.decode(n,void 0,t)}function DD(r){let e=r??8192,t=e>>>1,n,o=e;return function(s){if(s<1||s>t)return br(s);o+s>e&&(n=br(e),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var Uf=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function TD(){}var MD=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},ome=DD();function ime(r){return globalThis.Buffer!=null?br(r):ome(r)}var c2=class{len;head;tail;states;constructor(){this.len=0,this.head=new Uf(TD,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Uf(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new kD((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(yE,10,Hi.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Hi.fromBigInt(e);return this._push(yE,t.length(),t)}uint64Number(e){return this._push(ag,It(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Hi.fromBigInt(e).zzEncode();return this._push(yE,t.length(),t)}sint64Number(e){let t=Hi.fromNumber(e).zzEncode();return this._push(yE,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(PD,1,e?1:0)}fixed32(e){return this._push(a2,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Hi.fromBigInt(e);return this._push(a2,4,t.lo)._push(a2,4,t.hi)}fixed64Number(e){let t=Hi.fromNumber(e);return this._push(a2,4,t.lo)._push(a2,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(cz,4,e)}double(e){return this._push(uz,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(PD,1,0):this.uint32(t)._push(ame,t,e)}string(e){let t=pz(e);return t!==0?this.uint32(t)._push(CD,t,e):this._push(PD,1,0)}fork(){return this.states=new MD(this),this.head=this.tail=new Uf(TD,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Uf(TD,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=ime(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function PD(r,e,t){e[t]=r&255}function sme(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var kD=class extends Uf{next;constructor(e,t){super(sme,e,t),this.next=void 0}};function yE(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function a2(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function ame(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(c2.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(cme,e,r),this},c2.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(lme,e,r),this});function cme(r,e,t){e.set(r,t)}function lme(r,e,t){r.length<40?CD(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(ee(r),t)}function RD(){return new c2}function ze(r,e){let t=RD();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var l2=function(r){return r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32",r}(l2||{});function vE(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function nr(r){function e(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let t=function(i,s){let a=e(i);s.int32(a)},n=function(i){let s=i.int32();return e(s)};return vE("enum",l2.VARINT,t,n)}function qe(r,e){return vE("message",l2.LENGTH_DELIMITED,r,e)}var Wt=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"},u2=class extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"};var cr=function(r){return r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA",r}(cr||{}),gz=function(r){return r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA",r}(gz||{});(function(r){r.codec=()=>nr(gz)})(cr||(cr={}));var dc;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),cr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=cr.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(dc||(dc={}));var d2;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),cr.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=cr.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(d2||(d2={}));function Vo(r){if(isNaN(r)||r<=0)throw new Q("random bytes length must be a Number bigger than 0");return hl(r)}var p2={};Mn(p2,{MAX_RSA_KEY_SIZE:()=>ND,generateRSAKeyPair:()=>$D,jwkToJWKKeyPair:()=>bz,jwkToPkcs1:()=>pme,jwkToPkix:()=>BD,jwkToRSAPrivateKey:()=>HD,pkcs1MessageToJwk:()=>LD,pkcs1MessageToRSAPrivateKey:()=>wE,pkcs1ToJwk:()=>fme,pkcs1ToRSAPrivateKey:()=>UD,pkixMessageToJwk:()=>FD,pkixMessageToRSAPublicKey:()=>jD,pkixToJwk:()=>hme,pkixToRSAPublicKey:()=>VD});var fc=cE;var cg=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=p2.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return le.createV1(114,this._multihash)}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}verify(e,t,n){return wz(this.jwk,t,e,n)}},f2=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=p2.jwkToPkcs1(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}sign(e,t){return vz(this.jwk,e,t)}};var ND=8192,OD=18,ume=1062,dme=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function fme(r){let e=Ss(r);return LD(e)}function LD(r){return{n:ne(r[1],"base64url"),e:ne(r[2],"base64url"),d:ne(r[3],"base64url"),p:ne(r[4],"base64url"),q:ne(r[5],"base64url"),dp:ne(r[6],"base64url"),dq:ne(r[7],"base64url"),qi:ne(r[8],"base64url"),kty:"RSA"}}function pme(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Q("JWK was missing components");return ca([Fo(Uint8Array.from([0])),Fo(ee(r.n,"base64url")),Fo(ee(r.e,"base64url")),Fo(ee(r.d,"base64url")),Fo(ee(r.p,"base64url")),Fo(ee(r.q,"base64url")),Fo(ee(r.dp,"base64url")),Fo(ee(r.dq,"base64url")),Fo(ee(r.qi,"base64url"))]).subarray()}function hme(r){let e=Ss(r,{offset:0});return FD(e)}function FD(r){let e=Ss(r[1],{offset:0});return{kty:"RSA",n:ne(e[0],"base64url"),e:ne(e[1],"base64url")}}function BD(r){if(r.n==null||r.e==null)throw new Q("JWK was missing components");return ca([dme,Xy(ca([Fo(ee(r.n,"base64url")),Fo(ee(r.e,"base64url"))]))]).subarray()}function UD(r){let e=Ss(r);return wE(e)}function wE(r){let e=LD(r);return HD(e)}function VD(r,e){if(r.byteLength>=ume)throw new yf("Key size is too large");let t=Ss(r,{offset:0});return jD(t,r,e)}function jD(r,e,t){let n=FD(r);if(t==null){let o=fc(dc.encode({Type:cr.RSA,Data:e}));t=Ei(OD,o)}return new cg(n,t)}function HD(r){if(Ez(r)>ND)throw new Q("Key size is too large");let e=bz(r),t=fc(dc.encode({Type:cr.RSA,Data:BD(e.publicKey)})),n=Ei(OD,t);return new f2(e.privateKey,new cg(e.publicKey,n))}function $D(r){return f(this,null,function*(){if(r>ND)throw new Q("Key size is too large");let e=yield xz(r),t=fc(dc.encode({Type:cr.RSA,Data:BD(e.publicKey)})),n=Ei(OD,t);return new f2(e.privateKey,new cg(e.publicKey,n))})}function bz(r){if(r==null)throw new Q("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}function xz(r,e){return f(this,null,function*(){let t=yield Jr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);e?.signal?.throwIfAborted();let n=yield mme(t,e);return{privateKey:n[0],publicKey:n[1]}})}function vz(r,e,t){return f(this,null,function*(){let n=yield Jr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);t?.signal?.throwIfAborted();let o=yield Jr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)})}function wz(r,e,t,n){return f(this,null,function*(){let o=yield Jr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let i=yield Jr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,e,t instanceof Uint8Array?t:t.subarray());return n?.signal?.throwIfAborted(),i})}function mme(r,e){return f(this,null,function*(){if(r.privateKey==null||r.publicKey==null)throw new Q("Private and public key are required");let t=yield Promise.all([Jr.get().subtle.exportKey("jwk",r.privateKey),Jr.get().subtle.exportKey("jwk",r.publicKey)]);return e?.signal?.throwIfAborted(),t})}function Ez(r){if(r.kty!=="RSA")throw new Q("invalid key type");if(r.n==null)throw new Q("invalid key modulus");return ee(r.n,"base64url").length*8}var bE=class extends Wm{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Tf(e);let n=Mu(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),uo(i)}update(e){return Xm(this),this.iHash.update(e),this}digestInto(e){Xm(this),Un(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Fu=(r,e,t)=>new bE(r,e).update(t).digest();Fu.create=(r,e)=>new bE(r,e);function _z(r){r.lowS!==void 0&&gl("lowS",r.lowS),r.prehash!==void 0&&gl("prehash",r.prehash)}var zD=class extends Error{constructor(e=""){super(e)}},vl={Err:zD,_tlv:{encode:(r,e)=>{let{Err:t}=vl;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let n=e.length/2,o=e2(n);if(o.length/2&128)throw new t("tlv.encode: long form length too big");let i=n>127?e2(o.length/2|128):"";return e2(r)+i+o+e},decode(r,e){let{Err:t}=vl,n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");let o=e[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let u of l)s=s<<8|u;if(n+=c,s<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+s);if(a.length!==s)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+s)}}},_int:{encode(r){let{Err:e}=vl;if(r<h2)throw new e("integer: negative integers are not allowed");let t=e2(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=vl;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Zm(r)}},toSig(r){let{Err:e,_int:t,_tlv:n}=vl,o=Jt("signature",r),{v:i,l:s}=n.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){let{_tlv:e,_int:t}=vl,n=e.encode(2,t.encode(r.r)),o=e.encode(2,t.encode(r.s)),i=n+o;return e.encode(48,i)}},h2=BigInt(0),m2=BigInt(1),gme=BigInt(2),xE=BigInt(3),yme=BigInt(4);function vme(r,e,t){function n(o){let i=r.sqr(o),s=r.mul(i,o);return r.add(r.add(s,r.mul(o,e)),t)}return n}function Sz(r,e,t){let{BYTES:n}=r;function o(i){let s;if(typeof i=="bigint")s=i;else{let a=Jt("private key",i);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{s=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof i}`)}}if(t&&(s=r.create(s)),!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}return o}function wme(r,e={}){let{Fp:t,Fn:n}=hE("weierstrass",r,e),{h:o,n:i}=r;lc(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:s}=e;if(s&&(!t.is0(r.a)||typeof s.beta!="bigint"||typeof s.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(U,P,R){let{x:N,y:j}=P.toAffine(),V=t.toBytes(N);if(gl("isCompressed",R),R){a();let Z=!t.isOdd(j);return Vi(Cz(Z),V)}else return Vi(Uint8Array.of(4),V,t.toBytes(j))}function l(U){Un(U);let P=t.BYTES,R=P+1,N=2*P+1,j=U.length,V=U[0],Z=U.subarray(1);if(j===R&&(V===2||V===3)){let X=t.fromBytes(Z);if(!t.isValid(X))throw new Error("bad point: is not on curve, wrong x");let te=h(X),ce;try{ce=t.sqrt(te)}catch(Ue){let Ce=Ue instanceof Error?": "+Ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ce)}a();let fe=t.isOdd(ce);return(V&1)===1!==fe&&(ce=t.neg(ce)),{x:X,y:ce}}else if(j===N&&V===4){let X=t.fromBytes(Z.subarray(P*0,P*1)),te=t.fromBytes(Z.subarray(P*1,P*2));if(!p(X,te))throw new Error("bad point: is not on curve");return{x:X,y:te}}else throw new Error(`bad point: got length ${j}, expected compressed=${R} or uncompressed=${N}`)}let u=e.toBytes||c,d=e.fromBytes||l,h=vme(t,r.a,r.b);function p(U,P){let R=t.sqr(P),N=h(U);return t.eql(R,N)}if(!p(r.Gx,r.Gy))throw new Error("bad curve params: generator point");let m=t.mul(t.pow(r.a,xE),yme),w=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(m,w)))throw new Error("bad curve params: a or b");function E(U,P,R=!1){if(!t.isValid(P)||R&&t.is0(P))throw new Error(`bad point coordinate ${U}`);return P}function S(U){if(!(U instanceof F))throw new Error("ProjectivePoint expected")}let A=Jm((U,P)=>{let{px:R,py:N,pz:j}=U;if(t.eql(j,t.ONE))return{x:R,y:N};let V=U.is0();P==null&&(P=V?t.ONE:t.inv(j));let Z=t.mul(R,P),X=t.mul(N,P),te=t.mul(j,P);if(V)return{x:t.ZERO,y:t.ZERO};if(!t.eql(te,t.ONE))throw new Error("invZ was invalid");return{x:Z,y:X}}),M=Jm(U=>{if(U.is0()){if(e.allowInfinityPoint&&!t.is0(U.py))return;throw new Error("bad point: ZERO")}let{x:P,y:R}=U.toAffine();if(!t.isValid(P)||!t.isValid(R))throw new Error("bad point: x or y not field elements");if(!p(P,R))throw new Error("bad point: equation left != right");if(!U.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function L(U,P,R,N,j){return R=new F(t.mul(R.px,U),R.py,R.pz),P=eg(N,P),R=eg(j,R),P.add(R)}class F{constructor(P,R,N){this.px=E("x",P),this.py=E("y",R,!0),this.pz=E("z",N),Object.freeze(this)}static fromAffine(P){let{x:R,y:N}=P||{};if(!P||!t.isValid(R)||!t.isValid(N))throw new Error("invalid affine point");if(P instanceof F)throw new Error("projective point not allowed");return t.is0(R)&&t.is0(N)?F.ZERO:new F(R,N,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(P){return dE(F,"pz",P)}static fromBytes(P){return Un(P),F.fromHex(P)}static fromHex(P){let R=F.fromAffine(d(Jt("pointHex",P)));return R.assertValidity(),R}static fromPrivateKey(P){let R=Sz(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return F.BASE.multiply(R(P))}static msm(P,R){return pE(F,n,P,R)}precompute(P=8,R=!0){return H.setWindowSize(this,P),R||this.multiply(xE),this}_setWindowSize(P){this.precompute(P)}assertValidity(){M(this)}hasEvenY(){let{y:P}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(P)}equals(P){S(P);let{px:R,py:N,pz:j}=this,{px:V,py:Z,pz:X}=P,te=t.eql(t.mul(R,X),t.mul(V,j)),ce=t.eql(t.mul(N,X),t.mul(Z,j));return te&&ce}negate(){return new F(this.px,t.neg(this.py),this.pz)}double(){let{a:P,b:R}=r,N=t.mul(R,xE),{px:j,py:V,pz:Z}=this,X=t.ZERO,te=t.ZERO,ce=t.ZERO,fe=t.mul(j,j),ue=t.mul(V,V),Ue=t.mul(Z,Z),Ce=t.mul(j,V);return Ce=t.add(Ce,Ce),ce=t.mul(j,Z),ce=t.add(ce,ce),X=t.mul(P,ce),te=t.mul(N,Ue),te=t.add(X,te),X=t.sub(ue,te),te=t.add(ue,te),te=t.mul(X,te),X=t.mul(Ce,X),ce=t.mul(N,ce),Ue=t.mul(P,Ue),Ce=t.sub(fe,Ue),Ce=t.mul(P,Ce),Ce=t.add(Ce,ce),ce=t.add(fe,fe),fe=t.add(ce,fe),fe=t.add(fe,Ue),fe=t.mul(fe,Ce),te=t.add(te,fe),Ue=t.mul(V,Z),Ue=t.add(Ue,Ue),fe=t.mul(Ue,Ce),X=t.sub(X,fe),ce=t.mul(Ue,ue),ce=t.add(ce,ce),ce=t.add(ce,ce),new F(X,te,ce)}add(P){S(P);let{px:R,py:N,pz:j}=this,{px:V,py:Z,pz:X}=P,te=t.ZERO,ce=t.ZERO,fe=t.ZERO,ue=r.a,Ue=t.mul(r.b,xE),Ce=t.mul(R,V),ae=t.mul(N,Z),pt=t.mul(j,X),zt=t.add(R,N),He=t.add(V,Z);zt=t.mul(zt,He),He=t.add(Ce,ae),zt=t.sub(zt,He),He=t.add(R,j);let er=t.add(V,X);return He=t.mul(He,er),er=t.add(Ce,pt),He=t.sub(He,er),er=t.add(N,j),te=t.add(Z,X),er=t.mul(er,te),te=t.add(ae,pt),er=t.sub(er,te),fe=t.mul(ue,He),te=t.mul(Ue,pt),fe=t.add(te,fe),te=t.sub(ae,fe),fe=t.add(ae,fe),ce=t.mul(te,fe),ae=t.add(Ce,Ce),ae=t.add(ae,Ce),pt=t.mul(ue,pt),He=t.mul(Ue,He),ae=t.add(ae,pt),pt=t.sub(Ce,pt),pt=t.mul(ue,pt),He=t.add(He,pt),Ce=t.mul(ae,He),ce=t.add(ce,Ce),Ce=t.mul(er,He),te=t.mul(zt,te),te=t.sub(te,Ce),Ce=t.mul(zt,ae),fe=t.mul(er,fe),fe=t.add(fe,Ce),new F(te,ce,fe)}subtract(P){return this.add(P.negate())}is0(){return this.equals(F.ZERO)}multiply(P){let{endo:R}=e;if(!n.isValidNot0(P))throw new Error("invalid scalar: out of range");let N,j,V=Z=>H.wNAFCached(this,Z,F.normalizeZ);if(R){let{k1neg:Z,k1:X,k2neg:te,k2:ce}=R.splitScalar(P),{p:fe,f:ue}=V(X),{p:Ue,f:Ce}=V(ce);j=ue.add(Ce),N=L(R.beta,fe,Ue,Z,te)}else{let{p:Z,f:X}=V(P);N=Z,j=X}return F.normalizeZ([N,j])[0]}multiplyUnsafe(P){let{endo:R}=e,N=this;if(!n.isValid(P))throw new Error("invalid scalar: out of range");if(P===h2||N.is0())return F.ZERO;if(P===m2)return N;if(H.hasPrecomputes(this))return this.multiply(P);if(R){let{k1neg:j,k1:V,k2neg:Z,k2:X}=R.splitScalar(P),{p1:te,p2:ce}=Y$(F,N,V,X);return L(R.beta,te,ce,j,Z)}else return H.wNAFCachedUnsafe(N,P)}multiplyAndAddUnsafe(P,R,N){let j=this.multiplyUnsafe(R).add(P.multiplyUnsafe(N));return j.is0()?void 0:j}toAffine(P){return A(this,P)}isTorsionFree(){let{isTorsionFree:P}=e;return o===m2?!0:P?P(F,this):H.wNAFCachedUnsafe(this,i).is0()}clearCofactor(){let{clearCofactor:P}=e;return o===m2?this:P?P(F,this):this.multiplyUnsafe(o)}toBytes(P=!0){return gl("isCompressed",P),this.assertValidity(),u(F,this,P)}toRawBytes(P=!0){return this.toBytes(P)}toHex(P=!0){return sc(this.toBytes(P))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}F.BASE=new F(r.Gx,r.Gy,t.ONE),F.ZERO=new F(t.ZERO,t.ONE,t.ZERO),F.Fp=t,F.Fn=n;let Y=n.BITS,H=fE(F,e.endo?Math.ceil(Y/2):Y);return F}function Cz(r){return Uint8Array.of(r?2:3)}function bme(r,e,t={}){lc(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=e.randomBytes||hl,o=e.hmac||((N,...j)=>Fu(e.hash,N,Vi(...j))),{Fp:i,Fn:s}=r,{ORDER:a,BITS:c}=s;function l(N){let j=a>>m2;return N>j}function u(N){return l(N)?s.neg(N):N}function d(N,j){if(!s.isValidNot0(j))throw new Error(`invalid signature ${N}: out of range 1..CURVE.n`)}class h{constructor(j,V,Z){d("r",j),d("s",V),this.r=j,this.s=V,Z!=null&&(this.recovery=Z),Object.freeze(this)}static fromCompact(j){let V=s.BYTES,Z=Jt("compactSignature",j,V*2);return new h(s.fromBytes(Z.subarray(0,V)),s.fromBytes(Z.subarray(V,V*2)))}static fromDER(j){let{r:V,s:Z}=vl.toSig(Jt("DER",j));return new h(V,Z)}assertValidity(){}addRecoveryBit(j){return new h(this.r,this.s,j)}recoverPublicKey(j){let V=i.ORDER,{r:Z,s:X,recovery:te}=this;if(te==null||![0,1,2,3].includes(te))throw new Error("recovery id invalid");if(a*gme<V&&te>1)throw new Error("recovery id is ambiguous for h>1 curve");let fe=te===2||te===3?Z+a:Z;if(!i.isValid(fe))throw new Error("recovery id 2 or 3 invalid");let ue=i.toBytes(fe),Ue=r.fromHex(Vi(Cz((te&1)===0),ue)),Ce=s.inv(fe),ae=M(Jt("msgHash",j)),pt=s.create(-ae*Ce),zt=s.create(X*Ce),He=r.BASE.multiplyUnsafe(pt).add(Ue.multiplyUnsafe(zt));if(He.is0())throw new Error("point at infinify");return He.assertValidity(),He}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,s.neg(this.s),this.recovery):this}toBytes(j){if(j==="compact")return Vi(s.toBytes(this.r),s.toBytes(this.s));if(j==="der")return Qm(vl.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return sc(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return sc(this.toBytes("compact"))}}let p=Sz(s,t.allowedPrivateKeyLengths,t.wrapPrivateKey),m={isValidPrivateKey(N){try{return p(N),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let N=a;return $$(n(uD(N)),N)},precompute(N=8,j=r.BASE){return j.precompute(N,!1)}};function w(N,j=!0){return r.fromPrivateKey(N).toBytes(j)}function E(N){if(typeof N=="bigint")return!1;if(N instanceof r)return!0;let V=Jt("key",N).length,Z=i.BYTES,X=Z+1,te=2*Z+1;if(!(t.allowedPrivateKeyLengths||s.BYTES===X))return V===X||V===te}function S(N,j,V=!0){if(E(N)===!0)throw new Error("first arg must be private key");if(E(j)===!1)throw new Error("second arg must be public key");return r.fromHex(j).multiply(p(N)).toBytes(V)}let A=e.bits2int||function(N){if(N.length>8192)throw new Error("input is too large");let j=Zm(N),V=N.length*8-c;return V>0?j>>BigInt(V):j},M=e.bits2int_modN||function(N){return s.create(A(N))},L=Nf(c);function F(N){return da("num < 2^"+c,N,h2,L),s.toBytes(N)}function Y(N,j,V=H){if(["recovered","canonical"].some(zt=>zt in V))throw new Error("sign() legacy options not supported");let{hash:Z}=e,{lowS:X,prehash:te,extraEntropy:ce}=V;X==null&&(X=!0),N=Jt("msgHash",N),_z(V),te&&(N=Jt("prehashed msgHash",Z(N)));let fe=M(N),ue=p(j),Ue=[F(ue),F(fe)];if(ce!=null&&ce!==!1){let zt=ce===!0?n(i.BYTES):ce;Ue.push(Jt("extraEntropy",zt))}let Ce=Vi(...Ue),ae=fe;function pt(zt){let He=A(zt);if(!s.isValidNot0(He))return;let er=s.inv(He),Jn=r.BASE.multiply(He).toAffine(),sn=s.create(Jn.x);if(sn===h2)return;let an=s.create(er*s.create(ae+sn*ue));if(an===h2)return;let Pn=(Jn.x===sn?0:2)|Number(Jn.y&m2),Ji=an;return X&&l(an)&&(Ji=u(an),Pn^=1),new h(sn,Ji,Pn)}return{seed:Ce,k2sig:pt}}let H={lowS:e.lowS,prehash:!1},U={lowS:e.lowS,prehash:!1};function P(N,j,V=H){let{seed:Z,k2sig:X}=Y(N,j,V);return R$(e.hash.outputLen,s.BYTES,o)(Z,X)}r.BASE.precompute(8);function R(N,j,V,Z=U){let X=N;j=Jt("msgHash",j),V=Jt("publicKey",V),_z(Z);let{lowS:te,prehash:ce,format:fe}=Z;if("strict"in Z)throw new Error("options.strict was renamed to lowS");if(fe!==void 0&&!["compact","der","js"].includes(fe))throw new Error('format must be "compact", "der" or "js"');let ue=typeof X=="string"||Ym(X),Ue=!ue&&!fe&&typeof X=="object"&&X!==null&&typeof X.r=="bigint"&&typeof X.s=="bigint";if(!ue&&!Ue)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Ce,ae;try{if(Ue)if(fe===void 0||fe==="js")Ce=new h(X.r,X.s);else throw new Error("invalid format");if(ue){try{fe!=="compact"&&(Ce=h.fromDER(X))}catch(Ji){if(!(Ji instanceof vl.Err))throw Ji}!Ce&&fe!=="der"&&(Ce=h.fromCompact(X))}ae=r.fromHex(V)}catch{return!1}if(!Ce||te&&Ce.hasHighS())return!1;ce&&(j=e.hash(j));let{r:pt,s:zt}=Ce,He=M(j),er=s.inv(zt),Jn=s.create(He*er),sn=s.create(pt*er),an=r.BASE.multiplyUnsafe(Jn).add(ae.multiplyUnsafe(sn));return an.is0()?!1:s.create(an.x)===pt}return Object.freeze({getPublicKey:w,getSharedSecret:S,sign:P,verify:R,utils:m,Point:r,Signature:h})}function xme(r){let e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=fa(e.n,r.nBitLength),o={Fp:t,Fn:n,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:o}}function Eme(r){let{CURVE:e,curveOpts:t}=xme(r),n={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:n}}function _me(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function Iz(r){let{CURVE:e,curveOpts:t,ecdsaOpts:n}=Eme(r),o=wme(e,t),i=bme(o,n,t);return _me(r,i)}function Az(r,e){let t=n=>Iz(I(v({},r),{hash:n}));return I(v({},t(e)),{create:t})}var EE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Fze=BigInt(0),Sme=BigInt(1),qD=BigInt(2),Dz=(r,e)=>(r+e/qD)/e;function Cme(r){let e=EE.p,t=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,d=ar(u,t,e)*u%e,h=ar(d,t,e)*u%e,p=ar(h,qD,e)*l%e,m=ar(p,o,e)*p%e,w=ar(m,i,e)*m%e,E=ar(w,a,e)*w%e,S=ar(E,c,e)*E%e,A=ar(S,a,e)*w%e,M=ar(A,t,e)*u%e,L=ar(M,s,e)*m%e,F=ar(L,n,e)*l%e,Y=ar(F,qD,e);if(!KD.eql(KD.sqr(Y),r))throw new Error("Cannot find square root");return Y}var KD=fa(EE.p,void 0,void 0,{sqrt:Cme}),ma=Az(I(v({},EE),{Fp:KD,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let e=EE.n,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Sme*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,s=BigInt("0x100000000000000000000000000000000"),a=Dz(i*r,e),c=Dz(-n*r,e),l=rr(r-a*t-c*o,e),u=rr(-a*n-c*i,e),d=l>s,h=u>s;if(d&&(l=e-l),h&&(u=e-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:d,k1:l,k2neg:h,k2:u}}}}),cE);var Tz=32;function Pz(r,e,t){let n=xt.digest(e instanceof Uint8Array?e:e.subarray());if(og(n))return n.then(({digest:o})=>(t?.signal?.throwIfAborted(),ma.sign(o,r).toDERRawBytes())).catch(o=>{throw o.name==="AbortError"?o:new Ky(String(o))});try{return ma.sign(n.digest,r).toDERRawBytes()}catch(o){throw new Ky(String(o))}}function Mz(r,e,t,n){let o=xt.digest(t instanceof Uint8Array?t:t.subarray());if(og(o))return o.then(({digest:i})=>(n?.signal?.throwIfAborted(),ma.verify(e,i,r))).catch(i=>{throw i.name==="AbortError"?i:new Gy(String(i))});try{return n?.signal?.throwIfAborted(),ma.verify(e,o.digest,r)}catch(i){throw new Gy(String(i))}}var g2=class{type="secp256k1";raw;_key;constructor(e){this._key=Nz(e),this.raw=kz(this._key)}toMultihash(){return En.digest(Sn(this))}toCID(){return le.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}verify(e,t,n){return Mz(this._key,t,e,n)}},y2=class{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=Rz(e),this.publicKey=new g2(t??Oz(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Le(this.raw,e.raw)}sign(e,t){return Pz(this.raw,e,t)}};function GD(r){return new y2(r)}function WD(r){return new g2(r)}function Lz(){return f(this,null,function*(){let r=Ime();return new y2(r)})}function kz(r){return ma.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Rz(r){try{return ma.getPublicKey(r,!0),r}catch(e){throw new J9(String(e))}}function Nz(r){try{return ma.ProjectivePoint.fromHex(r),r}catch(e){throw new yf(String(e))}}function Oz(r){try{return ma.getPublicKey(r,!0)}catch(e){throw new J9(String(e))}}function Ime(){return ma.utils.randomPrivateKey()}function lg(r,e){return f(this,null,function*(){if(r==="Ed25519")return az();if(r==="secp256k1")return Lz();if(r==="RSA")return $D(Ame(e));if(r==="ECDSA")return m$(Dme(e));throw new il})}function Hr(r,e){let{Type:t,Data:n}=dc.decode(r),o=n??new Uint8Array;switch(t){case cr.RSA:return VD(o,e);case cr.Ed25519:return yD(o);case cr.secp256k1:return WD(o);case cr.ECDSA:return tD(o);default:throw new il}}function _E(r){let{Type:e,Data:t}=dc.decode(r.digest),n=t??new Uint8Array;switch(e){case cr.Ed25519:return yD(n);case cr.secp256k1:return WD(n);case cr.ECDSA:return tD(n);default:throw new il}}function Sn(r){return dc.encode({Type:cr[r.type],Data:r.raw})}function Fz(r){let e=d2.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case cr.RSA:return UD(t);case cr.Ed25519:return gD(t);case cr.secp256k1:return GD(t);case cr.ECDSA:return u$(t);default:throw new il}}function Bz(r){if(r.byteLength===ji)return gD(r);if(r.byteLength===Tz)return GD(r);let e=Ss(r),t=e[2]?.[0];if(t===t$||t===r$||t===n$)return eD(e);if(e.length>8)return wE(e);throw new Q("Could not extract private key from raw bytes")}function Vf(r){return d2.encode({Type:cr[r.type],Data:r.raw})}function Ame(r){return r==null?2048:parseInt(r,10)}function Dme(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Q("Unsupported curve, should be P-256, P-384 or P-521")}function SE(r){return f(this,null,function*(){if(r.type==="RSA")return{privateKey:yield crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:yield crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:yield crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:yield crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Q("Only RSA and ECDSA keys are supported")})}function Uz(r,e,t,n){Tf(r);let o=b$({dkLen:32,asyncTick:10},n),{c:i,dkLen:s,asyncTick:a}=o;if(la(i),la(s),la(a),i<1)throw new Error("iterations (c) should be >= 1");let c=nD(e),l=nD(t),u=new Uint8Array(s),d=Fu.create(r,c),h=d._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:a,DK:u,PRF:d,PRFSalt:h}}function Vz(r,e,t,n,o){return r.destroy(),e.destroy(),n&&n.destroy(),uo(o),t}function jz(r,e,t,n){let{c:o,dkLen:i,DK:s,PRF:a,PRFSalt:c}=Uz(r,e,t,n),l,u=new Uint8Array(4),d=Pf(u),h=new Uint8Array(a.outputLen);for(let p=1,m=0;m<i;p++,m+=a.outputLen){let w=s.subarray(m,m+a.outputLen);d.setInt32(0,p,!1),(l=c._cloneInto(l)).update(u).digestInto(h),w.set(h.subarray(0,w.length));for(let E=1;E<o;E++){a._cloneInto(l).update(h).digestInto(h);for(let S=0;S<w.length;S++)w[S]^=h[S]}}return Vz(a,c,s,l,h)}function CE(r,e,t,n){return f(this,null,function*(){let{c:o,dkLen:i,asyncTick:s,DK:a,PRF:c,PRFSalt:l}=Uz(r,e,t,n),u,d=new Uint8Array(4),h=Pf(d),p=new Uint8Array(c.outputLen);for(let m=1,w=0;w<i;m++,w+=c.outputLen){let E=a.subarray(w,w+c.outputLen);h.setInt32(0,m,!1),(u=l._cloneInto(u)).update(d).digestInto(p),E.set(p.subarray(0,E.length)),yield w$(o-1,s,()=>{c._cloneInto(u).update(p).digestInto(p);for(let S=0;S<E.length;S++)E[S]^=p[S]})}return Vz(c,l,a,u,p)})}var v2=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Bu=new Uint32Array(80),IE=class extends Mf{constructor(){super(64,20,8,!1),this.A=v2[0]|0,this.B=v2[1]|0,this.C=v2[2]|0,this.D=v2[3]|0,this.E=v2[4]|0}get(){let{A:e,B:t,C:n,D:o,E:i}=this;return[e,t,n,o,i]}set(e,t,n,o,i){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0}process(e,t){for(let c=0;c<16;c++,t+=4)Bu[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)Bu[c]=rE(Bu[c-3]^Bu[c-8]^Bu[c-14]^Bu[c-16],1);let{A:n,B:o,C:i,D:s,E:a}=this;for(let c=0;c<80;c++){let l,u;c<20?(l=nE(o,i,s),u=1518500249):c<40?(l=o^i^s,u=1859775393):c<60?(l=oE(o,i,s),u=2400959708):(l=o^i^s,u=3395469782);let d=rE(n,5)+l+a+u+Bu[c]|0;a=s,s=i,i=rE(o,30),o=n,n=d}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,this.set(n,o,i,s,a)}roundClean(){uo(Bu)}destroy(){this.set(0,0,0,0,0),uo(this.buffer)}},Hz=Qy(()=>new IE);var $z=Hz;var ug=lE;var zz={sha1:$z,"sha2-256":fc,"sha2-512":ug};function w2(r,e,t,n,o){if(o!=="sha1"&&o!=="sha2-256"&&o!=="sha2-512"){let a=Object.keys(zz).join(" / ");throw new Q(`Hash '${o}' is unknown or not supported. Must be ${a}`)}let i=zz[o],s=jz(i,r,e,{c:t,dkLen:n});return Qr.encode(s).substring(1)}var YD={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},qz={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Kz=new globalThis.TextEncoder;function Tme(r,e){let t=YD[e],n=qz[e];for(let o=0;o<r.length;o++)n^=BigInt(r[o]),n=BigInt.asUintN(e,n*t);return n}function Pme(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");let n=YD[e],o=qz[e],i=r;for(;i.length>0;){let s=Kz.encodeInto(i,t);i=i.slice(s.read);for(let a=0;a<s.written;a++)o^=BigInt(t[a]),o=BigInt.asUintN(e,o*n)}return o}function XD(r,{size:e=32,utf8Buffer:t}={}){if(!YD[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return Pme(r,e,t);r=Kz.encode(r)}return Tme(r,e)}var b2={hash:r=>Number(XD(r,{size:32})),hashV:(r,e)=>Mme(b2.hash(r,e))};function Mme(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),ee(e,"base16")}var QD=64,ga=class{fp;h;seed;constructor(e,t,n,o=2){if(o>QD)throw new TypeError("Invalid Fingerprint Size");let i=t.hashV(e,n),s=et(o);for(let a=0;a<s.length;a++)s[a]=i[a];s.length===0&&(s[0]=7),this.fp=s,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?Le(this.fp,e.fp):!1}};function jf(r,e){return Math.floor(Math.random()*(e-r))+r}var Hf=class{contents;constructor(e){this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof ga))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof ga))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof ga))throw new TypeError("Invalid Fingerprint");let t=jf(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof ga))throw new TypeError("Invalid Fingerprint");let t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}};var kme=500,x2=class{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??b2,this.seed=e.seed??jf(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=ee(e));let t=new ga(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Hf(this.bucketSize)),this.buckets[o]==null&&(this.buckets[o]=new Hf(this.bucketSize)),this.buckets[n].add(t)||this.buckets[o].add(t))return this.count++,!0;let i=[n,o],s=i[jf(0,i.length-1)];this.buckets[s]==null&&(this.buckets[s]=new Hf(this.bucketSize));for(let a=0;a<kme;a++){let c=this.buckets[s].swap(t);if(c!=null&&(s=(s^c.hash())%this.filterSize,this.buckets[s]==null&&(this.buckets[s]=new Hf(this.bucketSize)),this.buckets[s].add(c)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=ee(e));let t=new ga(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=this.buckets[n]?.has(t)??!1;if(o)return o;let i=(n^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){typeof e=="string"&&(e=ee(e));let t=new ga(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=this.buckets[n]?.remove(t)??!1;if(o)return this.count--,o;let i=(n^t.hash())%this.filterSize,s=this.buckets[i]?.remove(t)??!1;return s&&this.count--,s}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}},Rme={1:.5,2:.84,4:.95,8:.98};function Nme(r=.001){return r>.002?2:r>1e-5?4:8}function Gz(r,e=.001){let t=Nme(e),n=Rme[t],o=Math.round(r/n),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),QD);return{filterSize:o,bucketSize:t,fingerprintSize:i}}var dg=class{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??b2,this.seed=e.seed??jf(0,Math.pow(2,10)),this.filterSeries=[new x2({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=ee(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){let n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new x2({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=ee(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=ee(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}};function ho(r,e=.001,t){return new dg(v(v({},Gz(r,e)),t??{}))}var $f=class extends st{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??1,this.maxProviders=t.maxProviders??5,this.providers=[],this.evictionFilter=ho(this.maxProviders),this.initialProviders=t.providers??[]}retrieve(n){return f(this,arguments,function*(e,t={}){let o=Qr.encode(e.multihash.bytes),i=this.requests.get(o);if(i!=null)return this.log("join existing request for %c",e),i;let s=Ye();if(this.requests.set(o,s.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.initialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),yield this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",e)}let a=!1,c=new Ln({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,s.resolve(d.detail.result)}),c.addEventListener("idle",()=>{if(a||t.signal?.aborted===!0){this.log.trace("session idle, found block");return}Promise.resolve().then(()=>f(this,null,function*(){this.log("no session peers had block for for %c, finding new providers",e);for(let d=0;d<this.minProviders&&this.providers.length!==0;d++){let h=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(h)}yield this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(o),s.resolve(yield this.retrieve(e,t))})).catch(d=>{this.log.error("could not find new providers for %c",e,d),s.reject(d)})});let l=d=>{c.add(()=>f(this,null,function*(){return this.queryProvider(e,d.detail,t)}),{provider:d.detail}).catch(h=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(d=>f(this,null,function*(){return c.add(()=>f(this,null,function*(){return this.queryProvider(e,d,t)}),{provider:d})}))).catch(d=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,d)});let u=()=>{s.reject(new Nn(t.signal?.reason??"Session aborted")),c.abort()};t.signal?.addEventListener("abort",u);try{return yield s.promise}finally{this.removeEventListener("provider",l),t.signal?.removeEventListener("abort",u),c.clear(),this.requests.delete(o)}})}evict(e){this.evictionFilter.add(this.toEvictionKey(e));let t=this.providers.findIndex(n=>this.equals(n,e));t!==-1&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(this.providers.find(t=>this.equals(t,e))!=null||this.isEvicted(e))}findProviders(e,t,n){return f(this,null,function*(){let o=Ye(),i=0;return Promise.resolve().then(()=>f(this,null,function*(){if(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.initialProviders.length>0)for(;i<t&&this.initialProviders.length>0;){let u=this.initialProviders.pop();if(u==null)break;let d=yield this.convertToProvider(u,n);if(n.signal?.aborted===!0)break;if(d!=null&&!this.hasProvider(d)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(d),this.safeDispatchEvent("provider",{detail:d}),i++,i===t&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(i<this.maxProviders)try{for(var s=O(this.findNewProviders(e,n)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;if(i===this.maxProviders||n.signal?.aborted===!0)break;if(!this.hasProvider(u)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(u),this.safeDispatchEvent("provider",{detail:u}),i++,i===t&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new xH(`Found ${i} of ${t} ${this.name} providers for ${e}`)})).catch(s=>{this.log.error("error searching routing for potential session peers for %c",e,s.errors??s),o.reject(s)}),o.promise})}};var AE=class{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??Cu(),this.log=this.logger.forComponent("helia"),this.getHasher=GH(e.hashers,e.loadHasher),this.getCodec=KH(e.codecs,e.loadCodec),this.dns=e.dns??ix(),this.metrics=e.metrics;let t=v({blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics},e.components??{});this.routing=t.routing=new Tx(t,{routers:(e.routers??[]).flatMap(o=>{let i=[o];return o[rc]!=null&&i.push(o[rc]),o[nc]!=null&&i.push(o[nc]),i}),providerLookupConcurrency:e.providerLookupConcurrency});let n=new Jx(t);this.pins=new Ax(e.datastore,n,this.getCodec),this.blockstore=new qx(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(o=>o(t))}start(){return f(this,null,function*(){yield MH(this.datastore),yield On(this.blockstore,this.datastore,this.routing)})}stop(){return f(this,null,function*(){yield ao(this.blockstore,this.datastore,this.routing)})}gc(){return f(this,arguments,function*(e={}){let t=yield this.blockstore.lock.writeLock();try{let n=this,o=this.blockstore.unwrap();this.log("gc start"),yield ei(o.deleteMany(function(){return k(this,null,function*(){try{for(var i=O(o.getAll()),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let{cid:l}=a.value;try{if(yield new C(n.pins.isPinned(l,e)))continue;yield l,e.onProgress?.(new pe("helia:gc:deleted",l))}catch(u){n.log.error("Error during gc",u),e.onProgress?.(new pe("helia:gc:error",u))}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}})}()))}finally{t()}this.log("gc finished")})}};var DE=class r extends AE{libp2p;constructor(e){super(I(v({},e),{components:{libp2p:e.libp2p}})),this.libp2p=e.libp2p}start(){return f(this,null,function*(){yield es(r.prototype,this,"start").call(this),yield this.libp2p.start()})}stop(){return f(this,null,function*(){yield es(r.prototype,this,"stop").call(this),yield this.libp2p.stop()})}};var TE=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},fg=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},PE=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},E2=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function ME(r){return r[Symbol.asyncIterator]!=null}function Wz(r,e){if(r.byteLength>e)throw new fg("Message length too long")}var RE=r=>{let e=It(r),t=br(e);return In(r,t),RE.bytes=e,t};RE.bytes=0;function wl(r,e){e=e??{};let t=e.lengthEncoder??RE,n=e?.maxDataLength??4194304;function*o(i){Wz(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*J(s),i instanceof Uint8Array?yield i:yield*J(i)}return ME(r)?function(){return k(this,null,function*(){try{for(var i=O(r),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let l=a.value;yield*J(o(l))}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}})}():function*(){for(let i of r)yield*J(o(i))}()}wl.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??RE,n=e?.maxDataLength??4194304;return Wz(r,n),new Ke(t(r.byteLength),r)};var pg=function(r){return r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA",r}(pg||{}),ZD=r=>{let e=pa(r);return ZD.bytes=It(e),e};ZD.bytes=0;function bl(r,e){let t=new Ke,n=pg.LENGTH,o=-1,i=e?.lengthDecoder??ZD,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===pg.LENGTH)try{if(o=i(t),o<0)throw new TE("Invalid message length");if(o>a)throw new fg("Message length too long");let l=i.bytes;t.consume(l),e?.onLength!=null&&e.onLength(o),n=pg.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>s)throw new PE("Message length length too long");break}throw l}if(n===pg.DATA){if(t.byteLength<o)break;let l=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(l),yield l,n=pg.LENGTH}}}return ME(r)?function(){return k(this,null,function*(){try{for(var l=O(r),u,d,h;u=!(d=yield new C(l.next())).done;u=!1){let p=d.value;t.append(p),yield*J(c())}}catch{h=[d]}finally{try{u&&(d=l.return)&&(yield new C(d.call(l)))}finally{if(h)throw h[0]}}if(t.byteLength>0)throw new E2("Unexpected end of input")})}():function*(){for(let l of r)t.append(l),yield*J(c());if(t.byteLength>0)throw new E2("Unexpected end of input")}()}bl.fromReader=(r,e)=>{let t=1,n=function(){return k(this,null,function*(){for(;;)try{let{done:i,value:s}=yield new C(r.next(t));if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}})}(),o=i=>{t=i};return bl(n,I(v({},e??{}),{onLength:o}))};function Bme(r){return r[Symbol.asyncIterator]!=null}function Ume(r,e){let t=0;if(Bme(r))return function(){return k(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let h=u.value;yield e(h,t++)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=$m(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=e(o,t++);if(typeof s.then=="function")return function(){return k(this,null,function*(){yield yield new C(s);for(let c of n)yield e(c,t++)})}();let a=e;return function*(){yield s;for(let c of n)yield a(c,t++)}()}var An=Ume;function fr(r,...e){if(r==null)throw new Error("Empty pipeline");if(JD(r)){let n=r;r=()=>n.source}else if(Qz(r)||Xz(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&JD(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)JD(t[n])&&(t[n]=jme(t[n]));return Vme(...t)}var Vme=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},Xz=r=>r?.[Symbol.asyncIterator]!=null,Qz=r=>r?.[Symbol.iterator]!=null,JD=r=>r==null?!1:r.sink!=null&&r.source!=null,jme=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=Zr({objectMode:!0});t.then(()=>{n.end()},s=>{n.end(s)});let o,i=r.source;if(Xz(i))o=function(){return k(this,null,function*(){yield*J(i),n.end()})};else if(Qz(i))o=function*(){yield*J(i),n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Lo(n,o())}return r.source};function Hme(r){return r[Symbol.asyncIterator]!=null}function $me(r,e){return Hme(r)?function(){return k(this,null,function*(){let t=0;if(!(e<1))try{for(var n=O(r),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;if(yield a,t++,t===e)return}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}():function*(){let t=0;if(!(e<1)){for(let n of r)if(yield n,t++,t===e)return}}()}var Uu=$me;var _2="/ipfs/bitswap/1.2.0";var en=function(r){return r.WantBlock="WantBlock",r.WantHave="WantHave",r}(en||{}),Zz=function(r){return r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave",r}(Zz||{});(function(r){r.codec=()=>nr(Zz)})(en||(en={}));var hg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),en.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={cid:et(0),priority:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.priority=t.int32();break}case 3:{i.cancel=t.bool();break}case 4:{i.wantType=en.codec().decode(t);break}case 5:{i.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(hg||(hg={}));var NE;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(let i of t.entries)n.uint32(10),hg.codec().encode(i,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={entries:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.entries!=null&&i.entries.length===o.limits.entries)throw new Wt('Decode error - map field "entries" had too many elements');i.entries.push(hg.codec().decode(t,t.uint32(),{limits:o.limits?.entries$}));break}case 2:{i.full=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(NE||(NE={}));var mg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={prefix:et(0),data:et(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.prefix=t.bytes();break}case 2:{i.data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(mg||(mg={}));var ya=function(r){return r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock",r}(ya||{}),eT=function(r){return r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock",r}(eT||{});(function(r){r.codec=()=>nr(eT)})(ya||(ya={}));var gg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&eT[t.type]!==0&&(n.uint32(16),ya.codec().encode(t.type,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={cid:et(0),type:ya.HaveBlock},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.type=ya.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(gg||(gg={}));var zf;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),NE.codec().encode(t.wantlist,n)),t.blocks!=null)for(let i of t.blocks)n.uint32(26),mg.codec().encode(i,n);if(t.blockPresences!=null)for(let i of t.blockPresences)n.uint32(34),gg.codec().encode(i,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={blocks:[],blockPresences:[],pendingBytes:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.wantlist=NE.codec().decode(t,t.uint32(),{limits:o.limits?.wantlist});break}case 3:{if(o.limits?.blocks!=null&&i.blocks.length===o.limits.blocks)throw new Wt('Decode error - map field "blocks" had too many elements');i.blocks.push(mg.codec().decode(t,t.uint32(),{limits:o.limits?.blocks$}));break}case 4:{if(o.limits?.blockPresences!=null&&i.blockPresences.length===o.limits.blockPresences)throw new Wt('Decode error - map field "blockPresences" had too many elements');i.blockPresences.push(gg.codec().decode(t,t.uint32(),{limits:o.limits?.blockPresences$}));break}case 5:{i.pendingBytes=t.int32();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(zf||(zf={}));function Jz(r,e){for(let[t,n]of e.wantlist.entries()){let o=r.wantlist.get(t);o!=null&&(o.priority>n.priority&&(n.priority=o.priority),n.cancel=n.cancel??o.cancel,n.wantType=n.wantType??o.wantType,n.sendDontHave=n.sendDontHave??o.sendDontHave),r.wantlist.set(t,n)}for(let[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(let[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}var eq=(()=>{class r extends Error{static name="BlockTooLargeError";constructor(t="Block too large"){super(t),this.name="BlockTooLargeError"}}return r})();var zme=4193648,qme=zme+16;function*tq(r,e){let t=[...r.wantlist.values()],n=[...r.blockPresences.values()],o=[...r.blocks.values()],i=0,s=0,a=0,c=!1;for(;;){let l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0},u=zf.encode(l).byteLength,{added:d,hasMore:h,newSize:p}=tT(o,l.blocks,a,e,u,Kme);a+=d,u=p;let m=h;({added:d,hasMore:h,newSize:p}=tT(n,l.blockPresences,s,e,u,Gme)),s+=d,u=p;let w=h;if({added:d,hasMore:h,newSize:p}=tT(t,l.wantlist.entries,i,e,u,Wme),i+=d,u=p,c=!m&&!w&&!h,c||(l.wantlist.full=!1),yield zf.encode(l),c)break}}function tT(r,e,t,n,o,i){let s=0,a=!1;for(let c=t;c<r.length;c++){let l=r[c],u=i(l);if(u>qme)throw new eq("Cannot send block as after encoding it is over the max message size");let d=o+u;if(d>n){a=!0;break}e.push(l),s++,o=d}return{hasMore:a,added:s,newSize:o}}function Kme(r){return rT(3,mg.encode(r))}function Gme(r){return rT(4,gg.encode(r))}function Wme(r){return rT(1,hg.encode(r))}function rT(r,e){let t=It(r),n=It(e.byteLength);return t+n+e.byteLength}var OE=class extends st{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(e,t={}){super(),this.log=e.logger.forComponent("helia:bitswap:network"),this.libp2p=e.libp2p,this.routing=e.routing,this.protocols=t.protocols??[_2],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=t.maxInboundStreams??1024,this.maxOutboundStreams=t.maxOutboundStreams??1024,this.messageReceiveTimeout=t.messageReceiveTimeout??5e3,this.runOnLimitedConnections=t.runOnLimitedConnections??!1,this.maxIncomingMessageSize=t.maxIncomingMessageSize??4194304,this.maxOutgoingMessageSize=t.maxOutgoingMessageSize??t.maxIncomingMessageSize??4194304,this.metrics={blocksSent:e.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:e.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new Bn({concurrency:t.messageSendConcurrency??50,metrics:e.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",n=>{this.log.error("error sending wantlist to peer",n.detail)})}start(){return f(this,null,function*(){if(this.running)return;this.running=!0,yield this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});let e={onConnect:t=>{this.safeDispatchEvent("peer:connected",{detail:t})},onDisconnect:t=>{this.safeDispatchEvent("peer:disconnected",{detail:t})}};this.registrarIds=[];for(let t of this.protocols)this.registrarIds.push(yield this.libp2p.register(t,e));this.libp2p.getConnections().forEach(t=>{this.safeDispatchEvent("peer:connected",{detail:t.remotePeer})})})}stop(){return f(this,null,function*(){if(this.running=!1,yield this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(let e of this.registrarIds)this.libp2p.unregister(e);this.registrarIds=[]}})}_onStream(e){if(!this.running)return;let{stream:t,connection:n}=e;Promise.resolve().then(()=>f(this,null,function*(){this.log("incoming new bitswap %s stream from %p",t.protocol,n.remotePeer);let o=()=>{t.status==="open"?t.abort(new oc(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",t.status)},i=AbortSignal.timeout(this.messageReceiveTimeout);i.addEventListener("abort",o),yield t.closeWrite(),yield fr(t,s=>bl(s,{maxDataLength:this.maxIncomingMessageSize}),s=>f(this,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield a.next()).done;c=!1){let d=l.value;try{let h=zf.decode(d);this.log("incoming new bitswap %s message from %p on stream",t.protocol,n.remotePeer,t.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:n.remotePeer,message:h}}),i.removeEventListener("abort",o),i=AbortSignal.timeout(this.messageReceiveTimeout),i.addEventListener("abort",o)}catch(h){this.log.error("error reading incoming bitswap message from %p on stream",n.remotePeer,t.id,h),t.abort(h);break}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}}))})).catch(o=>{this.log.error("error handling incoming stream from %p",n.remotePeer,o),t.abort(o)})}findProviders(e,t){return k(this,null,function*(){t?.onProgress?.(new pe("bitswap:network:find-providers",e));try{for(var n=O(this.routing.findProviders(e,t)),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;(yield new C(this.libp2p.isDialable(a.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})))&&(yield a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}findAndConnect(e,t){return f(this,null,function*(){t?.providers!=null&&(yield Promise.all(t.providers.map(n=>f(this,null,function*(){return this.connectTo(n).catch(o=>{this.log.error("could not connect to supplied provider - %e",o)})})))),yield ei(An(Uu(this.findProviders(e,t),t?.maxProviders??3),n=>f(this,null,function*(){return this.connectTo(n.id,t)}))).catch(n=>{this.log.error(n)})})}sendMessage(e,t,n){return f(this,null,function*(){if(!this.running)throw new Error("network isn't running");let o=this.sendQueue.queue.find(i=>e.equals(i.options.peerId)&&i.status==="queued");if(o!=null){o.options.message=Jz(o.options.message,t),yield o.join({signal:n?.signal});return}yield this.sendQueue.add(i=>f(this,null,function*(){let s=i?.message;if(s==null)throw new Q("No message to send");this.log("sendMessage to %p",e),i?.onProgress?.(new pe("bitswap:network:send-wantlist",e));let a=yield this.libp2p.dialProtocol(e,_2,i);yield a.closeRead();try{yield fr(tq(s,this.maxOutgoingMessageSize),c=>wl(c),a),yield a.close(i)}catch(c){i?.onProgress?.(new pe("bitswap:network:send-wantlist:error",{peer:e,error:c})),this.log.error("error sending message to %p",e,c),a.abort(c)}this._updateSentStats(s.blocks)}),{peerId:e,signal:n?.signal,message:t})})}connectTo(e,t){return f(this,null,function*(){if(!this.running)throw new na("Network isn't running");t?.onProgress?.(new pe("bitswap:network:dial",e));let[n]=yield Promise.all([this.libp2p.dial(e,t),Mr(this.libp2p,"peer:identify",t?.signal,{filter:o=>{if(!o.detail.peerId.equals(e))return!1;if(o.detail.protocols.includes(_2))return!0;throw new vf(`${e} did not support ${_2}`)}})]);return n})}_updateSentStats(e){let t=0;for(let n of e.values())t+=n.data.byteLength;this.metrics.dataSent?.increment(t),this.metrics.blocksSent?.increment(e.size)}};var rq=Symbol.for("nodejs.util.inspect.custom"),nge=114,S2=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[$4]=!0;toString(){return this.string==null&&(this.string=Sr.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return le.createV1(nge,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Le(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Le(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[rq](){return`PeerId(${this.toString()})`}},C2=class extends S2{type="RSA";publicKey;constructor(e){super(I(v({},e),{type:"RSA"})),this.publicKey=e.publicKey}},I2=class extends S2{type="Ed25519";publicKey;constructor(e){super(I(v({},e),{type:"Ed25519"})),this.publicKey=e.publicKey}},A2=class extends S2{type="secp256k1";publicKey;constructor(e){super(I(v({},e),{type:"secp256k1"})),this.publicKey=e.publicKey}},oge=2336,D2=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=En.digest(ee(this.url))}[rq](){return`PeerId(${this.url})`}[$4]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return le.createV1(oge,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ne(e)),e.toString()===this.toString())}};var ige=114,nq=2336;function lr(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=Ft(Sr.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return va(le.parse(r));if(e==null)throw new Q('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=Ft(e.decode(r))}return tn(t)}function pc(r){if(r.type==="Ed25519")return new I2({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new A2({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new C2({multihash:r.toCID().multihash,publicKey:r});throw new il}function oq(r){return pc(r.publicKey)}function tn(r){if(age(r))return new C2({multihash:r});if(sge(r))try{let e=_E(r);if(e.type==="Ed25519")return new I2({multihash:r,publicKey:e});if(e.type==="secp256k1")return new A2({multihash:r,publicKey:e})}catch{let t=ne(r.digest);return new D2(new URL(t))}throw new Pm("Supplied PeerID Multihash is invalid")}function va(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==ige&&r.code!==nq)throw new qV("Supplied PeerID CID is invalid");if(r.code===nq){let e=ne(r.multihash.digest);return new D2(new URL(e))}return tn(r.multihash)}function sge(r){return r.code===En.code}function age(r){return r.code===xt.code}function qf(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),o=n.value;return n.done===!0||o==null?{done:!0,value:void 0}:{done:!1,value:e(o)}}};return t}function LE(r){let e=Ft(Sr.decode(`z${r}`));return tn(e)}var mo=class{map;constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return qf(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return qf(this.map.values(),e=>e.key)}values(){return qf(this.map.values(),e=>e.value)}get size(){return this.map.size}};var $i=class r{set;constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return qf(this.set.entries(),e=>{let t=LE(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=LE(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return qf(this.set.values(),e=>LE(e))}intersection(e){let t=new r;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new r;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new r;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};function nT(){return new $i}var FE=class{filter;constructor(e,t){this.filter=ho(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}};function oT(r,e=.001){return new FE(r,e)}var iT=class extends mo{metric;constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function xl(r){let{name:e,metrics:t}=r,n;return t!=null?n=new iT({name:e,metrics:t}):n=new mo,n}var El=class{full;pendingBytes;wantlist;blocks;blockPresences;constructor(e=!1,t=0){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){let n=Qr.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){let n=Qr.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){let n=Qr.encode(e.multihash.bytes);this.blocks.set(n,t)}};function cge(r){let e=new Uint8Array(r.reduce((n,o)=>n+It(o),0)),t=0;for(let n of r)e=In(n,e,t),t+=It(n);return e}var iq=cge;function sT(r){return iq([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}var BE=class{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(e,t){this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??1024}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}sendBlocksToPeer(e){return f(this,null,function*(){let t=new El,n=new Set;for(let[o,i]of this.wants.entries())try{let s=yield this.blockstore.get(i.cid,e);i.wantType===en.WantHave?s.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),n.add(o),t.addBlock(i.cid,{data:s,prefix:sT(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ya.HaveBlock})):(this.log("sending block for %c",i.cid),n.add(o),t.addBlock(i.cid,{data:s,prefix:sT(i.cid)}))}catch(s){if(s.name!=="NotFoundError")throw s;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||i.sentDoNotHave===!0)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ya.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),yield this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((o,i)=>o+i.data.byteLength,0));for(let o of n)this.wants.delete(o)}})}};var UE=class{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(e,t={}){this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=xl({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(o=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,o)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){let t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){let t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}receiveMessage(e,t){return f(this,null,function*(){let n=this.ledgerMap.get(e);if(n==null&&(n=new BE({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(t.blocks?.reduce((o,i)=>o+i.data.byteLength,0)??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(let o of t.wantlist.entries){let i=le.decode(o.cid),s=ne(i.multihash.bytes,"base64");o.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,i),n.wants.delete(s)):(o.wantType===en.WantHave?this.log("peer %p wanted block presence for %c",e,i):this.log("peer %p wanted block for %c",e,i),n.wants.set(s,{cid:i,priority:o.priority,wantType:o.wantType??en.WantBlock,sendDontHave:o.sendDontHave??!1}))}}this.log("send blocks to peer"),yield n.sendBlocksToPeer()})}receivedBlock(e,t){return f(this,null,function*(){let n=ne(e.multihash.bytes,"base64"),o=[];for(let i of this.ledgerMap.values())i.wants.has(n)&&o.push(i);yield Promise.all(o.map(i=>f(this,null,function*(){return i.sendBlocksToPeer(t)})))})}peerDisconnected(e){this.ledgerMap.delete(e)}};var aT=class extends $f{wantList;network;libp2p;constructor(e,t){super(e,I(v({},t),{name:"helia:bitswap:session"})),this.wantList=e.wantList,this.network=e.network,this.libp2p=e.libp2p}queryProvider(e,t,n){return f(this,null,function*(){this.log("sending WANT-BLOCK for %c to %p",e,t);let o=yield this.wantList.wantSessionBlock(e,t,n);if(this.log("%p %s %c",t,o.has?"has":"does not have",e),o.has&&o.block!=null)return o.block;throw new Error("Provider did not have block")})}findNewProviders(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(this.network.findProviders(e,t)),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;yield c.id}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}toEvictionKey(e){return e.toMultihash().bytes}equals(e,t){return e.equals(t)}convertToProvider(e,t){return f(this,null,function*(){return bs(e)?e:(yield this.libp2p.dial(e,t)).remotePeer})}};function sq(r,e){return new aT(r,e)}var VE=class{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(e){this.blocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=e.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.blocksReceived?.increment(n)}updateDuplicateBlocksReceived(e=1,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateBlocksReceived?.increment(n)}updateDataReceived(e,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.dataReceived?.increment(n)}updateDuplicateDataReceived(e,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateDataReceived?.increment(n)}};var cT=class extends Map{metric;constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function rn(r){let{name:e,metrics:t}=r,n;return t!=null?n=new cT({name:e,metrics:t}):n=new Map,n}function lge(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=pa(r);e.push(t),r=r.slice(It(t))}return e}var aq=lge;var jE=class extends st{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(e,t={}){super(),this.peers=xl({name:"helia_bitswap_peers",metrics:e.metrics}),this.wants=rn({name:"helia_bitswap_wantlist",metrics:e.metrics}),this.network=e.network,this.sendMessagesDelay=t.sendMessagesDelay??10,this.log=e.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=t.hashLoader,this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(o=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,o)})}),this.network.addEventListener("peer:connected",n=>{this.peerConnected(n.detail).catch(o=>{this.log.error("error processing newly connected bitswap peer %p",n.detail,o)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}addEntry(e,t){return f(this,null,function*(){let n=ne(e.multihash.bytes,"base64"),o=this.wants.get(n);o==null&&(o={cid:e,priority:t.priority??1,wantType:t.wantType??en.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(n,o)),o.wantType===en.WantHave&&t.wantType===en.WantBlock&&(o.wantType=en.WantBlock),yield this.sendMessagesDebounced();try{return t.wantType===en.WantBlock?(yield Mr(this,"block",t?.signal,{filter:a=>Le(e.multihash.digest,a.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(yield Mr(this,"presence",t?.signal,{filter:s=>Le(e.multihash.digest,s.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{t.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",e),o.cancel=!0,yield this.sendMessagesDebounced())}})}sendMessagesDebounced(){return f(this,null,function*(){yield this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(e=>{this.log("error sending messages to peers",e)})},this.sendMessagesDelay)})}sendMessages(){return f(this,null,function*(){this.sendingMessages=Ye(),yield Promise.all([...this.peers.entries()].map(n=>f(this,[n],function*([e,t]){let o=new Set,i=new El;for(let[s,a]of this.wants.entries())t.has(s)||a.cancel||(o.add(s),i.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(i.wantlist.size!==0)try{yield this.network.sendMessage(e,i);for(let s of o)t.add(s)}catch(s){this.log.error("error sending full wantlist to new peer",s)}}))).catch(e=>{this.log.error("error sending messages",e)});for(let[e,t]of this.wants)if(t.cancel){this.wants.delete(e);for(let n of this.peers.values())n.delete(e)}this.sendingMessages.resolve()})}has(e){let t=ne(e.multihash.bytes,"base64");return this.wants.has(t)}wantSessionPresence(o,i){return f(this,arguments,function*(e,t,n={}){let s=new El;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:en.WantHave,priority:1}),yield this.network.sendMessage(t,s),(yield Mr(this,"presence",n.signal,{filter:c=>t.equals(c.detail.sender)&&Le(e.multihash.digest,c.detail.cid.multihash.digest)})).detail})}wantBlock(n){return f(this,arguments,function*(e,t={}){return this.addEntry(e,I(v({},t),{wantType:en.WantBlock}))})}wantSessionBlock(o,i){return f(this,arguments,function*(e,t,n={}){let s=new El;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:en.WantBlock,priority:1}),yield this.network.sendMessage(t,s),(yield Mr(this,"presence",n.signal,{filter:c=>t.equals(c.detail.sender)&&Le(e.multihash.digest,c.detail.cid.multihash.digest)})).detail})}receivedBlock(e,t){return f(this,null,function*(){let n=ne(e.multihash.bytes,"base64"),o=this.wants.get(n);o!=null&&(o.cancel=!0,yield this.sendMessagesDebounced())})}receiveMessage(e,t){return f(this,null,function*(){this.log("received message from %p with %d blocks",e,t.blocks.length);let n=!1;for(let o of t.blocks){if(o.prefix==null||o.data==null)continue;let i=aq(o.prefix),s=i[0],a=i[1],c=i[2],l=c===xt.code?xt:yield this.hashLoader?.getHasher(c);if(l==null){this.log.error("unknown hash algorithm",c);continue}let u=l.digest(o.data);u.then!=null&&(u=yield u);let d=le.create(s===0?0:1,a,u);this.log("received block from %p for %c",e,d),this.safeDispatchEvent("block",{detail:{sender:e,cid:d,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:e,cid:d,has:!0,block:o.data}});let h=ne(d.multihash.bytes,"base64"),p=this.wants.get(h);p!=null&&(p.cancel=!0,n=!0)}for(let{cid:o,type:i}of t.blockPresences){let s=le.decode(o);this.log("received %s from %p for %c",i,e,s),this.safeDispatchEvent("presence",{detail:{sender:e,cid:s,has:i===ya.HaveBlock}})}n&&(yield this.sendMessagesDebounced())})}peerConnected(e){return f(this,null,function*(){let t=new Set,n=new El(!0);for(let[o,i]of this.wants.entries())i.cancel||(t.add(o),n.addWantlistEntry(i.cid,{cid:i.cid.bytes,priority:1,wantType:en.WantBlock,cancel:!1,sendDontHave:!1}));if(n.wantlist.size===0){this.peers.set(e,t);return}try{yield this.network.sendMessage(e,n),this.peers.set(e,t)}catch(o){this.log.error("error sending full wantlist to new peer %p",e,o)}})}peerDisconnected(e){this.peers.delete(e)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}};var HE=class{log;logger;stats;network;blockstore;peerWantLists;wantList;libp2p;constructor(e,t={}){this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.libp2p=e.libp2p,this.stats=new VE(e),this.network=new OE(e,t),this.peerWantLists=new UE(I(v({},e),{network:this.network}),t),this.wantList=new jE(I(v({},e),{network:this.network}),t)}createSession(e={}){return sq({wantList:this.wantList,network:this.network,logger:this.logger,libp2p:this.libp2p},e)}want(n){return f(this,arguments,function*(e,t={}){let o=new AbortController,i=tt([o.signal,t.signal]);o.signal,this.network.findAndConnect(e,I(v({},t),{signal:i})).catch(s=>{o.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(yield this.wantList.wantBlock(e,I(v({},t),{signal:i}))).block}finally{o.abort(),i.clear()}})}notify(o,i){return f(this,arguments,function*(e,t,n={}){yield Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])})}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}start(){return f(this,null,function*(){this.wantList.start(),yield this.network.start()})}stop(){return f(this,null,function*(){this.wantList.stop(),yield this.network.stop()})}};var cq=(r,e={})=>new HE(r,e);var lT=class{bitswap;started;constructor(e,t={}){let{getHasher:n}=e;this.bitswap=cq(e,v({hashLoader:{getHasher:o=>f(this,null,function*(){return n(o)})}},t)),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield this.bitswap.start(),this.started=!0})}stop(){return f(this,null,function*(){yield this.bitswap.stop(),this.started=!1})}announce(e,t,n){return f(this,null,function*(){yield this.bitswap.notify(e,t,n)})}retrieve(n){return f(this,arguments,function*(e,t={}){return this.bitswap.want(e,t)})}createSession(e){let t=this.bitswap.createSession(e);return{announce:(n,o,i)=>f(this,null,function*(){yield this.bitswap.notify(n,o,i)}),retrieve:(n,o)=>f(this,null,function*(){return t.retrieve(n,o)})}}};function uT(r={}){return e=>new lT(e,r)}var jo=(()=>{class r extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}return r})(),Kf=(()=>{class r extends Error{static name="ValidationError";name="ValidationError"}return r})(),dT=(()=>{class r extends Error{static name="InvalidParametersError";name="InvalidParametersError"}return r})(),lq=(()=>{class r extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}return r})();var $E=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*o)-1;for(;;){let u=this.readAtomically(()=>{let d=this.readChar();if(d===void 0)return;let h=Number.parseInt(d,e);if(!Number.isNaN(h))return h});if(u===void 0)break;if(i*=e,i+=u,i>l||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let o=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[o]=s[0],t[o+1]=s[1],t[o+2]=s[2],t[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];t[o]=i>>8,t[o+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=e(i.subarray(0,s));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var uq=45,uge=15,yg=new $E;function zE(r){if(!(r.length>uge))return yg.new(r).parseWith(()=>yg.readIPv4Addr())}function qE(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>uq))return yg.new(r).parseWith(()=>yg.readIPv6Addr())}function vg(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>uq)return;let t=yg.new(r).parseWith(()=>yg.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function zi(r){return!!zE(r)}function wg(r){return!!qE(r)}function pT(r){return e=>ne(e,r)}function hT(r){return e=>ee(e,r)}function bg(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function Gf(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function dq(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=ee(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Gf(n);return Gt([t,o],t.length+o.length)}function fq(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=rs.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Gf(n);return Gt([t,o],t.length+o.length)}function mT(r){let e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=ne(e,"base32"),o=bg(t);return`${n}:${o}`}var gT=function(r){r=r.toString().trim();let e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{let o=parseInt(t,10);if(isNaN(o)||o<0||o>255)throw new jo("Invalid byte value in IP address");e[n]=o}),e},pq=function(r){let e=0;r=r.toString().trim();let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=zi(t[n]),s;i&&(s=gT(t[n]),t[n]=ne(s.subarray(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,ne(s.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");let i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new jo("Invalid byte value in IP address");o[e++]=i>>8&255,o[e++]=i&255}return o},hq=function(r){if(r.byteLength!==4)throw new jo("IPv4 address was incorrect length");let e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},mq=function(r){if(r.byteLength!==16)throw new jo("IPv6 address was incorrect length");let e=[];for(let n=0;n<r.byteLength;n+=2){let o=r[n],i=r[n+1],s=`${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(s)}let t=e.join(":");try{let n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new jo(`Invalid IPv6 address "${t}"`)}};function gq(r){try{let e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new jo(`Invalid IPv6 address "${r}"`)}}var fT=Object.values(xf).map(r=>r.decoder),dge=function(){let r=fT[0].or(fT[1]);return fT.slice(2).forEach(e=>r=r.or(e)),r}();function yq(r){return dge.decode(r)}function vq(r){return e=>r.encoder.encode(e)}function fge(r){if(parseInt(r).toString()!==r)throw new Kf("Value must be an integer")}function pge(r){if(r<0)throw new Kf("Value must be a positive integer, or zero")}function hge(r){return e=>{if(e>r)throw new Kf(`Value must be smaller than or equal to ${r}`)}}function mge(...r){return e=>{for(let t of r)t(e)}}var T2=mge(fge,pge,hge(65535));var Dn=-1,yT=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new lq(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){let t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},ri=new yT,zge=[{code:4,name:"ip4",size:32,valueToBytes:gT,bytesToValue:hq,validate:r=>{if(!zi(r))throw new Kf(`Invalid IPv4 address "${r}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Gf,bytesToValue:bg,validate:T2},{code:273,name:"udp",size:16,valueToBytes:Gf,bytesToValue:bg,validate:T2},{code:33,name:"dccp",size:16,valueToBytes:Gf,bytesToValue:bg,validate:T2},{code:41,name:"ip6",size:128,valueToBytes:pq,bytesToValue:mq,stringToValue:gq,validate:r=>{if(!wg(r))throw new Kf(`Invalid IPv6 address "${r}"`)}},{code:42,name:"ip6zone",size:Dn},{code:43,name:"ipcidr",size:8,bytesToValue:pT("base10"),valueToBytes:hT("base10")},{code:53,name:"dns",size:Dn,resolvable:!0},{code:54,name:"dns4",size:Dn,resolvable:!0},{code:55,name:"dns6",size:Dn,resolvable:!0},{code:56,name:"dnsaddr",size:Dn,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:Gf,bytesToValue:bg,validate:T2},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:Dn,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:421,name:"p2p",aliases:["ipfs"],size:Dn,bytesToValue:pT("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?hT("base58btc")(r):le.parse(r).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:mT,valueToBytes:dq},{code:445,name:"onion3",size:296,bytesToValue:mT,valueToBytes:fq},{code:446,name:"garlic64",size:Dn},{code:447,name:"garlic32",size:Dn},{code:448,name:"tls"},{code:449,name:"sni",size:Dn},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:Dn,bytesToValue:vq(sl),valueToBytes:yq},{code:480,name:"http"},{code:481,name:"http-path",size:Dn,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:Dn}];zge.forEach(r=>{ri.addProtocol(r)});function wq(r){let e=[],t=0;for(;t<r.length;){let n=pa(r,t),o=ri.getProtocol(n),i=It(n),s=qge(o,r,t+i),a=0;s>0&&o.size===Dn&&(a=It(s));let c=i+a+s,l={code:n,name:o.name,bytes:r.subarray(t,t+c)};if(s>0){let u=t+i+a,d=r.subarray(u,u+s);l.value=o.bytesToValue?.(d)??ne(d)}e.push(l),t+=c}return e}function bq(r){let e=0,t=[];for(let n of r){if(n.bytes==null){let o=ri.getProtocol(n.code),i=It(n.code),s,a=0,c=0;n.value!=null&&(s=o.valueToBytes?.(n.value)??ee(n.value),a=s.byteLength,o.size===Dn&&(c=It(a)));let l=new Uint8Array(i+c+a),u=0;ag(n.code,l,u),u+=i,s!=null&&(o.size===Dn&&(ag(a,l,u),u+=c),l.set(s,u)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return Gt(t,e)}function xq(r){if(r.charAt(0)!=="/")throw new jo('String multiaddr must start with "/"');let e=[],t="protocol",n="",o="";for(let i=1;i<r.length;i++){let s=r.charAt(i);s!=="/"&&(t==="protocol"?o+=r.charAt(i):n+=r.charAt(i));let a=i===r.length-1;if(s==="/"||a){let c=ri.getProtocol(o);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",o="",t="protocol";continue}else if(a)throw new jo(`Component ${o} was missing value`);t="value"}else if(t==="value"){let l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new jo(`Component ${o} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",o="",t="protocol"}}}if(o!==""&&n!=="")throw new jo("Incomplete multiaddr");return e}function Eq(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;let t=ri.getProtocol(e.code);if(t==null)throw new jo(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function qge(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:pa(e,t)}var Kge=Symbol.for("nodejs.util.inspect.custom"),ET=Symbol.for("@multiformats/multiaddr"),Gge=[53,54,55,56],xT=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}};function Wge(r){if(r==null&&(r="/"),ju(r))return r.getComponents();if(r instanceof Uint8Array)return wq(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),xq(r);if(Array.isArray(r))return r;throw new jo("Must be a string, Uint8Array, Component[], or another Multiaddr")}var GE=class r{[ET]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=Wge(e),t.validate!==!1&&Yge(this)}get bytes(){return this.#r==null&&(this.#r=bq(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=Eq(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let e,t,n,o,i="";for(let{code:a,name:c,value:l}of this.#e)a===42&&(i=`%${l??""}`),Gge.includes(a)&&(t="tcp",o=443,n=`${l??""}${i}`,e=a===55?6:4),(a===6||a===273)&&(t=c==="tcp"?"tcp":"udp",o=parseInt(l??"")),(a===4||a===41)&&(t="tcp",n=`${l??""}${i}`,e=a===41?6:4);if(e==null||t==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:o}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:e,value:t})=>{let n=ri.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#e.map(({code:e})=>e)}protoNames(){return this.#e.map(({name:e})=>e)}tuples(){return this.#e.map(({code:e,value:t})=>{if(t==null)return[e];let n=ri.getProtocol(e),o=[e];return t!=null&&o.push(n.valueToBytes?.(t)??ee(t)),o})}stringTuples(){return this.#e.map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){let t=new r(e);return new r([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new dT(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new r(n.slice(0,o),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new r(this.#e.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#e.forEach(({code:n,value:o})=>{n===421&&e.push([n,o]),n===290&&(e=[])});let t=e.pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?ne(Sr.decode(`z${n}`),"base58btc"):ne(le.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let e of this.#e)if(ri.getProtocol(e.code).path)return e.value??null;return null}equals(e){return Le(this.bytes,e.bytes)}resolve(e){return f(this,null,function*(){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=_q.get(t.name);if(n==null)throw new xT(`no available resolver for ${t.name}`);return(yield n(this,e)).map(i=>Ee(i))})}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==4&&this.#e[0].code!==41||this.#e[1].code!==6&&this.#e[1].code!==273)}[Kge](){return`Multiaddr(${this.toString()})`}};function Yge(r){r.getComponents().forEach(e=>{let t=ri.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function Sq(r,e,t){let n=0;for(let o of r)if(!(n<e)){if(n>t)break;if(o!==255)return!1;n++}return!0}function Cq(r,e,t,n){let o=0;for(let i of r)if(!(o<t)){if(o>n)break;if(i!==e[o])return!1;o++}return!0}function _T(r){switch(r.length){case Qf:return r.join(".");case Zf:{let e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Iq(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;(n&128)!=0;)e++,n=n<<1;if((n&128)!=0)return-1;for(let o=t+1;o<r.length;o++)if(r[o]!=0)return-1;break}return e}function Aq(r){let e="0x";for(let t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}var Qf=4,Zf=16,hXe=parseInt("0xFFFF",16),Xge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function P2(r,e){e.length===Zf&&r.length===Qf&&Sq(e,0,11)&&(e=e.slice(12)),e.length===Qf&&r.length===Zf&&Cq(r,Xge,0,11)&&(r=r.slice(12));let t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");let n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=r[o]&e[o];return n}function Dq(r,e){if(typeof e=="string"&&(e=vg(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function ST(r){let[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=Qf,o=zE(e);if(o==null&&(n=Zf,o=qE(e),o==null))throw new Error("Failed to parse given CIDR: "+r);let i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n*8)throw new Error("Failed to parse given CIDR: "+r);let s=CT(i,8*n);return{network:P2(o,s),mask:s}}function CT(r,e){if(e!==8*Qf&&e!==8*Zf)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");let t=e/8,n=new Uint8Array(t);for(let o=0;o<t;o++){if(r>=8){n[o]=255,r-=8;continue}n[o]=255-(255>>r),r=0}return n}var Jf=class{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=ST(e));else{let n=vg(e);if(n==null)throw new Error("Failed to parse network");t=String(t);let o=parseInt(t,10);if(Number.isNaN(o)||String(o).length!==t.length||o<0||o>n.length*8){let i=vg(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=CT(o,8*n.length);this.network=P2(n,this.mask)}}contains(e){return Dq({network:this.network,mask:this.mask},e)}toString(){let e=Iq(this.mask),t=e!==-1?String(e):Aq(this.mask);return _T(this.network)+"/"+t}};function Tq(r,e){return new Jf(r).contains(e)}function IT(r){let e,t;if(r.getComponents().forEach(n=>{(n.name==="ip4"||n.name==="ip6")&&(t=n.value),n.name==="ipcidr"&&(e=n.value)}),e==null||t==null)throw new Error("Invalid multiaddr");return new Jf(t,e)}var _q=new Map;function ju(r){return!!r?.[ET]}function Ee(r){return new GE(r)}function Cs(r){let e=ri.getProtocol(r);return{code:e.code,size:e.size??0,name:e.name,resolvable:!!e.resolvable,path:!!e.path}}var Qge=[6,53,56,54,55];function Pq(r){return Rq("sni",r)?.value}function Mq(r){let e=Rq("tcp",r)?.value;return e==null?"":`:${e}`}function Rq(r,e){return e.find(t=>t.name===r)}function kq(r){return r.some(({code:e})=>e===448)}function ba(r,e){let t=Nq[r.name];if(t==null)throw new Error(`Can't interpret protocol ${r.name}`);let n=t(r,e);return r.code===41?`[${n}]`:n}var Nq={ip4:(r,e)=>r.value,ip6:(r,e)=>e.length===0?r.value:`[${r.value}]`,tcp:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${ba(t,e)}:${r.value}`},udp:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${ba(t,e)}:${r.value}`},dnsaddr:(r,e)=>r.value,dns4:(r,e)=>r.value,dns6:(r,e)=>r.value,dns:(r,e)=>r.value,ipfs:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ba(t,e)}`},p2p:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ba(t,e)}`},http:(r,e)=>{let t=kq(e),n=Pq(e),o=Mq(e);if(t&&n!=null)return`https://${n}${o}`;let i=t?"https://":"http://",s=e.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=ba(s,e);return a=a?.replace("tcp://",""),`${i}${a}`},"http-path":(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ba(t,e),o=decodeURIComponent(r.value??"");return`${n}${o}`},tls:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ba(t,e)},sni:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ba(t,e)},https:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ba(t,e);return n=n?.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{let t=kq(e),n=Pq(e),o=Mq(e);if(t&&n!=null)return`wss://${n}${o}`;let i=t?"wss://":"ws://",s=e.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=ba(s,e);return a=a?.replace("tcp://",""),`${i}${a}`},wss:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ba(t,e);return n=n?.replace("tcp://",""),`wss://${n}`}};function Eg(r,e){let n=Ee(r).getComponents(),o=n.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let i=Nq[o.name];if(i==null)throw new Error(`No interpreter found for ${o.name}`);let s=i(o,n)??"";return e?.assumeHttp!==!1&&Qge.includes(o.code)&&(s=s.replace(/^.*:\/\//,""),o.value==="443"?s=`https://${s}`:s=`http://${s}`),(s.startsWith("http://")||s.startsWith("https://")||s.startsWith("ws://")||s.startsWith("wss://"))&&(s=new URL(s).toString(),s.endsWith("/")&&(s=s.substring(0,s.length-1))),s}var _g=class{url;#e=0;#t=0;#r=0;#a=0;#s=new Map;log;transformRequestInit;constructor(e,{logger:t,transformRequestInit:n}){this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#l(e){let t=e.multihash.bytes;return Qr.encode(t)}getRawBlock(e,t){return f(this,null,function*(){let n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",t?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);let o=this.#l(e),i=new AbortController,s=()=>{i.abort()};t?.addEventListener("abort",s);try{let a=this.#s.get(o);if(a==null){this.#e++;let c={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?yield this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(u=>f(this,null,function*(){if(this.log("GET %s %d",n,u.status),!u.ok)throw this.#t++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return this.#a++,new Uint8Array(yield u.arrayBuffer())})),this.#s.set(o,a)}return yield a}catch{throw t?.aborted===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(this.#t++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t?.removeEventListener("abort",s),this.#s.delete(o)}})}reliability(){return this.#e===0?1:this.#r>0?-1/0:this.#a/(this.#e+this.#t*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#e,errors:this.#t,invalidBlocks:this.#r,successes:this.#a,pendingResponses:this.#s.size}}};var Lq=_r(Oq(),1),Zge=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],Jge=Zge.map(r=>new Lq.Netmask(r));function AT(r){for(let e of Jge)if(e.contains(r))return!0;return!1}function e0e(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function t0e(r){let e=r.split(":");if(e.length<2)return!1;let t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return AT(o)}function r0e(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function n0e(r){let e=r.split(":"),t=e[e.length-1];return AT(t)}function o0e(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function Ho(r){if(zi(r))return AT(r);if(e0e(r))return t0e(r);if(r0e(r))return n0e(r);if(wg(r))return o0e(r)}var i0e=r=>r.toString().split("/").slice(1),Sg=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),dt=r=>({match:e=>Sg(t=>t===r).match(e),pattern:r}),ep=()=>({match:r=>Sg(e=>typeof e=="string").match(r),pattern:"{string}"}),Cg=()=>({match:r=>Sg(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),Ht=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{Sr.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),k2=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{sl.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),Lt=r=>({match:e=>{let t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),go=(...r)=>({match:e=>{let t;for(let n of r){let o=n.match(e);o!==!1&&(t==null||o.length<t.length)&&(t=o)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),Et=(...r)=>({match:e=>{for(let t of r){let n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function $t(...r){function e(o){let i=i0e(o);for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function t(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}var s0e=Ht(),Fq=$t(s0e),YE=Et(dt("dns4"),ep()),XE=Et(dt("dns6"),ep()),QE=Et(dt("dnsaddr"),ep()),TT=Et(dt("dns"),ep()),aQe=$t(YE,Lt(Ht())),cQe=$t(XE,Lt(Ht())),lQe=$t(QE,Lt(Ht())),R2=$t(go(TT,QE,YE,XE),Lt(Ht())),Bq=Et(dt("ip4"),Sg(zi)),Uq=Et(dt("ip6"),Sg(wg)),PT=go(Bq,Uq),_l=go(PT,TT,YE,XE,QE),Vq=$t(go(PT,Et(go(TT,QE,YE,XE),Lt(Ht())))),MT=$t(Bq),kT=$t(Uq),jq=$t(PT),RT=Et(_l,dt("tcp"),Cg()),N2=Et(_l,dt("udp"),Cg()),tp=$t(Et(RT,Lt(Ht()))),uQe=$t(N2),NT=Et(N2,dt("quic"),Lt(Ht())),ZE=Et(N2,dt("quic-v1"),Lt(Ht())),a0e=go(NT,ZE),dQe=$t(NT),Hq=$t(ZE),DT=go(_l,RT,N2,NT,ZE),$q=go(Et(DT,dt("ws"),Lt(Ht()))),Sl=$t($q),zq=go(Et(DT,dt("wss"),Lt(Ht())),Et(DT,dt("tls"),Lt(Et(dt("sni"),ep())),dt("ws"),Lt(Ht()))),rp=$t(zq),qq=Et(N2,dt("webrtc-direct"),Lt(k2()),Lt(k2()),Lt(Ht())),O2=$t(qq),Kq=Et(ZE,dt("webtransport"),Lt(k2()),Lt(k2()),Lt(Ht())),OT=$t(Kq),WE=go($q,zq,Et(RT,Lt(Ht())),Et(a0e,Lt(Ht())),Et(_l,Lt(Ht())),qq,Kq,Ht()),JE=$t(WE),c0e=Et(WE,dt("p2p-circuit"),Ht()),ni=$t(c0e),l0e=go(Et(WE,dt("p2p-circuit"),dt("webrtc"),Lt(Ht())),Et(WE,dt("webrtc"),Lt(Ht())),Et(dt("webrtc"),Lt(Ht()))),L2=$t(l0e),u0e=go(Et(_l,dt("tcp"),Cg(),dt("http"),Lt(Ht())),Et(_l,dt("http"),Lt(Ht()))),Gq=$t(u0e),d0e=go(Et(_l,dt("tcp"),go(Et(dt("443"),dt("http")),Et(Cg(),dt("https")),Et(Cg(),dt("tls"),dt("http"))),Lt(Ht())),Et(_l,dt("tls"),dt("http"),Lt(Ht())),Et(_l,dt("https"),Lt(Ht()))),Wq=$t(d0e),f0e=go(Et(dt("memory"),ep(),Lt(Ht()))),fQe=$t(f0e);function LT(r,e,t){return r.filter(n=>{if(Wq.matches(n)||e&&Gq.matches(n))return t||R2.matches(n)?!0:Ho(n.toOptions().host)===!1;if(!e&&t){let{host:o}=n.toOptions();if(o==="127.0.0.1"||o==="localhost"||o.endsWith(".localhost"))return!0}return!1})}function e6(s,a,c,l,u){return k(this,arguments,function*(r,e,t,n,o,i={}){try{for(var d=O(e.findProviders(r,i)),h,p,m;h=!(p=yield new C(d.next())).done;h=!1){let w=p.value;let E=LT(w.multiaddrs,n,o);if(E.length===0)continue;let S=Eg(E[0]);yield new _g(S,{logger:t,transformRequestInit:i.transformRequestInit})}}catch{m=[p]}finally{try{h&&(p=d.return)&&(yield new C(p.call(d)))}finally{if(m)throw m[0]}}})}var FT=class extends $f{routing;allowInsecure;allowLocal;transformRequestInit;constructor(e,t){super(e,I(v({},t),{name:"helia:trustless-gateway:session"})),this.routing=e.routing,this.allowInsecure=t.allowInsecure??t6,this.allowLocal=t.allowLocal??r6,this.transformRequestInit=t.transformRequestInit}queryProvider(e,t,n){return f(this,null,function*(){this.log("fetching BLOCK for %c from %s",e,t.url);let o=yield t.getRawBlock(e,n.signal);return this.log.trace("got block for %c from %s",e,t.url),yield n.validateFn?.(o),o})}findNewProviders(n){return k(this,arguments,function*(e,t={}){yield*J(e6(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,I(v({},t),{transformRequestInit:this.transformRequestInit})))})}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}convertToProvider(e,t){return f(this,null,function*(){if(bs(e))return;let n=LT(Array.isArray(e)?e:[e],this.allowInsecure,this.allowLocal);if(n.length===0)return;let o=Eg(n[0]);return new _g(o,{logger:this.logger,transformRequestInit:this.transformRequestInit})})}};function Yq(r,e){return new FT(r,e)}var n6=class{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??t6,this.allowLocal=t.allowLocal??r6,this.transformRequestInit=t.transformRequestInit}retrieve(n){return f(this,arguments,function*(e,t={}){let o=[];try{for(var i=O(e6(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,I(v({},t),{transformRequestInit:this.transformRequestInit}))),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;this.log("getting block for %c from %s",e,l.url);try{let u=yield l.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,l.url);try{yield t.validateFn?.(u)}catch(d){this.log.error("failed to validate block for %c from %s",e,l.url,d);continue}return u}catch(u){if(this.log.error("failed to get block for %c from %s",e,l.url,u),u instanceof Error?o.push(u):o.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${l.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,l.url);break}}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw o.length>0?new AggregateError(o,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)})}createSession(e={}){return Yq({logger:this.logger,routing:this.routing},I(v({},e),{allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit}))}};var t6=!1,r6=!1;function BT(r={}){return e=>new n6(e,r)}function o6(t){return k(this,arguments,function*(r,e={}){let n=r.getReader();try{for(;;){let o=yield new C(n.read());if(o.done)return;yield o.value}}finally{e.preventCancel!==!0&&(yield new C(n.cancel())),n.releaseLock()}})}var v0e=_r(i6(),1);var Cl=(()=>{class r extends Error{static name="SignatureVerificationError";constructor(t="Record signature verification failed"){super(t),this.name="SignatureVerificationError"}}return r})(),Xq=(()=>{class r extends Error{static name="RecordExpiredError";constructor(t="Record has expired"){super(t),this.name="RecordExpiredError"}}return r})(),s6=(()=>{class r extends Error{static name="UnsupportedValidityError";constructor(t="The validity type is unsupported"){super(t),this.name="UnsupportedValidityError"}}return r})(),Qq=(()=>{class r extends Error{static name="RecordTooLargeError";constructor(t="The record is too large"){super(t),this.name="RecordTooLargeError"}}return r})(),Zq=(()=>{class r extends Error{static name="InvalidValueError";constructor(t="Value must be a valid content path starting with /"){super(t),this.name="InvalidValueError"}}return r})(),Jq=(()=>{class r extends Error{static name="InvalidRecordDataError";constructor(t="Invalid record data"){super(t),this.name="InvalidRecordDataError"}}return r})(),VT=(()=>{class r extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(t="Invalid embedded public key"){super(t),this.name="InvalidEmbeddedPublicKeyError"}}return r})();var oi;(function(r){let e;(function(o){o.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(o){o[o.EOL=0]="EOL"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.value!=null&&(i.uint32(10),i.bytes(o.value)),o.signatureV1!=null&&(i.uint32(18),i.bytes(o.signatureV1)),o.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(o.validityType,i)),o.validity!=null&&(i.uint32(34),i.bytes(o.validity)),o.sequence!=null&&(i.uint32(40),i.uint64(o.sequence)),o.ttl!=null&&(i.uint32(48),i.uint64(o.ttl)),o.pubKey!=null&&(i.uint32(58),i.bytes(o.pubKey)),o.signatureV2!=null&&(i.uint32(66),i.bytes(o.signatureV2)),o.data!=null&&(i.uint32(74),i.bytes(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.value=o.bytes();break}case 2:{a.signatureV1=o.bytes();break}case 3:{a.validityType=r.ValidityType.codec().decode(o);break}case 4:{a.validity=o.bytes();break}case 5:{a.sequence=o.uint64();break}case 6:{a.ttl=o.uint64();break}case 7:{a.pubKey=o.bytes();break}case 8:{a.signatureV2=o.bytes();break}case 9:{a.data=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(oi||(oi={}));var p0e=Mt("ipns:utils"),eK=ee("/ipns/");var h0e=0,m0e=18;function tK(r){let e;if(r.pubKey!=null)try{e=Hr(r.pubKey)}catch(t){throw p0e.error(t),t}if(e!=null)return e}function rK(r){let e=ee("ipns-signature:");return Gt([e,r])}function F2(r){return"signatureV1"in r?oi.encode({value:ee(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:ee(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):oi.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function mc(r){let e=oi.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Cl("Missing data or signatureV2");let t=nK(e.data),n=g0e(t.Value),o=ne(t.Validity);if(e.value!=null&&e.signatureV1!=null)return y0e(e),{value:n,validityType:oi.ValidityType.EOL,validity:o,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:oi.ValidityType.EOL,validity:o,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function B2(r){return Gt([eK,r.bytes])}function Ig(r){let e=Ft(r.slice(eK.length));if(!a6(e,h0e)&&!a6(e,m0e))throw new Pm("Multihash in IPNS key was not identity or sha2-256");return e}function nK(r){let e=Bi(r);if(e.ValidityType===0)e.ValidityType=oi.ValidityType.EOL;else throw new s6("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function g0e(r){let e=ne(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${le.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${le.parse(e).toV1().toString()}`}catch{}throw new Zq("Value must be a valid content path starting with /")}function y0e(r){if(r.data==null)throw new Jq("Record data is missing");let e=nK(r.data);if(!Le(e.Value,r.value??new Uint8Array(0)))throw new Cl('Field "value" did not match between protobuf and CBOR');if(!Le(e.Validity,r.validity??new Uint8Array(0)))throw new Cl('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Cl('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Cl('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Cl('Field "ttl" did not match between protobuf and CBOR')}function a6(r,e){return r.code===e}var sZe=Mt("ipns"),aZe=5*60*1e9,w0e="/ipns/",cZe=w0e.length;var oK=_r(i6(),1);var c6=Mt("ipns:validator"),b0e=1024*10,x0e=(r,e)=>f(null,null,function*(){let t=mc(e),n;try{let o=rK(t.data);n=yield r.verify(o,t.signatureV2)}catch{n=!1}if(!n)throw c6.error("record signature verification failed"),new Cl("Record signature verification failed");if(t.validityType===oi.ValidityType.EOL){if(oK.default.fromString(t.validity).toDate().getTime()<Date.now())throw c6.error("record has expired"),new Xq("record has expired")}else if(t.validityType!=null)throw c6.error("the validity type is unsupported"),new s6("The validity type is unsupported");c6("ipns record for %s is valid",t.value)});function l6(r,e){return f(this,null,function*(){if(e.byteLength>b0e)throw new Qq("The record is too large");let t=Ig(r),n;a6(t,0)&&(n=_E(t));let o=mc(e),i=tK(o)??n;if(i==null)throw new VT("Could not extract public key from IPNS record or routing key");let s=B2(i.toMultihash());if(!Le(s,r))throw new VT("Embedded public key did not match routing key");yield x0e(i,e)})}var u6=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"};function U2(t){return k(this,arguments,function*(r,e={}){let n=/\r?\n/,o=new TextDecoder("utf8"),i="";try{for(var s=O(r),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;if(typeof u=="string"&&(u=new TextEncoder().encode(u)),zm(u)&&(u=u.subarray()),i+=o.decode(u,{stream:!0}),i.length>(e?.maxMessageLength??i.length))throw new u6("Incoming message too long");let d=i.split(n);i=d.pop()??"";for(let h=0;h<d.length;h++)yield JSON.parse(d[h])}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}i+=o.decode(),i!==""&&(yield JSON.parse(i))})}var d6=(()=>{class r extends Error{static name="InvalidRequestError";constructor(t="Invalid request"){super(t),this.name="InvalidRequestError"}}return r})(),Il=(()=>{class r extends Error{static name="BadResponseError";constructor(t="Bad response"){super(t),this.name="BadResponseError"}}return r})();function E0e(r){return r[Symbol.asyncIterator]!=null}function _0e(r){if(E0e(r))return f(null,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield e.next()).done;t=!1){let i=n.value;return i}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield n.call(e))}finally{if(o)throw o[0]}}});for(let e of r)return e}var Ag=_0e;var iK=ee("/ipns/");function sK(r){return Le(r.subarray(0,iK.byteLength),iK)}var f6=class{client;constructor(e){this.client=e}findProviders(n){return k(this,arguments,function*(e,t={}){yield*J(An(this.client.getProviders(e,t),o=>({id:o.ID,multiaddrs:o.Addrs??[]})))})}provide(){return f(this,null,function*(){})}cancelReprovide(){return f(this,null,function*(){})}put(e,t,n){return f(this,null,function*(){if(!sK(e))return;let o=Ig(e),i=le.createV1(114,o),s=mc(t);yield this.client.putIPNS(i,s,n)})}get(e,t){return f(this,null,function*(){if(!sK(e))throw new Ot("Not found");let n=Ig(e),o=le.createV1(114,n);try{let i=yield this.client.getIPNS(o,t);return F2(i)}catch(i){throw i.name==="BadResponseError"?new Ot("Not found"):i}})}},p6=class{client;constructor(e){this.client=e}findPeer(n){return f(this,arguments,function*(e,t={}){let o=yield Ag(this.client.getPeers(e,t));if(o!=null)return{id:o.ID,multiaddrs:o.Addrs??[]};throw new Ot("Not found")})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){})}};var jn=Mt("delegated-routing-v1-http-api-client"),h6={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"},m6=class{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Iu({concurrency:t.concurrentRequests??h6.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??h6.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new f6(this),this.peerRouting=new p6(this),this.cacheName=t.cacheName??h6.cacheName,this.cacheTTL=t.cacheTTL??h6.cacheTTL}get[rc](){return this.contentRouting}get[nc](){return this.peerRouting}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=yield globalThis.caches?.open(this.cacheName),this.cache!=null&&jn("cache enabled with ttl %d",this.cacheTTL)))})}stop(){return f(this,null,function*(){this.httpQueue.clear(),this.shutDownController.abort(),yield globalThis.caches?.delete(this.cacheName),this.started=!1})}getProviders(n){return k(this,arguments,function*(e,t={}){jn("getProviders starts: %c",e);let o=AbortSignal.timeout(this.timeout),i=tt([this.shutDownController.signal,o,t.signal]);let s=Ye(),a=Ye();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));try{yield new C(s.promise);let h=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#t(h,t.filterAddrs,t.filterProtocols);let p={headers:{Accept:"application/x-ndjson"},signal:i},m=yield new C(this.#r(h.toString(),p));if(m==null)throw new Il("No response received");if(!m.ok)throw m.status===404?new Ot("No matching records found"):m.status===422?new d6("Request does not conform to schema or semantic constraints"):new Il(`Unexpected status code: ${m.status}`);if(m.body==null)throw new Il("Routing response had no body");let w=m.headers.get("Content-Type");if(w==null)throw new Il("No Content-Type header received");if(w?.startsWith("application/json")){let E=yield new C(m.json());for(let S of E.Providers){let A=this.#e(S);A!=null&&(yield A)}}else if(w.includes("application/x-ndjson"))try{for(var c=O(U2(o6(m.body))),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let E=u.value;let S=this.#e(E);S!=null&&(yield S)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}else throw new Il(`Unsupported Content-Type: ${w}`)}finally{i.clear(),a.resolve(),jn("getProviders finished: %c",e)}})}getPeers(n){return k(this,arguments,function*(e,t={}){jn("getPeers starts: %c",e);let o=AbortSignal.timeout(this.timeout),i=tt([this.shutDownController.signal,o,t.signal]);let s=Ye(),a=Ye();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));try{yield new C(s.promise);let h=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#t(h,t.filterAddrs,t.filterProtocols);let p={headers:{Accept:"application/x-ndjson"},signal:i},m=yield new C(this.#r(h.toString(),p));if(m.status===404)throw new Ot("No matching records found");if(m.status===422)throw new d6("Request does not conform to schema or semantic constraints");if(m.body==null)throw new Il("Routing response had no body");if(m.headers.get("Content-Type")==="application/json"){let E=yield new C(m.json());for(let S of E.Peers){let A=this.#e(S);A!=null&&(yield A)}}else try{for(var c=O(U2(o6(m.body))),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let E=u.value;let S=this.#e(E);S!=null&&(yield S)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}}catch(h){jn.error("getPeers errored:",h)}finally{i.clear(),a.resolve(),jn("getPeers finished: %c",e)}})}getIPNS(n){return f(this,arguments,function*(e,t={}){jn("getIPNS starts: %s",e);let o=AbortSignal.timeout(this.timeout),i=tt([this.shutDownController.signal,o,t.signal]);let s=Ye(),a=Ye();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));let c=`${this.clientUrl}routing/v1/ipns/${e}`;try{yield s.promise;let l={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},u=yield this.#r(c,l);if(jn("getIPNS GET %s %d",c,u.status),u.status===404)throw new Ot("No matching records found");if(u.status===422)throw new d6("Request does not conform to schema or semantic constraints");if(u.body==null)throw new Il("GET ipns response had no body");let d=yield u.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&(yield l6(B2(e.multihash),h)),mc(h)}catch(l){throw jn.error("getIPNS GET %s error:",c,l),l}finally{i.clear(),a.resolve(),jn("getIPNS finished: %s",e)}})}putIPNS(o,i){return f(this,arguments,function*(e,t,n={}){jn("putIPNS starts: %c",e);let s=AbortSignal.timeout(this.timeout),a=tt([this.shutDownController.signal,s,n.signal]);let c=Ye(),l=Ye();this.httpQueue.add(()=>f(this,null,function*(){return c.resolve(),l.promise}));let u=`${this.clientUrl}routing/v1/ipns/${e}`;try{yield c.promise;let d=F2(t),h={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:d,signal:a},p=yield this.#r(u,h);if(jn("putIPNS PUT %s %d",u,p.status),p.status!==200)throw new Il("PUT ipns response had status other than 200")}catch(d){throw jn.error("putIPNS PUT %s error:",u,d.stack),d}finally{a.clear(),l.resolve(),jn("putIPNS finished: %c",e)}})}#e(e){try{let t=[],n=e.Addrs?.map(Ee)??[];return e.Protocols!=null&&t.push(...e.Protocols),e.Protocol!=null&&(t.push(e.Protocol),delete e.Protocol),I(v({},e),{Schema:"peer",ID:lr(e.ID),Addrs:n,Protocols:t})}catch(t){jn.error("could not conform record to peer schema",t)}}#t(e,t,n){if(t!=null||this.filterAddrs!=null){let o=t?.join(",")??this.filterAddrs?.join(",")??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){let o=n?.join(",")??this.filterProtocols?.join(",")??"";o!==""&&e.searchParams.set("filter-protocols",o)}}#r(e,t){return f(this,null,function*(){let n=t.method??"GET",o=`${n}-${e}`;if(n==="GET"){let c=yield this.cache?.match(e);if(c!=null){if(parseInt(c.headers.get("x-cache-expires")??"0",10)>Date.now())return jn("returning cached response for %s",o),c;yield this.cache?.delete(e)}}let i=this.inFlightRequests.get(o);if(i!=null){let c=yield i;return jn("deduplicating outgoing request for %s",o),c.clone()}let s=fetch(e,t).then(c=>f(this,null,function*(){if(this.cache!=null&&c.ok&&n==="GET"){let l=Date.now()+this.cacheTTL,u=new Headers(c.headers);u.set("x-cache-expires",l.toString());let d=new Response(c.clone().body,{status:c.status,statusText:c.statusText,headers:u});yield this.cache.put(e,d)}return c})).finally(()=>{this.inFlightRequests.delete(o)});return this.inFlightRequests.set(o,s),yield s})}};function aK(r,e={}){return new m6(new URL(r),e)}function jT(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}var cK="[a-fA-F\\d:]",Hu=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${cK})|(?<=${cK})(?=\\s|$))`:"",xa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",nn="[a-fA-F\\d]{1,4}",g6=`
(?:
(?:${nn}:){7}(?:${nn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${nn}:){6}(?:${xa}|:${nn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${nn}:){5}(?::${xa}|(?::${nn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${nn}:){4}(?:(?::${nn}){0,1}:${xa}|(?::${nn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${nn}:){3}(?:(?::${nn}){0,2}:${xa}|(?::${nn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${nn}:){2}(?:(?::${nn}){0,3}:${xa}|(?::${nn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${nn}:){1}(?:(?::${nn}){0,4}:${xa}|(?::${nn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${nn}){0,5}:${xa}|(?::${nn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),S0e=new RegExp(`(?:^${xa}$)|(?:^${g6}$)`),C0e=new RegExp(`^${xa}$`),I0e=new RegExp(`^${g6}$`),HT=r=>r&&r.exact?S0e:new RegExp(`(?:${Hu(r)}${xa}${Hu(r)})|(?:${Hu(r)}${g6}${Hu(r)})`,"g");HT.v4=r=>r&&r.exact?C0e:new RegExp(`${Hu(r)}${xa}${Hu(r)}`,"g");HT.v6=r=>r&&r.exact?I0e:new RegExp(`${Hu(r)}${g6}${Hu(r)}`,"g");var $T=HT;function zT(r){let e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}function lK(){return!1}var{toString:A0e}=Object.prototype;function qT(r){return A0e.call(r)==="[object RegExp]"}var uK={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function KT(r,e={}){if(!qT(r))throw new TypeError("Expected a RegExp instance");let t=Object.keys(uK).map(o=>(typeof e[o]=="boolean"?e[o]:r[o])?uK[o]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function GT(r,e,{timeout:t}={}){try{return zT(()=>KT(r).test(e),{timeout:t})()}catch(n){if(lK(n))return!1;throw n}}var D0e=15,T0e=45,dK={timeout:400};function WT(r){return r.length>T0e?!1:GT($T.v6({exact:!0}),r,dK)}function fK(r){return r.length>D0e?!1:GT($T.v4({exact:!0}),r,dK)}var pK={http:"80",https:"443",ws:"80",wss:"443"},P0e=["http","https","ws","wss"];function hK(r,e){e=e??{};let t=e.defaultDnsType??"dns",{scheme:n,hostname:o,port:i,path:s}=M0e(r),a=[k0e(o,t),R0e(i,n),N0e(n)];s!=null&&a.push(O0e(s));let c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return Ee(c)}function M0e(r){let[e]=r.split(":");P0e.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:o,pathname:i,search:s}=new URL(r);if(o==null||o===""){let c=L0e(e);c!=null&&(o=c),c==null&&t==="http:"&&(o="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),s!=null&&s!==""&&(a=a??"",a+=s),{scheme:e,hostname:n,port:o,path:a}}function k0e(r,e){if(!(r==null||r==="")){if(fK(r))return["ip4",r];if(WT(r))return["ip6",r];if(r[0]==="["){let t=r.substring(1,r.length-1);if(WT(t))return["ip6",t]}return[e,r]}}function R0e(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function N0e(r){if(r.match(/^tcp$|^udp$/)==null)return r==="https"?["/tls/http"]:r==="wss"?["/tls/ws"]:[r]}function O0e(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function L0e(r){if(!(r==null||r===""||pK[r]==null))return pK[r]}var F0e=["https://trustless-gateway.link","https://4everland.io"],B0e=2336;function U0e(r){return r=r.toString(),{id:va(le.createV1(B0e,En.digest(ee(r)))),multiaddrs:[hK(r)]}}var YT=class{gateways;shuffle;constructor(e={}){this.gateways=(e.gateways??F0e).map(t=>U0e(t)),this.shuffle=e.shuffle??!0}findProviders(e,t){return k(this,null,function*(){yield*J((this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(n=>I(v({},n),{protocols:["transport-ipfs-gateway-http"]})))})}};function XT(r={}){return new YT(r)}var QT=class{libp2p;constructor(e){this.libp2p=e}provide(e,t){return f(this,null,function*(){yield this.libp2p.contentRouting.provide(e,t)})}cancelReprovide(e,t){return f(this,null,function*(){yield this.libp2p.contentRouting.cancelReprovide(e,t)})}findProviders(e,t){return k(this,null,function*(){yield*J(this.libp2p.contentRouting.findProviders(e,t))})}put(e,t,n){return f(this,null,function*(){yield this.libp2p.contentRouting.put(e,t,n)})}get(e,t){return f(this,null,function*(){return this.libp2p.contentRouting.get(e,t)})}findPeer(e,t){return f(this,null,function*(){return this.libp2p.peerRouting.findPeer(e,t)})}getClosestPeers(e,t){return k(this,null,function*(){yield*J(this.libp2p.peerRouting.getClosestPeers(e,t))})}};function ZT(r){return new QT(r)}var V2=class extends aa{data;constructor(){super(),this.data=new Map}put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(rs.encode(e.multihash.bytes),t),e}get(e,t){t?.signal?.throwIfAborted();let n=this.data.get(rs.encode(e.multihash.bytes));if(n==null)throw new ti;return n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(rs.encode(e.multihash.bytes))}delete(e,t){return f(this,null,function*(){t?.signal?.throwIfAborted(),this.data.delete(rs.encode(e.multihash.bytes))})}getAll(e){return k(this,null,function*(){e?.signal?.throwIfAborted();for(let[t,n]of this.data.entries())yield{cid:le.createV1(Pr,Ft(rs.decode(t))),block:n},e?.signal?.throwIfAborted()})}};var tet=Mt("blockstore:core:tiered");var mK="SHARDING";function j0e(r){return r[Symbol.asyncIterator]!=null}function H0e(r){if(j0e(r))return f(null,null,function*(){let t=[];try{for(var n=O(r),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t.push(a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t});let e=[];for(let t of r)e.push(t);return e}var Ea=H0e;function $0e(r){return r[Symbol.asyncIterator]!=null}function z0e(r,e){return $0e(r)?function(){return k(this,null,function*(){let t=yield new C(Ea(r));yield*J(t.sort(e))})}():function*(){let t=Ea(r);yield*J(t.sort(e))}()}var np=z0e;var _a=class{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}putMany(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let{key:c,value:l}=s.value;yield new C(this.put(c,l,t)),yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}getMany(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;yield{key:c,value:yield new C(this.get(c,t))}}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}deleteMany(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;yield new C(this.delete(c,t)),yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:n=>f(this,null,function*(){yield ei(this.putMany(e,n)),e=[],yield ei(this.deleteMany(t,n)),t=[]})}}_all(e,t){return k(this,null,function*(){throw new Error("._all is not implemented")})}_allKeys(e,t){return k(this,null,function*(){throw new Error("._allKeys is not implemented")})}query(e,t){let n=this._all(e,t);if(e.prefix!=null){let o=e.prefix;n=lo(n,i=>i.key.toString().startsWith(o))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>lo(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>np(o,i),n)),e.offset!=null){let o=0,i=e.offset;n=lo(n,()=>o++>=i)}return e.limit!=null&&(n=Uu(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){let o=e.prefix;n=lo(n,i=>i.toString().startsWith(o))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>lo(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>np(o,i),n)),e.offset!=null){let o=e.offset,i=0;n=lo(n,()=>i++>=o)}return e.limit!=null&&(n=Uu(n,e.limit)),n}};var op=class extends _a{data;constructor(){super(),this.data=new Map}put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(e.toString(),t),e}get(e,t){t?.signal?.throwIfAborted();let n=this.data.get(e.toString());if(n==null)throw new ti;return n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(e.toString())}delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(e.toString())}*_all(e,t){t?.signal?.throwIfAborted();for(let[n,o]of this.data.entries())yield{key:new Ut(n),value:o},t?.signal?.throwIfAborted()}*_allKeys(e,t){t?.signal?.throwIfAborted();for(let n of this.data.keys())yield new Ut(n),t?.signal?.throwIfAborted()}};var jet=new Ut(mK);var ttt=Mt("datastore:core:tiered");function Dg(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}var{hasOwnProperty:vK}=Object.prototype,{propertyIsEnumerable:q0e}=Object,Tg=(r,e,t)=>{Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})},K0e=void 0,yK={concatArrays:!1,ignoreUndefined:!1},y6=r=>{let e=[];for(let t in r)vK.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)q0e.call(r,n)&&e.push(n)}return e};function Pg(r){return Array.isArray(r)?G0e(r):Dg(r)?W0e(r):r}function G0e(r){let e=r.slice(0,0);return y6(r).forEach(t=>{Tg(e,t,Pg(r[t]))}),e}function W0e(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return y6(r).forEach(t=>{Tg(e,t,Pg(r[t]))}),e}var wK=(r,e,t,n)=>(t.forEach(o=>{typeof e[o]>"u"&&n.ignoreUndefined||(o in r&&r[o]!==Object.getPrototypeOf(r)?Tg(r,o,JT(r[o],e[o],n)):Tg(r,o,Pg(e[o])))}),r),Y0e=(r,e,t)=>{let n=r.slice(0,0),o=0;return[r,e].forEach(i=>{let s=[];for(let a=0;a<i.length;a++)vK.call(i,a)&&(s.push(String(a)),i===r?Tg(n,o++,i[a]):Tg(n,o++,Pg(i[a])));n=wK(n,i,y6(i).filter(a=>!s.includes(a)),t)}),n};function JT(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?Y0e(r,e,t):!Dg(e)||!Dg(r)?Pg(e):wK(r,e,y6(e),t)}function Rr(...r){let e=JT(Pg(yK),this!==K0e&&this||{},yK),t={_:{}};for(let n of r)if(n!==void 0){if(!Dg(n))throw new TypeError("`"+n+"` is not an Option Object");t=JT(t,{_:n},e)}return t._}var bG=_r(DK(),1);var Mg={};Mn(Mg,{create:()=>c1e,derivedEmptyPasswordKey:()=>v6});var v6={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function c1e(r){let e=r?.algorithm??"AES-GCM",t=r?.keyLength??16,n=r?.nonceLength??12,o=r?.digest??"SHA-256",i=r?.saltLength??16,s=r?.iterations??32767,a=Jr.get();t*=8;function c(d,h){return f(this,null,function*(){let p=a.getRandomValues(new Uint8Array(i)),m=a.getRandomValues(new Uint8Array(n)),w={name:e,iv:m};typeof h=="string"&&(h=ee(h));let E;if(h.length===0){E=yield a.subtle.importKey("jwk",v6,{name:"AES-GCM"},!0,["encrypt"]);try{let A={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},M=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);E=yield a.subtle.deriveKey(A,M,{name:e,length:t},!0,["encrypt"])}catch{E=yield a.subtle.importKey("jwk",v6,{name:"AES-GCM"},!0,["encrypt"])}}else{let A={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},M=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);E=yield a.subtle.deriveKey(A,M,{name:e,length:t},!0,["encrypt"])}let S=yield a.subtle.encrypt(w,E,d);return Gt([p,w.iv,new Uint8Array(S)])})}function l(d,h){return f(this,null,function*(){let p=d.subarray(0,i),m=d.subarray(i,i+n),w=d.subarray(i+n),E={name:e,iv:m};typeof h=="string"&&(h=ee(h));let S;if(h.length===0)try{let M={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},L=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);S=yield a.subtle.deriveKey(M,L,{name:e,length:t},!0,["decrypt"])}catch{S=yield a.subtle.importKey("jwk",v6,{name:"AES-GCM"},!0,["decrypt"])}else{let M={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},L=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);S=yield a.subtle.deriveKey(M,L,{name:e,length:t},!0,["decrypt"])}let A=yield a.subtle.decrypt(E,S,w);return new Uint8Array(A)})}return{encrypt:c,decrypt:l}}var Ts={};Mn(Ts,{Any:()=>gc,BaseBlock:()=>Hn,BaseStringBlock:()=>UK,BitString:()=>Sa,BmpString:()=>lp,Boolean:()=>ap,CharacterString:()=>vp,Choice:()=>Ng,Constructed:()=>pn,DATE:()=>G2,DateTime:()=>Y2,Duration:()=>X2,EndOfContent:()=>z2,Enumerated:()=>cp,GeneralString:()=>yp,GeneralizedTime:()=>wp,GraphicString:()=>gp,HexBlock:()=>yc,IA5String:()=>mp,Integer:()=>qi,Null:()=>ai,NumericString:()=>dp,ObjectIdentifier:()=>Ki,OctetString:()=>yo,Primitive:()=>Tl,PrintableString:()=>fp,RawData:()=>nP,RelativeObjectIdentifier:()=>K2,Repeated:()=>bp,Sequence:()=>pr,Set:()=>ci,TIME:()=>Q2,TeletexString:()=>pp,TimeOfDay:()=>W2,UTCTime:()=>Ku,UniversalString:()=>up,Utf8String:()=>As,ValueBlock:()=>li,VideotexString:()=>hp,ViewWriter:()=>Rg,VisibleString:()=>qu,compareSchema:()=>zu,fromBER:()=>Gi,verifySchema:()=>z1e});var mt=_r(Dl());function ip(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function $u(r,e,t=-1){let n=t,o=r,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(r<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let l=new Uint8Array(c);for(let u=a-1;u>=0;u--){let d=Math.pow(2,u*e);l[i-u-1]=Math.floor(o/d),o-=l[i-u-1]*d}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function b6(...r){let e=0,t=0;for(let i of r)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of r)o.set(i,t),t+=i.length;return o}function tP(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let n=ip(t,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,ip(i,8)-n}function TK(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let s=t-e,a=$u(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=$u(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function PK(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function ii(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(t)}var Ntt=Math.log(2);function x6(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function oP(r){let e=0,t=0;for(let o=0;o<r.length;o++){let i=r[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<r.length;o++){let i=r[o];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function Pl(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var Rg=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return oP(this.items)}},j2=[new Uint8Array([1])],MK="0123456789",rP="name",kK="valueHexView",v1e="isHexOnly",w1e="idBlock",b1e="tagClass",x1e="tagNumber",E1e="isConstructed",_1e="fromBER",S1e="toBER",C1e="local",si="",Ca=new ArrayBuffer(0),E6=new Uint8Array(0),$2="EndOfContent",LK="OCTET STRING",FK="BIT STRING";function yc(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?mt.BufferSourceConverter.toUint8Array(i.valueHex):E6}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Pl(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Ca)}toJSON(){return I(v({},super.toJSON()),{isHexOnly:this.isHexOnly,valueHex:mt.Convert.ToHex(this.valueHexView)})}},e.NAME="hexBlock",e}var Og=(()=>{class r{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(t){this.valueBeforeDecodeView=new Uint8Array(t)}constructor({blockLength:t=0,error:n=si,warnings:o=[],valueBeforeDecode:i=E6}={}){this.blockLength=t,this.error=n,this.warnings=o,this.valueBeforeDecodeView=mt.BufferSourceConverter.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:mt.Convert.ToHex(this.valueBeforeDecodeView)}}}return r.NAME="baseBlock",r})(),li=(()=>{class r extends Og{fromBER(t,n,o){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}return r.NAME="valueBlock",r})(),I1e=(()=>{class r extends yc(Og){constructor({idBlock:t={}}={}){var n,o,i,s;super(),t?(this.isHexOnly=(n=t.isHexOnly)!==null&&n!==void 0?n:!1,this.valueHexView=t.valueHex?mt.BufferSourceConverter.toUint8Array(t.valueHex):E6,this.tagClass=(o=t.tagClass)!==null&&o!==void 0?o:-1,this.tagNumber=(i=t.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=t.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(t=!1){let n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",Ca}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){let i=new Uint8Array(1);if(!t){let s=this.tagNumber;s&=31,n|=s,i[0]=n}return i.buffer}if(!this.isHexOnly){let i=$u(this.tagNumber,7),s=new Uint8Array(i),a=i.byteLength,c=new Uint8Array(a+1);if(c[0]=n|31,!t){for(let l=0;l<a-1;l++)c[l+1]=s[l]|128;c[a]=s[a-1]}return c.buffer}let o=new Uint8Array(this.valueHexView.byteLength+1);if(o[0]=n|31,!t){let i=this.valueHexView;for(let s=0;s<i.length-1;s++)o[s+1]=i[s]|128;o[this.valueHexView.byteLength]=i[i.length-1]}return o.buffer}fromBER(t,n,o){let i=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,i,n,o))return-1;let s=i.subarray(n,n+o);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;let c=s[0]&31;if(c!==31)this.tagNumber=c,this.blockLength=1;else{let l=1,u=this.valueHexView=new Uint8Array(255),d=255;for(;s[l]&128;){if(u[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===d){d+=255;let p=new Uint8Array(d);for(let m=0;m<u.length;m++)p[m]=u[m];u=this.valueHexView=new Uint8Array(d)}}this.blockLength=l+1,u[l-1]=s[l]&127;let h=new Uint8Array(l);for(let p=0;p<l;p++)h[p]=u[p];u=this.valueHexView=new Uint8Array(l),u.set(h),this.blockLength<=9?this.tagNumber=ip(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return n+this.blockLength}toJSON(){return I(v({},super.toJSON()),{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}return r.NAME="identificationBlock",r})(),A1e=(()=>{class r extends Og{constructor({lenBlock:t={}}={}){var n,o,i;super(),this.isIndefiniteForm=(n=t.isIndefiniteForm)!==null&&n!==void 0?n:!1,this.longFormUsed=(o=t.longFormUsed)!==null&&o!==void 0?o:!1,this.length=(i=t.length)!==null&&i!==void 0?i:0}fromBER(t,n,o){let i=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,i,n,o))return-1;let s=i.subarray(n,n+o);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,n+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,n+this.blockLength;let a=s[0]&127;if(a>8)return this.error="Too big integer",-1;if(a+1>s.length)return this.error="End of input reached before message was fully decoded",-1;let c=n+1,l=i.subarray(c,c+a);return l[a-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ip(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,n+this.blockLength}toBER(t=!1){let n,o;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return n=new ArrayBuffer(1),t===!1&&(o=new Uint8Array(n),o[0]=128),n;if(this.longFormUsed){let i=$u(this.length,8);if(i.byteLength>127)return this.error="Too big length",Ca;if(n=new ArrayBuffer(i.byteLength+1),t)return n;let s=new Uint8Array(i);o=new Uint8Array(n),o[0]=i.byteLength|128;for(let a=0;a<i.byteLength;a++)o[a+1]=s[a];return n}return n=new ArrayBuffer(1),t===!1&&(o=new Uint8Array(n),o[0]=this.length),n}toJSON(){return I(v({},super.toJSON()),{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}return r.NAME="lengthBlock",r})(),Te={},Hn=(()=>{class r extends Og{constructor(a={},s){var c=a,{name:t=si,optional:n=!1,primitiveSchema:o}=c,i=gr(c,["name","optional","primitiveSchema"]);super(i),this.name=t,this.optional=n,o&&(this.primitiveSchema=o),this.idBlock=new I1e(i),this.lenBlock=new A1e(i),this.valueBlock=s?new s(i):new li(i)}fromBER(t,n,o){let i=this.valueBlock.fromBER(t,n,this.lenBlock.isIndefiniteForm?o:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(t,n){let o=n||new Rg;n||BK(this);let i=this.idBlock.toBER(t);if(o.write(i),this.lenBlock.isIndefiniteForm)o.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(t,o),o.write(new ArrayBuffer(2));else{let s=this.valueBlock.toBER(t);this.lenBlock.length=s.byteLength;let a=this.lenBlock.toBER(t);o.write(a),o.write(s)}return n?Ca:o.final()}toJSON(){let t=I(v({},super.toJSON()),{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(t.primitiveSchema=this.primitiveSchema.toJSON()),t}toString(t="ascii"){return t==="ascii"?this.onAsciiEncoding():mt.Convert.ToHex(this.toBER())}onAsciiEncoding(){let t=this.constructor.NAME,n=mt.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${t} : ${n}`}isEqual(t){if(this===t)return!0;if(!(t instanceof this.constructor))return!1;let n=this.toBER(),o=t.toBER();return PK(n,o)}}return r.NAME="BaseBlock",r})();function BK(r){var e;if(r instanceof Te.Constructed)for(let t of r.valueBlock.value)BK(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var UK=(()=>{class r extends Hn{getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}constructor(i={},o){var s=i,{value:t=si}=s,n=gr(s,["value"]);super(n,o),t&&this.fromString(t)}fromBER(t,n,o){let i=this.valueBlock.fromBER(t,n,this.lenBlock.isIndefiniteForm?o:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}return r.NAME="BaseStringBlock",r})(),D1e=(()=>{class r extends yc(li){constructor(o={}){var i=o,{isHexOnly:t=!0}=i,n=gr(i,["isHexOnly"]);super(n),this.isHexOnly=t}}return r.NAME="PrimitiveValueBlock",r})(),VK,Tl=class extends Hn{constructor(e={}){super(e,D1e),this.idBlock.isConstructed=!1}};VK=Tl;Te.Primitive=VK;Tl.NAME="PRIMITIVE";function T1e(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Lg(r,e=0,t=r.length){let n=e,o=new Hn({},li),i=new Og;if(!Pl(i,r,e,t))return o.error=i.error,{offset:-1,result:o};if(!r.subarray(e,e+t).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(r,e,t);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,t-=o.idBlock.blockLength,a=o.lenBlock.fromBER(r,e,t),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,t-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=Hn;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=Te.EndOfContent;break;case 1:c=Te.Boolean;break;case 2:c=Te.Integer;break;case 3:c=Te.BitString;break;case 4:c=Te.OctetString;break;case 5:c=Te.Null;break;case 6:c=Te.ObjectIdentifier;break;case 10:c=Te.Enumerated;break;case 12:c=Te.Utf8String;break;case 13:c=Te.RelativeObjectIdentifier;break;case 14:c=Te.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=Te.Sequence;break;case 17:c=Te.Set;break;case 18:c=Te.NumericString;break;case 19:c=Te.PrintableString;break;case 20:c=Te.TeletexString;break;case 21:c=Te.VideotexString;break;case 22:c=Te.IA5String;break;case 23:c=Te.UTCTime;break;case 24:c=Te.GeneralizedTime;break;case 25:c=Te.GraphicString;break;case 26:c=Te.VisibleString;break;case 27:c=Te.GeneralString;break;case 28:c=Te.UniversalString;break;case 29:c=Te.CharacterString;break;case 30:c=Te.BmpString;break;case 31:c=Te.DATE;break;case 32:c=Te.TimeOfDay;break;case 33:c=Te.DateTime;break;case 34:c=Te.Duration;break;default:{let l=o.idBlock.isConstructed?new Te.Constructed:new Te.Primitive;l.idBlock=o.idBlock,l.lenBlock=o.lenBlock,l.warnings=o.warnings,o=l}}break;case 2:case 3:case 4:default:c=o.idBlock.isConstructed?Te.Constructed:Te.Primitive}return o=T1e(o,c),a=o.fromBER(r,e,o.lenBlock.isIndefiniteForm?t:o.lenBlock.length),o.valueBeforeDecodeView=r.subarray(n,n+o.blockLength),{offset:a,result:o}}function Gi(r){if(!r.byteLength){let e=new Hn({},li);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Lg(mt.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function P1e(r,e){return r?1:e}var sp=(()=>{class r extends li{constructor(i={}){var s=i,{value:t=[],isIndefiniteForm:n=!1}=s,o=gr(s,["value","isIndefiniteForm"]);super(o),this.value=t,this.isIndefiniteForm=n}fromBER(t,n,o){let i=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,i,n,o))return-1;if(this.valueBeforeDecodeView=i.subarray(n,n+o),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),n;let s=n;for(;P1e(this.isIndefiniteForm,o)>0;){let a=Lg(i,s,o);if(a.offset===-1)return this.error=a.result.error,this.warnings.concat(a.result.warnings),-1;if(s=a.offset,this.blockLength+=a.result.blockLength,o-=a.result.blockLength,this.value.push(a.result),this.isIndefiniteForm&&a.result.constructor.NAME===$2)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===$2?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(t,n){let o=n||new Rg;for(let i=0;i<this.value.length;i++)this.value[i].toBER(t,o);return n?Ca:o.final()}toJSON(){let t=I(v({},super.toJSON()),{isIndefiniteForm:this.isIndefiniteForm,value:[]});for(let n of this.value)t.value.push(n.toJSON());return t}}return r.NAME="ConstructedValueBlock",r})(),jK,pn=class extends Hn{constructor(e={}){super(e,sp),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};jK=pn;Te.Constructed=jK;pn.NAME="CONSTRUCTED";var M1e=(()=>{class r extends li{fromBER(t,n,o){return n}toBER(t){return Ca}}return r.override="EndOfContentValueBlock",r})(),HK,z2=class extends Hn{constructor(e={}){super(e,M1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};HK=z2;Te.EndOfContent=HK;z2.NAME=$2;var $K,ai=class extends Hn{constructor(e={}){super(e,li),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};$K=ai;Te.Null=$K;ai.NAME="NULL";var k1e=(()=>{class r extends yc(li){get value(){for(let t of this.valueHexView)if(t>0)return!0;return!1}set value(t){this.valueHexView[0]=t?255:0}constructor(o={}){var i=o,{value:t}=i,n=gr(i,["value"]);super(n),n.valueHex?this.valueHexView=mt.BufferSourceConverter.toUint8Array(n.valueHex):this.valueHexView=new Uint8Array(1),t&&(this.value=t)}fromBER(t,n,o){let i=mt.BufferSourceConverter.toUint8Array(t);return Pl(this,i,n,o)?(this.valueHexView=i.subarray(n,n+o),o>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,tP.call(this),this.blockLength=o,n+o):-1}toBER(){return this.valueHexView.slice()}toJSON(){return I(v({},super.toJSON()),{value:this.value})}}return r.NAME="BooleanValueBlock",r})(),zK,ap=class extends Hn{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,k1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};zK=ap;Te.Boolean=zK;ap.NAME="BOOLEAN";var R1e=(()=>{class r extends yc(sp){constructor(o={}){var i=o,{isConstructed:t=!1}=i,n=gr(i,["isConstructed"]);super(n),this.isConstructed=t}fromBER(t,n,o){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=sp.prototype.fromBER.call(this,t,n,o),i===-1)return i;for(let s=0;s<this.value.length;s++){let a=this.value[s].constructor.NAME;if(a===$2){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(a!==LK)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(t,n,o),this.blockLength=o;return i}toBER(t,n){return this.isConstructed?sp.prototype.toBER.call(this,t,n):t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return I(v({},super.toJSON()),{isConstructed:this.isConstructed})}}return r.NAME="OctetStringValueBlock",r})(),iP,yo=class extends Hn{constructor(o={}){var i=o,{idBlock:e={},lenBlock:t={}}=i,n=gr(i,["idBlock","lenBlock"]);var s,a;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((a=n.value)===null||a===void 0)&&a.length)),super(v({idBlock:v({isConstructed:n.isConstructed},e),lenBlock:I(v({},t),{isIndefiniteForm:!!n.isIndefiniteForm})},n),R1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){let s=Lg(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return pn.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=mt.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof iP&&e.push(t.valueBlock.valueHexView);return mt.BufferSourceConverter.concat(e)}};iP=yo;Te.OctetString=iP;yo.NAME=LK;var N1e=(()=>{class r extends yc(sp){constructor(i={}){var s=i,{unusedBits:t=0,isConstructed:n=!1}=s,o=gr(s,["unusedBits","isConstructed"]);super(o),this.unusedBits=t,this.isConstructed=n,this.blockLength=this.valueHexView.byteLength}fromBER(t,n,o){if(!o)return n;let i=-1;if(this.isConstructed){if(i=sp.prototype.fromBER.call(this,t,n,o),i===-1)return i;for(let c of this.value){let l=c.constructor.NAME;if(l===$2){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==FK)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let u=c.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return i}let s=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,s,n,o))return-1;let a=s.subarray(n,n+o);if(this.unusedBits=a[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let c=a.subarray(1);try{if(c.byteLength){let l=Lg(c,0,c.byteLength);l.offset!==-1&&l.offset===o-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=a.subarray(1),this.blockLength=a.length,n+o}toBER(t,n){if(this.isConstructed)return sp.prototype.toBER.call(this,t,n);if(t)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Ca;let o=new Uint8Array(this.valueHexView.length+1);return o[0]=this.unusedBits,o.set(this.valueHexView,1),o.buffer}toJSON(){return I(v({},super.toJSON()),{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}return r.NAME="BitStringValueBlock",r})(),qK,Sa=class extends Hn{constructor(o={}){var i=o,{idBlock:e={},lenBlock:t={}}=i,n=gr(i,["idBlock","lenBlock"]);var s,a;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((a=n.value)===null||a===void 0)&&a.length)),super(v({idBlock:v({isConstructed:n.isConstructed},e),lenBlock:I(v({},t),{isIndefiniteForm:!!n.isIndefiniteForm})},n),N1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return pn.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let s of t)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};qK=Sa;Te.BitString=qK;Sa.NAME=FK;var KK;function O1e(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l=0,u=c<s?s:c,d=0;for(let h=u;h>=0;h--,d++){switch(!0){case d<a.length:l=i[s-d]+a[c-d]+t[0];break;default:l=i[s-d]+t[0]}switch(t[0]=l/10,!0){case d>=i.length:i=b6(new Uint8Array([l%10]),i);break;default:i[s-d]=l%10}}return t[0]>0&&(i=b6(t,i)),i}function RK(r){if(r>=j2.length)for(let e=j2.length;e<=r;e++){let t=new Uint8Array([0]),n=j2[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+t[0]]);t[0]=i[0]/10,n[o]=i[0]%10}t[0]>0&&(n=b6(t,n)),j2.push(n)}return j2[r]}function L1e(r,e){let t=0,n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l,u=0;for(let d=c;d>=0;d--,u++)switch(l=i[s-u]-a[c-u]-t,!0){case l<0:t=1,i[s-u]=l+10;break;default:t=0,i[s-u]=l}if(t>0)for(let d=s-c+1;d>=0;d--,u++)if(l=i[s-u]-t,l<0)t=1,i[s-u]=l+10;else{t=0,i[s-u]=l;break}return i.slice()}var q2=class extends yc(li){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=tP.call(this)))}constructor(n={}){var o=n,{value:e}=o,t=gr(o,["value"]);super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(TK(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,o=0){let i=this.fromBER(e,t,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let o=super.fromBER(e,t,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec})}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let l=0;l<8;l++){if((o&1)===1)switch(n){case e:t=L1e(RK(n),t),s="-";break;default:t=O1e(t,RK(n))}n++,o>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(s+=MK.charAt(t[c]));return a===!1&&(s+=MK.charAt(0)),s}};KK=q2;q2.NAME="IntegerValueBlock";Object.defineProperty(KK.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var H2,qi=class extends Hn{constructor(e={}){super(e,q2),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return x6(),BigInt(this.valueBlock.toString())}static fromBigInt(e){x6();let t=BigInt(e),n=new Rg,o=t.toString(16).replace(/^-/,""),i=new Uint8Array(mt.Convert.FromHex(o));if(t<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let l=BigInt(`0x${mt.Convert.ToHex(a)}`)+t,u=mt.BufferSourceConverter.toUint8Array(mt.Convert.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new H2({valueHex:n.final()})}convertToDER(){let e=new H2({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new H2({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};H2=qi;Te.Integer=H2;qi.NAME="INTEGER";var GK,cp=class extends qi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};GK=cp;Te.Enumerated=GK;cp.NAME="ENUMERATED";var NK=(()=>{class r extends yc(li){constructor(i={}){var s=i,{valueDec:t=-1,isFirstSid:n=!1}=s,o=gr(s,["valueDec","isFirstSid"]);super(o),this.valueDec=t,this.isFirstSid=n}fromBER(t,n,o){if(!o)return n;let i=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,i,n,o))return-1;let s=i.subarray(n,n+o);this.valueHexView=new Uint8Array(o);for(let c=0;c<o&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let a=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)a[c]=this.valueHexView[c];return this.valueHexView=a,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ip(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),n+this.blockLength)}set valueBigInt(t){x6();let n=BigInt(t).toString(2);for(;n.length%7;)n="0"+n;let o=new Uint8Array(n.length/7);for(let i=0;i<o.length;i++)o[i]=parseInt(n.slice(i*7,i*7+7),2)+(i+1<o.length?128:0);this.fromBER(o.buffer,0,o.length)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=i[a]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let n=$u(this.valueDec,7);if(n.byteLength===0)return this.error="Error during encoding SID value",Ca;let o=new Uint8Array(n.byteLength);if(!t){let i=new Uint8Array(n),s=n.byteLength-1;for(let a=0;a<s;a++)o[a]=i[a]|128;o[s]=i[s]}return o}toString(){let t="";if(this.isHexOnly)t=mt.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let n=this.valueDec;this.valueDec<=39?t="0.":this.valueDec<=79?(t="1.",n-=40):(t="2.",n-=80),t+=n.toString()}else t=this.valueDec.toString();return t}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}return r.NAME="sidBlock",r})(),F1e=(()=>{class r extends li{constructor(o={}){var i=o,{value:t=si}=i,n=gr(i,["value"]);super(n),this.value=[],t&&this.fromString(t)}fromBER(t,n,o){let i=n;for(;o>0;){let s=new NK;if(i=s.fromBER(t,i,o),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,o-=s.blockLength,this.value.push(s)}return i}toBER(t){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(t);if(i.byteLength===0)return this.error=this.value[o].error,Ca;n.push(i)}return oP(n)}fromString(t){this.value=[];let n=0,o=0,i="",s=!1;do if(o=t.indexOf(".",n),o===-1?i=t.substring(n):i=t.substring(n,o),n=o+1,s){let a=this.value[0],c=0;switch(a.valueDec){case 0:break;case 1:c=40;break;case 2:c=80;break;default:this.value=[];return}let l=parseInt(i,10);if(isNaN(l))return;a.valueDec=l+c,s=!1}else{let a=new NK;if(i>Number.MAX_SAFE_INTEGER){x6();let c=BigInt(i);a.valueBigInt=c}else if(a.valueDec=parseInt(i,10),isNaN(a.valueDec))return;this.value.length||(a.isFirstSid=!0,s=!0),this.value.push(a)}while(o!==-1)}toString(){let t="",n=!1;for(let o=0;o<this.value.length;o++){n=this.value[o].isHexOnly;let i=this.value[o].toString();o!==0&&(t=`${t}.`),n?(i=`{${i}}`,this.value[o].isFirstSid?t=`2.{${i} - 80}`:t+=i):t+=i}return t}toJSON(){let t=I(v({},super.toJSON()),{value:this.toString(),sidArray:[]});for(let n=0;n<this.value.length;n++)t.sidArray.push(this.value[n].toJSON());return t}}return r.NAME="ObjectIdentifierValueBlock",r})(),WK,Ki=class extends Hn{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,F1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return I(v({},super.toJSON()),{value:this.getValue()})}};WK=Ki;Te.ObjectIdentifier=WK;Ki.NAME="OBJECT IDENTIFIER";var OK=(()=>{class r extends yc(Og){constructor(o={}){var i=o,{valueDec:t=0}=i,n=gr(i,["valueDec"]);super(n),this.valueDec=t}fromBER(t,n,o){if(o===0)return n;let i=mt.BufferSourceConverter.toUint8Array(t);if(!Pl(this,i,n,o))return-1;let s=i.subarray(n,n+o);this.valueHexView=new Uint8Array(o);for(let c=0;c<o&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let a=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)a[c]=this.valueHexView[c];return this.valueHexView=a,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ip(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),n+this.blockLength)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=i[a]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let n=$u(this.valueDec,7);if(n.byteLength===0)return this.error="Error during encoding SID value",Ca;let o=new Uint8Array(n.byteLength);if(!t){let i=new Uint8Array(n),s=n.byteLength-1;for(let a=0;a<s;a++)o[a]=i[a]|128;o[s]=i[s]}return o.buffer}toString(){let t="";return this.isHexOnly?t=mt.Convert.ToHex(this.valueHexView):t=this.valueDec.toString(),t}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec})}}return r.NAME="relativeSidBlock",r})(),B1e=(()=>{class r extends li{constructor(o={}){var i=o,{value:t=si}=i,n=gr(i,["value"]);super(n),this.value=[],t&&this.fromString(t)}fromBER(t,n,o){let i=n;for(;o>0;){let s=new OK;if(i=s.fromBER(t,i,o),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,o-=s.blockLength,this.value.push(s)}return i}toBER(t,n){let o=[];for(let i=0;i<this.value.length;i++){let s=this.value[i].toBER(t);if(s.byteLength===0)return this.error=this.value[i].error,Ca;o.push(s)}return oP(o)}fromString(t){this.value=[];let n=0,o=0,i="";do{o=t.indexOf(".",n),o===-1?i=t.substring(n):i=t.substring(n,o),n=o+1;let s=new OK;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(o!==-1);return!0}toString(){let t="",n=!1;for(let o=0;o<this.value.length;o++){n=this.value[o].isHexOnly;let i=this.value[o].toString();o!==0&&(t=`${t}.`),n&&(i=`{${i}}`),t+=i}return t}toJSON(){let t=I(v({},super.toJSON()),{value:this.toString(),sidArray:[]});for(let n=0;n<this.value.length;n++)t.sidArray.push(this.value[n].toJSON());return t}}return r.NAME="RelativeObjectIdentifierValueBlock",r})(),YK,K2=class extends Hn{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,B1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return I(v({},super.toJSON()),{value:this.getValue()})}};YK=K2;Te.RelativeObjectIdentifier=YK;K2.NAME="RelativeObjectIdentifier";var XK,pr=class extends pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};XK=pr;Te.Sequence=XK;pr.NAME="SEQUENCE";var QK,ci=class extends pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};QK=ci;Te.Set=QK;ci.NAME="SET";var U1e=(()=>{class r extends yc(li){constructor(n={}){var t=gr(n,[]);super(t),this.isHexOnly=!0,this.value=si}toJSON(){return I(v({},super.toJSON()),{value:this.value})}}return r.NAME="StringValueBlock",r})(),V1e=(()=>{class r extends U1e{}return r.NAME="SimpleStringValueBlock",r})(),Ds=(()=>{class r extends UK{constructor(n={}){var t=gr(n,[]);super(t,V1e)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,mt.BufferSourceConverter.toUint8Array(t))}fromString(t){let n=t.length,o=this.valueBlock.valueHexView=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);this.valueBlock.value=t}}return r.NAME="SIMPLE STRING",r})(),j1e=(()=>{class r extends Ds{fromBuffer(t){this.valueBlock.valueHexView=mt.BufferSourceConverter.toUint8Array(t);try{this.valueBlock.value=mt.Convert.ToUtf8String(t)}catch(n){this.warnings.push(`Error during "decodeURIComponent": ${n}, using raw string`),this.valueBlock.value=mt.Convert.ToBinary(t)}}fromString(t){this.valueBlock.valueHexView=new Uint8Array(mt.Convert.FromUtf8String(t)),this.valueBlock.value=t}}return r.NAME="Utf8StringValueBlock",r})(),ZK,As=class extends j1e{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};ZK=As;Te.Utf8String=ZK;As.NAME="UTF8String";var H1e=(()=>{class r extends Ds{fromBuffer(t){this.valueBlock.value=mt.Convert.ToUtf16String(t),this.valueBlock.valueHexView=mt.BufferSourceConverter.toUint8Array(t)}fromString(t){this.valueBlock.value=t,this.valueBlock.valueHexView=new Uint8Array(mt.Convert.FromUtf16String(t))}}return r.NAME="BmpStringValueBlock",r})(),JK,lp=class extends H1e{constructor(t={}){var e=gr(t,[]);super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};JK=lp;Te.BmpString=JK;lp.NAME="BMPString";var $1e=(()=>{class r extends Ds{fromBuffer(t){let n=ArrayBuffer.isView(t)?t.slice().buffer:t.slice(0),o=new Uint8Array(n);for(let i=0;i<o.length;i+=4)o[i]=o[i+3],o[i+1]=o[i+2],o[i+2]=0,o[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(n))}fromString(t){let n=t.length,o=this.valueBlock.valueHexView=new Uint8Array(n*4);for(let i=0;i<n;i++){let s=$u(t.charCodeAt(i),8),a=new Uint8Array(s);if(a.length>4)continue;let c=4-a.length;for(let l=a.length-1;l>=0;l--)o[i*4+l+c]=a[l]}this.valueBlock.value=t}}return r.NAME="UniversalStringValueBlock",r})(),eG,up=class extends $1e{constructor(t={}){var e=gr(t,[]);super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};eG=up;Te.UniversalString=eG;up.NAME="UniversalString";var tG,dp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};tG=dp;Te.NumericString=tG;dp.NAME="NumericString";var rG,fp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};rG=fp;Te.PrintableString=rG;fp.NAME="PrintableString";var nG,pp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};nG=pp;Te.TeletexString=nG;pp.NAME="TeletexString";var oG,hp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};oG=hp;Te.VideotexString=oG;hp.NAME="VideotexString";var iG,mp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};iG=mp;Te.IA5String=iG;mp.NAME="IA5String";var sG,gp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};sG=gp;Te.GraphicString=sG;gp.NAME="GraphicString";var aG,qu=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};aG=qu;Te.VisibleString=aG;qu.NAME="VisibleString";var cG,yp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};cG=yp;Te.GeneralString=cG;yp.NAME="GeneralString";var lG,vp=class extends Ds{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};lG=vp;Te.CharacterString=lG;vp.NAME="CharacterString";var uG,Ku=class extends qu{constructor(o={}){var i=o,{value:e,valueDate:t}=i,n=gr(i,["value","valueDate"]);if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,mt.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=ii(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=ii(this.month,2),t[2]=ii(this.day,2),t[3]=ii(this.hour,2),t[4]=ii(this.minute,2),t[5]=ii(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return I(v({},super.toJSON()),{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}};uG=Ku;Te.UTCTime=uG;Ku.NAME="UTCTime";var dG,wp=class extends Ku{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,h=n.indexOf("+"),p="";if(h===-1&&(h=n.indexOf("-"),d=-1),h!==-1){if(p=n.substring(h+1),n=n.substring(0,h),p.length!==2&&p.length!==4)throw new Error("Wrong input string for conversion");let m=parseInt(p.substring(0,2),10);if(isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*m,p.length===4){if(m=parseInt(p.substring(2,4),10),isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");c=d*m}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){let d=new Number(`0${n.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),o=n.substring(0,l)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}let u=s.exec(o);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(ii(this.year,4)),t.push(ii(this.month,2)),t.push(ii(this.day,2)),t.push(ii(this.hour,2)),t.push(ii(this.minute,2)),t.push(ii(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(ii(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return I(v({},super.toJSON()),{millisecond:this.millisecond})}};dG=wp;Te.GeneralizedTime=dG;wp.NAME="GeneralizedTime";var fG,G2=class extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};fG=G2;Te.DATE=fG;G2.NAME="DATE";var pG,W2=class extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};pG=W2;Te.TimeOfDay=pG;W2.NAME="TimeOfDay";var hG,Y2=class extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};hG=Y2;Te.DateTime=hG;Y2.NAME="DateTime";var mG,X2=class extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};mG=X2;Te.Duration=mG;X2.NAME="Duration";var gG,Q2=class extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};gG=Q2;Te.TIME=gG;Q2.NAME="TIME";var gc=class{constructor({name:e=si,optional:t=!1}={}){this.name=e,this.optional=t}},Ng=class extends gc{constructor(n={}){var o=n,{value:e=[]}=o,t=gr(o,["value"]);super(t),this.value=e}},bp=class extends gc{constructor(o={}){var i=o,{value:e=new gc,local:t=!1}=i,n=gr(i,["value","local"]);super(n),this.value=e,this.local=t}},nP=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=mt.BufferSourceConverter.toUint8Array(e)}constructor({data:e=E6}={}){this.dataView=mt.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let o=t+n;return this.dataView=mt.BufferSourceConverter.toUint8Array(e).subarray(t,o),o}toBER(e){return this.dataView.slice().buffer}};function zu(r,e,t){if(t instanceof Ng){for(let i of t.value)if(zu(r,e,i).verified)return{verified:!0,result:r};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(rP)&&(i.name=t.name),i}}if(t instanceof gc)return t.hasOwnProperty(rP)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(w1e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(_1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(S1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(b1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(x1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(E1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(v1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(kK in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&(r[t.name]=e)),t instanceof Te.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof bp&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){let l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof bp){if(s=zu(r,e.valueBlock.value[c],t.valueBlock.value[0].value),s.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&delete r[t.name]),s;if(rP in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};C1e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=zu(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),s.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&delete r[t.name]),s;if(s.verified===!1){let c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&kK in e.valueBlock){let i=Lg(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,si),t.name&&(delete r[t.name],s.name=t.name)),s}return zu(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function z1e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=Lg(mt.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:zu(t.result,t.result,e)}function _6(r,e){return f(this,null,function*(){let n=yield Mg.create().encrypt(r,e);return Qr.encode(n)})}function sP(r,e,t){return f(this,null,function*(){if(r.type==="RSA")return W1e(r,e,t);if(r.type==="Ed25519")return q1e(r,e,t);if(r.type==="secp256k1")return K1e(r,e,t);if(r.type==="ECDSA")return G1e(r,e,t);throw new il})}function q1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return _6(Vf(r),e);throw new Q(`export format '${t}' is not supported`)})}function K1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return _6(Vf(r),e);throw new Q("Export format is not supported")})}function G1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return _6(Vf(r),e);throw new Q(`export format '${t}' is not supported`)})}function W1e(r,e,t="pkcs-8"){return f(this,null,function*(){if(t==="pkcs-8")return Y1e(r,e);if(t==="libp2p-key")return _6(Vf(r),e);throw new Q("Export format is not supported")})}function Y1e(r,e){return f(this,null,function*(){let t=Jr.get(),o=new pr({value:[new qi({value:0}),new pr({value:[new Ki({value:"1.2.840.113549.1.1.1"}),new ai]}),new yo({valueHex:r.raw})]}).toBER(),i=new Uint8Array(o,0,o.byteLength),s=Vo(16),a=yield CE(ug,e,s,{c:1e4,dkLen:32}),c=Vo(16),l=yield t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=yield t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),d=new pr({value:[new yo({valueHex:s}),new qi({value:1e4}),new qi({value:32}),new pr({value:[new Ki({value:"1.2.840.113549.2.11"}),new ai]})]}),h=new pr({value:[new Ki({value:"1.2.840.113549.1.5.13"}),new pr({value:[new pr({value:[new Ki({value:"1.2.840.113549.1.5.12"}),d]}),new pr({value:[new Ki({value:"2.16.840.1.101.3.4.1.42"}),new yo({valueHex:c})]})]})]}),m=new pr({value:[h,new yo({valueHex:u})]}).toBER(),w=new Uint8Array(m,0,m.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...ne(w,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)})}function aP(r,e){return f(this,null,function*(){try{let t=yield X1e(r,e);return Fz(t)}catch{}if(!r.includes("BEGIN"))throw new Q("Encrypted key was not a libp2p-key or a PEM file");return Q1e(r,e)})}function X1e(r,e){return f(this,null,function*(){let t=Qr.decode(r);return Mg.create().decrypt(t,e)})}function Q1e(r,e){return f(this,null,function*(){let t=Jr.get(),n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let i=ee(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:s}=Gi(i),{iv:a,salt:c,iterations:l,keySize:u,cipherText:d}=Z1e(s),h=yield CE(ug,e,c,{c:l,dkLen:u}),p=yield t.subtle.importKey("raw",h,"AES-CBC",!1,["decrypt"]),m=Z2(yield t.subtle.decrypt({name:"AES-CBC",iv:a},p,d)),{result:w}=Gi(m);n=wG(w)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){let i=ee(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:s}=Gi(i);n=wG(s)}else throw new Q("Could not parse private key from PEM data");let o=Bz(n);if(o.type!=="RSA")throw new Q("Could not parse RSA private key from PEM data");return o})}function Z1e(r){let e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Q("Only pkcs5PBES2 encrypted private keys are supported");let n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Q("Only pkcs5PBKDF2 key derivation functions are supported");let i=n.valueBlock.value[1],s=Z2(i.valueBlock.value[0].getValue()),a=1e4,c=32;if(i.valueBlock.value.length===3)a=Number(i.valueBlock.value[1].toBigInt()),c=Number(i.valueBlock.value[2].toBigInt());else if(i.valueBlock.value.length===2)throw new Q("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");let l=e.valueBlock.value[1].valueBlock.value[1],u=l.valueBlock.value[0].toString();if(u!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(u!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Q("Only AES-CBC encryption schemes are supported")}}}}let d=Z2(l.valueBlock.value[1].getValue());return{cipherText:Z2(r.valueBlock.value[1].getValue()),salt:s,iterations:a,keySize:c,iv:d}}function wG(r){return Z2(r.valueBlock.value[2].getValue())}function Z2(r){return new Uint8Array(r,0,r.byteLength)}var J1e="/pkcs8/",lP="/info/",J2=new WeakMap,xp={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},cP={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Fg(r){return r==null||typeof r!="string"?!1:r===(0,bG.default)(r.trim())&&r.length>0}function $n(){return f(this,null,function*(){let t=Math.random()*800+200;yield new Promise(n=>setTimeout(n,t))})}function Ep(r){return new Ut(J1e+r)}function Bg(r){return new Ut(lP+r)}function eye(r){return f(this,null,function*(){let e=Vf(r),t=yield xt.digest(e);return Sr.encode(t.bytes).substring(1)})}var S6=class{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=Rr(cP,t),this.self=t.selfKey??"self",this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<xp.minKeyLength)throw new Error(`dek.keyLength must be least ${xp.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<xp.minSaltLength)throw new Error(`dek.saltLength must be least ${xp.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<xp.minIterationCount)throw new Error(`dek.iterationCount must be least ${xp.minIterationCount}`);let n=this.init.pass!=null&&this.init.dek?.salt!=null?w2(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";J2.set(this,{dek:n})}[Symbol.toStringTag]="@libp2p/keychain";[Pt]=["@libp2p/keychain"];static generateOptions(){let e=Object.assign({},cP),t=Math.ceil(xp.minSaltLength/3)*3;return e.dek.salt=ne(Vo(t),"base64"),e}static get options(){return cP}findKeyByName(e){return f(this,null,function*(){if(!Fg(e))throw yield $n(),new Q(`Invalid key name '${e}'`);let t=Bg(e);try{let n=yield this.components.datastore.get(t);return JSON.parse(ne(n))}catch(n){throw yield $n(),this.log.error(n),new Ot(`Key '${e}' does not exist.`)}})}findKeyById(e){return f(this,null,function*(){try{let s={prefix:lP};try{for(var t=O(this.components.datastore.query(s)),n,o,i;n=!(o=yield t.next()).done;n=!1){let a=o.value;let c=JSON.parse(ne(a.value));if(c.id===e)return c}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}throw new Q(`Key with id '${e}' does not exist.`)}catch(s){throw yield $n(),s}})}importKey(e,t){return f(this,null,function*(){if(!Fg(e))throw yield $n(),new Q(`Invalid key name '${e}'`);if(t==null)throw yield $n(),new Q("Key is required");let n=Ep(e);if(yield this.components.datastore.has(n))throw yield $n(),new Q(`Key '${e}' already exists`);let i,s;try{i=yield eye(t);let l=J2.get(this);if(l==null)throw new Q("dek missing");let u=l.dek;s=yield sP(t,u,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw yield $n(),l}let a={name:e,id:i},c=this.components.datastore.batch();return c.put(n,ee(s)),c.put(Bg(e),ee(JSON.stringify(a))),yield c.commit(),a})}exportKey(e){return f(this,null,function*(){if(!Fg(e))throw yield $n(),new Q(`Invalid key name '${e}'`);let t=Ep(e);try{let n=yield this.components.datastore.get(t),o=ne(n),i=J2.get(this);if(i==null)throw new Q("dek missing");let s=i.dek;return yield aP(o,s)}catch(n){throw yield $n(),n}})}removeKey(e){return f(this,null,function*(){if(!Fg(e)||e===this.self)throw yield $n(),new Q(`Invalid key name '${e}'`);let t=Ep(e),n=yield this.findKeyByName(e),o=this.components.datastore.batch();return o.delete(t),o.delete(Bg(e)),yield o.commit(),n})}listKeys(){return f(this,null,function*(){let e={prefix:lP},t=[];try{for(var n=O(this.components.datastore.query(e)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t.push(JSON.parse(ne(a.value)))}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t})}renameKey(e,t){return f(this,null,function*(){if(!Fg(e)||e===this.self)throw yield $n(),new Q(`Invalid old key name '${e}'`);if(!Fg(t)||t===this.self)throw yield $n(),new Q(`Invalid new key name '${t}'`);let n=Ep(e),o=Ep(t),i=Bg(e),s=Bg(t);if(yield this.components.datastore.has(o))throw yield $n(),new Q(`Key '${t}' already exists`);try{let c=yield this.components.datastore.get(n),l=yield this.components.datastore.get(i),u=JSON.parse(ne(l));u.name=t;let d=this.components.datastore.batch();return d.put(o,c),d.put(s,ee(JSON.stringify(u))),d.delete(n),d.delete(i),yield d.commit(),u}catch(c){throw yield $n(),c}})}rotateKeychainPass(e,t){return f(this,null,function*(){if(typeof e!="string")throw yield $n(),new Q(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw yield $n(),new Q(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw yield $n(),new Q(`Invalid pass length ${t.length}`);this.log("recreating keychain");let n=J2.get(this);if(n==null)throw new Q("dek missing");let o=n.dek;this.init.pass=t;let i=t!=null&&this.init.dek?.salt!=null?w2(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";J2.set(this,{dek:i});let s=yield this.listKeys();for(let a of s){let c=yield this.components.datastore.get(Ep(a.name)),l=ne(c),u=yield aP(l,o),d=i.toString(),h=yield sP(u,d,u.type==="RSA"?"pkcs-8":"libp2p-key"),p=this.components.datastore.batch(),m={name:a.name,id:a.id};p.put(Ep(a.name),ee(h)),p.put(Bg(a.name),ee(JSON.stringify(m))),yield p.commit()}this.log("keychain reconstructed")})}};function C6(r={}){return e=>new S6(e,r)}function uP(t){return f(this,arguments,function*(r,e={}){let n=e.selfKey??"self",o=C6(e)({datastore:r,logger:Cu()}),i;return(yield r.has(new Ut(`/pkcs8/${n}`)))?i=yield o.exportKey(n):(i=yield lg(e.keyType??"Ed25519"),yield o.importKey(n,i)),i})}var dP=class{dns;canResolve(e){return e.getComponents().some(({name:t})=>t==="dnsaddr")}resolve(e,t){return f(this,null,function*(){let n=e.getComponents().find(c=>c.name==="dnsaddr")?.value;if(n==null)return[e];let i=yield this.getDNS(t).query(`_dnsaddr.${n}`,{signal:t?.signal,types:[xs.TXT]}),s=e.getComponents().find(c=>c.name==="p2p")?.value,a=[];for(let c of i.Answer){let l=c.data.replace(/["']/g,"").trim().split("=")[1];l!=null&&(s!=null&&!l.includes(s)||a.push(Ee(l)))}return a})}getDNS(e){return e.dns!=null?e.dns:(this.dns==null&&(this.dns=ix()),this.dns)}},_p=new dP;var tye={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:_p}},transportManager:{faultTolerance:Dm.FATAL_ALL}};function xG(r){return f(this,null,function*(){let e=Rr(tye,r);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new Q("Private network is enforced, but no protector was provided");return e})}var ev;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={publicKey:et(0),payloadType:et(0),payload:et(0),signature:et(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(ev||(ev={}));var I6=class extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}};var Ia=(()=>{class r{static createFromProtobuf=t=>{let n=ev.decode(t),o=Hr(n.publicKey);return new r({publicKey:o,payloadType:n.payloadType,payload:n.payload,signature:n.signature})};static seal=(t,n,o)=>f(null,null,function*(){if(n==null)throw new Error("Missing private key");let i=t.domain,s=t.codec,a=t.marshal(),c=EG(i,s,a),l=yield n.sign(c.subarray(),o);return new r({publicKey:n.publicKey,payloadType:s,payload:a,signature:l})});static openAndCertify=(t,n,o)=>f(null,null,function*(){let i=r.createFromProtobuf(t);if(!(yield i.validate(n,o)))throw new I6("Envelope signature is not valid for the given domain");return i});publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:n,payloadType:o,payload:i,signature:s}=t;this.publicKey=n,this.payloadType=o,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=ev.encode({publicKey:Sn(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return t==null?!1:Le(this.marshal(),t.marshal())}validate(t,n){return f(this,null,function*(){let o=EG(t,this.payloadType,this.payload);return this.publicKey.verify(o.subarray(),this.signature,n)})}}return r})(),EG=(r,e,t)=>{let n=ee(r),o=In(n.byteLength),i=In(e.length),s=In(t.length);return new Ke(o,n,i,e,s,t)};function _G(r,e){let t=(n,o)=>n.toString().localeCompare(o.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,o)=>e[o].equals(n)))}var SG="libp2p-peer-record",CG=Uint8Array.from([3,1]);var tv;(function(r){let e;(function(n){let o;n.codec=()=>(o==null&&(o=qe((i,s,a={})=>{a.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),a.lengthDelimited!==!1&&s.ldelim()},(i,s,a={})=>{let c={multiaddr:et(0)},l=s==null?i.len:i.pos+s;for(;i.pos<l;){let u=i.uint32();switch(u>>>3){case 1:{c.multiaddr=i.bytes();break}default:{i.skipType(u&7);break}}}return c})),o),n.encode=i=>ze(i,n.codec()),n.decode=(i,s)=>$e(i,n.codec(),s)})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=qe((n,o,i={})=>{if(i.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let s of n.addresses)o.uint32(26),r.AddressInfo.codec().encode(s,o);i.lengthDelimited!==!1&&o.ldelim()},(n,o,i={})=>{let s={peerId:et(0),seq:0n,addresses:[]},a=o==null?n.len:n.pos+o;for(;n.pos<a;){let c=n.uint32();switch(c>>>3){case 1:{s.peerId=n.bytes();break}case 2:{s.seq=n.uint64();break}case 3:{if(i.limits?.addresses!=null&&s.addresses.length===i.limits.addresses)throw new Wt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(n,n.uint32(),{limits:i.limits?.addresses$}));break}default:{n.skipType(c&7);break}}}return s})),t),r.encode=n=>ze(n,r.codec()),r.decode=(n,o)=>$e(n,r.codec(),o)})(tv||(tv={}));var Wi=(()=>{class r{static createFromProtobuf=t=>{let n=tv.decode(t),o=tn(Ft(n.peerId)),i=(n.addresses??[]).map(a=>Ee(a.multiaddr)),s=n.seq;return new r({peerId:o,multiaddrs:i,seqNumber:s})};static DOMAIN=SG;static CODEC=CG;peerId;multiaddrs;seqNumber;domain=r.DOMAIN;codec=r.CODEC;marshaled;constructor(t){let{peerId:n,multiaddrs:o,seqNumber:i}=t;this.peerId=n,this.multiaddrs=o??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=tv.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof r)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!_G(this.multiaddrs,t.multiaddrs))}}return r})();var Ml;(function(r){let e;(function(o){let i;o.codec=()=>(i==null&&(i=qe((s,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),s.key!=null&&s.key!==""&&(a.uint32(10),a.string(s.key)),s.value!=null&&s.value.byteLength>0&&(a.uint32(18),a.bytes(s.value)),c.lengthDelimited!==!1&&a.ldelim()},(s,a,c={})=>{let l={key:"",value:et(0)},u=a==null?s.len:s.pos+a;for(;s.pos<u;){let d=s.uint32();switch(d>>>3){case 1:{l.key=s.string();break}case 2:{l.value=s.bytes();break}default:{s.skipType(d&7);break}}}return l})),i),o.encode=s=>ze(s,o.codec()),o.decode=(s,a)=>$e(s,o.codec(),a)})(e=r.Peer$metadataEntry||(r.Peer$metadataEntry={}));let t;(function(o){let i;o.codec=()=>(i==null&&(i=qe((s,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),s.key!=null&&s.key!==""&&(a.uint32(10),a.string(s.key)),s.value!=null&&(a.uint32(18),D6.codec().encode(s.value,a)),c.lengthDelimited!==!1&&a.ldelim()},(s,a,c={})=>{let l={key:""},u=a==null?s.len:s.pos+a;for(;s.pos<u;){let d=s.uint32();switch(d>>>3){case 1:{l.key=s.string();break}case 2:{l.value=D6.codec().decode(s,s.uint32(),{limits:c.limits?.value});break}default:{s.skipType(d&7);break}}}return l})),i),o.encode=s=>ze(s,o.codec()),o.decode=(s,a)=>$e(s,o.codec(),a)})(t=r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.addresses!=null)for(let a of o.addresses)i.uint32(10),A6.codec().encode(a,i);if(o.protocols!=null)for(let a of o.protocols)i.uint32(18),i.string(a);if(o.publicKey!=null&&(i.uint32(34),i.bytes(o.publicKey)),o.peerRecordEnvelope!=null&&(i.uint32(42),i.bytes(o.peerRecordEnvelope)),o.metadata!=null&&o.metadata.size!==0)for(let[a,c]of o.metadata.entries())i.uint32(50),r.Peer$metadataEntry.codec().encode({key:a,value:c},i);if(o.tags!=null&&o.tags.size!==0)for(let[a,c]of o.tags.entries())i.uint32(58),r.Peer$tagsEntry.codec().encode({key:a,value:c},i);o.updated!=null&&(i.uint32(64),i.uint64Number(o.updated)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={addresses:[],protocols:[],metadata:new Map,tags:new Map},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{if(s.limits?.addresses!=null&&a.addresses.length===s.limits.addresses)throw new Wt('Decode error - map field "addresses" had too many elements');a.addresses.push(A6.codec().decode(o,o.uint32(),{limits:s.limits?.addresses$}));break}case 2:{if(s.limits?.protocols!=null&&a.protocols.length===s.limits.protocols)throw new Wt('Decode error - map field "protocols" had too many elements');a.protocols.push(o.string());break}case 4:{a.publicKey=o.bytes();break}case 5:{a.peerRecordEnvelope=o.bytes();break}case 6:{if(s.limits?.metadata!=null&&a.metadata.size===s.limits.metadata)throw new u2('Decode error - map field "metadata" had too many elements');let u=r.Peer$metadataEntry.codec().decode(o,o.uint32());a.metadata.set(u.key,u.value);break}case 7:{if(s.limits?.tags!=null&&a.tags.size===s.limits.tags)throw new u2('Decode error - map field "tags" had too many elements');let u=r.Peer$tagsEntry.codec().decode(o,o.uint32(),{limits:{value:s.limits?.tags$value}});a.tags.set(u.key,u.value);break}case 8:{a.updated=o.uint64Number();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(Ml||(Ml={}));var A6;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={multiaddr:et(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(A6||(A6={}));var D6;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={value:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(D6||(D6={}));function rye(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;r.type==="RSA"&&(t=r.toMultihash());let n=Hr(e.publicKey,t);return pc(n)}function IG(r,e,t){let n=Ml.decode(e);return Ug(r,n,t)}function Ug(r,e,t){let n=new Map,o=BigInt(Date.now());for(let[i,s]of e.tags.entries())s.expiry!=null&&s.expiry<o||n.set(i,s);return I(v({},e),{id:rye(r,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:s})=>({multiaddr:Ee(i),isCertified:s??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n})}function AG(r,e){return nye(r.addresses,e.addresses)&&oye(r.protocols,e.protocols)&&iye(r.publicKey,e.publicKey)&&sye(r.peerRecordEnvelope,e.peerRecordEnvelope)&&aye(r.metadata,e.metadata)&&cye(r.tags,e.tags)}function nye(r,e){return TG(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Le(t.multiaddr,n.multiaddr)))}function oye(r,e){return TG(r,e,(t,n)=>t===n)}function iye(r,e){return DG(r,e)}function sye(r,e){return DG(r,e)}function aye(r,e){return PG(r,e,(t,n)=>Le(t,n))}function cye(r,e){return PG(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function DG(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Le(r,e):!1}function TG(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function PG(r,e,t){if(r.size!==e.size)return!1;for(let[n,o]of r.entries()){let i=e.get(n);if(i==null||!t(o,i))return!1}return!0}var fP="/peers/";function rv(r){if(!bs(r)||r.type==null)throw new Q("Invalid PeerId");let e=r.toCID().toString();return new Ut(`${fP}${e}`)}function MG(r,e,t,n,o){return f(this,null,function*(){let i=new Map;for(let s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=Ee(s.multiaddr)),!ju(s.multiaddr))throw new Q("Multiaddr was invalid");if(!(yield e(r,s.multiaddr,o)))continue;let a=s.isCertified??!1,c=s.multiaddr.toString(),l=i.get(c);l!=null?s.isCertified=l.isCertified||a:i.set(c,{multiaddr:s.multiaddr,isCertified:a})}return[...i.values()].sort((s,a)=>s.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({isCertified:s,multiaddr:a})=>{let c=a.getPeerId();return r.equals(c)&&(a=a.decapsulate(Ee(`/p2p/${r}`))),{isCertified:s,multiaddr:a.bytes}})})}function P6(r,e,t,n){return f(this,null,function*(){if(e==null)throw new Q("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Q("publicKey bytes do not match peer id publicKey bytes");let o=n.existingPeer?.peer;if(o!=null&&!r.equals(o.id))throw new Q("peer id did not match existing peer id");let i=o?.addresses??[],s=new Set(o?.protocols??[]),a=o?.metadata??new Map,c=o?.tags??new Map,l=o?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(s=new Set(e.protocols)),e.metadata!=null){let h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=T6(h,{validate:kG})}if(e.tags!=null){let h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=T6(h,{validate:RG,map:NG})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(s=new Set([...s,...e.protocols])),e.metadata!=null){let h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(let[p,m]of h)m==null?a.delete(p):a.set(p,m);a=T6([...a.entries()],{validate:kG})}if(e.tags!=null){let h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),p=new Map(c);for(let[m,w]of h)w==null?p.delete(m):p.set(m,w);c=T6([...p.entries()],{validate:RG,map:NG})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;o?.id.publicKey!=null?u=Sn(o.id.publicKey):e.publicKey!=null?u=Sn(e.publicKey):r.publicKey!=null&&(u=Sn(r.publicKey));let d={addresses:yield MG(r,n.addressFilter??(()=>f(null,null,function*(){return!0})),i,n.existingPeer?.peerPB.addresses,n),protocols:[...s.values()].sort((h,p)=>h.localeCompare(p)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return d.addresses.forEach(h=>{h.observed=n.existingPeer?.peerPB.addresses?.find(p=>Le(p.multiaddr,p.multiaddr))?.observed??Date.now()}),r.type!=="RSA"&&delete d.publicKey,d})}function T6(r,e){let t=new Map;for(let[n,o]of r)o!=null&&e.validate(n,o);for(let[n,o]of r.sort(([i],[s])=>i.localeCompare(s)))o!=null&&t.set(n,e.map?.(n,o)??o);return t}function kG(r,e){if(typeof r!="string")throw new Q("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Q("Metadata value must be a Uint8Array")}function RG(r,e){if(typeof r!="string")throw new Q("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Q("Tag value must be an integer");if(e.value<0||e.value>100)throw new Q("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Q("Tag ttl must be an integer");if(e.ttl<0)throw new Q("Tag ttl must be between greater than 0")}}function NG(r,e){let t;e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl)));let n={value:e.value??0};return t!=null&&(n.expiry=t),n}function OG(r){let e=r.toString().split("/")[2],t=le.parse(e,rs);return va(t)}function pP(r,e,t){let n=OG(r);return IG(n,e,t)}function lye(r,e){return{prefix:fP,filters:(r.filters??[]).map(t=>({key:n,value:o})=>t(pP(n,o,e))),orders:(r.orders??[]).map(t=>(n,o)=>t(pP(n.key,n.value,e),pP(o.key,o.value,e)))}}var M6=class{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=xl({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??36e5,this.maxPeerAge=t.maxPeerAge??216e5}getLock(e){let t=this.locks.get(e);return t==null&&(t={refs:0,lock:Uy({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,t.refs===0&&(t.lock.finalize(),this.locks.delete(e))}getReadLock(e,t){return f(this,null,function*(){let n=this.getLock(e);try{let o=yield n.lock.readLock(t);return()=>{o(),this.maybeRemoveLock(e,n)}}catch(o){throw this.maybeRemoveLock(e,n),o}})}getWriteLock(e,t){return f(this,null,function*(){let n=this.getLock(e);try{let o=yield n.lock.writeLock(t);return()=>{o(),this.maybeRemoveLock(e,n)}}catch(o){throw this.maybeRemoveLock(e,n),o}})}has(e,t){return f(this,null,function*(){try{return yield this.load(e,t),!0}catch(n){if(n.name!=="NotFoundError")throw n}return!1})}delete(e,t){return f(this,null,function*(){this.peerId.equals(e)||(yield this.datastore.delete(rv(e),t))})}load(e,t){return f(this,null,function*(){let n=rv(e),o=yield this.datastore.get(n,t),i=Ml.decode(o);if(this.#r(e,i))throw yield this.datastore.delete(n,t),new Ot;return Ug(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)})}save(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield P6(e,t,"patch",I(v({},n),{addressFilter:this.addressFilter}));return this.#t(e,i,o)})}patch(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield P6(e,t,"patch",I(v({},n),{addressFilter:this.addressFilter,existingPeer:o}));return this.#t(e,i,o)})}merge(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield P6(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:o});return this.#t(e,i,o)})}all(e){return k(this,null,function*(){try{for(var t=O(this.datastore.query(lye(e??{},this.maxAddressAge),e)),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let{key:s,value:a}=o.value;let c=OG(s);if(c.equals(this.peerId))continue;let l=Ml.decode(a);if(this.#r(c,l)){yield new C(this.datastore.delete(s,e));continue}yield Ug(c,l,this.peerId.equals(c)?1/0:this.maxAddressAge)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})}#e(e,t){return f(this,null,function*(){try{let n=rv(e),o=yield this.datastore.get(n,t),i=Ml.decode(o);if(this.#r(e,i))throw yield this.datastore.delete(n,t),new Ot;return{peerPB:i,peer:Ug(e,i,this.maxAddressAge)}}catch(n){n.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",n)}})}#t(e,t,n,o){return f(this,null,function*(){t.updated=Date.now();let i=Ml.encode(t);return yield this.datastore.put(rv(e),i,o),{peer:Ug(e,t,this.maxAddressAge),previous:n?.peer,updated:n==null||!AG(t,n.peerPB)}})}#r(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;let n=t.updated<Date.now()-this.maxPeerAge,o=Date.now()-this.maxAddressAge,i=t.addresses.filter(s=>s.observed!=null&&s.observed>o);return n&&i.length===0}};var hP=class{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new M6(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";forEach(e,t){return f(this,null,function*(){try{for(var n=O(this.store.all(t)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;e(a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}})}all(e){return f(this,null,function*(){return Ea(this.store.all(e))})}delete(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{yield this.store.delete(e,t)}finally{n()}})}has(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{return yield this.store.has(e,t)}finally{this.log.trace("has release read lock"),n?.()}})}get(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{return yield this.store.load(e,t)}finally{n?.()}})}getInfo(e,t){return f(this,null,function*(){let n=yield this.get(e,t);return{id:n.id,multiaddrs:n.addresses.map(({multiaddr:o})=>o)}})}save(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.save(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}patch(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.patch(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}merge(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.merge(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}consumePeerRecord(e,t,n){return f(this,null,function*(){let o=bs(t)?t:bs(t?.expectedPeer)?t.expectedPeer:void 0,i=bs(t)||t===void 0?n:t,s=yield Ia.openAndCertify(e,Wi.DOMAIN,i),a=va(s.publicKey.toCID());if(o?.equals(a)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",o,a),!1;let c=Wi.createFromProtobuf(s.payload),l;try{l=yield this.get(a,i)}catch(u){if(u.name!=="NotFoundError")throw u}if(l?.peerRecordEnvelope!=null){let u=Ia.createFromProtobuf(l.peerRecordEnvelope),d=Wi.createFromProtobuf(u.payload);if(d.seqNumber>=c.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",d.seqNumber,c.seqNumber),!1}return yield this.patch(c.peerId,{peerRecordEnvelope:e,addresses:c.multiaddrs.map(u=>({isCertified:!0,multiaddr:u}))},i),!0})}#e(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}};function LG(r,e={}){return new hP(r,e)}var FG=864e13;var uye=448,mP=449,dye=53,fye=54,pye=55,hye=56,k6=class{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=rn({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){let t=this.findHost(e);for(let n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);let o=Ho(n)===!0;this.mappings.set(n,{domain:e,verified:o,expires:o?FG-Date.now():0,lastVerified:o?FG-Date.now():void 0})})}remove(e){let t=this.findHost(e),n=!1;for(let[o,i]of this.mappings.entries())i.domain===t&&(this.log("removing %s to %s DNS mapping %e",o,i.domain,new Error("where")),this.mappings.delete(o),n=n||i.verified);return n}getAll(e){let t=[];for(let n=0;n<e.length;n++){let i=e[n].multiaddr.stringTuples(),s=i[0][1];if(s!=null)for(let[a,c]of this.mappings.entries()){if(s!==a)continue;this.maybeAddSNITuple(i,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Ee(`/${i.map(u=>[Cs(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){for(let n=0;n<e.length;n++)if(e[n][0]===uye&&e[n+1]?.[0]!==mP)return e.splice(n+1,0,[mP,t]),!0;return!1}confirm(e,t){let n=this.findHost(e),o=!1;for(let[i,s]of this.mappings.entries())s.domain===n&&(this.log("marking %s to %s DNS mapping as verified",i,s.domain),o=s.verified,s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now());return o}unconfirm(e,t){let n=this.findHost(e),o=!1;for(let[i,s]of this.mappings.entries())s.domain===n&&(this.log("removing verification of %s to %s DNS mapping",i,s.domain),o=o||s.verified,s.verified=!1,s.expires=Date.now()+t);return o}findHost(e){for(let t of e.stringTuples())if(t[0]===mP||t[0]===dye||t[0]===fye||t[0]===pye||t[0]===hye)return t[1]}};var gP=4,yP=41,vP=6,mye=273,R6=class{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=rn({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){let t=e.stringTuples();for(let n of this.mappings.values())for(let o of n)if(o.externalIp===t[0][1])return!0;return!1}add(e,t,n,o=t,i="tcp"){let s=`${e}-${t}-${i}`,a=this.mappings.get(s)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:o,externalFamily:zi(n)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(s,a)}remove(e){let t=e.stringTuples(),n=t[0][1]??"",o=t[1][0]===vP?"tcp":"udp",i=parseInt(t[1][1]??"0"),s=!1;for(let[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){let u=c[l];u.externalIp===n&&u.externalPort===i&&u.protocol===o&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,n,i,o),s=s||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return s}getAll(e){let t=[];for(let{multiaddr:n}of e){let o=n.stringTuples(),i;if((o[0][0]===gP||o[0][0]===yP)&&o[1][0]===vP?i=`${o[0][1]}-${o[1][1]}-tcp`:(o[0][0]===gP||o[0][0]===yP)&&o[1][0]===mye&&(i=`${o[0][1]}-${o[1][1]}-udp`),i==null)continue;let s=this.mappings.get(i);if(s!=null)for(let a of s)o[0][0]=a.externalFamily===4?gP:yP,o[0][1]=a.externalIp,o[1][1]=`${a.externalPort}`,t.push({multiaddr:Ee(`/${o.map(c=>[Cs(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){let o=e.stringTuples()[0][1],i=!1;for(let s of this.mappings.values())for(let a of s)a.externalIp===o&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){let n=e.stringTuples(),o=n[0][1]??"",i=n[1][0]===vP?"tcp":"udp",s=parseInt(n[1][1]??"0"),a=!1;for(let c of this.mappings.values())for(let l=0;l<c.length;l++){let u=c[l];u.externalIp===o&&u.externalPort===s&&u.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,o,s,i),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}};function BG(r){try{for(let{code:e,value:t}of r.getComponents())if(e!==42&&t!=null){if(e===4)return t.startsWith("169.254.");if(e===41)return t.toLowerCase().startsWith("fe80")}}catch{}return!1}function N6(r){try{for(let{code:e}of r.getComponents())if(e!==42)return e===4||e===41}catch{}return!1}function Ps(r){try{if(!N6(r))return!1;let[[,e]]=r.stringTuples();return e==null?!1:Ho(e)??!1}catch{}return!0}var gye={maxObservedAddresses:10},O6=class{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=rn({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??gye.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(let t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Ps(e)||BG(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Ee(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){let t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){let n=e.toString(),o=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=o.verified;return o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,o),i}};var yye=[4,41,53,54,55,56];function wP(r){try{for(let{code:e}of r.getComponents())if(e!==42)return yye.includes(e)}catch{}return!1}var vye={maxObservedAddresses:10},L6=class{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=rn({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??vye.maxObservedAddresses}get(e,t){if(Ps(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};let n=this.toKey(e),o=this.addresses.get(n);return o==null&&(o={verified:!wP(e),expires:0},this.addresses.set(n,o)),{multiaddr:e,verified:o.verified,type:"transport",expires:o.expires,lastVerified:o.lastVerified}}has(e){let t=this.toKey(e);return this.addresses.has(t)}remove(e){let t=this.toKey(e),n=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){let n=this.toKey(e),o=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},i=o.verified;return o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now(),this.addresses.set(n,o),i}unconfirm(e,t){let n=this.toKey(e),o=this.addresses.get(n)??{verified:!1,expires:0},i=o.verified;return o.verified=!1,o.expires=Date.now()+t,this.addresses.set(n,o),i}toKey(e){if(wP(e)){let t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}};var UG=6e4,VG={maxObservedAddresses:10,addressVerificationTTL:UG*10,addressVerificationRetry:UG*5},wye=r=>r;function bP(r,e){let t=r.getPeerId();return t!=null&&lr(t).equals(e)&&(r=r.decapsulate(Ee(`/p2p/${e.toString()}`))),r}var F6=class{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){let{listen:n=[],announce:o=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(s=>s.toString()),this.announce=new Set(o.map(s=>s.toString())),this.appendAnnounce=new Set(i.map(s=>s.toString())),this.observed=new O6(e,t),this.dnsMappings=new k6(e,t),this.ipMappings=new R6(e,t),this.transportAddresses=new L6(e,t),this.announceFilter=t.announceFilter??wye,this.observedAddressFilter=ho(1024),this.addressVerificationTTL=t.addressVerificationTTL??VG.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??VG.addressVerificationRetry,this._updatePeerStoreAddresses=cl(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){let e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Ee(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Ee(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Ee(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){let t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=bP(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=bP(e,this.components.peerId);let n=!0;(t?.type==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=bP(e,this.components.peerId);let n=!1;this.observed.has(e)&&!this.observed.remove(e)&&n&&(n=!1),this.transportAddresses.has(e)&&!this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),this.dnsMappings.has(e)&&!this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),this.ipMappings.has(e)&&!this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),n&&this._updatePeerStoreAddresses()}getAddresses(){let e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;let o=n.multiaddr.toString();return e.has(o)?!1:(e.add(o),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{let o=Ee(n);return o.getComponents().pop()?.value===this.components.peerId.toString()?o:o.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){let e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(o=>{o.updateAnnounceAddrs(e)}),e.map(o=>({multiaddr:o,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(o=>this.transportAddresses.get(o,this.addressVerificationTTL)));let n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(o=>{o.updateAnnounceAddrs(n)}),t=t.concat(n.map(o=>({multiaddr:o,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Ee(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,o=t,i="tcp"){this.ipMappings.add(e,t,n,o,i),this.observed.removePrefixed(`/ip${zi(n)?4:6}/${n}/${i}/${o}`)}removePublicAddressMapping(e,t,n,o=t,i="tcp"){this.ipMappings.remove(Ee(`/ip${zi(n)?4:6}/${n}/${i}/${o}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;let t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||Ho(t.host)===!0)return!1;let n=this.components.transportManager.getListeners(),o=[i=>Sl.exactMatch(i)||rp.exactMatch(i),i=>tp.exactMatch(i),i=>Hq.exactMatch(i)];for(let i of o){if(!i(e))continue;let s=n.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&i(u)).length>0);if(s.length!==1)continue;let a=s[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;let c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}};var B6=class extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}},U6=class extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}},Vg=class extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}},nv=class extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}},V6=class extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}},j6=class extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}},H6=class extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}},ov=class extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}},$6=class extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}},z6=class extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}},q6=class extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}},K6=class extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}},G6=class extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}},Sp=class extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}},Cp=class extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}},W6=class extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}},Y6=class extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}};var xP=class{components={};_started=!1;constructor(e={}){this.components={};for(let[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=Cu())}isStarted(){return this._started}_invokeStartableMethod(e){return f(this,null,function*(){yield Promise.all(Object.values(this.components).filter(t=>W4(t)).map(t=>f(this,null,function*(){yield t[e]?.()})))})}beforeStart(){return f(this,null,function*(){yield this._invokeStartableMethod("beforeStart")})}start(){return f(this,null,function*(){yield this._invokeStartableMethod("start"),this._started=!0})}afterStart(){return f(this,null,function*(){yield this._invokeStartableMethod("afterStart")})}beforeStop(){return f(this,null,function*(){yield this._invokeStartableMethod("beforeStop")})}stop(){return f(this,null,function*(){yield this._invokeStartableMethod("stop"),this._started=!1})}afterStop(){return f(this,null,function*(){yield this._invokeStartableMethod("afterStop")})}},xye=["metrics","connectionProtector","dns"],Eye=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function jG(r={}){let e=new xP(r);return new Proxy(e,{get(n,o,i){if(typeof o=="string"&&!Eye.includes(o)){let s=e.components[o];if(s==null&&!xye.includes(o))throw new B6(`${o} not set`);return s}return Reflect.get(n,o,i)},set(n,o,i){return typeof o=="string"?e.components[o]=i:Reflect.set(n,o,i),!0}})}function HG(r){let e={};for(let t of Object.values(r.components))for(let n of _ye(t))e[n]=!0;for(let t of Object.values(r.components))for(let n of Sye(t))if(e[n]!==!0)throw new U6(`Service "${Cye(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function _ye(r){return Array.isArray(r?.[Pt])?r[Pt]:[]}function Sye(r){return Array.isArray(r?.[Ri])?r[Ri]:[]}function Cye(r){return r?.[Symbol.toStringTag]??r?.toString()??"unknown"}var Iye=4,Aye=41;function $G(r={}){return v({denyDialPeer:()=>f(null,null,function*(){return!1}),denyDialMultiaddr:e=>f(null,null,function*(){if(Sl.matches(e))return!1;let t=e.stringTuples();return t[0][0]===Iye||t[0][0]===Aye?!!Ho(`${t[0][1]}`):!1}),denyInboundConnection:()=>f(null,null,function*(){return!1}),denyOutboundConnection:()=>f(null,null,function*(){return!1}),denyInboundEncryptedConnection:()=>f(null,null,function*(){return!1}),denyOutboundEncryptedConnection:()=>f(null,null,function*(){return!1}),denyInboundUpgradedConnection:()=>f(null,null,function*(){return!1}),denyOutboundUpgradedConnection:()=>f(null,null,function*(){return!1}),filterMultiaddrForPeer:()=>f(null,null,function*(){return!0})},r)}var zG=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},Dye=new WeakMap;function Tye({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:o}={})=>{if(o?.aborted)return Promise.reject(zG());let i,s,a,c=r??clearTimeout,l=()=>{c(i),a(zG())},u=()=>{o&&o.removeEventListener("abort",l)},d=new Promise((h,p)=>{s=()=>{u(),h(n)},a=p,i=(e??setTimeout)(s,t)});return o&&o.addEventListener("abort",l,{once:!0}),Dye.set(d,()=>{c(i),i=null,s()}),d}}var Pye=Tye(),X6=Pye;var jg=class{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new EP}consume(o){return f(this,arguments,function*(e,t=1,n={}){let i=this.getKey(e),s=this._getKeySecDuration(n),a=this.memoryStorage.incrby(i,t,s);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)throw this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this.memoryStorage.set(i,a.consumedPoints,this.blockDuration)),new ax("Rate limit exceeded",a);if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),yield X6(c)}return a})}penalty(e,t=1,n={}){let o=this.getKey(e),i=this._getKeySecDuration(n),s=this.memoryStorage.incrby(o,t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}reward(e,t=1,n={}){let o=this.getKey(e),i=this._getKeySecDuration(n),s=this.memoryStorage.incrby(o,-t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}block(e,t){let n=t*1e3,o=this.points+1;return this.memoryStorage.set(this.getKey(e),o,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:o,isFirstInDuration:!1}}set(e,t,n=0){let o=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:o===0?-1:o,consumedPoints:t,isFirstInDuration:!1}}get(e){let t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}},EP=class{storage;constructor(){this.storage=new Map}incrby(e,t,n){let o=this.storage.get(e);if(o!=null){let i=o.expiresAt!=null?o.expiresAt.getTime()-new Date().getTime():-1;return o.expiresAt==null||i>0?(o.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:o.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let o=n*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);let s={value:t,expiresAt:o>0?new Date(Date.now()+o):void 0};return this.storage.set(e,s),o>0&&(s.timeoutId=setTimeout(()=>{this.storage.delete(e)},o),s.timeoutId.unref!=null&&s.timeoutId.unref()),{remainingPoints:0,msBeforeNext:o===0?-1:o,consumedPoints:s.value,isFirstInDuration:!0}}get(e){let t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){let t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}};function Q6(r){if(bs(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){let n=e[0].getPeerId();t=n==null?void 0:lr(n),e.forEach(o=>{if(!ju(o))throw new Tm("Invalid multiaddr");let i=o.getPeerId();if(i==null){if(t!=null)throw new Q("Multiaddrs must all have the same peer id or have no peer id")}else{let s=lr(i);if(t?.equals(s)!==!0)throw new Q("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Fq.exactMatch(n)),{peerId:t,multiaddrs:e}}var Mye=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];function qG(r,e){return f(this,null,function*(){let t=r?.streams?.map(o=>o.protocol)??[],n=e?.closableProtocols??Mye;if(!(t.filter(o=>o!=null&&!n.includes(o)).length>0))try{yield r?.close(e)}catch(o){r?.abort(o)}})}function iv(r){try{let e;typeof r=="string"?e=Ee(r):e=r;let t=new Set([...e.getComponents().map(n=>n.name)]);if(!t.has("ipcidr")){let o=t.has("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(o)}return IT(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}var Z6=class{connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.allow=(t.allow??[]).map(n=>iv(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}_maybePruneConnections(){return f(this,null,function*(){let e=this.connectionManager.getConnections(),t=e.length,n=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,n),t<=n)return;let o=new mo;for(let c of e){let l=c.remotePeer;if(!o.has(l)){o.set(l,0);try{let u=yield this.peerStore.get(l);o.set(l,[...u.tags.values()].reduce((d,h)=>d+h.value,0))}catch(u){u.name!=="NotFoundError"&&this.log.error("error loading peer tags",u)}}}let i=this.sortConnections(e,o),s=Math.max(t-n,0),a=[];for(let c of i)if(this.log("too many connections open - closing a connection to %p",c.remotePeer),this.allow.some(u=>u.contains(c.remoteAddr.nodeAddress().address))||a.push(c),a.length===s)break;yield Promise.all(a.map(c=>f(this,null,function*(){yield qG(c,{signal:AbortSignal.timeout(1e3)})}))),this.events.safeDispatchEvent("connection:prune",{detail:a})})}sortConnections(e,t){return e.sort((n,o)=>{let i=n.timeline.open,s=o.timeline.open;return i<s?1:i>s?-1:0}).sort((n,o)=>n.direction==="outbound"&&o.direction==="inbound"?1:n.direction==="inbound"&&o.direction==="outbound"?-1:0).sort((n,o)=>n.streams.length>o.streams.length?1:n.streams.length<o.streams.length?-1:0).sort((n,o)=>{let i=t.get(n.remotePeer)??0,s=t.get(o.remotePeer)??0;return i>s?1:i<s?-1:0})}};var KG="last-dial-failure",GG="last-dial-success";var WG=100,J6=50;var e5=class extends Ln{constructor(e={}){super(I(v({},e),{sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0}))}};function YG(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function _P(r){if(!N6(r))return!1;let{address:e}=r.nodeAddress();return YG(e)}function kye(r,e){let t=tp.exactMatch(r.multiaddr),n=tp.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;let o=rp.exactMatch(r.multiaddr),i=rp.exactMatch(e.multiaddr);if(o&&!i)return-1;if(!o&&i)return 1;let s=Sl.exactMatch(r.multiaddr),a=Sl.exactMatch(e.multiaddr);if(s&&!a)return-1;if(!s&&a)return 1;let c=L2.exactMatch(r.multiaddr),l=L2.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;let u=O2.exactMatch(r.multiaddr),d=O2.exactMatch(e.multiaddr);if(u&&!d)return-1;if(!u&&d)return 1;let h=OT.exactMatch(r.multiaddr),p=OT.exactMatch(e.multiaddr);return h&&!p?-1:!h&&p?1:0}function Rye(r,e){let t=_P(r.multiaddr),n=_P(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function Nye(r,e){let t=Ps(r.multiaddr),n=Ps(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function Oye(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function Lye(r,e){let t=ni.exactMatch(r.multiaddr),n=ni.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function XG(r){return r.sort(kye).sort(Oye).sort(Lye).sort(Nye).sort(Rye)}function SP(r,e,t){return f(this,null,function*(){let n=t.depth??0;if(n>(t.maxRecursiveDepth??32))throw new Y6("Max recursive depth reached");let o=!1,i=[];for(let s of Object.values(e))if(s.canResolve(r)){o=!0;let a=yield s.resolve(r,t);for(let c of a)i.push(...yield SP(c,e,I(v({},t),{depth:n+1})))}return o===!1&&i.push(r),i})}var sv={maxParallelDials:J6,maxDialQueueLength:500,maxPeerAddrsToDial:25,dialTimeout:1e4,resolvers:{dnsaddr:_p}},t5=class{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;resolvers;constructor(e,t={}){this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??sv.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??sv.maxDialQueueLength,this.dialTimeout=t.dialTimeout??sv.dialTimeout,this.connections=t.connections??new mo,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.resolvers=t.resolvers??sv.resolvers,this.shutDownController=new AbortController,this.shutDownController.signal,this.queue=new e5({concurrency:t.maxParallelDials??sv.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{n.detail?.name!==Nn.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}dial(n){return f(this,arguments,function*(e,t={}){let{peerId:o,multiaddrs:i}=Q6(e),s=Array.from(this.connections.values()).flat().find(c=>t.force===!0?!1:c.remotePeer.equals(o)?!0:i.find(l=>l.equals(c.remoteAddr)));if(s?.status==="open")return this.log("already connected to %a",s.remoteAddr),t.onProgress?.(new pe("dial-queue:already-connected")),s;let a=this.queue.queue.find(c=>{if(o?.equals(c.options.peerId)===!0)return!0;let l=c.options.multiaddrs;if(l==null)return!1;for(let u of i)if(l.has(u.toString()))return!0;return!1});if(a!=null){this.log("joining existing dial target for %p",o);for(let c of i)a.options.multiaddrs.add(c.toString());return t.onProgress?.(new pe("dial-queue:already-in-dial-queue")),a.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new wf("Dial queue is full");return this.log("creating dial target for %p",o,i.map(c=>c.toString())),t.onProgress?.(new pe("dial-queue:add-to-dial-queue")),this.queue.add(c=>f(this,null,function*(){c.onProgress?.(new pe("dial-queue:start-dial"));let l=tt([this.shutDownController.signal,c.signal]);try{return yield this.dialPeer(c,l)}finally{l.clear()}}),{peerId:o,priority:t.priority??DP,multiaddrs:new Set(i.map(c=>c.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})})}dialPeer(e,t){return f(this,null,function*(){let n=e.peerId,o=e.multiaddrs,i=new Set,s=e.multiaddrs.size===0,a=0,c=0,l=[];for(this.log("starting dial to %p",n);s||o.size>0;){c++,s=!1;let u=[],d=new Set(e.multiaddrs);o.clear(),this.log("calculating addrs to dial %p from %s",n,[...d]);let h=yield this.calculateMultiaddrs(n,d,I(v({},e),{signal:t}));for(let p of h){if(i.has(p.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",p.multiaddr,n);continue}u.push(p)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,u.map(p=>p.multiaddr.toString())),e?.onProgress?.(new pe("dial-queue:calculated-addresses",u));for(let p of u){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new wf("Peer had more than maxPeerAddrsToDial");a++;try{let m=yield this.components.transportManager.dial(p.multiaddr,I(v({},e),{signal:t}));this.log("dial to %a succeeded",p.multiaddr);try{yield this.components.peerStore.merge(m.remotePeer,{multiaddrs:[m.remoteAddr],metadata:{[GG]:ee(Date.now().toString())}})}catch(w){this.log.error("could not update last dial failure key for %p",n,w)}return m}catch(m){if(this.log.error("dial failed to %a",p.multiaddr,m),i.add(p.multiaddr.toString()),n!=null)try{yield this.components.peerStore.merge(n,{metadata:{[KG]:ee(Date.now().toString())}})}catch(w){this.log.error("could not update last dial failure key for %p",n,w)}if(t.aborted)throw new oc(m.message);l.push(m)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")})}calculateMultiaddrs(o){return f(this,arguments,function*(e,t=new Set,n={}){let i=[...t].map(h=>({multiaddr:Ee(h),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new wf("Tried to dial self");if((yield this.components.connectionGater.denyDialPeer?.(e))===!0)throw new ov("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{let h=yield this.components.peerStore.get(e);i.push(...h.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:p})=>p.toString()))}catch(h){if(h.name!=="NotFoundError")throw h}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{let h=yield this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:p})=>p.toString())),i.push(...h.multiaddrs.map(p=>({multiaddr:p,isCertified:!1})))}catch(h){h.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,h)}}}let s=(yield Promise.all(i.map(h=>f(this,null,function*(){let p=yield SP(h.multiaddr,this.resolvers,v({dns:this.components.dns,log:this.log},n));return p.length===1&&p[0].equals(h.multiaddr)?h:p.map(m=>({multiaddr:m,isCertified:!1}))})))).flat();if(e!=null){let h=`/p2p/${e.toString()}`;s=s.map(p=>p.multiaddr.getComponents().pop()?.name!=="p2p"?{multiaddr:p.multiaddr.encapsulate(h),isCertified:p.isCertified}:p)}let a=s.filter(h=>{if(this.components.transportManager.dialTransportForMultiaddr(h.multiaddr)==null)return!1;let p=h.multiaddr.getPeerId();return e!=null&&p!=null?e.equals(p):!0}),c=new Map;for(let h of a){let p=h.multiaddr.toString(),m=c.get(p);if(m!=null){m.isCertified=m.isCertified||h.isCertified||!1;continue}c.set(p,h)}let l=[...c.values()];if(l.length===0)throw new q6("The dial request has no valid addresses");let u=[];for(let h of l)this.components.connectionGater.denyDialMultiaddr!=null&&(yield this.components.connectionGater.denyDialMultiaddr(h.multiaddr))||u.push(h);let d=this.addressSorter==null?XG(u):u.sort(this.addressSorter);if(d.length===0)throw new ov("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:h})=>h.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:h})=>h.toString())),d})}isDialable(n){return f(this,arguments,function*(e,t={}){Array.isArray(e)||(e=[e]);try{let o=yield this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?o.find(i=>!ni.matches(i.multiaddr))!=null:!0}catch(o){this.log.trace("error calculating if multiaddr(s) were dialable",o)}return!1})}};var nW=_r(tW(),1);var Bye=Object.prototype.toString,Uye=r=>Bye.call(r)==="[object Error]",Vye=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function TP(r){return r&&Uye(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:Vye.has(r.message):!1}var PP=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},rW=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};function MP(r,e){return f(this,null,function*(){return new Promise((t,n)=>{e=v({},e),e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.retries??=10;let o=nW.default.operation(e),i=()=>{o.stop(),n(e.signal?.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",i,{once:!0});let s=()=>{e.signal?.removeEventListener("abort",i),o.stop()};o.attempt(a=>f(null,null,function*(){try{let c=yield r(a);s(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof PP)throw c.originalError;if(c instanceof TypeError&&!TP(c))throw c;if(rW(c,a,e),(yield e.shouldRetry(c))||(o.stop(),n(c)),yield e.onFailedAttempt(c),!o.retry(c))throw o.mainError()}catch(l){rW(l,a,e),s(),n(l)}}}))})})}var r5=class{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new Bn({concurrency:t.maxParallelReconnects??5,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(o=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,o)})})}maybeReconnect(e){return f(this,null,function*(){if(!this.started)return;let t=yield this.peerStore.get(e);oW(t)&&(this.queue.has(e)||this.queue.add(n=>f(this,null,function*(){yield MP(o=>f(this,null,function*(){if(this.started)try{yield this.connectionManager.openConnection(e,{signal:n?.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,o,this.retries,i),i}}),{signal:n?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})}),{peerId:e}).catch(n=>f(this,null,function*(){this.log.error("failed to reconnect to %p - %e",e,n);let o={};[...t.tags.keys()].forEach(i=>{i.startsWith(Eu)&&(o[i]=void 0)}),yield this.peerStore.merge(e,{tags:o}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})})).catch(n=>f(this,null,function*(){this.log.error("failed to remove keep-alive tag from %p - %e",e,n)})))})}start(){this.started=!0}afterStart(){return f(this,null,function*(){Promise.resolve().then(()=>f(this,null,function*(){let e=yield this.peerStore.all({filters:[t=>oW(t)]});yield Promise.all(e.map(t=>f(this,null,function*(){yield this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})})))})).catch(e=>{this.log.error(e)})})}stop(){this.started=!1,this.queue.abort()}};function oW(r){for(let e of r.tags.keys())if(e.startsWith(Eu))return!0;return!1}var DP=50,kP={maxConnections:WG,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},n5=class{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??kP.maxConnections,this.maxConnections<1)throw new Q("Connection Manager maxConnections must be greater than 0");this.connections=new mo,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(n=>iv(n)),this.deny=(t.deny??[]).map(n=>iv(n)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??kP.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new jg({points:t.inboundConnectionThreshold??kP.inboundConnectionThreshold,duration:1}),this.connectionPruner=new Z6({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:t.allow?.map(n=>Ee(n))}),this.dialQueue=new t5(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??J6,maxDialQueueLength:t.maxDialQueueLength??500,maxPeerAddrsToDial:t.maxPeerAddrsToDial??25,dialTimeout:t.dialTimeout??1e4,resolvers:t.resolvers??{dnsaddr:_p},connections:this.connections}),this.reconnectQueue=new r5({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";start(){return f(this,null,function*(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(let t of this.connections.values())for(let n of t)e[n.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let n of t)for(let o of n.streams){let i=`${o.direction} ${o.protocol??"unnegotiated"}`;e[i]=(e[i]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let n of this.connections.values())for(let o of n){let i={};for(let s of o.streams){let a=`${s.direction} ${s.protocol??"unnegotiated"}`;i[a]=(i[a]??0)+1}for(let[s,a]of Object.entries(i))e[s]=e[s]??[],e[s].push(a)}let t={};for(let[n,o]of Object.entries(e)){o=o.sort((s,a)=>s-a);let i=Math.floor(o.length*.9);t[n]=o[i]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),yield On(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")})}stop(){return f(this,null,function*(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),yield ao(this.reconnectQueue,this.dialQueue,this.connectionPruner);let e=[];for(let t of this.connections.values())for(let n of t)e.push(f(this,null,function*(){try{yield n.close()}catch(o){this.log.error(o)}}));this.log("closing %d connections",e.length),yield Promise.all(e),this.connections.clear(),this.log("stopped")})}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new Q("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}_onConnect(e){return f(this,null,function*(){let{detail:t}=e;if(!this.started){yield t.close();return}if(t.status!=="open")return;let n=t.remotePeer,o=!this.connections.has(n),i=this.connections.get(n)??[];i.push(t),this.connections.set(n,i),n.publicKey!=null&&n.type==="RSA"&&(yield this.peerStore.patch(n,{publicKey:n.publicKey})),o&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})})}onDisconnect(e){let{detail:t}=e,n=t.remotePeer,i=(this.connections.get(n)??[]).filter(s=>s.id!==t.id);this.connections.set(n,i),i.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}openConnection(n){return f(this,arguments,function*(e,t={}){if(!this.started)throw new na("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();let{peerId:o}=Q6(e);if(this.peerId.equals(o))throw new K4("Can not dial self");if(o!=null&&t.force!==!0){this.log("dial %p",o);let c=this.getConnections(o).find(l=>l.limits==null);if(c!=null)return this.log("had an existing non-limited connection to %p",o),t.onProgress?.(new pe("dial-queue:already-connected")),c}let i=yield this.dialQueue.dial(e,I(v({},t),{priority:t.priority??DP}));if(i.status!=="open")throw new z4("Remote closed connection during opening");let s=this.connections.get(i.remotePeer);s==null&&(s=[],this.connections.set(i.remotePeer,s));let a=!1;for(let c of s)if(c.id===i.id&&(a=!0),t.force!==!0&&c.id!==i.id&&c.remoteAddr.equals(i.remoteAddr))return i.abort(new Tm("Duplicate multiaddr connection")),c;return a||s.push(i),i}finally{this.outboundPendingConnections--}})}closeConnections(n){return f(this,arguments,function*(e,t={}){let o=this.connections.get(e)??[];yield Promise.all(o.map(i=>f(this,null,function*(){try{yield i.close(t)}catch(s){i.abort(s)}})))})}acceptIncomingConnection(e){return f(this,null,function*(){if(this.deny.some(o=>o.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(o=>o.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let o=e.remoteAddr.nodeAddress().address;try{yield this.inboundConnectionRateLimiter.consume(o,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,o),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)})}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){let e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Ee(n))}))}isDialable(n){return f(this,arguments,function*(e,t={}){return this.dialQueue.isDialable(e,t)})}};var Hg=class{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){let n=this.alpha(t,this.previousTime),o=e-this.movingAverage,i=n*o;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+o*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*o}else this.movingAverage=e;this.previousTime=t}};var $ye=1.2,zye=2,qye=5e3,Kye=6e4,Gye=5e3,Aa=class{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(e={}){let t=e.interval??Gye;this.success=new Hg(t),this.failure=new Hg(t),this.next=new Hg(t),this.failureMultiplier=e.failureMultiplier??zye,this.timeoutMultiplier=e.timeoutMultiplier??$ye,this.minTimeout=e.minTimeout??qye,this.maxTimeout=e.maxTimeout??Kye,e.metricName!=null&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);let n=AbortSignal.timeout(t),o=tt([e.signal,n]);return o.start=Date.now(),o.timeout=t,o}cleanUp(e){let t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}};var o5=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Ap(r,e){let t=Dx();r.sink(t).catch(s=>f(null,null,function*(){yield t.end(s)})),r.sink=s=>f(null,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield a.next()).done;c=!1){let d=l.value;yield t.push(d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}yield t.end()});let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new Ke;return{read:s=>f(null,null,function*(){if(s?.signal?.throwIfAborted(),s?.bytes==null){let{done:c,value:l}=yield ut(n.next(),s?.signal);return c===!0?null:l}for(;o.byteLength<s.bytes;){let{value:c,done:l}=yield ut(n.next(),s?.signal);if(l===!0)throw new o5("unexpected end of input");o.append(c)}let a=o.sublist(0,s.bytes);return o.consume(s.bytes),a}),write:(s,a)=>f(null,null,function*(){a?.signal?.throwIfAborted(),s instanceof Uint8Array?yield t.push(s,a):yield t.push(s.subarray(),a)}),unwrap:()=>{if(o.byteLength>0){let s=r.source;r.source=function(){return k(this,null,function*(){e?.yieldBytes===!1?yield o:yield*J(o),yield*J(s)})}()}return r}}}var Wye=1e4,Yye="1.0.0",Xye="ping",Qye="ipfs",iW=32,Zye=!0,i5=class{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??Qye}/${Xye}/${Yye}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??Wye,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??Zye,this.timeout=new Aa(I(v({},t.pingTimeout??{}),{metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"}))}[Symbol.toStringTag]="@libp2p/connection-monitor";[Pt]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(()=>f(this,null,function*(){let t=Date.now();try{let n=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),o=yield e.newStream(this.protocol,{signal:n,runOnLimitedConnection:!0}),i=Ap(o);t=Date.now(),yield Promise.all([i.write(Vo(iW),{signal:n}),i.read({bytes:iW,signal:n})]),e.rtt=Date.now()-t,yield i.unwrap().close({signal:n})}catch(n){if(n.name!=="UnsupportedProtocolError")throw n;e.rtt=(Date.now()-t)/2}})).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}};var s5=class{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()}),getAttributesFromYieldedValue:(n,o)=>I(v({},o),{providers:[...Array.isArray(o.providers)?o.providers:[],n.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([n])=>({key:ne(n,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([n])=>({key:ne(n,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}start(){return f(this,null,function*(){this.started=!0})}stop(){return f(this,null,function*(){this.started=!1})}findProviders(n){return k(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Vg("No content routers available");let o=this,i=new $i;try{for(var s=O(Lo(...o.routers.filter(d=>d.findProviders instanceof Function).map(d=>d.findProviders(e,t)))),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;u!=null&&(u.multiaddrs.length>0&&(yield new C(this.components.peerStore.merge(u.id,{multiaddrs:u.multiaddrs},t))),!i.has(u.id)&&(i.add(u.id),yield u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}})}provide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Vg("No content routers available");yield Promise.all(this.routers.filter(o=>o.provide instanceof Function).map(o=>f(this,null,function*(){yield o.provide(e,t)})))})}cancelReprovide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Vg("No content routers available");yield Promise.all(this.routers.filter(o=>o.cancelReprovide instanceof Function).map(o=>f(this,null,function*(){yield o.cancelReprovide(e,t)})))})}put(e,t,n){return f(this,null,function*(){if(!this.isStarted())throw new na;yield Promise.all(this.routers.filter(o=>o.put instanceof Function).map(o=>f(this,null,function*(){yield o.put(e,t,n)})))})}get(e,t){return f(this,null,function*(){if(!this.isStarted())throw new na;return Promise.any(this.routers.filter(n=>n.get instanceof Function).map(n=>f(this,null,function*(){return n.get(e,t)})))})}};var a5=globalThis.CustomEvent??Event;function $o(t){return k(this,arguments,function*(r,e={}){let n=e.concurrency??1/0;n<1&&(n=1/0);let o=e.ordered??!1,i=new EventTarget,s=[],a=Ye(),c=Ye(),l=!1,u,d=!1;i.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(()=>f(null,null,function*(){try{try{for(var w=O(r),E,S,A;E=!(S=yield w.next()).done;E=!1){let M=S.value;if(s.length===n&&(a=Ye(),yield a.promise),d)break;let L={done:!1};s.push(L),M().then(F=>{L.done=!0,L.ok=!0,L.value=F,i.dispatchEvent(new a5("task-complete"))},F=>{L.done=!0,L.err=F,i.dispatchEvent(new a5("task-complete"))})}}catch{A=[S]}finally{try{E&&(S=w.return)&&(yield S.call(w))}finally{if(A)throw A[0]}}l=!0,i.dispatchEvent(new a5("task-complete"))}catch(M){u=M,i.dispatchEvent(new a5("task-complete"))}}));function h(){return o?s[0]?.done:!!s.find(w=>w.done)}function*p(){for(;s.length>0&&s[0].done;){let w=s[0];if(s.shift(),w.ok)yield w.value;else throw d=!0,a.resolve(),w.err;a.resolve()}}function*m(){for(;h();)for(let w=0;w<s.length;w++)if(s[w].done){let E=s[w];if(s.splice(w,1),w--,E.ok)yield E.value;else throw d=!0,a.resolve(),E.err;a.resolve()}}for(;;){if(h()||(c=Ye(),yield new C(c.promise)),u!=null||(o?yield*J(p()):yield*J(m()),u!=null))throw u;if(l&&s.length===0)break}})}var c5=class{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{peer:n.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{key:ne(n,"base36")}),getAttributesFromYieldedValue:(n,o)=>I(v({},o),{peers:[...Array.isArray(o.peers)?o.peers:[],n.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";findPeer(e,t){return f(this,null,function*(){if(this.routers.length===0)throw new nv("No peer routers available");if(e.toString()===this.peerId.toString())throw new V6("Should not try to find self");let n=this,o=Lo(...this.routers.filter(l=>l.findPeer instanceof Function).map(l=>function(){return k(this,null,function*(){try{yield yield new C(l.findPeer(e,t))}catch(u){n.log.error(u)}})}()));try{for(var i=O(o),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;if(l!=null)return l.multiaddrs.length>0&&(yield this.peerStore.merge(l.id,{multiaddrs:l.multiaddrs},t)),l}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw new Ot})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new nv("No peer routers available");let o=this,i=ho(1024);try{for(var s=O($o(function(){return k(this,null,function*(){let d=Lo(...o.routers.filter(E=>E.getClosestPeers instanceof Function).map(E=>E.getClosestPeers(e,t)));try{for(var h=O(d),p,m,w;p=!(m=yield new C(h.next())).done;p=!1){let E=m.value;yield()=>f(null,null,function*(){if(E.multiaddrs.length===0)try{E=yield o.findPeer(E.id,I(v({},t),{useCache:!1}))}catch(S){o.log.error("could not find peer multiaddrs",S);return}return E})}}catch{w=[m]}finally{try{p&&(m=h.return)&&(yield new C(m.call(h)))}finally{if(w)throw w[0]}}})}())),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;u!=null&&(u.multiaddrs.length>0&&(yield new C(this.peerStore.merge(u.id,{multiaddrs:u.multiaddrs},t))),!i.has(u.id.toMultihash().bytes)&&(i.add(u.id.toMultihash().bytes),yield u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}})}};var l5=class extends st{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}walk(e){return k(this,null,function*(){this.walking||this.startWalk(),this.walkers++;let t=tt([this.shutdownController.signal,e?.signal]);try{for(;;)this.needNext?.resolve(),this.needNext=Ye(),yield(yield new C(Mr(this,"walk:peer",t,{errorEvent:"walk:error"}))).detail}finally{t.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}})}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;let e=tt([this.walkController.signal,this.shutdownController.signal]);let t=Date.now(),n=0;Promise.resolve().then(()=>f(this,null,function*(){for(this.log("start walk");this.walkers>0;)try{let c=Vo(32),l=Date.now();try{for(var o=O(this.peerRouting.getClosestPeers(c,{signal:e})),i,s,a;i=!(s=yield o.next()).done;i=!1){let u=s.value;e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",u.id,Date.now()-l,this.walkers),n++,this.safeDispatchEvent("walk:peer",{detail:u}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),yield ut(this.needNext.promise,e)),l=Date.now()}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}this.log("walk iteration for %b and %d walkers finished, found %d peers",c,this.walkers,n)}catch(c){this.log.error("random walk errored",c),this.safeDispatchEvent("walk:error",{detail:c})}this.log("no walkers left, ended walk")})).catch(o=>{this.log.error("random walk errored",o)}).finally(()=>{this.log("finished walk, found %d peers after %dms",n,Date.now()-t),this.walking=!1})}};var RP=32,NP=64,u5=class{log;topologies;handlers;components;constructor(e){this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,e.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{let t={};for(let[n,o]of this.topologies)t[n]=o.size;return t}}),this.handlers=rn({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw new j6(`No handler registered for protocol ${e}`);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}handle(e,t,n){return f(this,null,function*(){if(this.handlers.has(e)&&n?.force!==!0)throw new H6(`Handler already registered for protocol ${e}`);let o=Rr.bind({ignoreUndefined:!0})({maxInboundStreams:RP,maxOutboundStreams:NP},n);this.handlers.set(e,{handler:t,options:o}),yield this.components.peerStore.merge(this.components.peerId,{protocols:[e]},n)})}unhandle(e,t){return f(this,null,function*(){(Array.isArray(e)?e:[e]).forEach(o=>{this.handlers.delete(o)}),yield this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)})}register(e,t){return f(this,null,function*(){if(t==null)throw new Q("invalid topology");let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,o=this.topologies.get(e);return o==null&&(o=new Map,this.topologies.set(e,o)),o.set(n,t),n})}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail,n={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(t,n).then(o=>{for(let i of o.protocols){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())a.filter?.has(t)!==!1&&(a.filter?.remove(t),a.onDisconnect?.(t))}}).catch(o=>{o.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,o)})}_onPeerUpdate(e){let{peer:t,previous:n}=e.detail,o=(n?.protocols??[]).filter(i=>!t.protocols.includes(i));for(let i of o){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())a.filter?.has(t.id)!==!1&&(a.filter?.remove(t.id),a.onDisconnect?.(t.id))}}_onPeerIdentify(e){let t=e.detail.protocols,n=e.detail.connection,o=e.detail.peerId;for(let i of t){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())n.limits!=null&&a.notifyOnLimitedConnection!==!0||a.filter?.has(o)!==!0&&(a.filter?.add(o),a.onConnect?.(o,n))}}};var d5=class{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=rn({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=rn({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Dm.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){let t=e[Symbol.toStringTag];if(t==null)throw new Q("Transport must have a valid tag");if(this.transports.has(t))throw new Q(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}afterStart(){return f(this,null,function*(){let e=this.components.addressManager.getListenAddrs();yield this.listen(e)})}stop(){return f(this,null,function*(){let e=[];for(let[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){let o=n.pop();o!=null&&e.push(o.close())}yield Promise.all(e),this.log("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1})}dial(e,t){return f(this,null,function*(){let n=this.dialTransportForMultiaddr(e);if(n==null)throw new W6(`No transport available for address ${String(e)}`);return t?.onProgress?.(new pe("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,I(v({},t),{upgrader:this.components.upgrader}))})}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(let t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(let t of this.transports.values())if(t.listenFilter([e]).length>0)return t}listen(e){return f(this,null,function*(){if(!this.isStarted())throw new na("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}let t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new $6)});let n=[];for(let[i,s]of this.transports.entries()){let a=s.listenFilter(e);for(let c of a){this.log("creating listener for %s on %a",i,c);let l=s.createListener({upgrader:this.components.upgrader}),u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{let d=u.findIndex(h=>h===l);u.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),MT.matches(c)?t.ipv4.attempts++:kT.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),MT.matches(c)&&t.ipv4.success++,kT.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,d),t.errors.set(c.toString(),d),d}))}}let o=yield Promise.allSettled(n);if(!(o.length>0&&o.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Dm.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new z6(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,s])=>`
  ${i}: ${`${s.stack??s}`.split(`
`).join(`
  `)}
`).join("")}`)}})}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;let t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}remove(e){return f(this,null,function*(){let t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);let n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){let o=t.pop();o!=null&&n.push(o.close())}yield Promise.all(n),this.transports.delete(e),this.listeners.delete(e)})}removeAll(){return f(this,null,function*(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));yield Promise.all(e)})}};var zn="/multistream/1.0.0";var f5=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},p5=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},h5=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function vc(r,e={}){let t=Ap(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=It(e.maxDataLength));let n=e?.lengthDecoder??pa,o=e?.lengthEncoder??In;return{read:s=>f(null,null,function*(){let a=-1,c=new Ke;for(;;){c.append(yield t.read(I(v({},s),{bytes:1})));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new f5("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new h5("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new p5("message length too long");return t.read(I(v({},s),{bytes:a}))}),write:(s,a)=>f(null,null,function*(){yield t.write(new Ke(o(s.byteLength),s),a)}),writeV:(s,a)=>f(null,null,function*(){let c=new Ke(...s.flatMap(l=>[o(l.byteLength),l]));yield t.write(c,a)}),unwrap:()=>t.unwrap()}}var Jye=ee(`
`);function Dp(r,e,t){return f(this,null,function*(){yield r.write(e,t)})}function sW(r,e,t){return f(this,null,function*(){yield r.writeV(e,t)})}function e2e(r,e){return f(this,null,function*(){let t=yield r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==Jye[0])throw e.log.error("Invalid mss message - missing newline",t),new bt("Missing newline");return t.sublist(0,-1)})}function Gu(r,e){return f(this,null,function*(){let t=yield e2e(r,e);return ne(t.subarray())})}function av(r,e,t){return f(this,null,function*(){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return t2e(r,e[0],t);let n=vc(r,I(v({},t),{maxDataLength:1024})),o=e.shift();if(o==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',zn,o);let i=ee(`${zn}
`),s=ee(`${o}
`);yield sW(n,[i,s],t),t.log.trace("select: reading multistream-select header");let a=yield Gu(n,t);if(t.log.trace('select: read "%s"',a),a===zn&&(t.log.trace("select: reading protocol response"),a=yield Gu(n,t),t.log.trace('select: read "%s"',a)),a===o)return{stream:n.unwrap(),protocol:o};for(let c of e){t.log.trace('select: write "%s"',c),yield Dp(n,ee(`${c}
`),t),t.log.trace("select: reading protocol response");let l=yield Gu(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new vf("protocol selection failed")})}function t2e(r,e,t){let n=r.sink.bind(r),o=r.source,i=!1,s=!1,a=Ye(),c=!1,l=!1,u=Ye(),d=!1,h=!1,p=Ye(),m=vc({sink:n,source:o},I(v({},t),{maxDataLength:1024}));r.sink=A=>f(null,null,function*(){let{sink:M}=m.unwrap();yield M(function(){return k(this,null,function*(){let L=!1;try{for(var F=O(A),Y,H,U;Y=!(H=yield new C(F.next())).done;Y=!1){let P=H.value;if(l&&(yield new C(u.promise)),c)yield P;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',zn,e,P.byteLength);let R=`${e}
`;yield new Ke(Uint8Array.from([19]),ee(`${zn}
`),In(R.length),ee(R),P).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',zn,e,P.byteLength),c=!0,l=!1,u.resolve(),w().catch(N=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,N)})}L=!0}}catch{U=[H]}finally{try{Y&&(H=F.return)&&(yield new C(H.call(F)))}finally{if(U)throw U[0]}}L||(yield new C(w()))})}())});function w(){return f(this,null,function*(){if(s){t.log.trace("optimistic: already negotiating %s stream",e),yield a.promise;return}s=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),yield E()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),yield S())}finally{s=!1,i=!0,a.resolve()}})}function E(){return f(this,null,function*(){if(l){yield u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',zn,e),yield m.writeV([ee(`${zn}
`),ee(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',zn,e)}finally{c=!0,l=!1,u.resolve()}})}function S(){return f(this,null,function*(){if(h){yield p.promise;return}h=!0;try{t.log.trace("optimistic: reading multistream select header");let A=yield Gu(m,t);if(t.log.trace('optimistic: read multistream select header "%s"',A),A===zn&&(A=yield Gu(m,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',A,e),A!==e)throw new vf("protocol selection failed")}finally{d=!0,h=!1,p.resolve()}})}if(r.source=function(){return k(this,null,function*(){yield new C(w()),t.log.trace('optimistic: reading data from "%s" stream',e),yield*J(m.unwrap().source)})}(),r.closeRead!=null){let A=r.closeRead.bind(r);r.closeRead=M=>f(null,null,function*(){i||(yield w().catch(L=>{t.log.error("could not negotiate protocol before close read",L)})),yield A(M)})}if(r.closeWrite!=null){let A=r.closeWrite.bind(r);r.closeWrite=M=>f(null,null,function*(){i||(yield w().catch(L=>{t.log.error("could not negotiate protocol before close write",L)})),yield A(M)})}if(r.close!=null){let A=r.close.bind(r);r.close=M=>f(null,null,function*(){let L=[];l&&L.push(u.promise),h&&L.push(p.promise),L.length>0?yield ut(Promise.all(L),M?.signal):(i=!0,s=!1,a.resolve()),yield A(M)})}return{stream:r,protocol:e}}function cv(r,e,t){return f(this,null,function*(){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);let n=vc(r,I(v({},t),{maxDataLength:1024,maxLengthLength:2}));for(;;){t.log.trace("handle: reading incoming string");let o=yield Gu(n,t);if(t.log.trace('handle: read "%s"',o),o===zn){t.log.trace('handle: respond with "%s" for "%s"',zn,o),yield Dp(n,ee(`${zn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',zn,o);continue}if(e.includes(o))return t.log.trace('handle: respond with "%s" for "%s"',o,o),yield Dp(n,ee(`${o}
`),t),t.log.trace('handle: responded with "%s" for "%s"',o,o),{stream:n.unwrap(),protocol:o};if(o==="ls"){let i=new Ke(...e.map(s=>wl.single(ee(`${s}
`))),ee(`
`));t.log.trace('handle: respond with "%s" for %s',e,o),yield Dp(n,i,t),t.log.trace('handle: responded with "%s" for %s',e,o);continue}t.log.trace('handle: respond with "na" for "%s"',o),yield Dp(n,ee(`na
`),t),t.log('handle: responded with "na" for "%s"',o)}})}var n2e=500,LP=class{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){let{remoteAddr:t,remotePeer:n,newStream:o,close:i,abort:s,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=o,this._close=i,this._abort=s,this._getStreams=a,this.tags=[]}[Symbol.toStringTag]="Connection";[VV]=!0;get streams(){return this._getStreams()}newStream(e,t){return f(this,null,function*(){if(this.status==="closing")throw new $V("the connection is being closed");if(this.status==="closed")throw new z4("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&t?.runOnLimitedConnection!==!0)throw new G4("Cannot open protocol stream on limited connection");let n=yield this._newStream(e,t);return n.direction="outbound",n})}close(){return f(this,arguments,function*(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){let t=AbortSignal.timeout(n2e);e=I(v({},e),{signal:t})}try{this.log.trace("closing underlying transport"),yield this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}})}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}};function cW(r){return new LP(r)}function i2e(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return RP}function s2e(r,e,t={}){try{let{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??NP}function lW(r,e,t){let n=0;return t.streams.forEach(o=>{o.direction===e&&o.protocol===r&&n++}),n}var m5=class{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=rn({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(n=>{this.connectionEncrypters.set(n.protocol,n)}),this.streamMuxers=rn({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(n=>{this.streamMuxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??1e4,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??1e4,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??1e4,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";shouldBlockConnection(e,...t){return f(this,null,function*(){let n=this.components.connectionGater[e];if(n==null)return;if((yield n.apply(this.components.connectionGater,t))===!0)throw new K6(`The multiaddr connection is blocked by gater.${e}`)})}createInboundAbortSignal(e){let t=tt([AbortSignal.timeout(this.inboundUpgradeTimeout),e]);return t}upgradeInbound(e,t){return f(this,null,function*(){let n=!1,o=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),n=yield ut(this.components.connectionManager.acceptIncomingConnection(e),o),!n)throw new G6("Connection denied");yield ut(this.shouldBlockConnection("denyInboundConnection",e),o),yield this._performUpgrade(e,"inbound",I(v({},t),{signal:o}))}catch(i){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[i.name??"Error"]:!0}),i}finally{o.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}})}upgradeOutbound(e,t){return f(this,null,function*(){try{this.metrics.dials?.increment({outbound:!0});let n=e.remoteAddr.getPeerId(),o;n!=null&&(o=lr(n),yield ut(this.shouldBlockConnection("denyOutboundConnection",o,e),t.signal));let i="outbound";return t.initiator===!1&&(i="inbound"),yield this._performUpgrade(e,i,t)}catch(n){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[n.name??"Error"]:!0}),n}})}_performUpgrade(e,t,n){return f(this,null,function*(){let o,i,s,a,c;this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if(n?.skipProtection!==!0){let u=this.components.connectionProtector;u!=null&&(e.log("protecting the %s connection",t),l=yield u.protect(e,n))}try{if(o=l,n?.skipEncryption!==!0){n?.onProgress?.(new pe(`upgrader:encrypt-${t}-connection`)),{conn:o,remotePeer:i,protocol:c,streamMuxer:a}=yield t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n);let u=v(v({},l),o);yield this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,u)}else{let u=e.remoteAddr.getPeerId();if(u==null)throw new Tm(`${t} connection that skipped encryption must have a peer id`);let d=lr(u);c="native",i=d}if(i.equals(this.components.peerId)){let u=new K4("Can not dial self");throw e.abort(u),u}if(s=o,n?.muxerFactory!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){n?.onProgress?.(new pe(`upgrader:multiplex-${t}-connection`));let u=yield t==="inbound"?this._multiplexInbound(v(v({},l),o),this.streamMuxers,n):this._multiplexOutbound(v(v({},l),o),this.streamMuxers,n);a=u.muxerFactory,s=u.stream}}catch(u){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,u),u}return yield this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:s,muxerFactory:a,remotePeer:i,limits:n?.limits})})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:o,upgradedConn:i,remotePeer:s,muxerFactory:a,limits:c}=e,l,u,d;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:m=>{if(d==null)return;let w=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);Promise.resolve().then(()=>f(this,null,function*(){let E=this.components.registrar.getProtocols(),{stream:S,protocol:A}=yield cv(m,E,{signal:w,log:m.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",A);let M=i2e(A,this.components.registrar);if(lW(A,"inbound",d)===M){let F=new GV(`Too many inbound protocol streams for protocol "${A}" - limit ${M}`);throw m.abort(F),F}m.source=S.source,m.sink=S.sink,m.protocol=A,S.closeWrite!=null&&(m.closeWrite=S.closeWrite),S.closeRead!=null&&(m.closeRead=S.closeRead),S.close!=null&&(m.close=S.close),yield this.components.peerStore.merge(s,{protocols:[A]},{signal:w}),this.components.metrics?.trackProtocolStream(m,d),this._onStream({connection:d,stream:m,protocol:A})})).catch(E=>f(this,null,function*(){d.log.error("error handling incoming stream id %s - %e",m.id,E),m.timeline.close==null&&(yield m.close({signal:w}).catch(S=>m.abort(S)))}))}}),u=(E,...S)=>f(this,[E,...S],function*(m,w={}){if(l==null)throw new Sp("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",m);let A=yield l.newStream();d.log.trace("started new stream %s for protocols %s",A.id,m);try{if(w.signal==null){A.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",m);let H=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);w=I(v({},w),{signal:H})}A.log.trace("selecting protocol from protocols %s",m);let{stream:M,protocol:L}=yield av(A,m,I(v({},w),{log:A.log,yieldBytes:!0}));A.log.trace("selected protocol %s",L);let F=s2e(L,this.components.registrar,w),Y=lW(L,"outbound",d);if(Y>=F){let H=new Mm(`Too many outbound protocol streams for protocol "${L}" - ${Y}/${F}`);throw A.abort(H),H}return yield this.components.peerStore.merge(s,{protocols:[L]}),A.source=M.source,A.sink=M.sink,A.protocol=L,M.closeWrite!=null&&(A.closeWrite=M.closeWrite),M.closeRead!=null&&(A.closeRead=M.closeRead),M.close!=null&&(A.close=M.close),this.components.metrics?.trackProtocolStream(A,d),A}catch(M){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,m,M),A.timeline.close==null&&A.abort(M),M}}),Promise.all([l.sink(i.source),i.sink(l.source)]).catch(m=>{d.log.error("error piping data through muxer - %e",m)}));let h=o.timeline;o.timeline=new Proxy(h,{set:(...m)=>(m[1]==="close"&&m[2]!=null&&h.close==null&&f(this,null,function*(){try{d.status==="open"&&(yield d.close())}catch(w){d.log.error("error closing connection after timeline close %e",w)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}}).catch(w=>{d.log.error("error thrown while dispatching connection:close event %e",w)}),Reflect.set(...m))}),o.timeline.upgraded=Date.now();let p=()=>{throw new Sp("Connection is not multiplexed")};return d=cW({remoteAddr:o.remoteAddr,remotePeer:s,status:"open",direction:n,timeline:o.timeline,multiplexer:l?.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??p,getStreams:()=>l?.streams??[],close:m=>f(this,null,function*(){yield l?.close(m),yield o.close(m)}),abort:m=>{o.abort(m),l?.abort(m)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=h,d}_onStream(e){let{connection:t,stream:n,protocol:o}=e,{handler:i,options:s}=this.components.registrar.getHandler(o);if(t.limits!=null&&s.runOnLimitedConnection!==!0)throw new G4("Cannot open protocol stream on limited connection");i({connection:t,stream:n})}_encryptInbound(e,t){return f(this,null,function*(){let n=Array.from(this.connectionEncrypters.keys());try{let{stream:o,protocol:i}=yield cv(e,n,I(v({},t),{log:e.log})),s=this.connectionEncrypters.get(i);if(s==null)throw new Cp(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),I(v({},yield s.secureInbound(o,t)),{protocol:i})}catch(o){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,o),new Cp(o.message)}})}_encryptOutbound(e,t){return f(this,null,function*(){let n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);let{stream:o,protocol:i}=yield av(e,n,I(v({},t),{log:e.log,yieldBytes:!0})),s=this.connectionEncrypters.get(i);if(s==null)throw new Cp(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),I(v({},yield s.secureOutbound(o,t)),{protocol:i})}catch(o){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,o),new Cp(o.message)}})}_multiplexOutbound(e,t,n){return f(this,null,function*(){let o=Array.from(t.keys());e.log("outbound selecting muxer %s",o);try{e.log.trace("selecting stream muxer from %s",o);let{stream:i,protocol:s}=yield av(e,o,I(v({},n),{log:e.log,yieldBytes:!0}));e.log("selected %s as muxer protocol",s);let a=t.get(s);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing outbound connection",i),new Sp(String(i))}})}_multiplexInbound(e,t,n){return f(this,null,function*(){let o=Array.from(t.keys());e.log("inbound handling muxers %s",o);try{let{stream:i,protocol:s}=yield cv(e,o,I(v({},n),{log:e.log})),a=t.get(s);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing inbound connection",i),new Sp(String(i))}})}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}};var g5="2.8.12",y5="js-libp2p";function v5(r,e){return`${r??y5}/${e??g5} browser/${globalThis.navigator.userAgent}`}var w5=class extends st{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";let t=new st,n=t.dispatchEvent.bind(t);t.dispatchEvent=l=>{let u=n(l),d=this.dispatchEvent(new CustomEvent(l.type,{detail:l.detail}));return u||d},this.peerId=e.peerId,this.logger=e.logger??Cu(),this.log=this.logger.forComponent("libp2p"),this.services={};let o=e.nodeInfo?.name??y5,i=e.nodeInfo?.version??g5,s=this.components=jG({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:o,version:i,userAgent:e.nodeInfo?.userAgent??v5(o,i)},logger:this.logger,events:t,datastore:e.datastore??new op,connectionGater:$G(e.connectionGater),dns:e.dns});e.metrics!=null&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",LG(s,v({addressFilter:this.components.connectionGater.filterMultiaddrForPeer},e.peerStore))),s.events.addEventListener("peer:update",l=>{if(l.detail.previous==null){let u={id:l.detail.peer.id,multiaddrs:l.detail.peer.addresses.map(d=>d.multiaddr)};s.events.safeDispatchEvent("peer:discovery",{detail:u})}}),e.connectionProtector!=null&&this.configureComponent("connectionProtector",e.connectionProtector(s)),this.components.upgrader=new m5(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((l,u)=>this.configureComponent(`connection-encryption-${u}`,l(this.components))),streamMuxers:(e.streamMuxers??[]).map((l,u)=>this.configureComponent(`stream-muxers-${u}`,l(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new d5(this.components,e.transportManager)),this.configureComponent("connectionManager",new n5(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new i5(this.components,e.connectionMonitor)),this.configureComponent("registrar",new u5(this.components)),this.configureComponent("addressManager",new F6(this.components,e.addresses));let a=(e.peerRouters??[]).map((l,u)=>this.configureComponent(`peer-router-${u}`,l(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new c5(this.components,{routers:a}));let c=(e.contentRouters??[]).map((l,u)=>this.configureComponent(`content-router-${u}`,l(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new s5(this.components,{routers:c})),this.configureComponent("randomWalk",new l5(this.components)),(e.peerDiscovery??[]).forEach((l,u)=>{this.configureComponent(`peer-discovery-${u}`,l(this.components)).addEventListener("peer",h=>{this.#e(h)})}),e.transports?.forEach((l,u)=>{this.components.transportManager.add(this.configureComponent(`transport-${u}`,l(this.components)))}),e.services!=null)for(let l of Object.keys(e.services)){let u=e.services[l],d=u(this.components);if(d==null){this.log.error("service factory %s returned null or undefined instance",l);continue}this.services[l]=d,this.configureComponent(l,d),d[rc]!=null&&(this.log("registering service %s for content routing",l),c.push(d[rc])),d[nc]!=null&&(this.log("registering service %s for peer routing",l),a.push(d[nc])),d[gf]!=null&&(this.log("registering service %s for peer discovery",l),d[gf].addEventListener?.("peer",h=>{this.#e(h)}))}HG(s)}configureComponent(e,t){return t==null&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}start(){return f(this,null,function*(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{yield this.components.beforeStart?.(),yield this.components.start(),yield this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",yield this.stop(),e}}})}stop(){return f(this,null,function*(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",yield this.components.beforeStop?.(),yield this.components.stop(),yield this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))})}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let e=new $i;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}dial(n){return f(this,arguments,function*(e,t={}){return this.components.connectionManager.openConnection(e,v({priority:75},t))})}dialProtocol(o,i){return f(this,arguments,function*(e,t,n={}){if(t==null)throw new Q("no protocols were provided to open a stream");if(t=Array.isArray(t)?t:[t],t.length===0)throw new Q("no protocols were provided to open a stream");return(yield this.dial(e,n)).newStream(t,n)})}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}hangUp(n){return f(this,arguments,function*(e,t={}){ju(e)&&(e=lr(e.getPeerId()??"")),yield this.components.connectionManager.closeConnections(e,t)})}getPublicKey(n){return f(this,arguments,function*(e,t={}){if(this.log("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;try{let a=yield this.peerStore.get(e,t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}let o=Gt([ee("/pk/"),e.toMultihash().bytes]),i=yield this.contentRouting.get(o,t),s=Hr(i);return yield this.peerStore.patch(e,{publicKey:s},t),s})}handle(e,t,n){return f(this,null,function*(){Array.isArray(e)||(e=[e]),yield Promise.all(e.map(o=>f(this,null,function*(){yield this.components.registrar.handle(o,t,n)})))})}unhandle(e,t){return f(this,null,function*(){Array.isArray(e)||(e=[e]),yield Promise.all(e.map(n=>f(this,null,function*(){yield this.components.registrar.unhandle(n,t)})))})}register(e,t,n){return f(this,null,function*(){return this.components.registrar.register(e,t,n)})}unregister(e){this.components.registrar.unregister(e)}isDialable(n){return f(this,arguments,function*(e,t={}){return this.components.connectionManager.isDialable(e,t)})}#e(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(n=>{this.log.error(n)})}};function dW(){return f(this,arguments,function*(r={}){r.privateKey??=yield lg("Ed25519");let e=new w5(I(v({},yield xG(r)),{peerId:oq(r.privateKey)}));return r.start!==!1&&(yield e.start()),e})}function FP(){let r=Ye(),e=!1;return{sink:t=>f(null,null,function*(){if(e)throw new Error("already piped");e=!0,r.resolve(t)}),source:function(){return k(this,null,function*(){let t=yield new C(r.promise);yield*J(t)})}()}}function fW(){let r=FP(),e=FP();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}var $g=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function hW(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function b5(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function x5(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function vo(r,...e){if(!hW(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function BP(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function mW(r,e){vo(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function kl(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Rl(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function a2e(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var c2e=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function l2e(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function E5(r){if(typeof r=="string")r=l2e(r);else if(hW(r))r=_5(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function gW(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function yW(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}var UP=(r,e)=>{function t(n,...o){if(vo(n),!c2e)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let u=o[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?vo(u):vo(u,r.nonceLength)}let i=r.tagLength;i&&o[1]!==void 0&&vo(o[1]);let s=e(n,...o),a=(u,d)=>{if(d!==void 0){if(u!==2)throw new Error("cipher output not supported");vo(d)}},c=!1;return{encrypt(u,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,vo(u),a(s.encrypt.length,d),s.encrypt(u,d)},decrypt(u,d){if(vo(u),i&&u.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(s.decrypt.length,d),s.decrypt(u,d)}}}return Object.assign(t,r),t};function VP(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!u2e(e))throw new Error("invalid output, must be aligned");return e}function pW(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function vW(r,e,t){b5(t);let n=new Uint8Array(16),o=a2e(n);return pW(o,0,BigInt(e),t),pW(o,8,BigInt(r),t),n}function u2e(r){return r.byteOffset%4===0}function _5(r){return Uint8Array.from(r)}var bW=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),d2e=bW("expand 16-byte k"),f2e=bW("expand 32-byte k"),p2e=kl(d2e),h2e=kl(f2e);function Me(r,e){return r<<e|r>>>32-e}function jP(r){return r.byteOffset%4===0}var S5=64,m2e=16,xW=2**32-1,wW=new Uint32Array;function g2e(r,e,t,n,o,i,s,a){let c=o.length,l=new Uint8Array(S5),u=kl(l),d=jP(o)&&jP(i),h=d?kl(o):wW,p=d?kl(i):wW;for(let m=0;m<c;s++){if(r(e,t,n,u,s,a),s>=xW)throw new Error("arx: counter overflow");let w=Math.min(S5,c-m);if(d&&w===S5){let E=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let S=0,A;S<m2e;S++)A=E+S,p[A]=h[A]^u[S];m+=S5;continue}for(let E=0,S;E<w;E++)S=m+E,i[S]=o[S]^l[E];m+=w}}function HP(r,e){let{allowShortKeys:t,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=gW({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return x5(o),x5(s),b5(i),b5(t),(a,c,l,u,d=0)=>{vo(a),vo(c),vo(l);let h=l.length;if(u===void 0&&(u=new Uint8Array(h)),vo(u),x5(d),d<0||d>=xW)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);let p=[],m=a.length,w,E;if(m===32)p.push(w=_5(a)),E=h2e;else if(m===16&&t)w=new Uint8Array(32),w.set(a),w.set(a,16),E=p2e,p.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);jP(c)||p.push(c=_5(c));let S=kl(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,S,kl(c.subarray(0,16)),S),c=c.subarray(16)}let A=16-o;if(A!==c.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){let L=new Uint8Array(12);L.set(c,i?0:12-c.length),c=L,p.push(c)}let M=kl(c);return g2e(r,E,S,M,l,u,d,s),Rl(...p),u}}var qn=(r,e)=>r[e++]&255|(r[e++]&255)<<8,$P=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=E5(e),vo(e,32);let t=qn(e,0),n=qn(e,2),o=qn(e,4),i=qn(e,6),s=qn(e,8),a=qn(e,10),c=qn(e,12),l=qn(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=qn(e,16+2*u)}process(e,t,n=!1){let o=n?0:2048,{h:i,r:s}=this,a=s[0],c=s[1],l=s[2],u=s[3],d=s[4],h=s[5],p=s[6],m=s[7],w=s[8],E=s[9],S=qn(e,t+0),A=qn(e,t+2),M=qn(e,t+4),L=qn(e,t+6),F=qn(e,t+8),Y=qn(e,t+10),H=qn(e,t+12),U=qn(e,t+14),P=i[0]+(S&8191),R=i[1]+((S>>>13|A<<3)&8191),N=i[2]+((A>>>10|M<<6)&8191),j=i[3]+((M>>>7|L<<9)&8191),V=i[4]+((L>>>4|F<<12)&8191),Z=i[5]+(F>>>1&8191),X=i[6]+((F>>>14|Y<<2)&8191),te=i[7]+((Y>>>11|H<<5)&8191),ce=i[8]+((H>>>8|U<<8)&8191),fe=i[9]+(U>>>5|o),ue=0,Ue=ue+P*a+R*(5*E)+N*(5*w)+j*(5*m)+V*(5*p);ue=Ue>>>13,Ue&=8191,Ue+=Z*(5*h)+X*(5*d)+te*(5*u)+ce*(5*l)+fe*(5*c),ue+=Ue>>>13,Ue&=8191;let Ce=ue+P*c+R*a+N*(5*E)+j*(5*w)+V*(5*m);ue=Ce>>>13,Ce&=8191,Ce+=Z*(5*p)+X*(5*h)+te*(5*d)+ce*(5*u)+fe*(5*l),ue+=Ce>>>13,Ce&=8191;let ae=ue+P*l+R*c+N*a+j*(5*E)+V*(5*w);ue=ae>>>13,ae&=8191,ae+=Z*(5*m)+X*(5*p)+te*(5*h)+ce*(5*d)+fe*(5*u),ue+=ae>>>13,ae&=8191;let pt=ue+P*u+R*l+N*c+j*a+V*(5*E);ue=pt>>>13,pt&=8191,pt+=Z*(5*w)+X*(5*m)+te*(5*p)+ce*(5*h)+fe*(5*d),ue+=pt>>>13,pt&=8191;let zt=ue+P*d+R*u+N*l+j*c+V*a;ue=zt>>>13,zt&=8191,zt+=Z*(5*E)+X*(5*w)+te*(5*m)+ce*(5*p)+fe*(5*h),ue+=zt>>>13,zt&=8191;let He=ue+P*h+R*d+N*u+j*l+V*c;ue=He>>>13,He&=8191,He+=Z*a+X*(5*E)+te*(5*w)+ce*(5*m)+fe*(5*p),ue+=He>>>13,He&=8191;let er=ue+P*p+R*h+N*d+j*u+V*l;ue=er>>>13,er&=8191,er+=Z*c+X*a+te*(5*E)+ce*(5*w)+fe*(5*m),ue+=er>>>13,er&=8191;let Jn=ue+P*m+R*p+N*h+j*d+V*u;ue=Jn>>>13,Jn&=8191,Jn+=Z*l+X*c+te*a+ce*(5*E)+fe*(5*w),ue+=Jn>>>13,Jn&=8191;let sn=ue+P*w+R*m+N*p+j*h+V*d;ue=sn>>>13,sn&=8191,sn+=Z*u+X*l+te*c+ce*a+fe*(5*E),ue+=sn>>>13,sn&=8191;let an=ue+P*E+R*w+N*m+j*p+V*h;ue=an>>>13,an&=8191,an+=Z*d+X*u+te*l+ce*c+fe*a,ue+=an>>>13,an&=8191,ue=(ue<<2)+ue|0,ue=ue+Ue|0,Ue=ue&8191,ue=ue>>>13,Ce+=ue,i[0]=Ue,i[1]=Ce,i[2]=ae,i[3]=pt,i[4]=zt,i[5]=He,i[6]=er,i[7]=Jn,i[8]=sn,i[9]=an}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,n[0]=e[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(o^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535;Rl(n)}update(e){BP(this),e=E5(e),vo(e);let{buffer:t,blockLen:n}=this,o=e.length;for(let i=0;i<o;){let s=Math.min(n-this.pos,o-i);if(s===n){for(;n<=o-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Rl(this.h,this.r,this.buffer,this.pad)}digestInto(e){BP(this),mW(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=n[s]>>>0,e[i++]=n[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function y2e(r){let e=(n,o)=>r(o).update(E5(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var EW=y2e(r=>new $P(r));function CW(r,e,t,n,o,i=20){let s=r[0],a=r[1],c=r[2],l=r[3],u=e[0],d=e[1],h=e[2],p=e[3],m=e[4],w=e[5],E=e[6],S=e[7],A=o,M=t[0],L=t[1],F=t[2],Y=s,H=a,U=c,P=l,R=u,N=d,j=h,V=p,Z=m,X=w,te=E,ce=S,fe=A,ue=M,Ue=L,Ce=F;for(let pt=0;pt<i;pt+=2)Y=Y+R|0,fe=Me(fe^Y,16),Z=Z+fe|0,R=Me(R^Z,12),Y=Y+R|0,fe=Me(fe^Y,8),Z=Z+fe|0,R=Me(R^Z,7),H=H+N|0,ue=Me(ue^H,16),X=X+ue|0,N=Me(N^X,12),H=H+N|0,ue=Me(ue^H,8),X=X+ue|0,N=Me(N^X,7),U=U+j|0,Ue=Me(Ue^U,16),te=te+Ue|0,j=Me(j^te,12),U=U+j|0,Ue=Me(Ue^U,8),te=te+Ue|0,j=Me(j^te,7),P=P+V|0,Ce=Me(Ce^P,16),ce=ce+Ce|0,V=Me(V^ce,12),P=P+V|0,Ce=Me(Ce^P,8),ce=ce+Ce|0,V=Me(V^ce,7),Y=Y+N|0,Ce=Me(Ce^Y,16),te=te+Ce|0,N=Me(N^te,12),Y=Y+N|0,Ce=Me(Ce^Y,8),te=te+Ce|0,N=Me(N^te,7),H=H+j|0,fe=Me(fe^H,16),ce=ce+fe|0,j=Me(j^ce,12),H=H+j|0,fe=Me(fe^H,8),ce=ce+fe|0,j=Me(j^ce,7),U=U+V|0,ue=Me(ue^U,16),Z=Z+ue|0,V=Me(V^Z,12),U=U+V|0,ue=Me(ue^U,8),Z=Z+ue|0,V=Me(V^Z,7),P=P+R|0,Ue=Me(Ue^P,16),X=X+Ue|0,R=Me(R^X,12),P=P+R|0,Ue=Me(Ue^P,8),X=X+Ue|0,R=Me(R^X,7);let ae=0;n[ae++]=s+Y|0,n[ae++]=a+H|0,n[ae++]=c+U|0,n[ae++]=l+P|0,n[ae++]=u+R|0,n[ae++]=d+N|0,n[ae++]=h+j|0,n[ae++]=p+V|0,n[ae++]=m+Z|0,n[ae++]=w+X|0,n[ae++]=E+te|0,n[ae++]=S+ce|0,n[ae++]=A+fe|0,n[ae++]=M+ue|0,n[ae++]=L+Ue|0,n[ae++]=F+Ce|0}function v2e(r,e,t,n){let o=r[0],i=r[1],s=r[2],a=r[3],c=e[0],l=e[1],u=e[2],d=e[3],h=e[4],p=e[5],m=e[6],w=e[7],E=t[0],S=t[1],A=t[2],M=t[3];for(let F=0;F<20;F+=2)o=o+c|0,E=Me(E^o,16),h=h+E|0,c=Me(c^h,12),o=o+c|0,E=Me(E^o,8),h=h+E|0,c=Me(c^h,7),i=i+l|0,S=Me(S^i,16),p=p+S|0,l=Me(l^p,12),i=i+l|0,S=Me(S^i,8),p=p+S|0,l=Me(l^p,7),s=s+u|0,A=Me(A^s,16),m=m+A|0,u=Me(u^m,12),s=s+u|0,A=Me(A^s,8),m=m+A|0,u=Me(u^m,7),a=a+d|0,M=Me(M^a,16),w=w+M|0,d=Me(d^w,12),a=a+d|0,M=Me(M^a,8),w=w+M|0,d=Me(d^w,7),o=o+l|0,M=Me(M^o,16),m=m+M|0,l=Me(l^m,12),o=o+l|0,M=Me(M^o,8),m=m+M|0,l=Me(l^m,7),i=i+u|0,E=Me(E^i,16),w=w+E|0,u=Me(u^w,12),i=i+u|0,E=Me(E^i,8),w=w+E|0,u=Me(u^w,7),s=s+d|0,S=Me(S^s,16),h=h+S|0,d=Me(d^h,12),s=s+d|0,S=Me(S^s,8),h=h+S|0,d=Me(d^h,7),a=a+c|0,A=Me(A^a,16),p=p+A|0,c=Me(c^p,12),a=a+c|0,A=Me(A^a,8),p=p+A|0,c=Me(c^p,7);let L=0;n[L++]=o,n[L++]=i,n[L++]=s,n[L++]=a,n[L++]=E,n[L++]=S,n[L++]=A,n[L++]=M}var w2e=HP(CW,{counterRight:!1,counterLength:4,allowShortKeys:!1}),b2e=HP(CW,{counterRight:!1,counterLength:8,extendNonceFn:v2e,allowShortKeys:!1});var x2e=new Uint8Array(16),_W=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(x2e.subarray(t))},E2e=new Uint8Array(32);function SW(r,e,t,n,o){let i=r(e,t,E2e),s=EW.create(i);o&&_W(s,o),_W(s,n);let a=vW(n.length,o?o.length:0,!0);s.update(a);let c=s.digest();return Rl(i,a),c}var IW=r=>(e,t,n)=>({encrypt(i,s){let a=i.length;s=VP(a+16,s,!1),s.set(i);let c=s.subarray(0,-16);r(e,t,c,c,1);let l=SW(r,e,t,c,n);return s.set(l,a),Rl(l),s},decrypt(i,s){s=VP(i.length-16,s,!1);let a=i.subarray(0,-16),c=i.subarray(-16),l=SW(r,e,t,a,n);if(!yW(c,l))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),r(e,t,s,s,1),Rl(l),s}}),zP=UP({blockSize:64,nonceLength:12,tagLength:16},IW(w2e)),ult=UP({blockSize:64,nonceLength:24,tagLength:16},IW(b2e));function DW(r,e,t){return Tf(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Fu(r,Mu(t),Mu(e))}var qP=Uint8Array.from([0]),AW=Uint8Array.of();function TW(r,e,t,n=32){Tf(r),la(n);let o=r.outputLen;if(n>255*o)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(n/o);t===void 0&&(t=AW);let s=new Uint8Array(i*o),a=Fu.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)qP[0]=u+1,c.update(u===0?AW:l).update(t).update(qP).digestInto(l),s.set(l,o*u),a._cloneInto(c);return a.destroy(),c.destroy(),uo(l,qP),s.slice(0,n)}var KP={hashSHA256(r){return fc(r.subarray())},getHKDF(r,e){let t=DW(fc,e,r),o=TW(fc,t,void 0,96),i=o.subarray(0,32),s=o.subarray(32,64),a=o.subarray(64,96);return[i,s,a]},generateX25519KeyPair(){let r=i2.utils.randomPrivateKey();return{publicKey:i2.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:i2.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return i2.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return zP(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,o){return zP(n,e,t).decrypt(r.subarray(),o)}};var PW=KP;function MW(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var zg=r=>{let e=br(2);return e[0]=r>>8,e[1]=r,e};zg.bytes=2;var lv=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};lv.bytes=2;function kW(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function GP(r,e){!e.enabled||!$g||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${ne(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${ne(r.privateKey,"hex")}`)):e("Missing local static keys."))}function WP(r,e){!e.enabled||!$g||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ne(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ne(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function RW(r,e){!e.enabled||!$g||e(r?`REMOTE_STATIC_PUBLIC_KEY ${ne(r.subarray(),"hex")}`:"Missing remote static public key.")}function YP(r,e){!e.enabled||!$g||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${ne(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function XP(r,e,t){!t.enabled||!$g||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&ne(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&ne(e.k,"hex")}`))}function Da(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=br(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}var C5=(()=>{class r extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}return r})();var _2e=0,S2e=4294967295,C2e="Cipherstate has reached maximum n, a new handshake must be performed",I5=class{n;bytes;view;constructor(e=_2e){this.n=e,this.bytes=et(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>S2e)throw new Error(C2e)}};var Tp=et(0),qg=class{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new I5(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();let o=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),o}},QP=class{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let n=ee(t,"utf-8");this.h=I2e(e,n),this.ck=this.h,this.cs=new qg(e)}mixKey(e){let[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new qg(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Ke(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,Tp);return[new qg(this.crypto,e),new qg(this.crypto,t)]}},ZP=class{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:n,prologue:o,initiator:i,s,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new QP(t,n),this.ss.mixHash(o),this.initiator=i,this.s=s,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");let o=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},uv=class extends ZP{writeMessageA(e){return new Ke(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new Ke(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new Ke(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new C5(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new C5(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new C5(`handshake stage 2 validation fail: ${t.message}`)}}};function I2e(r,e){if(e.length<=32){let t=et(32);return t.set(e),t}else return r.hash(e)}var A5;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(let i of t.streamMuxers)n.uint32(18),n.string(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={webtransportCerthashes:[],streamMuxers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new Wt('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&i.streamMuxers.length===o.limits.streamMuxers)throw new Wt('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(A5||(A5={}));var dv;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),A5.codec().encode(t.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={identityKey:et(0),identitySig:et(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=A5.codec().decode(t,t.uint32(),{limits:o.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(dv||(dv={}));function JP(r,e,t){return f(this,null,function*(){let n=yield r.sign(NW(e));return dv.encode({identityKey:Sn(r.publicKey),identitySig:n,extensions:t})})}function eM(r,e,t){return f(this,null,function*(){try{let n=dv.decode(r),o=Hr(n.identityKey);if(t?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");let i=NW(e);if(!(yield o.verify(i,n.identitySig)))throw new Error("Invalid payload signature");return n}catch(n){throw new jV(n.message)}})}function NW(r){let e=ee("noise-libp2p-static-key:");return r instanceof Uint8Array?Gt([e,r],e.length+r.length):(r.prepend(e),r)}function OW(r,e){return f(this,null,function*(){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,u=yield JP(i,a.publicKey,l),d=new uv({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:s,s:a});GP(d.s,t),t.trace("Stage 0 - Initiator starting to send first message."),yield n.write(d.writeMessageA(Tp),e),t.trace("Stage 0 - Initiator finished sending first message."),WP(d.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");let h=d.readMessageB(yield n.read(e));t.trace("Stage 1 - Initiator received the message."),YP(d.re,t),RW(d.rs,t),t.trace("Initiator going to check remote's signature...");let p=yield eM(h,d.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),yield n.write(d.writeMessageC(u),e),t.trace("Stage 2 - Initiator sent message with signed payload.");let[m,w]=d.ss.split();return XP(m,w,t),{payload:p,encrypt:E=>m.encryptWithAd(Tp,E),decrypt:(E,S)=>w.decryptWithAd(Tp,E,S)}})}function LW(r,e){return f(this,null,function*(){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,u=yield JP(i,a.publicKey,l),d=new uv({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:s,s:a});GP(d.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(yield n.read(e)),t.trace("Stage 0 - Responder received first message."),YP(d.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),yield n.write(d.writeMessageB(u),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),WP(d.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");let h=d.readMessageC(yield n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");let p=yield eM(h,d.rs,c),[m,w]=d.ss.split();return XP(m,w,t),{payload:p,encrypt:E=>w.encryptWithAd(Tp,E),decrypt:(E,S)=>m.decryptWithAd(Tp,E,S)}})}var BW=16;function UW(r,e){return function(t){return k(this,null,function*(){try{for(var n=O(t),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;for(let c=0;c<a.length;c+=65519){let l=c+65519;l>a.length&&(l=a.length);let u;a instanceof Uint8Array?u=r.encrypt(a.subarray(c,l)):u=r.encrypt(a.sublist(c,l)),e?.encryptedPackets.increment(),yield new Ke(zg(u.byteLength),u)}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}}function VW(r,e){return function(t){return k(this,null,function*(){try{for(var n=O(t),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;for(let c=0;c<a.length;c+=65535){let l=c+65535;if(l>a.length&&(l=a.length),l-BW<c)throw new Error("Invalid chunk");let u=a.sublist(c,l),d=a.subarray(c,l-BW);try{let h=r.decrypt(u,d);e?.decryptedPackets.increment(),yield h}catch(h){throw e?.decryptErrors.increment(),h}}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}})}}var D5=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:n,extensions:o,crypto:i,prologueBytes:s}=t,{metrics:a}=e;this.components=e;let c=i??PW;this.crypto=MW(c),this.extensions=v({webtransportCerthashes:[]},o),this.metrics=a?kW(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=s??et(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[Pt]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];secureOutbound(e,t){return f(this,null,function*(){let n=vc(e,{lengthEncoder:zg,lengthDecoder:lv,maxDataLength:65535}),o=yield this.performHandshakeInitiator(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=yield this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Hr(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:pc(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}})}getStreamMuxer(e){if(e==null||e.length===0)return;let t=this.components.upgrader.getStreamMuxers();if(t!=null)for(let n of e){let o=t.get(n);if(o!=null)return o}if(e.length)throw new HV("Early muxer negotiation was requested but the initiator and responder had no common muxers")}secureInbound(e,t){return f(this,null,function*(){let n=vc(e,{lengthEncoder:zg,lengthDecoder:lv,maxDataLength:65535}),o=yield this.performHandshakeResponder(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=yield this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Hr(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:pc(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}})}performHandshakeInitiator(e,t,n,o){return f(this,null,function*(){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=yield OW({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:v({streamMuxers:s,webtransportCerthashes:[]},this.extensions)},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i})}performHandshakeResponder(e,t,n,o){return f(this,null,function*(){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=yield LW({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:v({streamMuxers:s,webtransportCerthashes:[]},this.extensions)},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i})}createSecureConnection(e,t){return f(this,null,function*(){let[n,o]=fW(),i=e.unwrap();return yield fr(n,UW(t,this.metrics),i,s=>bl(s,{lengthDecoder:lv}),VW(t,this.metrics),n),o})}};function T5(r={}){return e=>new D5(e,r)}function P5(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}var Nl=(()=>{class r extends Error{static name="InvalidFrameError";constructor(t="The frame was invalid"){super(t),this.name="InvalidFrameError"}}return r})(),M5=(()=>{class r extends Error{static name="UnrequestedPingError";constructor(t="Unrequested ping error"){super(t),this.name="UnrequestedPingError"}}return r})(),k5=(()=>{class r extends Error{static name="NotMatchingPingError";constructor(t="Unrequested ping error"){super(t),this.name="NotMatchingPingError"}}return r})(),jW=(()=>{class r extends Error{static name="InvalidStateError";constructor(t="Invalid state"){super(t),this.name="InvalidStateError"}}return r})(),HW=(()=>{class r extends Error{static name="StreamAlreadyExistsError";constructor(t="Strean already exists"){super(t),this.name="StreamAlreadyExistsError"}}return r})(),$W=(()=>{class r extends Error{static name="DecodeInvalidVersionError";constructor(t="Decode invalid version"){super(t),this.name="DecodeInvalidVersionError"}}return r})(),zW=(()=>{class r extends Error{static name="BothClientsError";constructor(t="Both clients"){super(t),this.name="BothClientsError"}}return r})(),R5=(()=>{class r extends Error{static name="ReceiveWindowExceededError";constructor(t="Receive window exceeded"){super(t),this.name="ReceiveWindowExceededError"}}return r})();var qW=new Set([Nl.name,M5.name,k5.name,HW.name,$W.name,zW.name,R5.name]),pv=256*1024,KW=16*1024*1024;var GW={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:pv,maxStreamWindowSize:KW,maxMessageSize:64*1024};function WW(r){if(r.keepAliveInterval<=0)throw new Q("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Q("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Q("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<pv)throw new Q("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Q("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Q("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Q("MaxMessageSize must be greater than a kilobyte")}var $r=function(r){return r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway",r}($r||{}),xr=function(r){return r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST",r}(xr||{}),$ut=Object.values(xr).filter(r=>typeof r!="string"),YW=0,Ta=function(r){return r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError",r}(Ta||{}),Wu=12;var XW=2**24;function A2e(r){if(r[0]!==YW)throw new Nl("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*XW+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*XW+(r[9]<<16)+(r[10]<<8)+r[11]}}var N5=class{source;buffer;frameInProgress;constructor(e){this.source=D2e(e),this.buffer=new Ke,this.frameInProgress=!1}emitFrames(){return k(this,null,function*(){try{for(var e=O(this.source),t,n,o;t=!(n=yield new C(e.next())).done;t=!1){let i=n.value;for(this.buffer.append(i);;){let s=this.readHeader();if(s===void 0)break;let{type:a,length:c}=s;a===$r.Data?(this.frameInProgress=!0,yield{header:s,readData:this.readBytes.bind(this,c)}):yield{header:s}}}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield new C(n.call(e)))}finally{if(o)throw o[0]}}})}readHeader(){if(this.frameInProgress)throw new jW("decoding frame already in progress");if(this.buffer.length<Wu)return;let e=A2e(this.buffer.subarray(0,Wu));return this.buffer.consume(Wu),e}readBytes(e){return f(this,null,function*(){if(this.buffer.length<e)try{for(var n=O(this.source),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(this.buffer.append(a),this.buffer.length>=e)break}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}let t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t})}};function D2e(r){if(r[Symbol.iterator]!==void 0){let e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){let e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function tM(r){let e=new Uint8Array(Wu);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function QW(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function O5(r,e){let t=P5(r).return?.();QW(t)&&t.catch(n=>{e.error("could not cause iterator to return",n)})}var T2e=5e3;function rM(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Yu=class{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=Ye(),this.closed=Ye(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??T2e,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=Zr({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}sink(e){return f(this,null,function*(){if(this.writeStatus!=="ready")throw new Cy(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let s={signal:this.sinkController.signal};if(this.direction==="outbound"){let c=this.sendNewStream(s);rM(c)&&(yield c)}let a=()=>{O5(e,this.log)};try{this.sinkController.signal.addEventListener("abort",a),this.log.trace("sink reading from source");try{for(var t=O(e),n,o,i;n=!(o=yield t.next()).done;n=!1){let c=o.value;c=c instanceof Uint8Array?new Ke(c):c;let l=this.sendData(c,s);rM(l)&&(this.sendingData=Ye(),yield l,this.sendingData.resolve(),this.sendingData=void 0)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}}finally{this.sinkController.signal.removeEventListener("abort",a)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),yield this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(s){throw this.log.trace("sink ended with error, calling abort with error",s),this.abort(s),s}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}})}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}close(e){return f(this,null,function*(){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",yield ut(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))})}closeRead(){return f(this,arguments,function*(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),yield this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")})}closeWrite(){return f(this,arguments,function*(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),yield ut(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&(yield ut(this.sendingData.promise,e.signal)),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),yield ut(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))})}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();rM(t)&&t.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;let e=new zV("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}};var Pa=function(r){return r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished",r}(Pa||{}),L5=class extends Yu{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super(I(v({},e),{onEnd:t=>{this.state=Pa.Finished,e.onEnd?.(t)}})),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=pv,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=Cf(this.source,()=>{this.sendWindowUpdate()})}sendNewStream(){return f(this,null,function*(){})}sendData(n){return f(this,arguments,function*(e,t={}){for(e=e.sublist();e.byteLength!==0;){if(this.sendWindowCapacity===0&&(this.log?.trace("wait for send window capacity, status %s",this.status),yield this.waitForSendWindowCapacity(t),this.status==="closed"||this.status==="aborted"||this.status==="reset")){this.log?.trace("%s while waiting for send window capacity",this.status);return}let o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-Wu,e.length),i=this.getSendFlags();this.sendFrame({type:$r.Data,flag:i,streamID:this._id,length:o},e.sublist(0,o)),this.sendWindowCapacity-=o,e.consume(o)}})}sendReset(){return f(this,null,function*(){this.sendFrame({type:$r.WindowUpdate,flag:xr.RST,streamID:this._id,length:0})})}sendCloseWrite(){return f(this,null,function*(){let e=this.getSendFlags()|xr.FIN;this.sendFrame({type:$r.WindowUpdate,flag:e,streamID:this._id,length:0})})}sendCloseRead(){return f(this,null,function*(){})}waitForSendWindowCapacity(){return f(this,arguments,function*(e={}){if(this.sendWindowCapacity>0)return;let t,n,o=()=>{this.status==="open"||this.status==="closing"?n(new Nn("Stream aborted")):t()};e.signal?.addEventListener("abort",o);try{yield new Promise((i,s)=>{this.sendWindowCapacityUpdate=()=>{i()},n=s,t=i})}finally{e.signal?.removeEventListener("abort",o)}})}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);let t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,t===0&&e.length>0&&this.sendWindowCapacityUpdate?.()}handleData(e,t){return f(this,null,function*(){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new R5("Receive window exceeded");let n=yield t();this.recvWindowCapacity-=e.length,this.sourcePush(n)})}processFlags(e){(e&xr.ACK)===xr.ACK&&this.state===Pa.SYNSent&&(this.state=Pa.Established),(e&xr.FIN)===xr.FIN&&this.remoteCloseWrite(),(e&xr.RST)===xr.RST&&this.reset()}getSendFlags(){switch(this.state){case Pa.Init:return this.state=Pa.SYNSent,xr.SYN;case Pa.SYNReceived:return this.state=Pa.Established,xr.ACK;default:return 0}}sendWindowUpdate(){let e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(e===0&&n>-1&&t-this.epochStart<n*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&e===0)return;let o=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:$r.WindowUpdate,flag:e,streamID:this._id,length:o})}};var ZW="/yamux/1.0.0",P2e=500,F5=class{protocol=ZW;_components;_init;constructor(e,t={}){this._components=e,this._init=t}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[Pt]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new nM(this._components,v(v({},this._init),e))}},nM=class{protocol=ZW;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e,t){this.client=t.direction==="outbound",this.config=v(v({},GW),t),this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),WW(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=Zr({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(n=>{n.destroy()})}}),this.sink=n=>f(this,null,function*(){let o=()=>{let d=P5(n);if(d.return!=null){let h=d.return();M2e(h)&&h.catch(p=>{this.log?.("could not cause sink source to return",p)})}},i,s;try{let d=new N5(n);try{this.closeController.signal.addEventListener("abort",o);try{for(var a=O(d.emitFrames()),c,l,u;c=!(l=yield a.next()).done;c=!1){let h=l.value;yield this.handleFrame(h.header,h.readData)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}}finally{this.closeController.signal.removeEventListener("abort",o)}i=Ta.NormalTermination}catch(d){qW.has(d.name)?(this.log?.error("protocol error in sink",d),i=Ta.ProtocolError):(this.log?.error("internal error in sink",d),i=Ta.InternalError),s=d}this.log?.trace("muxer sink ended"),s!=null?this.abort(s,i):yield this.close({reason:i})}),this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(n=>this.log?.error("keepalive error: %s",n)),this.ping().catch(n=>this.log?.error("ping error: %s",n))}get streams(){return Array.from(this._streams.values())}newStream(e){if(this.remoteGoAway!==void 0)throw new Su("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Su("Muxer closed locally");let t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new Mm("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",t);let n=this._newStream(t,e,Pa.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}ping(){return f(this,null,function*(){if(this.remoteGoAway!==void 0)throw new Su("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Su("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((o,i)=>{let s=()=>{i(new Su("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",s,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",s),o()}}),resolve:e};let t=Date.now();this.sendPing(this.activePing.id);try{yield this.activePing.promise}finally{delete this.activePing}let n=Date.now();this.rtt=n-t}else yield this.activePing.promise;return this.rtt})}getRTT(){return this.rtt}close(){return f(this,arguments,function*(e={}){if(this.closeController.signal.aborted)return;let t=e?.reason??Ta.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),e.signal==null){let n=AbortSignal.timeout(P2e);e=I(v({},e),{signal:n})}try{yield Promise.all([...this._streams.values()].map(n=>f(this,null,function*(){return n.close(e)}))),this.sendGoAway(t),this._closeMuxer()}catch(n){this.abort(n)}})}abort(e,t){if(!this.closeController.signal.aborted){t=t??Ta.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(let n of this._streams.values())n.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,o){if(this._streams.get(e)!=null)throw new Q("Stream already exists with that id");let i=new L5({id:e.toString(),name:t,state:n,direction:o,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:this.logger.forComponent(`libp2p:yamux:${o}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}keepAliveLoop(){return f(this,null,function*(){for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{yield ut(new Promise(t=>{e=setTimeout(t,this.config.keepAliveInterval)}),this.closeController.signal),this.ping().catch(t=>this.log?.error("ping error: %s",t))}catch{clearInterval(e);return}}})}handleFrame(e,t){return f(this,null,function*(){let{streamID:n,type:o,length:i}=e;if(this.log?.trace("received frame %o",e),n===0)switch(o){case $r.Ping:{this.handlePing(e);return}case $r.GoAway:{this.handleGoAway(i);return}default:throw new Nl("Invalid frame type")}else switch(e.type){case $r.Data:case $r.WindowUpdate:{yield this.handleStreamMessage(e,t);return}default:throw new Nl("Invalid frame type")}})}handlePing(e){if(e.flag===xr.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,xr.ACK);else if(e.flag===xr.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Nl("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new M5("ping not requested");if(this.activePing.id!==e)throw new k5("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",Ta[e]??"unknown"),this.remoteGoAway=e;for(let t of this._streams.values())t.reset();this._closeMuxer()}handleStreamMessage(e,t){return f(this,null,function*(){let{streamID:n,flag:o,type:i}=e;(o&xr.SYN)===xr.SYN&&this.incomingStream(n);let s=this._streams.get(n);if(s===void 0){if(i===$r.Data){if(this.log?.("discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");yield t()}else this.log?.trace("frame for missing stream id=%s",n);return}switch(i){case $r.WindowUpdate:{s.handleWindowUpdate(e);return}case $r.Data:{if(t===void 0)throw new Error("unreachable");yield s.handleData(e,t);return}default:throw new Error("unreachable")}})}incomingStream(e){if(this.client!==(e%2===0))throw new Q("Both endpoints are clients");if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:$r.WindowUpdate,flag:xr.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:$r.WindowUpdate,flag:xr.RST,streamID:e,length:0});return}let t=this._newStream(e,void 0,Pa.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===$r.Data){if(t===void 0)throw new Nl("Invalid frame");this.source.push(new Ke(tM(e),t))}else this.source.push(tM(e))}sendPing(e,t=xr.SYN){t===xr.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:$r.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Ta.NormalTermination){this.log?.("sending GoAway reason=%s",Ta[e]),this.localGoAway=e,this.sendFrame({type:$r.GoAway,flag:0,streamID:0,length:e})}};function M2e(r){return r!=null&&typeof r.then=="function"}function JW(r={}){return e=>new F5(e,r)}function B5(r){try{for(let{code:e,value:t}of r.getComponents())if(t!=null&&e===41)return Tq("2000::/3",t)}catch{}return!1}function eY(r,e,t){let n,o,i=!1;function s(){let l={signal:o.signal};if(t?.timeout!=null){let u=tt([o.signal,AbortSignal.timeout(t.timeout)]);l.signal=u}i=!0,Promise.resolve().then(()=>f(null,null,function*(){yield r(l)})).catch(()=>{}).finally(()=>{i=!1,!o.signal.aborted&&(n=setTimeout(s,e))})}let a=cl(s,t?.debounce??100),c=!1;return{setInterval:l=>{e!==l&&(e=l,n!=null&&(clearTimeout(n),n=setTimeout(s,e)))},setTimeout:l=>{t??={},t.timeout=l},run:()=>{i||(clearTimeout(n),a())},start:()=>{c||(c=!0,o=new AbortController,o.signal,t?.runImmediately===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),o?.abort(),c=!1}}}function or(r,e){let t=vc(r,e),n={read:(o,i)=>f(null,null,function*(){let s=yield t.read(i);return o.decode(s)}),write:(o,i,s)=>f(null,null,function*(){yield t.write(i.encode(o),s)}),writeV:(o,i,s)=>f(null,null,function*(){yield t.writeV(o.map(a=>i.encode(a)),s)}),pb:o=>({read:i=>f(null,null,function*(){return n.read(o,i)}),write:(i,s)=>f(null,null,function*(){return n.write(i,o,s)}),writeV:(i,s)=>f(null,null,function*(){return n.writeV(i,o,s)}),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}var tY="libp2p",rY="autonat",nY="1.0.0";var ur;(function(r){let e;(function(l){l.DIAL="DIAL",l.DIAL_RESPONSE="DIAL_RESPONSE"})(e=r.MessageType||(r.MessageType={}));let t;(function(l){l[l.DIAL=0]="DIAL",l[l.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(t||(t={})),function(l){l.codec=()=>nr(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(l){l.OK="OK",l.E_DIAL_ERROR="E_DIAL_ERROR",l.E_DIAL_REFUSED="E_DIAL_REFUSED",l.E_BAD_REQUEST="E_BAD_REQUEST",l.E_INTERNAL_ERROR="E_INTERNAL_ERROR"})(n=r.ResponseStatus||(r.ResponseStatus={}));let o;(function(l){l[l.OK=0]="OK",l[l.E_DIAL_ERROR=100]="E_DIAL_ERROR",l[l.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",l[l.E_BAD_REQUEST=200]="E_BAD_REQUEST",l[l.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(o||(o={})),function(l){l.codec=()=>nr(o)}(n=r.ResponseStatus||(r.ResponseStatus={}));let i;(function(l){let u;l.codec=()=>(u==null&&(u=qe((d,h,p={})=>{if(p.lengthDelimited!==!1&&h.fork(),d.id!=null&&(h.uint32(10),h.bytes(d.id)),d.addrs!=null)for(let m of d.addrs)h.uint32(18),h.bytes(m);p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={addrs:[]},w=h==null?d.len:d.pos+h;for(;d.pos<w;){let E=d.uint32();switch(E>>>3){case 1:{m.id=d.bytes();break}case 2:{if(p.limits?.addrs!=null&&m.addrs.length===p.limits.addrs)throw new Wt('Decode error - map field "addrs" had too many elements');m.addrs.push(d.bytes());break}default:{d.skipType(E&7);break}}}return m})),u),l.encode=d=>ze(d,l.codec()),l.decode=(d,h)=>$e(d,l.codec(),h)})(i=r.PeerInfo||(r.PeerInfo={}));let s;(function(l){let u;l.codec=()=>(u==null&&(u=qe((d,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),d.peer!=null&&(h.uint32(10),r.PeerInfo.codec().encode(d.peer,h)),p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={},w=h==null?d.len:d.pos+h;for(;d.pos<w;){let E=d.uint32();switch(E>>>3){case 1:{m.peer=r.PeerInfo.codec().decode(d,d.uint32(),{limits:p.limits?.peer});break}default:{d.skipType(E&7);break}}}return m})),u),l.encode=d=>ze(d,l.codec()),l.decode=(d,h)=>$e(d,l.codec(),h)})(s=r.Dial||(r.Dial={}));let a;(function(l){let u;l.codec=()=>(u==null&&(u=qe((d,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),d.status!=null&&(h.uint32(8),r.ResponseStatus.codec().encode(d.status,h)),d.statusText!=null&&(h.uint32(18),h.string(d.statusText)),d.addr!=null&&(h.uint32(26),h.bytes(d.addr)),p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={},w=h==null?d.len:d.pos+h;for(;d.pos<w;){let E=d.uint32();switch(E>>>3){case 1:{m.status=r.ResponseStatus.codec().decode(d);break}case 2:{m.statusText=d.string();break}case 3:{m.addr=d.bytes();break}default:{d.skipType(E&7);break}}}return m})),u),l.encode=d=>ze(d,l.codec()),l.decode=(d,h)=>$e(d,l.codec(),h)})(a=r.DialResponse||(r.DialResponse={}));let c;r.codec=()=>(c==null&&(c=qe((l,u,d={})=>{d.lengthDelimited!==!1&&u.fork(),l.type!=null&&(u.uint32(8),r.MessageType.codec().encode(l.type,u)),l.dial!=null&&(u.uint32(18),r.Dial.codec().encode(l.dial,u)),l.dialResponse!=null&&(u.uint32(26),r.DialResponse.codec().encode(l.dialResponse,u)),d.lengthDelimited!==!1&&u.ldelim()},(l,u,d={})=>{let h={},p=u==null?l.len:l.pos+u;for(;l.pos<p;){let m=l.uint32();switch(m>>>3){case 1:{h.type=r.MessageType.codec().decode(l);break}case 2:{h.dial=r.Dial.codec().decode(l,l.uint32(),{limits:d.limits?.dial});break}case 3:{h.dialResponse=r.DialResponse.codec().decode(l,l.uint32(),{limits:d.limits?.dialResponse});break}default:{l.skipType(m&7);break}}}return h})),c),r.encode=l=>ze(l,r.codec()),r.decode=(l,u)=>$e(l,r.codec(),u)})(ur||(ur={}));var F2e=4,B2e=8,U5=class{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(e,t){this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??tY}/${rY}/${nY}`,this.timeout=t.timeout??3e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??20,this.connectionThreshold=t.connectionThreshold??80,this.maxMessageSize=t.maxMessageSize??8192,this.dialResults=rn({name:"libp2p_autonat_dial_results",metrics:e.metrics}),this.findPeers=eY(this.findRandomPeers.bind(this),6e4),this.addressFilter=ho(1024)}[Symbol.toStringTag]="@libp2p/autonat";[Pt]=["@libp2p/autonat"];get[Ri](){return["@libp2p/identify"]}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(yield this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=yield this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&(yield this.components.registrar.unhandle(this.topologyId)),this.dialResults.clear(),this.findPeers.stop(),this.started=!1})}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}findRandomPeers(e){return f(this,null,function*(){if(this.allAddressesAreVerified())return;let t=tt([AbortSignal.timeout(1e4),e?.signal]);try{this.log("starting random walk to find peers to run AutoNAT");try{for(var n=O(this.components.randomWalk.walk({signal:t})),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(!(yield this.components.connectionManager.isDialable(a.multiaddrs))){this.log.trace("random peer %p was not dialable %s",a.id,a.multiaddrs.map(c=>c.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",a.id),yield this.components.connectionManager.openConnection(a.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}}catch{}})}handleIncomingAutonatStream(e){return f(this,null,function*(){let t=AbortSignal.timeout(this.timeout);let n=or(e.stream,{maxDataLength:this.maxMessageSize}).pb(ur);try{let o=yield n.read({signal:t}),i=yield this.handleAutonatMessage(o,e.connection,{signal:t});yield n.write(i,{signal:t}),yield n.unwrap().unwrap().close({signal:t})}catch(o){this.log.error("error handling incoming autonat stream - %e",o),e.stream.abort(o)}})}handleAutonatMessage(e,t,n){return f(this,null,function*(){let o=this.components.addressManager.getAddresses().map(d=>d.toOptions().host),i=e.dial;if(i==null)return this.log.error("dial was missing from message"),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let s,a=i.peer;if(a?.id==null)return this.log.error("PeerId missing from message"),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{let d=Ft(a.id);s=tn(d)}catch(d){return this.log.error("invalid PeerId - %e",d),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",s),!t.remotePeer.equals(s))return this.log("target peer %p did not equal sending peer %p",s,t.remotePeer),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};let c=a.addrs.map(d=>Ee(d)).filter(d=>{let h=d.toOptions();return Ps(d)?!1:h.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",d,t.remoteAddr),!1):o.includes(h.host)?!1:this.components.transportManager.dialTransportForMultiaddr(d)==null?(this.log.trace("not dialing %a - transport unsupported",d),!1):!0}).map(d=>(d.getPeerId()==null&&(d=d.encapsulate(`/p2p/${s.toString()}`)),d));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",s),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(d=>d.toString()).join(", "),s);let l="",u=c[0];for(let d of c){let h;u=d;try{if(h=yield this.components.connectionManager.openConnection(d,n),!h.remoteAddr.equals(d))throw this.log.error("tried to dial %a but dialed %a",d,h.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",s,d),{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.OK,addr:h.remoteAddr.decapsulateCode(Cs("p2p").code).bytes}}}catch(p){this.log.error("could not dial %p - %e",s,p),l=p.message}finally{h!=null&&(yield h.close())}}return{type:ur.MessageType.DIAL_RESPONSE,dialResponse:{status:ur.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:u.bytes}}})}getFirstUnverifiedMultiaddr(e,t){let n=this.components.addressManager.getAddressesWithMetadata().sort((o,i)=>o.type==="observed"&&i.type!=="observed"?1:i.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!B5(o.multiaddr))||Ps(o.multiaddr)));for(let o of n){let i=o.multiaddr.toString(),s=this.dialResults.get(i);if(s!=null){if(s.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",s.multiaddr,e);continue}if(s.queue.size>10){this.log.trace("%a already has enough peers queued",s.multiaddr);continue}}if(s==null){let a=o.expires<Date.now();if(a&&this.addressFilter.remove?.(i),this.addressFilter.has(i))continue;this.addressFilter.add(i),this.log.trace("creating dial result %s %s",a?"to revalidate":"for",i),s={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:nT(),queue:new Bn({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(i,s)}return s}}removeOutdatedMultiaddrResults(){let e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(let t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}verifyExternalAddresses(e){return f(this,null,function*(){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();let n=(yield this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:s})=>s.toOptions().family===6),o=this.getNetworkSegment(e.remoteAddr),i=this.getFirstUnverifiedMultiaddr(o,n);if(i==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){i.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",i.multiaddr),this.confirmAddress(i)):this.log("skipping verifying %a because we are too close to the connection limit",i.multiaddr);return}i.queue.add(s=>f(this,null,function*(){yield this.askPeerToVerify(e,o,s)}),{peerId:e.remotePeer,multiaddr:i.multiaddr}).catch(s=>{i?.result==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,i?.multiaddr,s)})})}askPeerToVerify(e,t,n){return f(this,null,function*(){let o=this.dialResults.get(n.multiaddr.toString());if(o==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}let i=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);let s=yield e.newStream(this.protocol,{signal:i});try{let a=or(s).pb(ur),[,c]=yield Promise.all([a.write({type:ur.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:i}),a.read({signal:i})]);if(c.type!==ur.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}let l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==ur.ResponseStatus.OK&&l!==ur.ResponseStatus.E_DIAL_ERROR)return;if(o=this.dialResults.get(n.multiaddr.toString()),o==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(o.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(o.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(o.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(o.verifyingPeers.add(e.remotePeer),o.networkSegments.push(t),l===ur.ResponseStatus.OK){if(o.success++,o.type!=="observed"){this.confirmAddress(o);return}}else l===ur.ResponseStatus.E_DIAL_ERROR&&o.failure++;this.log("%a success %d failure %d",o.multiaddr,o.success,o.failure),o.success===F2e&&this.confirmAddress(o),o.failure===B2e&&this.unconfirmAddress(o)}finally{try{yield s.close({signal:i})}catch(a){s.abort(a)}}})}hasConnectionCapacity(){let t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){let t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}};function oY(r={}){return e=>new U5(e,r)}var U2e=Ae("dns4"),V2e=Ae("dns6"),j2e=Ae("dnsaddr"),Mp=zr(Ae("dns"),j2e,U2e,V2e),H5=zr(Ae("ip4"),Ae("ip6")),Kg=zr(Ze(H5,Ae("tcp")),Ze(Mp,Ae("tcp"))),$5=Ze(H5,Ae("udp")),H2e=Ze($5,Ae("utp")),$2e=Ze($5,Ae("quic")),z2e=Ze($5,Ae("quic-v1")),oM=zr(Ze(Kg,Ae("ws")),Ze(Mp,Ae("ws"))),V5=zr(Ze(oM,Ae("p2p")),oM),iM=zr(Ze(Kg,Ae("wss")),Ze(Mp,Ae("wss")),Ze(Kg,Ae("tls"),Ae("ws")),Ze(Mp,Ae("tls"),Ae("ws"))),j5=zr(Ze(iM,Ae("p2p")),iM),sM=zr(Ze(Kg,Ae("http")),Ze(H5,Ae("http")),Ze(Mp,Ae("http"))),aM=zr(Ze(Kg,Ae("https")),Ze(H5,Ae("https")),Ze(Mp,Ae("https"))),iY=Ze($5,Ae("webrtc-direct"),Ae("certhash")),cY=zr(Ze(iY,Ae("p2p")),iY),sY=Ze(z2e,Ae("webtransport"),Ae("certhash"),Ae("certhash")),lY=zr(Ze(sY,Ae("p2p")),sY),uY=zr(Ze(V5,Ae("p2p-webrtc-star"),Ae("p2p")),Ze(j5,Ae("p2p-webrtc-star"),Ae("p2p")),Ze(V5,Ae("p2p-webrtc-star")),Ze(j5,Ae("p2p-webrtc-star"))),pft=zr(Ze(V5,Ae("p2p-websocket-star"),Ae("p2p")),Ze(j5,Ae("p2p-websocket-star"),Ae("p2p")),Ze(V5,Ae("p2p-websocket-star")),Ze(j5,Ae("p2p-websocket-star"))),dY=zr(Ze(sM,Ae("p2p-webrtc-direct"),Ae("p2p")),Ze(aM,Ae("p2p-webrtc-direct"),Ae("p2p")),Ze(sM,Ae("p2p-webrtc-direct")),Ze(aM,Ae("p2p-webrtc-direct"))),kp=zr(oM,iM,sM,aM,uY,dY,Kg,H2e,$2e,Mp,cY,lY),hft=zr(Ze(kp,Ae("p2p-stardust"),Ae("p2p")),Ze(kp,Ae("p2p-stardust"))),Xu=zr(Ze(kp,Ae("p2p")),uY,dY,cY,lY,Ae("p2p")),aY=zr(Ze(Xu,Ae("p2p-circuit"),Xu),Ze(Xu,Ae("p2p-circuit")),Ze(Ae("p2p-circuit"),Xu),Ze(kp,Ae("p2p-circuit")),Ze(Ae("p2p-circuit"),kp),Ae("p2p-circuit")),fY=()=>zr(Ze(aY,fY),aY),Pp=fY(),pY=zr(Ze(Pp,Xu,Pp),Ze(Xu,Pp),Ze(Pp,Xu),Pp,Xu);var mft=zr(Ze(Pp,Ae("webrtc"),Ae("p2p")),Ze(Pp,Ae("webrtc")),Ze(kp,Ae("webrtc"),Ae("p2p")),Ze(kp,Ae("webrtc")),Ae("webrtc"));function hY(r){function e(t){let n;try{n=Ee(t)}catch{return!1}let o=r(n.protoNames());return o===null?!1:o===!0||o===!1?o:o.length===0}return e}function Ze(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(o=>(n=typeof o=="function"?o().partialMatch(t):o.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:hY(e),partialMatch:e}}function zr(...r){function e(n){let o=null;return r.some(i=>{let s=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return s!=null?(o=s,!0):!1}),o}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:hY(e),partialMatch:e}}function Ae(r){let e=r;function t(o){let i;try{i=Ee(o)}catch{return!1}let s=i.protoNames();return s.length===1&&s[0]===e}function n(o){return o.length===0?null:o[0]===e?o.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var q2e="bootstrap",K2e=50,G2e=1e3,W2e=(()=>{class r extends st{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??G2e,this.list=[];for(let o of n.list){if(!pY.matches(o)){this.log.error("Invalid multiaddr");continue}let i=Ee(o),s=i.getPeerId();if(s==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}let a={id:lr(s),multiaddrs:[i]};this.list.push(a)}this._init=n}[gf]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[Pt]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}_discoverBootstrapPeers(){return f(this,null,function*(){if(this.timer!=null)for(let t of this.list){if(yield this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??q2e]:{value:this._init.tagValue??K2e,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}})}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}return r})();function mY(r){return e=>new W2e(e,r)}var cM=1e3,gY=60*cM,yY=290;var Cft=2*60*gY,vY=1,z5=2e3,wY=100;var hv=`${Eu}-circuit-relay`,Ift=`${Eu}-circuit-relay-source`,Aft=2*gY,Dft=BigInt(1<<17),Rp="/libp2p/circuit/relay/0.2.0/hop",lM="/libp2p/circuit/relay/0.2.0/stop",Tft=30*cM,Pft=30*cM,uM=300,bY=4096,xY=.001;var Qu;(function(r){let e;(function(o){o.RESERVE="RESERVE",o.CONNECT="CONNECT",o.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.RESERVE=0]="RESERVE",o[o.CONNECT=1]="CONNECT",o[o.STATUS=2]="STATUS"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.peer!=null&&(i.uint32(18),Gg.codec().encode(o.peer,i)),o.reservation!=null&&(i.uint32(26),q5.codec().encode(o.reservation,i)),o.limit!=null&&(i.uint32(34),Wg.codec().encode(o.limit,i)),o.status!=null&&(i.uint32(40),wo.codec().encode(o.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.peer=Gg.codec().decode(o,o.uint32(),{limits:s.limits?.peer});break}case 3:{a.reservation=q5.codec().decode(o,o.uint32(),{limits:s.limits?.reservation});break}case 4:{a.limit=Wg.codec().decode(o,o.uint32(),{limits:s.limits?.limit});break}case 5:{a.status=wo.codec().decode(o);break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(Qu||(Qu={}));var wc;(function(r){let e;(function(o){o.CONNECT="CONNECT",o.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.CONNECT=0]="CONNECT",o[o.STATUS=1]="STATUS"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.peer!=null&&(i.uint32(18),Gg.codec().encode(o.peer,i)),o.limit!=null&&(i.uint32(26),Wg.codec().encode(o.limit,i)),o.status!=null&&(i.uint32(32),wo.codec().encode(o.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.peer=Gg.codec().decode(o,o.uint32(),{limits:s.limits?.peer});break}case 3:{a.limit=Wg.codec().decode(o,o.uint32(),{limits:s.limits?.limit});break}case 4:{a.status=wo.codec().decode(o);break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(wc||(wc={}));var Gg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={id:et(0),addrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(o.limits?.addrs!=null&&i.addrs.length===o.limits.addrs)throw new Wt('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(Gg||(Gg={}));var q5;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);t.voucher!=null&&(n.uint32(26),G5.codec().encode(t.voucher,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={expire:0n,addrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.expire=t.uint64();break}case 2:{if(o.limits?.addrs!=null&&i.addrs.length===o.limits.addrs)throw new Wt('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}case 3:{i.voucher=G5.codec().decode(t,t.uint32(),{limits:o.limits?.voucher});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(q5||(q5={}));var Wg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.duration=t.uint32();break}case 2:{i.data=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(Wg||(Wg={}));var wo=function(r){return r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE",r}(wo||{}),EY=function(r){return r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE",r}(EY||{});(function(r){r.codec=()=>nr(EY)})(wo||(wo={}));var K5;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={relay:et(0),peer:et(0),expiration:0n},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.relay=t.bytes();break}case 2:{i.peer=t.bytes();break}case 3:{i.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(K5||(K5={}));var G5;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),K5.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={publicKey:et(0),payloadType:et(0),signature:et(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=K5.codec().decode(t,t.uint32(),{limits:o.limits?.payload});break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(G5||(G5={}));var dM=(()=>{class r extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}return r})(),_Y=(()=>{class r extends Error{static name="DoubleRelayError";name="DoubleRelayError"}return r})(),SY=(()=>{class r extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}return r})();function fM(r){let e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}var mv=class{expires;bytes;constructor(e){e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;let e={};if(this.bytes!=null){let t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){let t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}},W5=$t(Et(JE.matchers[0],dt("p2p-circuit"))),Y5=$t(dt("p2p-circuit"));function pM(r){let{stream:e,remoteAddr:t,logger:n,onDataRead:o,onDataWrite:i}=r,s=n.forComponent("libp2p:stream:converter"),a=!1,c=!1,l=e.close.bind(e);e.close=m=>f(null,null,function*(){yield l(m),p(!0)});let u=e.abort.bind(e);e.abort=m=>{u(m),p(!0)};let d=e.sink.bind(e);e.sink=m=>f(null,null,function*(){try{yield d(fr(m,w=>Cf(w,E=>i?.(E))))}catch(w){w.type!=="aborted"&&s.error("%s error in sink",t,w)}finally{c=!0,p()}});let h={log:s,sink:e.sink,source:function(){return k(this,null,function*(){try{try{for(var m=O(e.source),w,E,S;w=!(E=yield new C(m.next())).done;w=!1){let A=E.value;o?.(A),yield A}}catch{S=[E]}finally{try{w&&(E=m.return)&&(yield new C(E.call(m)))}finally{if(S)throw S[0]}}}finally{a=!0,p()}})}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function p(m){m===!0&&(a=!0,c=!0),a&&c&&h.timeline.close==null&&(h.timeline.close=Date.now())}return h}var X5=class extends st{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=e,this.started=!1,this.running=!1,this.filter=t.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}start(){return f(this,null,function*(){this.topologyId=yield this.components.registrar.register(Rp,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0})}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(()=>f(this,null,function*(){this.log("searching peer store for relays");let e=yield this.components.peerStore.all({filters:[a=>a.protocols.includes(Rp)],orders:[()=>Math.random()<.5?1:-1,(a,c)=>{let l=CY(a),u=CY(c);return l>u?-1:u>l?1:0}]});for(let a of e)this.log.trace("found relay peer %p in peer store",a.id),this.safeDispatchEvent("relay:discover",{detail:a.id});this.log("found %d relay peers in peer store",e.length);let t=this.queue=new Bn({concurrency:5});this.log("start random walk");try{for(var n=O(this.components.randomWalk.walk({signal:this.discoveryController.signal})),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(this.log.trace("found random peer %p",a.id),t.has(a.id)){this.log.trace("random peer %p was already in queue",a.id);continue}if(this.components.connectionManager.getConnections(a.id)?.length>0){this.log.trace("random peer %p was already connected",a.id);continue}if(!(yield this.components.connectionManager.isDialable(a.multiaddrs))){this.log.trace("random peer %p was not dialable",a.id,a.multiaddrs.map(c=>c.toString()));continue}t.queued>10&&(this.log.trace("wait for space in queue for %p",a.id),yield t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",a.id,t.size,t.running),t.add(this.dialPeer,{peerId:a.id,signal:this.discoveryController.signal}).catch(c=>{this.log.error("error opening connection to random peer %p",a.id,c)})}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}this.log("stop random walk"),yield t.onIdle()})).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(e){this.log.trace("maybe dialing discovered peer %p - %e",e.detail.id),this.maybeDialPeer(e).catch(t=>{this.log.trace("error dialing discovered peer %p - %e",e.detail.id,t)})}maybeDialPeer(e){return f(this,null,function*(){if(this.queue==null)return;let t=e.detail.id,n=e.detail.multiaddrs;if(this.queue.has(t)){this.log.trace("random peer %p was already in queue",t);return}if(this.components.connectionManager.getConnections(t)?.length>0){this.log.trace("random peer %p was already connected",t);return}if(!(yield this.components.connectionManager.isDialable(n))){this.log.trace("random peer %p was not dialable",t);return}this.queue?.add(this.dialPeer,{peerId:e.detail.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to discovered peer %p",e.detail.id,o)})})}dialPeer(n){return f(this,arguments,function*({peerId:e,signal:t}){let o=tt([AbortSignal.timeout(5e3),t]);try{yield this.components.connectionManager.openConnection(e,{signal:o})}finally{o.clear()}})}};function CY(r){let e=r.metadata.get("last-dial-success");return e==null?0:new Date(ne(e)).getTime()}var hM=class extends st{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??z5,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),this.relay?.equals(e.detail.relay)===!0&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(t=>{this.addressManager.removeObservedAddr(t)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{let{details:t}=e.detail;t.type!=="configured"&&t.id===this.reservationId&&this.addedRelay(e.detail)};listen(e){return f(this,null,function*(){if(Y5.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(W5.exactMatch(e)){this.log("listen on specific relay server %a",e);let t=AbortSignal.timeout(this.listenTimeout);let n=e.decapsulate("/p2p-circuit"),o=yield this.connectionManager.openConnection(n,{signal:t});if(!this.reservationStore.hasReservation(o.remotePeer)){this.log("making reservation on peer %p",o.remotePeer);let i=yield this.reservationStore.addRelay(o.remotePeer,"configured");this.addedRelay(i)}}else throw new Iy(`Could not listen on p2p-circuit address "${e}"`)})}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}close(){return f(this,null,function*(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(t=>Ee(t).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(t=>{this.addressManager.confirmObservedAddr(t,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}};function IY(r){return new hM(r)}var AY="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var DY=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=AY[t[r]&63];return e};var Y2e=60*1e3*10,X2e=60*1e3*5,Q2e=30*1e3,Q5=class extends st{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new mo,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??wY,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??z5,this.started=!1,this.relayFilter=ho(100),this.reserveQueue=new Bn({concurrency:t?.reservationConcurrency??vY,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",n=>{[...this.reservations.values()].find(i=>i.connection===n.detail.id)!=null&&this.#t(n.detail.remotePeer).catch(i=>{this.log("could not remove relay %p - %e",n.detail,i)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(()=>f(this,null,function*(){let e=yield this.peerStore.all({filters:[t=>t.tags.has(hv)]});this.log("removing tag from %d old relays",e.length),yield Promise.all(e.map(t=>f(this,null,function*(){yield this.peerStore.merge(t.id,{tags:{[hv]:void 0}})}))),this.log("redialing %d old relays",e.length),yield Promise.all(e.map(t=>f(this,null,function*(){return this.addRelay(t.id,"discovered")}))),this.#r()})).catch(e=>{this.log.error(e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){let e=DY();return this.pendingReservations.push(e),this.#r(),e}addRelay(e,t){return f(this,null,function*(){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new Iy("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new SY("The reservation queue is full");let n=this.reserveQueue.find(e);if(n!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",e),n.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new Iy("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(()=>f(this,null,function*(){let o=Date.now();try{let i=this.reservations.get(e);if(i!=null){let m=this.connectionManager.getConnections(e),w=!1;if(m.length===0&&this.log("already have relay reservation with %p but we are no longer connected",e),m.map(E=>E.id).includes(i.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),w=!0),w&&fM(i.reservation.expire)>Y2e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:i};yield this.#t(e)}if(t==="discovered"&&this.pendingReservations.length===0)throw new dM("Not making reservation on discovered relay because we do not need any more relays");let s=AbortSignal.timeout(this.reservationCompletionTimeout);let a=yield this.connectionManager.openConnection(e,{signal:s});if(ni.matches(a.remoteAddr))throw new _Y("not creating reservation over relayed connection");let c=yield this.#e(a,{signal:s}),l=fM(c.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+l).toString());let u=Math.min(Math.max(l-X2e,Q2e),Math.pow(2,31)-1),d=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(m=>f(this,null,function*(){this.log.error("could not refresh reservation to relay %p - %e",e,m),yield this.#t(e)})).catch(m=>{this.log.error("could not remove expired reservation to relay %p - %e",e,m)})},u),h;if(t==="discovered"){let m=this.pendingReservations.pop();if(m==null)throw new dM("Made reservation on relay but did not need any more discovered relays");h={timeout:d,reservation:c,type:t,connection:a.id,id:m}}else h={timeout:d,reservation:c,type:t,connection:a.id};this.reservations.set(e,h),yield this.peerStore.merge(e,{tags:{[hv]:{value:1,ttl:l}}}),this.#r();let p={relay:e,details:h};return this.safeDispatchEvent("relay:created-reservation",{detail:p}),p}catch(i){throw t==="discovered"&&i.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-o,i),(i.name==="DialError"||i.name==="UnsupportedProtocolError")&&this.relayFilter.add(e.toMultihash().bytes),this.#t(e).catch(s=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,s)}),i}}),{peerId:e})})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return e==null?this.reservations.size:[...this.reservations.values()].reduce((t,n)=>(n.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}#e(e,t){return f(this,null,function*(){t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);let n=yield e.newStream(Rp,t),i=or(n).pb(Qu);this.log.trace("send RESERVE to %p",e.remotePeer),yield i.write({type:Qu.Type.RESERVE},t);let s;try{this.log.trace("reading response from %p",e.remotePeer),s=yield i.read(t)}catch(c){throw n.abort(c),c}finally{n.status!=="closed"&&(yield n.close(t))}if(this.log.trace("read response %o",s),s.status===wo.OK&&s.reservation!=null){let c=new Set;c.add(e.remoteAddr.toString());for(let l of s.reservation.addrs){let u=Ee(l);u.getPeerId()==null&&(u=u.encapsulate(`/p2p/${e.remotePeer}`)),u=Ee(u.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),c.add(u.toString())}return s.reservation.addrs=[...c].map(l=>Ee(l).bytes),s.reservation}let a=`reservation failed with status ${s.status??"undefined"}`;throw this.log.error(a),new Error(a)})}#t(e){return f(this,null,function*(){let t=this.reservations.get(e);t!=null&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),t.type==="discovered"&&this.pendingReservations.push(t.id),yield this.peerStore.merge(e,{tags:{[hv]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#r())})}#r(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=ho(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}};var Z2e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Ee)}catch{return!1}return!0},TY={maxInboundStopStreams:uM,maxOutboundStopStreams:uM,stopTimeout:3e4},Z5=class{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??TY.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??TY.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new X5(e,{filter:t.discoveryFilter??oT(bY,xY)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(o=>{o.name!=="HadEnoughRelaysError"&&o.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,o)})}),this.reservationStore=new Q5(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[Pt]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[Ri](){return this.discovery!=null?["@libp2p/identify"]:[]}[_u]=!0;isStarted(){return this.started}start(){return f(this,null,function*(){this.shutdownController=new AbortController,this.shutdownController.signal,yield this.registrar.handle(lM,e=>{let t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),yield On(this.discovery,this.reservationStore),this.started=!0})}stop(){return f(this,null,function*(){this.shutdownController.abort(),yield ao(this.discovery,this.reservationStore),yield this.registrar.unhandle(lM),this.started=!1})}dial(e,t){return f(this,null,function*(){if(e.protoCodes().filter(p=>p===yY).length!==1){let p="Invalid circuit relay address";throw this.log.error(p,e),new wf(p)}let n=e.toString().split("/p2p-circuit"),o=Ee(n[0]),i=Ee(n[n.length-1]),s=o.getPeerId(),a=i.getPeerId();if(s==null||a==null){let p=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${p}`),new wf(`C${p}`)}let c=lr(s),l=lr(a),d=this.connectionManager.getConnections(c)[0];d==null?(yield this.peerStore.merge(c,{multiaddrs:[o]}),t.onProgress?.(new pe("circuit-relay:open-connection")),d=yield this.connectionManager.openConnection(c,t)):t.onProgress?.(new pe("circuit-relay:reuse-connection"));let h;try{t.onProgress?.(new pe("circuit-relay:open-hop-stream")),h=yield d.newStream(Rp,t);let p=or(h),m=p.pb(Qu);t.onProgress?.(new pe("circuit-relay:write-connect-message")),yield m.write({type:Qu.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Ee(i).bytes]}},t),t.onProgress?.(new pe("circuit-relay:read-connect-response"));let w=yield m.read(t);if(w.status!==wo.OK)throw new bt(`failed to connect via relay with status ${w?.status?.toString()??"undefined"}`);let E=new mv(w.limit),S=pM({stream:p.unwrap(),remoteAddr:e,localAddr:o.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:E.onData,onDataWrite:E.onData});return this.log("new outbound relayed connection %a",S.remoteAddr),yield this.upgrader.upgradeOutbound(S,I(v({},t),{limits:E.getLimits()}))}catch(p){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,p),h?.abort(p),p}})}createListener(e){return IY({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>W5.exactMatch(t)||Y5.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>ni.exactMatch(t))}onStop(o,i){return f(this,arguments,function*({connection:e,stream:t},n){if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),yield this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}let s=or(t).pb(wc),a=yield s.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,a.type),a?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),yield s.write({type:wc.Type.STATUS,status:wo.MALFORMED_MESSAGE},{signal:n}),yield t.close();return}if(a.type!==wc.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),yield s.write({type:wc.Type.STATUS,status:wo.UNEXPECTED_MESSAGE},{signal:n}),yield t.close();return}if(!Z2e(a)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),yield s.write({type:wc.Type.STATUS,status:wo.MALFORMED_MESSAGE},{signal:n}),yield t.close({signal:n});return}let c=tn(Ft(a.peer.id));if((yield this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,c))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),yield s.write({type:wc.Type.STATUS,status:wo.PERMISSION_DENIED},{signal:n}),yield t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),yield s.write({type:wc.Type.STATUS,status:wo.OK},{signal:n});let l=new mv(a.limit),u=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${c.toString()}`),d=this.addressManager.getAddresses()[0],h=pM({stream:s.unwrap().unwrap(),remoteAddr:u,localAddr:d,logger:this.logger,onDataRead:l.onData,onDataWrite:l.onData});this.log("new inbound relayed connection %a",h.remoteAddr),yield this.upgrader.upgradeInbound(h,{limits:l.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",h.remoteAddr)})}};function mM(r={}){return e=>new Z5(e,r)}var Ma;(function(r){let e;(function(o){o.UNUSED="UNUSED",o.CONNECT="CONNECT",o.SYNC="SYNC"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.UNUSED=0]="UNUSED",o[o.CONNECT=100]="CONNECT",o[o.SYNC=300]="SYNC"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.observedAddresses!=null)for(let a of o.observedAddresses)i.uint32(18),i.bytes(a);s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={observedAddresses:[]},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{if(s.limits?.observedAddresses!=null&&a.observedAddresses.length===s.limits.observedAddresses)throw new Wt('Decode error - map field "observedAddresses" had too many elements');a.observedAddresses.push(o.bytes());break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(Ma||(Ma={}));function gM(r,e){return ni.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:R2.matches(r)?!0:jq.matches(r)?Ho(r.toOptions().host)===!1:!1}var PY=1024*4,MY=100,J5={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1},e8=class{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(e,t){this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??J5.timeout,this.retries=t.retries??J5.retries,this.maxInboundStreams=t.maxInboundStreams??J5.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??J5.maxOutboundStreams}[Symbol.toStringTag]="@libp2p/dcutr";[Ri]=["@libp2p/identify"];isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(this.topologyId=yield this.registrar.register(gv,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{ni.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),yield this.registrar.handle(gv,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)})}stop(){return f(this,null,function*(){yield this.registrar.unhandle(gv),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1})}upgradeInbound(e){return f(this,null,function*(){if(yield this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){let o={signal:AbortSignal.timeout(this.timeout)};try{t=yield e.newStream([gv],{signal:o.signal,runOnLimitedConnection:!0});let i=or(t,{maxDataLength:PY}).pb(Ma);this.log("B sending connect to %p",e.remotePeer);let s=Date.now();yield i.write({type:Ma.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(d=>d.bytes)},o),this.log("B receiving connect from %p",e.remotePeer);let a=yield i.read(o);if(a.type!==Ma.Type.CONNECT)throw this.log("A sent wrong message type"),new bt("DCUtR message type was incorrect");let c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new bt("DCUtR connect message had no multiaddrs");let l=Date.now()-s;this.log("A sending sync, rtt %dms",l),yield i.write({type:Ma.Type.SYNC,observedAddresses:[]},o),this.log("A waiting for half RTT"),yield X6(l/2),this.log("B dialing",c);let u=yield this.connectionManager.openConnection(c,{signal:o.signal,priority:MY,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,u.remoteAddr),yield e.close(o);break}catch(i){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,i),t?.abort(i),n===this.retries)throw i}finally{t!=null&&(yield t.close(o))}}})}attemptUnilateralConnectionUpgrade(e){return f(this,null,function*(){let n=(yield this.peerStore.get(e.remotePeer)).addresses.map(o=>{let i=o.multiaddr;return i.getPeerId()==null?i.encapsulate(`/p2p/${e.remotePeer}`):i}).filter(o=>gM(o,this.transportManager));if(n.length>0){let o=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);let i=yield this.connectionManager.openConnection(n,{signal:o,force:!0});if(ni.exactMatch(i.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,i.remoteAddr),yield e.close({signal:o}),!0}catch(i){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,i)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1})}handleIncomingUpgrade(e,t){return f(this,null,function*(){let n={signal:AbortSignal.timeout(this.timeout)};try{let o=or(e,{maxDataLength:PY}).pb(Ma);this.log("A receiving connect");let i=yield o.read(n);if(i.type!==Ma.Type.CONNECT)throw this.log("B sent wrong message type"),new bt("DCUtR message type was incorrect");if(i.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new bt("DCUtR connect message had no multiaddrs");let s=this.getDialableMultiaddrs(i.observedAddresses);if(s.length===0)throw this.log("B had no dialable multiaddrs"),new bt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),yield o.write({type:Ma.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(yield o.read(n)).type!==Ma.Type.SYNC)throw new bt("DCUtR message type was incorrect");this.log("A dialing",s);let c=yield this.connectionManager.openConnection(s,{signal:n.signal,priority:MY,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),yield t.close(n)}catch(o){this.log.error("incoming DCUtR from %p failed",t.remotePeer,o),e.abort(o)}finally{yield e.close(n)}})}getDialableMultiaddrs(e){let t=[];for(let n of e)if(!(n==null||n.length===0))try{let o=Ee(n);if(!gM(o,this.transportManager))continue;t.push(o)}catch{}return t}};var gv="/libp2p/dcutr";function kY(r={}){return e=>new e8(e,r)}var RY="0.1.0",NY="id",OY="id/push",LY="1.0.0",FY="1.0.0";var Zu;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={listenAddrs:[],protocols:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 5:{i.protocolVersion=t.string();break}case 6:{i.agentVersion=t.string();break}case 1:{i.publicKey=t.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&i.listenAddrs.length===o.limits.listenAddrs)throw new Wt('Decode error - map field "listenAddrs" had too many elements');i.listenAddrs.push(t.bytes());break}case 4:{i.observedAddr=t.bytes();break}case 3:{if(o.limits?.protocols!=null&&i.protocols.length===o.limits.protocols)throw new Wt('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 8:{i.signedPeerRecord=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(Zu||(Zu={}));var ui={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function BY(r){if(r!=null&&r.length>0)try{return Ee(r)}catch{}}function tve(r,e){return e??r.userAgent}function t8(r,e,t,n,o){return f(this,null,function*(){if(t("received identify from %p",n.remotePeer),o==null)throw new bt("message was null or undefined");let i={};if(o.listenAddrs.length>0&&(i.addresses=o.listenAddrs.map(c=>({isCertified:!1,multiaddr:Ee(c)}))),o.protocols.length>0&&(i.protocols=o.protocols),o.publicKey!=null){let c=Hr(o.publicKey);if(!pc(c).equals(n.remotePeer))throw new bt("public key did not match remote PeerId");i.publicKey=c}let s;if(o.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=o.signedPeerRecord,l=yield Ia.openAndCertify(c,Wi.DOMAIN),u=Wi.createFromProtobuf(l.payload),d=va(l.publicKey.toCID());if(!u.peerId.equals(d))throw new bt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new bt("signing key does not match remote PeerId");let h;try{h=yield r.get(u.peerId)}catch(p){if(p.name!=="NotFoundError")throw p}if(h!=null&&(i.metadata=h.metadata,h.peerRecordEnvelope!=null)){let p=Ia.createFromProtobuf(h.peerRecordEnvelope),m=Wi.createFromProtobuf(p.payload);m.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,u.seqNumber),u=m,c=h.peerRecordEnvelope)}i.peerRecordEnvelope=c,i.addresses=u.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),s={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,i),yield r.patch(n.remotePeer,i),o.agentVersion!=null||o.protocolVersion!=null){let c={};o.agentVersion!=null&&(c.AgentVersion=ee(o.agentVersion)),o.protocolVersion!=null&&(c.ProtocolVersion=ee(o.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),yield r.merge(n.remotePeer,{metadata:c})}let a={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(c=>Ee(c)),observedAddr:o.observedAddr==null?void 0:Ee(o.observedAddr),protocols:o.protocols,signedPeerRecord:s,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a})}var Yg=class{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(e,t){this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??ui.timeout,this.maxInboundStreams=t.maxInboundStreams??ui.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??ui.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??ui.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??ui.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??ui.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??ui.protocolPrefix}/${RY}`,agentVersion:tve(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(yield this.peerStore.merge(this.peerId,{metadata:{AgentVersion:ee(this.host.agentVersion),ProtocolVersion:ee(this.host.protocolVersion)}}),yield this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)})}stop(){return f(this,null,function*(){yield this.registrar.unhandle(this.protocol),this.started=!1})}};var r8=class extends Yg{connectionManager;concurrency;_push;constructor(e,t={}){super(e,I(v({},t),{protocol:`/${t.protocolPrefix??ui.protocolPrefix}/${OY}/${FY}`,log:e.logger.forComponent("libp2p:identify-push")})),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??ui.concurrency,this._push=cl(this.sendPushMessage.bind(this),t.debounce??1e3),(t.runOnSelfUpdate??ui.runOnSelfUpdate)&&e.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error("error pushing updates to peers - %e",o)})})}[Pt]=["@libp2p/identify-push"];push(){return f(this,null,function*(){this._push()})}sendPushMessage(){return f(this,null,function*(){if(this.isStarted())try{let e=this.addressManager.getAddresses().map(u=>u.decapsulateCode(Cs("p2p").code)),t=new Wi({peerId:this.peerId,multiaddrs:e}),n=yield Ia.seal(t,this.privateKey),o=this.registrar.getProtocols(),i=yield this.peerStore.get(this.peerId),s=ne(i.metadata.get("AgentVersion")??ee(this.host.agentVersion)),a=ne(i.metadata.get("ProtocolVersion")??ee(this.host.protocolVersion)),c=this;function l(){return k(this,null,function*(){for(let u of c.connectionManager.getConnections())(yield new C(c.peerStore.get(u.remotePeer))).protocols.includes(c.protocol)&&(yield()=>f(null,null,function*(){let h,p=AbortSignal.timeout(c.timeout);try{h=yield u.newStream(c.protocol,{signal:p,runOnLimitedConnection:c.runOnLimitedConnection}),yield or(h,{maxDataLength:c.maxMessageSize}).pb(Zu).write({listenAddrs:e.map(w=>w.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:s,protocolVersion:a},{signal:p}),yield h.close({signal:p})}catch(m){c.log.error("could not push identify update to peer",m),h?.abort(m)}}))})}yield ei($o(l(),{concurrency:this.concurrency}))}catch(e){this.log.error("error pushing updates to peers - %e",e)}})}handleProtocol(e){return f(this,null,function*(){let{connection:t,stream:n}=e;try{if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");let o={signal:AbortSignal.timeout(this.timeout)},s=yield or(n,{maxDataLength:this.maxMessageSize}).pb(Zu).read(o);yield n.close(o),yield t8(this.peerStore,this.events,this.log,t,s)}catch(o){this.log.error("received invalid message",o),n.abort(o);return}this.log.trace("handled push from %p",t.remotePeer)})}};var n8=class extends Yg{constructor(e,t={}){super(e,I(v({},t),{protocol:`/${t.protocolPrefix??ui.protocolPrefix}/${NY}/${LY}`,log:e.logger.forComponent("libp2p:identify")})),(t.runOnConnectionOpen??ui.runOnConnectionOpen)&&e.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(i=>{i.name!==vf.name&&this.log.error("error during identify trigged by connection:open",i)})})}[Pt]=["@libp2p/identify"];_identify(n){return f(this,arguments,function*(e,t={}){let o;if(t.signal==null){let i=AbortSignal.timeout(this.timeout);t=I(v({},t),{signal:i})}try{o=yield e.newStream(this.protocol,I(v({},t),{runOnLimitedConnection:this.runOnLimitedConnection}));let s=yield or(o,{maxDataLength:this.maxMessageSize}).pb(Zu).read(t);return yield o.close(t),s}catch(i){throw o?.abort(i),i}})}identify(n){return f(this,arguments,function*(e,t={}){let o=yield this._identify(e,t),{publicKey:i,protocols:s,observedAddr:a}=o;if(i==null)throw new bt("public key was missing from identify message");let c=Hr(i),l=va(c.toCID());if(!e.remotePeer.equals(l))throw new bt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new bt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,s),t8(this.peerStore,this.events,this.log,e,o)})}maybeAddObservedAddress(e){let t=BY(e);if(t==null)return;if(this.log.trace("our observed address was %a",t),Ps(t)){this.log.trace("our observed address was private");return}let n=t.getComponents();if((n[0].code===41||n[0].code===42&&n[1].code===41)&&!B5(t)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}tp.exactMatch(t)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(t))}handleProtocol(e){return f(this,null,function*(){let{connection:t,stream:n}=e,o=AbortSignal.timeout(this.timeout);try{let i=yield this.peerStore.get(this.peerId),s=this.addressManager.getAddresses().map(u=>u.decapsulateCode(Cs("p2p").code)),a=i.peerRecordEnvelope;if(s.length>0&&a==null){let u=new Wi({peerId:this.peerId,multiaddrs:s});a=(yield Ia.seal(u,this.privateKey)).marshal().subarray()}let c=t.remoteAddr.bytes;Vq.matches(t.remoteAddr)||(c=void 0),yield or(n).pb(Zu).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Sn(this.privateKey.publicKey),listenAddrs:s.map(u=>u.bytes),signedPeerRecord:a,observedAddr:c,protocols:i.protocols},{signal:o}),yield n.close({signal:o})}catch(i){this.log.error("could not respond to identify request",i),n.abort(i)}})}};function UY(r={}){return e=>new n8(e,r)}function VY(r={}){return e=>new r8(e,r)}var Np=1e3,yM=60*Np,yv=60*yM,jY=36*yv,HY="/ipfs/kad/1.0.0",$Y=48*yv;var zY=24*yv,qY=10,KY=16384,GY=yv,vM=yv,Zht=10*Np,WY=10*Np;var o8=20,Ju=10,YY=5*yM,XY=Np,QY=5*Np,ZY=5*yM,JY=30*Np,eX=180*Np,wM=`${Eu}-kad-dht`;var vv;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={key:et(0),value:et(0),timeReceived:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(vv||(vv={}));function tX(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),o=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),s=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${o}:${i}:${s}.${c}Z`}function rX(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),o=parseInt(t[2],10)-1,i=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,o,i,s,a,c,l))}var Kn=class r{key;value;timeReceived;constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return vv.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:tX(this.timeReceived)}}static deserialize(e){let t=vv.decode(e);return new r(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=rX(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new r(e.key,e.value,t)}};var ed=class extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}},i8=class extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}},s8=class extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}};var nX;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(nX||(nX={}));var jt=function(r){return r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING",r}(jt||{}),bM=function(r){return r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING",r}(bM||{});(function(r){r.codec=()=>nr(bM)})(jt||(jt={}));var wv=function(r){return r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT",r}(wv||{}),oX=function(r){return r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT",r}(oX||{});(function(r){r.codec=()=>nr(oX)})(wv||(wv={}));var Xg;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(let i of t.multiaddrs)n.uint32(18),n.bytes(i);t.connection!=null&&(n.uint32(24),wv.codec().encode(t.connection,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={id:et(0),multiaddrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(o.limits?.multiaddrs!=null&&i.multiaddrs.length===o.limits.multiaddrs)throw new Wt('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=wv.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(Xg||(Xg={}));var td;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.type!=null&&bM[t.type]!==0&&(n.uint32(8),jt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(let i of t.closer)n.uint32(66),Xg.codec().encode(i,n);if(t.providers!=null)for(let i of t.providers)n.uint32(74),Xg.codec().encode(i,n);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={type:jt.PUT_VALUE,closer:[],providers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.type=jt.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(o.limits?.closer!=null&&i.closer.length===o.limits.closer)throw new Wt('Decode error - map field "closer" had too many elements');i.closer.push(Xg.codec().decode(t,t.uint32(),{limits:o.limits?.closer$}));break}case 9:{if(o.limits?.providers!=null&&i.providers.length===o.limits.providers)throw new Wt('Decode error - map field "providers" had too many elements');i.providers.push(Xg.codec().decode(t,t.uint32(),{limits:o.limits?.providers$}));break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>ze(t,r.codec()),r.decode=(t,n)=>$e(t,r.codec(),n)})(td||(td={}));function xM(r,e={}){let t=I(v({},r),{name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type});return e.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function bv(r,e={}){let t=I(v({},r),{name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]});return e.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function a8(r,e={}){let t=I(v({},r),{name:"FINAL_PEER",type:2});return e.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function ka(r,e={}){let t=I(v({},r),{name:"QUERY_ERROR",type:3});return e.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function EM(r,e={}){let t=I(v({},r),{name:"PROVIDER",type:4});return e.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:t})),t}function xv(r,e={}){let t=I(v({},r),{name:"VALUE",type:5});return e.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:t})),t}function _M(r,e={}){let t=I(v({},r),{name:"DIAL_PEER",type:7});return e.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function iX(r,e={}){let t=I(v({},r),{name:"PATH_ENDED",type:8});return e.onProgress?.(new CustomEvent("kad-dht:query:path-ended",{detail:t})),t}function sX(r,e,t){if(t.length===0)throw new Q("No records given");let o=ne(e).split("/");if(o.length<3)throw new Q("Record key does not have a selector function");let i=r[o[1].toString()];if(i==null)throw new s8(`No selector function configured for key type "${o[1]}"`);return t.length===1?0:i(e,t)}function ove(r,e){return 0}var aX={pk:ove};function Qg(r,e,t){return f(this,null,function*(){let n=e.key,i=ne(n).split("/");if(i.length<3)return;let s=r[i[1].toString()];if(s==null)throw new Q(`No validator available for key type "${i[1]}"`);yield s(n,e.value,t)})}var ive=(r,e,t)=>f(null,null,function*(){if(!(r instanceof Uint8Array))throw new Q('"key" must be a Uint8Array');if(r.byteLength<5)throw new Q("Invalid public key record");if(ne(r.subarray(0,4))!=="/pk/")throw new Q("key was not prefixed with /pk/");let o=Hr(e),i=r.slice(4);if(!Le(i,o.toMultihash().bytes))throw new Q("public key does not match passed in key")}),cX={pk:ive};var sve=ee("/pk/");function lX(r){return I(v({},r),{multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let o=Ho(n);return o==null?!0:!o})})}function rd(r,e){return f(this,null,function*(){let t=yield xt.digest(r);return e?.signal?.throwIfAborted(),t.digest})}function di(r,e){return f(this,null,function*(){return rd(r.toMultihash().bytes,e)})}function nd(r,e){return new Ut(`${r}/${ne(e,"base32")}`,!1)}function uX(r){return Gt([sve,r.toMultihash().bytes])}function dX(r){return ne(r.subarray(0,4))==="/pk/"}function fX(r){let e=Ft(r.subarray(4));return tn(e)}function SM(r,e){let t=new Date;return new Kn(r,e,t).serialize()}var ave=290,cve=54,lve=55,uve=56,dve=4,fve=41;function pX(r){let e=r.stringTuples();for(let t of e)if(t[0]===ave)return!1;if(e[0][0]===cve||e[0][0]===lve||e[0][0]===uve)return!0;if(e[0][0]===dve||e[0][0]===fve){let t=Ho(`${e[0][1]}`);return t==null||!t}return!1}function c8(r){let e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:le.createV1(Pr,Ft(ee(n,"base32"))),peerId:lr(t)}}function l8(r,e,t){let n=typeof e=="string"?e:ne(e.multihash.bytes,"base32"),o=[r,n];return t!=null&&o.push(t.toString()),new Ut(o.join("/"))}function u8(r){return new Date(pa(r))}function Op(r,e,t){return function(...n){return k(this,null,function*(){let o=e.queryTime?.timer(t),i=e.errorTime?.timer(t),s=!1;try{e.queries?.increment({[t]:!0}),yield*J(r(...n))}catch(a){throw s=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),s||o?.()}})}}function d8(r,e,t){return function(...n){return f(this,null,function*(){let o=e?.queryTime?.timer(t),i=e?.errorTime?.timer(t),s=!1;try{return e.queries?.increment({[t]:!0}),yield r(...n)}catch(a){throw s=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),s||o?.()}})}}var f8=class{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){let{validators:n,selectors:o,peerRouting:i,queryManager:s,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=o,this.peerRouting=i,this.queryManager=s,this.network=a,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}getLocal(e,t){return f(this,null,function*(){this.log("getLocal %b",e);let n=nd(this.datastorePrefix,e);this.log("fetching record for key %k",n);let o=yield this.components.datastore.get(n,t);this.log("found %k in local datastore",n);let i=Kn.deserialize(o);return yield Qg(this.validators,i,t),i})}sendCorrectionRecord(e,t,n,o){return k(this,null,function*(){this.log("sendCorrection for %b",e);let i=SM(e,n);for(let{value:u,from:d}of t){if(Le(u,n)){this.log("record was ok");continue}if(this.components.peerId.equals(d)){try{let m=nd(this.datastorePrefix,e);this.log(`Storing corrected record for key ${m.toString()}`),yield new C(this.components.datastore.put(m,i.subarray(),o))}catch(m){this.log.error("Failed error correcting self",m)}continue}let h=!1,p={type:jt.PUT_VALUE,key:e,record:i};try{for(var s=O(this.network.sendRequest(d,p,o)),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let m=c.value;m.name==="PEER_RESPONSE"&&m.record!=null&&Le(m.record.value,Kn.deserialize(i).value)&&(h=!0),yield m}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}if(!h)throw new ed("Could not send correction");this.log.error("Failed error correcting entry")}})}put(e,t,n){return k(this,null,function*(){this.log("put key %b value %b",e,t);let o=SM(e,t),i=nd(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),yield new C(this.components.datastore.put(i,o.subarray(),n)),yield*J(fr(this.peerRouting.getClosestPeers(e,I(v({},n),{signal:n.signal})),s=>An(s,a=>()=>f(this,null,function*(){if(a.name!=="FINAL_PEER")return[a];let c=[],l={type:jt.PUT_VALUE,key:e,record:o};this.log("send put to %p",a.peer.id);try{for(var u=O(this.network.sendRequest(a.peer.id,l,I(v({},n),{path:a.path}))),d,h,p;d=!(h=yield u.next()).done;d=!1){let m=h.value;c.push(m),m.name==="PEER_RESPONSE"&&(m.record!=null&&Le(m.record.value,Kn.deserialize(o).value)||c.push(ka({from:a.peer.id,error:new ed("Value not put correctly"),path:m.path},n)))}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield h.call(u))}finally{if(p)throw p[0]}}return c})),s=>$o(s,{ordered:!1,concurrency:Ju}),function(s){return k(this,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield new C(a.next())).done;c=!1){let d=l.value;yield*J(d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new C(l.call(a)))}finally{if(u)throw u[0]}}})}))})}get(e,t){return k(this,null,function*(){this.log("get %b",e);let n=[];try{for(var a=O(this.getMany(e,t)),c,l,u;c=!(l=yield new C(a.next())).done;c=!1){let d=l.value;if(d.name==="VALUE"){n.push(d);continue}yield d}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new C(l.call(a)))}finally{if(u)throw u[0]}}if(n.length===0)return;let o=n.map(d=>d.value),i=0;try{i=sX(this.selectors,e,o)}catch(d){if(d.name!=="InvalidParametersError")throw d}let s=o[i];if(this.log("GetValue %b %b",e,s),s==null)throw new Ot("Best value was not found");yield*J(this.sendCorrectionRecord(e,n,s,I(v({},t),{path:{index:-1,queued:0,running:0,total:0}}))),yield n[i]})}getMany(n){return k(this,arguments,function*(e,t={}){this.log("getMany values for %b",e);try{let s=yield new C(this.getLocal(e,t));yield xv({value:s.value,from:this.components.peerId,path:{index:-1,running:0,queued:0,total:0}},t)}catch(s){this.log("error getting local value for %b",e,s)}let o=this,i=function(l){return k(this,arguments,function*({peer:s,signal:a,path:c}){try{for(var u=O(o.peerRouting.getValueOrPeers(s.id,e,I(v({},t),{signal:a,path:c}))),d,h,p;d=!(h=yield new C(u.next())).done;d=!1){let m=h.value;yield m,m.name==="PEER_RESPONSE"&&m.record!=null&&(yield xv({from:s.id,value:m.record.value,path:c},t))}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new C(h.call(u)))}finally{if(p)throw p[0]}}})};yield*J(this.queryManager.run(e,i,t))})}};function hX(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function Ev(r){if(r.id==null)throw new Error("Invalid peer in message");let e=Ft(r.id);return{id:tn(e),multiaddrs:(r.multiaddrs??[]).map(t=>Ee(t))}}var p8=class{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){let{network:n,peerRouting:o,queryManager:i,routingTable:s,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=o,this.queryManager=i,this.routingTable=s,this.providers=a,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PROVIDER"&&(u.providers??=[],u.providers.push(...l.providers.map(d=>d.id.toString()))),u)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PEER_RESPONSE"&&l.messageName==="ADD_PROVIDER"&&(u.providers??=[],u.providers.push(l.from.toString())),u)})??this.provide}provide(o,i){return k(this,arguments,function*(e,t,n={}){this.log("provide %s",e);let s=e.multihash.bytes;yield new C(this.providers.addProvider(e,this.components.peerId,n));let a={type:jt.ADD_PROVIDER,key:s,providers:[hX({id:this.components.peerId,multiaddrs:t})]},c=0,l=this;function u(p){return k(this,null,function*(){try{l.log("sending provider record for %s to %p",e,p.peer.id);try{for(var m=O(l.network.sendMessage(p.peer.id,a,I(v({},n),{path:p.path}))),w,E,S;w=!(E=yield new C(m.next())).done;w=!1){let A=E.value;A.name==="PEER_RESPONSE"&&(l.log("sent provider record for %s to %p",e,p.peer.id),c++),yield A}}catch{S=[E]}finally{try{w&&(E=m.return)&&(yield new C(E.call(m)))}finally{if(S)throw S[0]}}}catch(A){l.log.error("error sending provide record to peer %p",p.peer.id,A),yield ka({from:p.peer.id,error:A,path:p.path},n)}})}let d=Zr({objectMode:!0}),h=new Ln({concurrency:Ju});h.addEventListener("idle",()=>{d.end()}),h.addEventListener("error",p=>{this.log.error("error publishing provider record to peer - %e",p)}),h.add(()=>f(this,null,function*(){let p=[];try{for(var m=O(this.peerRouting.getClosestPeers(s,n)),w,E,S;w=!(E=yield m.next()).done;w=!1){let A=E.value;d.push(A),A.name==="FINAL_PEER"&&p.push(A)}}catch{S=[E]}finally{try{w&&(E=m.return)&&(yield E.call(m))}finally{if(S)throw S[0]}}p.forEach(A=>{h.add(()=>f(this,null,function*(){try{for(var M=O(u(A)),L,F,Y;L=!(F=yield M.next()).done;L=!1){let H=F.value;d.push(H)}}catch{Y=[F]}finally{try{L&&(F=M.return)&&(yield F.call(M))}finally{if(Y)throw Y[0]}}})).catch(M=>{this.log.error("error publishing provider record to peer - %e",M)})})})).catch(p=>{d.end(p)}),yield*J(d),this.log("sent provider records to %d peers",c)})}findProviders(e,t){return k(this,null,function*(){let n=this.routingTable.kBucketSize,o=0,i=e.multihash.bytes,s=this;this.log("findProviders %c",e);let a=yield new C(this.providers.getProviders(e,t));if(a.length>0){let m=[];for(let w of a.slice(0,n))try{let E=yield new C(this.components.peerStore.get(w,t));m.push({id:w,multiaddrs:E.addresses.map(({multiaddr:S})=>S)})}catch(E){if(E.name!=="NotFoundError")throw E;this.log("no peer store entry for %p",w)}if(yield bv({from:this.components.peerId,messageType:jt.GET_PROVIDERS,providers:m,path:{index:-1,queued:0,running:0,total:0}},t),yield EM({from:this.components.peerId,providers:m,path:{index:-1,queued:0,running:0,total:0}},t),o+=m.length,o>=n)return}let c=function(S){return k(this,arguments,function*({peer:m,signal:w,path:E}){let A={type:jt.GET_PROVIDERS,key:i};yield*J(s.network.sendRequest(m.id,A,I(v({},t),{signal:w,path:E})))})},l=new $i(a);try{for(var u=O(this.queryManager.run(i,c,t)),d,h,p;d=!(h=yield new C(u.next())).done;d=!1){let m=h.value;if(yield m,m.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",m.providers.length,e,m.closer.length);let w=[];for(let E of m.providers)l.has(E.id)||(l.add(E.id),w.push(E));if(w.length>0&&(yield EM({from:m.from,providers:w,path:m.path},t),o+=w.length,o>=n))return}}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new C(h.call(u)))}finally{if(p)throw p[0]}}})}};var h8=class extends st{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new Aa(I(v({},t.timeout??{}),{metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`})),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([n,o],i){return I(v({},i),{to:n.toString(),"message type":`${o.type}`})},getAttributesFromYieldedValue:(n,o)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,s)=>{o[`providers-${s}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,s)=>{o[`closer-${s}`]=i.id.toString()})),o)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([n,o],i){return I(v({},i),{to:n.toString(),"message type":`${o.type}`})},getAttributesFromYieldedValue:(n,o)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,s)=>{o[`providers-${s}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,s)=>{o[`closer-${s}`]=i.id.toString()})),o)})??this.sendMessage}start(){return f(this,null,function*(){this.running||(this.running=!0)})}stop(){return f(this,null,function*(){this.running=!1})}isStarted(){return this.running}sendRequest(e,t,n){return k(this,null,function*(){if(!this.running)return;let o=t.type;if(o==null)throw new Q("Message type was missing");let i,s=this.timeout.getTimeoutSignal(n);n=I(v({},n),{signal:s});try{this.metrics.operations?.increment({[o]:!0}),this.log("dialling %p",e),yield _M({peer:e,path:n.path},n);let a=yield new C(this.components.connectionManager.openConnection(e,n));i=yield new C(a.newStream(this.protocol,n)),this.log("sending %s to %p",t.type,e),yield xM({to:e,type:o,path:n.path},n);let c=yield new C(this._writeReadMessage(i,t,n));i.close(n).catch(l=>{this.log.error("error closing stream to %p",e,l),i?.abort(l)}),yield bv({from:e,messageType:c.type,closer:c.closer.map(Ev),providers:c.providers.map(Ev),record:c.record==null?void 0:Kn.deserialize(c.record),path:n.path},n)}catch(a){this.metrics.errors?.increment({[o]:!0}),i?.abort(a),n.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,a),yield ka({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(s)}})}sendMessage(e,t,n){return k(this,null,function*(){if(!this.running)return;let o=t.type;if(o==null)throw new Q("Message type was missing");let i,s=this.timeout.getTimeoutSignal(n);n=I(v({},n),{signal:s});try{this.metrics.operations?.increment({[o]:!0}),this.log("dialling %p",e),yield _M({peer:e,path:n.path},n);let a=yield new C(this.components.connectionManager.openConnection(e,n));i=yield new C(a.newStream(this.protocol,n)),this.log("sending %s to %p",t.type,e),yield xM({to:e,type:o,path:n.path},n),yield new C(this._writeMessage(i,t,n)),i.close(n).catch(c=>{this.log.error("error closing stream to %p",e,c),i?.abort(c)}),yield bv({from:e,messageType:o,path:n.path},n)}catch(a){this.metrics.errors?.increment({[o]:!0}),i?.abort(a),yield ka({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(s)}})}_writeMessage(e,t,n){return f(this,null,function*(){yield or(e).write(t,td,n)})}_writeReadMessage(e,t,n){return f(this,null,function*(){let o=or(e);yield o.write(t,td,n);let i=yield o.read(td,n);return i.closer.forEach(s=>{this.safeDispatchEvent("peer",{detail:Ev(s)})}),i.providers.forEach(s=>{this.safeDispatchEvent("peer",{detail:Ev(s)})}),i})}};function Lp(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}var od=class{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return[...this.peerDistances]}add(o){return f(this,arguments,function*(e,t={index:-1,queued:0,running:0,total:0},n){let i=yield di(e.id,n);this.addWithKadId(e,i,t)})}addWithKadId(e,t,n={index:-1,queued:0,running:0,total:0}){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;let o={peer:e,distance:Da(this.originDhtKey,t),path:n};if(this.peerDistances.length===this.capacity){let s=this.peerDistances[this.peerDistances.length-1];if(s!=null&&Lp(o.distance,s.distance)!==-1)return}let i=!1;for(let s=0;s<this.peerDistances.length;s++){let a=Lp(this.peerDistances[s].distance,o.distance);if(a===0||a===1){i=!0,this.peerDistances.splice(s,0,o);break}}i||this.peerDistances.push(o),this.peerDistances=this.peerDistances.slice(0,this.capacity)}isCloser(e,t){return f(this,null,function*(){if(this.length===0)return!0;let n=yield di(e,t),o=Da(n,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return Lp(o,i)===-1})}anyCloser(e,t){return f(this,null,function*(){return e.length===0?!1:Promise.any(e.map(n=>f(this,null,function*(){return this.isCloser(n,t)})))})}};var m8=class{log;routingTable;network;validators;queryManager;components;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}findPeerLocal(e,t){return f(this,null,function*(){let n,o=yield this.routingTable.find(e,t);if(o!=null){this.log("findPeerLocal found %p in routing table",e);try{n=yield this.components.peerStore.get(o,t)}catch(i){if(i.name!=="NotFoundError")throw i}}if(n==null)try{n=yield this.components.peerStore.get(e,t)}catch(i){if(i.name!=="NotFoundError")throw i}if(n!=null)return this.log("findPeerLocal found %p in peer store",e),{id:n.id,multiaddrs:n.addresses.map(i=>i.multiaddr)}})}_getValueSingle(e,t,n){return k(this,null,function*(){let o={type:jt.GET_VALUE,key:t};yield*J(this.network.sendRequest(e,o,n))})}getPublicKeyFromNode(n){return k(this,arguments,function*(e,t={}){let o=uX(e),i={index:-1,queued:0,running:0,total:0};try{for(var s=O(this._getValueSingle(e,o,I(v({},t),{path:i}))),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;if(yield u,u.name==="PEER_RESPONSE"&&u.record!=null){let d=Hr(u.record.value),h=pc(d);if(!h.equals(e))throw new yf("public key does not match id");if(h.publicKey==null)throw new yf("public key missing");yield xv({from:e,value:u.record.value,path:i},t)}}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}throw new ed(`Node not responding with its public key: ${e.toString()}`)})}findPeer(n){return k(this,arguments,function*(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){let l=yield new C(this.findPeerLocal(e,t));if(l!=null){this.log("found local"),yield a8({from:this.components.peerId,peer:l,path:{index:-1,queued:0,running:0,total:0}},t);return}}let o=!1;if(t.useNetwork!==!1){let l=this,u=function(m){return k(this,arguments,function*({peer:d,signal:h,path:p}){let w={type:jt.FIND_NODE,key:e.toMultihash().bytes};try{for(var E=O(l.network.sendRequest(d.id,w,I(v({},t),{signal:h,path:p}))),S,A,M;S=!(A=yield new C(E.next())).done;S=!1){let L=A.value;if(yield L,L.name==="PEER_RESPONSE"){let F=L.closer.find(Y=>Y.id.equals(e));F!=null&&(yield a8({from:L.from,peer:F,path:L.path},t))}}}catch{M=[A]}finally{try{S&&(A=E.return)&&(yield new C(A.call(E)))}finally{if(M)throw M[0]}}})};try{for(var i=O(this.queryManager.run(e.toMultihash().bytes,u,t)),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let d=a.value;d.name==="FINAL_PEER"&&(o=!0),yield d}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}}if(!o)throw new Ot("Not found")})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){this.log("getClosestPeers to %b",e);let o=yield new C(rd(e,t)),i=new od(o,this.routingTable.kBucketSize),s=this,a=function(h){return k(this,arguments,function*({peer:c,path:l,peerKadId:u,signal:d}){s.log("getClosestPeers asking %p",c.id);let p={type:jt.FIND_NODE,key:e};yield*J(s.network.sendRequest(c.id,p,I(v({},t),{signal:d,path:l}))),i.addWithKadId(c,u,l)})};yield*J(this.queryManager.run(e,a,t)),this.log("found %d peers close to %b",i.length,e);for(let{peer:c,path:l}of i.peers)try{if(c.multiaddrs.length===0&&(c=yield new C(s.components.peerStore.getInfo(c.id,t))),c.multiaddrs.length===0)continue;yield a8({from:this.components.peerId,peer:yield new C(s.components.peerStore.getInfo(c.id,t)),path:{index:l.index,queued:0,running:0,total:0}},t)}catch{continue}})}getValueOrPeers(e,t,n){return k(this,null,function*(){try{for(var o=O(this._getValueSingle(e,t,n)),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;if(c.name==="PEER_RESPONSE"&&c.record!=null)try{yield new C(this._verifyRecordOnline(c.record,n))}catch{let u="invalid record received, discarded";this.log(u),yield ka({from:c.from,error:new ed(u),path:n.path},n);continue}yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}_verifyRecordOnline(e,t){return f(this,null,function*(){if(e.timeReceived==null)throw new i8("invalid record received");yield Qg(this.validators,new Kn(e.key,e.value,e.timeReceived),t)})}getClosestPeersOffline(e,t){return f(this,null,function*(){let n=[];try{let s=Ft(e),a=tn(s),c=yield this.components.peerStore.get(a,t);n.push({id:c.id,multiaddrs:c.addresses.map(({multiaddr:l})=>l)})}catch{}let o=yield rd(e,t),i=this.routingTable.closestPeers(o,t);for(let s of i)try{n.push(yield this.components.peerStore.getInfo(s,t))}catch(a){if(a.name!=="NotFoundError")throw a}return n.length>0?this.log("getClosestPeersOffline returning the %d closest peer(s) %b we know",n.length,e):this.log("getClosestPeersOffline could not any peers close to %b with %d peers in the routing table",e,this.routingTable.size),n})}};var g8=class{log;datastore;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore}addProvider(e,t,n){return f(this,null,function*(){this.log.trace("%p provides %s",t,e),yield this.writeProviderEntry(e,t,n)})}removeProvider(e,t,n){return f(this,null,function*(){let o=l8(this.datastorePrefix,e,t);this.log.trace("%p no longer provides %s",t,e),yield this.datastore.delete(o,n)})}getProviders(e,t){return f(this,null,function*(){this.log.trace("get providers for %c",e);let n=yield this.loadProviders(e,t);return this.log.trace("got %d providers for %c",n.size,e),[...n.keys()]})}writeProviderEntry(e,t,n){return f(this,null,function*(){let o=l8(this.datastorePrefix,e,t),i=In(n?.time?.getTime()??Date.now());yield this.datastore.put(o,i,n)})}loadProviders(e,t){return f(this,null,function*(){let n=new mo,o=l8(this.datastorePrefix,e);try{for(var i=O(this.datastore.query({prefix:o.toString()},t)),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;let{peerId:u}=c8(l.key);n.set(u,u8(l.value))}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}return n})}};var hve=r=>{let e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function mve(r,e,t){let n,o=new Promise((i,s)=>{if(t=v({rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1},t),!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();let a=[e].flat(),c=[],{addListener:l,removeListener:u}=hve(r),d=(...p)=>{let m=t.multiArgs?p:p[0];t.filter&&!t.filter(m)||(c.push(m),t.count===c.length&&(n(),i(c)))},h=p=>{n(),s(p)};n=()=>{for(let p of a)u(p,d);for(let p of t.rejectionEvents)u(p,h)};for(let p of a)l(p,d);for(let p of t.rejectionEvents)l(p,h);t.signal&&t.signal.addEventListener("abort",()=>{h(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(o.cancel=n,typeof t.timeout=="number"){let i=al(o,{milliseconds:t.timeout});return i.cancel=n,i}return o}function mX(r,e,t){typeof t=="function"&&(t={filter:t}),t=I(v({},t),{count:1,resolveImmediately:!1});let n=mve(r,e,t),o=n.then(i=>i[0]);return o.cancel=n.cancel,o}function gX(r){return k(this,null,function*(){let{key:e,startingPeers:t,ourPeerId:n,query:o,alpha:i,path:s,numPaths:a,log:c,peersSeen:l,connectionManager:u,signal:d}=r,h=Zr({objectMode:!0}),p=new Ln({concurrency:i,sort:(E,S)=>Lp(E.options.distance,S.options.distance)});p.addEventListener("idle",()=>{h.push(iX({path:{index:s,queued:p.queued,running:p.running,total:p.size}},r)),h.end()}),p.addEventListener("error",E=>{c.error("error during query - %e",E.detail)});let m=()=>{p.abort(),h.end(new Nn)};d.addEventListener("abort",m);try{let S=function(A,M){if(A==null)return;l.add(A.id.toMultihash().bytes);let L=Da(M,E);p.add(()=>f(null,null,function*(){try{try{for(var F=O(o(I(v({},r),{key:e,peer:A,path:{index:s,queued:p.queued,running:p.running,total:p.size},numPaths:a,peerKadId:M,signal:d}))),Y,H,U;Y=!(H=yield F.next()).done;Y=!1){let P=H.value;if(P.name==="PEER_RESPONSE")for(let R of P.closer){if(l.has(R.id.toMultihash().bytes)){c("already seen %p in query",R.id);continue}if(n.equals(R.id)){c("not querying ourselves");continue}if(!(yield u.isDialable(R.multiaddrs))){c("not querying undialable peer");continue}let N=yield di(R.id,{signal:d}),j=Da(N,E);if(Lp(j,L)!==-1){c("skipping %p as they are not closer to %b than %p",R.id,e,A);continue}c("querying closer peer %p",R.id),S(R,N)}h.push(I(v({},P),{path:{index:s,queued:p.queued,running:p.running,total:p.size}}))}}catch{U=[H]}finally{try{Y&&(H=F.return)&&(yield H.call(F))}finally{if(U)throw U[0]}}}catch(P){h.push(ka({from:A.id,error:P,path:{index:s,queued:p.queued,running:p.running-1,total:p.size-1}},r))}}),{distance:L}).catch(F=>{c.error("error during query - %e",F)})};var w=S;let E=yield new C(rd(e,{signal:d}));yield new C(Promise.all(t.map(A=>f(null,null,function*(){S({id:A,multiaddrs:[]},yield di(A,{signal:d}))})))),yield*J(h)}finally{d.removeEventListener("abort",m)}})}var y8=class{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;allowQueryWithZeroPeers;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??o8,this.alpha=t.alpha??Ju,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.allowQueryWithZeroPeers=t.allowQueryWithZeroPeers??!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)})}stop(){return f(this,null,function*(){this.running=!1,this.shutDownController.abort()})}run(o,i){return k(this,arguments,function*(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){let m=AbortSignal.timeout(eX);n=I(v({},n),{signal:m})}let s=new AbortController,a=tt([this.shutDownController.signal,s.signal,n.signal]);s.signal;let c=this.logger.forComponent(`${this.logPrefix}:query:`+ne(e,"base58btc")),l=!1;try{this.routingTable.size===0&&!this.allowQueryWithZeroPeers&&(c("routing table was empty, waiting for some peers before running%s query",n.isSelfQuery===!0?" self":""),yield new C(mX(this.routingTable,"peer:add",{signal:a,filter:M=>!this.peerId.equals(M.detail)})),c("routing table has peers, continuing with%s query",n.isSelfQuery===!0?" self":"")),n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(c("waiting for initial self query before continuing"),yield new C(ut(this.initialQuerySelfHasRun.promise,a)),this.initialQuerySelfHasRun=void 0),c("query:start");let m=yield new C(rd(e,{signal:a})),w=this.routingTable.closestPeers(m,{count:this.routingTable.kBucketSize}),E=w.sort(()=>Math.random()>.5?1:-1).reduce((M,L,F)=>(M[F%this.disjointPaths].push(L),M),new Array(this.disjointPaths).fill(0).map(()=>[])).filter(M=>M.length>0);if(w.length===0){c.error("running query with no peers");return}let S=ho(1024),A=E.map((M,L)=>gX(I(v({},n),{key:e,startingPeers:M,ourPeerId:this.peerId,signal:a,query:t,path:L,numPaths:E.length,alpha:this.alpha,log:c,peersSeen:S,onProgress:n.onProgress,connectionManager:this.connectionManager})));try{for(var u=O(Lo(...A)),d,h,p;d=!(h=yield new C(u.next())).done;d=!1){let M=h.value;if(M.name==="QUERY_ERROR"&&c.error("query error",M.error),M.name==="PEER_RESPONSE")for(let L of[...M.closer,...M.providers])(yield new C(this.connectionManager.isDialable(L.multiaddrs,{signal:a})))&&(yield new C(this.routingTable.add(L.id,{signal:a})));a.throwIfAborted(),yield M}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new C(h.call(u)))}finally{if(p)throw p[0]}}l=!0}catch(m){if(this.running)throw m}finally{l||(c("query exited early"),s.abort()),a.clear(),c("query finished")}})}};function gve(r){return r[Symbol.asyncIterator]!=null}function yve(r){if(gve(r))return f(null,null,function*(){let e=0;try{for(var t=O(r),n,o,i;n=!(o=yield t.next()).done;n=!1){let s=o.value;e++}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}return e});{let e=0;for(let t of r)e++;return e}}var v8=yve;var w8=class{log;peerId;peerRouting;events;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.events=e.events,this.running=!1,this.peerRouting=t.peerRouting,this.count=t.count??o8,this.interval=t.interval??YY,this.initialInterval=t.initialInterval??XY,this.queryTimeout=t.queryTimeout??QY,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=d8(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}querySelf(){return f(this,null,function*(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Ye(),this.running){this.controller=new AbortController;let e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){let n=AbortSignal.timeout(this.queryTimeout);e.push(n)}let t=tt(e);this.controller.signal;try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let n=Date.now(),o=yield fr(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>Uu(s,this.count),s=>f(this,null,function*(){return v8(s)}));t?.throwIfAborted();let i=Date.now()-n;this.log("self-query found %d peers in %dms",o,i),this.events.dispatchEvent(new CustomEvent("kad-dht:query:self",{detail:{peers:o,duration:i}}))}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))})}};var b8=class extends st{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new Ln({concurrency:t.concurrency??qY,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Aa(I(v({},t.timeout??{}),{metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`})),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??zY,this.maxQueueSize=t.maxQueueSize??KY,this.validity=t.validity??$Y,this.interval=t.interval??GY,this.contentRouting=t.contentRouting,this.running=!1,this.reprovide=d8(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(vM)}).catch(e=>{this.log.error("error running reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}cleanUp(e){return f(this,null,function*(){try{this.safeDispatchEvent("reprovide:start");try{for(var t=O(this.datastore.query({prefix:this.datastorePrefix},e)),n,o,i;n=!(o=yield t.next()).done;n=!1){let s=o.value;try{let{cid:a,peerId:c}=c8(s.key),l=u8(s.value).getTime(),u=l+this.validity,d=Date.now(),h=d>u;this.log.trace("comparing: %d < %d = %s %s",l,d-this.validity,h,h?"(expired)":""),h&&(yield this.datastore.delete(s.key,e)),this.peerId.equals(c)&&d-u<this.reprovideThreshold&&this.queueReprovide(a).catch(p=>{this.log.error("could not reprovide %c - %e",a,p)})}catch(a){this.log.error("error processing datastore key %s - %e",s.key,a.message)}}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}this.log("reprovide/cleanup successful")}finally{this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(vM)}).catch(s=>{this.log.error("error running re-provide - %e",s)})},this.interval))}})}queueReprovide(e,t){return f(this,null,function*(){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),yield this.reprovideQueue.onSizeLessThan(this.maxQueueSize,t);let n=this.reprovideQueue.queue.find(o=>o.options.cid.equals(e));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",e),n.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(o=>f(this,null,function*(){if(o.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);let i=this.reprovideTimeout.getTimeoutSignal(o);try{yield this.reprovide(o.cid,o)}finally{this.reprovideTimeout.cleanUp(i)}this.log.trace("re-provided %c",e)}),{signal:this.shutdownController?.signal,cid:e}).catch(o=>{this.log.error("could not re-provide key %c - %e",e,o)})})}reprovide(e,t){return f(this,null,function*(){yield ei(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))})}};var vve=20,wve=5e3,bve="kad-close",xve=50,x8=class{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??wve,this.peerSetSize=t.peerSetSize??vve,this.closeTagName=t.closeTagName??bve,this.closeTagValue=t.closeTagValue??xve,this.closestPeers=new $i,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}start(){return f(this,null,function*(){if(this.running)return;this.running=!0;let e=yield di(this.components.peerId);this.newPeers=new od(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)})}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(t=>{this.log.error("error adding peer to distance list - %e",t)})}updatePeerTags(){return f(this,null,function*(){let e=new $i(this.newPeers?.peers.map(({peer:o})=>o.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,yield Promise.all([...[...t].map(o=>f(this,null,function*(){yield this.components.peerStore.merge(o,{tags:{[this.closeTagName]:{value:this.closeTagValue},[wM]:{value:1}}})})),...[...n].map(o=>f(this,null,function*(){yield this.components.peerStore.merge(o,{tags:{[this.closeTagName]:void 0,[wM]:void 0}})}))])})}};function _v(r){return Array.isArray(r?.peers)}var E8=class{peerId;root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e,t){this.peerId=e.peerId,this.prefixLength=t.prefixLength??yX,this.kBucketSize=t.kBucketSize??Sv,this.splitThreshold=t.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=t.numberOfOldContactsToPing??vX,this.lastPingThreshold=t.lastPingThreshold??wX,this.ping=t.ping,this.verify=t.verify,this.onAdd=t.onAdd,this.onRemove=t.onRemove,this.addingPeerMap=xl({name:`${t.metricsPrefix}_adding_peer_map`,metrics:e.metrics}),this.root={prefix:"",depth:0,peers:[]}}start(){return f(this,null,function*(){yield this.addSelfPeer(this.peerId)})}stop(){this.addingPeerMap.clear(),this.root={prefix:"",depth:0,peers:[]}}addSelfPeer(e,t){return f(this,null,function*(){this.localPeer={peerId:e,kadId:yield di(e,t),lastPing:Date.now()}})}add(e,t){return f(this,null,function*(){let n={peerId:e,kadId:yield di(e,t),lastPing:0},o=this.addingPeerMap.get(e);if(o!=null)return o;try{let i=this._add(n,t);this.addingPeerMap.set(e,i),yield i}finally{this.addingPeerMap.delete(e)}})}_add(e,t){return f(this,null,function*(){let n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){yield this._split(n,t),yield this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!_ve(e,this.lastPingThreshold)){n.peers.push(e),yield this.onAdd?.(e,n,t);return}(yield this.verify(e,t))&&(e.lastPing=Date.now(),yield this._add(e,t));return}let o=n.peers.filter(u=>!(u.peerId.equals(this.localPeer?.peerId)||u.lastPing>Date.now()-this.lastPingThreshold)).sort((u,d)=>u.lastPing<d.lastPing?-1:u.lastPing>d.lastPing?1:0).slice(0,this.numberOfNodesToPing),i=!1;try{for(var s=O(this.ping(o,t)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;i=!0,yield this.remove(u.kadId,t)}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}i&&(yield this._add(e,t))})}*closest(e,t){let n=new od(e,t?.count??this.kBucketSize);for(let o of this.toIterable())t?.exclude?.some(i=>i.equals(o.peerId))!==!0&&n.addWithKadId({id:o.peerId,multiaddrs:[]},o.kadId);yield*J(An(n.peers,({peer:o})=>o.id))}count(){function e(t){if(_v(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){let t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}remove(e,t){return f(this,null,function*(){let n=this._determineBucket(e),o=this._indexOf(n,e);if(o>-1){let i=n.peers.splice(o,1)[0];yield this.onRemove?.(i,n,t)}})}*toIterable(){function*e(t){if(_v(t)){yield*J(t.peers);return}yield*J(e(t.left)),yield*J(e(t.right))}yield*J(e(this.root))}distance(e,t){return BigInt("0x"+ne(Da(e,t),"base16"))}_determineBucket(e){let t=ne(e,"base2");function n(o,i=0){return _v(o)?o:t[i]==="0"?n(o.left,i+1):n(o.right,i+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Le(n.kadId,t))}_split(e,t){return f(this,null,function*(){let n={prefix:"0",depth:e.depth+1,peers:[]},o={prefix:"1",depth:e.depth+1,peers:[]};for(let i of e.peers)ne(i.kadId,"base2")[e.depth]==="0"?(n.peers.push(i),yield this.onMove?.(i,e,n,t)):(o.peers.push(i),yield this.onMove?.(i,e,o,t));Eve(e,n,o)})}};function Eve(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function _ve(r,e){return r.lastPing<Date.now()-e}var Sv=20,yX=6;var Sve=20,Cve=100,vX=3;var Ive=20,Ave=100,bX="kad-peer",Dve=1,wX=6e5,Tve=!0,Pve=1e3,_8=class extends st{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;shutdownController;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??Sv,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??bX,this.peerTagValue=t.peerTagValue??Dve,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??Tve,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??Pve,this.shutdownController=new AbortController,this.pingOldContactQueue=new Bn({concurrency:t.pingOldContactConcurrency??Ive,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??Ave}),this.pingOldContactTimeout=new Aa(I(v({},t.pingOldContactTimeout??{}),{metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`})),this.pingNewContactQueue=new Bn({concurrency:t.pingNewContactConcurrency??Sve,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??Cve}),this.pingNewContactTimeout=new Aa(I(v({},t.pingNewContactTimeout??{}),{metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`})),this.kb=new E8(e,{kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved,metricsPrefix:t.metricsPrefix}),this.closestPeerTagger=new x8(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.shutdownController=new AbortController,yield On(this.closestPeerTagger,this.kb))})}afterStart(){return f(this,null,function*(){let e=0;Promise.resolve().then(()=>f(this,null,function*(){if(!this.populateFromDatastoreOnStart)return;let t=tt([this.shutdownController.signal,AbortSignal.timeout(2e4)]);try{for(let n of yield this.components.peerStore.all({filters:[o=>o.protocols.includes(this.protocol)&&o.tags.has(bX)],limit:this.populateFromDatastoreLimit,signal:t})){if(!this.running)return;try{yield this.add(n.id,{signal:t}),e++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),yield this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}}finally{t.clear()}this.log("added %d peer store peers to the routing table",e)})).catch(t=>{this.log.error("error adding %d, peer store peers to the routing table - %e",e,t)})})}stop(){return f(this,null,function*(){this.running=!1,yield ao(this.closestPeerTagger,this.kb),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort(),this.shutdownController.abort()})}peerAdded(e,t,n){return f(this,null,function*(){this.components.peerId.equals(e.peerId)||(yield this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}},n)),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})})}peerRemoved(e,t,n){return f(this,null,function*(){this.components.peerId.equals(e.peerId)||(yield this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}},n)),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})})}pingOldContacts(e,t){return k(this,null,function*(){if(!this.running)return;let n=[];for(let c of e){if(this.kb.get(c.kadId)==null){this.log("asked to ping contact %p that was not in routing table",c.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),n.push(()=>f(this,null,function*(){let l=this.pingOldContactQueue.find(c.peerId);if(l!=null)return this.log("asked to ping contact %p was already being pinged",c.peerId),(yield l.join(t))?void 0:c;if(!(yield this.pingOldContactQueue.add(d=>f(this,null,function*(){let h=this.pingOldContactTimeout.getTimeoutSignal(),p=tt([h,this.shutdownController.signal,d?.signal]);try{return yield this.pingContact(c,d)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(h),p.clear()}}),{peerId:c.peerId,signal:t?.signal})))return c}))}try{for(var o=O($o(n)),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;c!=null&&(yield c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}verifyNewContact(e,t){return f(this,null,function*(){let n=this.pingNewContactTimeout.getTimeoutSignal(),o=tt([n,this.shutdownController.signal,t?.signal]);try{let i=this.pingNewContactQueue.find(e.peerId);return i!=null?(this.log("joining existing ping to add new peer %p to routing table",e.peerId),yield i.join({signal:o})):yield this.pingNewContactQueue.add(s=>f(this,null,function*(){return this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,s)}),{peerId:e.peerId,signal:o})}catch{return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(n),o.clear()}})}pingContact(e,t){return f(this,null,function*(){let n;try{return this.log("pinging contact %p",e.peerId),yield this.components.ping.ping(e.peerId,t),this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0}catch(o){return this.log("error pinging old contact %p - %e",e.peerId,o),n?.abort(o),!1}})}get size(){return this.kb==null?0:this.kb.count()}find(e,t){return f(this,null,function*(){let n=yield di(e,t);return this.kb.get(n)?.peerId})}closestPeer(e){let t=this.closestPeers(e,{count:1});if(t.length>0)return t[0]}closestPeers(e,t){return this.kb==null?[]:[...this.kb.closest(e,t)]}add(e,t){return f(this,null,function*(){if(this.kb==null)throw new Error("RoutingTable is not started");yield this.kb.add(e,t)})}remove(e,t){return f(this,null,function*(){if(this.kb==null)throw new Error("RoutingTable is not started");let n=yield di(e,t);yield this.kb.remove(n,t)})}updateMetrics(){if(this.metrics==null||this.kb==null)return;let e=0,t=0,n=0,o=20,i=0;function s(a){if(_v(a)){a.depth>n&&(n=a.depth),t++,e+=a.peers.length,a.peers.length<o&&(o=a.peers.length),a.peers.length>i&&(i=a.peers.length);return}s(a.left),s(a.right)}s(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(o),this.metrics.routingTableKadBucketMaxOccupancy.update(i),this.metrics.routingTableKadBucketMaxDepth.update(n)}};var xX=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];var S8=15,C8=class{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){let{peerRouting:n,routingTable:o,refreshInterval:i,refreshQueryTimeout:s,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=o,this.refreshInterval=i??ZY,this.refreshQueryTimeout=s??JY,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}afterStart(){return f(this,null,function*(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)})}stop(){return f(this,null,function*(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)})}refreshTable(e=!1,t){this.log("refreshing routing table");let n=this._maxCommonPrefix(),o=this._getTrackedCommonPrefixLengthsForRefresh(n);this.log(`max common prefix length ${n}`),this.log(`tracked CPLs [ ${o.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(o.map((i,s)=>f(this,null,function*(){try{if(yield this._refreshCommonPrefixLength(s,i,e,t),this._numPeersForCpl(n)===0){let a=Math.min(2*(s+1),o.length-1);for(let c=s+1;c<a+1;c++)try{yield this._refreshCommonPrefixLength(c,i,e,t)}catch(l){this.log.error(l)}}}catch(a){this.log.error(a)}}))).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}_refreshCommonPrefixLength(e,t,n,o){return f(this,null,function*(){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let i=this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);let s=tt([o?.signal,AbortSignal.timeout(this.refreshQueryTimeout)]);try{let a=yield v8(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${a} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{s.clear()}})}_getTrackedCommonPrefixLengthsForRefresh(e){e>S8&&(e=S8);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}_generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");let t=Vo(2),n=(t[1]<<8)+t[0],o=this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),i=Ft(o);return tn(i)}_makePeerId(e,t,n){if(n>S8)throw new Error(`Cannot generate peer ID for common prefix length greater than ${S8}`);let s=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=s&a|t&~a,l=xX[c],u=new ArrayBuffer(34),d=new DataView(u,0,u.byteLength);return d.setUint8(0,xt.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(let{kadId:e}of this.routingTable.kb.toIterable()){let t=Da(this.routingTable.kb.localPeer.kadId,e),n=0;for(let o of t)if(o===0)n++;else break;yield n}}};var I8=class{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}handle(e,t){return f(this,null,function*(){if(t.key==null||t.key.length===0)throw new bt("Missing key");let n;try{n=le.decode(t.key)}catch{throw new bt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),yield Promise.all(t.providers.map(o=>f(this,null,function*(){let i=Ft(o.id),s=tn(i),a=o.multiaddrs.map(c=>Ee(c));if(!e.equals(s)){this.log("invalid provider peer %p from %p",o.id,e);return}if(o.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),yield this.providers.addProvider(n,s),yield this.peerStore.merge(s,{multiaddrs:a})})))})}};var A8=class{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){let{peerRouting:n,logPrefix:o}=t;this.log=e.logger.forComponent(`${o}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}handle(e,t){return f(this,null,function*(){this.log("incoming request from %p for peers close to %b",e,t.key);try{if(t.key==null)throw new bt("Invalid FIND_NODE message received - key was missing");let n=yield this.peerRouting.getClosestPeersOffline(t.key,{exclude:[e,this.peerId]});Le(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(Cs("p2p").code))});let o={type:jt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(s=>s.bytes)})),providers:[]};return o.closer.length===0?this.log("could not find any peers closer to %b for %p",t.key,e):this.log("found %d peers close to %b for %p",o.closer.length,t.key,e),o}catch(n){throw this.log("error during finding peers closer to %b for %p - %e",t.key,e,n),n}})}};var D8=class{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){let{peerRouting:n,providers:o,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=o,this.peerInfoMapper=t.peerInfoMapper}handle(e,t){return f(this,null,function*(){if(t.key==null)throw new bt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=le.decode(t.key)}catch{throw new bt("Invalid CID")}this.log("%p asking for providers for %s",e,n);let[o,i]=yield Promise.all([Ea(An(yield this.providers.getProviders(n),a=>f(this,null,function*(){let c=yield this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}}))),this.peerRouting.getClosestPeersOffline(t.key)]),s={type:jt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:o.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",s.providers.length,s.closer.length),s})}_getAddresses(e){return f(this,null,function*(){return[]})}};var T8=class{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}handle(e,t){return f(this,null,function*(){let n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new bt("Invalid key");let o={type:jt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(dX(n)){this.log("is public key");let a=fX(n),c;try{let l=yield this.peerStore.get(a);if(l.id.publicKey==null)throw new Ot("No public key found in key book");c=Sn(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),o.record=new Kn(n,c,new Date).serialize(),o}let[i,s]=yield Promise.all([this._checkLocalDatastore(n),this.peerRouting.getClosestPeersOffline(n)]);return i!=null&&(this.log("had record for %b in local datastore",n),o.record=i.serialize()),s.length>0&&(this.log("had %s closer peers in routing table",s.length),o.closer=s.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),o})}_checkLocalDatastore(e){return f(this,null,function*(){this.log("checkLocalDatastore looking for %b",e);let t=nd(this.datastorePrefix,e),n;try{n=yield this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}let o=Kn.deserialize(n);if(o.timeReceived==null||Date.now()-o.timeReceived.getTime()>jY){yield this.datastore.delete(t);return}return o})}};var P8=class{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}handle(e,t){return f(this,null,function*(){return this.log("ping from %p",e),t})}};var M8=class{components;validators;log;datastorePrefix;constructor(e,t){let{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}handle(e,t){return f(this,null,function*(){let n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){let o=`Empty record from: ${e.toString()}`;throw this.log.error(o),new bt(o)}try{let o=Kn.deserialize(t.record);yield Qg(this.validators,o),o.timeReceived=new Date;let i=nd(this.datastorePrefix,o.key);yield this.components.datastore.put(i,o.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(o){this.log("did not put record for key %b into datastore %o",n,o)}return t})}};var k8=class{handlers;log;metrics;incomingMessageTimeout;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`),rpcTime:e.metrics?.registerMetricGroup(`${t.metricsPrefix}_inbound_rpc_time_seconds`,{label:"operation"})},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.incomingMessageTimeout=t.incomingMessageTimeout??1e4,this.handlers={[jt.GET_VALUE.toString()]:new T8(e,t),[jt.PUT_VALUE.toString()]:new M8(e,t),[jt.FIND_NODE.toString()]:new A8(e,t),[jt.ADD_PROVIDER.toString()]:new I8(e,t),[jt.GET_PROVIDERS.toString()]:new D8(e,t),[jt.PING.toString()]:new P8(e,t)}}handleMessage(e,t){return f(this,null,function*(){let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return this.metrics.operations?.increment({[t.type]:!0}),yield n.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}})}onIncomingStream(e){let t="unknown";Promise.resolve().then(()=>f(this,null,function*(){let{stream:n,connection:o}=e,i=()=>{n.abort(new oc)},s=AbortSignal.timeout(this.incomingMessageTimeout);s.addEventListener("abort",i);let a=or(n).pb(td);try{for(;;){let c=yield a.read({signal:s}),l=this.metrics?.rpcTime?.timer(c.type.toString()),u=this.metrics?.rpcTime?.timer(c.type.toString()),d=!1;try{this.log("incoming %s from %p",c.type,o.remotePeer);let h=yield this.handleMessage(o.remotePeer,c);h!=null&&(yield a.write(h,{signal:s}))}catch(h){throw d=!0,u?.(),h}finally{d||l?.()}s.removeEventListener("abort",i),s=AbortSignal.timeout(this.incomingMessageTimeout),s.addEventListener("abort",i)}}catch(c){n.abort(c)}})).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};var R8=class extends st{log;components;protocol;running;registrarId;constructor(e,t){super();let{protocol:n,logPrefix:o}=t;this.components=e,this.log=e.logger.forComponent(`${o}:topology-listener`),this.running=!1,this.protocol=n}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.registrarId=yield this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))})}stop(){return f(this,null,function*(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)})}};var CM=class{dht;constructor(e){this.dht=e}provide(n){return f(this,arguments,function*(e,t={}){yield ei(this.dht.provide(e,t))})}cancelReprovide(e){return f(this,null,function*(){yield this.dht.cancelReprovide(e)})}findProviders(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.findProviders(e,t)),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;c.name==="PROVIDER"&&(yield*J(c.providers))}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}put(e,t,n){return f(this,null,function*(){yield ei(this.dht.put(e,t,n))})}get(e,t){return f(this,null,function*(){try{for(var n=O(this.dht.get(e,t)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(a.name==="VALUE")return a.value}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}throw new Ot("Could not find value for key")})}},IM=class{dht;constructor(e){this.dht=e}findPeer(n){return f(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.findPeer(e,t)),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;if(c.name==="FINAL_PEER")return c.peer}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}throw new Ot("Peer not found")})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.getClosestPeers(e,t)),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;c.name==="FINAL_PEER"&&(yield c.peer)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}},Mve=32,kve=64,N8=class extends st{k;a;d;protocol;routingTable;providers;network;peerRouting;components;log;running;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;onPeerConnectTimeout;constructor(e,t={}){super();let n=t.logPrefix??"libp2p:kad-dht",o=t.datastorePrefix??"/dht",i=t.metricsPrefix??"libp2p_kad_dht",s={queries:e.metrics?.registerMetricGroup(`${i}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${i}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${i}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${i}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(n),this.k=t.kBucketSize??Sv,this.a=t.alpha??Ju,this.d=t.disjointPaths??this.a,this.protocol=t.protocol??HY,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??Mve,this.maxOutboundStreams=t.maxOutboundStreams??kve,this.peerInfoMapper=t.peerInfoMapper??lX,this.onPeerConnectTimeout=t.onPeerConnectTimeout??WY,this.providers=new g8(e,I(v({},t.providers),{logPrefix:n,datastorePrefix:o})),this.validators=v(v({},cX),t.validators),this.selectors=v(v({},aX),t.selectors),this.network=new h8(e,{protocol:this.protocol,logPrefix:n,metricsPrefix:i}),this.routingTable=new _8(e,{kBucketSize:this.k,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:n,metricsPrefix:i,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});let a=Ye();t.allowQueryWithZeroPeers===!0&&a.resolve(),this.queryManager=new y8(e,{disjointPaths:this.d,alpha:this.a,logPrefix:n,metricsPrefix:i,initialQuerySelfHasRun:a,routingTable:this.routingTable,allowQueryWithZeroPeers:t.allowQueryWithZeroPeers}),this.peerRouting=new m8(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:n}),this.contentFetching=new f8(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:n,datastorePrefix:o}),this.contentRouting=new p8(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:n}),this.routingTableRefresh=new C8(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:n}),this.rpc=new k8(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:n,metricsPrefix:i,datastorePrefix:o,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new R8(e,{protocol:this.protocol,logPrefix:n}),this.querySelf=new w8(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:n,initialQuerySelfHasRun:a,operationMetrics:s}),this.reprovider=new b8(e,I(v({},t.reprovide),{logPrefix:n,metricsPrefix:i,datastorePrefix:o,contentRouting:this.contentRouting,operationMetrics:s})),this.network.addEventListener("peer",c=>{let l=c.detail;this.onPeerConnect(l).catch(u=>{this.log.error("could not add %p to routing table",l.id,u)}),this.dispatchEvent(new CustomEvent("peer",{detail:l}))}),this.topologyListener.addEventListener("peer",c=>{let l=c.detail;Promise.resolve().then(()=>f(this,null,function*(){let u=yield this.components.peerStore.get(l),d={id:l,multiaddrs:u.addresses.map(({multiaddr:h})=>h),protocols:u.protocols};yield this.onPeerConnect(d)})).catch(u=>{this.log.error("could not add %p to routing table - %e - %e",l,u)})}),this.dhtPeerRouting=new IM(this),this.dhtContentRouting=new CM(this),t.clientMode==null&&e.events.addEventListener("self:peer:update",c=>{this.log("received update of self-peer info"),Promise.resolve().then(()=>f(this,null,function*(){let l=c.detail.peer.addresses.some(({multiaddr:d})=>pX(d)),u=this.getMode();l&&u==="client"?yield this.setMode("server"):u==="server"&&!l&&(yield this.setMode("client"))})).catch(l=>{this.log.error("error setting dht server mode",l)})}),this.get=Op(this.get.bind(this),s,"GET_VALUE"),this.findProviders=Op(this.findProviders.bind(this),s,"FIND_PROVIDERS"),this.findPeer=Op(this.findPeer.bind(this),s,"FIND_PEER"),this.getClosestPeers=Op(this.getClosestPeers.bind(this),s,"GET_CLOSEST_PEERS"),this.provide=Op(this.provide.bind(this),s,"PROVIDE"),this.put=Op(this.put.bind(this),s,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[Pt]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery","@libp2p/kad-dht"];[Ri]=["@libp2p/identify","@libp2p/ping"];get[rc](){return this.dhtContentRouting}get[nc](){return this.dhtPeerRouting}get[gf](){return this}onPeerConnect(e){return f(this,null,function*(){if(this.log.trace("peer %p connected",e.id),e=this.peerInfoMapper(e),e.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(n=>n.toString()));return}let t=AbortSignal.timeout(this.onPeerConnectTimeout);try{yield this.routingTable.add(e.id,{signal:t})}catch(n){this.log.error("could not add %p to routing table",e.id,n)}})}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}setMode(e,t){return f(this,null,function*(){if(e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}if(yield this.components.registrar.unhandle(this.protocol,t),e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}e==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,yield this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{signal:t?.signal,maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))})}start(){return f(this,null,function*(){this.running||(this.running=!0,yield this.setMode(this.clientMode?"client":"server",{force:!0}),yield On(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),yield On(this.querySelf))})}stop(){return f(this,null,function*(){this.running=!1,yield ao(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)})}put(o,i){return k(this,arguments,function*(e,t,n={}){yield*J(this.contentFetching.put(e,t,n))})}get(n){return k(this,arguments,function*(e,t={}){yield*J(this.contentFetching.get(e,t))})}provide(n){return k(this,arguments,function*(e,t={}){yield*J(this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t))})}cancelReprovide(e,t){return f(this,null,function*(){yield this.providers.removeProvider(e,this.components.peerId,t)})}findProviders(n){return k(this,arguments,function*(e,t={}){yield*J(this.contentRouting.findProviders(e,t))})}findPeer(n){return k(this,arguments,function*(e,t={}){yield*J(this.peerRouting.findPeer(e,t))})}getClosestPeers(n){return k(this,arguments,function*(e,t={}){yield*J(this.peerRouting.getClosestPeers(e,t))})}refreshRoutingTable(e){return f(this,null,function*(){this.routingTableRefresh.refreshTable(!0,e)})}};function EX(r={}){return e=>new N8(e,r)}var Dt=function(r){return r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR",r}(Dt||{}),Cv=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),AM=Object.freeze({NEW_STREAM:Dt.NEW_STREAM,MESSAGE:Dt.MESSAGE_INITIATOR,CLOSE:Dt.CLOSE_INITIATOR,RESET:Dt.RESET_INITIATOR}),_X=Object.freeze({MESSAGE:Dt.MESSAGE_RECEIVER,CLOSE:Dt.CLOSE_RECEIVER,RESET:Dt.RESET_RECEIVER});var DM=1<<20,Rve=4<<20,O8=class{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=DM,t=Rve){this._buffer=new Ke,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new bt("Unprocessed message queue size too large!");let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}let{id:n,type:o,length:i,offset:s}=this._headerInfo;if(this._buffer.length-s<i)break;let c={id:n,type:o};(o===Dt.NEW_STREAM||o===Dt.MESSAGE_INITIATOR||o===Dt.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(s,s+i)),t.push(c),this._buffer.consume(s+i),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=CX(e),{value:o,offset:i}=CX(e,n),s=t&7;if(Cv[s]==null)throw new Error(`Invalid type received: ${s}`);if(o>this._maxMessageSize)throw new bt("Message size too large");return{id:t>>3,type:s,offset:n+i,length:o}}},Nve=128,SX=127;function CX(r,e=0){let t=0,n=0,o=e,i,s=r.length;do{if(o>=s||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(o++),t+=n<28?(i&SX)<<n:(i&SX)*Math.pow(2,n),n+=7}while(i>=Nve);return e=o-e,{value:t,offset:e}}var TM=10*1024,PM=class{_pool;_poolOffset;constructor(){this._pool=br(TM),this._poolOffset=0}write(e,t){let n=this._pool,o=this._poolOffset;In(e.id<<3|e.type,n,o),o+=It(e.id<<3|e.type),(e.type===Dt.NEW_STREAM||e.type===Dt.MESSAGE_INITIATOR||e.type===Dt.MESSAGE_RECEIVER)&&e.data!=null?(In(e.data.length,n,o),o+=It(e.data.length)):(In(0,n,o),o+=It(0));let i=n.subarray(this._poolOffset,o);TM-o<100?(this._pool=br(TM),this._poolOffset=0):this._poolOffset=o,t.append(i),(e.type===Dt.NEW_STREAM||e.type===Dt.MESSAGE_INITIATOR||e.type===Dt.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},Ove=new PM;function IX(r){return k(this,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield new C(e.next())).done;t=!1){let i=n.value;let s=new Ke;Ove.write(i,s),yield s}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield new C(n.call(e)))}finally{if(o)throw o[0]}}})}var L8=class extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}};var MM=class extends Yu{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types=e.direction==="outbound"?AM:_X,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}sendNewStream(){return f(this,null,function*(){yield this.send({id:this.streamId,type:AM.NEW_STREAM,data:new Ke(ee(this.name))})})}sendData(e){return f(this,null,function*(){for(e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxDataSize);yield this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}})}sendReset(){return f(this,null,function*(){yield this.send({id:this.streamId,type:this.types.RESET})})}sendCloseWrite(){return f(this,null,function*(){yield this.send({id:this.streamId,type:this.types.CLOSE})})}sendCloseRead(){return f(this,null,function*(){})}};function AX(r){let{id:e,name:t,send:n,onEnd:o,type:i="initiator",maxMsgSize:s=DM}=r;return new MM({id:i==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:i==="initiator"?"outbound":"inbound",maxDataSize:s,onEnd:o,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${i}:${e}`)})}var Lve=1024,Fve=1024,Bve=1024*1024*4,Uve=5,Vve=500;function DX(r){let e=I(v({},r),{type:`${Cv[r.type]} (${r.type})`});return r.type===Dt.NEW_STREAM&&(e.data=ne(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===Dt.MESSAGE_INITIATOR||r.type===Dt.MESSAGE_RECEIVER)&&(e.data=ne(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var F8=class{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(e,t){t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??Vve,this.sink=this._createSink(),this._source=Zr({objectMode:!0,onEnd:()=>{for(let n of this._streams.initiators.values())n.destroy();for(let n of this._streams.receivers.values())n.destroy()}}),this.source=fr(this._source,n=>IX(n)),this.closeController=new AbortController,this.rateLimiter=new jg({points:t.disconnectThreshold??Uve,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Su("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){return f(this,null,function*(){if(this.closeController.signal.aborted)return;let t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{yield Promise.all(this.streams.map(n=>f(this,null,function*(){return n.close({signal:t})}))),this._source.end(),yield this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}})}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){let{id:t,name:n}=e,o=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:o})}_newStream(e){let{id:t,name:n,type:o,registry:i}=e;if(this.log("new %s stream %s",o,t),o==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??Fve))throw new Mm("Too many outbound streams open");if(i.has(t))throw new Error(`${o} stream ${t} already exists!`);let c=AX({id:t,name:n,send:l=>f(this,null,function*(){this.log.enabled&&this.log.trace("%s stream %s send",o,t,DX(l)),this._source.push(l)}),type:o,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",o,t,c.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return i.set(t,c),c}_createSink(){return t=>f(this,null,function*(){let n=()=>{O5(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{let c=new O8(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);try{for(var o=O(t),i,s,a;i=!(s=yield o.next()).done;i=!1){let l=s.value;for(let u of c.write(l))yield this._handleIncoming(u)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}this._source.end()}catch(c){this.log("error in sink",c),this._source.end(c)}finally{this.closeController.signal.removeEventListener("abort",n)}})}_handleIncoming(e){return f(this,null,function*(){let{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",DX(e)),e.type===Dt.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??Lve)){this.log("too many inbound streams open"),this._source.push({id:t,type:Dt.RESET_RECEIVER});try{yield this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:ne(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){this.log("missing stream %s for message type %s",t,Cv[n]);try{yield this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}let s=this._init.maxStreamBufferSize??Bve;try{switch(n){case Dt.MESSAGE_INITIATOR:case Dt.MESSAGE_RECEIVER:if(i.sourceReadableLength()>s)throw this._source.push({id:e.id,type:n===Dt.MESSAGE_INITIATOR?Dt.RESET_RECEIVER:Dt.RESET_INITIATOR}),new L8("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");i.sourcePush(e.data);break;case Dt.CLOSE_INITIATOR:case Dt.CLOSE_RECEIVER:i.remoteCloseWrite();break;case Dt.RESET_INITIATOR:case Dt.RESET_RECEIVER:i.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),i.abort(a)}})}};var kM=class{protocol="/mplex/6.7.0";_init;components;constructor(e,t={}){this.components=e,this._init=t}[Symbol.toStringTag]="@libp2p/mplex";[Pt]=["@libp2p/stream-multiplexing"];createStreamMuxer(e={}){return new F8(this.components,v(v({},e),this._init))}};function TX(r={}){return e=>new kM(e,r)}var PX="1.0.0",MX="ping",kX="ipfs";var B8=class{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;log;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??kX}/${MX}/${PX}`,this.timeout=t.timeout??1e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??1,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[Pt]=["@libp2p/ping"];start(){return f(this,null,function*(){yield this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(this.protocol),this.started=!1})}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);let{stream:t}=e,n=Date.now(),o=Ap(t),i=!1;Promise.resolve().then(()=>f(this,null,function*(){for(;;){let s=AbortSignal.timeout(this.timeout);s.addEventListener("abort",()=>{t?.abort(new oc("ping timeout"))});let a=yield o.read({bytes:32,signal:s});yield o.write(a,{signal:s}),i=!0}})).catch(s=>{i&&s.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,s),t?.abort(s))}).finally(()=>{let s=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,s);let a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t?.abort(c)})})}ping(n){return f(this,arguments,function*(e,t={}){this.log("pinging %p",e);let o=Date.now(),i=Vo(32),s=yield this.components.connectionManager.openConnection(e,t),a;if(t.signal==null){let c=AbortSignal.timeout(this.timeout);t=I(v({},t),{signal:c})}try{a=yield s.newStream(this.protocol,I(v({},t),{runOnLimitedConnection:this.runOnLimitedConnection}));let c=Ap(a),[,l]=yield Promise.all([c.write(i,t),c.read(I(v({},t),{bytes:32}))]),u=Date.now()-o;if(!Le(i,l.subarray()))throw new KV(`Received wrong ping ack after ${u}ms`);return this.log("ping %p complete in %dms",s.remotePeer,u),u}catch(c){throw this.log.error("error while pinging %p",s.remotePeer,c),a?.abort(c),c}finally{a!=null&&(yield a.close(t))}})}};function RX(r={}){return e=>new B8(e,r)}var bo;(function(r){let e;(function(o){o.FIN="FIN",o.STOP_SENDING="STOP_SENDING",o.RESET="RESET",o.FIN_ACK="FIN_ACK"})(e=r.Flag||(r.Flag={}));let t;(function(o){o[o.FIN=0]="FIN",o[o.STOP_SENDING=1]="STOP_SENDING",o[o.RESET=2]="RESET",o[o.FIN_ACK=3]="FIN_ACK"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.flag!=null&&(i.uint32(8),r.Flag.codec().encode(o.flag,i)),o.message!=null&&(i.uint32(18),i.bytes(o.message)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.flag=r.Flag.codec().decode(o);break}case 2:{a.message=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(bo||(bo={}));var NX=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],NM=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),OX="libp2p+webrtc+v1/";var LX=466,FX=2*1024*1024,BX=30*1e3,Zg=16*1024;function zve(r=Zg){let e=It(r-It(r)),t=1+It(Object.keys(bo.Flag).length-1),n=1,o=r-e-t-n,i=It(o);return e+t+n+i}var UX=zve(),VX=5e3,jX=5e3,HX=3e4,OM="/webrtc",Iv="/webrtc-signaling/0.0.1",$X="/libp2p/webrtc-direct/certificate",zX="webrtc-direct-certificate-private-key";var qX=12096e5,LM=864e5;var KX=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},qve=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}();var Kve=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}();var Gve=function(){function r(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"}return r}();var Wve=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var Yve=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var Xve=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Qve=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,GX=3,Zve=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Xve]],WX=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function XX(r){return r?YX(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Yve:typeof navigator<"u"?YX(navigator.userAgent):twe()}function Jve(r){return r!==""&&Zve.reduce(function(e,t){var n=t[0],o=t[1];if(e)return e;var i=o.exec(r);return!!i&&[n,i]},!1)}function YX(r){var e=Jve(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new Wve;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<GX&&(o=KX(KX([],o,!0),rwe(GX-o.length),!0)):o=[];var i=o.join("."),s=ewe(r),a=Qve.exec(r);return a&&a[1]?new Gve(t,i,s,a[1]):new qve(t,i,s)}function ewe(r){for(var e=0,t=WX.length;e<t;e++){var n=WX[e],o=n[0],i=n[1],s=i.exec(r);if(s)return o}return null}function twe(){var r=typeof process<"u"&&process.version;return r?new Kve(process.version.slice(1)):null}function rwe(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var QX=XX(),Av=QX!=null&&QX.name==="firefox",U8=function(){return k(this,null,function*(){})},V8=r=>f(null,null,function*(){});function ZX(r,e,t=HX,n){r.readyState==="open"&&Promise.resolve().then(()=>f(null,null,function*(){if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);let o=Ye(),i=!1;r.bufferedAmountLowThreshold=0;let s=()=>{i||(n.log("%s drain channel closed before drain",e),o.resolve())};r.addEventListener("close",s,{once:!0}),r.addEventListener("bufferedamountlow",()=>{i=!0,r.removeEventListener("close",s),o.resolve()}),yield al(o.promise,{milliseconds:t})}})).then(()=>f(null,null,function*(){r.readyState==="open"&&r.close()})).catch(o=>{n.log.error("error closing outbound stream",o)})}function FM(r){return f(this,null,function*(){return r=r??{},typeof r=="function"&&(r=yield r()),r.iceServers=r.iceServers??NX.map(e=>({urls:[e]})),r})}var JX=(r=32)=>OX+[...Array(r)].map(()=>NM.at(Math.floor(Math.random()*NM.length))).join("");var Fp=class{log;peerConnection;remoteAddr;timeline;metrics;source=U8();sink=V8;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let n=this.peerConnection,o=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",o),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}close(e){return f(this,null,function*(){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}};var BM=class extends Yu{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=o=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(()=>f(this,null,function*(){if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{yield al(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(i){this.log.error("error receiving FIN_ACK",i)}})).then(()=>{this.incomingData.end(),t?.(o)}).catch(i=>{this.log.error("error ending stream",i)}).finally(()=>{this.channel.close()})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=Zr(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??BX,this.maxBufferedAmount=e.maxBufferedAmount??FX,this.maxMessageSize=(e.maxMessageSize??Zg)-UX,this.receiveFinAck=Ye(),this.finAckTimeout=e.closeTimeout??VX,this.openTimeout=e.openTimeout??jX,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Cy("Unknown datachannel state")}this.channel.onopen=o=>{this.timeline.open=new Date().getTime()},this.channel.onclose=o=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(i=>{this.log.error("error closing stream after channel closed",i)})},this.channel.onerror=o=>{this.log.trace("received onerror event"),this.closeController.abort();let i=o.error;this.abort(i)},this.channel.onmessage=o=>f(this,null,function*(){let{data:i}=o;i===null||i.byteLength===0||this.incomingData.push(new Uint8Array(i,0,i.byteLength))});let n=this;Promise.resolve().then(()=>f(this,null,function*(){try{for(var o=O(bl(this.incomingData)),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;let l=n.processIncomingProtobuf(c);l!=null&&n.sourcePush(new Ke(l))}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}})).catch(o=>{this.log.error("error processing incoming data channel messages",o)})}sendNewStream(){}_sendMessage(e,t=!0){return f(this,null,function*(){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new Cy(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){let n=AbortSignal.timeout(this.openTimeout),o=tt([this.closeController.signal,n]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),yield Mr(this.channel,"open",o)}finally{o.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let n=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),o=tt([this.closeController.signal,n]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),yield Mr(this.channel,"bufferedamountlow",o)}catch(i){throw n.aborted?new oc(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):i}finally{o.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(e.subarray())}catch(n){this.log.error("error while sending message",n)}})}sendData(e){return f(this,null,function*(){let t=e.byteLength;for(e=e.sublist();e.byteLength>0;){let n=Math.min(e.byteLength,this.maxMessageSize),o=e.subarray(0,n),i=bo.encode({message:o}),s=wl.single(i);this.log.trace("sending %d/%d bytes on channel",o.byteLength,t),yield this._sendMessage(s),e.consume(n)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)})}sendReset(){return f(this,null,function*(){try{yield this._sendFlag(bo.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}finally{this.channel.close()}})}sendCloseWrite(e){return f(this,null,function*(){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(yield this._sendFlag(bo.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{yield ut(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(n){this.log.error("failed to await FIN_ACK",n)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()})}sendCloseRead(){return f(this,null,function*(){this.channel.readyState==="open"&&(yield this._sendFlag(bo.Flag.STOP_SENDING))})}processIncomingProtobuf(e){let t=bo.decode(e);if(t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===bo.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(bo.Flag.FIN_ACK).catch(n=>{this.log.error("error sending FIN_ACK immediately",n)})),t.flag===bo.Flag.RESET&&this.reset(),t.flag===bo.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===bo.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return t.message}_sendFlag(e){return f(this,null,function*(){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());let t=bo.encode({flag:e}),n=wl.single(t);try{return yield this._sendMessage(n,!1),!0}catch(o){this.log.error("could not send flag %s - %e",e.toString(),o)}return!1})}};function Jg(r){let{channel:e,direction:t,handshake:n}=r;return new BM(v({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`)},r))}var id=class{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??OM,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}let o={},i=Jg(v({channel:n,direction:"inbound",onEnd:s=>{o.onEnd(s)},logger:e.logger},this.dataChannelOptions));o.stream=i,o.channel=n,o.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(s=>s.stream.id!==i.id)},this.bufferedStreams.push(o)}}createStreamMuxer(e){return new UM(this.components,I(v({},e),{peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol}))}},UM=class{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??OM,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}let o=n.id,i=Jg(v({channel:n,direction:"inbound",onEnd:()=>{this.#e(i,n),this.log("incoming channel %s ended",o)},logger:this.logger},this.dataChannelOptions));this.streams.push(i),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(i)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),this.#e(n.stream,n.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(n.stream)})})}#e(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),ZX(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(n=>n.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}close(e){return f(this,null,function*(){try{yield Promise.all(this.streams.map(t=>f(this,null,function*(){return t.close(e)})))}catch(t){this.abort(t)}})}abort(e){for(let t of this.streams)t.abort(e)}source=U8();sink=V8;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let n=Jg(v({channel:e,direction:"outbound",onEnd:()=>{this.#e(n,e),this.log("outgoing channel %s ended",t)},logger:this.logger},this.dataChannelOptions));return this.streams.push(n),this.metrics?.increment({outgoing_stream:!0}),n}};var j8=globalThis.RTCPeerConnection,H8=globalThis.RTCSessionDescription,eQ=globalThis.RTCIceCandidate;var sd=class extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}},ks=class extends sd{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}};var $8=class extends sd{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}};var z8=class extends sd{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}},q8=class extends sd{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}};var fi;(function(r){let e;(function(o){o.SDP_OFFER="SDP_OFFER",o.SDP_ANSWER="SDP_ANSWER",o.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.SDP_OFFER=0]="SDP_OFFER",o[o.SDP_ANSWER=1]="SDP_ANSWER",o[o.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.data!=null&&(i.uint32(18),i.string(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.data=o.string();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>ze(o,r.codec()),r.decode=(o,i)=>$e(o,r.codec(),i)})(fi||(fi={}));var K8=(r,e,t)=>f(null,null,function*(){try{let n=Ye();for(nwe(r,n);;){let o=yield Promise.race([n.promise,e.read({signal:t.signal}).catch(()=>{})]);if(o==null){t.signal?.throwIfAborted();break}if(o.type!==fi.Type.ICE_CANDIDATE)throw new bt("ICE candidate message expected");let i=JSON.parse(o.data??"null");if(i===""||i===null){t.onProgress?.(new pe("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}let s=new eQ(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new pe("webrtc:add-ice-candidate",s.candidate)),yield r.addIceCandidate(s)}catch(a){t.log.error("%s bad candidate received",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate",t.direction,n),t.signal?.aborted===!0&&G8(r)!=="connected")throw n}});function G8(r){return Av?r.iceConnectionState:r.connectionState}function nwe(r,e){r[Av?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(G8(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new q4("RTCPeerConnection was closed"));break;default:break}}}function tQ(u){return f(this,arguments,function*({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:o,connectionManager:i,transportManager:s,log:a,logger:c,onProgress:l}){let{baseAddr:d}=rQ(o);n?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);let h=d.getPeerId();if(h==null)throw new Q("Relay peer was missing");let p=i.getConnections(lr(h)),m,w=!1;p.length===0?(l?.(new pe("webrtc:dial-relay")),m=yield s.dial(d,{signal:t,onProgress:l}),w=!0):(l?.(new pe("webrtc:reuse-relay-connection")),m=p[0]);try{l?.(new pe("webrtc:open-signaling-stream"));let E=yield m.newStream(Iv,{signal:t,runOnLimitedConnection:!0}),S=or(E).pb(fi),A=new j8(r),M=new id({logger:c},{peerConnection:A,dataChannelOptions:e});try{let L=A.createDataChannel("init");A.onicecandidate=({candidate:U})=>{let P=JSON.stringify(U?.toJSON()??null);a.trace("initiator sending ICE candidate %o",U),S.write({type:fi.Type.ICE_CANDIDATE,data:P},{signal:t}).catch(R=>{a.error("error sending ICE candidate",R)})},A.onicecandidateerror=U=>{a.error("initiator ICE candidate error",U)};let F=yield A.createOffer().catch(U=>{throw a.error("could not execute createOffer",U),new ks("Failed to set createOffer")});a.trace("initiator send SDP offer %s",F.sdp),l?.(new pe("webrtc:send-sdp-offer")),yield S.write({type:fi.Type.SDP_OFFER,data:F.sdp},{signal:t}),yield A.setLocalDescription(F).catch(U=>{throw a.error("could not execute setLocalDescription",U),new ks("Failed to set localDescription")}),l?.(new pe("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let Y=yield S.read({signal:t});if(Y.type!==fi.Type.SDP_ANSWER)throw new ks("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",Y.data);let H=new H8({type:"answer",sdp:Y.data});return yield A.setRemoteDescription(H).catch(U=>{throw a.error("could not execute setRemoteDescription",U),new ks("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l?.(new pe("webrtc:read-ice-candidates")),yield K8(A,S,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),L.close(),l?.(new pe("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),yield E.close({signal:t}),a.trace("initiator connected to remote address %s",o),{remoteAddress:o,peerConnection:A,muxerFactory:M}}catch(L){throw a.error("outgoing signaling error",L),A.close(),E.abort(L),L}finally{A.onicecandidate=null,A.onicecandidateerror=null}}finally{if(w)try{yield m.close({signal:t})}catch(E){m.abort(E)}}})}var nQ=$t(JE.matchers[0],dt("p2p-circuit")),W8=class r extends st{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}listen(){return f(this,null,function*(){this.events.addEventListener("transport:listening",this.onTransportListening)})}onTransportListening(e){e.detail.getAddrs().filter(n=>nQ.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof r)).map(e=>e.getAddrs().filter(t=>nQ.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}close(){return f(this,null,function*(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})})}};function oQ(i){return f(this,arguments,function*({peerConnection:r,stream:e,signal:t,connection:n,log:o}){o.trace("new inbound signaling stream");let s=or(e).pb(fi);try{r.onicecandidate=({candidate:d})=>{let h=JSON.stringify(d?.toJSON()??null);o.trace("recipient sending ICE candidate %s",h),s.write({type:fi.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{o.error("error sending ICE candidate",p)})},o.trace("recipient read SDP offer");let c=yield s.read({signal:t});if(c.type!==fi.Type.SDP_OFFER)throw new ks(`expected message type SDP_OFFER, received: ${c.type??"undefined"} `);o.trace("recipient received SDP offer %s",c.data);let l=new H8({type:"offer",sdp:c.data});yield r.setRemoteDescription(l).catch(d=>{throw o.error("could not execute setRemoteDescription",d),new ks("Failed to set remoteDescription")});let u=yield r.createAnswer().catch(d=>{throw o.error("could not execute createAnswer",d),new ks("Failed to create answer")});o.trace("recipient send SDP answer %s",u.sdp),yield s.write({type:fi.Type.SDP_ANSWER,data:u.sdp},{signal:t}),yield r.setLocalDescription(u).catch(d=>{throw o.error("could not execute setLocalDescription",d),new ks("Failed to set localDescription")}),o.trace("recipient read candidates until connected"),yield K8(r,s,{direction:"recipient",signal:t,log:o})}catch(c){if(G8(r)!=="connected")throw o.error("error while handling signaling stream from peer %a",n.remoteAddr,c),r.close(),c;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,c)}let a=Ee(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return o.trace("recipient connected to remote address %s",a),{remoteAddress:a}})}var Y8=class{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[_u]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[Pt]=["@libp2p/transport"];[Ri]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}start(){return f(this,null,function*(){yield this.components.registrar.handle(Iv,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(Iv),this._started=!1})}createListener(e){return new W8(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(L2.exactMatch)}dialFilter(e){return this.listenFilter(e)}dial(e,t){return f(this,null,function*(){this.log.trace("dialing address: %a",e);let{remoteAddress:n,peerConnection:o,muxerFactory:i}=yield tQ({rtcConfiguration:yield FM(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new Fp(this.components,{peerConnection:o,timeline:{open:Date.now()},remoteAddr:n,metrics:this.metrics?.dialerEvents}),a=yield t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(o,s),a})}_onProtocol(o,i){return f(this,arguments,function*({connection:e,stream:t},n){let s=new j8(yield FM(this.init.rtcConfiguration)),a=new id(this.components,{peerConnection:s,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:c}=yield oQ({peerConnection:s,connection:e,stream:t,signal:n,log:this.log});yield t.close({signal:n});let l=new Fp(this.components,{peerConnection:s,timeline:{open:new Date().getTime()},remoteAddr:c,metrics:this.metrics?.listenerEvents});yield this.components.upgrader.upgradeInbound(l,{skipEncryption:!0,skipProtection:!0,muxerFactory:a,signal:n}),this._closeOnShutdown(s,l)}catch(c){throw this.log.error("incoming signaling error",c),s.close(),t.abort(c),c}})}_closeOnShutdown(e,t){let n=()=>{t.close().catch(o=>{this.log.error("could not close WebRTCMultiaddrConnection",o)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}};function rQ(r){let e=r.toString().split("/webrtc/");if(e.length!==2)throw new Q("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Q("p2p-circuit protocol was not present in multiaddr");let t=Ee(e[0]),o=Ee("/"+e[1]).getPeerId();if(o==null)throw new Q("destination peer id was missing");let i=t.protos().pop();if(i===void 0)throw new Q("invalid multiaddr");return i.name!=="p2p"&&(t=t.encapsulate(`/p2p/${o}`)),{baseAddr:t,peerId:lr(o)}}var hTt=_r(sQ());var q=function(r){return r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice",r}(q||{}),T=function(r){return r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null",r}(T||{});var VM=_r(Dl()),bc=class{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(VM.BufferSourceConverter.isBufferSource(e))this.unusedBits=t,this.value=VM.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Sa))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Sa({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Sa({name:e})}toNumber(){let e="",t=new Uint8Array(this.value);for(let n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;let o=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};var jM=_r(Dl()),Ge=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):jM.BufferSourceConverter.isBufferSource(e)?this.buffer=jM.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof yo))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new yo({valueHex:this.buffer})}toSchema(e){return new yo({name:e})}};var owe={fromASN:r=>r instanceof ai?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new ai;let e=Gi(r);if(e.result.error)throw new Error(e.result.error);return e.result}},iwe={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new qi({value:+r})},swe={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new cp({value:r})},yt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new qi({valueHex:r})};var awe={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Sa({valueHex:r})},cwe={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Ki({value:r})},lwe={fromASN:r=>r.valueBlock.value,toASN:r=>new ap({value:r})},e0={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new yo({valueHex:r})},aQ={fromASN:r=>new Ge(r.getValue()),toASN:r=>r.toASN()};function Rs(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}var HM=Rs(As),uwe=Rs(lp),dwe=Rs(up),fwe=Rs(dp),pwe=Rs(fp),hwe=Rs(pp),mwe=Rs(hp),gwe=Rs(mp),ywe=Rs(gp),vwe=Rs(qu),wwe=Rs(yp),bwe=Rs(vp),xwe={fromASN:r=>r.toDate(),toASN:r=>new Ku({valueDate:r})},Ewe={fromASN:r=>r.toDate(),toASN:r=>new wp({valueDate:r})},_we={fromASN:()=>null,toASN:()=>new ai};function t0(r){switch(r){case T.Any:return owe;case T.BitString:return awe;case T.BmpString:return uwe;case T.Boolean:return lwe;case T.CharacterString:return bwe;case T.Enumerated:return swe;case T.GeneralString:return wwe;case T.GeneralizedTime:return Ewe;case T.GraphicString:return ywe;case T.IA5String:return gwe;case T.Integer:return iwe;case T.Null:return _we;case T.NumericString:return fwe;case T.ObjectIdentifier:return cwe;case T.OctetString:return e0;case T.PrintableString:return pwe;case T.TeletexString:return hwe;case T.UTCTime:return xwe;case T.UniversalString:return dwe;case T.Utf8String:return HM;case T.VideotexString:return mwe;case T.VisibleString:return vwe;default:return null}}function Ns(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:Ns(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function zM(r){var e;if(r){let t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:zM(t)}return!1}function cQ(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}var X8=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:q.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=t?i:"",c;if(typeof s.type=="number"){let u=T[s.type],d=Ts[u];if(!d)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new d({name:a})}else Ns(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===q.Choice?c=new gc({name:a}):(c=this.create(s.type,!1),c.name=a):c=new gc({name:a});let l=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let u=s.repeated==="set"?ci:pr;c=new u({name:"",value:[new bp({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||Ns(s.type)){let u=s.repeated?pn:Tl;o.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let u=!!s.repeated,d=u?c:this.get(s.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,o.push(new pn({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:d}))}else o.push(new pn({optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=l,o.push(c)}switch(n.type){case q.Sequence:return new pr({value:o,name:""});case q.Set:return new ci({value:o,name:""});case q.Choice:return new Ng({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}};var zo=new X8;var W=r=>e=>{let t;zo.has(e)?t=zo.get(e):(t=zo.createDefault(e),zo.set(e,t)),Object.assign(t,r)};var x=r=>(e,t)=>{let n;zo.has(e.constructor)?n=zo.get(e.constructor):(n=zo.createDefault(e.constructor),zo.set(e.constructor,n));let o=Object.assign({},r);if(typeof o.type=="number"&&!o.converter){let i=t0(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);o.converter=i}n.items[t]=o};var Dv=class extends Error{constructor(){super(...arguments),this.schemas=[]}};var Tv=class{static parse(e,t){let n=Gi(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(Ns(t))return new t().fromASN(e);let o=zo.get(t);zo.cache(t);let i=o.schema;if(e.constructor===pn&&o.type!==q.Choice){i=new pn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(let c in o.items)delete e[c]}let s=zu({},e,i);if(!s.verified)throw new Dv(`Data does not match to ${t.name} ASN1 schema. ${s.result.error}`);let a=new t;if(zM(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let c=o.itemType;if(typeof c=="number"){let l=t0(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,u=>l.fromASN(u))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(let c in o.items){let l=s.result[c];if(!l)continue;let u=o.items[c],d=u.type;if(typeof d=="number"||Ns(d)){let h=(n=u.converter)!==null&&n!==void 0?n:Ns(d)?new d:null;if(!h)throw new Error("Converter is empty");if(u.repeated)if(u.implicit){let p=u.repeated==="sequence"?pr:ci,m=new p;m.valueBlock=l.valueBlock;let w=Gi(m.toBER(!1));if(w.offset===-1)throw new Error(`Cannot parse the child item. ${w.result.error}`);if(!("value"in w.result.valueBlock&&Array.isArray(w.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let E=w.result.valueBlock.value;a[c]=Array.from(E,S=>h.fromASN(S))}else a[c]=Array.from(l,p=>h.fromASN(p));else{let p=l;if(u.implicit){let m;if(Ns(d))m=new d().toSchema("");else{let w=T[d],E=Ts[w];if(!E)throw new Error(`Cannot get '${w}' class from asn1js module`);m=new E}m.valueBlock=p.valueBlock,p=Gi(m.toBER(!1)).result}a[c]=h.fromASN(p)}}else if(u.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,h=>this.fromASN(h,d))}else a[c]=this.fromASN(l,d)}return a}catch(o){throw o instanceof Dv&&o.schemas.push(t.name),o}}};var Pv=class r{static serialize(e){return e instanceof Hn?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&Ns(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let t=e.constructor,n=zo.get(t);zo.cache(t);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=t0(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",t,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&cQ(this.serialize(a.defaultValue),this.serialize(c)))continue;let l=r.toAsnItem(a,s,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||Ns(a.type))){let u={};u.valueHex=l instanceof ai?l.valueBeforeDecodeView:l.valueBlock.toBER(),o.push(new Tl(v({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context}},u)))}else o.push(new pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else o.push(new pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?o=o.concat(l):o.push(l)}let i;switch(n.type){case q.Sequence:i=new pr({value:o});break;case q.Set:i=new ci({value:o});break;case q.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,t,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${t}' doesn't have converter for type ${T[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,l=>s.toASN(l)),c=e.repeated==="sequence"?pr:ci;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?pr:ci;i=new a({value:s})}else i=this.toASN(o);return i}};var Be=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let t of e)this.push(t)}}};var qM=_r(Dl());var ve=class r{static serialize(e){return Pv.serialize(e)}static parse(e,t){return Tv.parse(e,t)}static toString(e){let t=qM.BufferSourceConverter.isBufferSource(e)?qM.BufferSourceConverter.toArrayBuffer(e):r.serialize(e),n=Gi(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};var lQ=_r(Dl()),Mv=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");let n=t[0]?t[0].split(":"):[],o=t[1]?t[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=t.slice(0,n).join(":"),c=t.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[t,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(t)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){let t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){let n=t.length/2,o=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(lQ.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}};var uQ=_r(Dl()),KM,GM,WM,on=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};g([x({type:T.TeletexString})],on.prototype,"teletexString",void 0);g([x({type:T.PrintableString})],on.prototype,"printableString",void 0);g([x({type:T.UniversalString})],on.prototype,"universalString",void 0);g([x({type:T.Utf8String})],on.prototype,"utf8String",void 0);g([x({type:T.BmpString})],on.prototype,"bmpString",void 0);on=g([W({type:q.Choice})],on);var r0=class extends on{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?uQ.Convert.ToHex(this.anyValue):super.toString())}};g([x({type:T.IA5String})],r0.prototype,"ia5String",void 0);g([x({type:T.Any})],r0.prototype,"anyValue",void 0);r0=g([W({type:q.Choice})],r0);var Bp=class{constructor(e={}){this.type="",this.value=new r0,Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Bp.prototype,"type",void 0);g([x({type:r0})],Bp.prototype,"value",void 0);var ad=KM=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,KM.prototype)}};ad=KM=g([W({type:q.Set,itemType:Bp})],ad);var YM=GM=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,GM.prototype)}};YM=GM=g([W({type:q.Sequence,itemType:ad})],YM);var Yt=WM=class extends YM{constructor(e){super(e),Object.setPrototypeOf(this,WM.prototype)}};Yt=WM=g([W({type:q.Sequence})],Yt);var Swe={fromASN:r=>Mv.toString(e0.fromASN(r)),toASN:r=>e0.toASN(Mv.fromString(r))},cd=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],cd.prototype,"typeId",void 0);g([x({type:T.Any,context:0})],cd.prototype,"value",void 0);var kv=class{constructor(e={}){this.partyName=new on,Object.assign(this,e)}};g([x({type:on,optional:!0,context:0,implicit:!0})],kv.prototype,"nameAssigner",void 0);g([x({type:on,context:1,implicit:!0})],kv.prototype,"partyName",void 0);var Xe=class{constructor(e={}){Object.assign(this,e)}};g([x({type:cd,context:0,implicit:!0})],Xe.prototype,"otherName",void 0);g([x({type:T.IA5String,context:1,implicit:!0})],Xe.prototype,"rfc822Name",void 0);g([x({type:T.IA5String,context:2,implicit:!0})],Xe.prototype,"dNSName",void 0);g([x({type:T.Any,context:3,implicit:!0})],Xe.prototype,"x400Address",void 0);g([x({type:Yt,context:4,implicit:!1})],Xe.prototype,"directoryName",void 0);g([x({type:kv,context:5})],Xe.prototype,"ediPartyName",void 0);g([x({type:T.IA5String,context:6,implicit:!0})],Xe.prototype,"uniformResourceIdentifier",void 0);g([x({type:T.OctetString,context:7,implicit:!0,converter:Swe})],Xe.prototype,"iPAddress",void 0);g([x({type:T.ObjectIdentifier,context:8,implicit:!0})],Xe.prototype,"registeredID",void 0);Xe=g([W({type:q.Choice})],Xe);var ld="1.3.6.1.5.5.7",ud=`${ld}.1`,dQ=`${ld}.2`,Up=`${ld}.3`,Q8=`${ld}.48`,sbt=`${dQ}.1`,abt=`${dQ}.2`,XM=`${Q8}.1`,QM=`${Q8}.2`,ZM=`${Q8}.3`,JM=`${Q8}.5`,rt="2.5.29";var ek,Z8=`${ud}.1`,Ol=class{constructor(e={}){this.accessMethod="",this.accessLocation=new Xe,Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Ol.prototype,"accessMethod",void 0);g([x({type:Xe})],Ol.prototype,"accessLocation",void 0);var Vp=ek=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,ek.prototype)}};Vp=ek=g([W({type:q.Sequence,itemType:Ol})],Vp);var J8=`${rt}.35`,jp=class extends Ge{},xc=class{constructor(e={}){e&&Object.assign(this,e)}};g([x({type:jp,context:0,optional:!0,implicit:!0})],xc.prototype,"keyIdentifier",void 0);g([x({type:Xe,context:1,optional:!0,implicit:!0,repeated:"sequence"})],xc.prototype,"authorityCertIssuer",void 0);g([x({type:T.Integer,context:2,optional:!0,implicit:!0,converter:yt})],xc.prototype,"authorityCertSerialNumber",void 0);var e_=`${rt}.19`,Hp=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};g([x({type:T.Boolean,defaultValue:!1})],Hp.prototype,"cA",void 0);g([x({type:T.Integer,optional:!0})],Hp.prototype,"pathLenConstraint",void 0);var tk,hr=tk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,tk.prototype)}};hr=tk=g([W({type:q.Sequence,itemType:Xe})],hr);var rk,Cwe=`${rt}.29`,fQ=rk=class extends hr{constructor(e){super(e),Object.setPrototypeOf(this,rk.prototype)}};fQ=rk=g([W({type:q.Sequence})],fQ);var nk,r_=`${rt}.32`,Ubt=`${r_}.0`,Ll=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};g([x({type:T.IA5String})],Ll.prototype,"ia5String",void 0);g([x({type:T.VisibleString})],Ll.prototype,"visibleString",void 0);g([x({type:T.BmpString})],Ll.prototype,"bmpString",void 0);g([x({type:T.Utf8String})],Ll.prototype,"utf8String",void 0);Ll=g([W({type:q.Choice})],Ll);var Rv=class{constructor(e={}){this.organization=new Ll,this.noticeNumbers=[],Object.assign(this,e)}};g([x({type:Ll})],Rv.prototype,"organization",void 0);g([x({type:T.Integer,repeated:"sequence"})],Rv.prototype,"noticeNumbers",void 0);var Nv=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Rv,optional:!0})],Nv.prototype,"noticeRef",void 0);g([x({type:Ll,optional:!0})],Nv.prototype,"explicitText",void 0);var t_=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.IA5String})],t_.prototype,"cPSuri",void 0);g([x({type:Nv})],t_.prototype,"userNotice",void 0);t_=g([W({type:q.Choice})],t_);var Ov=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Ov.prototype,"policyQualifierId",void 0);g([x({type:T.Any})],Ov.prototype,"qualifier",void 0);var $p=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],$p.prototype,"policyIdentifier",void 0);g([x({type:Ov,repeated:"sequence",optional:!0})],$p.prototype,"policyQualifiers",void 0);var Lv=nk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,nk.prototype)}};Lv=nk=g([W({type:q.Sequence,itemType:$p})],Lv);var Gbt=`${rt}.20`,Fv=class{constructor(e=0){this.value=e}};g([x({type:T.Integer})],Fv.prototype,"value",void 0);Fv=g([W({type:q.Choice})],Fv);var e3t=`${rt}.27`,pQ=class extends Fv{};pQ=g([W({type:q.Choice})],pQ);var ok,n_=`${rt}.31`,Ec=function(r){return r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise",r}(Ec||{}),Bv=class extends bc{toJSON(){let e=[],t=this.toNumber();return t&Ec.aACompromise&&e.push("aACompromise"),t&Ec.affiliationChanged&&e.push("affiliationChanged"),t&Ec.cACompromise&&e.push("cACompromise"),t&Ec.certificateHold&&e.push("certificateHold"),t&Ec.cessationOfOperation&&e.push("cessationOfOperation"),t&Ec.keyCompromise&&e.push("keyCompromise"),t&Ec.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Ec.superseded&&e.push("superseded"),t&Ec.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}},Fl=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Xe,context:0,repeated:"sequence",implicit:!0})],Fl.prototype,"fullName",void 0);g([x({type:ad,context:1,implicit:!0})],Fl.prototype,"nameRelativeToCRLIssuer",void 0);Fl=g([W({type:q.Choice})],Fl);var _c=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Fl,context:0,optional:!0})],_c.prototype,"distributionPoint",void 0);g([x({type:Bv,context:1,optional:!0,implicit:!0})],_c.prototype,"reasons",void 0);g([x({type:Xe,context:2,optional:!0,repeated:"sequence",implicit:!0})],_c.prototype,"cRLIssuer",void 0);var dd=ok=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,ok.prototype)}};dd=ok=g([W({type:q.Sequence,itemType:_c})],dd);var ik,m3t=`${rt}.46`,hQ=ik=class extends dd{constructor(e){super(e),Object.setPrototypeOf(this,ik.prototype)}};hQ=ik=g([W({type:q.Sequence,itemType:_c})],hQ);var _3t=`${rt}.28`,Yi=class r{constructor(e={}){this.onlyContainsUserCerts=r.ONLY,this.onlyContainsCACerts=r.ONLY,this.indirectCRL=r.ONLY,this.onlyContainsAttributeCerts=r.ONLY,Object.assign(this,e)}};Yi.ONLY=!1;g([x({type:Fl,context:0,optional:!0})],Yi.prototype,"distributionPoint",void 0);g([x({type:T.Boolean,context:1,defaultValue:Yi.ONLY,implicit:!0})],Yi.prototype,"onlyContainsUserCerts",void 0);g([x({type:T.Boolean,context:2,defaultValue:Yi.ONLY,implicit:!0})],Yi.prototype,"onlyContainsCACerts",void 0);g([x({type:Bv,context:3,optional:!0,implicit:!0})],Yi.prototype,"onlySomeReasons",void 0);g([x({type:T.Boolean,context:4,defaultValue:Yi.ONLY,implicit:!0})],Yi.prototype,"indirectCRL",void 0);g([x({type:T.Boolean,context:5,defaultValue:Yi.ONLY,implicit:!0})],Yi.prototype,"onlyContainsAttributeCerts",void 0);var mQ=`${rt}.21`,o_=function(r){return r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise",r}(o_||{}),Uv=class{constructor(e=o_.unspecified){this.reason=o_.unspecified,this.reason=e}toJSON(){return o_[this.reason]}toString(){return this.toJSON()}};g([x({type:T.Enumerated})],Uv.prototype,"reason",void 0);Uv=g([W({type:q.Choice})],Uv);var sk,i_=`${rt}.37`,Vv=sk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,sk.prototype)}};Vv=sk=g([W({type:q.Sequence,itemType:T.ObjectIdentifier})],Vv);var N3t=`${i_}.0`,gQ=`${Up}.1`,yQ=`${Up}.2`,vQ=`${Up}.3`,wQ=`${Up}.4`,bQ=`${Up}.8`,xQ=`${Up}.9`;var U3t=`${rt}.54`,ak=class{constructor(e=new ArrayBuffer(0)){this.value=e}};g([x({type:T.Integer,converter:yt})],ak.prototype,"value",void 0);ak=g([W({type:q.Choice})],ak);var EQ=`${rt}.24`,jv=class{constructor(e){this.value=new Date,e&&(this.value=e)}};g([x({type:T.GeneralizedTime})],jv.prototype,"value",void 0);jv=g([W({type:q.Choice})],jv);var ck,Q3t=`${rt}.18`,_Q=ck=class extends hr{constructor(e){super(e),Object.setPrototypeOf(this,ck.prototype)}};_Q=ck=g([W({type:q.Sequence})],_Q);var s_=`${rt}.15`,Sc=function(r){return r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly",r}(Sc||{}),n0=class extends bc{toJSON(){let e=this.toNumber(),t=[];return e&Sc.cRLSign&&t.push("crlSign"),e&Sc.dataEncipherment&&t.push("dataEncipherment"),e&Sc.decipherOnly&&t.push("decipherOnly"),e&Sc.digitalSignature&&t.push("digitalSignature"),e&Sc.encipherOnly&&t.push("encipherOnly"),e&Sc.keyAgreement&&t.push("keyAgreement"),e&Sc.keyCertSign&&t.push("keyCertSign"),e&Sc.keyEncipherment&&t.push("keyEncipherment"),e&Sc.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}};var lk,a4t=`${rt}.30`,o0=class{constructor(e={}){this.base=new Xe,this.minimum=0,Object.assign(this,e)}};g([x({type:Xe})],o0.prototype,"base",void 0);g([x({type:T.Integer,context:0,defaultValue:0,implicit:!0})],o0.prototype,"minimum",void 0);g([x({type:T.Integer,context:1,optional:!0,implicit:!0})],o0.prototype,"maximum",void 0);var a_=lk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,lk.prototype)}};a_=lk=g([W({type:q.Sequence,itemType:o0})],a_);var c_=class{constructor(e={}){Object.assign(this,e)}};g([x({type:a_,context:0,optional:!0,implicit:!0})],c_.prototype,"permittedSubtrees",void 0);g([x({type:a_,context:1,optional:!0,implicit:!0})],c_.prototype,"excludedSubtrees",void 0);var p4t=`${rt}.36`,l_=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.Integer,context:0,implicit:!0,optional:!0,converter:yt})],l_.prototype,"requireExplicitPolicy",void 0);g([x({type:T.Integer,context:1,implicit:!0,optional:!0,converter:yt})],l_.prototype,"inhibitPolicyMapping",void 0);var uk,v4t=`${rt}.33`,Hv=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Hv.prototype,"issuerDomainPolicy",void 0);g([x({type:T.ObjectIdentifier})],Hv.prototype,"subjectDomainPolicy",void 0);var SQ=uk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,uk.prototype)}};SQ=uk=g([W({type:q.Sequence,itemType:Hv})],SQ);var dk,fk=`${rt}.17`,u_=dk=class extends hr{constructor(e){super(e),Object.setPrototypeOf(this,dk.prototype)}};u_=dk=g([W({type:q.Sequence})],u_);var Gn=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Gn.prototype,"type",void 0);g([x({type:T.Any,repeated:"set"})],Gn.prototype,"values",void 0);var pk,N4t=`${rt}.9`,CQ=pk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,pk.prototype)}};CQ=pk=g([W({type:q.Sequence,itemType:Gn})],CQ);var hk=`${rt}.14`,pi=class extends jp{};var $4t=`${rt}.16`,d_=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.GeneralizedTime,context:0,implicit:!0,optional:!0})],d_.prototype,"notBefore",void 0);g([x({type:T.GeneralizedTime,context:1,implicit:!0,optional:!0})],d_.prototype,"notAfter",void 0);var f_=function(r){return r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate",r}(f_||{}),p_=class extends bc{toJSON(){let e=[],t=this.toNumber();return t&f_.pKIXCertificate&&e.push("pKIXCertificate"),t&f_.newExtensions&&e.push("newExtensions"),t&f_.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}},h_=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new p_,Object.assign(this,e)}};g([x({type:T.GeneralString})],h_.prototype,"entrustVers",void 0);g([x({type:p_})],h_.prototype,"entrustInfoFlags",void 0);var mk,Z4t=`${ud}.11`,IQ=mk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,mk.prototype)}};IQ=mk=g([W({type:q.Sequence,itemType:Ol})],IQ);var AQ=_r(Dl()),de=class r{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof r&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&AQ.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};g([x({type:T.ObjectIdentifier})],de.prototype,"algorithm",void 0);g([x({type:T.Any,optional:!0})],de.prototype,"parameters",void 0);var Wn=class{constructor(e={}){this.algorithm=new de,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:de})],Wn.prototype,"algorithm",void 0);g([x({type:T.BitString})],Wn.prototype,"subjectPublicKey",void 0);var Nr=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};g([x({type:T.UTCTime})],Nr.prototype,"utcTime",void 0);g([x({type:T.GeneralizedTime})],Nr.prototype,"generalTime",void 0);Nr=g([W({type:q.Choice})],Nr);var Bl=class{constructor(e){this.notBefore=new Nr(new Date),this.notAfter=new Nr(new Date),e&&(this.notBefore=new Nr(e.notBefore),this.notAfter=new Nr(e.notAfter))}};g([x({type:Nr})],Bl.prototype,"notBefore",void 0);g([x({type:Nr})],Bl.prototype,"notAfter",void 0);var gk,Yn=class r{constructor(e={}){this.extnID="",this.critical=r.CRITICAL,this.extnValue=new Ge,Object.assign(this,e)}};Yn.CRITICAL=!1;g([x({type:T.ObjectIdentifier})],Yn.prototype,"extnID",void 0);g([x({type:T.Boolean,defaultValue:Yn.CRITICAL})],Yn.prototype,"critical",void 0);g([x({type:Ge})],Yn.prototype,"extnValue",void 0);var Xi=gk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,gk.prototype)}};Xi=gk=g([W({type:q.Sequence,itemType:Yn})],Xi);var fd=function(r){return r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3",r}(fd||{});var Xn=class{constructor(e={}){this.version=fd.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new de,this.issuer=new Yt,this.validity=new Bl,this.subject=new Yt,this.subjectPublicKeyInfo=new Wn,Object.assign(this,e)}};g([x({type:T.Integer,context:0,defaultValue:fd.v1})],Xn.prototype,"version",void 0);g([x({type:T.Integer,converter:yt})],Xn.prototype,"serialNumber",void 0);g([x({type:de})],Xn.prototype,"signature",void 0);g([x({type:Yt})],Xn.prototype,"issuer",void 0);g([x({type:Bl})],Xn.prototype,"validity",void 0);g([x({type:Yt})],Xn.prototype,"subject",void 0);g([x({type:Wn})],Xn.prototype,"subjectPublicKeyInfo",void 0);g([x({type:T.BitString,context:1,implicit:!0,optional:!0})],Xn.prototype,"issuerUniqueID",void 0);g([x({type:T.BitString,context:2,implicit:!0,optional:!0})],Xn.prototype,"subjectUniqueID",void 0);g([x({type:Xi,context:3,optional:!0})],Xn.prototype,"extensions",void 0);var Os=class{constructor(e={}){this.tbsCertificate=new Xn,this.signatureAlgorithm=new de,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:Xn})],Os.prototype,"tbsCertificate",void 0);g([x({type:de})],Os.prototype,"signatureAlgorithm",void 0);g([x({type:T.BitString})],Os.prototype,"signatureValue",void 0);var zp=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Nr,Object.assign(this,e)}};g([x({type:T.Integer,converter:yt})],zp.prototype,"userCertificate",void 0);g([x({type:Nr})],zp.prototype,"revocationDate",void 0);g([x({type:Yn,optional:!0,repeated:"sequence"})],zp.prototype,"crlEntryExtensions",void 0);var Qi=class{constructor(e={}){this.signature=new de,this.issuer=new Yt,this.thisUpdate=new Nr,Object.assign(this,e)}};g([x({type:T.Integer,optional:!0})],Qi.prototype,"version",void 0);g([x({type:de})],Qi.prototype,"signature",void 0);g([x({type:Yt})],Qi.prototype,"issuer",void 0);g([x({type:Nr})],Qi.prototype,"thisUpdate",void 0);g([x({type:Nr,optional:!0})],Qi.prototype,"nextUpdate",void 0);g([x({type:zp,repeated:"sequence",optional:!0})],Qi.prototype,"revokedCertificates",void 0);g([x({type:Yn,optional:!0,context:0,repeated:"sequence"})],Qi.prototype,"crlExtensions",void 0);var qp=class{constructor(e={}){this.tbsCertList=new Qi,this.signatureAlgorithm=new de,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:Qi})],qp.prototype,"tbsCertList",void 0);g([x({type:de})],qp.prototype,"signatureAlgorithm",void 0);g([x({type:T.BitString})],qp.prototype,"signature",void 0);var me=_r(Dl());var Ra=class{constructor(e={}){this.issuer=new Yt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:Yt})],Ra.prototype,"issuer",void 0);g([x({type:T.Integer,converter:yt})],Ra.prototype,"serialNumber",void 0);var Kp=class{constructor(e={}){Object.assign(this,e)}};g([x({type:pi,context:0,implicit:!0})],Kp.prototype,"subjectKeyIdentifier",void 0);g([x({type:Ra})],Kp.prototype,"issuerAndSerialNumber",void 0);Kp=g([W({type:q.Choice})],Kp);var xo=function(r){return r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5",r}(xo||{}),Gp=class extends de{};Gp=g([W({type:q.Sequence})],Gp);var $v=class extends de{};$v=g([W({type:q.Sequence})],$v);var hi=class extends de{};hi=g([W({type:q.Sequence})],hi);var zv=class extends de{};zv=g([W({type:q.Sequence})],zv);var TQ=class extends de{};TQ=g([W({type:q.Sequence})],TQ);var m_=class extends de{};m_=g([W({type:q.Sequence})],m_);var Na=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Na.prototype,"attrType",void 0);g([x({type:T.Any,repeated:"set"})],Na.prototype,"attrValues",void 0);var yk,mi=class{constructor(e={}){this.version=xo.v0,this.sid=new Kp,this.digestAlgorithm=new Gp,this.signatureAlgorithm=new $v,this.signature=new Ge,Object.assign(this,e)}};g([x({type:T.Integer})],mi.prototype,"version",void 0);g([x({type:Kp})],mi.prototype,"sid",void 0);g([x({type:Gp})],mi.prototype,"digestAlgorithm",void 0);g([x({type:Na,repeated:"set",context:0,implicit:!0,optional:!0})],mi.prototype,"signedAttrs",void 0);g([x({type:$v})],mi.prototype,"signatureAlgorithm",void 0);g([x({type:Ge})],mi.prototype,"signature",void 0);g([x({type:Na,repeated:"set",context:1,implicit:!0,optional:!0})],mi.prototype,"unsignedAttrs",void 0);var qv=yk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,yk.prototype)}};qv=yk=g([W({type:q.Set,itemType:mi})],qv);var PQ=class extends Nr{};PQ=g([W({type:q.Choice})],PQ);var MQ=class extends mi{};MQ=g([W({type:q.Sequence})],MQ);var Kv=class{constructor(e={}){this.acIssuer=new Xe,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};g([x({type:Xe})],Kv.prototype,"acIssuer",void 0);g([x({type:T.Integer})],Kv.prototype,"acSerial",void 0);g([x({type:Gn,repeated:"sequence"})],Kv.prototype,"attrs",void 0);var vk,Gv=vk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,vk.prototype)}};Gv=vk=g([W({type:q.Sequence,itemType:T.ObjectIdentifier})],Gv);var i0=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};g([x({type:T.Integer,optional:!0})],i0.prototype,"pathLenConstraint",void 0);g([x({type:Gv,implicit:!0,context:0,optional:!0})],i0.prototype,"permittedAttrs",void 0);g([x({type:Gv,implicit:!0,context:1,optional:!0})],i0.prototype,"excludedAttrs",void 0);g([x({type:T.Boolean,defaultValue:!0})],i0.prototype,"permitUnSpecified",void 0);var Ls=class{constructor(e={}){this.issuer=new hr,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:hr})],Ls.prototype,"issuer",void 0);g([x({type:T.Integer,converter:yt})],Ls.prototype,"serial",void 0);g([x({type:T.BitString,optional:!0})],Ls.prototype,"issuerUID",void 0);var kQ=function(r){return r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes",r}(kQ||{}),Fs=class{constructor(e={}){this.digestedObjectType=kQ.publicKey,this.digestAlgorithm=new de,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.Enumerated})],Fs.prototype,"digestedObjectType",void 0);g([x({type:T.ObjectIdentifier,optional:!0})],Fs.prototype,"otherObjectTypeID",void 0);g([x({type:de})],Fs.prototype,"digestAlgorithm",void 0);g([x({type:T.BitString})],Fs.prototype,"objectDigest",void 0);var Wp=class{constructor(e={}){Object.assign(this,e)}};g([x({type:hr,optional:!0})],Wp.prototype,"issuerName",void 0);g([x({type:Ls,context:0,implicit:!0,optional:!0})],Wp.prototype,"baseCertificateID",void 0);g([x({type:Fs,context:1,implicit:!0,optional:!0})],Wp.prototype,"objectDigestInfo",void 0);var Yp=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Xe,repeated:"sequence"})],Yp.prototype,"v1Form",void 0);g([x({type:Wp,context:0,implicit:!0})],Yp.prototype,"v2Form",void 0);Yp=g([W({type:q.Choice})],Yp);var Xp=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};g([x({type:T.GeneralizedTime})],Xp.prototype,"notBeforeTime",void 0);g([x({type:T.GeneralizedTime})],Xp.prototype,"notAfterTime",void 0);var pd=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Ls,implicit:!0,context:0,optional:!0})],pd.prototype,"baseCertificateID",void 0);g([x({type:hr,implicit:!0,context:1,optional:!0})],pd.prototype,"entityName",void 0);g([x({type:Fs,implicit:!0,context:2,optional:!0})],pd.prototype,"objectDigestInfo",void 0);var RQ=function(r){return r[r.v2=1]="v2",r}(RQ||{}),gi=class{constructor(e={}){this.version=RQ.v2,this.holder=new pd,this.issuer=new Yp,this.signature=new de,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new Xp,this.attributes=[],Object.assign(this,e)}};g([x({type:T.Integer})],gi.prototype,"version",void 0);g([x({type:pd})],gi.prototype,"holder",void 0);g([x({type:Yp})],gi.prototype,"issuer",void 0);g([x({type:de})],gi.prototype,"signature",void 0);g([x({type:T.Integer,converter:yt})],gi.prototype,"serialNumber",void 0);g([x({type:Xp})],gi.prototype,"attrCertValidityPeriod",void 0);g([x({type:Gn,repeated:"sequence"})],gi.prototype,"attributes",void 0);g([x({type:T.BitString,optional:!0})],gi.prototype,"issuerUniqueID",void 0);g([x({type:Xi,optional:!0})],gi.prototype,"extensions",void 0);var Qp=class{constructor(e={}){this.acinfo=new gi,this.signatureAlgorithm=new de,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:gi})],Qp.prototype,"acinfo",void 0);g([x({type:de})],Qp.prototype,"signatureAlgorithm",void 0);g([x({type:T.BitString})],Qp.prototype,"signatureValue",void 0);var g_=function(r){return r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret",r}(g_||{}),s0=class extends bc{};var a0=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier,implicit:!0,context:0})],a0.prototype,"type",void 0);g([x({type:T.Any,implicit:!0,context:1})],a0.prototype,"value",void 0);var Wv=class{constructor(e={}){this.policyId="",this.classList=new s0(g_.unclassified),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Wv.prototype,"policyId",void 0);g([x({type:s0,defaultValue:new s0(g_.unclassified)})],Wv.prototype,"classList",void 0);g([x({type:a0,repeated:"set"})],Wv.prototype,"securityCategories",void 0);var c0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Ge})],c0.prototype,"cotets",void 0);g([x({type:T.ObjectIdentifier})],c0.prototype,"oid",void 0);g([x({type:T.Utf8String})],c0.prototype,"string",void 0);var y_=class{constructor(e={}){this.values=[],Object.assign(this,e)}};g([x({type:hr,implicit:!0,context:0,optional:!0})],y_.prototype,"policyAuthority",void 0);g([x({type:c0,repeated:"sequence"})],y_.prototype,"values",void 0);var k5t=`${ud}.4`,R5t=`${ud}.6`,N5t=`${ud}.10`,O5t=`${rt}.55`,Yv=`${ld}.10`,L5t=`${Yv}.1`,F5t=`${Yv}.2`,B5t=`${Yv}.3`,U5t=`${Yv}.4`,V5t=`${Yv}.6`,wk="2.5.4",j5t=`${wk}.72`;var bk,l0=class{constructor(e={}){this.targetCertificate=new Ls,Object.assign(this,e)}};g([x({type:Ls})],l0.prototype,"targetCertificate",void 0);g([x({type:Xe,optional:!0})],l0.prototype,"targetName",void 0);g([x({type:Fs,optional:!0})],l0.prototype,"certDigestInfo",void 0);var u0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Xe,context:0,implicit:!0})],u0.prototype,"targetName",void 0);g([x({type:Xe,context:1,implicit:!0})],u0.prototype,"targetGroup",void 0);g([x({type:l0,context:2,implicit:!0})],u0.prototype,"targetCert",void 0);u0=g([W({type:q.Choice})],u0);var v_=bk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,bk.prototype)}};v_=bk=g([W({type:q.Sequence,itemType:u0})],v_);var xk,NQ=xk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,xk.prototype)}};NQ=xk=g([W({type:q.Sequence,itemType:v_})],NQ);var w_=class{constructor(e={}){Object.assign(this,e)}};g([x({type:hr,implicit:!0,context:0,optional:!0})],w_.prototype,"roleAuthority",void 0);g([x({type:Xe,implicit:!0,context:1})],w_.prototype,"roleName",void 0);var Xv=class{constructor(e={}){this.service=new Xe,this.ident=new Xe,Object.assign(this,e)}};g([x({type:Xe})],Xv.prototype,"service",void 0);g([x({type:Xe})],Xv.prototype,"ident",void 0);g([x({type:Ge,optional:!0})],Xv.prototype,"authInfo",void 0);var Ek,Qv=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Qv.prototype,"otherCertFormat",void 0);g([x({type:T.Any})],Qv.prototype,"otherCert",void 0);var Zp=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Os})],Zp.prototype,"certificate",void 0);g([x({type:Qp,context:2,implicit:!0})],Zp.prototype,"v2AttrCert",void 0);g([x({type:Qv,context:3,implicit:!0})],Zp.prototype,"other",void 0);Zp=g([W({type:q.Choice})],Zp);var Jp=Ek=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Ek.prototype)}};Jp=Ek=g([W({type:q.Set,itemType:Zp})],Jp);var Bs=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Bs.prototype,"contentType",void 0);g([x({type:T.Any,context:0})],Bs.prototype,"content",void 0);var d0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Ge})],d0.prototype,"single",void 0);g([x({type:T.Any})],d0.prototype,"any",void 0);d0=g([W({type:q.Choice})],d0);var eh=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],eh.prototype,"eContentType",void 0);g([x({type:d0,context:0,optional:!0})],eh.prototype,"eContent",void 0);var Zv=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Ge,context:0,implicit:!0,optional:!0})],Zv.prototype,"value",void 0);g([x({type:Ge,converter:aQ,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Zv.prototype,"constructedValue",void 0);Zv=g([W({type:q.Choice})],Zv);var hd=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new zv,Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],hd.prototype,"contentType",void 0);g([x({type:zv})],hd.prototype,"contentEncryptionAlgorithm",void 0);g([x({type:Zv,optional:!0})],hd.prototype,"encryptedContent",void 0);var md=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],md.prototype,"keyAttrId",void 0);g([x({type:T.Any,optional:!0})],md.prototype,"keyAttr",void 0);var _k,f0=class{constructor(e={}){this.subjectKeyIdentifier=new pi,Object.assign(this,e)}};g([x({type:pi})],f0.prototype,"subjectKeyIdentifier",void 0);g([x({type:T.GeneralizedTime,optional:!0})],f0.prototype,"date",void 0);g([x({type:md,optional:!0})],f0.prototype,"other",void 0);var p0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:f0,context:0,implicit:!0,optional:!0})],p0.prototype,"rKeyId",void 0);g([x({type:Ra,optional:!0})],p0.prototype,"issuerAndSerialNumber",void 0);p0=g([W({type:q.Choice})],p0);var Jv=class{constructor(e={}){this.rid=new p0,this.encryptedKey=new Ge,Object.assign(this,e)}};g([x({type:p0})],Jv.prototype,"rid",void 0);g([x({type:Ge})],Jv.prototype,"encryptedKey",void 0);var b_=_k=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,_k.prototype)}};b_=_k=g([W({type:q.Sequence,itemType:Jv})],b_);var ew=class{constructor(e={}){this.algorithm=new de,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:de})],ew.prototype,"algorithm",void 0);g([x({type:T.BitString})],ew.prototype,"publicKey",void 0);var th=class{constructor(e={}){Object.assign(this,e)}};g([x({type:pi,context:0,implicit:!0,optional:!0})],th.prototype,"subjectKeyIdentifier",void 0);g([x({type:ew,context:1,implicit:!0,optional:!0})],th.prototype,"originatorKey",void 0);g([x({type:Ra,optional:!0})],th.prototype,"issuerAndSerialNumber",void 0);th=g([W({type:q.Choice})],th);var Ul=class{constructor(e={}){this.version=xo.v3,this.originator=new th,this.keyEncryptionAlgorithm=new hi,this.recipientEncryptedKeys=new b_,Object.assign(this,e)}};g([x({type:T.Integer})],Ul.prototype,"version",void 0);g([x({type:th,context:0})],Ul.prototype,"originator",void 0);g([x({type:Ge,context:1,optional:!0})],Ul.prototype,"ukm",void 0);g([x({type:hi})],Ul.prototype,"keyEncryptionAlgorithm",void 0);g([x({type:b_})],Ul.prototype,"recipientEncryptedKeys",void 0);var h0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:pi,context:0,implicit:!0})],h0.prototype,"subjectKeyIdentifier",void 0);g([x({type:Ra})],h0.prototype,"issuerAndSerialNumber",void 0);h0=g([W({type:q.Choice})],h0);var gd=class{constructor(e={}){this.version=xo.v0,this.rid=new h0,this.keyEncryptionAlgorithm=new hi,this.encryptedKey=new Ge,Object.assign(this,e)}};g([x({type:T.Integer})],gd.prototype,"version",void 0);g([x({type:h0})],gd.prototype,"rid",void 0);g([x({type:hi})],gd.prototype,"keyEncryptionAlgorithm",void 0);g([x({type:Ge})],gd.prototype,"encryptedKey",void 0);var rh=class{constructor(e={}){this.keyIdentifier=new Ge,Object.assign(this,e)}};g([x({type:Ge})],rh.prototype,"keyIdentifier",void 0);g([x({type:T.GeneralizedTime,optional:!0})],rh.prototype,"date",void 0);g([x({type:md,optional:!0})],rh.prototype,"other",void 0);var yd=class{constructor(e={}){this.version=xo.v4,this.kekid=new rh,this.keyEncryptionAlgorithm=new hi,this.encryptedKey=new Ge,Object.assign(this,e)}};g([x({type:T.Integer})],yd.prototype,"version",void 0);g([x({type:rh})],yd.prototype,"kekid",void 0);g([x({type:hi})],yd.prototype,"keyEncryptionAlgorithm",void 0);g([x({type:Ge})],yd.prototype,"encryptedKey",void 0);var vd=class{constructor(e={}){this.version=xo.v0,this.keyEncryptionAlgorithm=new hi,this.encryptedKey=new Ge,Object.assign(this,e)}};g([x({type:T.Integer})],vd.prototype,"version",void 0);g([x({type:m_,context:0,optional:!0})],vd.prototype,"keyDerivationAlgorithm",void 0);g([x({type:hi})],vd.prototype,"keyEncryptionAlgorithm",void 0);g([x({type:Ge})],vd.prototype,"encryptedKey",void 0);var tw=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],tw.prototype,"oriType",void 0);g([x({type:T.Any})],tw.prototype,"oriValue",void 0);var Vl=class{constructor(e={}){Object.assign(this,e)}};g([x({type:gd,optional:!0})],Vl.prototype,"ktri",void 0);g([x({type:Ul,context:1,implicit:!0,optional:!0})],Vl.prototype,"kari",void 0);g([x({type:yd,context:2,implicit:!0,optional:!0})],Vl.prototype,"kekri",void 0);g([x({type:vd,context:3,implicit:!0,optional:!0})],Vl.prototype,"pwri",void 0);g([x({type:tw,context:4,implicit:!0,optional:!0})],Vl.prototype,"ori",void 0);Vl=g([W({type:q.Choice})],Vl);var Sk,rw=Sk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Sk.prototype)}};rw=Sk=g([W({type:q.Set,itemType:Vl})],rw);var Ck,OQ=`${ld}.16`,V_t=`${OQ}.2`,j_t=`${OQ}.4`,m0=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],m0.prototype,"otherRevInfoFormat",void 0);g([x({type:T.Any})],m0.prototype,"otherRevInfo",void 0);var x_=class{constructor(e={}){this.other=new m0,Object.assign(this,e)}};g([x({type:m0,context:1,implicit:!0})],x_.prototype,"other",void 0);x_=g([W({type:q.Choice})],x_);var g0=Ck=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Ck.prototype)}};g0=Ck=g([W({type:q.Set,itemType:x_})],g0);var y0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:Jp,context:0,implicit:!0,optional:!0})],y0.prototype,"certs",void 0);g([x({type:g0,context:1,implicit:!0,optional:!0})],y0.prototype,"crls",void 0);var Ik,Ak=Ik=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Ik.prototype)}};Ak=Ik=g([W({type:q.Set,itemType:Na})],Ak);var nh=class{constructor(e={}){this.version=xo.v0,this.recipientInfos=new rw,this.encryptedContentInfo=new hd,Object.assign(this,e)}};g([x({type:T.Integer})],nh.prototype,"version",void 0);g([x({type:y0,context:0,implicit:!0,optional:!0})],nh.prototype,"originatorInfo",void 0);g([x({type:rw})],nh.prototype,"recipientInfos",void 0);g([x({type:hd})],nh.prototype,"encryptedContentInfo",void 0);g([x({type:Ak,context:1,implicit:!0,optional:!0})],nh.prototype,"unprotectedAttrs",void 0);var LQ="1.2.840.113549.1.7.2";var Dk,E_=Dk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Dk.prototype)}};E_=Dk=g([W({type:q.Set,itemType:Gp})],E_);var jl=class{constructor(e={}){this.version=xo.v0,this.digestAlgorithms=new E_,this.encapContentInfo=new eh,this.signerInfos=new qv,Object.assign(this,e)}};g([x({type:T.Integer})],jl.prototype,"version",void 0);g([x({type:E_})],jl.prototype,"digestAlgorithms",void 0);g([x({type:eh})],jl.prototype,"encapContentInfo",void 0);g([x({type:Jp,context:0,implicit:!0,optional:!0})],jl.prototype,"certificates",void 0);g([x({type:g0,context:1,implicit:!0,optional:!0})],jl.prototype,"crls",void 0);g([x({type:qv})],jl.prototype,"signerInfos",void 0);var oh="1.2.840.10045.2.1";var nw="1.2.840.10045.4.1",__="1.2.840.10045.4.3.1",ow="1.2.840.10045.4.3.2",iw="1.2.840.10045.4.3.3",sw="1.2.840.10045.4.3.4";var Tk="1.2.840.10045.3.1.7";var Pk="1.3.132.0.34";var Mk="1.3.132.0.35";function aw(r){return new de({algorithm:r})}var BQ=aw(nw),FSt=aw(__),UQ=aw(ow),VQ=aw(iw),jQ=aw(sw);var cw=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],cw.prototype,"fieldType",void 0);g([x({type:T.Any})],cw.prototype,"parameters",void 0);cw=g([W({type:q.Sequence})],cw);var kk=class extends Ge{};var v0=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.OctetString})],v0.prototype,"a",void 0);g([x({type:T.OctetString})],v0.prototype,"b",void 0);g([x({type:T.BitString,optional:!0})],v0.prototype,"seed",void 0);v0=g([W({type:q.Sequence})],v0);var HQ=function(r){return r[r.ecpVer1=1]="ecpVer1",r}(HQ||{}),Cc=class{constructor(e={}){this.version=HQ.ecpVer1,Object.assign(this,e)}};g([x({type:T.Integer})],Cc.prototype,"version",void 0);g([x({type:cw})],Cc.prototype,"fieldID",void 0);g([x({type:v0})],Cc.prototype,"curve",void 0);g([x({type:kk})],Cc.prototype,"base",void 0);g([x({type:T.Integer,converter:yt})],Cc.prototype,"order",void 0);g([x({type:T.Integer,optional:!0})],Cc.prototype,"cofactor",void 0);Cc=g([W({type:q.Sequence})],Cc);var Ic=class{constructor(e={}){Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],Ic.prototype,"namedCurve",void 0);g([x({type:T.Null})],Ic.prototype,"implicitCurve",void 0);g([x({type:Cc})],Ic.prototype,"specifiedCurve",void 0);Ic=g([W({type:q.Choice})],Ic);var w0=class{constructor(e={}){this.version=1,this.privateKey=new Ge,Object.assign(this,e)}};g([x({type:T.Integer})],w0.prototype,"version",void 0);g([x({type:Ge})],w0.prototype,"privateKey",void 0);g([x({type:Ic,context:0,optional:!0})],w0.prototype,"parameters",void 0);g([x({type:T.BitString,context:1,optional:!0})],w0.prototype,"publicKey",void 0);var ih=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.Integer,converter:yt})],ih.prototype,"r",void 0);g([x({type:T.Integer,converter:yt})],ih.prototype,"s",void 0);var yi="1.2.840.113549.1.1",Ac=`${yi}.1`,$Q=`${yi}.7`,zQ=`${yi}.9`,wd=`${yi}.10`,qQ=`${yi}.2`,KQ=`${yi}.4`,b0=`${yi}.5`,GQ=`${yi}.14`;var S_=`${yi}.11`,x0=`${yi}.12`,E0=`${yi}.13`,Rk=`${yi}.15`,Nk=`${yi}.16`,sh="1.3.14.3.2.26",C_="2.16.840.1.101.3.4.2.4",ah="2.16.840.1.101.3.4.2.1",ch="2.16.840.1.101.3.4.2.2",lh="2.16.840.1.101.3.4.2.3",WQ="2.16.840.1.101.3.4.2.5",YQ="2.16.840.1.101.3.4.2.6",XQ="1.2.840.113549.2.2",QQ="1.2.840.113549.2.5",bd=`${yi}.8`;function hn(r){return new de({algorithm:r,parameters:null})}var dCt=hn(XQ),fCt=hn(QQ),Hl=hn(sh),pCt=hn(C_),hCt=hn(ah),mCt=hn(ch),gCt=hn(lh),yCt=hn(WQ),vCt=hn(YQ),I_=new de({algorithm:bd,parameters:ve.serialize(Hl)}),Ok=new de({algorithm:zQ,parameters:ve.serialize(e0.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))}),wCt=hn(Ac),bCt=hn(qQ),xCt=hn(KQ),ECt=hn(b0),_Ct=hn(Rk),SCt=hn(Nk),CCt=hn(x0),ICt=hn(E0),ACt=hn(Rk),DCt=hn(Nk);var _0=class{constructor(e={}){this.hashAlgorithm=new de(Hl),this.maskGenAlgorithm=new de({algorithm:bd,parameters:ve.serialize(Hl)}),this.pSourceAlgorithm=new de(Ok),Object.assign(this,e)}};g([x({type:de,context:0,defaultValue:Hl})],_0.prototype,"hashAlgorithm",void 0);g([x({type:de,context:1,defaultValue:I_})],_0.prototype,"maskGenAlgorithm",void 0);g([x({type:de,context:2,defaultValue:Ok})],_0.prototype,"pSourceAlgorithm",void 0);var OCt=new de({algorithm:$Q,parameters:ve.serialize(new _0)});var Dc=class{constructor(e={}){this.hashAlgorithm=new de(Hl),this.maskGenAlgorithm=new de({algorithm:bd,parameters:ve.serialize(Hl)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};g([x({type:de,context:0,defaultValue:Hl})],Dc.prototype,"hashAlgorithm",void 0);g([x({type:de,context:1,defaultValue:I_})],Dc.prototype,"maskGenAlgorithm",void 0);g([x({type:T.Integer,context:2,defaultValue:20})],Dc.prototype,"saltLength",void 0);g([x({type:T.Integer,context:3,defaultValue:1})],Dc.prototype,"trailerField",void 0);var HCt=new de({algorithm:wd,parameters:ve.serialize(new Dc)});var uh=class{constructor(e={}){this.digestAlgorithm=new de,this.digest=new Ge,Object.assign(this,e)}};g([x({type:de})],uh.prototype,"digestAlgorithm",void 0);g([x({type:Ge})],uh.prototype,"digest",void 0);var Lk,S0=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.Integer,converter:yt})],S0.prototype,"prime",void 0);g([x({type:T.Integer,converter:yt})],S0.prototype,"exponent",void 0);g([x({type:T.Integer,converter:yt})],S0.prototype,"coefficient",void 0);var A_=Lk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Lk.prototype)}};A_=Lk=g([W({type:q.Sequence,itemType:S0})],A_);var Us=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.Integer})],Us.prototype,"version",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"modulus",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"publicExponent",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"privateExponent",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"prime1",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"prime2",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"exponent1",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"exponent2",void 0);g([x({type:T.Integer,converter:yt})],Us.prototype,"coefficient",void 0);g([x({type:A_,optional:!0})],Us.prototype,"otherPrimeInfos",void 0);var C0=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.Integer,converter:yt})],C0.prototype,"modulus",void 0);g([x({type:T.Integer,converter:yt})],C0.prototype,"publicExponent",void 0);var ZQ=function(r){return r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped",r}(ZQ||{}),Qn=ZQ;var Mwe="injectionTokens";function Fk(r){let e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(Mwe,r)||{};return Object.keys(t).forEach(n=>{e[+n]=t[n]}),e}function JQ(r,e,t,n){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function lw(r){return!!r.useClass}function I0(r){return!!r.useFactory}var A0=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},n=!1,o,i=()=>(n||(o=e(this.wrap()),n=!0),o);return new Proxy(t,this.createHandler(i))}createHandler(e){let t={},n=o=>{t[o]=(...i)=>{i[0]=e();let s=Reflect[o];return s(...i)}};return this.reflectMethods.forEach(n),t}};function xd(r){return typeof r=="string"||typeof r=="symbol"}function Bk(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function D_(r){return typeof r=="object"&&"token"in r&&"transform"in r}function eZ(r){return typeof r=="function"||r instanceof A0}function dh(r){return!!r.useToken}function fh(r){return r.useValue!=null}function tZ(r){return lw(r)||fh(r)||dh(r)||I0(r)}var ph=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};var T_=class extends ph{};var hh=class{constructor(){this.scopedResolutions=new Map}};function kwe(r,e){return r===null?`at position #${e}`:`"${r.split(",")[e].trim()}" at position #${e}`}function Rwe(r,e,t="    "){return[r,...e.message.split(`
`).map(n=>t+n)].join(`
`)}function Uk(r,e,t){let[,n=null]=r.toString().match(/constructor\(([\w, ]+)\)/)||[],o=kwe(n,e);return Rwe(`Cannot inject the dependency ${o} of "${r.name}" constructor. Reason:`,t)}function rZ(r){return!(typeof r.dispose!="function"||r.dispose.length>0)}var Vk=class extends ph{},jk=class extends ph{},P_=class{constructor(){this.preResolution=new Vk,this.postResolution=new jk}};var $k=new Map,Hk=class r{constructor(e){this.parent=e,this._registry=new T_,this.interceptors=new P_,this.disposed=!1,this.disposables=new Set}register(e,t,n={lifecycle:Qn.Transient}){this.ensureNotDisposed();let o;if(tZ(t)?o=t:o={useClass:t},dh(o)){let i=[e],s=o;for(;s!=null;){let a=s.useToken;if(i.includes(a))throw new Error(`Token registration cycle detected! ${[...i,a].join(" -> ")}`);i.push(a);let c=this._registry.get(a);c&&dh(c.provider)?s=c.provider:s=null}}if((n.lifecycle===Qn.Singleton||n.lifecycle==Qn.ContainerScoped||n.lifecycle==Qn.ResolutionScoped)&&(fh(o)||I0(o)))throw new Error(`Cannot use lifecycle "${Qn[n.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:o,options:n}),this}registerType(e,t){return this.ensureNotDisposed(),xd(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),xd(e)){if(xd(t))return this.register(e,{useToken:t},{lifecycle:Qn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Qn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let n=e;return t&&!xd(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:Qn.Singleton})}resolve(e,t=new hh,n=!1){this.ensureNotDisposed();let o=this.getRegistration(e);if(!o&&xd(e)){if(n)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),o){let i=this.resolveRegistration(o,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(eZ(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let n=[];for(let o of this.interceptors.preResolution.getAll(e))o.options.frequency!="Once"&&n.push(o),o.callback(e,t);this.interceptors.preResolution.setAll(e,n)}}executePostResolutionInterceptor(e,t,n){if(this.interceptors.postResolution.has(e)){let o=[];for(let i of this.interceptors.postResolution.getAll(e))i.options.frequency!="Once"&&o.push(i),i.callback(e,t,n);this.interceptors.postResolution.setAll(e,o)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Qn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let n=e.options.lifecycle===Qn.Singleton,o=e.options.lifecycle===Qn.ContainerScoped,i=n||o,s;return fh(e.provider)?s=e.provider.useValue:dh(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):lw(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):I0(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,t),e.options.lifecycle===Qn.ResolutionScoped&&t.scopedResolutions.set(e,s),s}resolveAll(e,t=new hh,n=!1){this.ensureNotDisposed();let o=this.getAllRegistrations(e);if(!o&&xd(e)){if(n)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),o){let s=o.map(a=>this.resolveRegistration(a,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(n=>!fh(n.provider)).map(n=>(n.instance=void 0,n)))}createChildContainer(){this.ensureNotDisposed();let e=new r(this);for(let[t,n]of this._registry.entries())n.some(({options:o})=>o.lifecycle===Qn.ContainerScoped)&&e._registry.setAll(t,n.map(o=>o.options.lifecycle===Qn.ContainerScoped?{provider:o.provider,options:o.options}:o));return e}beforeResolution(e,t,n={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:n})}afterResolution(e,t,n={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:n})}dispose(){return JQ(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let n=t.dispose();n&&e.push(n)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof A0)return e.createProxy(o=>this.resolve(o,t));let n=(()=>{let o=$k.get(e);if(!o||o.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let i=o.map(this.resolveParams(t,e));return new e(...i)})();return rZ(n)&&this.disposables.add(n),n}resolveParams(e,t){return(n,o)=>{try{return Bk(n)?D_(n)?n.multiple?this.resolve(n.transform).transform(this.resolveAll(n.token,new hh,n.isOptional),...n.transformArgs):this.resolve(n.transform).transform(this.resolve(n.token,e,n.isOptional),...n.transformArgs):n.multiple?this.resolveAll(n.token,new hh,n.isOptional):this.resolve(n.token,e,n.isOptional):D_(n)?this.resolve(n.transform,e).transform(this.resolve(n.token,e),...n.transformArgs):this.resolve(n,e)}catch(i){throw new Error(Uk(t,o,i))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}},mr=new Hk;function Nwe(r){return function(e){$k.set(e,Fk(e)),r&&r.token&&(Array.isArray(r.token)?r.token.forEach(t=>{mr.register(t,e)}):mr.register(r.token,e))}}var Ed=Nwe;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var qk,mh=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};g([x({type:T.ObjectIdentifier})],mh.prototype,"attrId",void 0);g([x({type:T.Any,repeated:"set"})],mh.prototype,"attrValues",void 0);var nZ=qk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,qk.prototype)}};nZ=qk=g([W({type:q.Sequence,itemType:mh})],nZ);var Kk,oZ=Kk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Kk.prototype)}};oZ=Kk=g([W({type:q.Sequence,itemType:Bs})],oZ);var Owe="1.2.840.113549",Lwe=`${Owe}.1`,iZ=`${Lwe}.12`,D0=`${iZ}.1`,b9t=`${D0}.1`,x9t=`${D0}.2`,E9t=`${D0}.3`,_9t=`${D0}.4`,S9t=`${D0}.5`,C9t=`${D0}.6`,gh=`${iZ}.10.1`;var D9t=`${gh}.1`,T9t=`${gh}.2`,P9t=`${gh}.3`,M9t=`${gh}.4`,k9t=`${gh}.5`,R9t=`${gh}.6`,M_="1.2.840.113549.1.9";var k_=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],k_.prototype,"certId",void 0);g([x({type:T.Any,context:0})],k_.prototype,"certValue",void 0);var sZ=`${M_}.22`,B9t=`${sZ}.1`,U9t=`${sZ}.2`;var R_=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],R_.prototype,"crlId",void 0);g([x({type:T.Any,context:0})],R_.prototype,"crltValue",void 0);var Fwe=`${M_}.23`,z9t=`${Fwe}.1`;var N_=class extends Ge{},_d=class{constructor(e={}){this.encryptionAlgorithm=new de,this.encryptedData=new N_,Object.assign(this,e)}};g([x({type:de})],_d.prototype,"encryptionAlgorithm",void 0);g([x({type:N_})],_d.prototype,"encryptedData",void 0);var Gk,aZ=function(r){return r[r.v1=0]="v1",r}(aZ||{}),O_=class extends Ge{},Wk=Gk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Gk.prototype)}};Wk=Gk=g([W({type:q.Sequence,itemType:Gn})],Wk);var Sd=class{constructor(e={}){this.version=aZ.v1,this.privateKeyAlgorithm=new de,this.privateKey=new O_,Object.assign(this,e)}};g([x({type:T.Integer})],Sd.prototype,"version",void 0);g([x({type:de})],Sd.prototype,"privateKeyAlgorithm",void 0);g([x({type:O_})],Sd.prototype,"privateKey",void 0);g([x({type:Wk,implicit:!0,context:0,optional:!0})],Sd.prototype,"attributes",void 0);var cZ=class extends Sd{};cZ=g([W({type:q.Sequence})],cZ);var lZ=class extends _d{};lZ=g([W({type:q.Sequence})],lZ);var L_=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],L_.prototype,"secretTypeId",void 0);g([x({type:T.Any,context:0})],L_.prototype,"secretValue",void 0);var Cd=class{constructor(e={}){this.mac=new uh,this.macSalt=new Ge,this.iterations=1,Object.assign(this,e)}};g([x({type:uh})],Cd.prototype,"mac",void 0);g([x({type:Ge})],Cd.prototype,"macSalt",void 0);g([x({type:T.Integer,defaultValue:1})],Cd.prototype,"iterations",void 0);var yh=class{constructor(e={}){this.version=3,this.authSafe=new Bs,this.macData=new Cd,Object.assign(this,e)}};g([x({type:T.Integer})],yh.prototype,"version",void 0);g([x({type:Bs})],yh.prototype,"authSafe",void 0);g([x({type:Cd,optional:!0})],yh.prototype,"macData",void 0);var Yk,T0=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:T.ObjectIdentifier})],T0.prototype,"bagId",void 0);g([x({type:T.Any,context:0})],T0.prototype,"bagValue",void 0);g([x({type:mh,repeated:"set",optional:!0})],T0.prototype,"bagAttributes",void 0);var uZ=Yk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Yk.prototype)}};uZ=Yk=g([W({type:q.Sequence,itemType:T0})],uZ);var Xk,Qk,Zk,Or="1.2.840.113549.1.9",KAt=`${Or}.0`,SZ=`${Or}.24`,dw=`${Or}.25`,CZ=`${Or}.26`,IZ=`${Or}.27`,GAt=`${SZ}.1`,WAt=`${SZ}.2`,YAt=`${Or}.1`,XAt=`${Or}.2`,QAt=`${Or}.3`,ZAt=`${Or}.4`,JAt=`${Or}.5`,eDt=`${Or}.6`,sR=`${Or}.7`,tDt=`${Or}.8`,rDt=`${Or}.9`,nDt=`${Or}.13`,U_=`${Or}.14`,oDt=`${Or}.15`,iDt=`${Or}.20`,sDt=`${Or}.21`;var aDt=`${dw}.1`,cDt=`${dw}.2`,lDt=`${dw}.3`,uDt=`${dw}.4`,dDt=`${dw}.5`,fw="1.3.6.1.5.5.7.9",fDt=`${fw}.1`,pDt=`${fw}.2`,hDt=`${fw}.3`,mDt=`${fw}.4`,gDt=`${fw}.5`,yDt=`${CZ}.1`,vDt=`${CZ}.2`,wDt=`${IZ}.1`,bDt=`${IZ}.2`,xDt=`${Or}.16`,EDt=`${Or}.22`,_Dt=`${Or}.23`,SDt=`${wk}.65`,F_=class extends on{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};g([x({type:T.IA5String})],F_.prototype,"ia5String",void 0);F_=g([W({type:q.Choice})],F_);var dZ=class extends Bs{};dZ=g([W({type:q.Sequence})],dZ);var fZ=class extends yh{};fZ=g([W({type:q.Sequence})],fZ);var pZ=class extends _d{};pZ=g([W({type:q.Sequence})],pZ);var Jk=class{constructor(e=""){this.value=e}toString(){return this.value}};g([x({type:T.IA5String})],Jk.prototype,"value",void 0);Jk=g([W({type:q.Choice})],Jk);var hZ=class extends F_{};hZ=g([W({type:q.Choice})],hZ);var mZ=class extends on{};mZ=g([W({type:q.Choice})],mZ);var eR=class{constructor(e=new Date){this.value=e}};g([x({type:T.GeneralizedTime})],eR.prototype,"value",void 0);eR=g([W({type:q.Choice})],eR);var gZ=class extends on{};gZ=g([W({type:q.Choice})],gZ);var tR=class{constructor(e="M"){this.value=e}toString(){return this.value}};g([x({type:T.PrintableString})],tR.prototype,"value",void 0);tR=g([W({type:q.Choice})],tR);var B_=class{constructor(e=""){this.value=e}toString(){return this.value}};g([x({type:T.PrintableString})],B_.prototype,"value",void 0);B_=g([W({type:q.Choice})],B_);var yZ=class extends B_{};yZ=g([W({type:q.Choice})],yZ);var vZ=class extends on{};vZ=g([W({type:q.Choice})],vZ);var rR=class{constructor(e=""){this.value=e}toString(){return this.value}};g([x({type:T.ObjectIdentifier})],rR.prototype,"value",void 0);rR=g([W({type:q.Choice})],rR);var wZ=class extends Nr{};wZ=g([W({type:q.Choice})],wZ);var nR=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};g([x({type:T.Integer})],nR.prototype,"value",void 0);nR=g([W({type:q.Choice})],nR);var bZ=class extends mi{};bZ=g([W({type:q.Sequence})],bZ);var uw=class extends on{};uw=g([W({type:q.Choice})],uw);var xZ=Xk=class extends Xi{constructor(e){super(e),Object.setPrototypeOf(this,Xk.prototype)}};xZ=Xk=g([W({type:q.Sequence})],xZ);var EZ=Qk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Qk.prototype)}};EZ=Qk=g([W({type:q.Set,itemType:Na})],EZ);var oR=class{constructor(e=""){this.value=e}toString(){return this.value}};g([x({type:T.BmpString})],oR.prototype,"value",void 0);oR=g([W({type:q.Choice})],oR);var iR=class extends de{};iR=g([W({type:q.Sequence})],iR);var _Z=Zk=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,Zk.prototype)}};_Z=Zk=g([W({type:q.Sequence,itemType:iR})],_Z);var aR,pw=aR=class extends Be{constructor(e){super(e),Object.setPrototypeOf(this,aR.prototype)}};pw=aR=g([W({type:q.Sequence,itemType:Gn})],pw);var Tc=class{constructor(e={}){this.version=0,this.subject=new Yt,this.subjectPKInfo=new Wn,this.attributes=new pw,Object.assign(this,e)}};g([x({type:T.Integer})],Tc.prototype,"version",void 0);g([x({type:Yt})],Tc.prototype,"subject",void 0);g([x({type:Wn})],Tc.prototype,"subjectPKInfo",void 0);g([x({type:pw,implicit:!0,context:0})],Tc.prototype,"attributes",void 0);var P0=class{constructor(e={}){this.certificationRequestInfo=new Tc,this.signatureAlgorithm=new de,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};g([x({type:Tc})],P0.prototype,"certificationRequestInfo",void 0);g([x({type:de})],P0.prototype,"signatureAlgorithm",void 0);g([x({type:T.BitString})],P0.prototype,"signature",void 0);var ww="crypto.algorithm",yR=class{getAlgorithms(){return mr.resolveAll(ww)}toAsnAlgorithm(e){v({},e);for(let t of this.getAlgorithms()){let n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let t=new de({algorithm:e.name});if("parameters"in e){let n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},M0="crypto.algorithmProvider";mr.registerSingleton(M0,yR);var $_,bi="1.3.36.3.3.2.8.1.1",AZ=`${bi}.1`,DZ=`${bi}.2`,TZ=`${bi}.3`,PZ=`${bi}.4`,MZ=`${bi}.5`,kZ=`${bi}.6`,RZ=`${bi}.7`,NZ=`${bi}.8`,OZ=`${bi}.9`,LZ=`${bi}.10`,FZ=`${bi}.11`,BZ=`${bi}.12`,UZ=`${bi}.13`,VZ=`${bi}.14`,jZ="brainpoolP160r1",HZ="brainpoolP160t1",$Z="brainpoolP192r1",zZ="brainpoolP192t1",qZ="brainpoolP224r1",KZ="brainpoolP224t1",GZ="brainpoolP256r1",WZ="brainpoolP256t1",YZ="brainpoolP320r1",XZ="brainpoolP320t1",QZ="brainpoolP384r1",ZZ="brainpoolP384t1",JZ="brainpoolP512r1",eJ="brainpoolP512t1",Er="ECDSA",mw=$_=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Er.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return BQ;case"sha-256":return UQ;case"sha-384":return VQ;case"sha-512":return jQ}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=Tk;break;case"K-256":t=$_.SECP256K1;break;case"P-384":t=Pk;break;case"P-521":t=Mk;break;case jZ:t=AZ;break;case HZ:t=DZ;break;case $Z:t=TZ;break;case zZ:t=PZ;break;case qZ:t=MZ;break;case KZ:t=kZ;break;case GZ:t=RZ;break;case WZ:t=NZ;break;case YZ:t=OZ;break;case XZ:t=LZ;break;case QZ:t=FZ;break;case ZZ:t=BZ;break;case JZ:t=UZ;break;case eJ:t=VZ;break}if(t)return new de({algorithm:oh,parameters:ve.serialize(new Ic({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case nw:return{name:Er,hash:{name:"SHA-1"}};case ow:return{name:Er,hash:{name:"SHA-256"}};case iw:return{name:Er,hash:{name:"SHA-384"}};case sw:return{name:Er,hash:{name:"SHA-512"}};case oh:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(ve.parse(e.parameters,Ic).namedCurve){case Tk:return{name:Er,namedCurve:"P-256"};case $_.SECP256K1:return{name:Er,namedCurve:"K-256"};case Pk:return{name:Er,namedCurve:"P-384"};case Mk:return{name:Er,namedCurve:"P-521"};case AZ:return{name:Er,namedCurve:jZ};case DZ:return{name:Er,namedCurve:HZ};case TZ:return{name:Er,namedCurve:$Z};case PZ:return{name:Er,namedCurve:zZ};case MZ:return{name:Er,namedCurve:qZ};case kZ:return{name:Er,namedCurve:KZ};case RZ:return{name:Er,namedCurve:GZ};case NZ:return{name:Er,namedCurve:WZ};case OZ:return{name:Er,namedCurve:YZ};case LZ:return{name:Er,namedCurve:XZ};case FZ:return{name:Er,namedCurve:QZ};case BZ:return{name:Er,namedCurve:ZZ};case UZ:return{name:Er,namedCurve:JZ};case VZ:return{name:Er,namedCurve:eJ}}}}return null}};mw.SECP256K1="1.3.132.0.10";mw=$_=g([Ed()],mw);mr.registerSingleton(ww,mw);var tJ=Symbol("name"),rJ=Symbol("value"),ir=(()=>{class r{constructor(t,n={},o=""){this[tJ]=t,this[rJ]=o;for(let i in n)this[i]=n[i]}}return r.NAME=tJ,r.VALUE=rJ,r})(),vR=class{static toTextObject(e){let t=new ir("Algorithm Identifier",{},Mc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case oh:{let n=new mw().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}},Mc=class{static toString(e){let t=this.items[e];return t||e}};Mc.items={[sh]:"sha1",[C_]:"sha224",[ah]:"sha256",[ch]:"sha384",[lh]:"sha512",[Ac]:"rsaEncryption",[b0]:"sha1WithRSAEncryption",[GQ]:"sha224WithRSAEncryption",[S_]:"sha256WithRSAEncryption",[x0]:"sha384WithRSAEncryption",[E0]:"sha512WithRSAEncryption",[oh]:"ecPublicKey",[nw]:"ecdsaWithSHA1",[__]:"ecdsaWithSHA224",[ow]:"ecdsaWithSHA256",[iw]:"ecdsaWithSHA384",[sw]:"ecdsaWithSHA512",[gQ]:"TLS WWW server authentication",[yQ]:"TLS WWW client authentication",[vQ]:"Code Signing",[wQ]:"E-mail Protection",[bQ]:"Time Stamping",[xQ]:"OCSP Signing",[LQ]:"Signed Data"};var q_=(()=>{class r{static serialize(t){return this.serializeObj(t).join(`
`)}static pad(t=0){return"".padStart(2*t," ")}static serializeObj(t,n=0){let o=[],i=this.pad(n++),s="",a=t[ir.VALUE];a&&(s=` ${a}`),o.push(`${i}${t[ir.NAME]}:${s}`),i=this.pad(n);for(let c in t){if(typeof c=="symbol")continue;let l=t[c],u=c?`${c}: `:"";if(typeof l=="string"||typeof l=="number"||typeof l=="boolean")o.push(`${i}${u}${l}`);else if(l instanceof Date)o.push(`${i}${u}${l.toUTCString()}`);else if(Array.isArray(l))for(let d of l)d[ir.NAME]=c,o.push(...this.serializeObj(d,n));else if(l instanceof ir)l[ir.NAME]=c,o.push(...this.serializeObj(l,n));else if(me.BufferSourceConverter.isBufferSource(l))c?(o.push(`${i}${u}`),o.push(...this.serializeBufferSource(l,n+1))):o.push(...this.serializeBufferSource(l,n));else if("toTextObject"in l){let d=l.toTextObject();d[ir.NAME]=c,o.push(...this.serializeObj(d,n))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return o}static serializeBufferSource(t,n=0){let o=this.pad(n),i=me.BufferSourceConverter.toUint8Array(t),s=[];for(let a=0;a<i.length;){let c=[];for(let l=0;l<16&&a<i.length;l++){l===8&&c.push("");let u=i[a++].toString(16).padStart(2,"0");c.push(u)}s.push(`${o}${c.join(" ")}`)}return s}static serializeAlgorithm(t){return this.algorithmSerializer.toTextObject(t)}}return r.oidSerializer=Mc,r.algorithmSerializer=vR,r})(),bw=(()=>{class r{constructor(...t){if(t.length===1){let n=t[0];this.rawData=ve.serialize(n),this.onInit(n)}else{let n=ve.parse(t[0],t[1]);this.rawData=me.BufferSourceConverter.toArrayBuffer(t[0]),this.onInit(n)}}equal(t){return t instanceof r?(0,me.isEqual)(t.rawData,this.rawData):!1}toString(t="text"){switch(t){case"asn":return ve.toString(this.rawData);case"text":return q_.serialize(this.toTextObject());case"hex":return me.Convert.ToHex(this.rawData);case"base64":return me.Convert.ToBase64(this.rawData);case"base64url":return me.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let t=this.toTextObjectEmpty();return t[""]=this.rawData,t}toTextObjectEmpty(t){return new ir(this.getTextName(),{},t)}}return r.NAME="ASN",r})(),Vs=class r extends bw{constructor(...e){let t;me.BufferSourceConverter.isBufferSource(e[0])?t=me.BufferSourceConverter.toArrayBuffer(e[0]):t=ve.serialize(new Yn({extnID:e[0],critical:e[1],extnValue:new Ge(me.BufferSourceConverter.toArrayBuffer(e[2]))})),super(t,Yn)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[ir.NAME]===r.NAME&&(e[ir.NAME]=Mc.toString(this.type)),e}},uJ,gw=class r{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[uJ]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(r.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(r.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=r.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(r.DEFAULT,e);return this}};uJ=Symbol.toStringTag;gw.DEFAULT="default";var Eo=new gw,jwe=/^[0-2](?:\.[1-9][0-9]*)+$/;function Hwe(r){return new RegExp(jwe).test(r)}var K_=class{constructor(e={}){this.items={};for(let t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return Hwe(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}},vi=new K_;vi.register("CN","2.5.4.3");vi.register("L","2.5.4.7");vi.register("ST","2.5.4.8");vi.register("O","2.5.4.10");vi.register("OU","2.5.4.11");vi.register("C","2.5.4.6");vi.register("DC","0.9.2342.19200300.100.1.25");vi.register("E","1.2.840.113549.1.9.1");vi.register("G","2.5.4.42");vi.register("I","2.5.4.43");vi.register("SN","2.5.4.4");vi.register("T","2.5.4.12");function $we(r,e){return`\\${me.Convert.ToHex(me.Convert.FromUtf8String(e)).toUpperCase()}`}function zwe(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,$we)}var Oa=class r{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new K_,this.asn=new Yt;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Yt?this.asn=e:me.BufferSourceConverter.isBufferSource(e)?this.asn=ve.parse(e,Yt):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||vi.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||vi.get(e)}toString(){return this.asn.map(e=>e.map(t=>{let n=this.getName(t.type)||t.type,o=t.value.anyValue?`#${me.Convert.ToHex(t.value.anyValue)}`:zwe(t.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${me.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(o)}return t}fromString(e){let t=new Yt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let l=o[3];s=this.getTypeOid(s);let u=this.createAttribute(s,a);i==="+"?t[t.length-1].push(u):t.push(new ad([u])),i=l}return t}fromJSON(e){let t=new Yt;for(let n of e){let o=new ad;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let l=this.createAttribute(s,c);o.push(l)}}t.push(o)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let n=new Bp({type:e});if(typeof t=="object")for(let o in t)switch(o){case"ia5String":n.value.ia5String=t[o];break;case"utf8String":n.value.utf8String=t[o];break;case"universalString":n.value.universalString=t[o];break;case"bmpString":n.value.bmpString=t[o];break;case"printableString":n.value.printableString=t[o];break}else if(t[0]==="#")n.value.anyValue=me.Convert.FromHex(t.slice(1));else{let o=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:r.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return ve.serialize(this.asn)}getThumbprint(...e){return f(this,null,function*(){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||Eo.get()):n=e[0]||Eo.get(),yield n.subtle.digest(o,this.toArrayBuffer())})}},dJ="Cannot initialize GeneralName from ASN.1 data.",nJ=`${dJ} Unsupported string format in use.`,qwe=`${dJ} Value doesn't match to GUID regular expression.`,oJ=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,iJ="1.3.6.1.4.1.311.25.1",sJ="1.3.6.1.4.1.311.20.2.3",cR="dns",lR="dn",uR="email",dR="ip",fR="url",pR="guid",hR="upn",V_="id",Pc=class extends bw{constructor(...e){let t;if(e.length===2)switch(e[0]){case lR:{let n=new Oa(e[1]).toArrayBuffer(),o=ve.parse(n,Yt);t=new Xe({directoryName:o});break}case cR:t=new Xe({dNSName:e[1]});break;case uR:t=new Xe({rfc822Name:e[1]});break;case pR:{let n=new RegExp(oJ,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?me.Convert.ToHex(new Uint8Array(me.Convert.FromHex(i)).reverse()):i).join("");t=new Xe({otherName:new cd({typeId:iJ,value:ve.serialize(new Ge(me.Convert.FromHex(o)))})});break}case dR:t=new Xe({iPAddress:e[1]});break;case V_:t=new Xe({registeredID:e[1]});break;case hR:{t=new Xe({otherName:new cd({typeId:sJ,value:ve.serialize(HM.toASN(e[1]))})});break}case fR:t=new Xe({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else me.BufferSourceConverter.isBufferSource(e[0])?t=ve.parse(e[0],Xe):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=cR,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=uR,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=dR,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=fR,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=V_,this.value=e.registeredID;else if(e.directoryName!=null)this.type=lR,this.value=new Oa(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===iJ){this.type=pR;let t=ve.parse(e.otherName.value,Ge),n=new RegExp(oJ,"i").exec(me.Convert.ToHex(t));if(!n)throw new Error(qwe);this.value=n.slice(1).map((o,i)=>i<3?me.Convert.ToHex(new Uint8Array(me.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===sJ)this.type=hR,this.value=ve.parse(e.otherName.value,on).toString();else throw new Error(nJ);else throw new Error(nJ)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case lR:case cR:case pR:case dR:case V_:case hR:case fR:e=this.type.toUpperCase();break;case uR:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===V_&&(t=Mc.toString(t)),new ir(e,void 0,t)}},G_=(()=>{class r extends bw{constructor(t){let n;if(t instanceof hr)n=t;else if(Array.isArray(t)){let o=[];for(let i of t)if(i instanceof Xe)o.push(i);else{let s=ve.parse(new Pc(i.type,i.value).rawData,Xe);o.push(s)}n=new hr(o)}else if(me.BufferSourceConverter.isBufferSource(t))n=ve.parse(t,hr);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(n)}onInit(t){let n=[];for(let o of t){let i=null;try{i=new Pc(o)}catch{continue}n.push(i)}this.items=n}toJSON(){return this.items.map(t=>t.toJSON())}toTextObject(){let t=super.toTextObjectEmpty();for(let n of this.items){let o=n.toTextObject(),i=t[o[ir.NAME]];Array.isArray(i)||(i=[],t[o[ir.NAME]]=i),i.push(o)}return t}}return r.NAME="GeneralNames",r})(),hw="-{5}",yw="\\n",Kwe=`[^${yw}]+`,Gwe=`${hw}BEGIN (${Kwe}(?=${hw}))${hw}`,Wwe=`${hw}END \\1${hw}`,k0="\\n",Ywe=`[^:${yw}]+`,Xwe=`(?:[^${yw}]+${k0}(?: +[^${yw}]+${k0})*)`,Qwe="[a-zA-Z0-9=+/]+",Zwe=`(?:${Qwe}${k0})+`,aJ=`${Gwe}${k0}(?:((?:${Ywe}: ${Xwe})+))?${k0}?(${Zwe})${Wwe}`,vh=(()=>{class r{static isPem(t){return typeof t=="string"&&new RegExp(aJ,"g").test(t.replace(/\r/g,""))}static decodeWithHeaders(t){t=t.replace(/\r/g,"");let n=new RegExp(aJ,"g"),o=[],i=null;for(;i=n.exec(t);){let s=i[3].replace(new RegExp(`[${yw}]+`,"g"),""),a={type:i[1],headers:[],rawData:me.Convert.FromBase64(s)},c=i[2];if(c){let l=c.split(new RegExp(k0,"g")),u=null;for(let d of l){let[h,p]=d.split(/:(.*)/);if(p===void 0){if(!u)throw new Error("Cannot parse PEM string. Incorrect header value");u.value+=h.trim()}else u&&a.headers.push(u),u={key:h,value:p.trim()}}u&&a.headers.push(u)}o.push(a)}return o}static decode(t){return this.decodeWithHeaders(t).map(o=>o.rawData)}static decodeFirst(t){let n=this.decode(t);if(!n.length)throw new RangeError("PEM string doesn't contain any objects");return n[0]}static encode(t,n){if(Array.isArray(t)){let o=new Array;return n?t.forEach(i=>{if(!me.BufferSourceConverter.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");o.push(this.encodeStruct({type:n,rawData:me.BufferSourceConverter.toArrayBuffer(i)}))}):t.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");o.push(this.encodeStruct(i))}),o.join(`
`)}else{if(!n)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:n,rawData:me.BufferSourceConverter.toArrayBuffer(t)})}}static encodeStruct(t){var n;let o=t.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${o}-----`),!((n=t.headers)===null||n===void 0)&&n.length){for(let u of t.headers)i.push(`${u.key}: ${u.value}`);i.push("")}let s=me.Convert.ToBase64(t.rawData),a,c=0,l=Array();for(;c<s.length&&(s.length-c<64?a=s.substring(c):(a=s.substring(c,c+64),c+=64),a.length!==0);)if(l.push(a),a.length<64)break;return i.push(...l),i.push(`-----END ${o}-----`),i.join(`
`)}}return r.CertificateTag="CERTIFICATE",r.CrlTag="CRL",r.CertificateRequestTag="CERTIFICATE REQUEST",r.PublicKeyTag="PUBLIC KEY",r.PrivateKeyTag="PRIVATE KEY",r})(),R0=class r extends bw{static isAsnEncoded(e){return me.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(vh.isPem(e))return vh.decode(e)[0];if(me.Convert.isHex(e))return me.Convert.FromHex(e);if(me.Convert.isBase64(e))return me.Convert.FromBase64(e);if(me.Convert.isBase64Url(e))return me.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let t=me.Convert.ToBinary(e);return vh.isPem(t)?vh.decode(t)[0]:me.Convert.isHex(t)?me.Convert.FromHex(t):me.Convert.isBase64(t)?me.Convert.FromBase64(t):me.Convert.isBase64Url(t)?me.Convert.FromBase64Url(t):me.BufferSourceConverter.toArrayBuffer(e)}}constructor(...e){r.isAsnEncoded(e[0])?super(r.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return vh.encode(this.rawData,this.tag);default:return super.toString(e)}}},Id=class r extends R0{static create(n){return f(this,arguments,function*(e,t=Eo.get()){if(e instanceof r)return e;if(gw.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let o=yield t.subtle.exportKey("spki",e);return new r(o)}else{if(e.publicKey)return e.publicKey;if(me.BufferSourceConverter.isBufferSource(e))return new r(e);throw new TypeError("Unsupported PublicKeyType")}})}constructor(e){R0.isAsnEncoded(e)?super(e,Wn):super(e),this.tag=vh.PublicKeyTag}export(...e){return f(this,null,function*(){let t,n=["verify"],o=v({hash:"SHA-256"},this.algorithm);e.length>1?(o=e[0]||o,n=e[1]||n,t=e[2]||Eo.get()):t=e[0]||Eo.get();let i=this.rawData,s=ve.parse(this.rawData,Wn);return s.algorithm.algorithm===wd&&(i=Jwe(s,i)),t.subtle.importKey("spki",i,o,!0,n)})}onInit(e){let t=mr.resolve(M0),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Ac:{let o=ve.parse(e.subjectPublicKey,C0),i=me.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=me.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}getThumbprint(...e){return f(this,null,function*(){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||Eo.get()):n=e[0]||Eo.get(),yield n.subtle.digest(o,this.rawData)})}getKeyIdentifier(...e){return f(this,null,function*(){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=Eo.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=Eo.get();let o=ve.parse(this.rawData,Wn);return yield t.subtle.digest(n,o.subjectPublicKey)})}toTextObject(){let e=this.toTextObjectEmpty(),t=ve.parse(this.rawData,Wn);switch(e.Algorithm=q_.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case oh:e["EC Point"]=t.subjectPublicKey;break;case Ac:default:e["Raw Data"]=t.subjectPublicKey}return e}};function Jwe(r,e){return r.algorithm=new de({algorithm:Ac,parameters:null}),e=ve.serialize(r),e}var ebe=(()=>{class r extends Vs{static create(i){return f(this,arguments,function*(t,n=!1,o=Eo.get()){if("name"in t&&"serialNumber"in t)return new r(t,n);let a=yield(yield Id.create(t,o)).getKeyIdentifier(o);return new r(me.Convert.ToHex(a),n)})}constructor(...t){if(me.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(typeof t[0]=="string"){let n=new xc({keyIdentifier:new jp(me.Convert.FromHex(t[0]))});super(J8,t[1],ve.serialize(n))}else{let n=t[0],o=n.name instanceof G_?ve.parse(n.name.rawData,hr):n.name,i=new xc({authorityCertIssuer:o,authorityCertSerialNumber:me.Convert.FromHex(n.serialNumber)});super(J8,t[1],ve.serialize(i))}}onInit(t){super.onInit(t);let n=ve.parse(t.extnValue,xc);n.keyIdentifier&&(this.keyId=me.Convert.ToHex(n.keyIdentifier)),(n.authorityCertIssuer||n.authorityCertSerialNumber)&&(this.certId={name:n.authorityCertIssuer||[],serialNumber:n.authorityCertSerialNumber?me.Convert.ToHex(n.authorityCertSerialNumber):""})}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ve.parse(this.value,xc);return n.authorityCertIssuer&&(t["Authority Issuer"]=new G_(n.authorityCertIssuer).toTextObject()),n.authorityCertSerialNumber&&(t["Authority Serial Number"]=n.authorityCertSerialNumber),n.keyIdentifier&&(t[""]=n.keyIdentifier),t}}return r.NAME="Authority Key Identifier",r})(),_R=(()=>{class r extends Vs{constructor(...t){if(me.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ve.parse(this.value,Hp);this.ca=n.cA,this.pathLength=n.pathLenConstraint}else{let n=new Hp({cA:t[0],pathLenConstraint:t[1]});super(e_,t[2],ve.serialize(n)),this.ca=t[0],this.pathLength=t[1]}}toTextObject(){let t=this.toTextObjectWithoutValue();return this.ca&&(t.CA=this.ca),this.pathLength!==void 0&&(t["Path Length"]=this.pathLength),t}}return r.NAME="Basic Constraints",r})();var tbe=(()=>{class r extends Vs{constructor(...t){if(me.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ve.parse(this.value,Vv);this.usages=n.map(o=>o)}else{let n=new Vv(t[0]);super(i_,t[1],ve.serialize(n)),this.usages=t[0]}}toTextObject(){let t=this.toTextObjectWithoutValue();return t[""]=this.usages.map(n=>Mc.toString(n)).join(", "),t}}return r.NAME="Extended Key Usages",r})();var rbe=(()=>{class r extends Vs{constructor(...t){if(me.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ve.parse(this.value,n0);this.usages=n.toNumber()}else{let n=new n0(t[0]);super(s_,t[1],ve.serialize(n)),this.usages=t[0]}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ve.parse(this.value,n0);return t[""]=n.toJSON().join(", "),t}}return r.NAME="Key Usages",r})(),nbe=(()=>{class r extends Vs{static create(i){return f(this,arguments,function*(t,n=!1,o=Eo.get()){let a=yield(yield Id.create(t,o)).getKeyIdentifier(o);return new r(me.Convert.ToHex(a),n)})}constructor(...t){if(me.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ve.parse(this.value,pi);this.keyId=me.Convert.ToHex(n)}else{let n=typeof t[0]=="string"?me.Convert.FromHex(t[0]):t[0],o=new pi(n);super(hk,t[1],ve.serialize(o)),this.keyId=me.Convert.ToHex(n)}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ve.parse(this.value,pi);return t[""]=n,t}}return r.NAME="Subject Key Identifier",r})(),obe=(()=>{class r extends Vs{constructor(...t){me.BufferSourceConverter.isBufferSource(t[0])?super(t[0]):super(fk,t[1],new G_(t[0]||[]).rawData)}onInit(t){super.onInit(t);let n=ve.parse(t.extnValue,u_);this.names=new G_(n)}toTextObject(){let t=this.toTextObjectWithoutValue(),n=this.names.toTextObject();for(let o in n)t[o]=n[o];return t}}return r.NAME="Subject Alternative Name",r})(),wi=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new Vs(e),n=this.items.get(t.type);return n?new n(e):t}};wi.items=new Map;var ibe=(()=>{class r extends Vs{constructor(...t){var n;if(me.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let o=ve.parse(this.value,Lv);this.policies=o.map(i=>i.policyIdentifier)}else{let o=t[0],i=(n=t[1])!==null&&n!==void 0?n:!1,s=new Lv(o.map(a=>new $p({policyIdentifier:a})));super(r_,i,ve.serialize(s)),this.policies=o}}toTextObject(){let t=this.toTextObjectWithoutValue();return t.Policy=this.policies.map(n=>new ir("",{},Mc.toString(n))),t}}return r.NAME="Certificate Policies",r})();wi.register(r_,ibe);var sbe=(()=>{class r extends Vs{constructor(...t){var n;if(me.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(Array.isArray(t[0])&&typeof t[0][0]=="string"){let i=t[0].map(a=>new _c({distributionPoint:new Fl({fullName:[new Xe({uniformResourceIdentifier:a})]})})),s=new dd(i);super(n_,t[1],ve.serialize(s))}else{let o=new dd(t[0]);super(n_,t[1],ve.serialize(o))}(n=this.distributionPoints)!==null&&n!==void 0||(this.distributionPoints=[])}onInit(t){super.onInit(t);let n=ve.parse(t.extnValue,dd);this.distributionPoints=n}toTextObject(){let t=this.toTextObjectWithoutValue();return t["Distribution Point"]=this.distributionPoints.map(n=>{var o;let i={};return n.distributionPoint&&(i[""]=(o=n.distributionPoint.fullName)===null||o===void 0?void 0:o.map(s=>new Pc(s).toString()).join(", ")),n.reasons&&(i.Reasons=n.reasons.toString()),n.cRLIssuer&&(i["CRL Issuer"]=n.cRLIssuer.map(s=>s.toString()).join(", ")),i}),t}}return r.NAME="CRL Distribution Points",r})(),abe=(()=>{class r extends Vs{constructor(...t){var n,o,i,s;if(me.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(t[0]instanceof Vp){let a=new Vp(t[0]);super(Z8,t[1],ve.serialize(a))}else{let a=t[0],c=new Vp;H_(c,a,XM,"ocsp"),H_(c,a,QM,"caIssuers"),H_(c,a,ZM,"timeStamping"),H_(c,a,JM,"caRepository"),super(Z8,t[1],ve.serialize(c))}(n=this.ocsp)!==null&&n!==void 0||(this.ocsp=[]),(o=this.caIssuers)!==null&&o!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(t){super.onInit(t),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],ve.parse(t.extnValue,Vp).forEach(o=>{switch(o.accessMethod){case XM:this.ocsp.push(new Pc(o.accessLocation));break;case QM:this.caIssuers.push(new Pc(o.accessLocation));break;case ZM:this.timeStamping.push(new Pc(o.accessLocation));break;case JM:this.caRepository.push(new Pc(o.accessLocation));break}})}toTextObject(){let t=this.toTextObjectWithoutValue();return this.ocsp.length&&j_(t,"OCSP",this.ocsp),this.caIssuers.length&&j_(t,"CA Issuers",this.caIssuers),this.timeStamping.length&&j_(t,"Time Stamping",this.timeStamping),this.caRepository.length&&j_(t,"CA Repository",this.caRepository),t}}return r.NAME="Authority Info Access",r})();function j_(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{let n=new ir("");t.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[ir.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),r[e]=n}}function H_(r,e,t,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new Pc("url",s)),r.push(new Ol({accessMethod:t,accessLocation:ve.parse(s.rawData,Xe)}))})}var SR=(()=>{class r extends bw{constructor(...t){let n;if(me.BufferSourceConverter.isBufferSource(t[0]))n=me.BufferSourceConverter.toArrayBuffer(t[0]);else{let o=t[0],i=Array.isArray(t[1])?t[1].map(s=>me.BufferSourceConverter.toArrayBuffer(s)):[];n=ve.serialize(new Gn({type:o,values:i}))}super(n,Gn)}onInit(t){this.type=t.type,this.values=t.values}toTextObject(){let t=this.toTextObjectWithoutValue();return t.Value=this.values.map(n=>new ir("",{"":n})),t}toTextObjectWithoutValue(){let t=this.toTextObjectEmpty();return t[ir.NAME]===r.NAME&&(t[ir.NAME]=Mc.toString(this.type)),t}}return r.NAME="Attribute",r})(),cbe=(()=>{class r extends SR{constructor(...t){var n;if(me.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else{let o=new uw({printableString:t[0]});super(sR,[ve.serialize(o)])}(n=this.password)!==null&&n!==void 0||(this.password="")}onInit(t){if(super.onInit(t),this.values[0]){let n=ve.parse(this.values[0],uw);this.password=n.toString()}}toTextObject(){let t=this.toTextObjectWithoutValue();return t[ir.VALUE]=this.password,t}}return r.NAME="Challenge Password",r})(),lbe=(()=>{class r extends SR{constructor(...t){var n;if(me.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else{let o=t[0],i=new Xi;for(let s of o)i.push(ve.parse(s.rawData,Yn));super(U_,[ve.serialize(i)])}(n=this.items)!==null&&n!==void 0||(this.items=[])}onInit(t){if(super.onInit(t),this.values[0]){let n=ve.parse(this.values[0],Xi);this.items=n.map(o=>wi.create(ve.serialize(o)))}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=this.items.map(o=>o.toTextObject());for(let o of n)t[o[ir.NAME]]=o;return t}}return r.NAME="Extensions",r})(),vw=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new SR(e),n=this.items.get(t.type);return n?new n(e):t}};vw.items=new Map;var Y_="crypto.signatureFormatter",wR=class{toAsnSignature(e,t){return me.BufferSourceConverter.toArrayBuffer(t)}toWebSignature(e,t){return me.BufferSourceConverter.toArrayBuffer(t)}},z_,bR=z_=class{static createPssParams(e,t){let n=z_.getHashAlgorithm(e);return n?new Dc({hashAlgorithm:n,maskGenAlgorithm:new de({algorithm:bd,parameters:ve.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){let t=mr.resolve(M0);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new de({algorithm:b0,parameters:null});case"sha-256":return new de({algorithm:S_,parameters:null});case"sha-384":return new de({algorithm:x0,parameters:null});case"sha-512":return new de({algorithm:E0,parameters:null})}}else return new de({algorithm:Ac,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let t=z_.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new de({algorithm:wd,parameters:ve.serialize(t)})}else return new de({algorithm:wd,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Ac:return{name:"RSASSA-PKCS1-v1_5"};case b0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case S_:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case x0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case E0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case wd:if(e.parameters){let t=ve.parse(e.parameters,Dc);return{name:"RSA-PSS",hash:mr.resolve(M0).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};bR=z_=g([Ed()],bR);mr.registerSingleton(ww,bR);var xR=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new de({algorithm:sh});case"sha-256":return new de({algorithm:ah});case"sha-384":return new de({algorithm:ch});case"sha-512":return new de({algorithm:lh})}return null}toWebAlgorithm(e){switch(e.algorithm){case sh:return{name:"SHA-1"};case ah:return{name:"SHA-256"};case ch:return{name:"SHA-384"};case lh:return{name:"SHA-512"}}return null}};xR=g([Ed()],xR);mr.registerSingleton(ww,xR);var $l=class r{addPadding(e,t){let n=me.BufferSourceConverter.toUint8Array(t),o=new Uint8Array(e);return o.set(n,e-n.length),o}removePadding(e,t=!1){let n=me.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(t&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){let n=e.namedCurve,o=r.namedCurveSize.get(n)||r.defaultNamedCurveSize,i=new ih,s=me.BufferSourceConverter.toUint8Array(t);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),ve.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){let n=ve.parse(t,ih),o=e.namedCurve,i=r.namedCurveSize.get(o)||r.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return(0,me.combine)(s,a)}return null}};$l.namedCurveSize=new Map;$l.defaultNamedCurveSize=32;var mR="1.3.101.110",cJ="1.3.101.111",gR="1.3.101.112",lJ="1.3.101.113",ER=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=gR;break;case"x25519":t=mR;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=gR;break;case"ed448":t=lJ;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=mR;break;case"x448":t=cJ;break}}return t?new de({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case gR:return{name:"Ed25519"};case lJ:return{name:"EdDSA",namedCurve:"Ed448"};case mR:return{name:"X25519"};case cJ:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};ER=g([Ed()],ER);mr.registerSingleton(ww,ER);var CR=(()=>{class r extends R0{constructor(t){R0.isAsnEncoded(t)?super(t,Os):super(t),this.tag=vh.CertificateTag}onInit(t){let n=t.tbsCertificate;this.tbs=ve.serialize(n);let o=new Uint8Array(n.serialNumber);o.length>1&&o[0]===0&&o[1]>127&&(o=o.slice(1)),this.serialNumber=me.Convert.ToHex(o),this.subjectName=new Oa(n.subject),this.subject=new Oa(n.subject).toString(),this.issuerName=new Oa(n.issuer),this.issuer=this.issuerName.toString();let i=mr.resolve(M0);this.signatureAlgorithm=i.toWebAlgorithm(t.signatureAlgorithm),this.signature=t.signatureValue;let s=n.validity.notBefore.utcTime||n.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;let a=n.validity.notAfter.utcTime||n.validity.notAfter.generalTime;if(!a)throw new Error("Cannot get 'notAfter' value");this.notAfter=a,this.extensions=[],n.extensions&&(this.extensions=n.extensions.map(c=>wi.create(ve.serialize(c)))),this.publicKey=new Id(n.subjectPublicKeyInfo)}getExtension(t){for(let n of this.extensions)if(typeof t=="string"){if(n.type===t)return n}else if(n instanceof t)return n;return null}getExtensions(t){return this.extensions.filter(n=>typeof t=="string"?n.type===t:n instanceof t)}verify(){return f(this,arguments,function*(t={},n=Eo.get()){let o,i,s=t.publicKey;try{if(!s)o=v(v({},this.publicKey.algorithm),this.signatureAlgorithm),i=yield this.publicKey.export(o,["verify"],n);else if("publicKey"in s)o=v(v({},s.publicKey.algorithm),this.signatureAlgorithm),i=yield s.publicKey.export(o,["verify"],n);else if(s instanceof Id)o=v(v({},s.algorithm),this.signatureAlgorithm),i=yield s.export(o,["verify"],n);else if(me.BufferSourceConverter.isBufferSource(s)){let u=new Id(s);o=v(v({},u.algorithm),this.signatureAlgorithm),i=yield u.export(o,["verify"],n)}else o=v(v({},s.algorithm),this.signatureAlgorithm),i=s}catch{return!1}let a=mr.resolveAll(Y_).reverse(),c=null;for(let u of a)if(c=u.toWebSignature(o,this.signature),c)break;if(!c)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let l=yield n.subtle.verify(this.signatureAlgorithm,i,c,this.tbs);if(t.signatureOnly)return l;{let d=(t.date||new Date).getTime();return l&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}})}getThumbprint(...t){return f(this,null,function*(){let n,o="SHA-1";return t[0]&&(t[0].subtle?n=t[0]:(o=t[0]||o,n=t[1])),n??(n=Eo.get()),yield n.subtle.digest(o,this.rawData)})}isSelfSigned(){return f(this,arguments,function*(t=Eo.get()){return this.subject===this.issuer&&(yield this.verify({signatureOnly:!0},t))})}toTextObject(){let t=this.toTextObjectEmpty(),n=ve.parse(this.rawData,Os),o=n.tbsCertificate,i=new ir("",{Version:`${fd[o.version]} (${o.version})`,"Serial Number":o.serialNumber,"Signature Algorithm":q_.serializeAlgorithm(o.signature),Issuer:this.issuer,Validity:new ir("",{"Not Before":o.validity.notBefore.getTime(),"Not After":o.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(o.issuerUniqueID&&(i["Issuer Unique ID"]=o.issuerUniqueID),o.subjectUniqueID&&(i["Subject Unique ID"]=o.subjectUniqueID),this.extensions.length){let s=new ir("");for(let a of this.extensions){let c=a.toTextObject();s[c[ir.NAME]]=c}i.Extensions=s}return t.Data=i,t.Signature=new ir("",{Algorithm:q_.serializeAlgorithm(n.signatureAlgorithm),"":n.signatureValue}),t}}return r.NAME="Certificate",r})();var W_=class{static createSelfSigned(n){return f(this,arguments,function*(e,t=Eo.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)})}static create(n){return f(this,arguments,function*(e,t=Eo.get()){var o;let i;e.publicKey instanceof Id?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:me.BufferSourceConverter.isBufferSource(e.publicKey)?i=e.publicKey:i=yield t.subtle.exportKey("spki",e.publicKey);let s=e.serialNumber?me.BufferSourceConverter.toUint8Array(me.Convert.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));if(s[0]>127){let S=new Uint8Array(s.length+1);S[0]=0,S.set(s,1),s=S}let a=e.notBefore||new Date,c=e.notAfter||new Date(a.getTime()+31536e6),l=new Os({tbsCertificate:new Xn({version:fd.v3,serialNumber:s,validity:new Bl({notBefore:a,notAfter:c}),extensions:new Xi(((o=e.extensions)===null||o===void 0?void 0:o.map(S=>ve.parse(S.rawData,Yn)))||[]),subjectPublicKeyInfo:ve.parse(i,Wn)})});if(e.subject){let S=e.subject instanceof Oa?e.subject:new Oa(e.subject);l.tbsCertificate.subject=ve.parse(S.toArrayBuffer(),Yt)}if(e.issuer){let S=e.issuer instanceof Oa?e.issuer:new Oa(e.issuer);l.tbsCertificate.issuer=ve.parse(S.toArrayBuffer(),Yt)}let u={hash:"SHA-256"},d="signingKey"in e?v(v(v({},u),e.signingAlgorithm),e.signingKey.algorithm):v(v({},u),e.signingAlgorithm),h=mr.resolve(M0);l.tbsCertificate.signature=l.signatureAlgorithm=h.toAsnAlgorithm(d);let p=ve.serialize(l.tbsCertificate),m="signingKey"in e?yield t.subtle.sign(d,e.signingKey,p):e.signature,w=mr.resolveAll(Y_).reverse(),E=null;for(let S of w)if(E=S.toAsnSignature(d,m),E)break;if(!E)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return l.signatureValue=E,new CR(ve.serialize(l))})}};wi.register(e_,_R);wi.register(i_,tbe);wi.register(s_,rbe);wi.register(hk,nbe);wi.register(J8,ebe);wi.register(fk,obe);wi.register(n_,sbe);wi.register(Z8,abe);vw.register(sR,cbe);vw.register(U_,lbe);mr.registerSingleton(Y_,wR);mr.registerSingleton(Y_,$l);$l.namedCurveSize.set("P-256",32);$l.namedCurveSize.set("K-256",32);$l.namedCurveSize.set("P-384",48);$l.namedCurveSize.set("P-521",66);var X_=class extends st{listen(){return f(this,null,function*(){throw new z8("WebRTCTransport.createListener")})}getAddrs(){return[]}updateAnnounceAddrs(){}close(){return f(this,null,function*(){})}};var IR=Object.values(xf).map(r=>r.decoder).reduce((r,e)=>r.or(e)),ube=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function fJ(r){return r?.match(ube)?.groups?.fingerprint}function AR(r){let t=r.stringTuples().filter(n=>n[0]===LX).map(n=>n[1])[0];if(t===void 0||t==="")throw new Q(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function dbe(r){return Cr.decode(IR.decode(r))}function fbe(r){let e=dbe(AR(r)),t=pbe(e.code),n=e.digest.reduce((i,s)=>i+s.toString(16).padStart(2,"0"),""),o=n.match(/.{1,2}/g);if(o==null)throw new $8(n,r.toString());return`${t} ${o.join(":").toUpperCase()}`}function pJ(r){let e=r.split(":").map(o=>parseInt(o,16)),t=Uint8Array.from(e),n=Ei(xt.code,t);return Ee(`/certhash/${sl.encode(n.bytes)}`)}function pbe(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new q8(r)}}function hJ(r,e){let{host:t,port:n,family:o}=r.toOptions(),i=fbe(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${o} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Zg}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function mJ(r,e){let{host:t,port:n,family:o}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
c=IN IP${o} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Zg}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function DR(r,e){if(r.sdp===void 0)throw new Q("Can't munge a missing SDP");let t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}var TR=ee("libp2p-webrtc-noise:");function yJ(r,e,t){let n=r.trim().toLowerCase().replaceAll(":",""),o=ee(n,"hex"),i=Ei(xt.code,o),s=IR.decode(AR(e)),a=TR.byteLength+i.bytes.byteLength+s.byteLength;return t==="server"?Gt([TR,s,i.bytes],a):Gt([TR,i.bytes,s],a)}var hbe=Av?"iceconnectionstatechange":"connectionstatechange";function vJ(r,e,t){return f(this,null,function*(){let n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");let d=yield r.createOffer();t.log.trace("client created local offer %s",d.sdp);let h=DR(d,e);t.log.trace("client setting local offer %s",h.sdp),yield r.setLocalDescription(h);let p=hJ(t.remoteAddr,e);t.log.trace("client setting server description %s",p.sdp),yield r.setRemoteDescription(p)}else{let d=mJ(t.remoteAddr,e);t.log.trace("server setting client %s %s",d.type,d.sdp),yield r.setRemoteDescription(d),t.log.trace("server creating local answer");let h=yield r.createAnswer();t.log.trace("server created local answer");let p=DR(h,e);t.log.trace("server setting local description %s",h.sdp),yield r.setLocalDescription(p)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),yield Mr(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){let d=r.remoteFingerprint()?.value??"";t.remoteAddr=t.remoteAddr.encapsulate(pJ(d))}let o=fJ(r.localDescription?.sdp);if(o==null)throw new sd("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);let i=yJ(o,t.remoteAddr,t.role),s=T5({prologueBytes:i})(t),a=Jg(v({channel:n,direction:"outbound",handshake:!0,logger:t.logger},t.dataChannel??{})),c=new Fp(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(hbe,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":c.close().catch(d=>{t.log.error("error closing connection",d),c.abort(d)});break;default:break}}),t.events?.increment({peer_connection:!0});let l=new id(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),yield s.secureInbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),yield t.upgrader.upgradeOutbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal});t.log.trace("%s secure outbound",t.role);let u=yield s.secureOutbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});c.remoteAddr=c.remoteAddr.encapsulate(`/p2p/${u.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),yield t.upgrader.upgradeInbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal})}catch(o){throw n.close(),o}})}function wJ(r,e,t,n){return f(this,null,function*(){n==null&&(n=yield RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));let o=typeof t=="function"?yield t():t;return new RTCPeerConnection(I(v({},o??{}),{certificates:[n]}))})}function bJ(r){return f(this,null,function*(){let e=yield SE(r),t=yield crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...ne(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)})}var Q_=class{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new st,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Q("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[_u]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[Pt]=["@libp2p/transport"];start(){return f(this,null,function*(){this.certificate=yield this.getCertificate()})}stop(){return f(this,null,function*(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0})}dial(e,t){return f(this,null,function*(){this.log("dial %a",e),t.signal.throwIfAborted();let n,o=e.getPeerId();o!=null&&(n=lr(o));let i=JX(),s=yield wJ("client",i,typeof this.init.rtcConfiguration=="function"?yield this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return yield vJ(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(a){throw s.close(),a}})}createListener(e){if(this.certificate==null)throw new na;return new X_(this.components,I(v(v({},this.init),e),{certificate:this.certificate,emitter:this.emitter}))}listenFilter(e){return e.filter(O2.exactMatch)}dialFilter(e){return this.listenFilter(e)}getCertificate(e){return f(this,null,function*(){if(mbe(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=yield this.loadOrCreatePrivateKey(),{pem:n,certhash:o}=yield this.loadOrCreateCertificate(t,e);return{privateKey:yield bJ(t),pem:n,certhash:o}})}loadOrCreatePrivateKey(){return f(this,null,function*(){if(this.privateKey!=null)return this.privateKey;let e=this.init.certificateKeychainName??zX,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Ot;this.log.trace("checking for stored private key"),this.privateKey=yield t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=yield lg("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),yield t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey})}loadOrCreateCertificate(e,t){return f(this,null,function*(){if(this.certificate!=null&&t!==!0)return this.certificate;let n,o=new Ut(this.init.certificateDatastoreKey??$X),i=yield SE(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Ot;this.log.trace("checking for stored TLS certificate"),n=yield this.loadCertificate(o,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=yield this.createCertificate(o,i)}let s=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??LM)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},s),{pem:n.toString("pem"),certhash:sl.encode((yield xt.digest(new Uint8Array(n.rawData))).bytes)}})}loadCertificate(e,t){return f(this,null,function*(){let n=yield this.components.datastore.get(e),o=new CR(n),i=o.notAfter.getTime()-(this.init.certificateRenewalThreshold??LM);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new Ot;this.log("loaded certificate, expires in %d ms",i);let s=yield o.publicKey.export(crypto),a=yield crypto.subtle.exportKey("raw",s),c=yield crypto.subtle.exportKey("raw",t.publicKey);if(!Le(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Ot;return this.log("loaded certificate, expiry time is %o",i),o})}createCertificate(e,t){return f(this,null,function*(){let n=new Date,o=new Date(Date.now()+(this.init.certificateLifespan??qX));n.setMilliseconds(0),o.setMilliseconds(0);let i=yield W_.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:o,keys:t,extensions:[new _R(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),yield this.components.datastore.put(e,ee(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i})}getKeychain(){try{return this.components.keychain}catch{}}};function mbe(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function xJ(r){return e=>new Q_(e,r)}function EJ(r){return e=>new Y8(e,r)}var _J=r=>f(null,null,function*(){if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&(yield new Promise((e,t)=>{function n(){r.removeEventListener("open",o),r.removeEventListener("error",i)}function o(){n(),e()}function i(s){n(),t(s.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",o),r.addEventListener("error",i)}))});var SJ=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,n=>f(null,null,function*(){try{for(var o=O(n),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;try{yield _J(r)}catch(l){if(l.message==="socket closed")break;throw l}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}e.closeOnEnd!=null&&r.readyState<=1&&(yield new Promise((c,l)=>{r.addEventListener("close",u=>{if(u.wasClean||u.code===1006)c();else{let d=Object.assign(new Error("ws error"),{event:u});l(d)}}),setTimeout(()=>{r.close()})}))}));var DJ=_r(IJ(),1);function AJ(r){return r instanceof ArrayBuffer||r?.constructor?.name==="ArrayBuffer"&&typeof r?.byteLength=="number"}var TJ=r=>{r.binaryType="arraybuffer";let e=()=>f(null,null,function*(){yield new Promise((i,s)=>{if(n){i();return}if(o!=null){s(o);return}let a=u=>{r.removeEventListener("open",c),r.removeEventListener("error",l),u()},c=()=>{a(i)},l=u=>{a(()=>{s(u.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})}),t=function(){return k(this,null,function*(){let i=new DJ.EventIterator(({push:u,stop:d,fail:h})=>{let p=w=>{let E=null;typeof w.data=="string"&&(E=ee(w.data)),AJ(w.data)&&(E=new Uint8Array(w.data)),w.data instanceof Uint8Array&&(E=w.data),E!=null&&u(E)},m=w=>{h(w.error??new Error("Socket error"))};return r.addEventListener("message",p),r.addEventListener("error",m),r.addEventListener("close",d),()=>{r.removeEventListener("message",p),r.removeEventListener("error",m),r.removeEventListener("close",d)}},{highWaterMark:1/0});yield new C(e());try{for(var s=O(i),a,c,l;a=!(c=yield new C(s.next())).done;a=!1){let u=c.value;yield AJ(u)?new Uint8Array(u):u}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new C(c.call(s)))}finally{if(l)throw l[0]}}})}(),n=r.readyState===1,o;return r.addEventListener("open",()=>{n=!0,o=null}),r.addEventListener("close",()=>{n=!1,o=null}),r.addEventListener("error",i=>{n||(o=i.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};var PJ=(r,e)=>{e=e??{};let t=TJ(r),n=e.remoteAddress,o=e.remotePort;if(r.url!=null)try{let s=new URL(r.url);n=s.hostname,o=parseInt(s.port,10)}catch{}if(n==null||o==null)throw new Error("Remote connection did not have address and/or port");return{sink:SJ(r,e),source:t,connected:()=>f(null,null,function*(){yield t.connected()}),close:()=>f(null,null,function*(){(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&(yield new Promise(s=>{r.addEventListener("close",()=>{s()}),r.close()}))}),destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:o,socket:r}};var MJ=WebSocket;var ybe={"http:":"ws:","https:":"wss:"},kJ="ws:",RJ=(r,e)=>{if(r.startsWith("//")&&(r=`${e?.protocol??kJ}${r}`),r.startsWith("/")&&e!=null){let n=e.protocol??kJ,o=e.host,i=e.port!=null&&o?.endsWith(`:${e.port}`)!==!0?`:${e.port}`:"";r=`${n}//${o}${i}${r}`}let t=new URL(r);for(let[n,o]of Object.entries(ybe))t.protocol===n&&(t.protocol=o);return t};function NJ(r,e){let t=typeof window>"u"?void 0:window.location;e=e??{};let n=RJ(r,t),o=new MJ(n.toString(),e.websocket);return PJ(o,e)}function OJ(r){return r.filter(e=>rp.exactMatch(e)||Sl.exactMatch(e))}function LJ(){throw new Error("WebSocket Servers can not be created in the browser!")}function FJ(r,e,t){let n=t.logger.forComponent("libp2p:websockets:maconn"),o=t.metrics,i=t.metricPrefix??"",s={log:n,sink(c){return f(this,null,function*(){try{yield r.sink(function(){return k(this,null,function*(){try{for(var l=O(c),u,d,h;u=!(d=yield new C(l.next())).done;u=!1){let p=d.value;p instanceof Uint8Array?yield p:yield p.subarray()}}catch{h=[d]}finally{try{u&&(d=l.return)&&(yield new C(d.call(l)))}finally{if(h)throw h[0]}}})}())}catch(l){l.type!=="aborted"&&n.error(l)}})},source:r.source,remoteAddr:e,timeline:{open:Date.now()},close(){return f(this,arguments,function*(c={}){let l=Date.now();if(c.signal==null){let d=AbortSignal.timeout(500);c=I(v({},c),{signal:d})}let u=()=>{let{host:d,port:h}=s.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",d,h,Date.now()-l),this.abort(new Nn("Socket close timeout"))};c.signal?.addEventListener("abort",u);try{yield r.close()}catch(d){n.error("error closing WebSocket gracefully",d),this.abort(d)}finally{c.signal?.removeEventListener("abort",u),s.timeline.close=Date.now()}})},abort(c){let{host:l,port:u}=s.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",l,u,c),r.destroy(),s.timeline.close=Date.now(),o?.increment({[`${i}error`]:!0})}};return r.socket.addEventListener("close",()=>{o?.increment({[`${i}close`]:!0}),s.timeline.close==null&&(s.timeline.close=Date.now())},{once:!0}),s}var kR=class{log;init;logger;metrics;components;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[_u]=!0;[Symbol.toStringTag]="@libp2p/websockets";[Pt]=["@libp2p/transport"];dial(e,t){return f(this,null,function*(){this.log("dialing %s",e),t=t??{};let n=yield this._connect(e,t),o=FJ(n,e,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",o.remoteAddr);let i=yield t.upgrader.upgradeOutbound(o,t);return this.log("outbound connection %s upgraded",o.remoteAddr),i})}_connect(e,t){return f(this,null,function*(){t?.signal?.throwIfAborted();let n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);let o=Ye(),i=NJ(Eg(e),this.init);i.socket.addEventListener("error",()=>{let s=new q4(`Could not connect to ${e.toString()}`);this.log.error("connection error:",s),this.metrics?.dialerEvents.increment({error:!0}),o.reject(s)});try{t.onProgress?.(new pe("websockets:open-connection")),yield ut(Promise.race([i.connected(),o.promise]),t.signal)}catch(s){throw t.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),i.close().catch(a=>{this.log.error("error closing raw socket",a)}),s}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),i})}createListener(e){return LJ({logger:this.logger,events:this.components.events,metrics:this.components.metrics},v(v({},this.init),e))}listenFilter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):OJ(e)}dialFilter(e){return this.listenFilter(e)}};function BJ(r={}){return e=>new kR(e,r)}var RR=_r(i6(),1);function UJ(r,e){let t=e.map((n,o)=>({record:mc(n),index:o}));return t.sort((n,o)=>{let i=n.record.sequence,s=o.record.sequence;if(i>s)return-1;if(i<s)return 1;if(n.record.validityType===oi.ValidityType.EOL&&o.record.validityType===oi.ValidityType.EOL){let a=RR.default.fromString(n.record.validity).toDate(),c=RR.default.fromString(o.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}var VJ="5.4.2",jJ="helia";var HJ={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function $J(r={}){let e=`${jJ}/${VJ} ${v5()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[mM(),EJ(),xJ(),BJ()],connectionEncrypters:[T5()],streamMuxers:[JW(),TX()],peerDiscovery:[mY(HJ)],services:{autoNAT:oY(),dcutr:kY(),delegatedRouting:()=>aK("https://delegated-ipfs.dev",jT()),dht:EX({clientMode:!0,validators:{ipns:l6},selectors:{ipns:UJ}}),identify:UY(),identifyPush:VY(),keychain:C6(r.keychain),ping:RX()}}}function zJ(r){return f(this,null,function*(){let e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=yield uP(r.datastore,r.keychain));let t=$J(e);return t.datastore=t.datastore??r.datastore,yield dW(I(v(v({},t),e),{start:!1}))})}function qJ(){return f(this,arguments,function*(r={}){let e=r.datastore??new op,t=r.blockstore??new V2,n;return wbe(r.libp2p)?n=r.libp2p:n=yield zJ(I(v({},r),{libp2p:I(v({dns:r.dns},r.libp2p),{start:void 0}),datastore:e})),I(v({},r),{libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[BT(),uT()],routers:r.routers??[ZT(n),XT()],metrics:n.metrics,start:r.start??!0})})}function wbe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function KJ(){return f(this,arguments,function*(r={}){let e=yield qJ(r),t=new DE(e);return r.start!==!1&&(yield t.start()),t})}function bbe(r){return r[Symbol.asyncIterator]!=null}function xbe(r,e=1){return e=Number(e),bbe(r)?function(){return k(this,null,function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");try{for(var n=O(r),o,i,s;o=!(i=yield new C(n.next())).done;o=!1){let a=i.value;for(t.push(a);t.length>=e;)yield t.slice(0,e),t=t.slice(e)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new C(i.call(n)))}finally{if(s)throw s[0]}}for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)})}():function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}()}var eS=xbe;function Ew(r,e=1){return k(this,null,function*(){try{for(var t=O(eS(r,e)),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let s=o.value;let a=s.map(c=>f(null,null,function*(){return c().then(l=>({ok:!0,value:l}),l=>({ok:!1,err:l}))}));for(let c=0;c<a.length;c++){let l=yield new C(a[c]);if(l.ok)yield l.value;else throw l.err}}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})}var Ebe=262144,_w=(r={})=>{let e=r.chunkSize??Ebe;return function(n){return k(this,null,function*(){let o=new Ke,i=0,s=!1;try{for(var a=O(n),c,l,u;c=!(l=yield new C(a.next())).done;c=!1){let d=l.value;for(o.append(d),i+=d.length;i>=e;)if(yield o.slice(0,e),s=!0,e===o.length)o=new Ke,i=0;else{let h=new Ke;h.append(o.sublist(e)),o=h,i-=e}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new C(l.call(a)))}finally{if(u)throw u[0]}}(!s||i>0)&&(yield o.subarray(0,i))})}};var NR=(()=>{class r extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=r.name;code=r.code;constructor(t="Invalid type"){super(t)}}return r})(),GJ=(()=>{class r extends Error{static name="InvalidUnixFSMessageError";static code="ERR_INVALID_MESSAGE";name=r.name;code=r.code;constructor(t="Invalid message"){super(t)}}return r})();var La;(function(r){let e;(function(o){o.Raw="Raw",o.Directory="Directory",o.File="File",o.Metadata="Metadata",o.Symlink="Symlink",o.HAMTShard="HAMTShard"})(e=r.DataType||(r.DataType={}));let t;(function(o){o[o.Raw=0]="Raw",o[o.Directory=1]="Directory",o[o.File=2]="File",o[o.Metadata=3]="Metadata",o[o.Symlink=4]="Symlink",o[o.HAMTShard=5]="HAMTShard"})(t||(t={})),function(o){o.codec=()=>nr(t)}(e=r.DataType||(r.DataType={}));let n;r.codec=()=>(n==null&&(n=qe((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.Type!=null&&(i.uint32(8),r.DataType.codec().encode(o.Type,i)),o.Data!=null&&(i.uint32(18),i.bytes(o.Data)),o.filesize!=null&&(i.uint32(24),i.uint64(o.filesize)),o.blocksizes!=null)for(let a of o.blocksizes)i.uint32(32),i.uint64(a);o.hashType!=null&&(i.uint32(40),i.uint64(o.hashType)),o.fanout!=null&&(i.uint32(48),i.uint64(o.fanout)),o.mode!=null&&(i.uint32(56),i.uint32(o.mode)),o.mtime!=null&&(i.uint32(66),tS.codec().encode(o.mtime,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i)=>{let s={blocksizes:[]},a=i==null?o.len:o.pos+i;for(;o.pos<a;){let c=o.uint32();switch(c>>>3){case 1:s.Type=r.DataType.codec().decode(o);break;case 2:s.Data=o.bytes();break;case 3:s.filesize=o.uint64();break;case 4:s.blocksizes.push(o.uint64());break;case 5:s.hashType=o.uint64();break;case 6:s.fanout=o.uint64();break;case 7:s.mode=o.uint32();break;case 8:s.mtime=tS.codec().decode(o,o.uint32());break;default:o.skipType(c&7);break}}return s})),n),r.encode=o=>ze(o,r.codec()),r.decode=o=>$e(o,r.codec())})(La||(La={}));var tS;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Seconds!=null&&(n.uint32(8),n.int64(t.Seconds)),t.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(t.FractionalNanoseconds)),o.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let o={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let s=t.uint32();switch(s>>>3){case 1:o.Seconds=t.int64();break;case 2:o.FractionalNanoseconds=t.fixed32();break;default:t.skipType(s&7);break}}return o})),e),r.encode=t=>ze(t,r.codec()),r.decode=t=>$e(t,r.codec())})(tS||(tS={}));var WJ;(function(r){let e;r.codec=()=>(e==null&&(e=qe((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.MimeType!=null&&(n.uint32(10),n.string(t.MimeType)),o.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let o={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let s=t.uint32();switch(s>>>3){case 1:o.MimeType=t.string();break;default:t.skipType(s&7);break}}return o})),e),r.encode=t=>ze(t,r.codec()),r.decode=t=>$e(t,r.codec())})(WJ||(WJ={}));var YJ={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},_be=["directory","hamt-sharded-directory"],XJ=parseInt("0644",8),QJ=parseInt("0755",8),ZJ=BigInt(1024),Qe=class r{static unmarshal(e){let t=La.decode(e);if(t.fanout!=null&&t.fanout>ZJ)throw new GJ(`Fanout size was too large - ${t.fanout} > ${ZJ}`);let n=new r({type:YJ[t.Type!=null?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:t.mtime!=null?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return n._originalMode=t.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:n,blockSizes:o,hashType:i,fanout:s,mtime:a,mode:c}=e;if(t!=null&&!Object.values(YJ).includes(t))throw new NR("Type: "+t+" is not valid");this.type=t??"file",this.data=n,this.hashType=i,this.fanout=s,this.blockSizes=o??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){e==null?this._mode=this.isDirectory()?QJ:XJ:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return _be.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=La.DataType.Raw;break;case"directory":e=La.DataType.Directory;break;case"file":e=La.DataType.File;break;case"metadata":e=La.DataType.Metadata;break;case"symlink":e=La.DataType.Symlink;break;case"hamt-sharded-directory":e=La.DataType.HAMTShard;break;default:throw new NR(`Type: ${e} is not valid`)}let t=this.data;(this.data==null||this.data.length===0)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===XJ&&!this.isDirectory()&&(n=void 0),n===QJ&&this.isDirectory()&&(n=void 0));let o;return this.mtime!=null&&(o={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),La.encode({Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:o})}};var Fa=(r,e,t)=>f(null,null,function*(){t.codec==null&&(t.codec=jr);let n=yield xt.digest(r),o=le.create(t.cidVersion,t.codec.code,n);return yield e.put(o,r,t),o});function JJ(r){return function(t,n){return k(this,null,function*(){let o=0n;try{for(var i=O(t.content),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let l=a.value;yield()=>f(null,null,function*(){let u,d={codec:jr,cidVersion:r.cidVersion,onProgress:r.onProgress};r.rawLeaves?(d.codec=Oo,d.cidVersion=1):(u=new Qe({type:r.leafType,data:l}),l=At({Data:u.marshal(),Links:[]}));let h=yield Fa(l,n,d);return o+=BigInt(l.byteLength),r.onProgress?.(new pe("unixfs:importer:progress:file:write",{bytesWritten:o,cid:h,path:t.path})),{cid:h,unixfs:u,size:BigInt(l.length),block:l}})}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}})}}var eee=(()=>{class r extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r.name;code=r.code;constructor(t="Invalid parameters"){super(t)}}return r})();var N0=(()=>{class r extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=r.name;code=r.code;constructor(t="Invalid content"){super(t)}}return r})();var tee=(r,e,t)=>f(null,null,function*(){let n=new Qe({type:"directory",mtime:r.mtime,mode:r.mode}),o=At(kr({Data:n.marshal()})),i=yield Fa(o,e,t),s=r.path;return{cid:i,path:s,unixfs:n,size:BigInt(o.length),originalPath:r.originalPath,block:o}});function Sbe(r,e,t){return k(this,null,function*(){let n=-1,o;try{for(var i=O(Ew(t.bufferImporter(r,e),t.blockWriteConcurrency)),s,a,c;s=!(a=yield new C(i.next())).done;s=!1){let l=a.value;if(n++,n===0){o=I(v({},l),{single:!0});continue}else n===1&&o!=null&&(yield I(v({},o),{block:void 0,single:void 0}),o=void 0);yield I(v({},l),{block:void 0})}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new C(a.call(i)))}finally{if(c)throw c[0]}}o!=null&&(yield o)})}function ree(r){return r.single===!0}var Cbe=(r,e,t)=>function(o){return f(this,null,function*(){if(o.length===1&&ree(o[0])&&t.reduceSingleLeafToSelf){let u=o[0],d=u.block;return ree(u)&&(r.mtime!==void 0||r.mode!==void 0)&&(u.unixfs=new Qe({type:"file",mtime:r.mtime,mode:r.mode,data:u.block}),d={Data:u.unixfs.marshal(),Links:[]},u.block=At(kr(d)),u.cid=yield Fa(u.block,e,I(v({},t),{cidVersion:t.cidVersion})),u.size=BigInt(u.block.length)),t.onProgress?.(new pe("unixfs:importer:progress:file:layout",{cid:u.cid,path:u.originalPath})),{cid:u.cid,path:r.path,unixfs:u.unixfs,size:u.size,originalPath:u.originalPath}}let i=new Qe({type:"file",mtime:r.mtime,mode:r.mode}),s=o.filter(u=>u.cid.code===Pr&&u.size>0||u.unixfs!=null&&u.unixfs.data==null&&u.unixfs.fileSize()>0n?!0:!!u.unixfs?.data?.length).map(u=>u.cid.code===Pr?(i.addBlockSize(u.size),{Name:"",Tsize:Number(u.size),Hash:u.cid}):(u.unixfs?.data==null?i.addBlockSize(u.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(u.unixfs.data.length)),{Name:"",Tsize:Number(u.size),Hash:u.cid})),a={Data:i.marshal(),Links:s},c=At(kr(a)),l=yield Fa(c,e,t);return t.onProgress?.(new pe("unixfs:importer:progress:file:layout",{cid:l,path:r.originalPath})),{cid:l,path:r.path,unixfs:i,size:BigInt(c.length+a.Links.reduce((u,d)=>u+(d.Tsize??0),0)),originalPath:r.originalPath,block:c}})},nee=(r,e,t)=>f(null,null,function*(){return t.layout(Sbe(r,e,t),Cbe(r,e,t))});function Ibe(r){return Symbol.iterator in r}function Abe(r){return Symbol.asyncIterator in r}function Dbe(r){try{if(r instanceof Uint8Array)return function(){return k(this,null,function*(){yield r})}();if(Ibe(r))return function(){return k(this,null,function*(){yield*J(r)})}();if(Abe(r))return r}catch{throw new N0("Content was invalid")}throw new N0("Content was invalid")}function oee(r){return function(t,n){return k(this,null,function*(){try{for(var o=O(t),i,s,a;i=!(s=yield new C(o.next())).done;i=!1){let c=s.value;let l;if(c.path!=null&&(l=c.path,c.path=c.path.split("/").filter(u=>u!=null&&u!==".").join("/")),Tbe(c)){let u={path:c.path,mtime:c.mtime,mode:c.mode,content:function(){return k(this,null,function*(){let h=0n;try{for(var p=O(r.chunker(r.chunkValidator(Dbe(c.content)))),m,w,E;m=!(w=yield new C(p.next())).done;m=!1){let S=w.value;let A=BigInt(S.byteLength);h+=A,r.onProgress?.(new pe("unixfs:importer:progress:file:read",{bytesRead:h,chunkSize:A,path:c.path})),yield S}}catch{E=[w]}finally{try{m&&(w=p.return)&&(yield new C(w.call(p)))}finally{if(E)throw E[0]}}})}(),originalPath:l},d=r.fileBuilder??nee;yield()=>f(null,null,function*(){return d(u,n,r)})}else if(c.path!=null){let u={path:c.path,mtime:c.mtime,mode:c.mode,originalPath:l},d=r.dirBuilder??tee;yield()=>f(null,null,function*(){return d(u,n,r)})}else throw new Error("Import candidate must have content or path or both")}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new C(s.call(o)))}finally{if(a)throw a[0]}}})}}function Tbe(r){return r.content!=null}var iee=()=>function(e){return k(this,null,function*(){try{for(var t=O(e),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let s=o.value;if(s.length===void 0)throw new N0("Content was invalid");if(typeof s=="string"||s instanceof String)yield ee(s.toString());else if(Array.isArray(s))yield Uint8Array.from(s);else if(s instanceof Uint8Array)yield s;else throw new N0("Content was invalid")}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})};var Pbe=174;function Sw(r){let e=r?.maxChildrenPerNode??Pbe;return function t(n,o){return f(this,null,function*(){let i=[];try{for(var s=O(eS(n,e)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;i.push(yield o(u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}return i.length>1?t(i,o):i[0]})}}var kc=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},Cw=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Iw=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");var wh=class extends kc{_children;constructor(e,t){super(e,t),this._children=new Map}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)})}get(e){return f(this,null,function*(){return Promise.resolve(this._children.get(e))})}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}*eachChildSeries(){for(let[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(let[e,t]of this._children.entries())t.size!=null&&t.cid!=null&&(this.nodeSize+=e.length+(this.options.cidVersion===1?Iw.bytes.byteLength:Cw.bytes.byteLength));return this.nodeSize}flush(e){return k(this,null,function*(){let t=[];for(let[h,p]of this._children.entries()){let m=p;if(p instanceof kc)try{for(var c=O(p.flush(e)),l,u,d;l=!(u=yield new C(c.next())).done;l=!1){let w=u.value;m=w,yield w}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new C(u.call(c)))}finally{if(d)throw d[0]}}m.size!=null&&m.cid!=null&&t.push({Name:h,Tsize:Number(m.size),Hash:m.cid})}let n=new Qe({type:"directory",mtime:this.mtime,mode:this.mode}),o={Data:n.marshal(),Links:t},i=At(kr(o)),s=yield new C(Fa(i,e,this.options)),a=i.length+o.Links.reduce((h,p)=>h+(p.Tsize??0),0);this.cid=s,this.size=a,yield{cid:s,unixfs:n,path:this.path,size:BigInt(a)}})}};var nS=_r(cee(),1);function Mbe(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var cRt=bf({name:"murmur3-32",code:35,encode:r=>Mbe(nS.default.x86.hash32(r))}),bh=bf({name:"murmur3-128",code:34,encode:r=>Ch.fromHex(nS.default.x64.hash128(r))}),lRt=bf({name:"murmur3-x64-64",code:34,encode:r=>Ch.fromHex(nS.default.x64.hash128(r)).subarray(0,8)});var dee=_r(oS(),1);var Zi=class r{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new dee.default,this.key=null}put(e,t){return f(this,null,function*(){let n=yield this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)})}get(e){return f(this,null,function*(){let t=yield this._findChild(e);if(t!=null)return t.value})}del(e){return f(this,null,function*(){let t=yield this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)})}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof r?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof r?yield*J(t.eachLeafSeries()):yield t}serialize(e,t){let n=[];return t(this._children.reduce((o,i,s)=>(i!=null&&(i instanceof r?o.push(i.serialize(e,t)):o.push(e(i,s))),o),n))}asyncTransform(e,t){return f(this,null,function*(){return fee(this,e,t)})}toJSON(){return this.serialize(Lbe,Fbe)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}_findChild(e){return f(this,null,function*(){let t=yield this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof r)&&n!=null&&n.key===e)return n})}_findPlace(e){return f(this,null,function*(){let t=this._options.hash(typeof e=="string"?ee(e):e),n=yield t.take(this._options.bits),o=this._children.get(n);return o instanceof r?o._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:o}})}_findNewBucketAndPos(e){return f(this,null,function*(){let t=yield this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new r(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let o=yield n._findPlace(t.existingChild.hash);return o.bucket._putAt(o,t.existingChild.key,t.existingChild.value),n._findNewBucketAndPos(t.hash)}return t})}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(Obe);if(e!=null&&!(e instanceof r)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function Obe(r){return!!r}function Lbe(r,e){return r.key}function Fbe(r){return r}function fee(r,e,t){return f(this,null,function*(){let n=[];for(let o of r._children.compactArray())if(o instanceof Zi)yield fee(o,e,t);else{let i=yield e(o);n.push({bitField:r._children.bitField(),children:i})}return t(n)})}var Bbe=[255,254,252,248,240,224,192,128],Ube=[1,3,7,15,31,63,127,255],iS=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let o=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,t),a=Vbe(o,i-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Vbe(r,e,t){let n=jbe(e,t);return(r&n)>>>e}function jbe(r,e){return Bbe[r]&Ube[Math.min(e+r-1,7)]}function pee(r){function e(t){return t instanceof sS?t:new sS(t,r)}return e}var sS=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}take(e){return f(this,null,function*(){let t=e;for(;this._availableBits<t;)yield this._produceMoreBits();let n=0;for(;t>0;){let o=this._buffers[this._currentBufferIndex],i=Math.min(o.availableBits(),t),s=o.take(i);n=(n<<i)+s,t-=i,this._availableBits-=i,o.availableBits()===0&&this._currentBufferIndex++}return n})}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],o=Math.min(n.totalBits()-n.availableBits(),t);n.untake(o),t-=o,this._availableBits+=o,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}_produceMoreBits(){return f(this,null,function*(){this._depth++;let e=this._depth>0?Gt([this._value,Uint8Array.from([this._depth])]):this._value,t=yield this._hashFn(e),n=new iS(t);this._buffers.push(n),this._availableBits+=n.availableBits()})}};function O0(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:pee(r.hashFn)};return new Zi(e)}function Hbe(r){return f(this,null,function*(){return(yield bh.encode(r)).slice(0,8).reverse()})}var hee=BigInt(34),$be=8,OR=class extends kc{_bucket;constructor(e,t){super(e,t),this._bucket=O0({hashFn:Hbe,bits:t.shardFanoutBits??$be})}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,yield this._bucket.put(e,t)})}get(e){return f(this,null,function*(){return this._bucket.get(e)})}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}*eachChildSeries(){for(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=yee(this._bucket,this,this.options),this.nodeSize)}flush(e){return k(this,null,function*(){try{for(var t=O(gee(this._bucket,e,this,this.options)),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let s=o.value;yield I(v({},s),{path:this.path})}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})}},mee=OR;function gee(r,e,t,n){return k(this,null,function*(){let o=r._children,i=(r.tableSize()-1).toString(16).length,s=[],a=0n;for(let Y=0;Y<o.length;Y++){let H=o.get(Y);if(H==null)continue;let U=Y.toString(16).toUpperCase().padStart(i,"0");if(H instanceof Zi){let P;try{for(var m=O(gee(H,e,null,n)),w,E,S;w=!(E=yield new C(m.next())).done;w=!1){let R=E.value;P=R}}catch{S=[E]}finally{try{w&&(E=m.return)&&(yield new C(E.call(m)))}finally{if(S)throw S[0]}}if(P==null)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:U,Tsize:Number(P.size),Hash:P.cid}),a+=P.size}else if(zbe(H.value)){let P=H.value,R;try{for(var A=O(P.flush(e)),M,L,F;M=!(L=yield new C(A.next())).done;M=!1){let j=L.value;R=j,yield R}}catch{F=[L]}finally{try{M&&(L=A.return)&&(yield new C(L.call(A)))}finally{if(F)throw F[0]}}if(R==null)throw new Error("Did not flush dir");let N=U+H.key;s.push({Name:N,Tsize:Number(R.size),Hash:R.cid}),a+=R.size}else{let P=H.value;if(P.cid==null)continue;let R=U+H.key,N=P.size;s.push({Name:R,Tsize:Number(N),Hash:P.cid}),a+=BigInt(N??0)}}let c=Uint8Array.from(o.bitField().reverse()),l=new Qe({type:"hamt-sharded-directory",data:c,fanout:BigInt(r.tableSize()),hashType:hee,mtime:t?.mtime,mode:t?.mode}),u={Data:l.marshal(),Links:s},d=At(kr(u)),h=yield new C(Fa(d,e,n)),p=BigInt(d.byteLength)+a;yield{cid:h,unixfs:l,size:p}})}function zbe(r){return typeof r.flush=="function"}function yee(r,e,t){let n=r._children,o=(r.tableSize()-1).toString(16).length,i=[];for(let l=0;l<n.length;l++){let u=n.get(l);if(u==null)continue;let d=l.toString(16).toUpperCase().padStart(o,"0");if(u instanceof Zi){let h=yee(u,null,t);i.push({Name:d,Tsize:Number(h),Hash:t.cidVersion===0?Cw:Iw})}else if(typeof u.value.flush=="function"){let p=u.value.nodeSize();i.push({Name:d+u.key,Tsize:Number(p),Hash:t.cidVersion===0?Cw:Iw})}else{let h=u.value;if(h.cid==null)continue;let p=d+u.key,m=h.size;i.push({Name:p,Tsize:Number(m),Hash:h.cid})}}let s=Uint8Array.from(n.bitField().reverse()),a=new Qe({type:"hamt-sharded-directory",data:s,fanout:BigInt(r.tableSize()),hashType:hee,mtime:e?.mtime,mode:e?.mode});return At(kr({Data:a.marshal(),Links:i})).length}function LR(r,e,t,n){return f(this,null,function*(){let o=e;e instanceof wh&&e.estimateNodeSize()>t&&(o=yield qbe(e,n));let i=o.parent;if(i!=null){if(o!==e){if(r!=null&&(r.parent=o),o.parentKey==null)throw new Error("No parent key found");yield i.put(o.parentKey,o)}return LR(o,i,t,n)}return o})}function qbe(r,e){return f(this,null,function*(){let t=new mee({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for(let{key:n,child:o}of r.eachChildSeries())yield t.put(n,o);return t})}var vee=(r="")=>r.split(new RegExp("(?<!\\\\)\\/")).filter(Boolean);function Kbe(r,e,t){return f(this,null,function*(){let n=vee(r.path??""),o=n.length-1,i=e,s="";for(let a=0;a<n.length;a++){let c=n[a];s+=`${s!==""?"/":""}${c}`;let l=a===o;if(i.dirty=!0,i.cid=void 0,i.size=void 0,l)yield i.put(c,r),e=yield LR(null,i,t.shardSplitThresholdBytes,t);else{let u=yield i.get(c);(u==null||!(u instanceof kc))&&(u=new wh({root:!1,dir:!0,parent:i,parentKey:c,path:s,dirty:!0,flat:!0,mtime:u?.unixfs?.mtime,mode:u?.unixfs?.mode},t)),yield i.put(c,u),i=u}}return e})}function wee(r,e){return k(this,null,function*(){if(!(r instanceof kc)){r.unixfs?.isDirectory()===!0&&(yield r);return}yield*J(r.flush(e))})}function bee(r){return function(t,n){return k(this,null,function*(){let o=new wh({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r),i,s=!1;try{for(var a=O(t),c,l,u;c=!(l=yield new C(a.next())).done;c=!1){let d=l.value;if(d==null)continue;let h=`${d.originalPath??""}`.split("/")[0];h!=null&&h!==""&&(i==null?(i=h,s=!0):i!==h&&(s=!1)),o=yield new C(Kbe(d,o,r)),d.unixfs?.isDirectory()!==!0&&(yield d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new C(l.call(a)))}finally{if(u)throw u[0]}}if(r.wrapWithDirectory||s&&o.childCount()>1)yield*J(wee(o,n));else for(let d of o.eachChildSeries())d!=null&&(yield*J(wee(d.child,n)))})}}function xh(n,o){return k(this,arguments,function*(r,e,t={}){let i;Symbol.asyncIterator in r||Symbol.iterator in r?i=r:i=[r];let s=t.wrapWithDirectory??!1,a=t.shardSplitThresholdBytes??262144,c=t.shardFanoutBits??8,l=t.cidVersion??1,u=t.rawLeaves??!0,d=t.leafType??"file",h=t.fileImportConcurrency??50,p=t.blockWriteConcurrency??10,m=t.reduceSingleLeafToSelf??!0,w=t.chunker??_w(),E=t.chunkValidator??iee(),S=t.dagBuilder??oee({chunker:w,chunkValidator:E,wrapWithDirectory:s,layout:t.layout??Sw(),bufferImporter:t.bufferImporter??JJ({cidVersion:l,rawLeaves:u,leafType:d,onProgress:t.onProgress}),blockWriteConcurrency:p,reduceSingleLeafToSelf:m,cidVersion:l,onProgress:t.onProgress,dirBuilder:t.dirBuilder,fileBuilder:t.fileBuilder}),A=t.treeBuilder??bee({wrapWithDirectory:s,shardSplitThresholdBytes:a,shardFanoutBits:c,cidVersion:l,onProgress:t.onProgress});try{for(var M=O(A(Ew(S(i,e),h),e)),L,F,Y;L=!(F=yield new C(M.next())).done;L=!1){let H=F.value;yield{cid:H.cid,path:H.path,unixfs:H.unixfs,size:H.size}}}catch{Y=[F]}finally{try{L&&(F=M.return)&&(yield new C(F.call(M)))}finally{if(Y)throw Y[0]}}})}function xee(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield Ag(xh([r],e,t));if(i==null)throw new eee("Nothing imported");return i})}function Eee(n,o){return f(this,arguments,function*(r,e,t={}){return xee({content:r},e,t)})}function _ee(n,o){return f(this,arguments,function*(r,e,t={}){return xee({content:r},e,t)})}function Gbe(r){return r[Symbol.asyncIterator]!=null}function Wbe(r){if(Gbe(r))return f(null,null,function*(){let t;try{for(var n=O(r),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t=a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t});let e;for(let t of r)e=t;return e}var Ba=Wbe;var Ua=class extends Error{name;code;constructor(e,t,n){super(e),this.name=t,this.code=n}},Rc=class extends Ua{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}},xi=class extends Ua{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PB_NODE")}},Ad=class extends Ua{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}},Dw=class extends Ua{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}},aS=class extends Ua{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}},L0=class extends Ua{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}},cS=class extends Ua{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}},Dd=class extends Ua{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}},mn=class extends Ua{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}};var Tw={cidVersion:1,rawLeaves:!0,layout:Sw({maxChildrenPerNode:1024}),chunker:_w({chunkSize:1048576})};function lS(n,o){return k(this,arguments,function*(r,e,t={}){yield*J(xh(r,e,v(v({},Tw),t)))})}function See(n,o){return f(this,arguments,function*(r,e,t={}){let{cid:i}=yield Eee(r,e,v(v({},Tw),t));return i})}function Cee(n,o){return f(this,arguments,function*(r,e,t={}){let{cid:i}=yield _ee(r,e,v(v({},Tw),t));return i})}function Iee(n,o){return f(this,arguments,function*(r,e,t={}){if(r.path==null)throw new mn("path is required");if(r.content==null)throw new mn("content is required");let i=yield Ba(lS([r],e,I(v(v({},Tw),t),{wrapWithDirectory:!0})));if(i==null)throw new mn("Nothing imported");return i.cid})}function Aee(n,o){return f(this,arguments,function*(r,e,t={}){if(r.content!=null)throw new mn("Directories cannot have content, use addFile instead");let s=yield(r.path==null?Ag:Ba)(lS([I(v({},r),{path:r.path??"-"})],e,I(v(v({},Tw),t),{wrapWithDirectory:r.path!=null})));if(s==null)throw new mn("Nothing imported");return s.cid})}var Dee=(()=>{class r extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=r.name;code=r.code;constructor(t="Bad path"){super(t)}}return r})(),Nc=(()=>{class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(t="Not found"){super(t)}}return r})(),Tee=(()=>{class r extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=r.name;code=r.code;constructor(t="No resolver"){super(t)}}return r})(),Zn=(()=>{class r extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=r.name;code=r.code;constructor(t="Not UnixFS"){super(t)}}return r})(),Pee=(()=>{class r extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=r.name;code=r.code;constructor(t="Over read"){super(t)}}return r})(),Mee=(()=>{class r extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=r.name;code=r.code;constructor(t="Under read"){super(t)}}return r})(),kee=(()=>{class r extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=r.name;code=r.code;constructor(t="No Property found"){super(t)}}return r})(),Pw=(()=>{class r extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r.name;code=r.code;constructor(t="Invalid parameters"){super(t)}}return r})();function F0(r,e,t,n,o,i,s){let a=r,c=o;for(;i.length>0;){let l=i[0];if(l in a){i.shift(),c=`${c}/${l}`;let u=le.asCID(a[l]);if(u!=null)return{entry:{type:"object",name:n,path:o,cid:t,node:e,depth:s,size:BigInt(e.length),content:function(){return k(this,null,function*(){yield r})}},next:{cid:u,name:l,path:c,toResolve:i}};a=a[l]}else throw new kee(`No property named ${l} found in node ${t}`)}return{entry:{type:"object",name:n,path:o,cid:t,node:e,depth:s,size:BigInt(e.length),content:function(){return k(this,null,function*(){yield r})}}}}var Ybe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=jA(c);return F0(l,c,r,e,t,n,i)}),Ree=Ybe;var Xbe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=Wx(c);return F0(l,c,r,e,t,n,i)}),Nee=Xbe;function Qbe(r,e,t,n){let o=BigInt(r.length),i=BigInt(e+o);return t>=i||n<e?new Uint8Array(0):(n>=e&&n<i&&(r=r.subarray(0,Number(n-e))),t>=e&&t<i&&(r=r.subarray(Number(t-e))),r)}var Eh=Qbe;var Zbe=(r,e=0,t=r)=>{let n=BigInt(r),o=BigInt(e??0),i=BigInt(t);if(i!==n&&(i=o+i),i>n&&(i=n),o<0n)throw new Pw("Offset must be greater than or equal to 0");if(o>n)throw new Pw("Offset must be less than the file size");if(i<0n)throw new Pw("Length must be greater than or equal to 0");if(i>n)throw new Pw("Length must be less than the file size");return{start:o,end:i}},B0=Zbe;var Jbe=r=>{function e(){return k(this,arguments,function*(t={}){let{start:n,end:o}=B0(r.length,t.offset,t.length),i=Eh(r,0n,n,o);t.onProgress?.(new pe("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:o-n,fileSize:BigInt(r.byteLength)})),yield i})}return e},e3e=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){if(n.length>0)throw new Nc(`No link named ${t} found in raw node ${r}`);let c=Ft(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:Jbe(c.digest),depth:i,size:BigInt(c.digest.length),node:c.digest}}}),Oee=e3e;var t3e=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=fA(c);return F0(l,c,r,e,t,n,i)}),Lee=t3e;var r3e=r=>{function e(){return k(this,arguments,function*(t={}){let{start:n,end:o}=B0(r.length,t.offset,t.length),i=Eh(r,0n,n,o);t.onProgress?.(new pe("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:o-n,fileSize:BigInt(r.byteLength)})),yield i})}return e},n3e=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){if(n.length>0)throw new Nc(`No link named ${t} found in raw node ${r}`);let c=yield s.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:r3e(c),depth:i,size:BigInt(c.length),node:c}}}),Fee=n3e;var o3e=function(r){return f(this,null,function*(){return(yield bh.encode(r)).slice(0,8).reverse()})},i3e=(r,e,t)=>f(null,null,function*(){let n=(e.tableSize()-1).toString(16).length;yield Promise.all(r.map(o=>f(null,null,function*(){if(o.Name==null)throw new Error("Unexpected Link without a Name");if(o.Name.length===n){let i=parseInt(o.Name,16);e._putObjectAt(i,new Zi({hash:t._options.hash,bits:t._options.bits},e,i));return}yield t.put(o.Name.substring(2),!0)})))}),Bee=(r,e)=>r.toString(16).toUpperCase().padStart(e,"0").substring(0,e),s3e=r=>{let e=r.bucket,t=[];for(;e._parent!=null;)t.push(e),e=e._parent;return t.push(e),t.reverse()},Uee=(r,e,t,n,o)=>f(null,null,function*(){if(n==null){if(r.Data==null)throw new Zn("no data in PBNode");let d;try{d=Qe.unmarshal(r.Data)}catch(p){throw new Zn(p.message)}if(d.type!=="hamt-sharded-directory")throw new Zn("not a HAMT");if(d.fanout==null)throw new Zn("missing fanout");let h=O0({hashFn:o3e,bits:Math.log2(Number(d.fanout))});n={rootBucket:h,hamtDepth:1,lastBucket:h}}let i=(n.lastBucket.tableSize()-1).toString(16).length;yield i3e(r.Links,n.lastBucket,n.rootBucket);let s=yield n.rootBucket._findNewBucketAndPos(e),a=Bee(s.pos,i),c=s3e(s);c.length>n.hamtDepth&&(n.lastBucket=c[n.hamtDepth],a=Bee(n.lastBucket._posAtParent,i));let l=r.Links.find(d=>{if(d.Name==null)return!1;let h=d.Name.substring(0,i),p=d.Name.substring(i);return!(h!==a||p!==""&&p!==e)});if(l==null)return;if(l.Name!=null&&l.Name.substring(i)===e)return l.Hash;n.hamtDepth++;let u=yield t.get(l.Hash,o);return r=Vr(u),Uee(r,e,t,n,o)}),Vee=Uee;var a3e=(r,e,t,n,o,i,s)=>{function a(){return k(this,arguments,function*(c={}){let l=c.offset??0,u=c.length??e.Links.length,d=e.Links.slice(l,u);c.onProgress?.(new pe("unixfs:exporter:walk:directory",{cid:r})),yield*J(fr(d,h=>An(h,p=>()=>f(null,null,function*(){let m=p.Name??"",w=`${n}/${m}`;return(yield o(p.Hash,m,w,[],i+1,s,c)).entry})),h=>$o(h,{ordered:!0,concurrency:c.blockReadConcurrency}),h=>lo(h,p=>p!=null)))})}return a},jee=a3e;function Hee(r,e,t,n,o,i,s){return f(this,null,function*(){if(e instanceof Uint8Array){let l=Eh(e,n,o,i);t.push(l);return}if(e.Data==null)throw new Zn("no data in PBNode");let a;try{a=Qe.unmarshal(e.Data)}catch(l){throw new Zn(l.message)}if(a.data!=null){let l=a.data,u=Eh(l,n,o,i);t.push(u),n+=BigInt(u.byteLength)}let c=[];if(e.Links.length!==a.blockSizes.length)throw new Zn("Inconsistent block sizes and dag links");for(let l=0;l<e.Links.length;l++){let u=e.Links[l],d=n,h=d+a.blockSizes[l];if((o>=d&&o<h||i>=d&&i<=h||o<d&&i>h)&&c.push({link:u,blockStart:n}),n=h,n>i)break}yield fr(c,l=>An(l,u=>()=>f(null,null,function*(){let d=yield r.get(u.link.Hash,s);return I(v({},u),{block:d})})),l=>$o(l,{ordered:!0,concurrency:s.blockReadConcurrency}),l=>f(null,null,function*(){try{for(var u=O(l),d,h,p;d=!(h=yield u.next()).done;d=!1){let{link:m,block:w,blockStart:E}=h.value;let S;switch(m.Hash.code){case fn:S=Vr(w);break;case Pr:S=w;break;default:t.end(new Zn(`Unsupported codec: ${m.Hash.code}`));return}let A=new Iu({concurrency:1});A.on("error",M=>{t.end(M)}),A.add(()=>f(null,null,function*(){s.onProgress?.(new pe("unixfs:exporter:walk:file",{cid:m.Hash})),yield Hee(r,S,t,E,o,i,s)})),yield A.onIdle()}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield h.call(u))}finally{if(p)throw p[0]}}})),n>=i&&t.end()})}var c3e=(r,e,t,n,o,i,s)=>{function a(){return k(this,arguments,function*(c={}){let l=t.fileSize();if(l===void 0)throw new Error("File was a directory");let{start:u,end:d}=B0(l,c.offset,c.length);if(d===0n)return;let h=0n,p=d-u,m=Zr();c.onProgress?.(new pe("unixfs:exporter:walk:file",{cid:r})),Hee(s,e,m,0n,u,d,c).catch(M=>{m.end(M)});try{for(var w=O(m),E,S,A;E=!(S=yield new C(w.next())).done;E=!1){let M=S.value;if(M!=null){if(h+=BigInt(M.byteLength),h>p)throw m.end(),new Pee("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");h===p&&m.end(),c.onProgress?.(new pe("unixfs:exporter:progress:unixfs:file",{bytesRead:h,totalBytes:p,fileSize:l})),yield M}}}catch{A=[S]}finally{try{E&&(S=w.return)&&(yield new C(S.call(w)))}finally{if(A)throw A[0]}}if(h<p)throw new Mee("Traversed entire DAG but did not read enough bytes")})}return a},FR=c3e;var l3e=(r,e,t,n,o,i,s)=>{function a(c={}){return c.onProgress?.(new pe("unixfs:exporter:walk:hamt-sharded-directory",{cid:r})),$ee(e,n,o,i,s,c)}return a};function $ee(r,e,t,n,o,i){return k(this,null,function*(){let s=r.Links;if(r.Data==null)throw new Zn("no data in PBNode");let a;try{a=Qe.unmarshal(r.Data)}catch(m){throw new Zn(m.message)}if(a.fanout==null)throw new Zn("missing fanout");let c=(a.fanout-1n).toString(16).length,l=fr(s,m=>An(m,w=>()=>f(null,null,function*(){let E=w.Name!=null?w.Name.substring(c):null;if(E!=null&&E!==""){let S=yield t(w.Hash,E,`${e}/${E}`,[],n+1,o,i);return{entries:S.entry==null?[]:[S.entry]}}else{let S=yield o.get(w.Hash,i);return r=Vr(S),i.onProgress?.(new pe("unixfs:exporter:walk:hamt-sharded-directory",{cid:w.Hash})),{entries:$ee(r,e,t,n,o,i)}}})),m=>$o(m,{ordered:!0,concurrency:i.blockReadConcurrency}));try{for(var u=O(l),d,h,p;d=!(h=yield new C(u.next())).done;d=!1){let{entries:m}=h.value;yield*J(m)}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new C(h.call(u)))}finally{if(p)throw p[0]}}})}var zee=l3e;var u3e=(r,e)=>r.Links.find(n=>n.Name===e)?.Hash,d3e={raw:FR,file:FR,directory:jee,"hamt-sharded-directory":zee,metadata:(r,e,t,n,o,i,s)=>()=>[],symlink:(r,e,t,n,o,i,s)=>()=>[]},f3e=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=Vr(c),u,d;if(e==null&&(e=r.toString()),l.Data==null)throw new Zn("no data in PBNode");try{u=Qe.unmarshal(l.Data)}catch(p){throw new Zn(p.message)}if(t==null&&(t=e),n.length>0){let p;if(u?.type==="hamt-sharded-directory"?p=yield Vee(l,n[0],s):p=u3e(l,n[0]),p==null)throw new Nc("file does not exist");let m=n.shift(),w=`${t}/${m}`;d={cid:p,toResolve:n,name:m??"",path:w}}let h=d3e[u.type](r,l,u,t,o,i,s);if(h==null)throw new Nc("could not find content exporter");return u.isDirectory()?{entry:{type:"directory",name:e,path:t,cid:r,content:h,unixfs:u,depth:i,node:l,size:u.fileSize()},next:d}:{entry:{type:"file",name:e,path:t,cid:r,content:h,unixfs:u,depth:i,node:l,size:u.fileSize()},next:d}}),qee=f3e;var p3e={[fn]:qee,[Pr]:Fee,[Vy]:Ree,[Hy]:Nee,[En.code]:Oee,[Ty]:Lee},Kee=(r,e,t,n,o,i,s)=>f(null,null,function*(){let a=p3e[r.code];if(a==null)throw new Tee(`No resolver for code ${r.code}`);return a(r,e,t,n,Kee,o,i,s)}),Gee=Kee;var h3e=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),m3e=r=>{if(r instanceof Uint8Array)return{cid:le.decode(r),toResolve:[]};let e=le.asCID(r);if(e!=null)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));let t=h3e(r);return{cid:le.parse(t[0]),toResolve:t.slice(1)}}throw new Dee(`Unknown path type ${r}`)};function BR(n,o){return k(this,arguments,function*(r,e,t={}){let{cid:i,toResolve:s}=m3e(r),a=i.toString(),c=a,l=s.length;for(;;){let u=yield new C(Gee(i,a,c,s,l,e,t));if(u.entry==null&&u.next==null)throw new Nc(`Could not resolve ${r}`);if(u.entry!=null&&(yield u.entry),u.next==null)return;s=u.next.toResolve,i=u.next.cid,a=u.next.name,c=u.next.path}})}function qo(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield Ba(BR(r,e,t));if(i==null)throw new Nc(`Could not resolve ${r}`);return i})}function uS(n,o){return k(this,arguments,function*(r,e,t={}){let i=yield new C(qo(r,e,t));if(i==null)return;if(yield i,i.type==="directory")try{for(var a=O(s(i,t)),c,l,u;c=!(l=yield new C(a.next())).done;c=!1){let d=l.value;yield d}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new C(l.call(a)))}finally{if(u)throw u[0]}}function s(d,h){return k(this,null,function*(){try{for(var p=O(d.content(h)),m,w,E;m=!(w=yield new C(p.next())).done;m=!1){let S=w.value;yield S,!(S instanceof Uint8Array)&&S.type==="directory"&&(yield*J(s(S,h)))}}catch{E=[w]}finally{try{m&&(w=p.return)&&(yield new C(w.call(p)))}finally{if(E)throw E[0]}}})}})}var HR=_r(oS(),1);function fS(r){function e(t){return t instanceof dS?t:new dS(t,r)}return e}var dS=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}take(e){return f(this,null,function*(){let t=e;for(;this._availableBits<t;)yield this._produceMoreBits();let n=0;for(;t>0;){let o=this._buffers[this._currentBufferIndex],i=Math.min(o.availableBits(),t),s=o.take(i);n=(n<<i)+s,t-=i,this._availableBits-=i,o.availableBits()===0&&this._currentBufferIndex++}return n})}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],o=Math.min(n.totalBits()-n.availableBits(),t);n.untake(o),t-=o,this._availableBits+=o,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}_produceMoreBits(){return f(this,null,function*(){this._depth++;let e=this._depth>0?Gt([this._value,Uint8Array.from([this._depth])]):this._value,t=yield this._hashFn(e),n=new UR(t);this._buffers.push(n),this._availableBits+=n.availableBits()})}},g3e=[255,254,252,248,240,224,192,128],y3e=[1,3,7,15,31,63,127,255],UR=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let o=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,t),a=v3e(o,i-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function v3e(r,e,t){let n=w3e(e,t);return(r&n)>>>e}function w3e(r,e){return g3e[r]&y3e[Math.min(e+r-1,7)]}var Mw=BigInt(bh.code),_h=8;function U0(r){return f(this,null,function*(){return(yield bh.encode(r)).subarray(0,8).reverse()})}var Xee=_r(oS(),1);var Va=(r,e,t)=>f(null,null,function*(){t.codec==null&&(t.codec=jr);let n=yield xt.digest(r),o=le.create(t.cidVersion,t.codec.code,n);return yield e.put(o,r,I(v({},t),{signal:t.signal})),o});var VR=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},pS=class extends VR{_bucket;constructor(e,t){super(e,t),this._bucket=O0({hashFn:U0,bits:8})}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,yield this._bucket.put(e,t)})}get(e){return f(this,null,function*(){return this._bucket.get(e)})}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}eachChildSeries(){return k(this,null,function*(){for(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}})}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=Yee(this._bucket,this,this.options),this.nodeSize)}flush(e){return k(this,null,function*(){try{for(var t=O(Wee(this._bucket,e,this,this.options)),n,o,i;n=!(o=yield new C(t.next())).done;n=!1){let s=o.value;yield I(v({},s),{path:this.path})}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new C(o.call(t)))}finally{if(i)throw i[0]}}})}};function Wee(r,e,t,n){return k(this,null,function*(){let o=r._children,i=[],s=0n;for(let F=0;F<o.length;F++){let Y=o.get(F);if(Y==null)continue;let H=F.toString(16).toUpperCase().padStart(2,"0");if(Y instanceof Zi){let U;try{for(var p=O(Wee(Y,e,null,n)),m,w,E;m=!(w=yield new C(p.next())).done;m=!1){let P=w.value;U=P}}catch{E=[w]}finally{try{m&&(w=p.return)&&(yield new C(w.call(p)))}finally{if(E)throw E[0]}}if(U==null)throw new Error("Could not flush sharded directory, no sub-shard found");i.push({Name:H,Tsize:Number(U.size),Hash:U.cid}),s+=U.size}else if(b3e(Y.value)){let U=Y.value,P;try{for(var S=O(U.flush(e)),A,M,L;A=!(M=yield new C(S.next())).done;A=!1){let N=M.value;P=N,yield P}}catch{L=[M]}finally{try{A&&(M=S.return)&&(yield new C(M.call(S)))}finally{if(L)throw L[0]}}if(P==null)throw new Error("Did not flush dir");let R=H+Y.key;i.push({Name:R,Tsize:Number(P.size),Hash:P.cid}),s+=P.size}else{let U=Y.value;if(U.cid==null)continue;let P=H+Y.key,R=U.size;i.push({Name:P,Tsize:Number(R),Hash:U.cid}),s+=BigInt(R??0)}}let a=Uint8Array.from(o.bitField().reverse()),c=new Qe({type:"hamt-sharded-directory",data:a,fanout:BigInt(r.tableSize()),hashType:Mw,mtime:t?.mtime,mode:t?.mode}),l={Data:c.marshal(),Links:i},u=At(kr(l)),d=yield new C(Va(u,e,n)),h=BigInt(u.byteLength)+s;yield{cid:d,unixfs:c,size:h}})}function b3e(r){return typeof r.flush=="function"}function Yee(r,e,t){let n=r._children,o=[];for(let c=0;c<n.length;c++){let l=n.get(c);if(l==null)continue;let u=c.toString(16).toUpperCase().padStart(2,"0");if(l instanceof Zi){let d=Yee(l,null,t);o.push({Name:u,Tsize:Number(d),Hash:t.cidVersion===0?hS:mS})}else if(typeof l.value.flush=="function"){let h=l.value.nodeSize();o.push({Name:u+l.key,Tsize:Number(h),Hash:t.cidVersion===0?hS:mS})}else{let d=l.value;if(d.cid==null)continue;let h=u+l.key,p=d.size;o.push({Name:h,Tsize:Number(p),Hash:d.cid})}}let i=Uint8Array.from(n.bitField().reverse()),s=new Qe({type:"hamt-sharded-directory",data:i,fanout:BigInt(r.tableSize()),hashType:Mw,mtime:e?.mtime,mode:e?.mode});return At(kr({Data:s.marshal(),Links:o})).length}var hS=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),mS=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");var jR=Mt("helia:unixfs:commands:utils:hamt-utils"),gS=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Qee=(r,e,t)=>f(null,null,function*(){let n=new pS({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let i=0;i<e.length;i++)yield n._bucket.put(e[i].name,{size:e[i].size,cid:e[i].cid});let o=yield Ba(n.flush(r));if(o==null)throw new Error("Flushing shard yielded no result");return o}),yS=(r,e,t)=>f(null,null,function*(){let n=Qe.unmarshal(r[0].node.Data??new Uint8Array(0)),o=BigInt(Math.pow(2,_h));r.reverse();let i,s;for(let a=0;a<r.length;a++){let c=a===r.length-1,l=r[a],u=Uint8Array.from(l.children.bitField().reverse()),d=new Qe({type:"hamt-sharded-directory",data:u,fanout:o,hashType:Mw});c&&(d.mtime=n.mtime,d.mode=n.mode),s={Data:d.marshal(),Links:l.node.Links};let h=At(kr(s));if(i=yield Va(h,e,t),!c){let p=r[a+1];if(p==null)throw new Error("Was not operating on shard root but also had no parent?");jR("updating link in parent sub-shard with prefix %s",p.prefix),p.node.Links=p.node.Links.filter(m=>m.Name!==p.prefix),p.node.Links.push({Name:p.prefix,Hash:i,Tsize:l.node.Links.reduce((m,w)=>m+(w.Tsize??0),h.byteLength)})}}if(i==null||s==null)throw new Error("Noting persisted");return{cid:i,node:s}}),vS=(r,e,t,n)=>f(null,null,function*(){let i=fS(U0)(ee(e)),s=[];for(;;){let a=yield t.get(r,n),c=Vr(a),l=new Xee.default,u=yield i.take(_h),d=gS(u);s.push({prefix:d,children:l,node:c});let h;for(let m of c.Links){let w=m.Name??"";if(w.length<2)throw new Error("Invalid HAMT - link name was too short");let E=parseInt(w.substring(0,2),16);l.set(E,!0),w.startsWith(d)&&(h=m)}if(h==null){jR("no link found with prefix %s for %s",d,e);break}let p=h.Name??"";if(p.length<2)throw new Error("Invalid HAMT - link name was too short");if(p.length===2){r=h.Hash,jR("descend into sub-shard with prefix %s",p);continue}break}return{path:s,hash:i}});function wS(r,e,t,n){return f(this,null,function*(){if(r.Data==null)throw new Error("DagPB node had no data");let o=Qe.unmarshal(r.Data),i;if(o.type==="directory")i=x3e(r);else if(o.type==="hamt-sharded-directory")i=yield Zee(r,0,t,e,n);else throw new Error("Can only estimate the size of directories or shards");return i>t})}function x3e(r){let e=0;for(let t of r.Links)e+=(t.Name??"").length,e+=t.Hash.version===1?mS.bytes.byteLength:hS.bytes.byteLength;return e}function Zee(r,e,t,n,o){return f(this,null,function*(){if(e>t)return t;if(r.Data==null||!Qe.unmarshal(r.Data).isDirectory())return e;for(let s of r.Links){let a=s.Name??"";if(a=a.substring(2),e+=a.length,e+=s.Hash.bytes.byteLength,s.Hash.code===fn){let c=yield n.get(s.Hash,o),l=Vr(c);e+=yield Zee(l,e,t,n,o)}}return e})}var Oc=Mt("helia:unixfs:components:utils:add-link");function V0(r,e,t,n){return f(this,null,function*(){if(r.node.Data==null)throw new mn("Invalid parent passed to addLink");if(Qe.unmarshal(r.node.Data).type==="hamt-sharded-directory")return Oc("adding link to sharded directory"),S3e(r,e,t,n);Oc(`adding ${e.Name} (${e.Hash}) to regular directory`);let i=yield _3e(r,e,t,n);if(yield wS(i.node,t,n.shardSplitThresholdBytes,n)){Oc("converting directory to sharded directory");let s=yield E3e(i,t);i.cid=s.cid,i.node=Vr(yield t.get(s.cid,n))}return i})}var E3e=(r,e)=>f(null,null,function*(){if(r.node.Data==null)throw new mn("Invalid parent passed to convertToShardedDirectory");let t=Qe.unmarshal(r.node.Data),n=yield Qee(e,r.node.Links.map(o=>({name:o.Name??"",size:BigInt(o.Tsize??0),cid:o.Hash})),{mode:t.mode,mtime:t.mtime,cidVersion:r.cid.version});return Oc(`converted directory to sharded directory ${n.cid}`),n}),_3e=(r,e,t,n)=>f(null,null,function*(){let o=r.node.Links.filter(u=>{let d=u.Name===e.Name;if(d&&!n.allowOverwriting)throw new Dw;return!d});if(o.push(e),r.node.Data==null)throw new xi("Parent node with no data passed to addToDirectory");let i=Qe.unmarshal(r.node.Data),s;if(i.mtime!=null){let u=Date.now(),d=Math.floor(u/1e3);i.mtime={secs:BigInt(d),nsecs:(u-d*1e3)*1e3},s=i.marshal()}else s=r.node.Data;r.node=kr({Data:s,Links:o});let a=At(r.node),c=yield xt.digest(a),l=le.create(r.cid.version,fn,c);return yield t.put(l,a),{node:r.node,cid:l}}),S3e=(r,e,t,n)=>f(null,null,function*(){let{path:o,hash:i}=yield vS(r.cid,e.Name,t,n),s=o[o.length-1];if(s==null)throw new Error("Invalid HAMT, could not generate path");let a=s.prefix,c=parseInt(a,16);Oc("next prefix for %s is %s",e.Name,a);let l=`${a}${e.Name}`,u=s.node.Links.find(d=>(d.Name??"").startsWith(a));if(u!=null)if(Oc("link %s was present in shard",l),u.Name===l){if(!n.allowOverwriting)throw new Dw;Oc("overwriting %s in sub-shard",e.Name),s.node.Links=s.node.Links.filter(d=>d.Name!==l),s.node.Links.push({Name:l,Hash:e.Hash,Tsize:e.Tsize})}else{if(u.Name?.length===2)throw new Error("Existing link was sub-shard?!");{Oc("prefix %s already exists, creating new sub-shard",a);let d=s.node.Links.findIndex(E=>E.Name?.startsWith(a)),h=s.node.Links.splice(d,1)[0],p=(h.Name??"").substring(2),w=fS(U0)(ee(p));for(let E=0;E<o.length;E++)yield w.take(_h);for(;;){let E=yield w.take(_h),S=gS(E);h.Name=`${S}${p}`;let A=yield i.take(_h),M=gS(A);if(S===M){let F=new HR.default;F.set(A,!0),o.push({prefix:M,children:F,node:{Links:[]}});continue}let L=new HR.default;L.set(A,!0),L.set(E,!0),o.push({prefix:a,children:L,node:{Links:[h,{Name:`${M}${e.Name}`,Hash:e.Hash,Tsize:e.Tsize}]}});break}}}else Oc("link %s was not present in sub-shard",l),e.Name=l,s.node.Links.push(e),s.children.set(c,!0),Oc("adding %s to existing sub-shard",l);return yS(o,t,n)});function Td(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield qo(r,e,t);if(i.type!=="directory")throw new Dd(`${r.toString()} was not a UnixFS directory`);return{cid:r,node:i.node}})}function j0(r,e,t,n){return f(this,null,function*(){let o=yield qo(r,t,n);if(o.type!=="directory"&&o.type!=="file"&&o.type!=="raw")throw new Rc(`${r.toString()} was not a UnixFS node`);return{Name:e,Tsize:o.node instanceof Uint8Array?o.node.byteLength:C3e(o.node),Hash:r}})}function C3e(r){let e=r.Links.reduce((t,n)=>t+(n.Tsize??0),0);return At(r).byteLength+e}var I3e=Mt("helia:unixfs:components:utils:resolve");function Lc(r,e,t,n){return f(this,null,function*(){if(e==null||e==="")return{cid:r};let o=`/ipfs/${r}${e==null?"":`/${e}`}`,i=yield Ea(BR(o,t,n));if(i.length===0)throw new aS("Could not find path in directory");return I3e("resolved %s to %c",e,r),{cid:i[i.length-1].cid,path:e,segments:i}})}function H0(r,e,t,n){return f(this,null,function*(){if(e.segments==null||e.segments.length===0)return r;let o=e.segments.pop();if(o==null)throw new Error("Insufficient segments");o.cid=r,e.segments.reverse();for(let i of e.segments){let[s,a]=yield Promise.all([Td(i.cid,t,n),j0(o.cid,o.name,t,n)]);r=(yield V0(s,a,t,I(v({},n),{allowOverwriting:!0,cidVersion:r.version}))).cid,i.cid=r,o=i}return r})}var A3e=Rr.bind({ignoreUndefined:!0}),D3e={};function Jee(n,o){return k(this,arguments,function*(r,e,t={}){let i=A3e(D3e,t),s=yield new C(Lc(r,i.path,e,i)),a=yield new C(qo(s.cid,e,i));if(a.type!=="file"&&a.type!=="raw")throw new cS;if(a.content==null)throw new L0;yield*J(a.content(i))})}var T3e=Rr.bind({ignoreUndefined:!0}),P3e=Mt("helia:unixfs:chmod"),M3e={recursive:!1,shardSplitThresholdBytes:262144};function ete(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=T3e(M3e,n),c=yield Lc(r,a.path,t,n);if(P3e("chmod %c %d",c.cid,e),a.recursive){let w=yield fr(function(){return k(this,null,function*(){try{for(var E=O(uS(c.cid,t,n)),S,A,M;S=!(A=yield new C(E.next())).done;S=!1){let L=A.value;let F,Y=[];if(L.type==="raw")F=new Qe({type:"file",data:L.node});else if(L.type==="file"||L.type==="directory")F=L.unixfs,Y=L.node.Links;else throw new Rc;F.mode=e;let H={Data:F.marshal(),Links:Y};yield{path:L.path,content:H}}}catch{M=[A]}finally{try{S&&(A=E.return)&&(yield new C(A.call(E)))}finally{if(M)throw M[0]}}})},E=>xh(E,t,I(v({},a),{dagBuilder:function(S,A){return k(this,null,function*(){try{for(var M=O(S),L,F,Y;L=!(F=yield new C(M.next())).done;L=!1){let H=F.value;yield function(){return f(this,null,function*(){let U=H.content,P=At(U),R=yield Va(P,A,I(v({},a),{cidVersion:r.version}));if(U.Data==null)throw new xi(`${R} had no data`);let N=Qe.unmarshal(U.Data);return{cid:R,size:BigInt(P.length),path:H.path,unixfs:N}})}}}catch{Y=[F]}finally{try{L&&(F=M.return)&&(yield new C(F.call(M)))}finally{if(Y)throw Y[0]}}})}})),E=>f(null,null,function*(){return Ba(E)}));if(w==null)throw new Ad(`Could not chmod ${c.cid.toString()}`);return H0(w.cid,c,t,a)}let l=yield t.get(c.cid,n),u,d=[];if(c.cid.code===Pr)u=new Qe({type:"file",data:l});else{let w=Vr(l);if(w.Data==null)throw new xi(`${c.cid.toString()} had no data`);d=w.Links,u=Qe.unmarshal(w.Data)}u.mode=e;let h=At({Data:u.marshal(),Links:d}),p=yield xt.digest(h),m=le.create(c.cid.version,fn,p);return yield t.put(m,h),H0(m,c,t,a)})}var k3e=Rr.bind({ignoreUndefined:!0}),R3e=Mt("helia:unixfs:cp"),N3e={force:!1,shardSplitThresholdBytes:262144};function tte(i,s,a,c){return f(this,arguments,function*(r,e,t,n,o={}){let l=k3e(N3e,o);if(t.includes("/"))throw new mn("Name must not have slashes");let[u,d]=yield Promise.all([Td(e,n,l),j0(r,t,n,l)]);return R3e('Adding %c as "%s" to %c',r,t,e),(yield V0(u,d,n,v({allowOverwriting:l.force,cidVersion:e.version},l))).cid})}var O3e=Rr.bind({ignoreUndefined:!0}),L3e={};function rte(n,o){return k(this,arguments,function*(r,e,t={}){let i=O3e(L3e,t),s=yield new C(Lc(r,i.path,e,i)),a=yield new C(qo(s.cid,e));if(a.type==="file"||a.type==="raw"){yield a;return}if(a.content==null)throw new L0;if(a.type!=="directory")throw new Dd;yield*J(a.content({offset:t.offset,length:t.length}))})}var F3e=Rr.bind({ignoreUndefined:!0}),nte=Mt("helia:unixfs:mkdir"),B3e={cidVersion:1,force:!1,shardSplitThresholdBytes:262144};function ote(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=F3e(B3e,n);if(e.includes("/"))throw new mn("Path must not have slashes");if((yield qo(r,t,n)).type!=="directory")throw new Dd(`${r.toString()} was not a UnixFS directory`);nte("creating %s",e);let u={Data:new Qe({type:"directory",mode:a.mode,mtime:a.mtime}).marshal(),Links:[]},d=At(u),h=yield xt.digest(d),p=le.create(a.cidVersion,fn,h);yield t.put(p,d);let[m,w]=yield Promise.all([Td(r,t,a),j0(p,e,t,a)]);return nte("adding empty dir called %s to %c",e,r),(yield V0(m,w,t,I(v({},a),{allowOverwriting:a.force}))).cid})}var xS=Mt("helia:unixfs:utils:remove-link");function ite(r,e,t,n){return f(this,null,function*(){if(r.node.Data==null)throw new xi("Parent node had no data");if(Qe.unmarshal(r.node.Data).type==="hamt-sharded-directory"){xS(`removing ${e} from sharded directory`);let i=yield V3e(r,e,t,n);return(yield wS(i.node,t,n.shardSplitThresholdBytes,n))?i:(xS("converting shard to flat directory %c",r.cid),j3e(i,t,n))}return xS(`removing link ${e} regular directory`),U3e(r,e,t,n)})}var U3e=(r,e,t,n)=>f(null,null,function*(){r.node.Links=r.node.Links.filter(s=>s.Name!==e);let o=At(r.node),i=yield Va(o,t,I(v({},n),{cidVersion:r.cid.version}));return xS(`Updated regular directory ${i}`),{node:r.node,cid:i}}),V3e=(r,e,t,n)=>f(null,null,function*(){let{path:o}=yield vS(r.cid,e,t,n),i=o[o.length-1];if(i==null)throw new Error("Invalid HAMT, could not generate path");let s=i.node.Links.filter(l=>(l.Name??"").substring(2)===e).map(l=>l.Name).pop();if(s==null)throw new Error("File not found");let a=s.substring(0,2),c=parseInt(a,16);if(i.node.Links=i.node.Links.filter(l=>l.Name!==s),i.children.unset(c),i.node.Links.length===1)for(;o.length!==1;){let l=o[o.length-1];if(l==null||l.node.Links.length>1)break;o.pop();let u=o[o.length-1];if(u==null)break;let d=l.node.Links[0];u.node.Links=u.node.Links.filter(h=>!(h.Name??"").startsWith(u.prefix)),u.node.Links.push({Hash:d.Hash,Name:`${u.prefix}${(d.Name??"").substring(2)}`,Tsize:d.Tsize})}return yS(o,t,n)}),j3e=(r,e,t)=>f(null,null,function*(){if(r.node.Data==null)throw new mn("Invalid parent passed to convertToFlatDirectory");let n={Links:[]},o=yield qo(r.cid,e);if(o.type!=="directory")throw new Error("Unexpected node type");try{for(var c=O(o.content()),l,u,d;l=!(u=yield c.next()).done;l=!1){let h=u.value;let p=0;h.node instanceof Uint8Array?p=h.node.byteLength:p=At(h.node).length,n.Links.push({Hash:h.cid,Name:h.name,Tsize:p})}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield u.call(c))}finally{if(d)throw d[0]}}let i=Qe.unmarshal(r.node.Data);n.Data=new Qe({type:"directory",mode:i.mode,mtime:i.mtime}).marshal();let s=At(kr(n));return{cid:yield Va(s,e,{codec:jr,cidVersion:r.cid.version,signal:t.signal}),node:n}});var H3e=Rr.bind({ignoreUndefined:!0}),$3e=Mt("helia:unixfs:rm"),z3e={shardSplitThresholdBytes:262144};function ste(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=H3e(z3e,n);if(e.includes("/"))throw new mn("Name must not have slashes");let c=yield Td(r,t,a);return $3e("Removing %s from %c",e,r),(yield ite(c,e,t,I(v({},a),{cidVersion:r.version}))).cid})}var ate=1877,ES=1604,q3e=Rr.bind({ignoreUndefined:!0}),K3e=Mt("helia:unixfs:stat"),G3e={};function cte(n,o){return f(this,arguments,function*(r,e,t={}){let i=q3e(G3e,t),s=yield Lc(r,t.path,e,i);K3e("stat %c",s.cid);let a=yield qo(s.cid,e,i);if(a.type==="raw")return t.extended===!0?Q3e(a):X3e(a);if(a.type==="file"||a.type==="directory")return t.extended===!0?Y3e(a,e,t.filter??new dg({filterSize:1024}),t):W3e(a);throw new Rc})}function W3e(r){return{type:r.type,cid:r.cid,unixfs:r.unixfs,mode:r.unixfs.mode??(r.unixfs.isDirectory()?ate:ES),mtime:r.unixfs.mtime,size:r.unixfs.fileSize()}}function Y3e(r,e,t,n){return f(this,null,function*(){let o=yield lte(r.cid,e,!1,t,n);return{type:r.type,cid:r.cid,unixfs:r.unixfs,size:r.unixfs.isDirectory()?o.dirSize:r.unixfs.fileSize(),mode:r.unixfs.mode??(r.unixfs.isDirectory()?ate:ES),mtime:r.unixfs.mtime,localSize:o.localSize,dagSize:o.dagSize,deduplicatedDagSize:o.deduplicatedDagSize,blocks:o.blocks,uniqueBlocks:o.uniqueBlocks}})}function X3e(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:ES,mtime:void 0,size:BigInt(r.node.byteLength)}}function Q3e(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:ES,mtime:void 0,size:BigInt(r.node.byteLength),localSize:BigInt(r.node.byteLength),dagSize:BigInt(r.node.byteLength),deduplicatedDagSize:BigInt(r.node.byteLength),blocks:1n,uniqueBlocks:1n}}function lte(r,e,t,n,o){return f(this,null,function*(){let i={dirSize:0n,localSize:0n,dagSize:0n,deduplicatedDagSize:0n,blocks:0n,uniqueBlocks:0n};try{let s=n.has(r.bytes);n.add(r.bytes);let a=yield e.get(r,o);if(i.blocks++,i.dagSize+=BigInt(a.byteLength),s||(i.uniqueBlocks++,i.deduplicatedDagSize+=BigInt(a.byteLength)),r.code===Pr)i.localSize+=BigInt(a.byteLength),t&&(i.dirSize+=BigInt(a.byteLength));else if(r.code===fn){let c=Vr(a),l;if(c.Data!=null&&(l=Qe.unmarshal(c.Data)),c.Links.length>0){for(let u of c.Links){let d=yield lte(u.Hash,e,Z3e(u,l),n,o);i.localSize+=d.localSize,i.dagSize+=d.dagSize,i.deduplicatedDagSize+=d.deduplicatedDagSize,i.blocks+=d.blocks,i.uniqueBlocks+=d.uniqueBlocks,i.dirSize+=d.dirSize}t&&l!=null&&(i.dirSize+=l.fileSize())}else{if(l==null)throw new xi(`PBNode ${r.toString()} had no data`);l.data!=null&&(i.localSize+=BigInt(l.data.byteLength??0)),t&&(i.dirSize+=l.fileSize())}}else throw new Ad(`${r.toString()} was neither DAG_PB nor RAW`)}catch(s){if(s.name!=="NotFoundError"||o.offline!==!0)throw s}return i})}function Z3e(r,e){if(e==null)return!1;let t=r.Name;return t==null?!1:e.type==="directory"?!0:e.type==="hamt-sharded-directory"&&t.length>2}var J3e=Rr.bind({ignoreUndefined:!0}),e4e=Mt("helia:unixfs:touch"),t4e={recursive:!1,shardSplitThresholdBytes:262144};function ute(n,o){return f(this,arguments,function*(r,e,t={}){let i=J3e(t4e,t),s=yield Lc(r,i.path,e,i),a=i.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(e4e("touch %c %o",s.cid,a),i.recursive){let m=yield fr(function(){return k(this,null,function*(){try{for(var w=O(uS(s.cid,e)),E,S,A;E=!(S=yield new C(w.next())).done;E=!1){let M=S.value;let L,F;if(M.type==="raw")L=new Qe({data:M.node}),F=[];else if(M.type==="file"||M.type==="directory")L=M.unixfs,F=M.node.Links;else throw new Rc;L.mtime=a;let Y={Data:L.marshal(),Links:F};yield{path:M.path,content:Y}}}catch{A=[S]}finally{try{E&&(S=w.return)&&(yield new C(S.call(w)))}finally{if(A)throw A[0]}}})},w=>xh(w,e,I(v({},i),{dagBuilder:function(E,S){return k(this,null,function*(){try{for(var A=O(E),M,L,F;M=!(L=yield new C(A.next())).done;M=!1){let Y=L.value;yield function(){return f(this,null,function*(){let H=Y.content,U=At(H),P=yield Va(U,S,I(v({},i),{cidVersion:r.version}));if(H.Data==null)throw new xi(`${P} had no data`);let R=Qe.unmarshal(H.Data);return{cid:P,size:BigInt(U.length),path:Y.path,unixfs:R}})}}}catch{F=[L]}finally{try{M&&(L=A.return)&&(yield new C(L.call(A)))}finally{if(F)throw F[0]}}})}})),w=>f(null,null,function*(){return Ba(w)}));if(m==null)throw new Ad(`Could not chmod ${s.cid.toString()}`);return H0(m.cid,s,e,i)}let c=yield e.get(s.cid,t),l,u=[];if(s.cid.code===Pr)l=new Qe({data:c});else{let m=Vr(c);if(u=m.Links,m.Data==null)throw new xi(`${s.cid.toString()} had no data`);l=Qe.unmarshal(m.Data)}l.mtime=a;let d=At({Data:l.marshal(),Links:u}),h=yield xt.digest(d),p=le.create(s.cid.version,fn,h);return yield e.put(p,d),H0(p,s,e,i)})}var _S=class{components;constructor(e){this.components=e}addAll(n){return k(this,arguments,function*(e,t={}){yield*J(lS(e,this.components.blockstore,t))})}addBytes(n){return f(this,arguments,function*(e,t={}){return See(e,this.components.blockstore,t)})}addByteStream(n){return f(this,arguments,function*(e,t={}){return Cee(e,this.components.blockstore,t)})}addFile(n){return f(this,arguments,function*(e,t={}){return Iee(e,this.components.blockstore,t)})}addDirectory(){return f(this,arguments,function*(e={},t={}){return Aee(e,this.components.blockstore,t)})}cat(n){return k(this,arguments,function*(e,t={}){yield*J(Jee(e,this.components.blockstore,t))})}chmod(o,i){return f(this,arguments,function*(e,t,n={}){return ete(e,t,this.components.blockstore,n)})}cp(i,s,a){return f(this,arguments,function*(e,t,n,o={}){return tte(e,t,n,this.components.blockstore,o)})}ls(n){return k(this,arguments,function*(e,t={}){yield*J(rte(e,this.components.blockstore,t))})}mkdir(o,i){return f(this,arguments,function*(e,t,n={}){return ote(e,t,this.components.blockstore,n)})}rm(o,i){return f(this,arguments,function*(e,t,n={}){return ste(e,t,this.components.blockstore,n)})}stat(n){return f(this,arguments,function*(e,t={}){return cte(e,this.components.blockstore,t)})}touch(n){return f(this,arguments,function*(e,t={}){return ute(e,this.components.blockstore,t)})}};function dte(r){return new _S(r)}var qR=(r,e)=>e.some(t=>r instanceof t),fte,pte;function r4e(){return fte||(fte=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function n4e(){return pte||(pte=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var KR=new WeakMap,$R=new WeakMap,SS=new WeakMap;function o4e(r){let e=new Promise((t,n)=>{let o=()=>{r.removeEventListener("success",i),r.removeEventListener("error",s)},i=()=>{t(Pd(r.result)),o()},s=()=>{n(r.error),o()};r.addEventListener("success",i),r.addEventListener("error",s)});return SS.set(e,r),e}function i4e(r){if(KR.has(r))return;let e=new Promise((t,n)=>{let o=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",s),r.removeEventListener("abort",s)},i=()=>{t(),o()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),o()};r.addEventListener("complete",i),r.addEventListener("error",s),r.addEventListener("abort",s)});KR.set(r,e)}var GR={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return KR.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Pd(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function yte(r){GR=r(GR)}function s4e(r){return n4e().includes(r)?function(...e){return r.apply(WR(this),e),Pd(this.request)}:function(...e){return Pd(r.apply(WR(this),e))}}function a4e(r){return typeof r=="function"?s4e(r):(r instanceof IDBTransaction&&i4e(r),qR(r,r4e())?new Proxy(r,GR):r)}function Pd(r){if(r instanceof IDBRequest)return o4e(r);if($R.has(r))return $R.get(r);let e=a4e(r);return e!==r&&($R.set(r,e),SS.set(e,r)),e}var WR=r=>SS.get(r);function CS(r,e,{blocked:t,upgrade:n,blocking:o,terminated:i}={}){let s=indexedDB.open(r,e),a=Pd(s);return n&&s.addEventListener("upgradeneeded",c=>{n(Pd(s.result),c.oldVersion,c.newVersion,Pd(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function IS(r,{blocked:e}={}){let t=indexedDB.deleteDatabase(r);return e&&t.addEventListener("blocked",n=>e(n.oldVersion,n)),Pd(t).then(()=>{})}var c4e=["get","getKey","getAll","getAllKeys","count"],l4e=["put","add","delete","clear"],zR=new Map;function hte(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(zR.get(e))return zR.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,o=l4e.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(o||c4e.includes(t)))return;let i=function(s,...a){return f(this,null,function*(){let c=this.transaction(s,o?"readwrite":"readonly"),l=c.store;return n&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),o&&c.done]))[0]})};return zR.set(e,i),i}yte(r=>I(v({},r),{get:(e,t,n)=>hte(e,t)||r.get(e,t,n),has:(e,t)=>!!hte(e,t)||r.has(e,t)}));var u4e=["continue","continuePrimaryKey","advance"],mte={},YR=new WeakMap,vte=new WeakMap,d4e={get(r,e){if(!u4e.includes(e))return r[e];let t=mte[e];return t||(t=mte[e]=function(...n){YR.set(this,vte.get(this)[e](...n))}),t}};function f4e(...r){return k(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new C(e.openCursor(...r))),!e)return;e=e;let t=new Proxy(e,d4e);for(vte.set(t,e),SS.set(t,WR(e));e;)yield t,e=yield new C(YR.get(t)||e.continue()),YR.delete(t)})}function gte(r,e){return e===Symbol.asyncIterator&&qR(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&qR(r,[IDBIndex,IDBObjectStore])}yte(r=>I(v({},r),{get(e,t,n){return gte(e,t)?f4e:r.get(e,t,n)},has(e,t){return gte(e,t)||r.has(e,t)}}));var AS=class extends aa{location;version;db;base;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1,this.base=t.base??cN}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return le.createV1(Pr,Ft(this.base.decoder.decode(e.substring(1))))}open(){return f(this,null,function*(){try{let e=this.location;this.db=yield CS(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw new qy(String(e))}})}close(){return f(this,null,function*(){this.db?.close()})}put(e,t,n){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{n?.signal?.throwIfAborted(),yield ut(this.db.put(this.location,t,this.#e(e)),n?.signal)}catch(o){throw new Pu(String(o))}return e})}get(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");let n;try{t?.signal?.throwIfAborted(),n=yield ut(this.db.get(this.location,this.#e(e)),t?.signal)}catch(o){throw new Pu(String(o))}if(n===void 0)throw new ti;return n})}delete(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{t?.signal?.throwIfAborted(),yield ut(this.db.delete(this.location,this.#e(e)),t?.signal)}catch(n){throw new Pu(String(n))}})}has(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{return t?.signal?.throwIfAborted(),!!(yield ut(this.db.getKey(this.location,this.#e(e)),t?.signal))}catch(n){throw new Pu(String(n))}})}getAll(e){return k(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");e?.signal?.throwIfAborted();for(let t of yield new C(this.db.getAllKeys(this.location))){e?.signal?.throwIfAborted();let n=this.#t(t.toString()),o=yield new C(this.get(n,e));yield{cid:n,block:o},e?.signal?.throwIfAborted()}})}destroy(){return f(this,null,function*(){yield IS(this.location)})}};var DS=class extends _a{location;version;db;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1}open(){return f(this,null,function*(){try{let e=this.location;this.db=yield CS(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw new qy(String(e))}})}close(){return f(this,null,function*(){this.db?.close()})}put(e,t,n){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{n?.signal?.throwIfAborted(),yield ut(this.db.put(this.location,t,e.toString()),n?.signal)}catch(o){throw new Pu(String(o))}return e})}get(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");let n;try{t?.signal?.throwIfAborted(),n=yield ut(this.db.get(this.location,e.toString()),t?.signal)}catch(o){throw new XA(String(o))}if(n===void 0)throw new ti;return n})}has(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{return t?.signal?.throwIfAborted(),!!(yield ut(this.db.getKey(this.location,e.toString())))}catch(n){throw new XA(String(n))}})}delete(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{t?.signal?.throwIfAborted(),yield ut(this.db.delete(this.location,e.toString()),t?.signal)}catch(n){throw new QA(String(n))}})}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:n=>f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");n?.signal?.throwIfAborted();let o=this.db.transaction(this.location,"readwrite");try{let i=e.filter(({key:s})=>t.find(a=>a.toString()===s.toString())==null).map(s=>()=>f(this,null,function*(){yield o.store.put(s.value,s.key.toString())})).concat(t.map(s=>()=>f(this,null,function*(){yield o.store.delete(s.toString())}))).concat(()=>f(this,null,function*(){yield o.done}));n?.signal?.throwIfAborted(),yield ut(Promise.all(i.map(s=>f(this,null,function*(){yield s()}))),n?.signal)}catch{o.abort()}})}}query(e,t){return k(this,null,function*(){let n=this.#e(e,(o,i)=>({key:o,value:i}),t);Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>lo(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>np(o,i),n)),yield*J(n)})}queryKeys(e,t){return k(this,null,function*(){let n=this.#e(e,o=>o,t);Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>lo(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>np(o,i),n)),yield*J(n)})}#e(e,t,n){return k(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");let o=0,i=-1;n?.signal?.throwIfAborted();for(let s of yield new C(this.db.getAllKeys(this.location))){if(n?.signal?.throwIfAborted(),e.prefix!=null&&!s.toString().startsWith(e.prefix))continue;if(e.limit!=null&&o===e.limit)return;if(i++,e.offset!=null&&i<e.offset)continue;let a=new Ut(s.toString()),c;try{c=yield new C(this.get(a,n))}catch(l){if(l.name!=="NotFoundError")throw l;continue}c!=null&&(yield t(a,c),n?.signal?.throwIfAborted(),o++)}})}destroy(){return f(this,null,function*(){yield IS(this.location)})}};var Md=class r{constructor(e,t){this.shareLinkService=e}helia;fs;initialized=!1;initPromise;pathToCidStore;PATH_CID_DB="helia-path-mappings";PATH_CID_STORE="pathCidMappings";ensureInitialized(){return f(this,null,function*(){if(!this.initialized){if(this.initPromise){yield this.initPromise;return}this.initPromise=this.initialize(),yield this.initPromise}})}initialize(){return f(this,null,function*(){try{let e=new AS("helia-blocks"),t=new DS("helia-data");yield e.open(),yield t.open(),this.helia=yield KJ({blockstore:e,datastore:t}),this.fs=dte(this.helia),yield this.initializePathCidStore(),this.initialized=!0}catch(e){throw console.error("Failed to initialize Helia:",e),new Error("Helia initialization failed")}})}initializePathCidStore(){return f(this,null,function*(){return new Promise((e,t)=>{let n=indexedDB.open(this.PATH_CID_DB,1);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.pathToCidStore=n.result,e()},n.onupgradeneeded=o=>{let i=o.target.result;if(!i.objectStoreNames.contains(this.PATH_CID_STORE)){let s=i.createObjectStore(this.PATH_CID_STORE,{keyPath:"path"});s.createIndex("cid","cid",{unique:!1}),s.createIndex("timestamp","timestamp",{unique:!1})}}})})}write(e,t){return f(this,null,function*(){if(yield this.ensureInitialized(),!this.fs)throw new Error("Helia not initialized");try{let n=yield this.fs.addBytes(t);yield this.savePathCidMapping(e,n.toString()),console.log(`Stored ${e} in Helia with CID: ${n}`)}catch(n){throw console.error("Failed to write to Helia:",n),n}})}read(e){return f(this,null,function*(){if(yield this.ensureInitialized(),!this.fs)throw new Error("Helia not initialized");try{let t=yield this.getCidForPathPrivate(e);if(!t)throw new Error(`No content found for path: ${e}`);let{CID:n}=yield import("./chunk-EYCWZAI7.js"),o=n.parse(t),i=yield Ea(this.fs.cat(o)),s=i.reduce((l,u)=>l+u.length,0),a=new Uint8Array(s),c=0;for(let l of i)a.set(l,c),c+=l.length;return a}catch(t){throw console.error("Failed to read from Helia:",t),t}})}exists(e){return f(this,null,function*(){return yield this.ensureInitialized(),(yield this.getCidForPathPrivate(e))!==null})}delete(e){return f(this,null,function*(){yield this.ensureInitialized(),yield this.deletePathCidMapping(e)})}list(){return f(this,null,function*(){return yield this.ensureInitialized(),this.pathToCidStore?new Promise((e,t)=>{let i=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).getAllKeys();i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)}):[]})}savePathCidMapping(e,t){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((n,o)=>{let a=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readwrite").objectStore(this.PATH_CID_STORE).put({path:e,cid:t,timestamp:new Date().toISOString()});a.onsuccess=()=>n(),a.onerror=()=>o(a.error)})})}getCidForPathPrivate(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).get(e);s.onsuccess=()=>{let a=s.result;t(a?a.cid:null)},s.onerror=()=>n(s.error)})})}deletePathCidMapping(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readwrite").objectStore(this.PATH_CID_STORE).delete(e);s.onsuccess=()=>t(),s.onerror=()=>n(s.error)})})}getStats(){return f(this,null,function*(){return yield this.ensureInitialized(),{blockCount:0,totalSize:0,pathCount:(yield this.list()).length}})}isHealthy(){return f(this,null,function*(){try{return yield this.ensureInitialized(),this.initialized&&this.helia!==void 0}catch{return!1}})}generateShareLink(e,t){return f(this,null,function*(){let n=yield this.getCidForPath(e);return n?this.shareLinkService.generateShareLink(n,{filename:t}):null})}generateMultipleShareLinks(e,t){return f(this,null,function*(){let n=yield this.getCidForPath(e);return n?this.shareLinkService.generateMultipleShareLinks(n,{filename:t}):[]})}getCidForPath(e){return f(this,null,function*(){return yield this.ensureInitialized(),yield this.getCidForPathInternal(e)})}getCidForPathInternal(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).get(e);s.onsuccess=()=>{let a=s.result;t(a?a.cid:null)},s.onerror=()=>n(s.error)})})}ngOnDestroy(){this.helia&&this.helia.stop().catch(e=>{console.error("Error stopping Helia:",e)}),this.pathToCidStore&&this.pathToCidStore.close()}static \u0275fac=function(t){return new(t||r)(xe(Am),xe(ra))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};function h4e(r,e){r&1&&(b(0,"p",12),_(1," IndexedDB is not available in your browser. "),y())}function m4e(r,e){r&1&&(b(0,"p",12),_(1," Warning: IPFS node not detected. Make sure IPFS is running on localhost:5001. "),y())}function g4e(r,e){r&1&&(b(0,"p",13),_(1," Note: Data is stored locally in IndexedDB and works offline. "),y())}function y4e(r,e){if(r&1){let t=nt();b(0,"div",14)(1,"p")(2,"strong"),_(3,"Important:"),y(),_(4," Changing storage type will require a page reload. Your current in-memory data will be lost unless you're switching to IndexedDB. "),y(),b(5,"button",15),_e("click",function(){Re(t);let o=G();return Ne(o.applyChanges())}),_(6," Apply Changes & Reload "),y(),b(7,"button",16),_e("click",function(){Re(t);let o=G();return Ne(o.cancelChanges())}),_(8," Cancel "),y()()}}function v4e(r,e){if(r&1&&(b(0,"p"),_(1),y()),r&2){let t=G(3);D(),je("API Endpoint: ",t.ipfsConfig.apiEndpoint||"/api/v0")}}function w4e(r,e){if(r&1&&(b(0,"div",21)(1,"p"),_(2,"IPFS Status: "),b(3,"span"),_(4),y()(),ye(5,v4e,2,1,"p",22),y()),r&2){let t=G(2);D(3),Rn("healthy",t.ipfsHealthy)("unhealthy",!t.ipfsHealthy),D(),Se(t.ipfsHealthy?"Connected":"Disconnected"),D(),z("ngIf",t.ipfsHealthy&&t.ipfsConfig)}}function b4e(r,e){r&1&&(b(0,"p"),_(1,"Browser-native IPFS node active"),y())}function x4e(r,e){if(r&1&&(b(0,"div",21)(1,"p"),_(2,"Helia Status: "),b(3,"span"),_(4),y()(),ye(5,b4e,2,0,"p",22),y()),r&2){let t=G(2);D(3),Rn("healthy",t.heliaHealthy)("unhealthy",!t.heliaHealthy),D(),Se(t.heliaHealthy?"Running":"Not Initialized"),D(),z("ngIf",t.heliaHealthy)}}function E4e(r,e){r&1&&(b(0,"a",23)(1,"button",24),_(2," Migrate to IPFS/Helia \u2192 "),y()())}function _4e(r,e){if(r&1){let t=nt();b(0,"div",1)(1,"h3"),_(2,"Storage Management"),y(),b(3,"div",17)(4,"p"),_(5,"Current storage provider: "),b(6,"strong"),_(7),y()(),ye(8,w4e,6,6,"div",18)(9,x4e,6,6,"div",18),b(10,"button",19),_e("click",function(){Re(t);let o=G();return Ne(o.clearStorage())}),_(11," Clear All Local Data "),y(),ye(12,E4e,3,0,"a",20),y()()}if(r&2){let t=G();D(7),Se(t.getStorageProviderName()),D(),z("ngIf",t.currentStorageType===t.StorageType.IPFS),D(),z("ngIf",t.currentStorageType===t.StorageType.HELIA),D(3),z("ngIf",t.canMigrate())}}var TS=class r{constructor(e,t,n){this.storageType=e;this.storageProvider=t;this.currentStorageType=this.storageType,this.selectedStorageType=this.storageType,this.ipfsConfig=n||null}StorageType=hu;selectedStorageType;currentStorageType;indexedDbAvailable=!1;storageChanged=!1;ipfsHealthy=!1;heliaHealthy=!1;ipfsConfig=null;ngOnInit(){this.checkIndexedDbAvailability(),this.checkIPFSHealth(),this.checkHeliaHealth()}checkIndexedDbAvailability(){this.indexedDbAvailable=typeof window<"u"&&"indexedDB"in window}checkIPFSHealth(){return f(this,null,function*(){if(this.currentStorageType==="ipfs"&&this.storageProvider instanceof xu)try{this.ipfsHealthy=yield this.storageProvider.isHealthy()}catch{this.ipfsHealthy=!1}})}checkHeliaHealth(){return f(this,null,function*(){if(this.currentStorageType==="helia"&&this.storageProvider instanceof Md)try{this.heliaHealthy=yield this.storageProvider.isHealthy()}catch{this.heliaHealthy=!1}})}onStorageTypeChange(){this.storageChanged=this.selectedStorageType!==this.currentStorageType,this.selectedStorageType==="ipfs"&&this.checkIPFSHealthForSelection()}checkIPFSHealthForSelection(){return f(this,null,function*(){this.ipfsHealthy=!1})}applyChanges(){this.selectedStorageType!==this.currentStorageType&&(localStorage.setItem("cas-storage-type",this.selectedStorageType),this.reloadPage())}reloadPage(){window.location.reload()}cancelChanges(){this.selectedStorageType=this.currentStorageType,this.storageChanged=!1}clearStorage(){return f(this,null,function*(){if(confirm("Are you sure you want to clear all stored data? This action cannot be undone."))try{this.currentStorageType==="indexed-db"?(yield indexedDB.deleteDatabase("cas-storage"),alert("Storage cleared successfully. The page will reload."),this.reloadPage()):this.currentStorageType==="ipfs"?(yield indexedDB.deleteDatabase("cas-storage"),alert("Local cache cleared successfully. IPFS content remains on the network."),this.reloadPage()):this.currentStorageType==="helia"&&(yield indexedDB.deleteDatabase("helia-blocks"),yield indexedDB.deleteDatabase("helia-data"),yield indexedDB.deleteDatabase("helia-path-mappings"),alert("Helia storage cleared successfully. The page will reload."),this.reloadPage())}catch(e){console.error("Error clearing storage:",e),alert("Failed to clear storage. Please try again.")}})}getStorageProviderName(){switch(this.currentStorageType){case"in-memory":return"In-Memory";case"indexed-db":return"IndexedDB";case"ipfs":return"IPFS (External Node)";case"helia":return"Helia (Browser IPFS)";default:return"Unknown"}}canMigrate(){return this.currentStorageType==="in-memory"||this.currentStorageType==="indexed-db"}static \u0275fac=function(t){return new(t||r)(oe(ea),oe(gs),oe(ra,8))};static \u0275cmp=Qt({type:r,selectors:[["app-storage-settings"]],decls:42,vars:16,consts:[[1,"storage-settings"],[1,"settings-section"],[1,"description"],[1,"storage-options"],[1,"storage-option"],["type","radio","name","storageType",3,"ngModelChange","change","value","ngModel"],[1,"option-content"],["type","radio","name","storageType",3,"ngModelChange","change","value","ngModel","disabled"],["class","warning",4,"ngIf"],["class","info",4,"ngIf"],["class","info-message",4,"ngIf"],["class","settings-section",4,"ngIf"],[1,"warning"],[1,"info"],[1,"info-message"],[1,"apply-button",3,"click"],[1,"cancel-button",3,"click"],[1,"storage-info"],["class","ipfs-info",4,"ngIf"],[1,"danger-button",3,"click"],["routerLink","/settings/migration","class","migration-link",4,"ngIf"],[1,"ipfs-info"],[4,"ngIf"],["routerLink","/settings/migration",1,"migration-link"],[1,"migrate-button"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"h2"),_(2,"Storage Settings"),y(),b(3,"div",1)(4,"h3"),_(5,"Storage Provider"),y(),b(6,"p",2),_(7," Choose how your content is stored. In-memory storage is faster but data is lost when you close the browser. IndexedDB provides persistent storage across browser sessions. IPFS provides distributed storage across the network. "),y(),b(8,"div",3)(9,"label",4)(10,"input",5),wr("ngModelChange",function(i){return Tr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),_e("change",function(){return n.onStorageTypeChange()}),y(),b(11,"div",6)(12,"strong"),_(13,"In-Memory Storage"),y(),b(14,"p"),_(15,"Fast, temporary storage. Data is lost when browser closes."),y()()(),b(16,"label",4)(17,"input",7),wr("ngModelChange",function(i){return Tr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),_e("change",function(){return n.onStorageTypeChange()}),y(),b(18,"div",6)(19,"strong"),_(20,"IndexedDB Storage"),y(),b(21,"p"),_(22,"Persistent storage. Data is saved across browser sessions."),y(),ye(23,h4e,2,0,"p",8),y()(),b(24,"label",4)(25,"input",5),wr("ngModelChange",function(i){return Tr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),_e("change",function(){return n.onStorageTypeChange()}),y(),b(26,"div",6)(27,"strong"),_(28,"IPFS Storage (External Node)"),y(),b(29,"p"),_(30,"Distributed storage using IPFS network. Requires local IPFS node or gateway."),y(),ye(31,m4e,2,0,"p",8),y()(),b(32,"label",4)(33,"input",5),wr("ngModelChange",function(i){return Tr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),_e("change",function(){return n.onStorageTypeChange()}),y(),b(34,"div",6)(35,"strong"),_(36,"Helia Storage (Browser-Native IPFS)"),y(),b(37,"p"),_(38,"IPFS running directly in your browser. No external node required. Larger download size (~2-3MB)."),y(),ye(39,g4e,2,0,"p",9),y()()(),ye(40,y4e,9,0,"div",10),y(),ye(41,_4e,13,4,"div",11),y()),t&2&&(D(10),z("value",n.StorageType.IN_MEMORY),vr("ngModel",n.selectedStorageType),D(6),Rn("disabled",!n.indexedDbAvailable),D(),z("value",n.StorageType.INDEXED_DB),vr("ngModel",n.selectedStorageType),z("disabled",!n.indexedDbAvailable),D(6),z("ngIf",!n.indexedDbAvailable),D(2),z("value",n.StorageType.IPFS),vr("ngModel",n.selectedStorageType),D(6),z("ngIf",n.selectedStorageType===n.StorageType.IPFS&&!n.ipfsHealthy),D(2),z("value",n.StorageType.HELIA),vr("ngModel",n.selectedStorageType),D(6),z("ngIf",n.selectedStorageType===n.StorageType.HELIA),D(),z("ngIf",n.storageChanged),D(),z("ngIf",n.currentStorageType!==n.StorageType.IN_MEMORY))},dependencies:[Zt,Ur,ws,Qo,G9,ys,ta,Ro,ms],styles:[".storage-settings[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.settings-section[_ngcontent-%COMP%]{background-color:#f9f9f9;border-radius:8px;padding:20px;margin-bottom:20px}.settings-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.description[_ngcontent-%COMP%]{color:#666;margin-bottom:20px}.storage-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.storage-option[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding:15px;background-color:#fff;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .3s}.storage-option[_ngcontent-%COMP%]:hover:not(.disabled){border-color:#3498db;box-shadow:0 2px 4px #0000001a}.storage-option.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.storage-option[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:15px;margin-top:5px}.option-content[_ngcontent-%COMP%]{flex:1}.option-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#333}.option-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.warning[_ngcontent-%COMP%]{color:#e74c3c!important;font-style:italic;margin-top:5px!important}.info[_ngcontent-%COMP%]{color:#3498db!important;font-style:italic;margin-top:5px!important}.info-message[_ngcontent-%COMP%]{margin-top:20px;padding:15px;background-color:#e8f4fd;border:1px solid #3498db;border-radius:4px}.info-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 15px;color:#2c3e50}.apply-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;margin-right:10px}.apply-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.apply-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.cancel-button[_ngcontent-%COMP%]{background-color:#95a5a6;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#7f8c8d}.storage-info[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px}.storage-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 15px}.danger-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#e74c3c;color:#fff;border:none;border-radius:4px;cursor:pointer}.danger-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}.ipfs-info[_ngcontent-%COMP%]{margin-bottom:15px}.ipfs-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.healthy[_ngcontent-%COMP%]{color:#27ae60;font-weight:700}.unhealthy[_ngcontent-%COMP%]{color:#e74c3c;font-weight:700}.migration-link[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;margin-left:10px}.migrate-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#8e44ad;color:#fff;border:none;border-radius:4px;cursor:pointer}.migrate-button[_ngcontent-%COMP%]:hover{background-color:#9b59b6}"]})};var PS=class r{constructor(e,t){this.currentStorageProvider=e;this.currentStorageType=t}progressSubject=new un({totalItems:0,processedItems:0,successfulItems:0,failedItems:0,status:"idle",errors:[]});cancelSubject=new qt;isRunning=!1;isCancelled=!1;progress$=this.progressSubject.asObservable();migrateToIPFS(n){return f(this,arguments,function*(e,t={}){if(this.isRunning)throw new Error("Migration is already in progress");if(this.currentStorageProvider===e)throw new Error("Cannot migrate to the same storage provider");this.isRunning=!0,this.isCancelled=!1,this.cancelSubject=new qt;let{batchSize:o=10,deleteAfterMigration:i=!1,skipExisting:s=!0,filter:a}=t;try{this.updateProgress({status:"preparing"});let c=yield this.currentStorageProvider.list(),l=a?c.filter(a):c;this.updateProgress({totalItems:l.length,processedItems:0,successfulItems:0,failedItems:0,status:"migrating",errors:[]});for(let d=0;d<l.length;d+=o){if(this.isCancelled){this.updateProgress({status:"failed"});break}let h=l.slice(d,d+o);yield this.processBatch(h,e,s,i)}return this.progressSubject.value.failedItems===0?this.updateProgress({status:"completed"}):this.updateProgress({status:"failed"}),this.progressSubject.value}finally{this.isRunning=!1}})}processBatch(e,t,n,o){return f(this,null,function*(){let i=e.map(s=>this.migrateItem(s,t,n,o));yield Promise.all(i)})}migrateItem(e,t,n,o){return f(this,null,function*(){try{if(this.updateProgress({currentItem:e}),n&&(yield t.exists(e))){this.incrementProgress(!0);return}let i=yield this.currentStorageProvider.read(e);yield t.write(e,i),o&&(yield this.currentStorageProvider.delete(e)),this.incrementProgress(!0)}catch(i){let s=i instanceof Error?i.message:"Unknown error";this.incrementProgress(!1,{path:e,error:s})}})}incrementProgress(e,t){let n=this.progressSubject.value;e?this.updateProgress({processedItems:n.processedItems+1,successfulItems:n.successfulItems+1}):this.updateProgress({processedItems:n.processedItems+1,failedItems:n.failedItems+1,errors:t?[...n.errors,t]:n.errors})}cancelMigration(){this.isRunning&&(this.isCancelled=!0,this.cancelSubject.next(),this.cancelSubject.complete())}getMigrationStats(){return{canMigrate:this.currentStorageType!=="ipfs"&&this.currentStorageType!=="helia",currentStorageType:this.currentStorageType,estimatedItems:void 0}}estimateMigrationSize(){return f(this,null,function*(){let e=yield this.currentStorageProvider.list(),t=0,n=Math.min(10,e.length),o=0;for(let a=0;a<n;a++)try{let c=yield this.currentStorageProvider.read(e[a]);o+=c.length}catch{}let i=n>0?o/n:0;t=Math.round(i*e.length);let s=Math.round(t/(1024*1024));return{itemCount:e.length,totalSize:t,estimatedTime:s}})}updateProgress(e){this.progressSubject.next(v(v({},this.progressSubject.value),e))}reset(){this.progressSubject.next({totalItems:0,processedItems:0,successfulItems:0,failedItems:0,status:"idle",errors:[]})}isMigrationRunning(){return this.isRunning}static \u0275fac=function(t){return new(t||r)(xe(gs),xe(ea))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};function C4e(r,e){if(r&1&&(b(0,"div",3)(1,"p",4),_(2),y()()),r&2){let t=G();D(2),je(" Your content is already stored in ",t.currentStorageType,". Migration is only available when using In-Memory or IndexedDB storage. ")}}function I4e(r,e){if(r&1&&(b(0,"div",11)(1,"h4"),_(2,"Migration Estimate"),y(),b(3,"div",12)(4,"div",13)(5,"span",14),_(6,"Total Items:"),y(),b(7,"span",15),_(8),y()(),b(9,"div",13)(10,"span",14),_(11,"Total Size:"),y(),b(12,"span",15),_(13),y()(),b(14,"div",13)(15,"span",14),_(16,"Estimated Time:"),y(),b(17,"span",15),_(18),y()()()()),r&2){let t=G(2);D(8),Se(t.estimate.itemCount),D(5),Se(t.formatBytes(t.estimate.totalSize)),D(5),Se(t.formatTime(t.estimate.estimatedTime))}}function A4e(r,e){if(r&1){let t=nt();b(0,"div",16)(1,"h4"),_(2,"Migration Options"),y(),b(3,"div",17)(4,"label"),_(5,"Target Storage:"),y(),b(6,"select",18),wr("ngModelChange",function(o){Re(t);let i=G(2);return Tr(i.targetStorageType,o)||(i.targetStorageType=o),Ne(o)}),b(7,"option",19),_(8,"IPFS (External Node)"),y(),b(9,"option",19),_(10,"Helia (Browser IPFS)"),y()()(),b(11,"div",17)(12,"label")(13,"input",20),wr("ngModelChange",function(o){Re(t);let i=G(2);return Tr(i.options.deleteAfterMigration,o)||(i.options.deleteAfterMigration=o),Ne(o)}),y(),_(14," Delete files from source after successful migration "),y()(),b(15,"div",17)(16,"label")(17,"input",20),wr("ngModelChange",function(o){Re(t);let i=G(2);return Tr(i.options.skipExisting,o)||(i.options.skipExisting=o),Ne(o)}),y(),_(18," Skip files that already exist in target "),y()(),b(19,"div",17)(20,"label"),_(21,"Batch Size:"),y(),b(22,"input",21),wr("ngModelChange",function(o){Re(t);let i=G(2);return Tr(i.options.batchSize,o)||(i.options.batchSize=o),Ne(o)}),y()(),b(23,"div",22)(24,"button",23),_e("click",function(){Re(t);let o=G(2);return Ne(o.estimateMigration())}),_(25),y(),b(26,"button",24),_e("click",function(){Re(t);let o=G(2);return Ne(o.startMigration())}),_(27," Start Migration "),y()()()}if(r&2){let t=G(2);D(6),vr("ngModel",t.targetStorageType),D(),z("value",t.StorageType.IPFS),D(2),z("value",t.StorageType.HELIA),D(4),vr("ngModel",t.options.deleteAfterMigration),D(4),vr("ngModel",t.options.skipExisting),D(5),vr("ngModel",t.options.batchSize),D(2),z("disabled",t.isEstimating),D(),je(" ",t.isEstimating?"Estimating...":"Estimate Migration"," "),D(),z("disabled",!t.targetStorageType)}}function D4e(r,e){if(r&1&&(b(0,"div",29)(1,"span",14),_(2,"Failed:"),y(),b(3,"span",34),_(4),y()()),r&2){let t=G(3);D(4),Se(t.progress.failedItems)}}function T4e(r,e){if(r&1&&(b(0,"div",29)(1,"span",14),_(2,"Current File:"),y(),b(3,"span",15),_(4),y()()),r&2){let t=G(3);D(4),Se(t.progress.currentItem)}}function P4e(r,e){if(r&1&&(b(0,"li")(1,"strong"),_(2),y(),_(3),y()),r&2){let t=e.$implicit;D(2),je("",t.path,":"),D(),je(" ",t.error," ")}}function M4e(r,e){if(r&1&&(b(0,"div",35)(1,"h5"),_(2,"Errors:"),y(),b(3,"ul",36),ye(4,P4e,4,2,"li",37),y()()),r&2){let t=G(3);D(4),z("ngForOf",t.progress.errors)}}function k4e(r,e){if(r&1){let t=nt();b(0,"div",25)(1,"h4"),_(2,"Migration Progress"),y(),b(3,"div",26),Bt(4,"div",27),y(),b(5,"div",28)(6,"div",29)(7,"span",14),_(8,"Status:"),y(),b(9,"span",15),_(10),y()(),b(11,"div",29)(12,"span",14),_(13,"Progress:"),y(),b(14,"span",15),_(15),y()(),b(16,"div",29)(17,"span",14),_(18,"Successful:"),y(),b(19,"span",30),_(20),y()(),ye(21,D4e,5,1,"div",31)(22,T4e,5,1,"div",31),y(),ye(23,M4e,5,1,"div",32),b(24,"div",22)(25,"button",33),_e("click",function(){Re(t);let o=G(2);return Ne(o.cancelMigration())}),_(26," Cancel Migration "),y()()()}if(r&2){let t=G(2);D(4),D3("width",t.getProgressPercentage(),"%"),Rn("error",t.progress.status==="failed"),D(5),PI(t.progress.status),D(),Se(t.progress.status),D(5),R1("",t.progress.processedItems," / ",t.progress.totalItems),D(5),Se(t.progress.successfulItems),D(),z("ngIf",t.progress.failedItems>0),D(),z("ngIf",t.progress.currentItem),D(),z("ngIf",t.progress.errors.length>0)}}function R4e(r,e){if(r&1){let t=nt();b(0,"div",38)(1,"div",39)(2,"h4"),_(3,"Migration Completed Successfully!"),y(),b(4,"p"),_(5),y(),b(6,"p",40),_(7," Remember to update your storage settings to use the new storage provider. "),y()(),b(8,"button",41),_e("click",function(){Re(t);let o=G(2);return Ne(o.resetMigration())}),_(9," Start New Migration "),y()()}if(r&2){let t=G(2);D(5),R1("All ",t.progress.successfulItems," items have been migrated to ",t.targetStorageType,".")}}function N4e(r,e){if(r&1&&(b(0,"div",5)(1,"div",6)(2,"h3"),_(3,"Migrate to Distributed Storage"),y(),b(4,"p"),_(5),y()(),ye(6,I4e,19,3,"div",7)(7,A4e,28,9,"div",8)(8,k4e,27,13,"div",9)(9,R4e,10,2,"div",10),y()),r&2){let t=G();D(5),je(" Transfer your content from ",t.getStorageTypeName(t.currentStorageType)," to a distributed storage system (IPFS or Helia). "),D(),z("ngIf",!t.isRunning&&t.estimate),D(),z("ngIf",!t.isRunning),D(),z("ngIf",t.isRunning&&t.progress),D(),z("ngIf",!t.isRunning&&t.progress&&t.progress.status==="completed")}}var MS=class r{constructor(e,t,n,o,i){this.migrationService=e;this.ipfsStorage=o;this.heliaStorage=i;this.currentStorageType=t}StorageType=hu;canMigrate=!1;currentStorageType;targetStorageType;isRunning=!1;isEstimating=!1;progress;estimate;options={batchSize:10,deleteAfterMigration:!1,skipExisting:!0};destroy$=new qt;ngOnInit(){let e=this.migrationService.getMigrationStats();this.canMigrate=e.canMigrate,this.migrationService.progress$.pipe(Hc(this.destroy$)).subscribe(t=>{this.progress=t,this.isRunning=t.status==="preparing"||t.status==="migrating"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}estimateMigration(){return f(this,null,function*(){this.isEstimating=!0;try{this.estimate=yield this.migrationService.estimateMigrationSize()}catch(e){console.error("Failed to estimate migration:",e),this.estimate=void 0}finally{this.isEstimating=!1}})}startMigration(){return f(this,null,function*(){if(!this.targetStorageType)return;let e=this.targetStorageType==="ipfs"?this.ipfsStorage:this.heliaStorage;try{yield this.migrationService.migrateToIPFS(e,this.options)}catch(t){console.error("Migration failed:",t)}})}cancelMigration(){this.migrationService.cancelMigration()}resetMigration(){this.migrationService.reset(),this.estimate=void 0,this.targetStorageType=void 0}getProgressPercentage(){return!this.progress||this.progress.totalItems===0?0:this.progress.processedItems/this.progress.totalItems*100}getStorageTypeName(e){switch(e){case"in-memory":return"In-Memory Storage";case"indexed-db":return"IndexedDB";case"ipfs":return"IPFS";case"helia":return"Helia";default:return"Unknown"}}formatBytes(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}formatTime(e){return e<60?`${e} seconds`:e<3600?`${Math.floor(e/60)} minutes`:`${Math.floor(e/3600)} hours`}static \u0275fac=function(t){return new(t||r)(oe(PS),oe(ea),oe(gs),oe(xu),oe(Md))};static \u0275cmp=Qt({type:r,selectors:[["app-migration"]],decls:5,vars:2,consts:[[1,"migration-container"],["class","migration-info",4,"ngIf"],["class","migration-content",4,"ngIf"],[1,"migration-info"],[1,"info-message"],[1,"migration-content"],[1,"migration-overview"],["class","migration-estimate",4,"ngIf"],["class","migration-options",4,"ngIf"],["class","migration-progress",4,"ngIf"],["class","migration-complete",4,"ngIf"],[1,"migration-estimate"],[1,"estimate-details"],[1,"estimate-item"],[1,"label"],[1,"value"],[1,"migration-options"],[1,"option-group"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],["type","checkbox",3,"ngModelChange","ngModel"],["type","number","min","1","max","50",1,"form-input",3,"ngModelChange","ngModel"],[1,"action-buttons"],[1,"btn-secondary",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"migration-progress"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-details"],[1,"progress-item"],[1,"value","success"],["class","progress-item",4,"ngIf"],["class","migration-errors",4,"ngIf"],[1,"btn-danger",3,"click"],[1,"value","error"],[1,"migration-errors"],[1,"error-list"],[4,"ngFor","ngForOf"],[1,"migration-complete"],[1,"success-message"],[1,"note"],[1,"btn-primary",3,"click"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"h2"),_(2,"Storage Migration"),y(),ye(3,C4e,3,1,"div",1)(4,N4e,10,5,"div",2),y()),t&2&&(D(3),z("ngIf",!n.canMigrate),D(),z("ngIf",n.canMigrate))},dependencies:[Zt,Xo,Ur,Ro,Ja,ec,Qo,K9,V9,vs,ys,X9,Y9,ta],styles:[".migration-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.migration-info[_ngcontent-%COMP%]{background-color:#f0f8ff;padding:20px;border-radius:8px;margin-bottom:20px}.info-message[_ngcontent-%COMP%]{margin:0;color:#06c}.migration-content[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:20px;border-radius:8px}.migration-overview[_ngcontent-%COMP%]{margin-bottom:30px}.migration-overview[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333}.migration-estimate[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:8px;margin-bottom:20px}.estimate-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:10px}.estimate-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;background-color:#f5f5f5;border-radius:4px}.label[_ngcontent-%COMP%]{font-weight:500;color:#666}.value[_ngcontent-%COMP%]{font-weight:600;color:#333}.migration-options[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;margin-bottom:20px}.option-group[_ngcontent-%COMP%]{margin-bottom:15px}.option-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.form-select[_ngcontent-%COMP%], .form-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.form-input[_ngcontent-%COMP%]{width:100px}input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2980b9}.btn-secondary[_ngcontent-%COMP%]{background-color:#95a5a6;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#7f8c8d}.btn-danger[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.migration-progress[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px}.progress-bar[_ngcontent-%COMP%]{width:100%;height:30px;background-color:#e0e0e0;border-radius:15px;overflow:hidden;margin-bottom:20px}.progress-fill[_ngcontent-%COMP%]{height:100%;background-color:#3498db;transition:width .3s ease}.progress-fill.error[_ngcontent-%COMP%]{background-color:#e74c3c}.progress-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:20px}.progress-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;background-color:#f5f5f5;border-radius:4px}.value.preparing[_ngcontent-%COMP%], .value.migrating[_ngcontent-%COMP%]{color:#3498db}.value.completed[_ngcontent-%COMP%], .value.success[_ngcontent-%COMP%]{color:#27ae60}.value.failed[_ngcontent-%COMP%], .value.error[_ngcontent-%COMP%]{color:#e74c3c}.migration-errors[_ngcontent-%COMP%]{background-color:#fee;padding:15px;border-radius:8px;margin-top:20px}.migration-errors[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-top:0;color:#c0392b}.error-list[_ngcontent-%COMP%]{margin:0;padding-left:20px;font-size:14px}.migration-complete[_ngcontent-%COMP%]{text-align:center;padding:20px}.success-message[_ngcontent-%COMP%]{background-color:#d4edda;padding:20px;border-radius:8px;margin-bottom:20px}.success-message[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;color:#155724}.note[_ngcontent-%COMP%]{font-style:italic;color:#666;margin-top:10px}"]})};var XR=(o=>(o.CREATOR="creator",o.EDITOR="editor",o.CONTRIBUTOR="contributor",o.REVIEWER="reviewer",o))(XR||{});function QR(r){return r&&typeof r.timestamp=="number"&&Array.isArray(r.references)&&Array.isArray(r.authors)&&r.version&&typeof r.version.version=="string"}function wte(r){let e={version:r.version||"1.0.0"};return r.previousVersion!==void 0&&(e.previousVersion=r.previousVersion),r.changeDescription!==void 0&&(e.changeDescription=r.changeDescription),{timestamp:Date.now(),references:r.references,authors:r.authors,version:e}}var $0=class r{constructor(e){this.disotService=e}createMetadataEntry(e,t){return f(this,null,function*(){if(!QR(e))throw new Error("Invalid metadata content");return this.disotService.createEntry(e,"metadata",t)})}getMetadataContent(e){return f(this,null,function*(){let t=yield this.disotService.getEntry(e);if(t.type!=="metadata")throw new Error("Entry is not a metadata entry");let n=t.metadata;if(!QR(n))throw new Error("Invalid metadata content");return n})}updateMetadataEntry(e,t,n){return f(this,null,function*(){let o=yield this.getMetadataContent(e),i=I(v(v({},o),t),{timestamp:Date.now(),version:I(v(v({},o.version),t.version),{previousVersion:e})});return this.createMetadataEntry(i,n)})}findByReference(e){return f(this,null,function*(){return(yield this.disotService.listEntries({type:"metadata"})).filter(n=>n.metadata?.references?.some(i=>i.hash===e)??!1)})}findByAuthor(e){return f(this,null,function*(){return(yield this.disotService.listEntries({type:"metadata"})).filter(n=>n.metadata?.authors?.some(i=>i.authorHash===e)??!1)})}getVersionHistory(e){return f(this,null,function*(){let t=[],n=e;for(;n;)try{let o=yield this.disotService.getEntry(n);t.push(o),n=o.metadata?.version?.previousVersion||""}catch{break}return t})}static \u0275fac=function(t){return new(t||r)(xe(tc))};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};function O4e(r,e){if(r&1){let t=nt();b(0,"button",33),_e("click",function(){Re(t);let o=G().index,i=G();return Ne(i.removeReference(o))}),_(1," Remove Reference "),y()}}function L4e(r,e){if(r&1){let t=nt();b(0,"div",24)(1,"div",25)(2,"div")(3,"label",11),_(4,"Content Hash *"),y(),b(5,"div",13),Bt(6,"input",26),b(7,"button",15),_e("click",function(){let o=Re(t).index,i=G();return Ne(i.openHashSelector(o))}),_(8," Browse "),y()()(),b(9,"div")(10,"label",11),_(11,"MIME Type *"),y(),Bt(12,"input",27),y(),b(13,"div")(14,"label",11),_(15,"MIME Type Source *"),y(),b(16,"select",28)(17,"option",29),_(18,"Manual"),y(),b(19,"option",30),_(20,"Detected"),y()()(),b(21,"div")(22,"label",11),_(23,"Relationship"),y(),Bt(24,"input",31),y()(),ye(25,O4e,2,0,"button",32),y()}if(r&2){let t=e.index,n=G();z("formGroupName",t),D(25),z("ngIf",n.references.length>1)}}function F4e(r,e){if(r&1&&(b(0,"option",37),_(1),Ti(2,"titlecase"),y()),r&2){let t=e.$implicit;z("value",t),D(),je(" ",Zc(2,2,t)," ")}}function B4e(r,e){if(r&1){let t=nt();b(0,"button",33),_e("click",function(){Re(t);let o=G().index,i=G();return Ne(i.removeAuthor(o))}),_(1," Remove Author "),y()}}function U4e(r,e){if(r&1){let t=nt();b(0,"div",24)(1,"div",25)(2,"div")(3,"label",11),_(4,"Author Hash *"),y(),b(5,"div",13),Bt(6,"input",34),b(7,"button",15),_e("click",function(){let o=Re(t).index,i=G();return Ne(i.openAuthorHashSelector(o))}),_(8," Browse "),y()()(),b(9,"div")(10,"label",11),_(11,"Role *"),y(),b(12,"select",35),ye(13,F4e,3,4,"option",36),y()()(),ye(14,B4e,2,0,"button",32),y()}if(r&2){let t=e.index,n=G();z("formGroupName",t),D(13),z("ngForOf",n.authorRoles),D(),z("ngIf",n.authors.length>1)}}function V4e(r,e){if(r&1){let t=nt();b(0,"div",38)(1,"p",39),_(2,"You need a key pair to sign the metadata entry."),y(),b(3,"button",40),_e("click",function(){Re(t);let o=G();return Ne(o.generateKeyPair())}),_(4," Generate Key Pair "),y()()}}function j4e(r,e){if(r&1&&(b(0,"div",41)(1,"p",42),_(2,"Key pair generated successfully!"),y(),b(3,"div",43)(4,"p",44)(5,"strong"),_(6,"Public Key:"),y(),_(7),y(),b(8,"p")(9,"strong"),_(10,"Private Key:"),y(),_(11," \u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),y()()()),r&2){let t=G();D(7),je(" ",t.keyPair.publicKey.substring(0,20),"...")}}function H4e(r,e){if(r&1&&(b(0,"div",45)(1,"p",46),_(2),y()()),r&2){let t=G();D(2),Se(t.error)}}function $4e(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",47),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onHashSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.closeHashSelector())}),y()}r&2&&z("title","Select Content Hash")("searchPlaceholder","Search by hash or content type...")("selectButtonText","Select")("simplePreview",!0)}function z4e(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",47),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onAuthorHashSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.closeAuthorHashSelector())}),y()}r&2&&z("title","Select Author Hash")("searchPlaceholder","Search for author content...")("selectButtonText","Select Author")("simplePreview",!0)}function q4e(r,e){if(r&1){let t=nt();b(0,"app-content-selection-modal",47),_e("contentSelected",function(o){Re(t);let i=G();return Ne(i.onPreviousVersionSelected(o))})("closed",function(){Re(t);let o=G();return Ne(o.closePreviousVersionSelector())}),y()}r&2&&z("title","Select Previous Version")("searchPlaceholder","Search for previous version...")("selectButtonText","Select Version")("simplePreview",!0)}var kS=class r{constructor(e,t,n,o,i,s){this.fb=e;this.metadataService=t;this.signatureService=n;this.casService=o;this.contentPreviewService=i;this.router=s}metadataForm;keyPair=null;error="";submitting=!1;showHashSelectionModal=!1;showAuthorHashModal=!1;showPreviousVersionModal=!1;currentReferenceIndex=-1;currentAuthorIndex=-1;authorRoles=Object.values(XR);ngOnInit(){this.initializeForm()}initializeForm(){this.metadataForm=this.fb.group({references:this.fb.array([this.createReferenceGroup()]),authors:this.fb.array([this.createAuthorGroup()]),version:this.fb.group({version:["1.0.0",ol.required],previousVersion:[""],changeDescription:[""]})})}createReferenceGroup(){return this.fb.group({hash:["",ol.required],mimeType:["",ol.required],mimeTypeSource:["manual",ol.required],relationship:[""]})}createAuthorGroup(){return this.fb.group({authorHash:["",ol.required],role:["creator",ol.required]})}get references(){return this.metadataForm.get("references")}get authors(){return this.metadataForm.get("authors")}addReference(){this.references.push(this.createReferenceGroup())}removeReference(e){this.references.removeAt(e)}addAuthor(){this.authors.push(this.createAuthorGroup())}removeAuthor(e){this.authors.removeAt(e)}generateKeyPair(){return f(this,null,function*(){try{this.keyPair=yield this.signatureService.generateKeyPair()}catch{this.error="Failed to generate key pair"}})}openHashSelector(e){this.currentReferenceIndex=e,this.showHashSelectionModal=!0}closeHashSelector(){this.showHashSelectionModal=!1,this.currentReferenceIndex=-1}openAuthorHashSelector(e){this.currentAuthorIndex=e,this.showAuthorHashModal=!0}closeAuthorHashSelector(){this.showAuthorHashModal=!1,this.currentAuthorIndex=-1}onAuthorHashSelected(e){this.currentAuthorIndex>=0&&this.authors.at(this.currentAuthorIndex).patchValue({authorHash:e.value}),this.closeAuthorHashSelector()}openPreviousVersionSelector(){this.showPreviousVersionModal=!0}closePreviousVersionSelector(){this.showPreviousVersionModal=!1}onPreviousVersionSelected(e){let t=this.metadataForm.get("version");t&&t.patchValue({previousVersion:e.value}),this.closePreviousVersionSelector()}onHashSelected(e){return f(this,null,function*(){if(this.currentReferenceIndex>=0){let t=this.references.at(this.currentReferenceIndex);t.patchValue({hash:e.value});try{let n=yield this.casService.retrieve(e),o=this.contentPreviewService.detectContentType(n.data),s={"image/png":"image/png","image/jpeg":"image/jpeg","image/gif":"image/gif","application/pdf":"application/pdf","application/json":"application/json","text/plain":"text/plain","application/octet-stream":"application/octet-stream"}[o]||"application/octet-stream";t.patchValue({mimeType:s,mimeTypeSource:"detected"})}catch(n){console.error("Failed to detect MIME type:",n)}}this.closeHashSelector()})}onSubmit(){return f(this,null,function*(){if(this.metadataForm.valid){if(!this.keyPair){this.error="Please generate a key pair first";return}this.submitting=!0,this.error="";try{let e=this.metadataForm.value,t=wte({references:e.references,authors:e.authors,version:e.version.version,previousVersion:e.version.previousVersion||void 0,changeDescription:e.version.changeDescription||void 0}),n=yield this.metadataService.createMetadataEntry(t,this.keyPair.privateKey);yield this.router.navigate(["/metadata/view",n.id])}catch(e){this.error=e.message||"Failed to create metadata entry"}finally{this.submitting=!1}}})}static \u0275fac=function(t){return new(t||r)(oe(LV),oe($0),oe(bu),oe(Zo),oe(Cm),oe(Za))};static \u0275cmp=Qt({type:r,selectors:[["app-metadata-entry"]],decls:51,vars:11,consts:[[1,"max-w-4xl","mx-auto","p-6"],[1,"text-3xl","font-bold","mb-6"],[3,"ngSubmit","formGroup"],[1,"mb-8"],[1,"text-xl","font-semibold","mb-4"],["formArrayName","references",1,"space-y-4"],["class","border rounded-lg p-4 bg-gray-50",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"mt-4","px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600",3,"click"],["formArrayName","authors",1,"space-y-4"],["formGroupName","version",1,"mb-8"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","mb-1"],["type","text","formControlName","version","placeholder","1.0.0",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"flex","gap-2"],["type","text","formControlName","previousVersion","placeholder","QmPrevious...",1,"flex-1","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["type","button",1,"px-3","py-2","bg-gray-500","text-white","rounded","hover:bg-gray-600","text-sm",3,"click"],["type","text","formControlName","changeDescription","placeholder","What changed...",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["class","bg-yellow-50 border border-yellow-200 rounded-lg p-4",4,"ngIf"],["class","bg-green-50 border border-green-200 rounded-lg p-4",4,"ngIf"],["class","mb-4 bg-red-50 border border-red-200 rounded-lg p-4",4,"ngIf"],[1,"flex","justify-end","gap-4"],["type","button","routerLink","/metadata",1,"px-6","py-2","border","border-gray-300","rounded","hover:bg-gray-50"],["type","submit",1,"px-6","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[3,"title","searchPlaceholder","selectButtonText","simplePreview","contentSelected","closed",4,"ngIf"],[1,"border","rounded-lg","p-4","bg-gray-50",3,"formGroupName"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["type","text","formControlName","hash","placeholder","QmXxx...",1,"flex-1","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["type","text","formControlName","mimeType","placeholder","text/plain",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["formControlName","mimeTypeSource",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["value","manual"],["value","detected"],["type","text","formControlName","relationship","placeholder","main, attachment, etc.",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["type","button","class","mt-2 text-red-600 hover:text-red-800",3,"click",4,"ngIf"],["type","button",1,"mt-2","text-red-600","hover:text-red-800",3,"click"],["type","text","formControlName","authorHash","placeholder","QmAuthor...",1,"flex-1","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["formControlName","role",1,"w-full","px-3","py-2","border","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"bg-yellow-50","border","border-yellow-200","rounded-lg","p-4"],[1,"text-sm","text-yellow-800","mb-3"],["type","button",1,"px-4","py-2","bg-yellow-600","text-white","rounded","hover:bg-yellow-700",3,"click"],[1,"bg-green-50","border","border-green-200","rounded-lg","p-4"],[1,"text-sm","text-green-800","mb-2"],[1,"text-xs","text-gray-600"],[1,"mb-1"],[1,"mb-4","bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"text-red-800"],[3,"contentSelected","closed","title","searchPlaceholder","selectButtonText","simplePreview"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"h1",1),_(2,"Create Metadata Entry"),y(),b(3,"form",2),_e("ngSubmit",function(){return n.onSubmit()}),b(4,"div",3)(5,"h2",4),_(6,"Content References"),y(),b(7,"div",5),ye(8,L4e,26,2,"div",6),y(),b(9,"button",7),_e("click",function(){return n.addReference()}),_(10," Add Reference "),y()(),b(11,"div",3)(12,"h2",4),_(13,"Authors"),y(),b(14,"div",8),ye(15,U4e,15,3,"div",6),y(),b(16,"button",7),_e("click",function(){return n.addAuthor()}),_(17," Add Author "),y()(),b(18,"div",9)(19,"h2",4),_(20,"Version Information"),y(),b(21,"div",10)(22,"div")(23,"label",11),_(24,"Version *"),y(),Bt(25,"input",12),y(),b(26,"div")(27,"label",11),_(28,"Previous Version Hash"),y(),b(29,"div",13),Bt(30,"input",14),b(31,"button",15),_e("click",function(){return n.openPreviousVersionSelector()}),_(32," Browse "),y()()(),b(33,"div")(34,"label",11),_(35,"Change Description"),y(),Bt(36,"input",16),y()()(),b(37,"div",3)(38,"h2",4),_(39,"Signing Key"),y(),ye(40,V4e,5,0,"div",17)(41,j4e,12,1,"div",18),y(),ye(42,H4e,3,1,"div",19),b(43,"div",20)(44,"button",21),_(45," Cancel "),y(),b(46,"button",22),_(47),y()()(),ye(48,$4e,1,4,"app-content-selection-modal",23)(49,z4e,1,4,"app-content-selection-modal",23)(50,q4e,1,4,"app-content-selection-modal",23),y()),t&2&&(D(3),z("formGroup",n.metadataForm),D(5),z("ngForOf",n.references.controls),D(7),z("ngForOf",n.authors.controls),D(25),z("ngIf",!n.keyPair),D(),z("ngIf",n.keyPair),D(),z("ngIf",n.error),D(4),z("disabled",!n.metadataForm.valid||!n.keyPair||n.submitting),D(),je(" ",n.submitting?"Creating...":"Create Metadata Entry"," "),D(),z("ngIf",n.showHashSelectionModal),D(),z("ngIf",n.showAuthorHashModal),D(),z("ngIf",n.showPreviousVersionModal))},dependencies:[Zt,Xo,Ur,XI,FV,DV,Ja,ec,Qo,vs,ys,EV,N4,W9,O4,L4,wu],encapsulation:2})};var xte=r=>["/metadata/view",r];function K4e(r,e){r&1&&(b(0,"div",4),Bt(1,"div",5),y())}function G4e(r,e){if(r&1){let t=nt();b(0,"div",6)(1,"p",7),_(2),y(),b(3,"button",8),_e("click",function(){Re(t);let o=G();return Ne(o.refresh())}),_(4," Try Again "),y()()}if(r&2){let t=G();D(2),Se(t.error)}}function W4e(r,e){r&1&&(b(0,"span",29),_(1,"\u2713 Verified"),y())}function Y4e(r,e){r&1&&(b(0,"span",30),_(1,"\u2717 Unverified"),y())}function X4e(r,e){if(r&1&&(b(0,"div")(1,"label",17),_(2,"Previous Version"),y(),b(3,"a",31),_(4),y()()),r&2){let t=G(2);D(3),z("routerLink",T3(2,xte,t.metadata.version.previousVersion)),D(),je(" ",t.metadata.version.previousVersion.substring(0,12),"... ")}}function Q4e(r,e){if(r&1&&(b(0,"div")(1,"label",17),_(2,"Changes"),y(),b(3,"p"),_(4),y()()),r&2){let t=G(2);D(4),Se(t.metadata.version.changeDescription)}}function Z4e(r,e){r&1&&(b(0,"div",32),_(1," No content references "),y())}function J4e(r,e){if(r&1&&(b(0,"div")(1,"label",17),_(2,"Relationship"),y(),b(3,"p"),_(4),y()()),r&2){let t=G().$implicit;D(4),Se(t.relationship)}}function exe(r,e){if(r&1&&(b(0,"div",33)(1,"div",34)(2,"div")(3,"label",17),_(4,"Hash"),y(),b(5,"p",35),_(6),y()(),b(7,"div")(8,"label",17),_(9,"MIME Type"),y(),b(10,"p"),_(11),y()(),b(12,"div")(13,"label",17),_(14,"Source"),y(),b(15,"p"),_(16),y()(),ye(17,J4e,5,1,"div",3),y()()),r&2){let t=e.$implicit;D(6),je("",t.hash.substring(0,20),"..."),D(5),Se(t.mimeType),D(5),Se(t.mimeTypeSource),D(),z("ngIf",t.relationship)}}function txe(r,e){r&1&&(b(0,"div",32),_(1," No authors "),y())}function rxe(r,e){if(r&1&&(b(0,"div",33)(1,"div",36)(2,"div")(3,"label",17),_(4,"Author Hash"),y(),b(5,"p",35),_(6),y()(),b(7,"div")(8,"label",17),_(9,"Role"),y(),b(10,"p"),_(11),y()()()()),r&2){let t=e.$implicit,n=G(2);D(6),je("",t.authorHash.substring(0,20),"..."),D(5),Se(n.getRoleDisplayName(t.role))}}function nxe(r,e){if(r&1&&(b(0,"span"),_(1),y()),r&2){let t=G().$implicit;D(),je(" v",t.metadata.version.version," ")}}function oxe(r,e){if(r&1&&(b(0,"a",43),_(1," View "),y()),r&2){let t=G().$implicit;z("routerLink",T3(1,xte,t.id))}}function ixe(r,e){r&1&&(b(0,"span",40),_(1," (current) "),y())}function sxe(r,e){if(r&1&&(b(0,"div",39)(1,"span",35),_(2),y(),ye(3,nxe,2,1,"span",3),b(4,"span",40),_(5),y(),ye(6,oxe,2,3,"a",41)(7,ixe,2,0,"span",42),y()),r&2){let t=e.$implicit,n=G(3);Rn("bg-blue-50",t.id===n.entry.id),D(2),je("",t.id.substring(0,12),"..."),D(),z("ngIf",t.metadata&&t.metadata.version),D(2),Se(n.formatTimestamp(t.timestamp)),D(),z("ngIf",t.id!==n.entry.id),D(),z("ngIf",t.id===n.entry.id)}}function axe(r,e){if(r&1&&(b(0,"div",14)(1,"h2",15),_(2,"Version History"),y(),b(3,"div",37),ye(4,sxe,8,7,"div",38),y()()),r&2){let t=G(2);D(4),z("ngForOf",t.versionHistory)}}function cxe(r,e){if(r&1&&(b(0,"div")(1,"div",9)(2,"h1",10),_(3,"Metadata Entry"),y(),b(4,"div",11)(5,"span"),_(6),y(),b(7,"span"),_(8),y(),ye(9,W4e,2,0,"span",12)(10,Y4e,2,0,"span",13),y()(),b(11,"div",14)(12,"h2",15),_(13,"Version Information"),y(),b(14,"div",16)(15,"div")(16,"label",17),_(17,"Version"),y(),b(18,"p",18),_(19),y()(),ye(20,X4e,5,4,"div",3)(21,Q4e,5,1,"div",3),y()(),b(22,"div",14)(23,"h2",15),_(24),y(),ye(25,Z4e,2,0,"div",19),b(26,"div",20),ye(27,exe,18,4,"div",21),y()(),b(28,"div",14)(29,"h2",15),_(30),y(),ye(31,txe,2,0,"div",19),b(32,"div",20),ye(33,rxe,12,2,"div",21),y()(),ye(34,axe,5,1,"div",22),b(35,"div",23)(36,"h2",15),_(37,"Technical Details"),y(),b(38,"div",24)(39,"div")(40,"strong"),_(41,"Entry ID:"),y(),b(42,"span",25),_(43),y()(),b(44,"div")(45,"strong"),_(46,"Content Hash:"),y(),b(47,"span",25),_(48),y()(),b(49,"div")(50,"strong"),_(51,"Algorithm:"),y(),b(52,"span",25),_(53),y()(),b(54,"div")(55,"strong"),_(56,"Public Key:"),y(),b(57,"span",25),_(58),y()(),b(59,"div")(60,"strong"),_(61,"Signature:"),y(),b(62,"span",25),_(63),y()()()(),b(64,"div",26)(65,"button",27),_(66," Back to List "),y(),b(67,"button",28),_(68," Create New Entry "),y()()()),r&2){let t=G();D(6),je("ID: ",t.entry.id.substring(0,12),"..."),D(2),Se(t.formatTimestamp(t.entry.timestamp)),D(),z("ngIf",t.isVerified),D(),z("ngIf",!t.isVerified),D(9),Se(t.metadata.version.version),D(),z("ngIf",t.metadata.version.previousVersion),D(),z("ngIf",t.metadata.version.changeDescription),D(3),je("Content References (",t.metadata.references.length,")"),D(),z("ngIf",t.metadata.references.length===0),D(2),z("ngForOf",t.metadata.references),D(3),je("Authors (",t.metadata.authors.length,")"),D(),z("ngIf",t.metadata.authors.length===0),D(2),z("ngForOf",t.metadata.authors),D(),z("ngIf",t.versionHistory.length>1),D(9),Se(t.entry.id),D(5),Se(t.entry.contentHash.value),D(5),Se(t.entry.contentHash.algorithm),D(5),Se(t.entry.signature.publicKey),D(5),je("",t.entry.signature.value.substring(0,40),"...")}}var RS=class r{constructor(e,t,n){this.route=e;this.metadataService=t;this.disotService=n}entry=null;metadata=null;versionHistory=[];isVerified=!1;loading=!0;error="";entryId="";ngOnInit(){this.route.params.subscribe(e=>{this.entryId=e.id,this.loadMetadata()})}loadMetadata(){return f(this,null,function*(){this.loading=!0,this.error="";try{this.entry=yield this.disotService.getEntry(this.entryId),this.metadata=yield this.metadataService.getMetadataContent(this.entryId),this.isVerified=yield this.disotService.verifyEntry(this.entry),this.versionHistory=yield this.metadataService.getVersionHistory(this.entryId)}catch(e){this.error=e.message||"Failed to load metadata"}finally{this.loading=!1}})}formatTimestamp(e){return e.toLocaleString()}getRoleDisplayName(e){return e.charAt(0).toUpperCase()+e.slice(1)}refresh(){return f(this,null,function*(){yield this.loadMetadata()})}static \u0275fac=function(t){return new(t||r)(oe(Js),oe($0),oe(tc))};static \u0275cmp=Qt({type:r,selectors:[["app-metadata-view"]],decls:4,vars:3,consts:[[1,"max-w-4xl","mx-auto","p-6"],["class","flex justify-center items-center h-64",4,"ngIf"],["class","bg-red-50 border border-red-200 rounded-lg p-4",4,"ngIf"],[4,"ngIf"],[1,"flex","justify-center","items-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"text-red-800"],[1,"mt-2","text-sm","text-red-600","hover:text-red-800",3,"click"],[1,"mb-6"],[1,"text-3xl","font-bold","mb-2"],[1,"flex","items-center","gap-4","text-sm","text-gray-600"],["class","text-green-600",4,"ngIf"],["class","text-red-600",4,"ngIf"],[1,"bg-white","border","rounded-lg","p-6","mb-6"],[1,"text-xl","font-semibold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-gray-500"],[1,"text-lg"],["class","text-gray-500",4,"ngIf"],[1,"space-y-3"],["class","border rounded p-4 bg-gray-50",4,"ngFor","ngForOf"],["class","bg-white border rounded-lg p-6 mb-6",4,"ngIf"],[1,"bg-white","border","rounded-lg","p-6"],[1,"space-y-2","text-sm"],[1,"font-mono"],[1,"mt-6","flex","gap-4"],["routerLink","/metadata",1,"px-4","py-2","border","border-gray-300","rounded","hover:bg-gray-50"],["routerLink","/metadata/create",1,"px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600"],[1,"text-green-600"],[1,"text-red-600"],[1,"text-blue-500","hover:text-blue-700",3,"routerLink"],[1,"text-gray-500"],[1,"border","rounded","p-4","bg-gray-50"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-3"],[1,"font-mono","text-sm"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"space-y-2"],["class","flex items-center gap-4 p-2 hover:bg-gray-50 rounded",3,"bg-blue-50",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-4","p-2","hover:bg-gray-50","rounded"],[1,"text-sm","text-gray-500"],["class","text-blue-500 hover:text-blue-700 text-sm",3,"routerLink",4,"ngIf"],["class","text-sm text-gray-500",4,"ngIf"],[1,"text-blue-500","hover:text-blue-700","text-sm",3,"routerLink"]],template:function(t,n){t&1&&(b(0,"div",0),ye(1,K4e,2,0,"div",1)(2,G4e,5,1,"div",2)(3,cxe,69,19,"div",3),y()),t&2&&(D(),z("ngIf",n.loading),D(),z("ngIf",n.error&&!n.loading),D(),z("ngIf",!n.loading&&!n.error&&n.metadata&&n.entry))},dependencies:[Zt,Xo,Ur,ms],encapsulation:2})};var Ete=[{path:"",component:gy},{path:"home",component:gy},{path:"content",component:F4},{path:"content/upload",component:B4},{path:"upload",redirectTo:"/content/upload",pathMatch:"full"},{path:"disot/create",component:V4},{path:"disot/verify",component:j4},{path:"settings",component:TS},{path:"settings/migration",component:MS},{path:"metadata",redirectTo:"/metadata/create",pathMatch:"full"},{path:"metadata/create",component:kS},{path:"metadata/view/:id",component:RS}];var NS=class r{storage=new Map;write(e,t){return f(this,null,function*(){this.storage.set(e,t)})}read(e){return f(this,null,function*(){let t=this.storage.get(e);if(!t)throw new Error(`File not found: ${e}`);return t})}exists(e){return f(this,null,function*(){return this.storage.has(e)})}delete(e){return f(this,null,function*(){this.storage.delete(e)})}list(){return f(this,null,function*(){return Array.from(this.storage.keys())})}clear(){return f(this,null,function*(){this.storage.clear()})}getSize(){return f(this,null,function*(){let e=0;for(let t of this.storage.values())e+=t.length;return e})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=he({token:r,factory:r.\u0275fac,providedIn:"root"})};var _te={mode:"api",gateway:"http://127.0.0.1:8081",apiEndpoint:"",timeout:3e4,retryAttempts:3,maxFileSize:100*1024*1024,enableEncryption:!1};var Ste={providers:[s7(),OI({eventCoalescing:!0}),k9(Ete),a9(),{provide:ra,useValue:_te},{provide:ea,useFactory:ZU},{provide:gs,useFactory:QU,deps:[NS,Im,xu,Md,ea]}]};var lxe=()=>({exact:!0}),OS=class r{title="cas-app";static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Qt({type:r,selectors:[["app-root"]],decls:24,vars:2,consts:[[1,"app-container"],[1,"app-header"],[1,"main-nav"],["routerLink","/","routerLinkActive","active",3,"routerLinkActiveOptions"],["routerLink","/content","routerLinkActive","active"],["routerLink","/content/upload","routerLinkActive","active"],["routerLink","/disot/create","routerLinkActive","active"],["routerLink","/disot/verify","routerLinkActive","active"],["routerLink","/metadata/create","routerLinkActive","active"],["routerLink","/settings","routerLinkActive","active"],[1,"main-content"],[1,"app-footer"]],template:function(t,n){t&1&&(b(0,"div",0)(1,"header",1)(2,"h1"),_(3,"CAS/DISOT System"),y(),b(4,"nav",2)(5,"a",3),_(6,"Home"),y(),b(7,"a",4),_(8,"Content List"),y(),b(9,"a",5),_(10,"Upload"),y(),b(11,"a",6),_(12,"Create Entry"),y(),b(13,"a",7),_(14,"Verify"),y(),b(15,"a",8),_(16,"Metadata"),y(),b(17,"a",9),_(18,"Settings"),y()()(),b(19,"main",10),Bt(20,"router-outlet"),y(),b(21,"footer",11)(22,"p"),_(23,"Decentralized Content Management System"),y()()()),t&2&&(D(5),z("routerLinkActiveOptions",kI(1,lxe)))},dependencies:[Zt,py,ms,M9],styles:[".app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column}.app-header[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff;padding:20px;box-shadow:0 2px 4px #0000001a}.app-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 15px;font-size:24px}.main-nav[_ngcontent-%COMP%]{display:flex;gap:20px}.main-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#ecf0f1;text-decoration:none;padding:8px 16px;border-radius:4px;transition:background-color .3s}.main-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#34495e}.main-nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#3498db}.main-content[_ngcontent-%COMP%]{flex:1;background-color:#f5f5f5;padding:20px}.app-footer[_ngcontent-%COMP%]{background-color:#2c3e50;color:#ecf0f1;text-align:center;padding:20px}.app-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})};o9(OS,Ste).catch(r=>console.error(r));
