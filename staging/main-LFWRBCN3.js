import{A as yi,B as Nt,C as _r,G as ce,a as v,b as I,c as pr,d as hn,e as Dn,f as xr,g as Ki,h as f,i as S,j as M,k as Q,l as O,m as O1,n as SR,o as _R,p as gh,q as bw,r as CR,s as Wi,t as Gi,u as IR,v as AR,w as Sr,x as DR,y as L1,z as TR}from"./chunk-KQJLGZUB.js";var eV=hn((bNe,x9)=>{"use strict";var zue=Object.prototype.hasOwnProperty,To="~";function my(){}Object.create&&(my.prototype=Object.create(null),new my().__proto__||(To=!1));function que(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function JU(r,e,t,n,o){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new que(t,n||r,o),s=To?To+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],i]:r._events[s].push(i):(r._events[s]=i,r._eventsCount++),r}function k4(r,e){--r._eventsCount===0?r._events=new my:delete r._events[e]}function io(){this._events=new my,this._eventsCount=0}io.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)zue.call(t,n)&&e.push(To?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};io.prototype.listeners=function(e){var t=To?To+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s};io.prototype.listenerCount=function(e){var t=To?To+e:e,n=this._events[t];return n?n.fn?1:n.length:0};io.prototype.emit=function(e,t,n,o,i,s){var a=To?To+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,s),!0}for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var h=c.length,p;for(d=0;d<h;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,o);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[d].fn.apply(c[d].context,u)}}return!0};io.prototype.on=function(e,t,n){return JU(this,e,t,n,!1)};io.prototype.once=function(e,t,n){return JU(this,e,t,n,!0)};io.prototype.removeListener=function(e,t,n,o){var i=To?To+e:e;if(!this._events[i])return this;if(!t)return k4(this,i),this;var s=this._events[i];if(s.fn)s.fn===t&&(!o||s.once)&&(!n||s.context===n)&&k4(this,i);else{for(var a=0,c=[],l=s.length;a<l;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[i]=c.length===1?c[0]:c:k4(this,i)}return this};io.prototype.removeAllListeners=function(e){var t;return e?(t=To?To+e:e,this._events[t]&&k4(this,t)):(this._events=new my,this._eventsCount=0),this};io.prototype.off=io.prototype.removeListener;io.prototype.addListener=io.prototype.on;io.prefixed=To;io.EventEmitter=io;typeof x9<"u"&&(x9.exports=io)});var fV=hn((SOe,dV)=>{"use strict";dV.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function o(i,s){t[i]=s,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var s=t[i];if(s!==void 0)return s;if((s=n[i])!==void 0)return o(i,s),s},set:function(i,s){t[i]!==void 0?t[i]=s:o(i,s)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var Bz=hn(w2=>{"use strict";(function(){var r,e,t,n,o,i,s,a;a=function(c){var l,u,d,h;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,d=(c&65280)>>>8,h=c&255,[l,u,d,h].join(".")},s=function(c){var l,u,d,h,p,m;for(l=[],d=h=0;h<=3&&c.length!==0;d=++h){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}m=e(c),p=m[0],u=m[1],c=c.substring(u),l.push(p)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),o=t("A"),e=function(c){var l,u,d,h,p;for(h=0,l=10,u="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,u="7")),p=d;d<c.length;){if("0"<=c[d]&&c[d]<=u)h=h*l+(t(c[d])-n)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")h=h*l+(10+t(c[d])-i)>>>0;else if("A"<=c[d]&&c[d]<="F")h=h*l+(10+t(c[d])-o)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");d++}if(d===p)throw new Error("empty octet");return[h,d]},r=function(){function c(l,u){var d,h,p,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(m=l.split("/",2),l=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=s(u)}catch(y){throw d=y,new Error("Invalid mask: "+u)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(s(l)&this.maskLong)>>>0}catch(y){throw d=y,new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(s(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,d,h;for(h=s(this.first),d=s(this.last),u=0;h<=d;)l(a(h),h,u),u++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),w2.ip2long=s,w2.long2ip=a,w2.Netmask=r}).call(w2)});var Ux=hn((sXe,iT)=>{"use strict";var iXe=function(){typeof iT<"u"&&(iT.exports=y);var r=86400,e=3200,t=146097*e/400,n=r*t,o=1e3*n,i=864e13,s=4294967296,a=1e6,c="000000000",l=Math.trunc||function(U){var T=U-U%1;return T==0&&(U<0||U===0&&1/U!=1/0)?-0:T},u=y.prototype,d=(y.fromDate=function(U){return new y(+U)},y.fromInt64BE=L(0,1,2,3,0,4),y.fromInt64LE=L(3,2,1,0,4,0),y.fromString=function(N){var T,k=new y,N=(N+="").replace(/^\s*[+\-]?\d+/,function(V){var V=+V,X=1970+(V-1970)%400;return k.year=V-X,X}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(j,V,X){return V<0&&(X*=-1),T=6e4*(60*+V+ +X),""}).replace(/\.\d+$/,function(j){return k.nano=+(j+c).substr(1,9),""}).split(/\D+/);if(1<N.length?N[1]--:N[1]=0,k.time=T=Date.UTC.apply(Date,N)-(T||0),isNaN(T))throw new TypeError("Invalid Date");return b(k)},y.fromTimeT=function(U){return A(U,0)},u.year=0,u.time=0,u.nano=0,u.addNano=function(U){return this.nano+=+U||0,this},u.getNano=function(){var U=b(this);return(U.time%1e3*a+ +U.nano+1e9)%1e9},u.getTimeT=function(){var T=b(this),U=Math.floor(T.time/1e3),T=T.year;return T&&(U+=T*t*r/e),U},u.getYear=function(){return this.toDate().getUTCFullYear()+this.year},u.toDate=function(){return x(b(this).time)},u.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},u.toString=function(U){var T=this,k=T.toDate(),N={H:function(){return W(k.getUTCHours())},L:function(){return H(k.getUTCMilliseconds(),3)},M:function(){return W(k.getUTCMinutes())},N:function(){return H(T.getNano(),9)},S:function(){return W(k.getUTCSeconds())},Y:function(){var j=T.getYear();return 999999<j?"+"+j:9999<j?"+"+H(j,6):0<=j?H(j,4):-999999<=j?"-"+H(-j,6):j},a:function(){return p[k.getUTCDay()]},b:function(){return h[k.getUTCMonth()]},d:function(){return W(k.getUTCDate())},e:function(){return function(j){return(9<j?"":" ")+(0|j)}(k.getUTCDate())},m:function(){return W(k.getUTCMonth()+1)}};return function j(V){return V.replace(/%./g,function(X){var J=X[1],G=m[J],J=N[J];return G?j(G):J?J():X})}(U||d)},u.writeInt64BE=P(0,1,2,3,0,4),u.writeInt64LE=P(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return y;function y(U,T,k){var N=this;if(!(N instanceof y))return new y(U,T,k);N.time=+U||0,N.nano=+T||0,N.year=+k||0,b(N)}function b(U){var T,k,N,j=U.year,V=U.time,X=U.nano,G=((X<0||a<=X)&&(X-=(k=Math.floor(X/a))*a,V+=k,k=1),j%e);return(V<-i||i<V||G)&&((T=l(V/o))&&(j+=T*e,V-=T*o),(N=x(V)).setUTCFullYear(G+N.getUTCFullYear()),N=(V=+N)+(T=l((j-=G)/e))*o,T&&-i<=N&&N<=i&&(j-=T*e,V=N),k=1),k&&(U.year=j,U.time=V,U.nano=X),U}function x(U){var T=new Date(0);return T.setTime(U),T}function A(j,N){j=+j||0;var k=l((N=(N|0)*s)/n)+l(j/n),N=N%n+j%n,j=l(N/n);return j&&(k+=j,N-=j*n),new y(1e3*N,0,k*e)}function P(U,T,k,N,j,V){return function(G,J){var de=b(this);G=G||new Array(8),F(G,J|=0);var le=Math.floor(de.time/1e3),de=de.year*(t*r/e),ae=l(de/s)+l(le/s),de=de%s+le%s,le=Math.floor(de/s);return le&&(ae+=le,de-=le*s),X(G,J+j,ae),X(G,J+V,de),G};function X(G,J,ae){G[J+U]=ae>>24&255,G[J+T]=ae>>16&255,G[J+k]=ae>>8&255,G[J+N]=255&ae}}function L(U,T,k,N,j,V){return function(G,J){F(G,J|=0);var ae=X(G,J+j);return A(X(G,J+V),ae)};function X(G,J){return 16777216*G[J+U]+(G[J+T]<<16|G[J+k]<<8|G[J+N])}}function F(U,T){if(U=U&&U.length,U==null)throw new TypeError("Invalid Buffer");if(U<T+8)throw new RangeError("Out of range")}function W(U){return(9<U?"":"0")+(0|U)}function H(U,T){return(c+(0|U)).substr(-T)}}()});var _q=hn((jJe,Sq)=>{"use strict";function jge(r){return r>=55296&&r<=56319}function Hge(r){return r>=56320&&r<=57343}Sq.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var o=t.length,i=0,s,a,c=0;c<o;c+=1){if(s=t.charCodeAt(c),a=t[c],jge(s)&&Hge(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),i+=e(a),i===n)return t.slice(0,c+1);if(i>n)return t.slice(0,c-a.length+1)}return t}});var Iq=hn((HJe,Cq)=>{"use strict";function $ge(r){return r>=55296&&r<=56319}function zge(r){return r>=56320&&r<=57343}Cq.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,o=null,i=null,s=0;s<t;s++)o=e.charCodeAt(s),zge(o)?i!=null&&$ge(i)?n+=1:n+=3:o<=127?n+=1:o>=128&&o<=2047?n+=2:o>=2048&&o<=65535&&(n+=3),i=o;return n}});var Dq=hn(($Je,Aq)=>{"use strict";var qge=_q(),Kge=Iq();Aq.exports=qge.bind(null,Kge)});var Mq=hn((zJe,Pq)=>{"use strict";var Wge=Dq(),Gge=/[\/\?<>\\:\*\|"]/g,Yge=/[\x00-\x1f\x80-\x9f]/g,Xge=/^\.+$/,Qge=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Zge=/[\. ]+$/;function Tq(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(Gge,e).replace(Yge,e).replace(Xge,e).replace(Qge,e).replace(Zge,e);return Wge(t,255)}Pq.exports=function(r,e){var t=e&&e.replacement||"",n=Tq(r,t);return t===""?n:Tq(n,"")}});var bl=hn(Sg=>{"use strict";var e1e="[object ArrayBuffer]",wl=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===e1e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),o=r.toUint8Array(t);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let s of t)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of t){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},bT="string",t1e=/^[0-9a-f\s]+$/i,r1e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,n1e=/^[a-zA-Z0-9-_]+$/,Jx=class{static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n.buffer}static toString(e){let t=wl.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}},gs=class{static toString(e,t=!1){let n=wl.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),t);return n}},o1e=(()=>{class r{static isHex(t){return typeof t===bT&&t1e.test(t)}static isBase64(t){return typeof t===bT&&r1e.test(t)}static isBase64Url(t){return typeof t===bT&&n1e.test(t)}static ToString(t,n="utf8"){let o=wl.toUint8Array(t);switch(n.toLowerCase()){case"utf8":return this.ToUtf8String(o);case"binary":return this.ToBinary(o);case"hex":return this.ToHex(o);case"base64":return this.ToBase64(o);case"base64url":return this.ToBase64Url(o);case"utf16le":return gs.toString(o,!0);case"utf16":case"utf16be":return gs.toString(o);default:throw new Error(`Unknown type of encoding '${n}'`)}}static FromString(t,n="utf8"){if(!t)return new ArrayBuffer(0);switch(n.toLowerCase()){case"utf8":return this.FromUtf8String(t);case"binary":return this.FromBinary(t);case"hex":return this.FromHex(t);case"base64":return this.FromBase64(t);case"base64url":return this.FromBase64Url(t);case"utf16le":return gs.fromString(t,!0);case"utf16":case"utf16be":return gs.fromString(t);default:throw new Error(`Unknown type of encoding '${n}'`)}}static ToBase64(t){let n=wl.toUint8Array(t);if(typeof btoa<"u"){let o=this.ToString(n,"binary");return btoa(o)}else return Buffer.from(n).toString("base64")}static FromBase64(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isBase64(n))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(n)):new Uint8Array(Buffer.from(n,"base64")).buffer}static FromBase64Url(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isBase64Url(n))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(n.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(t){return this.ToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(t,n=r.DEFAULT_UTF8_ENCODING){switch(n){case"ascii":return this.FromBinary(t);case"utf8":return Jx.fromString(t);case"utf16":case"utf16be":return gs.fromString(t);case"utf16le":case"usc2":return gs.fromString(t,!0);default:throw new Error(`Unknown type of encoding '${n}'`)}}static ToUtf8String(t,n=r.DEFAULT_UTF8_ENCODING){switch(n){case"ascii":return this.ToBinary(t);case"utf8":return Jx.toString(t);case"utf16":case"utf16be":return gs.toString(t);case"utf16le":case"usc2":return gs.toString(t,!0);default:throw new Error(`Unknown type of encoding '${n}'`)}}static FromBinary(t){let n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o.buffer}static ToBinary(t){let n=wl.toUint8Array(t),o="";for(let i=0;i<n.length;i++)o+=String.fromCharCode(n[i]);return o}static ToHex(t){let n=wl.toUint8Array(t),o="",i=n.length;for(let s=0;s<i;s++){let a=n[s];a<16&&(o+="0"),o+=a.toString(16)}return o}static FromHex(t){let n=this.formatString(t);if(!n)return new ArrayBuffer(0);if(!r.isHex(n))throw new TypeError("Argument 'hexString' is not HEX encoded");n.length%2&&(n=`0${n}`);let o=new Uint8Array(n.length/2);for(let i=0;i<n.length;i=i+2){let s=n.slice(i,i+2);o[i/2]=parseInt(s,16)}return o.buffer}static ToUtf16String(t,n=!1){return gs.toString(t,n)}static FromUtf16String(t,n=!1){return gs.fromString(t,n)}static Base64Padding(t){let n=4-t.length%4;if(n<4)for(let o=0;o<n;o++)t+="=";return t}static formatString(t){return t?.replace(/[\n\r\t ]/g,"")||""}}return r.DEFAULT_UTF8_ENCODING="utf8",r})();function i1e(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)t[i]=o[i]}return t}function s1e(...r){let e=r.map(o=>o.byteLength).reduce((o,i)=>o+i),t=new Uint8Array(e),n=0;return r.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)t[n++]=i}),t.buffer}function a1e(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}Sg.BufferSourceConverter=wl;Sg.Convert=o1e;Sg.assign=i1e;Sg.combine=s1e;Sg.isEqual=a1e});var tW=hn((got,eW)=>{"use strict";function Es(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}eW.exports=Es;Es.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Es.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Es.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Es.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Es.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Es.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Es.prototype.start=Es.prototype.try;Es.prototype.errors=function(){return this._errors};Es.prototype.attempts=function(){return this._attempts};Es.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,s=(r[i]||0)+1;r[i]=s,s>=t&&(e=o,t=s)}return e}});var rW=hn(yp=>{"use strict";var D0e=tW();yp.operation=function(r){var e=yp.timeouts(r);return new D0e(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};yp.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<e.retries;o++)n.push(this.createTimeout(o,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(o,e)),n.sort(function(i,s){return i-s}),n};yp.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};yp.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var o=0;o<t.length;o++){var i=t[o],s=r[i];r[i]=(function(c){var l=yp.operation(e),u=Array.prototype.slice.call(arguments,1),d=u.pop();u.push(function(h){l.retry(h)||(h&&(arguments[0]=l.mainError()),d.apply(this,arguments))}),l.attempt(function(){c.apply(r,u)})}).bind(r,s),r[i].options=e}}});var oW=hn((vot,nW)=>{"use strict";nW.exports=rW()});var lX=hn(()=>{"use strict";var cX;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(r);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function o(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return g_(Object.create(null))}:c?function(){return g_({__proto__:null})}:function(){return g_({})},has:l?function($,q){return n.call($,q)}:function($,q){return q in $},get:l?function($,q){return n.call($,q)?$[q]:void 0}:function($,q){return $[q]}},d=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Pee(),p=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Mee(),m=typeof WeakMap=="function"?WeakMap:kee(),y=o?Symbol.for("@reflect-metadata:registry"):void 0,b=Aee(),x=Dee(b);function A($,q,ee,he){if(se(ee)){if(!qi($))throw new TypeError;if(!gR(q))throw new TypeError;return j($,q)}else{if(!qi($))throw new TypeError;if(!Le(q))throw new TypeError;if(!Le(he)&&!se(he)&&!ft(he))throw new TypeError;return ft(he)&&(he=void 0),ee=An(ee),V($,q,ee,he)}}e("decorate",A);function P($,q){function ee(he,$e){if(!Le(he))throw new TypeError;if(!se($e)&&!Cee($e))throw new TypeError;de($,q,he,$e)}return ee}e("metadata",P);function L($,q,ee,he){if(!Le(ee))throw new TypeError;return se(he)||(he=An(he)),de($,q,ee,he)}e("defineMetadata",L);function F($,q,ee){if(!Le(q))throw new TypeError;return se(ee)||(ee=An(ee)),X($,q,ee)}e("hasMetadata",F);function W($,q,ee){if(!Le(q))throw new TypeError;return se(ee)||(ee=An(ee)),G($,q,ee)}e("hasOwnMetadata",W);function H($,q,ee){if(!Le(q))throw new TypeError;return se(ee)||(ee=An(ee)),J($,q,ee)}e("getMetadata",H);function U($,q,ee){if(!Le(q))throw new TypeError;return se(ee)||(ee=An(ee)),ae($,q,ee)}e("getOwnMetadata",U);function T($,q){if(!Le($))throw new TypeError;return se(q)||(q=An(q)),le($,q)}e("getMetadataKeys",T);function k($,q){if(!Le($))throw new TypeError;return se(q)||(q=An(q)),Ne($,q)}e("getOwnMetadataKeys",k);function N($,q,ee){if(!Le(q))throw new TypeError;if(se(ee)||(ee=An(ee)),!Le(q))throw new TypeError;se(ee)||(ee=An(ee));var he=N1(q,ee,!1);return se(he)?!1:he.OrdinaryDeleteMetadata($,q,ee)}e("deleteMetadata",N);function j($,q){for(var ee=$.length-1;ee>=0;--ee){var he=$[ee],$e=he(q);if(!se($e)&&!ft($e)){if(!gR($e))throw new TypeError;q=$e}}return q}function V($,q,ee,he){for(var $e=$.length-1;$e>=0;--$e){var Or=$[$e],sn=Or(q,ee,he);if(!se(sn)&&!ft(sn)){if(!Le(sn))throw new TypeError;he=sn}}return he}function X($,q,ee){var he=G($,q,ee);if(he)return!0;var $e=m_(q);return ft($e)?!1:X($,$e,ee)}function G($,q,ee){var he=N1(q,ee,!1);return se(he)?!1:nn(he.OrdinaryHasOwnMetadata($,q,ee))}function J($,q,ee){var he=G($,q,ee);if(he)return ae($,q,ee);var $e=m_(q);if(!ft($e))return J($,$e,ee)}function ae($,q,ee){var he=N1(q,ee,!1);if(!se(he))return he.OrdinaryGetOwnMetadata($,q,ee)}function de($,q,ee,he){var $e=N1(ee,he,!0);$e.OrdinaryDefineOwnMetadata($,q,ee,he)}function le($,q){var ee=Ne($,q),he=m_($);if(he===null)return ee;var $e=le(he,q);if($e.length<=0)return ee;if(ee.length<=0)return $e;for(var Or=new p,sn=[],yt=0,Se=ee;yt<Se.length;yt++){var Ae=Se[yt],Te=Or.has(Ae);Te||(Or.add(Ae),sn.push(Ae))}for(var ke=0,Et=$e;ke<Et.length;ke++){var Ae=Et[ke],Te=Or.has(Ae);Te||(Or.add(Ae),sn.push(Ae))}return sn}function Ne($,q){var ee=N1($,q,!1);return ee?ee.OrdinaryOwnMetadataKeys($,q):[]}function xe($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function se($){return $===void 0}function ft($){return $===null}function jt($){return typeof $=="symbol"}function Le($){return typeof $=="object"?$!==null:typeof $=="function"}function Xt($,q){switch(xe($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var ee=q===3?"string":q===5?"number":"default",he=yR($,i);if(he!==void 0){var $e=he.call($,ee);if(Le($e))throw new TypeError;return $e}return Xn($,ee==="default"?"number":ee)}function Xn($,q){if(q==="string"){var ee=$.toString;if(mh(ee)){var he=ee.call($);if(!Le(he))return he}var $e=$.valueOf;if(mh($e)){var he=$e.call($);if(!Le(he))return he}}else{var $e=$.valueOf;if(mh($e)){var he=$e.call($);if(!Le(he))return he}var Or=$.toString;if(mh(Or)){var he=Or.call($);if(!Le(he))return he}}throw new TypeError}function nn($){return!!$}function on($){return""+$}function An($){var q=Xt($,3);return jt(q)?q:on(q)}function qi($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function mh($){return typeof $=="function"}function gR($){return typeof $=="function"}function Cee($){switch(xe($)){case 3:return!0;case 4:return!0;default:return!1}}function h_($,q){return $===q||$!==$&&q!==q}function yR($,q){var ee=$[q];if(ee!=null){if(!mh(ee))throw new TypeError;return ee}}function vR($){var q=yR($,s);if(!mh(q))throw new TypeError;var ee=q.call($);if(!Le(ee))throw new TypeError;return ee}function wR($){return $.value}function bR($){var q=$.next();return q.done?!1:q}function ER($){var q=$.return;q&&q.call($)}function m_($){var q=Object.getPrototypeOf($);if(typeof $!="function"||$===d||q!==d)return q;var ee=$.prototype,he=ee&&Object.getPrototypeOf(ee);if(he==null||he===Object.prototype)return q;var $e=he.constructor;return typeof $e!="function"||$e===$?q:$e}function Iee(){var $;!se(y)&&typeof t.Reflect<"u"&&!(y in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&($=Tee(t.Reflect));var q,ee,he,$e=new m,Or={registerProvider:sn,getProvider:Se,setProvider:Te};return Or;function sn(ke){if(!Object.isExtensible(Or))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case $===ke:break;case se(q):q=ke;break;case q===ke:break;case se(ee):ee=ke;break;case ee===ke:break;default:he===void 0&&(he=new p),he.add(ke);break}}function yt(ke,Et){if(!se(q)){if(q.isProviderFor(ke,Et))return q;if(!se(ee)){if(ee.isProviderFor(ke,Et))return q;if(!se(he))for(var nr=vR(he);;){var Lr=bR(nr);if(!Lr)return;var Ms=wR(Lr);if(Ms.isProviderFor(ke,Et))return ER(nr),Ms}}}if(!se($)&&$.isProviderFor(ke,Et))return $}function Se(ke,Et){var nr=$e.get(ke),Lr;return se(nr)||(Lr=nr.get(Et)),se(Lr)&&(Lr=yt(ke,Et),se(Lr)||(se(nr)&&(nr=new h,$e.set(ke,nr)),nr.set(Et,Lr))),Lr}function Ae(ke){if(se(ke))throw new TypeError;return q===ke||ee===ke||!se(he)&&he.has(ke)}function Te(ke,Et,nr){if(!Ae(nr))throw new Error("Metadata provider not registered.");var Lr=Se(ke,Et);if(Lr!==nr){if(!se(Lr))return!1;var Ms=$e.get(ke);se(Ms)&&(Ms=new h,$e.set(ke,Ms)),Ms.set(Et,nr)}return!0}}function Aee(){var $;return!se(y)&&Le(t.Reflect)&&Object.isExtensible(t.Reflect)&&($=t.Reflect[y]),se($)&&($=Iee()),!se(y)&&Le(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,y,{enumerable:!1,configurable:!1,writable:!1,value:$}),$}function Dee($){var q=new m,ee={isProviderFor:function(Ae,Te){var ke=q.get(Ae);return se(ke)?!1:ke.has(Te)},OrdinaryDefineOwnMetadata:sn,OrdinaryHasOwnMetadata:$e,OrdinaryGetOwnMetadata:Or,OrdinaryOwnMetadataKeys:yt,OrdinaryDeleteMetadata:Se};return b.registerProvider(ee),ee;function he(Ae,Te,ke){var Et=q.get(Ae),nr=!1;if(se(Et)){if(!ke)return;Et=new h,q.set(Ae,Et),nr=!0}var Lr=Et.get(Te);if(se(Lr)){if(!ke)return;if(Lr=new h,Et.set(Te,Lr),!$.setProvider(Ae,Te,ee))throw Et.delete(Te),nr&&q.delete(Ae),new Error("Wrong provider for target.")}return Lr}function $e(Ae,Te,ke){var Et=he(Te,ke,!1);return se(Et)?!1:nn(Et.has(Ae))}function Or(Ae,Te,ke){var Et=he(Te,ke,!1);if(!se(Et))return Et.get(Ae)}function sn(Ae,Te,ke,Et){var nr=he(ke,Et,!0);nr.set(Ae,Te)}function yt(Ae,Te){var ke=[],Et=he(Ae,Te,!1);if(se(Et))return ke;for(var nr=Et.keys(),Lr=vR(nr),Ms=0;;){var xR=bR(Lr);if(!xR)return ke.length=Ms,ke;var Ree=wR(xR);try{ke[Ms]=Ree}catch(Nee){try{ER(Lr)}finally{throw Nee}}Ms++}}function Se(Ae,Te,ke){var Et=he(Te,ke,!1);if(se(Et)||!Et.delete(Ae))return!1;if(Et.size===0){var nr=q.get(Te);se(nr)||(nr.delete(ke),nr.size===0&&q.delete(nr))}return!0}}function Tee($){var q=$.defineMetadata,ee=$.hasOwnMetadata,he=$.getOwnMetadata,$e=$.getOwnMetadataKeys,Or=$.deleteMetadata,sn=new m,yt={isProviderFor:function(Se,Ae){var Te=sn.get(Se);return!se(Te)&&Te.has(Ae)?!0:$e(Se,Ae).length?(se(Te)&&(Te=new p,sn.set(Se,Te)),Te.add(Ae),!0):!1},OrdinaryDefineOwnMetadata:q,OrdinaryHasOwnMetadata:ee,OrdinaryGetOwnMetadata:he,OrdinaryOwnMetadataKeys:$e,OrdinaryDeleteMetadata:Or};return yt}function N1($,q,ee){var he=b.getProvider($,q);if(!se(he))return he;if(ee){if(b.setProvider($,q,x))return x;throw new Error("Illegal state.")}}function Pee(){var $={},q=[],ee=function(){function yt(Se,Ae,Te){this._index=0,this._keys=Se,this._values=Ae,this._selector=Te}return yt.prototype["@@iterator"]=function(){return this},yt.prototype[s]=function(){return this},yt.prototype.next=function(){var Se=this._index;if(Se>=0&&Se<this._keys.length){var Ae=this._selector(this._keys[Se],this._values[Se]);return Se+1>=this._keys.length?(this._index=-1,this._keys=q,this._values=q):this._index++,{value:Ae,done:!1}}return{value:void 0,done:!0}},yt.prototype.throw=function(Se){throw this._index>=0&&(this._index=-1,this._keys=q,this._values=q),Se},yt.prototype.return=function(Se){return this._index>=0&&(this._index=-1,this._keys=q,this._values=q),{value:Se,done:!0}},yt}(),he=function(){function yt(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(yt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),yt.prototype.has=function(Se){return this._find(Se,!1)>=0},yt.prototype.get=function(Se){var Ae=this._find(Se,!1);return Ae>=0?this._values[Ae]:void 0},yt.prototype.set=function(Se,Ae){var Te=this._find(Se,!0);return this._values[Te]=Ae,this},yt.prototype.delete=function(Se){var Ae=this._find(Se,!1);if(Ae>=0){for(var Te=this._keys.length,ke=Ae+1;ke<Te;ke++)this._keys[ke-1]=this._keys[ke],this._values[ke-1]=this._values[ke];return this._keys.length--,this._values.length--,h_(Se,this._cacheKey)&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},yt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},yt.prototype.keys=function(){return new ee(this._keys,this._values,$e)},yt.prototype.values=function(){return new ee(this._keys,this._values,Or)},yt.prototype.entries=function(){return new ee(this._keys,this._values,sn)},yt.prototype["@@iterator"]=function(){return this.entries()},yt.prototype[s]=function(){return this.entries()},yt.prototype._find=function(Se,Ae){if(!h_(this._cacheKey,Se)){this._cacheIndex=-1;for(var Te=0;Te<this._keys.length;Te++)if(h_(this._keys[Te],Se)){this._cacheIndex=Te;break}}return this._cacheIndex<0&&Ae&&(this._cacheIndex=this._keys.length,this._keys.push(Se),this._values.push(void 0)),this._cacheIndex},yt}();return he;function $e(yt,Se){return yt}function Or(yt,Se){return Se}function sn(yt,Se){return[yt,Se]}}function Mee(){var $=function(){function q(){this._map=new h}return Object.defineProperty(q.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),q.prototype.has=function(ee){return this._map.has(ee)},q.prototype.add=function(ee){return this._map.set(ee,ee),this},q.prototype.delete=function(ee){return this._map.delete(ee)},q.prototype.clear=function(){this._map.clear()},q.prototype.keys=function(){return this._map.keys()},q.prototype.values=function(){return this._map.keys()},q.prototype.entries=function(){return this._map.entries()},q.prototype["@@iterator"]=function(){return this.keys()},q.prototype[s]=function(){return this.keys()},q}();return $}function kee(){var $=16,q=u.create(),ee=he();return function(){function Se(){this._key=he()}return Se.prototype.has=function(Ae){var Te=$e(Ae,!1);return Te!==void 0?u.has(Te,this._key):!1},Se.prototype.get=function(Ae){var Te=$e(Ae,!1);return Te!==void 0?u.get(Te,this._key):void 0},Se.prototype.set=function(Ae,Te){var ke=$e(Ae,!0);return ke[this._key]=Te,this},Se.prototype.delete=function(Ae){var Te=$e(Ae,!1);return Te!==void 0?delete Te[this._key]:!1},Se.prototype.clear=function(){this._key=he()},Se}();function he(){var Se;do Se="@@WeakMap@@"+yt();while(u.has(q,Se));return q[Se]=!0,Se}function $e(Se,Ae){if(!n.call(Se,ee)){if(!Ae)return;Object.defineProperty(Se,ee,{value:u.create()})}return Se[ee]}function Or(Se,Ae){for(var Te=0;Te<Ae;++Te)Se[Te]=Math.random()*255|0;return Se}function sn(Se){if(typeof Uint8Array=="function"){var Ae=new Uint8Array(Se);return typeof crypto<"u"?crypto.getRandomValues(Ae):typeof msCrypto<"u"?msCrypto.getRandomValues(Ae):Or(Ae,Se),Ae}return Or(new Array(Se),Se)}function yt(){var Se=sn($);Se[6]=Se[6]&79|64,Se[8]=Se[8]&191|128;for(var Ae="",Te=0;Te<$;++Te){var ke=Se[Te];(Te===4||Te===6||Te===8)&&(Ae+="-"),ke<16&&(Ae+="0"),Ae+=ke.toString(16).toLowerCase()}return Ae}}function g_($){return $.__=void 0,delete $.__,$}})})(cX||(cX={}))});var DZ=hn(RS=>{"use strict";Object.defineProperty(RS,"__esModule",{value:!0});var Xk=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,o)=>{this.pullQueue.push({resolve:n,reject:o})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},kS=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let o=new Xk;o.highWaterMark=t,o.lowWaterMark=n,o.removeCallback=e({push:i=>o.push(i),stop:()=>o.stop(),fail:i=>o.fail(i),on:(i,s)=>{o.eventHandlers[i]=s}})||(()=>{}),this[Symbol.asyncIterator]=()=>o[Symbol.asyncIterator](),Object.freeze(this)}};RS.EventIterator=kS;RS.default=kS});var TZ=hn(lw=>{"use strict";Object.defineProperty(lw,"__esModule",{value:!0});var Qk=DZ();lw.EventIterator=Qk.EventIterator;function awe(r,e,t){return new Qk.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}lw.subscribe=awe;lw.default=Qk.EventIterator});var lJ=hn((mw,LS)=>{"use strict";(function(r,e){"use strict";var t={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(p){if(!Array.isArray(p)&&!ArrayBuffer.isView(p))return!1;for(var m=0;m<p.length;m++)if(!Number.isInteger(p[m])||p[m]<0||p[m]>255)return!1;return!0}function o(p,m){return(p&65535)*m+(((p>>>16)*m&65535)<<16)}function i(p,m){return p<<m|p>>>32-m}function s(p){return p^=p>>>16,p=o(p,2246822507),p^=p>>>13,p=o(p,3266489909),p^=p>>>16,p}function a(p,m){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var y=[0,0,0,0];return y[3]+=p[3]+m[3],y[2]+=y[3]>>>16,y[3]&=65535,y[2]+=p[2]+m[2],y[1]+=y[2]>>>16,y[2]&=65535,y[1]+=p[1]+m[1],y[0]+=y[1]>>>16,y[1]&=65535,y[0]+=p[0]+m[0],y[0]&=65535,[y[0]<<16|y[1],y[2]<<16|y[3]]}function c(p,m){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535];var y=[0,0,0,0];return y[3]+=p[3]*m[3],y[2]+=y[3]>>>16,y[3]&=65535,y[2]+=p[2]*m[3],y[1]+=y[2]>>>16,y[2]&=65535,y[2]+=p[3]*m[2],y[1]+=y[2]>>>16,y[2]&=65535,y[1]+=p[1]*m[3],y[0]+=y[1]>>>16,y[1]&=65535,y[1]+=p[2]*m[2],y[0]+=y[1]>>>16,y[1]&=65535,y[1]+=p[3]*m[1],y[0]+=y[1]>>>16,y[1]&=65535,y[0]+=p[0]*m[3]+p[1]*m[2]+p[2]*m[1]+p[3]*m[0],y[0]&=65535,[y[0]<<16|y[1],y[2]<<16|y[3]]}function l(p,m){return m%=64,m===32?[p[1],p[0]]:m<32?[p[0]<<m|p[1]>>>32-m,p[1]<<m|p[0]>>>32-m]:(m-=32,[p[1]<<m|p[0]>>>32-m,p[0]<<m|p[1]>>>32-m])}function u(p,m){return m%=64,m===0?p:m<32?[p[0]<<m|p[1]>>>32-m,p[1]<<m]:[p[1]<<m-32,0]}function d(p,m){return[p[0]^m[0],p[1]^m[1]]}function h(p){return p=d(p,[0,p[0]>>>1]),p=c(p,[4283543511,3981806797]),p=d(p,[0,p[0]>>>1]),p=c(p,[3301882366,444984403]),p=d(p,[0,p[0]>>>1]),p}t.x86.hash32=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var y=p.length%4,b=p.length-y,x=m,A=0,P=3432918353,L=461845907,F=0;F<b;F=F+4)A=p[F]|p[F+1]<<8|p[F+2]<<16|p[F+3]<<24,A=o(A,P),A=i(A,15),A=o(A,L),x^=A,x=i(x,13),x=o(x,5)+3864292196;switch(A=0,y){case 3:A^=p[F+2]<<16;case 2:A^=p[F+1]<<8;case 1:A^=p[F],A=o(A,P),A=i(A,15),A=o(A,L),x^=A}return x^=p.length,x=s(x),x>>>0},t.x86.hash128=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var y=p.length%16,b=p.length-y,x=m,A=m,P=m,L=m,F=0,W=0,H=0,U=0,T=597399067,k=2869860233,N=951274213,j=2716044179,V=0;V<b;V=V+16)F=p[V]|p[V+1]<<8|p[V+2]<<16|p[V+3]<<24,W=p[V+4]|p[V+5]<<8|p[V+6]<<16|p[V+7]<<24,H=p[V+8]|p[V+9]<<8|p[V+10]<<16|p[V+11]<<24,U=p[V+12]|p[V+13]<<8|p[V+14]<<16|p[V+15]<<24,F=o(F,T),F=i(F,15),F=o(F,k),x^=F,x=i(x,19),x+=A,x=o(x,5)+1444728091,W=o(W,k),W=i(W,16),W=o(W,N),A^=W,A=i(A,17),A+=P,A=o(A,5)+197830471,H=o(H,N),H=i(H,17),H=o(H,j),P^=H,P=i(P,15),P+=L,P=o(P,5)+2530024501,U=o(U,j),U=i(U,18),U=o(U,T),L^=U,L=i(L,13),L+=x,L=o(L,5)+850148119;switch(F=0,W=0,H=0,U=0,y){case 15:U^=p[V+14]<<16;case 14:U^=p[V+13]<<8;case 13:U^=p[V+12],U=o(U,j),U=i(U,18),U=o(U,T),L^=U;case 12:H^=p[V+11]<<24;case 11:H^=p[V+10]<<16;case 10:H^=p[V+9]<<8;case 9:H^=p[V+8],H=o(H,N),H=i(H,17),H=o(H,j),P^=H;case 8:W^=p[V+7]<<24;case 7:W^=p[V+6]<<16;case 6:W^=p[V+5]<<8;case 5:W^=p[V+4],W=o(W,k),W=i(W,16),W=o(W,N),A^=W;case 4:F^=p[V+3]<<24;case 3:F^=p[V+2]<<16;case 2:F^=p[V+1]<<8;case 1:F^=p[V],F=o(F,T),F=i(F,15),F=o(F,k),x^=F}return x^=p.length,A^=p.length,P^=p.length,L^=p.length,x+=A,x+=P,x+=L,A+=x,P+=x,L+=x,x=s(x),A=s(A),P=s(P),L=s(L),x+=A,x+=P,x+=L,A+=x,P+=x,L+=x,("00000000"+(x>>>0).toString(16)).slice(-8)+("00000000"+(A>>>0).toString(16)).slice(-8)+("00000000"+(P>>>0).toString(16)).slice(-8)+("00000000"+(L>>>0).toString(16)).slice(-8)},t.x64.hash128=function(p,m){if(t.inputValidation&&!n(p))return e;m=m||0;for(var y=p.length%16,b=p.length-y,x=[0,m],A=[0,m],P=[0,0],L=[0,0],F=[2277735313,289559509],W=[1291169091,658871167],H=0;H<b;H=H+16)P=[p[H+4]|p[H+5]<<8|p[H+6]<<16|p[H+7]<<24,p[H]|p[H+1]<<8|p[H+2]<<16|p[H+3]<<24],L=[p[H+12]|p[H+13]<<8|p[H+14]<<16|p[H+15]<<24,p[H+8]|p[H+9]<<8|p[H+10]<<16|p[H+11]<<24],P=c(P,F),P=l(P,31),P=c(P,W),x=d(x,P),x=l(x,27),x=a(x,A),x=a(c(x,[0,5]),[0,1390208809]),L=c(L,W),L=l(L,33),L=c(L,F),A=d(A,L),A=l(A,31),A=a(A,x),A=a(c(A,[0,5]),[0,944331445]);switch(P=[0,0],L=[0,0],y){case 15:L=d(L,u([0,p[H+14]],48));case 14:L=d(L,u([0,p[H+13]],40));case 13:L=d(L,u([0,p[H+12]],32));case 12:L=d(L,u([0,p[H+11]],24));case 11:L=d(L,u([0,p[H+10]],16));case 10:L=d(L,u([0,p[H+9]],8));case 9:L=d(L,[0,p[H+8]]),L=c(L,W),L=l(L,33),L=c(L,F),A=d(A,L);case 8:P=d(P,u([0,p[H+7]],56));case 7:P=d(P,u([0,p[H+6]],48));case 6:P=d(P,u([0,p[H+5]],40));case 5:P=d(P,u([0,p[H+4]],32));case 4:P=d(P,u([0,p[H+3]],24));case 3:P=d(P,u([0,p[H+2]],16));case 2:P=d(P,u([0,p[H+1]],8));case 1:P=d(P,[0,p[H]]),P=c(P,F),P=l(P,31),P=c(P,W),x=d(x,P)}return x=d(x,[0,p.length]),A=d(A,[0,p.length]),x=a(x,A),A=a(A,x),x=h(x),A=h(A),x=a(x,A),A=a(A,x),("00000000"+(x[0]>>>0).toString(16)).slice(-8)+("00000000"+(x[1]>>>0).toString(16)).slice(-8)+("00000000"+(A[0]>>>0).toString(16)).slice(-8)+("00000000"+(A[1]>>>0).toString(16)).slice(-8)},typeof mw<"u"?(typeof LS<"u"&&LS.exports&&(mw=LS.exports=t),mw.murmurHash3=t):typeof define=="function"&&define.amd?define([],function(){return t}):(t._murmurHash3=r.murmurHash3,t.noConflict=function(){return r.murmurHash3=t._murmurHash3,t._murmurHash3=e,t.noConflict=e,t},r.murmurHash3=t)})(mw)});var dJ=hn((_Mt,uJ)=>{"use strict";uJ.exports=lJ()});var BS=hn((MMt,pJ)=>{"use strict";pJ.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let o=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):o=!0,this._setInternalPos(n,e,t,o),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,o=t;for(;n<this.length;){let i=this.get(n);o=e(o,i,n),n++}return o}find(e){let t=0,n,o;for(;t<this.length&&!n;)o=this.get(t),n=e(o),t++;return n?o:void 0}_internalPositionFor(e,t){let n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;let o=this._bitArrays[n],i=e-n*7;if(!((o&1<<i)>0))return-1;let a=this._bitArrays.slice(0,n).reduce(Swe,0),c=~(4294967295<<i+1),l=fJ(o&c);return a+l-1}_bytePosFor(e,t){let n=Math.floor(e/7),o=n+1;for(;!t&&this._bitArrays.length<o;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*7}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*7)}_setInternalPos(e,t,n,o){let i=this._data,s=[t,n];if(o)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let a=Math.round(i.length/2);this._data=i.slice(0,a).concat(s).concat(i.slice(a))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(_we),this._changedData=!1}bitField(){let e=[],t=8,n=0,o=0,i,s=this._bitArrays.slice();for(;s.length||n;){n===0&&(i=s.shift(),n=7);let c=Math.min(n,t),l=~(255<<c),u=i&l;o|=u<<8-t,i=i>>>c,n-=c,t-=c,(!t||!n&&!s.length)&&(e.push(o),o=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(Cwe)}};function Swe(r,e){return r+fJ(e)}function fJ(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function _we(r,e){return r[0]-e[0]}function Cwe(r){return r[1]}});var y_;function v_(){return y_}function Tc(r){let e=y_;return y_=r,e}var Oee=Symbol("NotFound"),Ew=class extends Error{name="\u0275NotFound";constructor(e){super(e)}};function yh(r){return r===Oee||r?.name==="\u0275NotFound"}function Iw(r,e){return Object.is(r,e)}var an=null,xw=!1,w_=1,Lee=null,Qn=Symbol("SIGNAL");function st(r){let e=an;return an=r,e}function Aw(){return an}var Ed={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function vh(r){if(xw)throw new Error("");if(an===null)return;an.consumerOnSignalRead(r);let e=an.nextProducerIndex++;if(Mw(an),e<an.producerNode.length&&an.producerNode[e]!==r&&B1(an)){let t=an.producerNode[e];Pw(t,an.producerIndexOfThis[e])}an.producerNode[e]!==r&&(an.producerNode[e]=r,an.producerIndexOfThis[e]=B1(an)?MR(r,an,e):0),an.producerLastReadVersion[e]=r.version}function PR(){w_++}function Dw(r){if(!(B1(r)&&!r.dirty)&&!(!r.dirty&&r.lastCleanEpoch===w_)){if(!r.producerMustRecompute(r)&&!U1(r)){Cw(r);return}r.producerRecomputeValue(r),Cw(r)}}function b_(r){if(r.liveConsumerNode===void 0)return;let e=xw;xw=!0;try{for(let t of r.liveConsumerNode)t.dirty||Fee(t)}finally{xw=e}}function E_(){return an?.consumerAllowSignalWrites!==!1}function Fee(r){r.dirty=!0,b_(r),r.consumerMarkedDirty?.(r)}function Cw(r){r.dirty=!1,r.lastCleanEpoch=w_}function xd(r){return r&&(r.nextProducerIndex=0),st(r)}function wh(r,e){if(st(e),!(!r||r.producerNode===void 0||r.producerIndexOfThis===void 0||r.producerLastReadVersion===void 0)){if(B1(r))for(let t=r.nextProducerIndex;t<r.producerNode.length;t++)Pw(r.producerNode[t],r.producerIndexOfThis[t]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function U1(r){Mw(r);for(let e=0;e<r.producerNode.length;e++){let t=r.producerNode[e],n=r.producerLastReadVersion[e];if(n!==t.version||(Dw(t),n!==t.version))return!0}return!1}function Tw(r){if(Mw(r),B1(r))for(let e=0;e<r.producerNode.length;e++)Pw(r.producerNode[e],r.producerIndexOfThis[e]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function MR(r,e,t){if(kR(r),r.liveConsumerNode.length===0&&RR(r))for(let n=0;n<r.producerNode.length;n++)r.producerIndexOfThis[n]=MR(r.producerNode[n],r,n);return r.liveConsumerIndexOfThis.push(t),r.liveConsumerNode.push(e)-1}function Pw(r,e){if(kR(r),r.liveConsumerNode.length===1&&RR(r))for(let n=0;n<r.producerNode.length;n++)Pw(r.producerNode[n],r.producerIndexOfThis[n]);let t=r.liveConsumerNode.length-1;if(r.liveConsumerNode[e]=r.liveConsumerNode[t],r.liveConsumerIndexOfThis[e]=r.liveConsumerIndexOfThis[t],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,e<r.liveConsumerNode.length){let n=r.liveConsumerIndexOfThis[e],o=r.liveConsumerNode[e];Mw(o),o.producerIndexOfThis[n]=e}}function B1(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function Mw(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}function kR(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}function RR(r){return r.producerNode!==void 0}function kw(r){Lee?.(r)}function Rw(r,e){let t=Object.create(Bee);t.computation=r,e!==void 0&&(t.equal=e);let n=()=>{if(Dw(t),vh(t),t.value===F1)throw t.error;return t.value};return n[Qn]=t,kw(t),n}var Sw=Symbol("UNSET"),_w=Symbol("COMPUTING"),F1=Symbol("ERRORED"),Bee=I(v({},Ed),{value:Sw,dirty:!0,error:null,equal:Iw,kind:"computed",producerMustRecompute(r){return r.value===Sw||r.value===_w},producerRecomputeValue(r){if(r.value===_w)throw new Error("");let e=r.value;r.value=_w;let t=xd(r),n,o=!1;try{n=r.computation(),st(null),o=e!==Sw&&e!==F1&&n!==F1&&r.equal(e,n)}catch(i){n=F1,r.error=i}finally{wh(r,t)}if(o){r.value=e;return}r.value=n,r.version++}});function Uee(){throw new Error}var NR=Uee;function OR(r){NR(r)}function x_(r){NR=r}var Vee=null;function S_(r,e){let t=Object.create(Nw);t.value=r,e!==void 0&&(t.equal=e);let n=()=>LR(t);return n[Qn]=t,kw(t),[n,s=>bh(t,s),s=>__(t,s)]}function LR(r){return vh(r),r.value}function bh(r,e){E_()||OR(r),r.equal(r.value,e)||(r.value=e,jee(r))}function __(r,e){E_()||OR(r),bh(r,e(r.value))}var Nw=I(v({},Ed),{equal:Iw,value:void 0,kind:"signal"});function jee(r){r.version++,PR(),b_(r),Vee?.(r)}function tt(r){return typeof r=="function"}function Ll(r){let t=r(n=>{Error.call(n),n.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ow=Ll(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((n,o)=>`${o+1}) ${n.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Sd(r,e){if(r){let t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Cr=class r{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let i of t)i.remove(this);else t.remove(this);let{initialTeardown:n}=this;if(tt(n))try{n()}catch(i){e=i instanceof Ow?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{FR(i)}catch(s){e=e??[],s instanceof Ow?e=[...e,...s.errors]:e.push(s)}}if(e)throw new Ow(e)}}add(e){var t;if(e&&e!==this)if(this.closed)FR(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Sd(t,e)}remove(e){let{_finalizers:t}=this;t&&Sd(t,e),e instanceof r&&e._removeParent(this)}};Cr.EMPTY=(()=>{let r=new Cr;return r.closed=!0,r})();var C_=Cr.EMPTY;function Lw(r){return r instanceof Cr||r&&"closed"in r&&tt(r.remove)&&tt(r.add)&&tt(r.unsubscribe)}function FR(r){tt(r)?r():r.unsubscribe()}var ks={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Eh={setTimeout(r,e,...t){let{delegate:n}=Eh;return n?.setTimeout?n.setTimeout(r,e,...t):setTimeout(r,e,...t)},clearTimeout(r){let{delegate:e}=Eh;return(e?.clearTimeout||clearTimeout)(r)},delegate:void 0};function Fw(r){Eh.setTimeout(()=>{let{onUnhandledError:e}=ks;if(e)e(r);else throw r})}function V1(){}var BR=I_("C",void 0,void 0);function UR(r){return I_("E",void 0,r)}function VR(r){return I_("N",r,void 0)}function I_(r,e,t){return{kind:r,value:e,error:t}}var _d=null;function xh(r){if(ks.useDeprecatedSynchronousErrorHandling){let e=!_d;if(e&&(_d={errorThrown:!1,error:null}),r(),e){let{errorThrown:t,error:n}=_d;if(_d=null,t)throw n}}else r()}function jR(r){ks.useDeprecatedSynchronousErrorHandling&&_d&&(_d.errorThrown=!0,_d.error=r)}var Cd=class extends Cr{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Lw(e)&&e.add(this)):this.destination=zee}static create(e,t,n){return new Fl(e,t,n)}next(e){this.isStopped?D_(VR(e),this):this._next(e)}error(e){this.isStopped?D_(UR(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?D_(BR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Hee=Function.prototype.bind;function A_(r,e){return Hee.call(r,e)}var T_=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(n){Bw(n)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(n){Bw(n)}else Bw(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Bw(t)}}},Fl=class extends Cd{constructor(e,t,n){super();let o;if(tt(e)||!e)o={next:e??void 0,error:t??void 0,complete:n??void 0};else{let i;this&&ks.useDeprecatedNextContext?(i=Object.create(e),i.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&A_(e.next,i),error:e.error&&A_(e.error,i),complete:e.complete&&A_(e.complete,i)}):o=e}this.destination=new T_(o)}};function Bw(r){ks.useDeprecatedSynchronousErrorHandling?jR(r):Fw(r)}function $ee(r){throw r}function D_(r,e){let{onStoppedNotification:t}=ks;t&&Eh.setTimeout(()=>t(r,e))}var zee={closed:!0,next:V1,error:$ee,complete:V1};var Sh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function vi(r){return r}function P_(...r){return M_(r)}function M_(r){return r.length===0?vi:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}var pt=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){let n=new r;return n.source=this,n.operator=t,n}subscribe(t,n,o){let i=Kee(t)?t:new Fl(t,n,o);return xh(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return n=HR(n),new n((o,i)=>{let s=new Fl({next:a=>{try{t(a)}catch(c){i(c),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)}[Sh](){return this}pipe(...t){return M_(t)(this)}toPromise(t){return t=HR(t),new t((n,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>n(i))})}}return r.create=e=>new r(e),r})();function HR(r){var e;return(e=r??ks.Promise)!==null&&e!==void 0?e:Promise}function qee(r){return r&&tt(r.next)&&tt(r.error)&&tt(r.complete)}function Kee(r){return r&&r instanceof Cd||qee(r)&&Lw(r)}function k_(r){return tt(r?.lift)}function xt(r){return e=>{if(k_(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function mt(r,e,t,n,o){return new R_(r,e,t,n,o)}var R_=class extends Cd{constructor(e,t,n,o,i,s){super(e),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=o?function(a){try{o(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function _h(){return xt((r,e)=>{let t=null;r._refCount++;let n=mt(e,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount){t=null;return}let o=r._connection,i=t;t=null,o&&(!i||o===i)&&o.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var Ch=class extends pt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,k_(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Cr;let t=this.getSubject();e.add(this.source.subscribe(mt(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Cr.EMPTY)}return e}refCount(){return _h()(this)}};var $R=Ll(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ht=(()=>{class r extends pt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let n=new Uw(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new $R}next(t){xh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let n of this.currentObservers)n.next(t)}})}error(t){xh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){xh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:n,isStopped:o,observers:i}=this;return n||o?C_:(this.currentObservers=null,i.push(t),new Cr(()=>{this.currentObservers=null,Sd(i,t)}))}_checkFinalizedStatuses(t){let{hasError:n,thrownError:o,isStopped:i}=this;n?t.error(o):i&&t.complete()}asObservable(){let t=new pt;return t.source=this,t}}return r.create=(e,t)=>new Uw(e,t),r})(),Uw=class extends Ht{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.next)===null||n===void 0||n.call(t,e)}error(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.error)===null||n===void 0||n.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,n;return(n=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&n!==void 0?n:C_}};var cn=class extends Ht{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}};var N_={now(){return(N_.delegate||Date).now()},delegate:void 0};var Vw=class extends Cr{constructor(e,t){super()}schedule(e,t=0){return this}};var j1={setInterval(r,e,...t){let{delegate:n}=j1;return n?.setInterval?n.setInterval(r,e,...t):setInterval(r,e,...t)},clearInterval(r){let{delegate:e}=j1;return(e?.clearInterval||clearInterval)(r)},delegate:void 0};var jw=class extends Vw{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var n;if(this.closed)return this;this.state=e;let o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,t)),this.pending=!0,this.delay=t,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,n=0){return j1.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(n!=null&&this.delay===n&&this.pending===!1)return t;t!=null&&j1.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let n=this._execute(e,t);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n=!1,o;try{this.work(e)}catch(i){n=!0,o=i||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Sd(n,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var Ih=class r{constructor(e,t=r.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}};Ih.now=N_.now;var Hw=class extends Ih{constructor(e,t=Ih.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}};var O_=new Hw(jw),zR=O_;var jo=new pt(r=>r.complete());function $w(r){return r&&tt(r.schedule)}function qR(r){return r[r.length-1]}function zw(r){return tt(qR(r))?r.pop():void 0}function Bl(r){return $w(qR(r))?r.pop():void 0}function g(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}function WR(r,e,t,n){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function KR(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Id(r){return this instanceof Id?(this.v=r,this):new Id(r)}function GR(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(p){return function(m){return Promise.resolve(m).then(p,d)}}function a(p,m){n[p]&&(o[p]=function(y){return new Promise(function(b,x){i.push([p,y,b,x])>1||c(p,y)})},m&&(o[p]=m(o[p])))}function c(p,m){try{l(n[p](m))}catch(y){h(i[0][3],y)}}function l(p){p.value instanceof Id?Promise.resolve(p.value.v).then(u,d):h(i[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function h(p,m){p(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function YR(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof KR=="function"?KR(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(s){return new Promise(function(a,c){s=r[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},s)}}var qw=r=>r&&typeof r.length=="number"&&typeof r!="function";function Kw(r){return tt(r?.then)}function Ww(r){return tt(r[Sh])}function Gw(r){return Symbol.asyncIterator&&tt(r?.[Symbol.asyncIterator])}function Yw(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Wee(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Xw=Wee();function Qw(r){return tt(r?.[Xw])}function Zw(r){return GR(this,arguments,function*(){let t=r.getReader();try{for(;;){let{value:n,done:o}=yield Id(t.read());if(o)return yield Id(void 0);yield yield Id(n)}}finally{t.releaseLock()}})}function Jw(r){return tt(r?.getReader)}function Ir(r){if(r instanceof pt)return r;if(r!=null){if(Ww(r))return Gee(r);if(qw(r))return Yee(r);if(Kw(r))return Xee(r);if(Gw(r))return XR(r);if(Qw(r))return Qee(r);if(Jw(r))return Zee(r)}throw Yw(r)}function Gee(r){return new pt(e=>{let t=r[Sh]();if(tt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Yee(r){return new pt(e=>{for(let t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function Xee(r){return new pt(e=>{r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Fw)})}function Qee(r){return new pt(e=>{for(let t of r)if(e.next(t),e.closed)return;e.complete()})}function XR(r){return new pt(e=>{Jee(r,e).catch(t=>e.error(t))})}function Zee(r){return XR(Zw(r))}function Jee(r,e){var t,n,o,i;return WR(this,void 0,void 0,function*(){try{for(t=YR(r);n=yield t.next(),!n.done;){let s=n.value;if(e.next(s),e.closed)return}}catch(s){o={error:s}}finally{try{n&&!n.done&&(i=t.return)&&(yield i.call(t))}finally{if(o)throw o.error}}e.complete()})}function Zn(r,e,t,n=0,o=!1){let i=e.schedule(function(){t(),o?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(i),!o)return i}function eb(r,e=0){return xt((t,n)=>{t.subscribe(mt(n,o=>Zn(n,r,()=>n.next(o),e),()=>Zn(n,r,()=>n.complete(),e),o=>Zn(n,r,()=>n.error(o),e)))})}function tb(r,e=0){return xt((t,n)=>{n.add(r.schedule(()=>t.subscribe(n),e))})}function QR(r,e){return Ir(r).pipe(tb(e),eb(e))}function ZR(r,e){return Ir(r).pipe(tb(e),eb(e))}function JR(r,e){return new pt(t=>{let n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function eN(r,e){return new pt(t=>{let n;return Zn(t,e,()=>{n=r[Xw](),Zn(t,e,()=>{let o,i;try{({value:o,done:i}=n.next())}catch(s){t.error(s);return}i?t.complete():t.next(o)},0,!0)}),()=>tt(n?.return)&&n.return()})}function rb(r,e){if(!r)throw new Error("Iterable cannot be null");return new pt(t=>{Zn(t,e,()=>{let n=r[Symbol.asyncIterator]();Zn(t,e,()=>{n.next().then(o=>{o.done?t.complete():t.next(o.value)})},0,!0)})})}function tN(r,e){return rb(Zw(r),e)}function rN(r,e){if(r!=null){if(Ww(r))return QR(r,e);if(qw(r))return JR(r,e);if(Kw(r))return ZR(r,e);if(Gw(r))return rb(r,e);if(Qw(r))return eN(r,e);if(Jw(r))return tN(r,e)}throw Yw(r)}function hr(r,e){return e?rN(r,e):Ir(r)}function Oe(...r){let e=Bl(r);return hr(r,e)}function wi(r,e){let t=tt(r)?r:()=>r,n=o=>o.error(t());return new pt(e?o=>e.schedule(n,0,o):n)}function L_(r){return!!r&&(r instanceof pt||tt(r.lift)&&tt(r.subscribe))}var Rs=Ll(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function H1(r,e){let t=typeof e=="object";return new Promise((n,o)=>{let i=new Fl({next:s=>{n(s),i.unsubscribe()},error:o,complete:()=>{t?n(e.defaultValue):o(new Rs)}});r.subscribe(i)})}function nb(r){return r instanceof Date&&!isNaN(r)}var ete=Ll(r=>function(t=null){r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t});function Pc(r,e){let{first:t,each:n,with:o=tte,scheduler:i=e??O_,meta:s=null}=nb(r)?{first:r}:typeof r=="number"?{each:r}:r;if(t==null&&n==null)throw new TypeError("No timeout provided.");return xt((a,c)=>{let l,u,d=null,h=0,p=m=>{u=Zn(c,i,()=>{try{l.unsubscribe(),Ir(o({meta:s,lastValue:d,seen:h})).subscribe(c)}catch(y){c.error(y)}},m)};l=a.subscribe(mt(c,m=>{u?.unsubscribe(),h++,c.next(d=m),n>0&&p(n)},void 0,void 0,()=>{u?.closed||u?.unsubscribe(),d=null})),!h&&p(t!=null?typeof t=="number"?t:+t-i.now():n)})}function tte(r){throw new ete(r)}function Xe(r,e){return xt((t,n)=>{let o=0;t.subscribe(mt(n,i=>{n.next(r.call(e,i,o++))}))})}var{isArray:rte}=Array;function nte(r,e){return rte(e)?r(...e):r(e)}function ob(r){return Xe(e=>nte(r,e))}var{isArray:ote}=Array,{getPrototypeOf:ite,prototype:ste,keys:ate}=Object;function ib(r){if(r.length===1){let e=r[0];if(ote(e))return{args:e,keys:null};if(cte(e)){let t=ate(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:r,keys:null}}function cte(r){return r&&typeof r=="object"&&ite(r)===ste}function sb(r,e){return r.reduce((t,n,o)=>(t[n]=e[o],t),{})}function ab(...r){let e=Bl(r),t=zw(r),{args:n,keys:o}=ib(r);if(n.length===0)return hr([],e);let i=new pt(lte(n,e,o?s=>sb(o,s):vi));return t?i.pipe(ob(t)):i}function lte(r,e,t=vi){return n=>{nN(e,()=>{let{length:o}=r,i=new Array(o),s=o,a=o;for(let c=0;c<o;c++)nN(e,()=>{let l=hr(r[c],e),u=!1;l.subscribe(mt(n,d=>{i[c]=d,u||(u=!0,a--),a||n.next(t(i.slice()))},()=>{--s||n.complete()}))},n)},n)}}function nN(r,e,t){r?Zn(t,r,e):e()}function oN(r,e,t,n,o,i,s,a){let c=[],l=0,u=0,d=!1,h=()=>{d&&!c.length&&!l&&e.complete()},p=y=>l<n?m(y):c.push(y),m=y=>{i&&e.next(y),l++;let b=!1;Ir(t(y,u++)).subscribe(mt(e,x=>{o?.(x),i?p(x):e.next(x)},()=>{b=!0},void 0,()=>{if(b)try{for(l--;c.length&&l<n;){let x=c.shift();s?Zn(e,s,()=>m(x)):m(x)}h()}catch(x){e.error(x)}}))};return r.subscribe(mt(e,p,()=>{d=!0,h()})),()=>{a?.()}}function $r(r,e,t=1/0){return tt(e)?$r((n,o)=>Xe((i,s)=>e(n,i,o,s))(Ir(r(n,o))),t):(typeof e=="number"&&(t=e),xt((n,o)=>oN(n,o,r,t)))}function Ah(r=1/0){return $r(vi,r)}function iN(){return Ah(1)}function Dh(...r){return iN()(hr(r,Bl(r)))}function $1(r){return new pt(e=>{Ir(r()).subscribe(e)})}function F_(...r){let e=zw(r),{args:t,keys:n}=ib(r),o=new pt(i=>{let{length:s}=t;if(!s){i.complete();return}let a=new Array(s),c=s,l=s;for(let u=0;u<s;u++){let d=!1;Ir(t[u]).subscribe(mt(i,h=>{d||(d=!0,l--),a[u]=h},()=>c--,void 0,()=>{(!c||!d)&&(l||i.next(n?sb(n,a):a),i.complete())}))}});return e?o.pipe(ob(e)):o}function B_(r=0,e,t=zR){let n=-1;return e!=null&&($w(e)?t=e:n=e),new pt(o=>{let i=nb(r)?+r-t.now():r;i<0&&(i=0);let s=0;return t.schedule(function(){o.closed||(o.next(s++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function bo(r,e){return xt((t,n)=>{let o=0;t.subscribe(mt(n,i=>r.call(e,i,o++)&&n.next(i)))})}function ln(r){return xt((e,t)=>{let n=null,o=!1,i;n=e.subscribe(mt(t,void 0,void 0,s=>{i=Ir(r(s,ln(r)(e))),n?(n.unsubscribe(),n=null,i.subscribe(t)):o=!0})),o&&(n.unsubscribe(),n=null,i.subscribe(t))})}function sN(r,e,t,n,o){return(i,s)=>{let a=t,c=e,l=0;i.subscribe(mt(s,u=>{let d=l++;c=a?r(c,u,d):(a=!0,u),n&&s.next(c)},o&&(()=>{a&&s.next(c),s.complete()})))}}function Mc(r,e){return tt(e)?$r(r,e,1):$r(r,1)}function Ul(r){return xt((e,t)=>{let n=!1;e.subscribe(mt(t,o=>{n=!0,t.next(o)},()=>{n||t.next(r),t.complete()}))})}function kc(r){return r<=0?()=>jo:xt((e,t)=>{let n=0;e.subscribe(mt(t,o=>{++n<=r&&(t.next(o),r<=n&&t.complete())}))})}function cb(r=ute){return xt((e,t)=>{let n=!1;e.subscribe(mt(t,o=>{n=!0,t.next(o)},()=>n?t.complete():t.error(r())))})}function ute(){return new Rs}function Ad(r){return xt((e,t)=>{try{e.subscribe(t)}finally{t.add(r)}})}function Rc(r,e){let t=arguments.length>=2;return n=>n.pipe(r?bo((o,i)=>r(o,i,n)):vi,kc(1),t?Ul(e):cb(()=>new Rs))}function Th(r){return r<=0?()=>jo:xt((e,t)=>{let n=[];e.subscribe(mt(t,o=>{n.push(o),r<n.length&&n.shift()},()=>{for(let o of n)t.next(o);t.complete()},void 0,()=>{n=null}))})}function U_(r,e){let t=arguments.length>=2;return n=>n.pipe(r?bo((o,i)=>r(o,i,n)):vi,Th(1),t?Ul(e):cb(()=>new Rs))}function V_(r,e){return xt(sN(r,e,arguments.length>=2,!0))}function j_(...r){let e=Bl(r);return xt((t,n)=>{(e?Dh(r,t,e):Dh(r,t)).subscribe(n)})}function Jn(r,e){return xt((t,n)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&n.complete();t.subscribe(mt(n,c=>{o?.unsubscribe();let l=0,u=i++;Ir(r(c,u)).subscribe(o=mt(n,d=>n.next(e?e(c,d,u,l++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function Nc(r){return xt((e,t)=>{Ir(r).subscribe(mt(t,()=>t.complete(),V1)),!t.closed&&e.subscribe(t)})}function mn(r,e,t){let n=tt(r)||e||t?{next:r,error:e,complete:t}:r;return n?xt((o,i)=>{var s;(s=n.subscribe)===null||s===void 0||s.call(n);let a=!0;o.subscribe(mt(i,c=>{var l;(l=n.next)===null||l===void 0||l.call(n,c),i.next(c)},()=>{var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),i.complete()},c=>{var l;a=!1,(l=n.error)===null||l===void 0||l.call(n,c),i.error(c)},()=>{var c,l;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(l=n.finalize)===null||l===void 0||l.call(n)}))}):vi}function aN(r){let e=st(null);try{return r()}finally{st(e)}}var pb="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",be=class extends Error{code;constructor(e,t){super(hb(e,t)),this.code=e}};function dte(r){return`NG0${Math.abs(r)}`}function hb(r,e){return`${dte(r)}${e?": "+e:""}`}var Lc=globalThis;function cr(r){for(let e in r)if(r[e]===cr)return e;throw Error("")}function dN(r,e){for(let t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function Ho(r){if(typeof r=="string")return r;if(Array.isArray(r))return`[${r.map(Ho).join(", ")}]`;if(r==null)return""+r;let e=r.overriddenName||r.name;if(e)return`${e}`;let t=r.toString();if(t==null)return""+t;let n=t.indexOf(`
`);return n>=0?t.slice(0,n):t}function mb(r,e){return r?e?`${r} ${e}`:r:e||""}var fte=cr({__forward_ref__:cr});function $o(r){return r.__forward_ref__=$o,r.toString=function(){return Ho(this())},r}function Tn(r){return eC(r)?r():r}function eC(r){return typeof r=="function"&&r.hasOwnProperty(fte)&&r.__forward_ref__===$o}function fN(r,e,t,n){throw new Error(`ASSERTION ERROR: ${r}`+(n==null?"":` [Expected=> ${t} ${n} ${e} <=Actual]`))}function me(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function bi(r){return{providers:r.providers||[],imports:r.imports||[]}}function W1(r){return pte(r,gb)}function tC(r){return W1(r)!==null}function pte(r,e){return r.hasOwnProperty(e)&&r[e]||null}function hte(r){let e=r?.[gb]??null;return e||null}function $_(r){return r&&r.hasOwnProperty(ub)?r[ub]:null}var gb=cr({\u0275prov:cr}),ub=cr({\u0275inj:cr}),Ce=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=me({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function rC(r){return r&&!!r.\u0275providers}var nC=cr({\u0275cmp:cr}),oC=cr({\u0275dir:cr}),iC=cr({\u0275pipe:cr}),sC=cr({\u0275mod:cr}),q1=cr({\u0275fac:cr}),kd=cr({__NG_ELEMENT_ID__:cr}),cN=cr({__NG_ENV_ID__:cr});function Rd(r){return typeof r=="string"?r:r==null?"":String(r)}function pN(r){return typeof r=="function"?r.name||r.toString():typeof r=="object"&&r!=null&&typeof r.type=="function"?r.type.name||r.type.toString():Rd(r)}function aC(r,e){throw new be(-200,r)}function yb(r,e){throw new be(-201,!1)}var z_;function hN(){return z_}function Eo(r){let e=z_;return z_=r,e}function cC(r,e,t){let n=W1(r);if(n&&n.providedIn=="root")return n.value===void 0?n.value=n.factory():n.value;if(t&8)return null;if(e!==void 0)return e;yb(r,"Injector")}var mte={},Dd=mte,q_="__NG_DI_FLAG__",K_=class{injector;constructor(e){this.injector=e}retrieve(e,t){let n=Td(t)||0;try{return this.injector.get(e,n&8?null:Dd,n)}catch(o){if(yh(o))return o;throw o}}},db="ngTempTokenPath",gte="ngTokenPath",yte=/\n/gm,vte="\u0275",lN="__source";function wte(r,e=0){let t=v_();if(t===void 0)throw new be(-203,!1);if(t===null)return cC(r,void 0,e);{let n=bte(e),o=t.retrieve(r,n);if(yh(o)){if(n.optional)return null;throw o}return o}}function Ee(r,e=0){return(hN()||wte)(Tn(r),e)}function oe(r,e){return Ee(r,Td(e))}function Td(r){return typeof r>"u"||typeof r=="number"?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function bte(r){return{optional:!!(r&8),host:!!(r&1),self:!!(r&2),skipSelf:!!(r&4)}}function W_(r){let e=[];for(let t=0;t<r.length;t++){let n=Tn(r[t]);if(Array.isArray(n)){if(n.length===0)throw new be(900,!1);let o,i=0;for(let s=0;s<n.length;s++){let a=n[s],c=Ete(a);typeof c=="number"?c===-1?o=a.token:i|=c:o=a}e.push(Ee(o,i))}else e.push(Ee(n))}return e}function lC(r,e){return r[q_]=e,r.prototype[q_]=e,r}function Ete(r){return r[q_]}function xte(r,e,t,n){let o=r[db];throw e[lN]&&o.unshift(e[lN]),r.message=Ste(`
`+r.message,o,t,n),r[gte]=o,r[db]=null,r}function Ste(r,e,t,n=null){r=r&&r.charAt(0)===`
`&&r.charAt(1)==vte?r.slice(2):r;let o=Ho(e);if(Array.isArray(e))o=e.map(Ho).join(" -> ");else if(typeof e=="object"){let i=[];for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Ho(a)))}o=`{${i.join(", ")}}`}return`${t}${n?"("+n+")":""}[${o}]: ${r.replace(yte,`
  `)}`}function Vl(r,e){let t=r.hasOwnProperty(q1);return t?r[q1]:null}function mN(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++){let o=r[n],i=e[n];if(t&&(o=t(o),i=t(i)),i!==o)return!1}return!0}function gN(r){return r.flat(Number.POSITIVE_INFINITY)}function vb(r,e){r.forEach(t=>Array.isArray(t)?vb(t,e):e(t))}function uC(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function G1(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function yN(r,e,t,n){let o=r.length;if(o==e)r.push(t,n);else if(o===1)r.push(n,r[0]),r[0]=t;else{for(o--,r.push(r[o-1],r[o]);o>e;){let i=o-2;r[o]=r[i],o--}r[e]=t,r[e+1]=n}}function wb(r,e,t){let n=Mh(r,e);return n>=0?r[n|1]=t:(n=~n,yN(r,n,e,t)),n}function bb(r,e){let t=Mh(r,e);if(t>=0)return r[t|1]}function Mh(r,e){return _te(r,e,1)}function _te(r,e,t){let n=0,o=r.length>>t;for(;o!==n;){let i=n+(o-n>>1),s=r[i<<t];if(e===s)return i<<t;s>e?o=i:n=i+1}return~(o<<t)}var $l={},xo=[],Fc=new Ce(""),dC=new Ce("",-1),fC=new Ce(""),K1=class{get(e,t=Dd){if(t===Dd)throw new Ew(`NullInjectorError: No provider for ${Ho(e)}!`);return t}};function pC(r){return r[sC]||null}function zl(r){return r[nC]||null}function hC(r){return r[oC]||null}function vN(r){return r[iC]||null}function Bc(r){return{\u0275providers:r}}function wN(r){return Bc([{provide:Fc,multi:!0,useValue:r}])}function bN(...r){return{\u0275providers:mC(!0,r),\u0275fromNgModule:!0}}function mC(r,...e){let t=[],n=new Set,o,i=s=>{t.push(s)};return vb(e,s=>{let a=s;fb(a,i,[],n)&&(o||=[],o.push(a))}),o!==void 0&&EN(o,i),t}function EN(r,e){for(let t=0;t<r.length;t++){let{ngModule:n,providers:o}=r[t];gC(o,i=>{e(i,n)})}}function fb(r,e,t,n){if(r=Tn(r),!r)return!1;let o=null,i=$_(r),s=!i&&zl(r);if(!i&&!s){let c=r.ngModule;if(i=$_(c),i)o=c;else return!1}else{if(s&&!s.standalone)return!1;o=r}let a=n.has(o);if(s){if(a)return!1;if(n.add(o),s.dependencies){let c=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let l of c)fb(l,e,t,n)}}else if(i){if(i.imports!=null&&!a){n.add(o);let l;try{vb(i.imports,u=>{fb(u,e,t,n)&&(l||=[],l.push(u))})}finally{}l!==void 0&&EN(l,e)}if(!a){let l=Vl(o)||(()=>new o);e({provide:o,useFactory:l,deps:xo},o),e({provide:fC,useValue:o,multi:!0},o),e({provide:Fc,useValue:()=>Ee(o),multi:!0},o)}let c=i.providers;if(c!=null&&!a){let l=r;gC(c,u=>{e(u,l)})}}else return!1;return o!==r&&r.providers!==void 0}function gC(r,e){for(let t of r)rC(t)&&(t=t.\u0275providers),Array.isArray(t)?gC(t,e):e(t)}var Cte=cr({provide:String,useValue:cr});function xN(r){return r!==null&&typeof r=="object"&&Cte in r}function Ite(r){return!!(r&&r.useExisting)}function Ate(r){return!!(r&&r.useFactory)}function Pd(r){return typeof r=="function"}function SN(r){return!!r.useClass}var Y1=new Ce(""),lb={},uN={},H_;function X1(){return H_===void 0&&(H_=new K1),H_}var zr=class{},Md=class extends zr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,n,o){super(),this.parent=t,this.source=n,this.scopes=o,Y_(e,s=>this.processProvider(s)),this.records.set(dC,Ph(void 0,this)),o.has("environment")&&this.records.set(zr,Ph(void 0,this));let i=this.records.get(Y1);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(fC,xo,{self:!0}))}retrieve(e,t){let n=Td(t)||0;try{return this.get(e,Dd,n)}catch(o){if(yh(o))return o;throw o}}destroy(){z1(this),this._destroyed=!0;let e=st(null);try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),st(e)}}onDestroy(e){return z1(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){z1(this);let t=Tc(this),n=Eo(void 0),o;try{return e()}finally{Tc(t),Eo(n)}}get(e,t=Dd,n){if(z1(this),e.hasOwnProperty(cN))return e[cN](this);let o=Td(n),i,s=Tc(this),a=Eo(void 0);try{if(!(o&4)){let l=this.records.get(e);if(l===void 0){let u=kte(e)&&W1(e);u&&this.injectableDefInScope(u)?l=Ph(G_(e),lb):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l)}let c=o&2?X1():this.parent;return t=o&8&&t===Dd?null:t,c.get(e,t)}catch(c){if(yh(c)){if((c[db]=c[db]||[]).unshift(Ho(e)),s)throw c;return xte(c,e,"R3InjectorError",this.source)}else throw c}finally{Eo(a),Tc(s)}}resolveInjectorInitializers(){let e=st(null),t=Tc(this),n=Eo(void 0),o;try{let i=this.get(Fc,xo,{self:!0});for(let s of i)s()}finally{Tc(t),Eo(n),st(e)}}toString(){let e=[],t=this.records;for(let n of t.keys())e.push(Ho(n));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Tn(e);let t=Pd(e)?e:Tn(e&&e.provide),n=Tte(e);if(!Pd(e)&&e.multi===!0){let o=this.records.get(t);o||(o=Ph(void 0,lb,!0),o.factory=()=>W_(o.multi),this.records.set(t,o)),t=e,o.multi.push(e)}this.records.set(t,n)}hydrate(e,t){let n=st(null);try{return t.value===uN?aC(Ho(e)):t.value===lb&&(t.value=uN,t.value=t.factory()),typeof t.value=="object"&&t.value&&Mte(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{st(n)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Tn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function G_(r){let e=W1(r),t=e!==null?e.factory:Vl(r);if(t!==null)return t;if(r instanceof Ce)throw new be(204,!1);if(r instanceof Function)return Dte(r);throw new be(204,!1)}function Dte(r){if(r.length>0)throw new be(204,!1);let t=hte(r);return t!==null?()=>t.factory(r):()=>new r}function Tte(r){if(xN(r))return Ph(void 0,r.useValue);{let e=yC(r);return Ph(e,lb)}}function yC(r,e,t){let n;if(Pd(r)){let o=Tn(r);return Vl(o)||G_(o)}else if(xN(r))n=()=>Tn(r.useValue);else if(Ate(r))n=()=>r.useFactory(...W_(r.deps||[]));else if(Ite(r))n=()=>Ee(Tn(r.useExisting));else{let o=Tn(r&&(r.useClass||r.provide));if(Pte(r))n=()=>new o(...W_(r.deps));else return Vl(o)||G_(o)}return n}function z1(r){if(r.destroyed)throw new be(205,!1)}function Ph(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function Pte(r){return!!r.deps}function Mte(r){return r!==null&&typeof r=="object"&&typeof r.ngOnDestroy=="function"}function kte(r){return typeof r=="function"||typeof r=="object"&&r.ngMetadataName==="InjectionToken"}function Y_(r,e){for(let t of r)Array.isArray(t)?Y_(t,e):t&&rC(t)?Y_(t.\u0275providers,e):e(t)}function So(r,e){let t;r instanceof Md?(z1(r),t=r):t=new K_(r);let n,o=Tc(t),i=Eo(void 0);try{return e()}finally{Tc(o),Eo(i)}}function _N(){return hN()!==void 0||v_()!=null}var Ns=0,ot=1,et=2,gn=3,Xi=4,Qi=5,Q1=6,kh=7,eo=8,Nd=9,Ra=10,Ar=11,Rh=12,vC=13,Od=14,Zi=15,ql=16,Ld=17,Na=18,Z1=19,wC=20,Oc=21,Eb=22,J1=23,Ei=24,xb=25,_o=26,CN=1;var Kl=7,e0=8,Fd=9,Co=10;function Oa(r){return Array.isArray(r)&&typeof r[CN]=="object"}function Os(r){return Array.isArray(r)&&r[CN]===!0}function bC(r){return(r.flags&4)!==0}function Wl(r){return r.componentOffset>-1}function Sb(r){return(r.flags&1)===1}function La(r){return!!r.template}function Nh(r){return(r[et]&512)!==0}function Bd(r){return(r[et]&256)===256}var IN="svg",AN="math";function Ji(r){for(;Array.isArray(r);)r=r[Ns];return r}function EC(r,e){return Ji(e[r])}function Ls(r,e){return Ji(e[r.index])}function _b(r,e){return r.data[e]}function Cb(r,e){return r[e]}function xC(r,e,t,n){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),e[t]=n}function es(r,e){let t=e[r];return Oa(t)?t:t[Ns]}function DN(r){return(r[et]&4)===4}function Ib(r){return(r[et]&128)===128}function TN(r){return Os(r[gn])}function t0(r,e){return e==null?null:r[e]}function SC(r){r[Ld]=0}function _C(r){r[et]&1024||(r[et]|=1024,Ib(r)&&n0(r))}function PN(r,e){for(;r>0;)e=e[Od],r--;return e}function r0(r){return!!(r[et]&9216||r[Ei]?.dirty)}function Ab(r){r[Ra].changeDetectionScheduler?.notify(8),r[et]&64&&(r[et]|=1024),r0(r)&&n0(r)}function n0(r){r[Ra].changeDetectionScheduler?.notify(0);let e=jl(r);for(;e!==null&&!(e[et]&8192||(e[et]|=8192,!Ib(e)));)e=jl(e)}function CC(r,e){if(Bd(r))throw new be(911,!1);r[Oc]===null&&(r[Oc]=[]),r[Oc].push(e)}function MN(r,e){if(r[Oc]===null)return;let t=r[Oc].indexOf(e);t!==-1&&r[Oc].splice(t,1)}function jl(r){let e=r[gn];return Os(e)?e[gn]:e}function IC(r){return r[kh]??=[]}function AC(r){return r.cleanup??=[]}function kN(r,e,t,n){let o=IC(e);o.push(t),r.firstCreatePass&&AC(r).push(n,o.length-1)}var dt={lFrame:YN(null),bindingsEnabled:!0,skipHydrationRootTNode:null},o0=function(r){return r[r.Off=0]="Off",r[r.Exhaustive=1]="Exhaustive",r[r.OnlyDirtyViews=2]="OnlyDirtyViews",r}(o0||{}),Rte=0,X_=!1;function RN(){return dt.lFrame.elementDepthCount}function NN(){dt.lFrame.elementDepthCount++}function ON(){dt.lFrame.elementDepthCount--}function DC(){return dt.bindingsEnabled}function LN(){return dt.skipHydrationRootTNode!==null}function FN(r){return dt.skipHydrationRootTNode===r}function BN(){dt.skipHydrationRootTNode=null}function St(){return dt.lFrame.lView}function yn(){return dt.lFrame.tView}function at(r){return dt.lFrame.contextLView=r,r[eo]}function ct(r){return dt.lFrame.contextLView=null,r}function to(){let r=TC();for(;r!==null&&r.type===64;)r=r.parent;return r}function TC(){return dt.lFrame.currentTNode}function UN(){let r=dt.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}function Oh(r,e){let t=dt.lFrame;t.currentTNode=r,t.isParent=e}function PC(){return dt.lFrame.isParent}function VN(){dt.lFrame.isParent=!1}function jN(){return dt.lFrame.contextLView}function MC(r){fN("Must never be called in production mode"),Rte=r}function kC(){return X_}function RC(r){let e=X_;return X_=r,e}function Db(){let r=dt.lFrame,e=r.bindingRootIndex;return e===-1&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}function HN(){return dt.lFrame.bindingIndex}function $N(r){return dt.lFrame.bindingIndex=r}function i0(){return dt.lFrame.bindingIndex++}function Tb(r){let e=dt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}function zN(){return dt.lFrame.inI18n}function qN(r,e){let t=dt.lFrame;t.bindingIndex=t.bindingRootIndex=r,Pb(e)}function KN(){return dt.lFrame.currentDirectiveIndex}function Pb(r){dt.lFrame.currentDirectiveIndex=r}function WN(r){let e=dt.lFrame.currentDirectiveIndex;return e===-1?null:r[e]}function NC(){return dt.lFrame.currentQueryIndex}function Mb(r){dt.lFrame.currentQueryIndex=r}function Nte(r){let e=r[ot];return e.type===2?e.declTNode:e.type===1?r[Qi]:null}function OC(r,e,t){if(t&4){let o=e,i=r;for(;o=o.parent,o===null&&!(t&1);)if(o=Nte(i),o===null||(i=i[Od],o.type&10))break;if(o===null)return!1;e=o,r=i}let n=dt.lFrame=GN();return n.currentTNode=e,n.lView=r,!0}function kb(r){let e=GN(),t=r[ot];dt.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function GN(){let r=dt.lFrame,e=r===null?null:r.child;return e===null?YN(r):e}function YN(r){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return r!==null&&(r.child=e),e}function XN(){let r=dt.lFrame;return dt.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}var LC=XN;function Rb(){let r=XN();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function QN(r){return(dt.lFrame.contextLView=PN(r,dt.lFrame.contextLView))[eo]}function Uc(){return dt.lFrame.selectedIndex}function Gl(r){dt.lFrame.selectedIndex=r}function Nb(){let r=dt.lFrame;return _b(r.tView,r.selectedIndex)}function ZN(){return dt.lFrame.currentNamespace}var JN=!0;function Ob(){return JN}function Lb(r){JN=r}function Q_(r,e=null,t=null,n){let o=FC(r,e,t,n);return o.resolveInjectorInitializers(),o}function FC(r,e=null,t=null,n,o=new Set){let i=[t||xo,bN(r)];return n=n||(typeof r=="object"?void 0:Ho(r)),new Md(i,e||X1(),n||null,o)}var Yi=class r{static THROW_IF_NOT_FOUND=Dd;static NULL=new K1;static create(e,t){if(Array.isArray(e))return Q_({name:""},t,e,"");{let n=e.name??"";return Q_({name:n},e.parent,e.providers,n)}}static \u0275prov=me({token:r,providedIn:"any",factory:()=>Ee(dC)});static __NG_ELEMENT_ID__=-1},qr=new Ce(""),Yl=(()=>{class r{static __NG_ELEMENT_ID__=Ote;static __NG_ENV_ID__=t=>t}return r})(),Z_=class extends Yl{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Bd(this._lView)}onDestroy(e){let t=this._lView;return CC(t,e),()=>MN(t,e)}};function Ote(){return new Z_(St())}var ka=class{_console=console;handleError(e){this._console.error("ERROR",e)}},Io=new Ce("",{providedIn:"root",factory:()=>{let r=oe(zr),e;return t=>{r.destroyed&&!e?setTimeout(()=>{throw t}):(e??=r.get(ka),e.handleError(t))}}}),eO={provide:Fc,useValue:()=>void oe(ka),multi:!0},Lte=new Ce("",{providedIn:"root",factory:()=>{let r=oe(qr).defaultView;if(!r)return;let e=oe(Io),t=i=>{e(i.reason),i.preventDefault()},n=i=>{i.error?e(i.error):e(new Error(i.message,{cause:i})),i.preventDefault()},o=()=>{r.addEventListener("unhandledrejection",t),r.addEventListener("error",n)};typeof Zone<"u"?Zone.root.run(o):o(),oe(Yl).onDestroy(()=>{r.removeEventListener("error",n),r.removeEventListener("unhandledrejection",t)})}});function BC(){return Bc([wN(()=>void oe(Lte))])}function UC(r){return typeof r=="function"&&r[Qn]!==void 0}function Xl(r,e){let[t,n,o]=S_(r,e?.equal),i=t,s=i[Qn];return i.set=n,i.update=o,i.asReadonly=tO.bind(i),i}function tO(){let r=this[Qn];if(r.readonlyFn===void 0){let e=()=>this();e[Qn]=r,r.readonlyFn=e}return r.readonlyFn}function VC(r){return UC(r)&&typeof r.set=="function"}var Hl=class{},s0=new Ce("",{providedIn:"root",factory:()=>!1});var jC=new Ce(""),HC=new Ce("");var Vc=(()=>{class r{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new cn(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new pt(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=me({token:r,providedIn:"root",factory:()=>new r})}return r})(),Fb=(()=>{class r{internalPendingTasks=oe(Vc);scheduler=oe(Hl);errorHandler=oe(Io);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let n=this.add();t().catch(this.errorHandler).finally(n)}static \u0275prov=me({token:r,providedIn:"root",factory:()=>new r})}return r})();function a0(...r){}var $C=(()=>{class r{static \u0275prov=me({token:r,providedIn:"root",factory:()=>new J_})}return r})(),J_=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,n=this.queues.get(t);n.has(e)&&(n.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let n=this.queues.get(t);n.has(e)||n.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,n]of this.queues)t===null?e||=this.flushQueue(n):e||=t.run(()=>this.flushQueue(n));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let n of e)n.dirty&&(this.dirtyEffectCount--,t=!0,n.run());return t}};function Vh(r){return{toString:r}.toString()}var Bb="__parameters__";function qte(r){return function(...t){if(r){let n=r(...t);for(let o in n)this[o]=n[o]}}}function kO(r,e,t){return Vh(()=>{let n=qte(e);function o(...i){if(this instanceof o)return n.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(c,l,u){let d=c.hasOwnProperty(Bb)?c[Bb]:Object.defineProperty(c,Bb,{value:[]})[Bb];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),c}}return o.prototype.ngMetadataName=r,o.annotationCls=o,o})}var RO=lC(kO("Optional"),8);var NO=lC(kO("SkipSelf"),4);function Kte(r){return typeof r=="function"}var qb=class{previousValue;currentValue;firstChange;constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}};function OO(r,e,t,n){e!==null?e.applyValueToInputSignal(e,n):r[t]=n}var Ua=(()=>{let r=()=>LO;return r.ngInherit=!0,r})();function LO(r){return r.type.prototype.ngOnChanges&&(r.setInput=Gte),Wte}function Wte(){let r=BO(this),e=r?.current;if(e){let t=r.previous;if(t===$l)r.previous=e;else for(let n in e)t[n]=e[n];r.current=null,this.ngOnChanges(e)}}function Gte(r,e,t,n,o){let i=this.declaredInputs[n],s=BO(r)||Yte(r,{previous:$l,current:null}),a=s.current||(s.current={}),c=s.previous,l=c[i];a[i]=new qb(l&&l.currentValue,t,c===$l),OO(r,e,o,t)}var FO="__ngSimpleChanges__";function BO(r){return r[FO]||null}function Yte(r,e){return r[FO]=e}var rO=[];var Wt=function(r,e=null,t){for(let n=0;n<rO.length;n++){let o=rO[n];o(r,e,t)}};function Xte(r,e,t){let{ngOnChanges:n,ngOnInit:o,ngDoCheck:i}=e.type.prototype;if(n){let s=LO(e);(t.preOrderHooks??=[]).push(r,s),(t.preOrderCheckHooks??=[]).push(r,s)}o&&(t.preOrderHooks??=[]).push(0-r,o),i&&((t.preOrderHooks??=[]).push(r,i),(t.preOrderCheckHooks??=[]).push(r,i))}function UO(r,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){let i=r.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=i;s&&(r.contentHooks??=[]).push(-t,s),a&&((r.contentHooks??=[]).push(t,a),(r.contentCheckHooks??=[]).push(t,a)),c&&(r.viewHooks??=[]).push(-t,c),l&&((r.viewHooks??=[]).push(t,l),(r.viewCheckHooks??=[]).push(t,l)),u!=null&&(r.destroyHooks??=[]).push(t,u)}}function jb(r,e,t){VO(r,e,3,t)}function Hb(r,e,t,n){(r[et]&3)===t&&VO(r,e,t,n)}function zC(r,e){let t=r[et];(t&3)===e&&(t&=16383,t+=1,r[et]=t)}function VO(r,e,t,n){let o=n!==void 0?r[Ld]&65535:0,i=n??-1,s=e.length-1,a=0;for(let c=o;c<s;c++)if(typeof e[c+1]=="number"){if(a=e[c],n!=null&&a>=n)break}else e[c]<0&&(r[Ld]+=65536),(a<i||i==-1)&&(Qte(r,t,e,c),r[Ld]=(r[Ld]&4294901760)+c+2),c++}function nO(r,e){Wt(4,r,e);let t=st(null);try{e.call(r)}finally{st(t),Wt(5,r,e)}}function Qte(r,e,t,n){let o=t[n]<0,i=t[n+1],s=o?-t[n]:t[n],a=r[s];o?r[et]>>14<r[Ld]>>16&&(r[et]&3)===e&&(r[et]+=16384,nO(a,i)):nO(a,i)}var Fh=-1,jd=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,n){this.factory=e,this.canSeeViewProviders=t,this.injectImpl=n}};function Zte(r){return(r.flags&8)!==0}function Jte(r){return(r.flags&16)!==0}function ere(r,e,t){let n=0;for(;n<t.length;){let o=t[n];if(typeof o=="number"){if(o!==0)break;n++;let i=t[n++],s=t[n++],a=t[n++];r.setAttribute(e,s,a,i)}else{let i=o,s=t[++n];tre(i)?r.setProperty(e,i,s):r.setAttribute(e,i,s),n++}}return n}function jO(r){return r===3||r===4||r===6}function tre(r){return r.charCodeAt(0)===64}function u0(r,e){if(!(e===null||e.length===0))if(r===null||r.length===0)r=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){let o=e[n];typeof o=="number"?t=o:t===0||(t===-1||t===2?oO(r,t,o,null,e[++n]):oO(r,t,o,null,null))}}return r}function oO(r,e,t,n,o){let i=0,s=r.length;if(e===-1)s=-1;else for(;i<r.length;){let a=r[i++];if(typeof a=="number"){if(a===e){s=-1;break}else if(a>e){s=i-1;break}}}for(;i<r.length;){let a=r[i];if(typeof a=="number")break;if(a===t){o!==null&&(r[i+1]=o);return}i++,o!==null&&i++}s!==-1&&(r.splice(s,0,e),i=s+1),r.splice(i++,0,t),o!==null&&r.splice(i++,0,o)}function HO(r){return r!==Fh}function Kb(r){return r&32767}function rre(r){return r>>16}function Wb(r,e){let t=rre(r),n=e;for(;t>0;)n=n[Od],t--;return n}var t7=!0;function Gb(r){let e=t7;return t7=r,e}var nre=256,$O=nre-1,zO=5,ore=0,Fa={};function ire(r,e,t){let n;typeof t=="string"?n=t.charCodeAt(0)||0:t.hasOwnProperty(kd)&&(n=t[kd]),n==null&&(n=t[kd]=ore++);let o=n&$O,i=1<<o;e.data[r+(o>>zO)]|=i}function Yb(r,e){let t=qO(r,e);if(t!==-1)return t;let n=e[ot];n.firstCreatePass&&(r.injectorIndex=e.length,qC(n.data,r),qC(e,null),qC(n.blueprint,null));let o=A7(r,e),i=r.injectorIndex;if(HO(o)){let s=Kb(o),a=Wb(o,e),c=a[ot].data;for(let l=0;l<8;l++)e[i+l]=a[s+l]|c[s+l]}return e[i+8]=o,i}function qC(r,e){r.push(0,0,0,0,0,0,0,0,e)}function qO(r,e){return r.injectorIndex===-1||r.parent&&r.parent.injectorIndex===r.injectorIndex||e[r.injectorIndex+8]===null?-1:r.injectorIndex}function A7(r,e){if(r.parent&&r.parent.injectorIndex!==-1)return r.parent.injectorIndex;let t=0,n=null,o=e;for(;o!==null;){if(n=XO(o),n===null)return Fh;if(t++,o=o[Od],n.injectorIndex!==-1)return n.injectorIndex|t<<16}return Fh}function r7(r,e,t){ire(r,e,t)}function sre(r,e){if(e==="class")return r.classes;if(e==="style")return r.styles;let t=r.attrs;if(t){let n=t.length,o=0;for(;o<n;){let i=t[o];if(jO(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<n&&typeof t[o]=="string";)o++;else{if(i===e)return t[o+1];o=o+2}}}return null}function KO(r,e,t){if(t&8||r!==void 0)return r;yb(e,"NodeInjector")}function WO(r,e,t,n){if(t&8&&n===void 0&&(n=null),(t&3)===0){let o=r[Nd],i=Eo(void 0);try{return o?o.get(e,n,t&8):cC(e,n,t&8)}finally{Eo(i)}}return KO(n,e,t)}function GO(r,e,t,n=0,o){if(r!==null){if(e[et]&2048&&!(n&2)){let s=ure(r,e,t,n,Fa);if(s!==Fa)return s}let i=YO(r,e,t,n,Fa);if(i!==Fa)return i}return WO(e,t,n,o)}function YO(r,e,t,n,o){let i=cre(t);if(typeof i=="function"){if(!OC(e,r,n))return n&1?KO(o,t,n):WO(e,t,n,o);try{let s;if(s=i(n),s==null&&!(n&8))yb(t);else return s}finally{LC()}}else if(typeof i=="number"){let s=null,a=qO(r,e),c=Fh,l=n&1?e[Zi][Qi]:null;for((a===-1||n&4)&&(c=a===-1?A7(r,e):e[a+8],c===Fh||!sO(n,!1)?a=-1:(s=e[ot],a=Kb(c),e=Wb(c,e)));a!==-1;){let u=e[ot];if(iO(i,a,u.data)){let d=are(a,e,t,s,n,l);if(d!==Fa)return d}c=e[a+8],c!==Fh&&sO(n,e[ot].data[a+8]===l)&&iO(i,a,e)?(s=u,a=Kb(c),e=Wb(c,e)):a=-1}}return o}function are(r,e,t,n,o,i){let s=e[ot],a=s.data[r+8],c=n==null?Wl(a)&&t7:n!=s&&(a.type&3)!==0,l=o&1&&i===a,u=$b(a,s,t,c,l);return u!==null?d0(e,s,u,a):Fa}function $b(r,e,t,n,o){let i=r.providerIndexes,s=e.data,a=i&1048575,c=r.directiveStart,l=r.directiveEnd,u=i>>20,d=n?a:a+u,h=o?a+u:l;for(let p=d;p<h;p++){let m=s[p];if(p<c&&t===m||p>=c&&m.type===t)return p}if(o){let p=s[c];if(p&&La(p)&&p.type===t)return c}return null}function d0(r,e,t,n){let o=r[t],i=e.data;if(o instanceof jd){let s=o;s.resolving&&aC(pN(i[t]));let a=Gb(s.canSeeViewProviders);s.resolving=!0;let c=i[t].type||i[t],l,u=s.injectImpl?Eo(s.injectImpl):null,d=OC(r,n,0);try{o=r[t]=s.factory(void 0,i,r,n),e.firstCreatePass&&t>=n.directiveStart&&Xte(t,i[t],e)}finally{u!==null&&Eo(u),Gb(a),s.resolving=!1,LC()}}return o}function cre(r){if(typeof r=="string")return r.charCodeAt(0)||0;let e=r.hasOwnProperty(kd)?r[kd]:void 0;return typeof e=="number"?e>=0?e&$O:lre:e}function iO(r,e,t){let n=1<<r;return!!(t[e+(r>>zO)]&n)}function sO(r,e){return!(r&2)&&!(r&1&&e)}var Vd=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return GO(this._tNode,this._lView,e,Td(n),t)}};function lre(){return new Vd(to(),St())}function ts(r){return Vh(()=>{let e=r.prototype.constructor,t=e[q1]||n7(e),n=Object.prototype,o=Object.getPrototypeOf(r.prototype).constructor;for(;o&&o!==n;){let i=o[q1]||n7(o);if(i&&i!==t)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function n7(r){return eC(r)?()=>{let e=n7(Tn(r));return e&&e()}:Vl(r)}function ure(r,e,t,n,o){let i=r,s=e;for(;i!==null&&s!==null&&s[et]&2048&&!Nh(s);){let a=YO(i,s,t,n|2,Fa);if(a!==Fa)return a;let c=i.parent;if(!c){let l=s[wC];if(l){let u=l.get(t,Fa,n);if(u!==Fa)return u}c=XO(s),s=s[Od]}i=c}return o}function XO(r){let e=r[ot],t=e.type;return t===2?e.declTNode:t===1?r[Qi]:null}function m0(r){return sre(to(),r)}function dre(){return jh(to(),St())}function jh(r,e){return new ro(Ls(r,e))}var ro=(()=>{class r{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=dre}return r})();function fre(r){return r instanceof ro?r.nativeElement:r}function pre(){return this._results[Symbol.iterator]()}var Xb=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Ht}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let n=gN(e);(this._changesDetected=!mN(this._results,n,t))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=pre};function QO(r){return(r.flags&128)===128}var D7=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(D7||{}),ZO=new Map,hre=0;function mre(){return hre++}function gre(r){ZO.set(r[Z1],r)}function o7(r){ZO.delete(r[Z1])}var aO="__ngContext__";function g0(r,e){Oa(e)?(r[aO]=e[Z1],gre(e)):r[aO]=e}function JO(r){return tL(r[Rh])}function eL(r){return tL(r[Xi])}function tL(r){for(;r!==null&&!Os(r);)r=r[Xi];return r}var i7;function T7(r){i7=r}function rL(){if(i7!==void 0)return i7;if(typeof document<"u")return document;throw new be(210,!1)}var a3=new Ce("",{providedIn:"root",factory:()=>yre}),yre="ng",c3=new Ce(""),Hh=new Ce("",{providedIn:"platform",factory:()=>"unknown"});var l3=new Ce("",{providedIn:"root",factory:()=>rL().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var vre="h",wre="b";var nL=!1,oL=new Ce("",{providedIn:"root",factory:()=>nL});var bre=(r,e,t,n)=>{};function Ere(r,e,t,n){bre(r,e,t,n)}var xre=()=>null;function iL(r,e,t=!1){return xre(r,e,t)}function sL(r,e){let t=r.contentQueries;if(t!==null){let n=st(null);try{for(let o=0;o<t.length;o+=2){let i=t[o],s=t[o+1];if(s!==-1){let a=r.data[s];Mb(i),a.contentQueries(2,e[s],s)}}}finally{st(n)}}}function s7(r,e,t){Mb(0);let n=st(null);try{e(r,t)}finally{st(n)}}function aL(r,e,t){if(bC(e)){let n=st(null);try{let o=e.directiveStart,i=e.directiveEnd;for(let s=o;s<i;s++){let a=r.data[s];if(a.contentQueries){let c=t[s];a.contentQueries(1,c,s)}}}finally{st(n)}}}var jc=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(jc||{});var Ub;function Sre(){if(Ub===void 0&&(Ub=null,Lc.trustedTypes))try{Ub=Lc.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Ub}function cO(r){return Sre()?.createScriptURL(r)||r}var Qb=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${pb})`}};function y0(r){return r instanceof Qb?r.changingThisBreaksApplicationSecurity:r}function P7(r,e){let t=cL(r);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${pb})`)}return t===e}function cL(r){return r instanceof Qb&&r.getTypeName()||null}var _re=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function lL(r){return r=String(r),r.match(_re)?r:"unsafe:"+r}var u3=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(u3||{});function Jl(r){let e=dL();return e?e.sanitize(u3.URL,r)||"":P7(r,"URL")?y0(r):lL(Rd(r))}function uL(r){let e=dL();if(e)return cO(e.sanitize(u3.RESOURCE_URL,r)||"");if(P7(r,"ResourceURL"))return cO(y0(r));throw new be(904,!1)}function Cre(r,e){return e==="src"&&(r==="embed"||r==="frame"||r==="iframe"||r==="media"||r==="script")||e==="href"&&(r==="base"||r==="link")?uL:Jl}function M7(r,e,t){return Cre(e,t)(r)}function dL(){let r=St();return r&&r[Ra].sanitizer}function fL(r){return r instanceof Function?r():r}function Ire(r,e,t){let n=r.length;for(;;){let o=r.indexOf(e,t);if(o===-1)return o;if(o===0||r.charCodeAt(o-1)<=32){let i=e.length;if(o+i===n||r.charCodeAt(o+i)<=32)return o}t=o+1}}var pL="ng-template";function Are(r,e,t,n){let o=0;if(n){for(;o<e.length&&typeof e[o]=="string";o+=2)if(e[o]==="class"&&Ire(e[o+1].toLowerCase(),t,0)!==-1)return!0}else if(k7(r))return!1;if(o=e.indexOf(1,o),o>-1){let i;for(;++o<e.length&&typeof(i=e[o])=="string";)if(i.toLowerCase()===t)return!0}return!1}function k7(r){return r.type===4&&r.value!==pL}function Dre(r,e,t){let n=r.type===4&&!t?pL:r.value;return e===n}function Tre(r,e,t){let n=4,o=r.attrs,i=o!==null?kre(o):0,s=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!s&&!Fs(n)&&!Fs(c))return!1;if(s&&Fs(c))continue;s=!1,n=c|n&1;continue}if(!s)if(n&4){if(n=2|n&1,c!==""&&!Dre(r,c,t)||c===""&&e.length===1){if(Fs(n))return!1;s=!0}}else if(n&8){if(o===null||!Are(r,o,c,t)){if(Fs(n))return!1;s=!0}}else{let l=e[++a],u=Pre(c,o,k7(r),t);if(u===-1){if(Fs(n))return!1;s=!0;continue}if(l!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),n&2&&l!==d){if(Fs(n))return!1;s=!0}}}}return Fs(n)||s}function Fs(r){return(r&1)===0}function Pre(r,e,t,n){if(e===null)return-1;let o=0;if(n||!t){let i=!1;for(;o<e.length;){let s=e[o];if(s===r)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=e[++o];for(;typeof a=="string";)a=e[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return Rre(e,r)}function Mre(r,e,t=!1){for(let n=0;n<e.length;n++)if(Tre(r,e[n],t))return!0;return!1}function kre(r){for(let e=0;e<r.length;e++){let t=r[e];if(jO(t))return e}return r.length}function Rre(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){let n=r[t];if(typeof n=="number")return-1;if(n===e)return t;t++}return-1}function lO(r,e){return r?":not("+e.trim()+")":e}function Nre(r){let e=r[0],t=1,n=2,o="",i=!1;for(;t<r.length;){let s=r[t];if(typeof s=="string")if(n&2){let a=r[++t];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else n&8?o+="."+s:n&4&&(o+=" "+s);else o!==""&&!Fs(s)&&(e+=lO(i,o),o=""),n=s,i=i||!Fs(n);t++}return o!==""&&(e+=lO(i,o)),e}function Ore(r){return r.map(Nre).join(",")}function Lre(r){let e=[],t=[],n=1,o=2;for(;n<r.length;){let i=r[n];if(typeof i=="string")o===2?i!==""&&e.push(i,r[++n]):o===8&&t.push(i);else{if(!Fs(o))break;o=i}n++}return t.length&&e.push(1,...t),e}var zo={};function Fre(r,e){return r.createText(e)}function Bre(r,e,t){r.setValue(e,t)}function hL(r,e,t){return r.createElement(e,t)}function Zb(r,e,t,n,o){r.insertBefore(e,t,n,o)}function mL(r,e,t){r.appendChild(e,t)}function uO(r,e,t,n,o){n!==null?Zb(r,e,t,n,o):mL(r,e,t)}function Ure(r,e,t){r.removeChild(null,e,t)}function Vre(r,e,t){r.setAttribute(e,"style",t)}function jre(r,e,t){t===""?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t)}function gL(r,e,t){let{mergedAttrs:n,classes:o,styles:i}=t;n!==null&&ere(r,e,n),o!==null&&jre(r,e,o),i!==null&&Vre(r,e,i)}function R7(r,e,t,n,o,i,s,a,c,l,u){let d=_o+n,h=d+o,p=Hre(d,h),m=typeof l=="function"?l():l;return p[ot]={type:r,blueprint:p,template:t,queries:null,viewQuery:a,declTNode:e,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:c,consts:m,incompleteFirstPass:!1,ssrId:u}}function Hre(r,e){let t=[];for(let n=0;n<e;n++)t.push(n<r?null:zo);return t}function $re(r){let e=r.tView;return e===null||e.incompleteFirstPass?r.tView=R7(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):e}function N7(r,e,t,n,o,i,s,a,c,l,u){let d=e.blueprint.slice();return d[Ns]=o,d[et]=n|4|128|8|64|1024,(l!==null||r&&r[et]&2048)&&(d[et]|=2048),SC(d),d[gn]=d[Od]=r,d[eo]=t,d[Ra]=s||r&&r[Ra],d[Ar]=a||r&&r[Ar],d[Nd]=c||r&&r[Nd]||null,d[Qi]=i,d[Z1]=mre(),d[Q1]=u,d[wC]=l,d[Zi]=e.type==2?r[Zi]:d,d}function zre(r,e,t){let n=Ls(e,r),o=$re(t),i=r[Ra].rendererFactory,s=O7(r,N7(r,o,null,yL(t),n,e,null,i.createRenderer(n,t),null,null,null));return r[e.index]=s}function yL(r){let e=16;return r.signals?e=4096:r.onPush&&(e=64),e}function vL(r,e,t,n){if(t===0)return-1;let o=e.length;for(let i=0;i<t;i++)e.push(n),r.blueprint.push(n),r.data.push(null);return o}function O7(r,e){return r[Rh]?r[vC][Xi]=e:r[Rh]=e,r[vC]=e,e}function R(r=1){wL(yn(),St(),Uc()+r,!1)}function wL(r,e,t,n){if(!n)if((e[et]&3)===3){let i=r.preOrderCheckHooks;i!==null&&jb(e,i,t)}else{let i=r.preOrderHooks;i!==null&&Hb(e,i,0,t)}Gl(t)}var d3=function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r}(d3||{});function a7(r,e,t,n){let o=st(null);try{let[i,s,a]=r.inputs[t],c=null;(s&d3.SignalBased)!==0&&(c=e[i][Qn]),c!==null&&c.transformFn!==void 0?n=c.transformFn(n):a!==null&&(n=a.call(e,n)),r.setInput!==null?r.setInput(e,c,n,t,i):OO(e,c,i,n)}finally{st(o)}}function bL(r,e,t,n,o){let i=Uc(),s=n&2;try{Gl(-1),s&&e.length>_o&&wL(r,e,_o,!1),Wt(s?2:0,o,t),t(n,o)}finally{Gl(i),Wt(s?3:1,o,t)}}function L7(r,e,t){Qre(r,e,t),(t.flags&64)===64&&Zre(r,e,t)}function EL(r,e,t=Ls){let n=e.localNames;if(n!==null){let o=e.index+1;for(let i=0;i<n.length;i+=2){let s=n[i+1],a=s===-1?t(e,r):r[s];r[o++]=a}}}function qre(r,e,t,n){let i=n.get(oL,nL)||t===jc.ShadowDom,s=r.selectRootElement(e,i);return Kre(s),s}function Kre(r){Wre(r)}var Wre=()=>null;function Gre(r){return r==="class"?"className":r==="for"?"htmlFor":r==="formaction"?"formAction":r==="innerHtml"?"innerHTML":r==="readonly"?"readOnly":r==="tabindex"?"tabIndex":r}function xL(r,e,t,n,o,i){let s=e[ot];if(F7(r,s,e,t,n)){Wl(r)&&Xre(e,r.index);return}Yre(r,e,t,n,o,i)}function Yre(r,e,t,n,o,i){if(r.type&3){let s=Ls(r,e);t=Gre(t),n=i!=null?i(n,r.value||"",t):n,o.setProperty(s,t,n)}else r.type&12}function Xre(r,e){let t=es(e,r);t[et]&16||(t[et]|=64)}function Qre(r,e,t){let n=t.directiveStart,o=t.directiveEnd;Wl(t)&&zre(e,t,r.data[n+t.componentOffset]),r.firstCreatePass||Yb(t,e);let i=t.initialInputs;for(let s=n;s<o;s++){let a=r.data[s],c=d0(e,r,s,t);if(g0(c,e),i!==null&&rne(e,s-n,c,a,t,i),La(a)){let l=es(t.index,e);l[eo]=d0(e,r,s,t)}}}function Zre(r,e,t){let n=t.directiveStart,o=t.directiveEnd,i=t.index,s=KN();try{Gl(i);for(let a=n;a<o;a++){let c=r.data[a],l=e[a];Pb(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&Jre(c,l)}}finally{Gl(-1),Pb(s)}}function Jre(r,e){r.hostBindings!==null&&r.hostBindings(1,e)}function SL(r,e){let t=r.directiveRegistry,n=null;if(t)for(let o=0;o<t.length;o++){let i=t[o];Mre(e,i.selectors,!1)&&(n??=[],La(i)?n.unshift(i):n.push(i))}return n}function ene(r,e,t,n,o,i){let s=Ls(r,e);tne(e[Ar],s,i,r.value,t,n,o)}function tne(r,e,t,n,o,i,s){if(i==null)r.removeAttribute(e,o,t);else{let a=s==null?Rd(i):s(i,n||"",o);r.setAttribute(e,o,a,t)}}function rne(r,e,t,n,o,i){let s=i[e];if(s!==null)for(let a=0;a<s.length;a+=2){let c=s[a],l=s[a+1];a7(n,t,c,l)}}function nne(r,e){let t=r[Nd];if(!t)return;t.get(Io,null)?.(e)}function F7(r,e,t,n,o){let i=r.inputs?.[n],s=r.hostDirectiveInputs?.[n],a=!1;if(s)for(let c=0;c<s.length;c+=2){let l=s[c],u=s[c+1],d=e.data[l];a7(d,t[l],u,o),a=!0}if(i)for(let c of i){let l=t[c],u=e.data[c];a7(u,l,n,o),a=!0}return a}function one(r,e){let t=es(e,r),n=t[ot];ine(n,t);let o=t[Ns];o!==null&&t[Q1]===null&&(t[Q1]=iL(o,t[Nd])),Wt(18),B7(n,t,t[eo]),Wt(19,t[eo])}function ine(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])}function B7(r,e,t){kb(e);try{let n=r.viewQuery;n!==null&&s7(1,n,t);let o=r.template;o!==null&&bL(r,e,o,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),e[Na]?.finishViewCreation(r),r.staticContentQueries&&sL(r,e),r.staticViewQueries&&s7(2,r.viewQuery,t);let i=r.components;i!==null&&sne(e,i)}catch(n){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),n}finally{e[et]&=-5,Rb()}}function sne(r,e){for(let t=0;t<e.length;t++)one(r,e[t])}function ane(r,e,t,n){let o=st(null);try{let i=e.tView,a=r[et]&4096?4096:16,c=N7(r,i,t,a,null,e,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null),l=r[e.index];c[ql]=l;let u=r[Na];return u!==null&&(c[Na]=u.createEmbeddedView(i)),B7(i,c,t),c}finally{st(o)}}function dO(r,e){return!e||e.firstChild===null||QO(r)}var fO=!1,cne=new Ce(""),lne;function U7(r,e){return lne(r,e)}var Ba=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(Ba||{});function V7(r){return(r.flags&32)===32}function Lh(r,e,t,n,o){if(n!=null){let i,s=!1;Os(n)?i=n:Oa(n)&&(s=!0,n=n[Ns]);let a=Ji(n);r===0&&t!==null?o==null?mL(e,t,a):Zb(e,t,a,o||null,!0):r===1&&t!==null?Zb(e,t,a,o||null,!0):r===2?Ure(e,a,s):r===3&&e.destroyNode(a),i!=null&&Ene(e,r,i,t,o)}}function une(r,e){_L(r,e),e[Ns]=null,e[Qi]=null}function dne(r,e,t,n,o,i){n[Ns]=o,n[Qi]=e,f3(r,n,t,1,o,i)}function _L(r,e){e[Ra].changeDetectionScheduler?.notify(9),f3(r,e,e[Ar],2,null,null)}function fne(r){let e=r[Rh];if(!e)return KC(r[ot],r);for(;e;){let t=null;if(Oa(e))t=e[Rh];else{let n=e[Co];n&&(t=n)}if(!t){for(;e&&!e[Xi]&&e!==r;)Oa(e)&&KC(e[ot],e),e=e[gn];e===null&&(e=r),Oa(e)&&KC(e[ot],e),t=e&&e[Xi]}e=t}}function j7(r,e){let t=r[Fd],n=t.indexOf(e);t.splice(n,1)}function CL(r,e){if(Bd(e))return;let t=e[Ar];t.destroyNode&&f3(r,e,t,3,null,null),fne(e)}function KC(r,e){if(Bd(e))return;let t=st(null);try{e[et]&=-129,e[et]|=256,e[Ei]&&Tw(e[Ei]),hne(r,e),pne(r,e),e[ot].type===1&&e[Ar].destroy();let n=e[ql];if(n!==null&&Os(e[gn])){n!==e[gn]&&j7(n,e);let o=e[Na];o!==null&&o.detachView(r)}o7(e)}finally{st(t)}}function pne(r,e){let t=r.cleanup,n=e[kh];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let a=t[s+3];a>=0?n[a]():n[-a].unsubscribe(),s+=2}else{let a=n[t[s+1]];t[s].call(a)}n!==null&&(e[kh]=null);let o=e[Oc];if(o!==null){e[Oc]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=e[J1];if(i!==null){e[J1]=null;for(let s of i)s.destroy()}}function hne(r,e){let t;if(r!=null&&(t=r.destroyHooks)!=null)for(let n=0;n<t.length;n+=2){let o=e[t[n]];if(!(o instanceof jd)){let i=t[n+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],c=i[s+1];Wt(4,a,c);try{c.call(a)}finally{Wt(5,a,c)}}else{Wt(4,o,i);try{i.call(o)}finally{Wt(5,o,i)}}}}}function mne(r,e,t){return gne(r,e.parent,t)}function gne(r,e,t){let n=e;for(;n!==null&&n.type&168;)e=n,n=e.parent;if(n===null)return t[Ns];if(Wl(n)){let{encapsulation:o}=r.data[n.directiveStart+n.componentOffset];if(o===jc.None||o===jc.Emulated)return null}return Ls(n,t)}function yne(r,e,t){return wne(r,e,t)}function vne(r,e,t){return r.type&40?Ls(r,t):null}var wne=vne,pO;function H7(r,e,t,n){let o=mne(r,n,e),i=e[Ar],s=n.parent||e[Qi],a=yne(s,n,e);if(o!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)uO(i,o,t[c],a,!1);else uO(i,o,t,a,!1);pO!==void 0&&pO(i,n,e,t,o)}function c0(r,e){if(e!==null){let t=e.type;if(t&3)return Ls(e,r);if(t&4)return c7(-1,r[e.index]);if(t&8){let n=e.child;if(n!==null)return c0(r,n);{let o=r[e.index];return Os(o)?c7(-1,o):Ji(o)}}else{if(t&128)return c0(r,e.next);if(t&32)return U7(e,r)()||Ji(r[e.index]);{let n=IL(r,e);if(n!==null){if(Array.isArray(n))return n[0];let o=jl(r[Zi]);return c0(o,n)}else return c0(r,e.next)}}}return null}function IL(r,e){if(e!==null){let n=r[Zi][Qi],o=e.projection;return n.projection[o]}return null}function c7(r,e){let t=Co+r+1;if(t<e.length){let n=e[t],o=n[ot].firstChild;if(o!==null)return c0(n,o)}return e[Kl]}function $7(r,e,t,n,o,i,s){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=n[t.index],c=t.type;if(s&&e===0&&(a&&g0(Ji(a),n),t.flags|=2),!V7(t))if(c&8)$7(r,e,t.child,n,o,i,!1),Lh(e,r,o,a,i);else if(c&32){let l=U7(t,n),u;for(;u=l();)Lh(e,r,o,u,i);Lh(e,r,o,a,i)}else c&16?bne(r,e,n,t,o,i):Lh(e,r,o,a,i);t=s?t.projectionNext:t.next}}function f3(r,e,t,n,o,i){$7(t,n,r.firstChild,e,o,i,!1)}function bne(r,e,t,n,o,i){let s=t[Zi],c=s[Qi].projection[n.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let u=c[l];Lh(e,r,o,u,i)}else{let l=c,u=s[gn];QO(n)&&(l.flags|=128),$7(r,e,l,u,o,i,!0)}}function Ene(r,e,t,n,o){let i=t[Kl],s=Ji(t);i!==s&&Lh(e,r,n,i,o);for(let a=Co;a<t.length;a++){let c=t[a];f3(c[ot],c,r,e,n,i)}}function xne(r,e,t,n,o){if(e)o?r.addClass(t,n):r.removeClass(t,n);else{let i=n.indexOf("-")===-1?void 0:Ba.DashCase;o==null?r.removeStyle(t,n,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=Ba.Important),r.setStyle(t,n,o,i))}}function f0(r,e,t,n,o=!1){for(;t!==null;){if(t.type===128){t=o?t.projectionNext:t.next;continue}let i=e[t.index];i!==null&&n.push(Ji(i)),Os(i)&&AL(i,n);let s=t.type;if(s&8)f0(r,e,t.child,n);else if(s&32){let a=U7(t,e),c;for(;c=a();)n.push(c)}else if(s&16){let a=IL(e,t);if(Array.isArray(a))n.push(...a);else{let c=jl(e[Zi]);f0(c[ot],c,a,n,!0)}}t=o?t.projectionNext:t.next}return n}function AL(r,e){for(let t=Co;t<r.length;t++){let n=r[t],o=n[ot].firstChild;o!==null&&f0(n[ot],n,o,e)}r[Kl]!==r[Ns]&&e.push(r[Kl])}function DL(r){if(r[xb]!==null){for(let e of r[xb])e.impl.addSequence(e);r[xb].length=0}}var TL=[];function Sne(r){return r[Ei]??_ne(r)}function _ne(r){let e=TL.pop()??Object.create(Ine);return e.lView=r,e}function Cne(r){r.lView[Ei]!==r&&(r.lView=null,TL.push(r))}var Ine=I(v({},Ed),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{n0(r.lView)},consumerOnSignalRead(){this.lView[Ei]=this}});function Ane(r){let e=r[Ei]??Object.create(Dne);return e.lView=r,e}var Dne=I(v({},Ed),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:r=>{let e=jl(r.lView);for(;e&&!PL(e[ot]);)e=jl(e);e&&_C(e)},consumerOnSignalRead(){this.lView[Ei]=this}});function PL(r){return r.type!==2}function ML(r){if(r[J1]===null)return;let e=!0;for(;e;){let t=!1;for(let n of r[J1])n.dirty&&(t=!0,n.zone===null||Zone.current===n.zone?n.run():n.zone.run(()=>n.run()));e=t&&!!(r[et]&8192)}}var Tne=100;function z7(r,e=0){let n=r[Ra].rendererFactory,o=!1;o||n.begin?.();try{Pne(r,e)}finally{o||n.end?.()}}function Pne(r,e){let t=kC();try{RC(!0),l7(r,e);let n=0;for(;r0(r);){if(n===Tne)throw new be(103,!1);n++,l7(r,1)}}finally{RC(t)}}function kL(r,e){MC(e?o0.Exhaustive:o0.OnlyDirtyViews);try{z7(r)}finally{MC(o0.Off)}}function Mne(r,e,t,n){if(Bd(e))return;let o=e[et],i=!1,s=!1;kb(e);let a=!0,c=null,l=null;i||(PL(r)?(l=Sne(e),c=xd(l)):Aw()===null?(a=!1,l=Ane(e),c=xd(l)):e[Ei]&&(Tw(e[Ei]),e[Ei]=null));try{SC(e),$N(r.bindingStartIndex),t!==null&&bL(r,e,t,2,n);let u=(o&3)===3;if(!i)if(u){let p=r.preOrderCheckHooks;p!==null&&jb(e,p,null)}else{let p=r.preOrderHooks;p!==null&&Hb(e,p,0,null),zC(e,0)}if(s||kne(e),ML(e),RL(e,0),r.contentQueries!==null&&sL(r,e),!i)if(u){let p=r.contentCheckHooks;p!==null&&jb(e,p)}else{let p=r.contentHooks;p!==null&&Hb(e,p,1),zC(e,1)}Nne(r,e);let d=r.components;d!==null&&OL(e,d,0);let h=r.viewQuery;if(h!==null&&s7(2,h,n),!i)if(u){let p=r.viewCheckHooks;p!==null&&jb(e,p)}else{let p=r.viewHooks;p!==null&&Hb(e,p,2),zC(e,2)}if(r.firstUpdatePass===!0&&(r.firstUpdatePass=!1),e[Eb]){for(let p of e[Eb])p();e[Eb]=null}i||(DL(e),e[et]&=-73)}catch(u){throw i||n0(e),u}finally{l!==null&&(wh(l,c),a&&Cne(l)),Rb()}}function RL(r,e){for(let t=JO(r);t!==null;t=eL(t))for(let n=Co;n<t.length;n++){let o=t[n];NL(o,e)}}function kne(r){for(let e=JO(r);e!==null;e=eL(e)){if(!(e[et]&2))continue;let t=e[Fd];for(let n=0;n<t.length;n++){let o=t[n];_C(o)}}}function Rne(r,e,t){Wt(18);let n=es(e,r);NL(n,t),Wt(19,n[eo])}function NL(r,e){Ib(r)&&l7(r,e)}function l7(r,e){let n=r[ot],o=r[et],i=r[Ei],s=!!(e===0&&o&16);if(s||=!!(o&64&&e===0),s||=!!(o&1024),s||=!!(i?.dirty&&U1(i)),s||=!1,i&&(i.dirty=!1),r[et]&=-9217,s)Mne(n,r,n.template,r[eo]);else if(o&8192){let a=st(null);try{ML(r),RL(r,1);let c=n.components;c!==null&&OL(r,c,1),DL(r)}finally{st(a)}}}function OL(r,e,t){for(let n=0;n<e.length;n++)Rne(r,e[n],t)}function Nne(r,e){let t=r.hostBindingOpCodes;if(t!==null)try{for(let n=0;n<t.length;n++){let o=t[n];if(o<0)Gl(~o);else{let i=o,s=t[++n],a=t[++n];qN(s,i);let c=e[i];Wt(24,c),a(2,c),Wt(25,c)}}}finally{Gl(-1)}}function q7(r,e){let t=kC()?64:1088;for(r[Ra].changeDetectionScheduler?.notify(e);r;){r[et]|=t;let n=jl(r);if(Nh(r)&&!n)return r;r=n}return null}function LL(r,e,t,n){return[r,!0,0,e,null,n,null,t,null,null]}function One(r,e,t,n=!0){let o=e[ot];if(Lne(o,e,r,t),n){let s=c7(t,r),a=e[Ar],c=a.parentNode(r[Kl]);c!==null&&dne(o,r[Qi],a,e,c,s)}let i=e[Q1];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function u7(r,e){if(r.length<=Co)return;let t=Co+e,n=r[t];if(n){let o=n[ql];o!==null&&o!==r&&j7(o,n),e>0&&(r[t-1][Xi]=n[Xi]);let i=G1(r,Co+e);une(n[ot],n);let s=i[Na];s!==null&&s.detachView(i[ot]),n[gn]=null,n[Xi]=null,n[et]&=-129}return n}function Lne(r,e,t,n){let o=Co+n,i=t.length;n>0&&(t[o-1][Xi]=e),n<i-Co?(e[Xi]=t[o],uC(t,Co+n,e)):(t.push(e),e[Xi]=null),e[gn]=t;let s=e[ql];s!==null&&t!==s&&FL(s,e);let a=e[Na];a!==null&&a.insertView(r),Ab(e),e[et]|=128}function FL(r,e){let t=r[Fd],n=e[gn];if(Oa(n))r[et]|=2;else{let o=n[gn][Zi];e[Zi]!==o&&(r[et]|=2)}t===null?r[Fd]=[e]:t.push(e)}var Ql=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[ot];return f0(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[eo]}set context(e){this._lView[eo]=e}get destroyed(){return Bd(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[gn];if(Os(e)){let t=e[e0],n=t?t.indexOf(this):-1;n>-1&&(u7(e,n),G1(t,n))}this._attachedToViewContainer=!1}CL(this._lView[ot],this._lView)}onDestroy(e){CC(this._lView,e)}markForCheck(){q7(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[et]&=-129}reattach(){Ab(this._lView),this._lView[et]|=128}detectChanges(){this._lView[et]|=1024,z7(this._lView)}checkNoChanges(){return;try{this.exhaustive??=this._lView[Nd].get(cne,fO)}catch{this.exhaustive=fO}}attachToViewContainerRef(){if(this._appRef)throw new be(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=Nh(this._lView),t=this._lView[ql];t!==null&&!e&&j7(t,this._lView),_L(this._lView[ot],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new be(902,!1);this._appRef=e;let t=Nh(this._lView),n=this._lView[ql];n!==null&&!t&&FL(n,this._lView),Ab(this._lView)}};var Zl=(()=>{class r{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=Fne;constructor(t,n,o){this._declarationLView=t,this._declarationTContainer=n,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,o){let i=ane(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:o});return new Ql(i)}}return r})();function Fne(){return K7(to(),St())}function K7(r,e){return r.type&4?new Zl(e,r,jh(r,e)):null}function W7(r,e,t,n,o){let i=r.data[e];if(i===null)i=Bne(r,e,t,n,o),zN()&&(i.flags|=32);else if(i.type&64){i.type=t,i.value=n,i.attrs=o;let s=UN();i.injectorIndex=s===null?-1:s.injectorIndex}return Oh(i,!0),i}function Bne(r,e,t,n,o){let i=TC(),s=PC(),a=s?i:i&&i.parent,c=r.data[e]=Vne(r,a,t,e,n,o);return Une(r,c,i,s),c}function Une(r,e,t,n){r.firstChild===null&&(r.firstChild=e),t!==null&&(n?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function Vne(r,e,t,n,o,i){let s=e?e.injectorIndex:-1,a=0;return LN()&&(a|=128),{type:t,index:n,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var m_e=new RegExp(`^(\\d+)*(${wre}|${vre})*(.*)`);var jne=()=>null;function hO(r,e){return jne(r,e)}var BL=class{},p3=class{},d7=class{resolveComponentFactory(e){throw new be(917,!1)}},v0=class{static NULL=new d7},Hd=class{},rs=(()=>{class r{destroyNode=null;static __NG_ELEMENT_ID__=()=>Hne()}return r})();function Hne(){let r=St(),e=to(),t=es(e.index,r);return(Oa(t)?t:r)[Ar]}var UL=(()=>{class r{static \u0275prov=me({token:r,providedIn:"root",factory:()=>null})}return r})();var zb={},f7=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,n){let o=this.injector.get(e,zb,n);return o!==zb||t===zb?o:this.parentInjector.get(e,t,n)}};function mO(r,e,t){let n=t?r.styles:null,o=t?r.classes:null,i=0;if(e!==null)for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")i=a;else if(i==1)o=mb(o,a);else if(i==2){let c=a,l=e[++s];n=mb(n,c+": "+l+";")}}t?r.styles=n:r.stylesWithoutHost=n,t?r.classes=o:r.classesWithoutHost=o}function ye(r,e=0){let t=St();if(t===null)return Ee(r,e);let n=to();return GO(n,t,Tn(r),e)}function VL(r,e,t,n,o){let i=n===null?null:{"":-1},s=o(r,t);if(s!==null){let a=s,c=null,l=null;for(let u of s)if(u.resolveHostDirectives!==null){[a,c,l]=u.resolveHostDirectives(s);break}qne(r,e,t,a,i,c,l)}i!==null&&n!==null&&$ne(t,n,i)}function $ne(r,e,t){let n=r.localNames=[];for(let o=0;o<e.length;o+=2){let i=t[e[o+1]];if(i==null)throw new be(-301,!1);n.push(e[o],i)}}function zne(r,e,t){e.componentOffset=t,(r.components??=[]).push(e.index)}function qne(r,e,t,n,o,i,s){let a=n.length,c=!1;for(let h=0;h<a;h++){let p=n[h];!c&&La(p)&&(c=!0,zne(r,t,h)),r7(Yb(t,e),r,p.type)}Qne(t,r.data.length,a);for(let h=0;h<a;h++){let p=n[h];p.providersResolver&&p.providersResolver(p)}let l=!1,u=!1,d=vL(r,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let h=0;h<a;h++){let p=n[h];if(t.mergedAttrs=u0(t.mergedAttrs,p.hostAttrs),Wne(r,t,e,d,p),Xne(d,p,o),s!==null&&s.has(p)){let[y,b]=s.get(p);t.directiveToIndex.set(p.type,[d,y+t.directiveStart,b+t.directiveStart])}else(i===null||!i.has(p))&&t.directiveToIndex.set(p.type,d);p.contentQueries!==null&&(t.flags|=4),(p.hostBindings!==null||p.hostAttrs!==null||p.hostVars!==0)&&(t.flags|=64);let m=p.type.prototype;!l&&(m.ngOnChanges||m.ngOnInit||m.ngDoCheck)&&((r.preOrderHooks??=[]).push(t.index),l=!0),!u&&(m.ngOnChanges||m.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(t.index),u=!0),d++}Kne(r,t,i)}function Kne(r,e,t){for(let n=e.directiveStart;n<e.directiveEnd;n++){let o=r.data[n];if(t===null||!t.has(o))gO(0,e,o,n),gO(1,e,o,n),vO(e,n,!1);else{let i=t.get(o);yO(0,e,i,n),yO(1,e,i,n),vO(e,n,!0)}}}function gO(r,e,t,n){let o=r===0?t.inputs:t.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s;r===0?s=e.inputs??={}:s=e.outputs??={},s[i]??=[],s[i].push(n),jL(e,i)}}function yO(r,e,t,n){let o=r===0?t.inputs:t.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s=o[i],a;r===0?a=e.hostDirectiveInputs??={}:a=e.hostDirectiveOutputs??={},a[s]??=[],a[s].push(n,i),jL(e,s)}}function jL(r,e){e==="class"?r.flags|=8:e==="style"&&(r.flags|=16)}function vO(r,e,t){let{attrs:n,inputs:o,hostDirectiveInputs:i}=r;if(n===null||!t&&o===null||t&&i===null||k7(r)){r.initialInputs??=[],r.initialInputs.push(null);return}let s=null,a=0;for(;a<n.length;){let c=n[a];if(c===0){a+=4;continue}else if(c===5){a+=2;continue}else if(typeof c=="number")break;if(!t&&o.hasOwnProperty(c)){let l=o[c];for(let u of l)if(u===e){s??=[],s.push(c,n[a+1]);break}}else if(t&&i.hasOwnProperty(c)){let l=i[c];for(let u=0;u<l.length;u+=2)if(l[u]===e){s??=[],s.push(l[u+1],n[a+1]);break}}a+=2}r.initialInputs??=[],r.initialInputs.push(s)}function Wne(r,e,t,n,o){r.data[n]=o;let i=o.factory||(o.factory=Vl(o.type,!0)),s=new jd(i,La(o),ye);r.blueprint[n]=s,t[n]=s,Gne(r,e,n,vL(r,t,o.hostVars,zo),o)}function Gne(r,e,t,n,o){let i=o.hostBindings;if(i){let s=r.hostBindingOpCodes;s===null&&(s=r.hostBindingOpCodes=[]);let a=~e.index;Yne(s)!=a&&s.push(a),s.push(t,n,i)}}function Yne(r){let e=r.length;for(;e>0;){let t=r[--e];if(typeof t=="number"&&t<0)return t}return 0}function Xne(r,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=r;La(e)&&(t[""]=r)}}function Qne(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function HL(r,e,t,n,o,i,s,a){let c=e.consts,l=t0(c,s),u=W7(e,r,2,n,l);return i&&VL(e,t,u,t0(c,a),o),u.mergedAttrs=u0(u.mergedAttrs,u.attrs),u.attrs!==null&&mO(u,u.attrs,!1),u.mergedAttrs!==null&&mO(u,u.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,u),u}function $L(r,e){UO(r,e),bC(e)&&r.queries.elementEnd(e)}function G7(r){return qL(r)?Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r:!1}function zL(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{let t=r[Symbol.iterator](),n;for(;!(n=t.next()).done;)e(n.value)}}function qL(r){return r!==null&&(typeof r=="function"||typeof r=="object")}function Y7(r,e,t){return r[e]=t}function Zne(r,e){return r[e]}function Hc(r,e,t){if(t===zo)return!1;let n=r[e];return Object.is(n,t)?!1:(r[e]=t,!0)}function KL(r,e,t,n){let o=Hc(r,e,t);return Hc(r,e+1,n)||o}function WC(r,e,t){return function n(o){let i=Wl(r)?es(r.index,e):e;q7(i,5);let s=e[eo],a=wO(e,s,t,o),c=n.__ngNextListenerFn__;for(;c;)a=wO(e,s,c,o)&&a,c=c.__ngNextListenerFn__;return a}}function wO(r,e,t,n){let o=st(null);try{return Wt(6,e,t),t(n)!==!1}catch(i){return nne(r,i),!1}finally{Wt(7,e,t),st(o)}}function Jne(r,e,t,n,o,i,s,a){let c=Sb(r),l=!1,u=null;if(!n&&c&&(u=eoe(e,t,i,r.index)),u!==null){let d=u.__ngLastListenerFn__||u;d.__ngNextListenerFn__=s,u.__ngLastListenerFn__=s,l=!0}else{let d=Ls(r,t),h=n?n(d):d;Ere(t,h,i,a);let p=o.listen(h,i,a),m=n?y=>n(Ji(y[r.index])):r.index;WL(m,e,t,i,a,p,!1)}return l}function eoe(r,e,t,n){let o=r.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===t&&o[i+1]===n){let a=e[kh],c=o[i+2];return a&&a.length>c?a[c]:null}typeof s=="string"&&(i+=2)}return null}function WL(r,e,t,n,o,i,s){let a=e.firstCreatePass?AC(e):null,c=IC(t),l=c.length;c.push(o,i),a&&a.push(n,r,l,(l+1)*(s?-1:1))}function bO(r,e,t,n,o,i){let s=e[t],a=e[ot],l=a.data[t].outputs[n],d=s[l].subscribe(i);WL(r.index,a,e,o,i,d,!0)}var p7=Symbol("BINDING");var Jb=class extends v0{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=zl(e);return new Bh(t,this.ngModule)}};function toe(r){return Object.keys(r).map(e=>{let[t,n,o]=r[e],i={propName:t,templateName:e,isSignal:(n&d3.SignalBased)!==0};return o&&(i.transform=o),i})}function roe(r){return Object.keys(r).map(e=>({propName:r[e],templateName:e}))}function noe(r,e,t){let n=e instanceof zr?e:e?.injector;return n&&r.getStandaloneInjector!==null&&(n=r.getStandaloneInjector(n)||n),n?new f7(t,n):t}function ooe(r){let e=r.get(Hd,null);if(e===null)throw new be(407,!1);let t=r.get(UL,null),n=r.get(Hl,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:n,ngReflect:!1}}function ioe(r,e){let t=(r.selectors[0][0]||"div").toLowerCase();return hL(e,t,t==="svg"?IN:t==="math"?AN:null)}var Bh=class extends p3{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=toe(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=roe(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=Ore(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,n,o,i,s){Wt(22);let a=st(null);try{let c=this.componentDef,l=soe(n,c,s,i),u=noe(c,o||this.ngModule,e),d=ooe(u),h=d.rendererFactory.createRenderer(null,c),p=n?qre(h,n,c.encapsulation,u):ioe(c,h),m=s?.some(EO)||i?.some(x=>typeof x!="function"&&x.bindings.some(EO)),y=N7(null,l,null,512|yL(c),null,null,d,h,u,null,iL(p,u,!0));y[_o]=p,kb(y);let b=null;try{let x=HL(_o,l,y,"#host",()=>l.directiveRegistry,!0,0);p&&(gL(h,p,x),g0(p,y)),L7(l,y,x),aL(l,x,y),$L(l,x),t!==void 0&&coe(x,this.ngContentSelectors,t),b=es(x.index,y),y[eo]=b[eo],B7(l,y,null)}catch(x){throw b!==null&&o7(b),o7(y),x}finally{Wt(23),Rb()}return new e3(this.componentType,y,!!m)}finally{st(a)}}};function soe(r,e,t,n){let o=r?["ng-version","20.0.6"]:Lre(e.selectors[0]),i=null,s=null,a=0;if(t)for(let u of t)a+=u[p7].requiredVars,u.create&&(u.targetIdx=0,(i??=[]).push(u)),u.update&&(u.targetIdx=0,(s??=[]).push(u));if(n)for(let u=0;u<n.length;u++){let d=n[u];if(typeof d!="function")for(let h of d.bindings){a+=h[p7].requiredVars;let p=u+1;h.create&&(h.targetIdx=p,(i??=[]).push(h)),h.update&&(h.targetIdx=p,(s??=[]).push(h))}}let c=[e];if(n)for(let u of n){let d=typeof u=="function"?u:u.type,h=hC(d);c.push(h)}return R7(0,null,aoe(i,s),1,a,c,null,null,null,[o],null)}function aoe(r,e){return!r&&!e?null:t=>{if(t&1&&r)for(let n of r)n.create();if(t&2&&e)for(let n of e)n.update()}}function EO(r){let e=r[p7].kind;return e==="input"||e==="twoWay"}var e3=class extends BL{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,n){super(),this._rootLView=t,this._hasInputBindings=n,this._tNode=_b(t[ot],_o),this.location=jh(this._tNode,t),this.instance=es(this._tNode.index,t)[eo],this.hostView=this.changeDetectorRef=new Ql(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let n=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let o=this._rootLView,i=F7(n,o[ot],o,e,t);this.previousInputValues.set(e,t);let s=es(n.index,o);q7(s,1)}get injector(){return new Vd(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function coe(r,e,t){let n=r.projection=[];for(let o=0;o<e.length;o++){let i=t[o];n.push(i!=null&&i.length?Array.from(i):null)}}var $c=(()=>{class r{static __NG_ELEMENT_ID__=loe}return r})();function loe(){let r=to();return YL(r,St())}var uoe=$c,GL=class extends uoe{_lContainer;_hostTNode;_hostLView;constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return jh(this._hostTNode,this._hostLView)}get injector(){return new Vd(this._hostTNode,this._hostLView)}get parentInjector(){let e=A7(this._hostTNode,this._hostLView);if(HO(e)){let t=Wb(e,this._hostLView),n=Kb(e),o=t[ot].data[n+8];return new Vd(o,t)}else return new Vd(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=xO(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Co}createEmbeddedView(e,t,n){let o,i;typeof n=="number"?o=n:n!=null&&(o=n.index,i=n.injector);let s=hO(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},i,s);return this.insertImpl(a,o,dO(this._hostTNode,s)),a}createComponent(e,t,n,o,i,s,a){let c=e&&!Kte(e),l;if(c)l=t;else{let b=t||{};l=b.index,n=b.injector,o=b.projectableNodes,i=b.environmentInjector||b.ngModuleRef,s=b.directives,a=b.bindings}let u=c?e:new Bh(zl(e)),d=n||this.parentInjector;if(!i&&u.ngModule==null){let x=(c?d:this.parentInjector).get(zr,null);x&&(i=x)}let h=zl(u.componentType??{}),p=hO(this._lContainer,h?.id??null),m=p?.firstChild??null,y=u.create(d,o,m,i,s,a);return this.insertImpl(y.hostView,l,dO(this._hostTNode,p)),y}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,n){let o=e._lView;if(TN(o)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=o[gn],l=new GL(c,c[Qi],c[gn]);l.detach(l.indexOf(e))}}let i=this._adjustIndex(t),s=this._lContainer;return One(s,o,i,n),e.attachToViewContainerRef(),uC(GC(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=xO(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),n=u7(this._lContainer,t);n&&(G1(GC(this._lContainer),t),CL(n[ot],n))}detach(e){let t=this._adjustIndex(e,-1),n=u7(this._lContainer,t);return n&&G1(GC(this._lContainer),t)!=null?new Ql(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function xO(r){return r[e0]}function GC(r){return r[e0]||(r[e0]=[])}function YL(r,e){let t,n=e[r.index];return Os(n)?t=n:(t=LL(n,e,null,r),e[r.index]=t,O7(e,t)),foe(t,e,r,n),new GL(t,r,e)}function doe(r,e){let t=r[Ar],n=t.createComment(""),o=Ls(e,r),i=t.parentNode(o);return Zb(t,i,n,t.nextSibling(o),!1),n}var foe=moe,poe=()=>!1;function hoe(r,e,t){return poe(r,e,t)}function moe(r,e,t,n){if(r[Kl])return;let o;t.type&8?o=Ji(n):o=doe(e,t),r[Kl]=o}var h7=class r{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new r(this.queryList)}setDirty(){this.queryList.setDirty()}},m7=class r{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let n=e.contentQueries!==null?e.contentQueries[0]:t.length,o=[];for(let i=0;i<n;i++){let s=t.getByIndex(i),a=this.queries[s.indexInDeclarationView];o.push(a.clone())}return new r(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)X7(e,t).matches!==null&&this.queries[t].setDirty()}},g7=class{flags;read;predicate;constructor(e,t,n=null){this.flags=t,this.read=n,typeof e=="string"?this.predicate=Soe(e):this.predicate=e}},y7=class r{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){let o=t!==null?t.length:0,i=this.getByIndex(n).embeddedTView(e,o);i&&(i.indexInDeclarationView=n,t!==null?t.push(i):t=[i])}return t!==null?new r(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},v7=class r{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new r(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,n=e.parent;for(;n!==null&&n.type&8&&n.index!==t;)n=n.parent;return t===(n!==null?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let n=this.metadata.predicate;if(Array.isArray(n))for(let o=0;o<n.length;o++){let i=n[o];this.matchTNodeWithReadOption(e,t,goe(t,i)),this.matchTNodeWithReadOption(e,t,$b(t,e,i,!1,!1))}else n===Zl?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,$b(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(n!==null){let o=this.metadata.read;if(o!==null)if(o===ro||o===$c||o===Zl&&t.type&4)this.addMatch(t.index,-2);else{let i=$b(t,e,o,!1,!1);i!==null&&this.addMatch(t.index,i)}else this.addMatch(t.index,n)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function goe(r,e){let t=r.localNames;if(t!==null){for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1]}return null}function yoe(r,e){return r.type&11?jh(r,e):r.type&4?K7(r,e):null}function voe(r,e,t,n){return t===-1?yoe(e,r):t===-2?woe(r,e,n):d0(r,r[ot],t,e)}function woe(r,e,t){if(t===ro)return jh(e,r);if(t===Zl)return K7(e,r);if(t===$c)return YL(e,r)}function XL(r,e,t,n){let o=e[Na].queries[n];if(o.matches===null){let i=r.data,s=t.matches,a=[];for(let c=0;s!==null&&c<s.length;c+=2){let l=s[c];if(l<0)a.push(null);else{let u=i[l];a.push(voe(e,u,s[c+1],t.metadata.read))}}o.matches=a}return o.matches}function w7(r,e,t,n){let o=r.queries.getByIndex(t),i=o.matches;if(i!==null){let s=XL(r,e,o,t);for(let a=0;a<i.length;a+=2){let c=i[a];if(c>0)n.push(s[a/2]);else{let l=i[a+1],u=e[-c];for(let d=Co;d<u.length;d++){let h=u[d];h[ql]===h[gn]&&w7(h[ot],h,l,n)}if(u[Fd]!==null){let d=u[Fd];for(let h=0;h<d.length;h++){let p=d[h];w7(p[ot],p,l,n)}}}}}return n}function boe(r,e){return r[Na].queries[e].queryList}function Eoe(r,e,t){let n=new Xb((t&4)===4);return kN(r,e,n,n.destroy),(e[Na]??=new m7).queries.push(new h7(n))-1}function xoe(r,e,t,n){let o=yn();if(o.firstCreatePass){let i=to();_oe(o,new g7(e,t,n),i.index),Coe(o,r),(t&2)===2&&(o.staticContentQueries=!0)}return Eoe(o,St(),t)}function Soe(r){return r.split(",").map(e=>e.trim())}function _oe(r,e,t){r.queries===null&&(r.queries=new y7),r.queries.track(new v7(e,t))}function Coe(r,e){let t=r.contentQueries||(r.contentQueries=[]),n=t.length?t[t.length-1]:-1;e!==n&&t.push(r.queries.length-1,e)}function X7(r,e){return r.queries.getByIndex(e)}function Ioe(r,e){let t=r[ot],n=X7(t,e);return n.crossesNgTemplate?w7(t,r,e,[]):XL(t,r,n,e)}var SO=new Set;function h3(r){SO.has(r)||(SO.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}var $d=class{},m3=class{};var t3=class extends $d{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Jb(this);constructor(e,t,n,o=!0){super(),this.ngModuleType=e,this._parent=t;let i=pC(e);this._bootstrapComponents=fL(i.bootstrap),this._r3Injector=FC(e,t,[{provide:$d,useValue:this},{provide:v0,useValue:this.componentFactoryResolver},...n],Ho(e),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},r3=class extends m3{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new t3(this.moduleType,e,[])}};var p0=class extends $d{injector;componentFactoryResolver=new Jb(this);instance=null;constructor(e){super();let t=new Md([...e.providers,{provide:$d,useValue:this},{provide:v0,useValue:this.componentFactoryResolver}],e.parent||X1(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function w0(r,e,t=null){return new p0({providers:r,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var Aoe=(()=>{class r{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let n=mC(!1,t.type),o=n.length>0?w0([n],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,o)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=me({token:r,providedIn:"environment",factory:()=>new r(Ee(zr))})}return r})();function mr(r){return Vh(()=>{let e=QL(r),t=I(v({},e),{decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===D7.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&r.dependencies||null,getStandaloneInjector:e.standalone?o=>o.get(Aoe).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||jc.Emulated,styles:r.styles||xo,_:null,schemas:r.schemas||null,tView:null,id:""});e.standalone&&h3("NgStandalone"),ZL(t);let n=r.dependencies;return t.directiveDefs=_O(n,!1),t.pipeDefs=_O(n,!0),t.id=koe(t),t})}function Doe(r){return zl(r)||hC(r)}function Toe(r){return r!==null}function ns(r){return Vh(()=>({type:r.type,bootstrap:r.bootstrap||xo,declarations:r.declarations||xo,imports:r.imports||xo,exports:r.exports||xo,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function Poe(r,e){if(r==null)return $l;let t={};for(let n in r)if(r.hasOwnProperty(n)){let o=r[n],i,s,a,c;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i,c=o[3]||null):(i=o,s=o,a=d3.None,c=null),t[i]=[n,a,c],e[i]=s}return t}function Moe(r){if(r==null)return $l;let e={};for(let t in r)r.hasOwnProperty(t)&&(e[r[t]]=t);return e}function Qt(r){return Vh(()=>{let e=QL(r);return ZL(e),e})}function g3(r){return{type:r.type,name:r.name,factory:null,pure:r.pure!==!1,standalone:r.standalone??!0,onDestroy:r.type.prototype.ngOnDestroy||null}}function QL(r){let e={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:e,inputConfig:r.inputs||$l,exportAs:r.exportAs||null,standalone:r.standalone??!0,signals:r.signals===!0,selectors:r.selectors||xo,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:Poe(r.inputs,e),outputs:Moe(r.outputs),debugInfo:null}}function ZL(r){r.features?.forEach(e=>e(r))}function _O(r,e){if(!r)return null;let t=e?vN:Doe;return()=>(typeof r=="function"?r():r).map(n=>t(n)).filter(Toe)}function koe(r){let e=0,t=typeof r.consts=="function"?"":r.consts,n=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,t,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery];for(let i of n.join("|"))e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Roe(r){return Object.getPrototypeOf(r.prototype).constructor}function qo(r){let e=Roe(r.type),t=!0,n=[r];for(;e;){let o;if(La(r))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new be(903,!1);o=e.\u0275dir}if(o){if(t){n.push(o);let s=r;s.inputs=YC(r.inputs),s.declaredInputs=YC(r.declaredInputs),s.outputs=YC(r.outputs);let a=o.hostBindings;a&&Boe(r,a);let c=o.viewQuery,l=o.contentQueries;if(c&&Loe(r,c),l&&Foe(r,l),Noe(r,o),dN(r.outputs,o.outputs),La(o)&&o.data.animation){let u=r.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(r),a===qo&&(t=!1)}}e=Object.getPrototypeOf(e)}Ooe(n)}function Noe(r,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||r.inputs.hasOwnProperty(t))continue;let n=e.inputs[t];n!==void 0&&(r.inputs[t]=n,r.declaredInputs[t]=e.declaredInputs[t])}}function Ooe(r){let e=0,t=null;for(let n=r.length-1;n>=0;n--){let o=r[n];o.hostVars=e+=o.hostVars,o.hostAttrs=u0(o.hostAttrs,t=u0(t,o.hostAttrs))}}function YC(r){return r===$l?{}:r===xo?[]:r}function Loe(r,e){let t=r.viewQuery;t?r.viewQuery=(n,o)=>{e(n,o),t(n,o)}:r.viewQuery=e}function Foe(r,e){let t=r.contentQueries;t?r.contentQueries=(n,o,i)=>{e(n,o,i),t(n,o,i)}:r.contentQueries=e}function Boe(r,e){let t=r.hostBindings;t?r.hostBindings=(n,o)=>{e(n,o),t(n,o)}:r.hostBindings=e}function Uoe(r,e,t,n,o,i,s,a,c){let l=e.consts,u=W7(e,r,4,s||null,a||null);DC()&&VL(e,t,u,t0(l,c),SL),u.mergedAttrs=u0(u.mergedAttrs,u.attrs),UO(e,u);let d=u.tView=R7(2,u,n,o,i,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return e.queries!==null&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}function Voe(r,e,t,n,o,i,s,a,c,l,u){let d=t+_o,h=e.firstCreatePass?Uoe(d,e,r,n,o,i,s,a,l):e.data[d];c&&(h.flags|=c),Oh(h,!1);let p=joe(e,r,h,t);Ob()&&H7(e,r,p,h),g0(p,r);let m=LL(p,r,p,h);return r[d]=m,O7(r,m),hoe(m,h,r),Sb(h)&&L7(e,r,h),l!=null&&EL(r,h,u),h}function Ke(r,e,t,n,o,i,s,a){let c=St(),l=yn(),u=t0(l.consts,i);return Voe(c,l,r,e,t,n,o,u,void 0,s,a),Ke}var joe=Hoe;function Hoe(r,e,t,n){return Lb(!0),e[Ar].createComment("")}var Q7=function(r){return r[r.CHANGE_DETECTION=0]="CHANGE_DETECTION",r[r.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",r}(Q7||{}),b0=new Ce(""),JL=!1,b7=class extends Ht{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,_N()&&(this.destroyRef=oe(Yl,{optional:!0})??void 0,this.pendingTasks=oe(Vc,{optional:!0})??void 0)}emit(e){let t=st(null);try{super.next(e)}finally{st(t)}}subscribe(e,t,n){let o=e,i=t||(()=>null),s=n;if(e&&typeof e=="object"){let c=e;o=c.next?.bind(c),i=c.error?.bind(c),s=c.complete?.bind(c)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return e instanceof Cr&&e.add(a),a}wrapInTimeout(e){return t=>{let n=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{n!==void 0&&this.pendingTasks?.remove(n)}})}}},Bt=b7;function eF(r){let e,t;function n(){r=a0;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{r(),n()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{r(),n()})),()=>n()}function CO(r){return queueMicrotask(()=>r()),()=>{r=a0}}var Z7="isAngularZone",n3=Z7+"_ID",$oe=0,Kr=class r{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Bt(!1);onMicrotaskEmpty=new Bt(!1);onStable=new Bt(!1);onError=new Bt(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=JL}=e;if(typeof Zone>"u")throw new be(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&n,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,Koe(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(Z7)===!0}static assertInAngularZone(){if(!r.isInAngularZone())throw new be(909,!1)}static assertNotInAngularZone(){if(r.isInAngularZone())throw new be(909,!1)}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,e,zoe,a0,a0);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}},zoe={};function J7(r){if(r._nesting==0&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function qoe(r){if(r.isCheckStableRunning||r.callbackScheduled)return;r.callbackScheduled=!0;function e(){eF(()=>{r.callbackScheduled=!1,E7(r),r.isCheckStableRunning=!0,J7(r),r.isCheckStableRunning=!1})}r.scheduleInRootZone?Zone.root.run(()=>{e()}):r._outer.run(()=>{e()}),E7(r)}function Koe(r){let e=()=>{qoe(r)},t=$oe++;r._inner=r._inner.fork({name:"angular",properties:{[Z7]:!0,[n3]:t,[n3+t]:!0},onInvokeTask:(n,o,i,s,a,c)=>{if(Woe(c))return n.invokeTask(i,s,a,c);try{return IO(r),n.invokeTask(i,s,a,c)}finally{(r.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||r.shouldCoalesceRunChangeDetection)&&e(),AO(r)}},onInvoke:(n,o,i,s,a,c,l)=>{try{return IO(r),n.invoke(i,s,a,c,l)}finally{r.shouldCoalesceRunChangeDetection&&!r.callbackScheduled&&!Goe(c)&&e(),AO(r)}},onHasTask:(n,o,i,s)=>{n.hasTask(i,s),o===i&&(s.change=="microTask"?(r._hasPendingMicrotasks=s.microTask,E7(r),J7(r)):s.change=="macroTask"&&(r.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,o,i,s)=>(n.handleError(i,s),r.runOutsideAngular(()=>r.onError.emit(s)),!1)})}function E7(r){r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&r.callbackScheduled===!0?r.hasPendingMicrotasks=!0:r.hasPendingMicrotasks=!1}function IO(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function AO(r){r._nesting--,J7(r)}var o3=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Bt;onMicrotaskEmpty=new Bt;onStable=new Bt;onError=new Bt;run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,o){return e.apply(t,n)}};function Woe(r){return tF(r,"__ignore_ng_zone__")}function Goe(r){return tF(r,"__scheduler_tick__")}function tF(r,e){return!Array.isArray(r)||r.length!==1?!1:r[0]?.data?.[e]===!0}var rF=(()=>{class r{impl=null;execute(){this.impl?.execute()}static \u0275prov=me({token:r,providedIn:"root",factory:()=>new r})}return r})();var eI=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();var tI=new Ce("");function eu(r){return!!r&&typeof r.then=="function"}function rI(r){return!!r&&typeof r.subscribe=="function"}var nF=new Ce("");var nI=(()=>{class r{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,n)=>{this.resolve=t,this.reject=n});appInits=oe(nF,{optional:!0})??[];injector=oe(Yi);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let o of this.appInits){let i=So(this.injector,o);if(eu(i))t.push(i);else if(rI(i)){let s=new Promise((a,c)=>{i.subscribe({complete:a,error:c})});t.push(s)}}let n=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{n()}).catch(o=>{this.reject(o)}),t.length===0&&n(),this.initialized=!0}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),y3=new Ce("");function oF(){x_(()=>{let r="";throw new be(600,r)})}function iF(r){return r.isBoundToModule}var Yoe=10;var qd=(()=>{class r{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=oe(Io);afterRenderManager=oe(rF);zonelessEnabled=oe(s0);rootEffectScheduler=oe($C);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new Ht;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=oe(Vc);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Xe(t=>!t))}constructor(){oe(b0,{optional:!0})}whenStable(){let t;return new Promise(n=>{t=this.isStable.subscribe({next:o=>{o&&n()}})}).finally(()=>{t.unsubscribe()})}_injector=oe(zr);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,n){return this.bootstrapImpl(t,n)}bootstrapImpl(t,n,o=Yi.NULL){return this._injector.get(Kr).run(()=>{Wt(10);let s=t instanceof p3;if(!this._injector.get(nI).done){let m="";throw new be(405,m)}let c;s?c=t:c=this._injector.get(v0).resolveComponentFactory(t),this.componentTypes.push(c.componentType);let l=iF(c)?void 0:this._injector.get($d),u=n||c.selector,d=c.create(o,[],u,l),h=d.location.nativeElement,p=d.injector.get(tI,null);return p?.registerApplication(h),d.onDestroy(()=>{this.detachView(d.hostView),l0(this.components,d),p?.unregisterApplication(h)}),this._loadComponent(d),Wt(11,d),d})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Wt(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(Q7.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new be(101,!1);let t=st(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,st(t),this.afterTick.next(),Wt(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Hd,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<Yoe;)Wt(14),this.synchronizeOnce(),Wt(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let n=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:o}of this.allViews){if(!n&&!r0(o))continue;let i=n&&!this.zonelessEnabled?0:1;z7(o,i),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>r0(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let n=t;this._views.push(n),n.attachToAppRef(this)}detachView(t){let n=t;l0(this._views,n),n.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(o){this.internalErrorHandler(o)}this.components.push(t),this._injector.get(y3,[]).forEach(o=>o(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>l0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new be(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function l0(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function Kd(r,e,t,n){let o=St(),i=i0();if(Hc(o,i,e)){let s=yn(),a=Nb();ene(a,o,r,e,t,n)}return Kd}function re(r,e,t){let n=St(),o=i0();if(Hc(n,o,e)){let i=yn(),s=Nb();xL(s,n,r,e,n[Ar],t)}return re}function x7(r,e,t,n,o){F7(e,r,t,o?"class":"style",n)}function _(r,e,t,n){let o=St(),i=yn(),s=_o+r,a=o[Ar],c=i.firstCreatePass?HL(s,i,o,e,SL,DC(),t,n):i.data[s],l=Xoe(i,o,c,a,e,r);o[s]=l;let u=Sb(c);return Oh(c,!0),gL(a,l,c),!V7(c)&&Ob()&&H7(i,o,l,c),(RN()===0||u)&&g0(l,o),NN(),u&&(L7(i,o,c),aL(i,c,o)),n!==null&&EL(o,c),_}function E(){let r=to();PC()?VN():(r=r.parent,Oh(r,!1));let e=r;FN(e)&&BN(),ON();let t=yn();return t.firstCreatePass&&$L(t,e),e.classesWithoutHost!=null&&Zte(e)&&x7(t,e,St(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&Jte(e)&&x7(t,e,St(),e.stylesWithoutHost,!1),E}function Wr(r,e,t,n){return _(r,e,t,n),E(),Wr}var Xoe=(r,e,t,n,o,i)=>(Lb(!0),hL(n,o,ZN()));function Gt(){return St()}var Ud=void 0;function Qoe(r){let e=Math.floor(Math.abs(r)),t=r.toString().replace(/^[^.]*\.?/,"").length;return e===1&&t===0?1:5}var Zoe=["en",[["a","p"],["AM","PM"],Ud],[["AM","PM"],Ud,Ud],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ud,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ud,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ud,"{1} 'at' {0}",Ud],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",Qoe],XC={};function xi(r){let e=Joe(r),t=DO(e);if(t)return t;let n=e.split("-")[0];if(t=DO(n),t)return t;if(n==="en")return Zoe;throw new be(701,!1)}function DO(r){return r in XC||(XC[r]=Lc.ng&&Lc.ng.common&&Lc.ng.common.locales&&Lc.ng.common.locales[r]),XC[r]}var Fr=function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r}(Fr||{});function Joe(r){return r.toLowerCase().replace(/_/g,"-")}var E0="en-US";var eie=E0;function sF(r){typeof r=="string"&&(eie=r.toLowerCase().replace(/_/g,"-"))}function Ge(r,e,t){let n=St(),o=yn(),i=to();return aF(o,n,n[Ar],i,r,e,t),Ge}function aF(r,e,t,n,o,i,s){let a=!0,c=null;if((n.type&3||s)&&(c??=WC(n,e,i),Jne(n,r,e,s,t,o,i,c)&&(a=!1)),a){let l=n.outputs?.[o],u=n.hostDirectiveOutputs?.[o];if(u&&u.length)for(let d=0;d<u.length;d+=2){let h=u[d],p=u[d+1];c??=WC(n,e,i),bO(n,e,h,p,o,c)}if(l&&l.length)for(let d of l)c??=WC(n,e,i),bO(n,e,d,o,o,c)}}function ne(r=1){return QN(r)}function oI(r,e,t,n){xoe(r,e,t,n)}function iI(r){let e=St(),t=yn(),n=NC();Mb(n+1);let o=X7(t,n);if(r.dirty&&DN(e)===((o.metadata.flags&2)===2)){if(o.matches===null)r.reset([]);else{let i=Ioe(e,n);r.reset(i,fre),r.notifyOnChanges()}return!0}return!1}function sI(){return boe(St(),NC())}function aI(r){let e=jN();return Cb(e,_o+r)}function Vb(r,e){return r<<17|e<<2}function zd(r){return r>>17&32767}function tie(r){return(r&2)==2}function rie(r,e){return r&131071|e<<17}function S7(r){return r|2}function Uh(r){return(r&131068)>>2}function QC(r,e){return r&-131069|e<<2}function nie(r){return(r&1)===1}function _7(r){return r|1}function oie(r,e,t,n,o,i){let s=i?e.classBindings:e.styleBindings,a=zd(s),c=Uh(s);r[n]=t;let l=!1,u;if(Array.isArray(t)){let d=t;u=d[1],(u===null||Mh(d,u)>0)&&(l=!0)}else u=t;if(o)if(c!==0){let h=zd(r[a+1]);r[n+1]=Vb(h,a),h!==0&&(r[h+1]=QC(r[h+1],n)),r[a+1]=rie(r[a+1],n)}else r[n+1]=Vb(a,0),a!==0&&(r[a+1]=QC(r[a+1],n)),a=n;else r[n+1]=Vb(c,0),a===0?a=n:r[c+1]=QC(r[c+1],n),c=n;l&&(r[n+1]=S7(r[n+1])),TO(r,u,n,!0),TO(r,u,n,!1),iie(e,u,r,n,i),s=Vb(a,c),i?e.classBindings=s:e.styleBindings=s}function iie(r,e,t,n,o){let i=o?r.residualClasses:r.residualStyles;i!=null&&typeof e=="string"&&Mh(i,e)>=0&&(t[n+1]=_7(t[n+1]))}function TO(r,e,t,n){let o=r[t+1],i=e===null,s=n?zd(o):Uh(o),a=!1;for(;s!==0&&(a===!1||i);){let c=r[s],l=r[s+1];sie(c,e)&&(a=!0,r[s+1]=n?_7(l):S7(l)),s=n?zd(l):Uh(l)}a&&(r[t+1]=n?S7(o):_7(o))}function sie(r,e){return r===null||e==null||(Array.isArray(r)?r[1]:r)===e?!0:Array.isArray(r)&&typeof e=="string"?Mh(r,e)>=0:!1}var Bs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function aie(r){return r.substring(Bs.key,Bs.keyEnd)}function cie(r){return lie(r),cF(r,lF(r,0,Bs.textEnd))}function cF(r,e){let t=Bs.textEnd;return t===e?-1:(e=Bs.keyEnd=uie(r,Bs.key=e,t),lF(r,e,t))}function lie(r){Bs.key=0,Bs.keyEnd=0,Bs.value=0,Bs.valueEnd=0,Bs.textEnd=r.length}function lF(r,e,t){for(;e<t&&r.charCodeAt(e)<=32;)e++;return e}function uie(r,e,t){for(;e<t&&r.charCodeAt(e)>32;)e++;return e}function v3(r,e,t){return uF(r,e,t,!1),v3}function Ko(r,e){return uF(r,e,null,!0),Ko}function cI(r){fie(vie,die,r,!0)}function die(r,e){for(let t=cie(e);t>=0;t=cF(e,t))wb(r,aie(e),!0)}function uF(r,e,t,n){let o=St(),i=yn(),s=Tb(2);if(i.firstUpdatePass&&fF(i,r,s,n),e!==zo&&Hc(o,s,e)){let a=i.data[Uc()];pF(i,a,o,o[Ar],r,o[s+1]=bie(e,t),n,s)}}function fie(r,e,t,n){let o=yn(),i=Tb(2);o.firstUpdatePass&&fF(o,null,i,n);let s=St();if(t!==zo&&Hc(s,i,t)){let a=o.data[Uc()];if(hF(a,n)&&!dF(o,i)){let c=n?a.classesWithoutHost:a.stylesWithoutHost;c!==null&&(t=mb(c,t||"")),x7(o,a,s,t,n)}else wie(o,a,s,s[Ar],s[i+1],s[i+1]=yie(r,e,t),n,i)}}function dF(r,e){return e>=r.expandoStartIndex}function fF(r,e,t,n){let o=r.data;if(o[t+1]===null){let i=o[Uc()],s=dF(r,t);hF(i,n)&&e===null&&!s&&(e=!1),e=pie(o,i,e,n),oie(o,i,e,t,s,n)}}function pie(r,e,t,n){let o=WN(r),i=n?e.residualClasses:e.residualStyles;if(o===null)(n?e.classBindings:e.styleBindings)===0&&(t=ZC(null,r,e,t,n),t=h0(t,e.attrs,n),i=null);else{let s=e.directiveStylingLast;if(s===-1||r[s]!==o)if(t=ZC(o,r,e,t,n),i===null){let c=hie(r,e,n);c!==void 0&&Array.isArray(c)&&(c=ZC(null,r,e,c[1],n),c=h0(c,e.attrs,n),mie(r,e,n,c))}else i=gie(r,e,n)}return i!==void 0&&(n?e.residualClasses=i:e.residualStyles=i),t}function hie(r,e,t){let n=t?e.classBindings:e.styleBindings;if(Uh(n)!==0)return r[zd(n)]}function mie(r,e,t,n){let o=t?e.classBindings:e.styleBindings;r[zd(o)]=n}function gie(r,e,t){let n,o=e.directiveEnd;for(let i=1+e.directiveStylingLast;i<o;i++){let s=r[i].hostAttrs;n=h0(n,s,t)}return h0(n,e.attrs,t)}function ZC(r,e,t,n,o){let i=null,s=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<s&&(i=e[a],n=h0(n,i.hostAttrs,o),i!==r);)a++;return r!==null&&(t.directiveStylingLast=a),n}function h0(r,e,t){let n=t?1:2,o=-1;if(e!==null)for(let i=0;i<e.length;i++){let s=e[i];typeof s=="number"?o=s:o===n&&(Array.isArray(r)||(r=r===void 0?[]:["",r]),wb(r,s,t?!0:e[++i]))}return r===void 0?null:r}function yie(r,e,t){if(t==null||t==="")return xo;let n=[],o=y0(t);if(Array.isArray(o))for(let i=0;i<o.length;i++)r(n,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&r(n,i,o[i]);else typeof o=="string"&&e(n,o);return n}function vie(r,e,t){let n=String(e);n!==""&&!n.includes(" ")&&wb(r,n,t)}function wie(r,e,t,n,o,i,s,a){o===zo&&(o=xo);let c=0,l=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let h=c<o.length?o[c+1]:void 0,p=l<i.length?i[l+1]:void 0,m=null,y;u===d?(c+=2,l+=2,h!==p&&(m=d,y=p)):d===null||u!==null&&u<d?(c+=2,m=u):(l+=2,m=d,y=p),m!==null&&pF(r,e,t,n,m,y,s,a),u=c<o.length?o[c]:null,d=l<i.length?i[l]:null}}function pF(r,e,t,n,o,i,s,a){if(!(e.type&3))return;let c=r.data,l=c[a+1],u=nie(l)?PO(c,e,t,o,Uh(l),s):void 0;if(!i3(u)){i3(i)||tie(l)&&(i=PO(c,null,t,o,a,s));let d=EC(Uc(),t);xne(n,s,d,o,i)}}function PO(r,e,t,n,o,i){let s=e===null,a;for(;o>0;){let c=r[o],l=Array.isArray(c),u=l?c[1]:c,d=u===null,h=t[o+1];h===zo&&(h=d?xo:void 0);let p=d?bb(h,n):u===n?h:void 0;if(l&&!i3(p)&&(p=bb(c,n)),i3(p)&&(a=p,s))return a;let m=r[o+1];o=s?zd(m):Uh(m)}if(e!==null){let c=i?e.residualClasses:e.residualStyles;c!=null&&(a=bb(c,n))}return a}function i3(r){return r!==void 0}function bie(r,e){return r==null||r===""||(typeof e=="string"?r=r+e:typeof r=="object"&&(r=Ho(y0(r)))),r}function hF(r,e){return(r.flags&(e?8:16))!==0}function C(r,e=""){let t=St(),n=yn(),o=r+_o,i=n.firstCreatePass?W7(n,o,1,e,null):n.data[o],s=Eie(n,t,i,e,r);t[o]=s,Ob()&&H7(n,t,s,i),Oh(i,!1)}var Eie=(r,e,t,n,o)=>(Lb(!0),Fre(e[Ar],n));function xie(r,e,t,n=""){return Hc(r,i0(),t)?e+Rd(t)+n:zo}function Sie(r,e,t,n,o,i=""){let s=HN(),a=KL(r,s,t,o);return Tb(2),a?e+Rd(t)+n+Rd(o)+i:zo}function He(r){return rt("",r),He}function rt(r,e,t){let n=St(),o=xie(n,r,e,t);return o!==zo&&mF(n,Uc(),o),rt}function x0(r,e,t,n,o){let i=St(),s=Sie(i,r,e,t,n,o);return s!==zo&&mF(i,Uc(),s),x0}function mF(r,e,t){let n=EC(e,r);Bre(r[Ar],n,t)}function gr(r,e,t){VC(e)&&(e=e());let n=St(),o=i0();if(Hc(n,o,e)){let i=yn(),s=Nb();xL(s,n,r,e,n[Ar],t)}return gr}function Dr(r,e){let t=VC(r);return t&&r.set(e),t}function yr(r,e){let t=St(),n=yn(),o=to();return aF(n,t,t[Ar],o,r,e),yr}function _ie(r,e,t){let n=yn();if(n.firstCreatePass){let o=La(r);C7(t,n.data,n.blueprint,o,!0),C7(e,n.data,n.blueprint,o,!1)}}function C7(r,e,t,n,o){if(r=Tn(r),Array.isArray(r))for(let i=0;i<r.length;i++)C7(r[i],e,t,n,o);else{let i=yn(),s=St(),a=to(),c=Pd(r)?r:Tn(r.provide),l=yC(r),u=a.providerIndexes&1048575,d=a.directiveStart,h=a.providerIndexes>>20;if(Pd(r)||!r.multi){let p=new jd(l,o,ye),m=e7(c,e,o?u:u+h,d);m===-1?(r7(Yb(a,s),i,c),JC(i,r,e.length),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(p),s.push(p)):(t[m]=p,s[m]=p)}else{let p=e7(c,e,u+h,d),m=e7(c,e,u,u+h),y=p>=0&&t[p],b=m>=0&&t[m];if(o&&!b||!o&&!y){r7(Yb(a,s),i,c);let x=Aie(o?Iie:Cie,t.length,o,n,l);!o&&b&&(t[m].providerFactory=x),JC(i,r,e.length,0),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(x),s.push(x)}else{let x=gF(t[o?m:p],l,!o&&n);JC(i,r,p>-1?p:m,x)}!o&&n&&b&&t[m].componentProviders++}}}function JC(r,e,t,n){let o=Pd(e),i=SN(e);if(o||i){let c=(i?Tn(e.useClass):e).prototype.ngOnDestroy;if(c){let l=r.destroyHooks||(r.destroyHooks=[]);if(!o&&e.multi){let u=l.indexOf(t);u===-1?l.push(t,[n,c]):l[u+1].push(n,c)}else l.push(t,c)}}}function gF(r,e,t){return t&&r.componentProviders++,r.multi.push(e)-1}function e7(r,e,t,n){for(let o=t;o<n;o++)if(e[o]===r)return o;return-1}function Cie(r,e,t,n){return I7(this.multi,[])}function Iie(r,e,t,n){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=d0(t,t[ot],this.providerFactory.index,n);i=a.slice(0,s),I7(o,i);for(let c=s;c<a.length;c++)i.push(a[c])}else i=[],I7(o,i);return i}function I7(r,e){for(let t=0;t<r.length;t++){let n=r[t];e.push(n())}return e}function Aie(r,e,t,n,o){let i=new jd(r,t,ye);return i.multi=[],i.index=e,i.componentProviders=0,gF(i,o,n&&!t),i}function Us(r,e=[]){return t=>{t.providersResolver=(n,o)=>_ie(n,o?o(r):r,e)}}function lI(r,e,t){let n=Db()+r,o=St();return o[n]===zo?Y7(o,n,t?e.call(t):e()):Zne(o,n)}function yF(r,e){let t=r[e];return t===zo?void 0:t}function Die(r,e,t,n,o,i){let s=e+t;return Hc(r,s,o)?Y7(r,s+1,i?n.call(i,o):n(o)):yF(r,s+1)}function Tie(r,e,t,n,o,i,s){let a=e+t;return KL(r,a,o,i)?Y7(r,a+2,s?n.call(s,o,i):n(o,i)):yF(r,a+2)}function Vs(r,e){let t=yn(),n,o=r+_o;t.firstCreatePass?(n=Pie(e,t.pipeRegistry),t.data[o]=n,n.onDestroy&&(t.destroyHooks??=[]).push(o,n.onDestroy)):n=t.data[o];let i=n.factory||(n.factory=Vl(n.type,!0)),s,a=Eo(ye);try{let c=Gb(!1),l=i();return Gb(c),xC(t,St(),o,l),l}finally{Eo(a)}}function Pie(r,e){if(e)for(let t=e.length-1;t>=0;t--){let n=e[t];if(r===n.name)return n}}function Wd(r,e,t){let n=r+_o,o=St(),i=Cb(o,n);return vF(o,n)?Die(o,Db(),e,i.transform,t,i):i.transform(t)}function tu(r,e,t,n){let o=r+_o,i=St(),s=Cb(i,o);return vF(i,o)?Tie(i,Db(),e,s.transform,t,n,s):s.transform(t,n)}function vF(r,e){return r[ot].data[e].pure}var s3=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},uI=(()=>{class r{compileModuleSync(t){return new r3(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let n=this.compileModuleSync(t),o=pC(t),i=fL(o.declarations).reduce((s,a)=>{let c=zl(a);return c&&s.push(new Bh(c)),s},[]);return new s3(n,i)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Mie=(()=>{class r{zone=oe(Kr);changeDetectionScheduler=oe(Hl);applicationRef=oe(qd);applicationErrorHandler=oe(Io);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),wF=new Ce("",{factory:()=>!1});function dI({ngZoneFactory:r,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return r??=()=>new Kr(I(v({},pI()),{scheduleInRootZone:t})),[{provide:Kr,useFactory:r},{provide:Fc,multi:!0,useFactory:()=>{let n=oe(Mie,{optional:!0});return()=>n.initialize()}},{provide:Fc,multi:!0,useFactory:()=>{let n=oe(kie);return()=>{n.initialize()}}},e===!0?{provide:jC,useValue:!0}:[],{provide:HC,useValue:t??JL},{provide:Io,useFactory:()=>{let n=oe(Kr),o=oe(zr),i;return s=>{n.runOutsideAngular(()=>{o.destroyed&&!i?setTimeout(()=>{throw s}):(i??=o.get(ka),i.handleError(s))})}}}]}function fI(r){let e=r?.ignoreChangesOutsideZone,t=r?.scheduleInRootZone,n=dI({ngZoneFactory:()=>{let o=pI(r);return o.scheduleInRootZone=t,o.shouldCoalesceEventChangeDetection&&h3("NgZone_CoalesceEvent"),new Kr(o)},ignoreChangesOutsideZone:e,scheduleInRootZone:t});return Bc([{provide:wF,useValue:!0},{provide:s0,useValue:!1},n])}function pI(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}var kie=(()=>{class r{subscription=new Cr;initialized=!1;zone=oe(Kr);pendingTasks=oe(Vc);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Kr.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Kr.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var bF=(()=>{class r{applicationErrorHandler=oe(Io);appRef=oe(qd);taskService=oe(Vc);ngZone=oe(Kr);zonelessEnabled=oe(s0);tracing=oe(b0,{optional:!0});disableScheduling=oe(jC,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Cr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(n3):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(oe(HC,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof o3||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let n=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,n=!0;break}case 12:{this.appRef.dirtyFlags|=16,n=!0;break}case 13:{this.appRef.dirtyFlags|=2,n=!0;break}case 11:{n=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(n))return;let o=this.useMicrotaskScheduler?CO:eF;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(n3+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(n){this.taskService.remove(t),this.applicationErrorHandler(n)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,CO(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Rie(){return typeof $localize<"u"&&$localize.locale||E0}var S0=new Ce("",{providedIn:"root",factory:()=>oe(S0,{optional:!0,skipSelf:!0})||Rie()});function js(r){return aN(r)}function _0(r,e){return Rw(r,e?.equal)}var EF=class{[Qn];constructor(e){this[Qn]=e}destroy(){this[Qn].destroy()}};var CF=Symbol("InputSignalNode#UNSET"),Wie=I(v({},Nw),{transformFn:void 0,applyValueToInputSignal(r,e){bh(r,e)}});function IF(r,e){let t=Object.create(Wie);t.value=r,t.transformFn=e?.transform;function n(){if(vh(t),t.value===CF){let o=null;throw new be(-950,o)}return t.value}return n[Qn]=t,n}var b3=class{attributeName;constructor(e){this.attributeName=e}__NG_ELEMENT_ID__=()=>m0(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},Gie=new Ce("");Gie.__NG_ELEMENT_ID__=r=>{let e=to();if(e===null)throw new be(204,!1);if(e.type&2)return e.value;if(r&8)return null;throw new be(204,!1)};function xF(r,e){return IF(r,e)}function Yie(r){return IF(CF,r)}var AF=(xF.required=Yie,xF);var hI=new Ce(""),Xie=new Ce("");function C0(r){return!r.moduleRef}function Qie(r){let e=C0(r)?r.r3Injector:r.moduleRef.injector,t=e.get(Kr);return t.run(()=>{C0(r)?r.r3Injector.resolveInjectorInitializers():r.moduleRef.resolveInjectorInitializers();let n=e.get(Io),o;if(t.runOutsideAngular(()=>{o=t.onError.subscribe({next:n})}),C0(r)){let i=()=>e.destroy(),s=r.platformInjector.get(hI);s.add(i),e.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>r.moduleRef.destroy(),s=r.platformInjector.get(hI);s.add(i),r.moduleRef.onDestroy(()=>{l0(r.allPlatformModules,r.moduleRef),o.unsubscribe(),s.delete(i)})}return Jie(n,t,()=>{let i=e.get(nI);return i.runInitializers(),i.donePromise.then(()=>{let s=e.get(S0,E0);if(sF(s||E0),!e.get(Xie,!0))return C0(r)?e.get(qd):(r.allPlatformModules.push(r.moduleRef),r.moduleRef);if(C0(r)){let c=e.get(qd);return r.rootComponent!==void 0&&c.bootstrap(r.rootComponent),c}else return Zie?.(r.moduleRef,r.allPlatformModules),r.moduleRef})})})}var Zie;function Jie(r,e,t){try{let n=t();return eu(n)?n.catch(o=>{throw e.runOutsideAngular(()=>r(o)),o}):n}catch(n){throw e.runOutsideAngular(()=>r(n)),n}}var w3=null;function ese(r=[],e){return Yi.create({name:e,providers:[{provide:Y1,useValue:"platform"},{provide:hI,useValue:new Set([()=>w3=null])},...r]})}function tse(r=[]){if(w3)return w3;let e=ese(r);return w3=e,oF(),rse(e),e}function rse(r){let e=r.get(c3,null);So(r,()=>{e?.forEach(t=>t())})}var Gd=(()=>{class r{static __NG_ELEMENT_ID__=nse}return r})();function nse(r){return ose(to(),St(),(r&16)===16)}function ose(r,e,t){if(Wl(r)&&!t){let n=es(r.index,e);return new Ql(n,n)}else if(r.type&175){let n=e[Zi];return new Ql(n,e)}return null}var mI=class{constructor(){}supports(e){return G7(e)}create(e){return new gI(e)}},ise=(r,e)=>e,gI=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||ise}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,o=0,i=null;for(;t||n;){let s=!n||t&&t.currentIndex<SF(n,o,i)?t:n,a=SF(s,o,i),c=s.currentIndex;if(s===n)o--,n=n._nextRemoved;else if(t=t._next,s.previousIndex==null)o++;else{i||(i=[]);let l=a-o,u=c-o;if(l!=u){for(let h=0;h<l;h++){let p=h<i.length?i[h]:i[h]=0,m=p+h;u<=m&&m<l&&(i[h]=p+1)}let d=s.previousIndex;i[d]=u-l}}a!==c&&e(s,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!G7(e))throw new be(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,n=!1,o,i,s;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)i=e[a],s=this._trackByFn(a,i),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,i,s,a),n=!0):(n&&(t=this._verifyReinsertion(t,i,s,a)),Object.is(t.item,i)||this._addIdentityChange(t,i)),t=t._next}else o=0,zL(e,a=>{s=this._trackByFn(o,a),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,a,s,o),n=!0):(n&&(t=this._verifyReinsertion(t,a,s,o)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,o){let i;return e===null?i=this._itTail:(i=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,o)):(e=this._linkedRecords===null?null:this._linkedRecords.get(n,o),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,o)):e=this._addAfter(new yI(t,n),i,o)),e}_verifyReinsertion(e,t,n,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null);return i!==null?e=this._reinsertAfter(i,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let o=e._prevRemoved,i=e._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){let o=t===null?this._itHead:t._next;return e._next=o,e._prev=t,o===null?this._itTail=e:o._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new E3),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,n=e._next;return t===null?this._itHead=n:t._next=n,n===null?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new E3),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},yI=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}},vI=class{_head=null;_tail=null;add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;n!==null;n=n._nextDup)if((t===null||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){let t=e._prevDup,n=e._nextDup;return t===null?this._head=n:t._nextDup=n,n===null?this._tail=t:n._prevDup=t,this._head===null}},E3=class{map=new Map;put(e){let t=e.trackById,n=this.map.get(t);n||(n=new vI,this.map.set(t,n)),n.add(e)}get(e,t){let n=e,o=this.map.get(n);return o?o.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function SF(r,e,t){let n=r.previousIndex;if(n===null)return n;let o=0;return t&&n<t.length&&(o=t[n]),n+e+o}function _F(){return new wI([new mI])}var wI=(()=>{class r{factories;static \u0275prov=me({token:r,providedIn:"root",factory:_F});constructor(t){this.factories=t}static create(t,n){if(n!=null){let o=n.factories.slice();t=t.concat(o)}return new r(t)}static extend(t){return{provide:r,useFactory:n=>r.create(t,n||_F()),deps:[[r,new NO,new RO]]}}find(t){let n=this.factories.find(o=>o.supports(t));if(n!=null)return n;throw new be(901,!1)}}return r})();function DF(r){Wt(8);try{let{rootComponent:e,appProviders:t,platformProviders:n}=r,o=tse(n),i=[dI({}),{provide:Hl,useExisting:bF},eO,...t||[]],s=new p0({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return Qie({r3Injector:s.injector,platformInjector:o,rootComponent:e})}catch(e){return Promise.reject(e)}finally{Wt(9)}}function $h(r){return typeof r=="boolean"?r:r!=null&&r!=="false"}var MF=null;function os(){return MF}function bI(r){MF??=r}var I0=class{},EI=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(kF),providedIn:"platform"})}return r})();var kF=(()=>{class r extends EI{_location;_history;_doc=oe(qr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return os().getBaseHref(this._doc)}onPopState(t){let n=os().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){let n=os().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,n,o){this._history.pushState(t,n,o)}replaceState(t,n,o){this._history.replaceState(t,n,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>new r,providedIn:"platform"})}return r})();function RF(r,e){return r?e?r.endsWith("/")?e.startsWith("/")?r+e.slice(1):r+e:e.startsWith("/")?r+e:`${r}/${e}`:r:e}function TF(r){let e=r.search(/#|\?|$/);return r[e-1]==="/"?r.slice(0,e-1)+r.slice(e):r}function ru(r){return r&&r[0]!=="?"?`?${r}`:r}var zh=(()=>{class r{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(OF),providedIn:"root"})}return r})(),NF=new Ce(""),OF=(()=>{class r extends zh{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,n){super(),this._platformLocation=t,this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??oe(qr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return RF(this._baseHref,t)}path(t=!1){let n=this._platformLocation.pathname+ru(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${n}${o}`:n}pushState(t,n,o,i){let s=this.prepareExternalUrl(o+ru(i));this._platformLocation.pushState(t,n,s)}replaceState(t,n,o,i){let s=this.prepareExternalUrl(o+ru(i));this._platformLocation.replaceState(t,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(n){return new(n||r)(Ee(EI),Ee(NF,8))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),qh=(()=>{class r{_subject=new Ht;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let n=this._locationStrategy.getBaseHref();this._basePath=cse(TF(PF(n))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+ru(n))}normalize(t){return r.stripTrailingSlash(ase(this._basePath,PF(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,n="",o=null){this._locationStrategy.pushState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ru(n)),o)}replaceState(t,n="",o=null){this._locationStrategy.replaceState(o,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ru(n)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{let n=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(n,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(o=>o(t,n))}subscribe(t,n,o){return this._subject.subscribe({next:t,error:n??void 0,complete:o??void 0})}static normalizeQueryParams=ru;static joinWithSlash=RF;static stripTrailingSlash=TF;static \u0275fac=function(n){return new(n||r)(Ee(zh))};static \u0275prov=me({token:r,factory:()=>sse(),providedIn:"root"})}return r})();function sse(){return new qh(Ee(zh))}function ase(r,e){if(!r||!e.startsWith(r))return e;let t=e.substring(r.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function PF(r){return r.replace(/\/index.html$/,"")}function cse(r){if(new RegExp("^(https?:)?//").test(r)){let[,t]=r.split(/\/\/[^\/]+/);return t}return r}var no=function(r){return r[r.Format=0]="Format",r[r.Standalone=1]="Standalone",r}(no||{}),$t=function(r){return r[r.Narrow=0]="Narrow",r[r.Abbreviated=1]="Abbreviated",r[r.Wide=2]="Wide",r[r.Short=3]="Short",r}($t||{}),Wo=function(r){return r[r.Short=0]="Short",r[r.Medium=1]="Medium",r[r.Long=2]="Long",r[r.Full=3]="Full",r}(Wo||{}),qc={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function VF(r){return xi(r)[Fr.LocaleId]}function jF(r,e,t){let n=xi(r),o=[n[Fr.DayPeriodsFormat],n[Fr.DayPeriodsStandalone]],i=is(o,e);return is(i,t)}function HF(r,e,t){let n=xi(r),o=[n[Fr.DaysFormat],n[Fr.DaysStandalone]],i=is(o,e);return is(i,t)}function $F(r,e,t){let n=xi(r),o=[n[Fr.MonthsFormat],n[Fr.MonthsStandalone]],i=is(o,e);return is(i,t)}function zF(r,e){let n=xi(r)[Fr.Eras];return is(n,e)}function A0(r,e){let t=xi(r);return is(t[Fr.DateFormat],e)}function D0(r,e){let t=xi(r);return is(t[Fr.TimeFormat],e)}function T0(r,e){let n=xi(r)[Fr.DateTimeFormat];return is(n,e)}function P0(r,e){let t=xi(r),n=t[Fr.NumberSymbols][e];if(typeof n>"u"){if(e===qc.CurrencyDecimal)return t[Fr.NumberSymbols][qc.Decimal];if(e===qc.CurrencyGroup)return t[Fr.NumberSymbols][qc.Group]}return n}function qF(r){if(!r[Fr.ExtraData])throw new be(2303,!1)}function KF(r){let e=xi(r);return qF(e),(e[Fr.ExtraData][2]||[]).map(n=>typeof n=="string"?xI(n):[xI(n[0]),xI(n[1])])}function WF(r,e,t){let n=xi(r);qF(n);let o=[n[Fr.ExtraData][0],n[Fr.ExtraData][1]],i=is(o,e)||[];return is(i,t)||[]}function is(r,e){for(let t=e;t>-1;t--)if(typeof r[t]<"u")return r[t];throw new be(2304,!1)}function xI(r){let[e,t]=r.split(":");return{hours:+e,minutes:+t}}var lse=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,x3={},use=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function GF(r,e,t,n){let o=wse(r);e=zc(t,e)||e;let s=[],a;for(;e;)if(a=use.exec(e),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;e=u}else{s.push(e);break}let c=o.getTimezoneOffset();n&&(c=XF(n,c),o=vse(o,n));let l="";return s.forEach(u=>{let d=gse(u);l+=d?d(o,t,c):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function A3(r,e,t){let n=new Date(0);return n.setFullYear(r,e,t),n.setHours(0,0,0),n}function zc(r,e){let t=VF(r);if(x3[t]??={},x3[t][e])return x3[t][e];let n="";switch(e){case"shortDate":n=A0(r,Wo.Short);break;case"mediumDate":n=A0(r,Wo.Medium);break;case"longDate":n=A0(r,Wo.Long);break;case"fullDate":n=A0(r,Wo.Full);break;case"shortTime":n=D0(r,Wo.Short);break;case"mediumTime":n=D0(r,Wo.Medium);break;case"longTime":n=D0(r,Wo.Long);break;case"fullTime":n=D0(r,Wo.Full);break;case"short":let o=zc(r,"shortTime"),i=zc(r,"shortDate");n=S3(T0(r,Wo.Short),[o,i]);break;case"medium":let s=zc(r,"mediumTime"),a=zc(r,"mediumDate");n=S3(T0(r,Wo.Medium),[s,a]);break;case"long":let c=zc(r,"longTime"),l=zc(r,"longDate");n=S3(T0(r,Wo.Long),[c,l]);break;case"full":let u=zc(r,"fullTime"),d=zc(r,"fullDate");n=S3(T0(r,Wo.Full),[u,d]);break}return n&&(x3[t][e]=n),n}function S3(r,e){return e&&(r=r.replace(/\{([^}]+)}/g,function(t,n){return e!=null&&n in e?e[n]:t})),r}function Hs(r,e,t="-",n,o){let i="";(r<0||o&&r<=0)&&(o?r=-r+1:(r=-r,i=t));let s=String(r);for(;s.length<e;)s="0"+s;return n&&(s=s.slice(s.length-e)),i+s}function dse(r,e){return Hs(r,3).substring(0,e)}function Gr(r,e,t=0,n=!1,o=!1){return function(i,s){let a=fse(r,i);if((t>0||a>-t)&&(a+=t),r===3)a===0&&t===-12&&(a=12);else if(r===6)return dse(a,e);let c=P0(s,qc.MinusSign);return Hs(a,e,c,n,o)}}function fse(r,e){switch(r){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new be(2301,!1)}}function Zt(r,e,t=no.Format,n=!1){return function(o,i){return pse(o,i,r,e,t,n)}}function pse(r,e,t,n,o,i){switch(t){case 2:return $F(e,o,n)[r.getMonth()];case 1:return HF(e,o,n)[r.getDay()];case 0:let s=r.getHours(),a=r.getMinutes();if(i){let l=KF(e),u=WF(e,o,n),d=l.findIndex(h=>{if(Array.isArray(h)){let[p,m]=h,y=s>=p.hours&&a>=p.minutes,b=s<m.hours||s===m.hours&&a<m.minutes;if(p.hours<m.hours){if(y&&b)return!0}else if(y||b)return!0}else if(h.hours===s&&h.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return jF(e,o,n)[s<12?0:1];case 3:return zF(e,n)[r.getFullYear()<=0?0:1];default:let c=t;throw new be(2302,!1)}}function _3(r){return function(e,t,n){let o=-1*n,i=P0(t,qc.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(r){case 0:return(o>=0?"+":"")+Hs(s,2,i)+Hs(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Hs(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Hs(s,2,i)+":"+Hs(Math.abs(o%60),2,i);case 3:return n===0?"Z":(o>=0?"+":"")+Hs(s,2,i)+":"+Hs(Math.abs(o%60),2,i);default:throw new be(2302,!1)}}}var hse=0,I3=4;function mse(r){let e=A3(r,hse,1).getDay();return A3(r,0,1+(e<=I3?I3:I3+7)-e)}function YF(r){let e=r.getDay(),t=e===0?-3:I3-e;return A3(r.getFullYear(),r.getMonth(),r.getDate()+t)}function SI(r,e=!1){return function(t,n){let o;if(e){let i=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,s=t.getDate();o=1+Math.floor((s+i)/7)}else{let i=YF(t),s=mse(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Hs(o,r,P0(n,qc.MinusSign))}}function C3(r,e=!1){return function(t,n){let i=YF(t).getFullYear();return Hs(i,r,P0(n,qc.MinusSign),e)}}var _I={};function gse(r){if(_I[r])return _I[r];let e;switch(r){case"G":case"GG":case"GGG":e=Zt(3,$t.Abbreviated);break;case"GGGG":e=Zt(3,$t.Wide);break;case"GGGGG":e=Zt(3,$t.Narrow);break;case"y":e=Gr(0,1,0,!1,!0);break;case"yy":e=Gr(0,2,0,!0,!0);break;case"yyy":e=Gr(0,3,0,!1,!0);break;case"yyyy":e=Gr(0,4,0,!1,!0);break;case"Y":e=C3(1);break;case"YY":e=C3(2,!0);break;case"YYY":e=C3(3);break;case"YYYY":e=C3(4);break;case"M":case"L":e=Gr(1,1,1);break;case"MM":case"LL":e=Gr(1,2,1);break;case"MMM":e=Zt(2,$t.Abbreviated);break;case"MMMM":e=Zt(2,$t.Wide);break;case"MMMMM":e=Zt(2,$t.Narrow);break;case"LLL":e=Zt(2,$t.Abbreviated,no.Standalone);break;case"LLLL":e=Zt(2,$t.Wide,no.Standalone);break;case"LLLLL":e=Zt(2,$t.Narrow,no.Standalone);break;case"w":e=SI(1);break;case"ww":e=SI(2);break;case"W":e=SI(1,!0);break;case"d":e=Gr(2,1);break;case"dd":e=Gr(2,2);break;case"c":case"cc":e=Gr(7,1);break;case"ccc":e=Zt(1,$t.Abbreviated,no.Standalone);break;case"cccc":e=Zt(1,$t.Wide,no.Standalone);break;case"ccccc":e=Zt(1,$t.Narrow,no.Standalone);break;case"cccccc":e=Zt(1,$t.Short,no.Standalone);break;case"E":case"EE":case"EEE":e=Zt(1,$t.Abbreviated);break;case"EEEE":e=Zt(1,$t.Wide);break;case"EEEEE":e=Zt(1,$t.Narrow);break;case"EEEEEE":e=Zt(1,$t.Short);break;case"a":case"aa":case"aaa":e=Zt(0,$t.Abbreviated);break;case"aaaa":e=Zt(0,$t.Wide);break;case"aaaaa":e=Zt(0,$t.Narrow);break;case"b":case"bb":case"bbb":e=Zt(0,$t.Abbreviated,no.Standalone,!0);break;case"bbbb":e=Zt(0,$t.Wide,no.Standalone,!0);break;case"bbbbb":e=Zt(0,$t.Narrow,no.Standalone,!0);break;case"B":case"BB":case"BBB":e=Zt(0,$t.Abbreviated,no.Format,!0);break;case"BBBB":e=Zt(0,$t.Wide,no.Format,!0);break;case"BBBBB":e=Zt(0,$t.Narrow,no.Format,!0);break;case"h":e=Gr(3,1,-12);break;case"hh":e=Gr(3,2,-12);break;case"H":e=Gr(3,1);break;case"HH":e=Gr(3,2);break;case"m":e=Gr(4,1);break;case"mm":e=Gr(4,2);break;case"s":e=Gr(5,1);break;case"ss":e=Gr(5,2);break;case"S":e=Gr(6,1);break;case"SS":e=Gr(6,2);break;case"SSS":e=Gr(6,3);break;case"Z":case"ZZ":case"ZZZ":e=_3(0);break;case"ZZZZZ":e=_3(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=_3(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=_3(2);break;default:return null}return _I[r]=e,e}function XF(r,e){r=r.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+r)/6e4;return isNaN(t)?e:t}function yse(r,e){return r=new Date(r.getTime()),r.setMinutes(r.getMinutes()+e),r}function vse(r,e,t){let o=r.getTimezoneOffset(),i=XF(e,o);return yse(r,-1*(i-o))}function wse(r){if(LF(r))return r;if(typeof r=="number"&&!isNaN(r))return new Date(r);if(typeof r=="string"){if(r=r.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(r)){let[o,i=1,s=1]=r.split("-").map(a=>+a);return A3(o,i-1,s)}let t=parseFloat(r);if(!isNaN(r-t))return new Date(t);let n;if(n=r.match(lse))return bse(n)}let e=new Date(r);if(!LF(e))throw new be(2302,!1);return e}function bse(r){let e=new Date(0),t=0,n=0,o=r[8]?e.setUTCFullYear:e.setFullYear,i=r[8]?e.setUTCHours:e.setHours;r[9]&&(t=Number(r[9]+r[10]),n=Number(r[9]+r[11])),o.call(e,Number(r[1]),Number(r[2])-1,Number(r[3]));let s=Number(r[4]||0)-t,a=Number(r[5]||0)-n,c=Number(r[6]||0),l=Math.floor(parseFloat("0."+(r[7]||0))*1e3);return i.call(e,s,a,c,l),e}function LF(r){return r instanceof Date&&!isNaN(r.valueOf())}var CI=/\s+/,FF=[],Yd=(()=>{class r{_ngEl;_renderer;initialClasses=FF;rawClass;stateMap=new Map;constructor(t,n){this._ngEl=t,this._renderer=n}set klass(t){this.initialClasses=t!=null?t.trim().split(CI):FF}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(CI):t}ngDoCheck(){for(let n of this.initialClasses)this._updateState(n,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let n of t)this._updateState(n,!0);else if(t!=null)for(let n of Object.keys(t))this._updateState(n,!!t[n]);this._applyStateDiff()}_updateState(t,n){let o=this.stateMap.get(t);o!==void 0?(o.enabled!==n&&(o.changed=!0,o.enabled=n),o.touched=!0):this.stateMap.set(t,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let n=t[0],o=t[1];o.changed?(this._toggleClass(n,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),o.touched=!1}}_toggleClass(t,n){t=t.trim(),t.length>0&&t.split(CI).forEach(o=>{n?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(n){return new(n||r)(ye(ro),ye(rs))};static \u0275dir=Qt({type:r,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return r})();var D3=class{$implicit;ngForOf;index;count;constructor(e,t,n,o){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},ja=(()=>{class r{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,n,o){this._viewContainer=t,this._template=n,this._differs=o}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let n=this._viewContainer;t.forEachOperation((o,i,s)=>{if(o.previousIndex==null)n.createEmbeddedView(this._template,new D3(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)n.remove(i===null?void 0:i);else if(i!==null){let a=n.get(i);n.move(a,s),BF(a,o)}});for(let o=0,i=n.length;o<i;o++){let a=n.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{let i=n.get(o.currentIndex);BF(i,o)})}static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||r)(ye($c),ye(Zl),ye(wI))};static \u0275dir=Qt({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return r})();function BF(r,e){r.context.$implicit=e.item}var Pn=(()=>{class r{_viewContainer;_context=new T3;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,n){this._viewContainer=t,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){UF(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){UF(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||r)(ye($c),ye(Zl))};static \u0275dir=Qt({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return r})(),T3=class{$implicit=null;ngIf=null};function UF(r,e){if(r&&!r.createEmbeddedView)throw new be(2020,!1)}function QF(r,e){return new be(2100,!1)}var Xd=(()=>{class r{transform(t){if(t==null)return null;if(typeof t!="string")throw QF(r,t);return t.toUpperCase()}static \u0275fac=function(n){return new(n||r)};static \u0275pipe=g3({name:"uppercase",type:r,pure:!0})}return r})(),Ese="mediumDate",ZF=new Ce(""),JF=new Ce(""),Qd=(()=>{class r{locale;defaultTimezone;defaultOptions;constructor(t,n,o){this.locale=t,this.defaultTimezone=n,this.defaultOptions=o}transform(t,n,o,i){if(t==null||t===""||t!==t)return null;try{let s=n??this.defaultOptions?.dateFormat??Ese,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return GF(t,s,i||this.locale,a)}catch(s){throw QF(r,s.message)}}static \u0275fac=function(n){return new(n||r)(ye(S0,16),ye(ZF,24),ye(JF,24))};static \u0275pipe=g3({name:"date",type:r,pure:!0})}return r})();var vr=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=ns({type:r});static \u0275inj=bi({})}return r})();function M0(r,e){e=encodeURIComponent(e);for(let t of r.split(";")){let n=t.indexOf("="),[o,i]=n==-1?[t,""]:[t.slice(0,n),t.slice(n+1)];if(o.trim()===e)return decodeURIComponent(i)}return null}var Zd=class{};var eB="browser",xse="server";function tB(r){return r===xse}var k3=new Ce(""),TI=(()=>{class r{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,n){this._zone=n,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,o,i){return this._findPluginFor(n).addEventListener(t,n,o,i)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(i=>i.supports(t)),!n)throw new be(5101,!1);return this._eventNameToPlugin.set(t,n),n}static \u0275fac=function(n){return new(n||r)(Ee(k3),Ee(Kr))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),k0=class{_doc;constructor(e){this._doc=e}manager},P3="ng-app-id";function rB(r){for(let e of r)e.remove()}function nB(r,e){let t=e.createElement("style");return t.textContent=r,t}function Sse(r,e,t,n){let o=r.head?.querySelectorAll(`style[${P3}="${e}"],link[${P3}="${e}"]`);if(o)for(let i of o)i.removeAttribute(P3),i instanceof HTMLLinkElement?n.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&t.set(i.textContent,{usage:0,elements:[i]})}function AI(r,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",r),t}var PI=(()=>{class r{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(t,n,o,i={}){this.doc=t,this.appId=n,this.nonce=o,this.isServer=tB(i),Sse(t,n,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,n){for(let o of t)this.addUsage(o,this.inline,nB);n?.forEach(o=>this.addUsage(o,this.external,AI))}removeStyles(t,n){for(let o of t)this.removeUsage(o,this.inline);n?.forEach(o=>this.removeUsage(o,this.external))}addUsage(t,n,o){let i=n.get(t);i?i.usage++:n.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(t,this.doc)))})}removeUsage(t,n){let o=n.get(t);o&&(o.usage--,o.usage<=0&&(rB(o.elements),n.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])rB(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[n,{elements:o}]of this.inline)o.push(this.addElement(t,nB(n,this.doc)));for(let[n,{elements:o}]of this.external)o.push(this.addElement(t,AI(n,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,n){return this.nonce&&n.setAttribute("nonce",this.nonce),this.isServer&&n.setAttribute(P3,this.appId),t.appendChild(n)}static \u0275fac=function(n){return new(n||r)(Ee(qr),Ee(a3),Ee(l3,8),Ee(Hh))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),II={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},MI=/%COMP%/g;var iB="%COMP%",_se=`_nghost-${iB}`,Cse=`_ngcontent-${iB}`,Ise=!0,Ase=new Ce("",{providedIn:"root",factory:()=>Ise});function Dse(r){return Cse.replace(MI,r)}function Tse(r){return _se.replace(MI,r)}function sB(r,e){return e.map(t=>t.replace(MI,r))}var kI=(()=>{class r{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,n,o,i,s,a,c,l=null,u=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=c,this.nonce=l,this.tracingService=u,this.platformIsServer=!1,this.defaultRenderer=new R0(t,s,c,this.platformIsServer,this.tracingService)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;let o=this.getOrCreateRenderer(t,n);return o instanceof M3?o.applyToHost(t):o instanceof N0&&o.applyStyles(),o}getOrCreateRenderer(t,n){let o=this.rendererByCompId,i=o.get(n.id);if(!i){let s=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,h=this.tracingService;switch(n.encapsulation){case jc.Emulated:i=new M3(c,l,n,this.appId,u,s,a,d,h);break;case jc.ShadowDom:return new DI(c,l,t,n,s,a,this.nonce,d,h);default:i=new N0(c,l,n,u,s,a,d,h);break}o.set(n.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(n){return new(n||r)(Ee(TI),Ee(PI),Ee(a3),Ee(Ase),Ee(qr),Ee(Hh),Ee(Kr),Ee(l3),Ee(b0,8))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),R0=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,n,o,i){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(II[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(oB(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(oB(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new be(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,o){if(o){t=o+":"+t;let i=II[o];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let o=II[n];o?e.removeAttributeNS(o,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,o){o&(Ba.DashCase|Ba.Important)?e.style.setProperty(t,n,o&Ba.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Ba.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n,o){if(typeof e=="string"&&(e=os().getGlobalEventTarget(this.doc,e),!e))throw new be(5102,!1);let i=this.decoratePreventDefault(n);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(e,t,i)),this.eventManager.addEventListener(e,t,i,o)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function oB(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var DI=class extends R0{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,n,o,i,s,a,c,l){super(e,i,s,c,l),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=sB(o.id,u);for(let h of u){let p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=h,this.shadowRoot.appendChild(p)}let d=o.getExternalStyles?.();if(d)for(let h of d){let p=AI(h,i);a&&p.setAttribute("nonce",a),this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},N0=class extends R0{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,n,o,i,s,a,c,l){super(e,i,s,a,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=o;let u=n.styles;this.styles=l?sB(l,u):u,this.styleUrls=n.getExternalStyles?.(l)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},M3=class extends N0{contentAttr;hostAttr;constructor(e,t,n,o,i,s,a,c,l){let u=o+"-"+n.id;super(e,t,n,i,s,a,c,l,u),this.contentAttr=Dse(u),this.hostAttr=Tse(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}};var R3=class r extends I0{supportsDOMEvents=!0;static makeCurrent(){bI(new r)}onAndCancel(e,t,n,o){return e.addEventListener(t,n,o),()=>{e.removeEventListener(t,n,o)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=Pse();return t==null?null:Mse(t)}resetBaseElement(){O0=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return M0(document.cookie,e)}},O0=null;function Pse(){return O0=O0||document.head.querySelector("base"),O0?O0.getAttribute("href"):null}function Mse(r){return new URL(r,document.baseURI).pathname}var kse=(()=>{class r{build(){return new XMLHttpRequest}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),cB=(()=>{class r extends k0{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,o,i){return t.addEventListener(n,o,i),()=>this.removeEventListener(t,n,o,i)}removeEventListener(t,n,o,i){return t.removeEventListener(n,o,i)}static \u0275fac=function(n){return new(n||r)(Ee(qr))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),aB=["alt","control","meta","shift"],Rse={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nse={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},lB=(()=>{class r extends k0{constructor(t){super(t)}supports(t){return r.parseEventName(t)!=null}addEventListener(t,n,o,i){let s=r.parseEventName(n),a=r.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>os().onAndCancel(t,s.domEventName,a,i))}static parseEventName(t){let n=t.toLowerCase().split("."),o=n.shift();if(n.length===0||!(o==="keydown"||o==="keyup"))return null;let i=r._normalizeKey(n.pop()),s="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),s="code."),aB.forEach(l=>{let u=n.indexOf(l);u>-1&&(n.splice(u,1),s+=l+".")}),s+=i,n.length!=0||i.length===0)return null;let c={};return c.domEventName=o,c.fullKey=s,c}static matchEventFullKeyCode(t,n){let o=Rse[t.key]||t.key,i="";return n.indexOf("code.")>-1&&(o=t.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),aB.forEach(s=>{if(s!==o){let a=Nse[s];a(t)&&(i+=s+".")}}),i+=o,i===n)}static eventCallback(t,n,o){return i=>{r.matchEventFullKeyCode(i,t)&&o.runGuarded(()=>n(i))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(n){return new(n||r)(Ee(qr))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})();function RI(r,e){return DF(v({rootComponent:r},Ose(e)))}function Ose(r){return{appProviders:[...Vse,...r?.providers??[]],platformProviders:Use}}function Lse(){R3.makeCurrent()}function Fse(){return new ka}function Bse(){return T7(document),document}var Use=[{provide:Hh,useValue:eB},{provide:c3,useValue:Lse,multi:!0},{provide:qr,useFactory:Bse}];var Vse=[{provide:Y1,useValue:"root"},{provide:ka,useFactory:Fse},{provide:k3,useClass:cB,multi:!0,deps:[qr]},{provide:k3,useClass:lB,multi:!0,deps:[qr]},kI,PI,TI,{provide:Hd,useExisting:kI},{provide:Zd,useClass:kse},[]];var Wh=class{},L0=class{},nu=class r{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let n=t.indexOf(":");if(n>0){let o=t.slice(0,n),i=t.slice(n+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,n)=>{this.addHeaderEntry(n,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,n])=>{this.setHeaderEntries(t,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof r?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new r;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof r?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(e.name,t);let o=(e.op==="a"?this.headers.get(t):void 0)||[];o.push(...n),this.headers.set(t,o);break;case"d":let i=e.value;if(!i)this.headers.delete(t),this.normalizedNames.delete(t);else{let s=this.headers.get(t);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,s)}break}}addHeaderEntry(e,t){let n=e.toLowerCase();this.maybeSetNormalizedName(e,n),this.headers.has(n)?this.headers.get(n).push(t):this.headers.set(n,[t])}setHeaderEntries(e,t){let n=(Array.isArray(t)?t:[t]).map(i=>i.toString()),o=e.toLowerCase();this.headers.set(o,n),this.maybeSetNormalizedName(e,o)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var O3=class{encodeKey(e){return uB(e)}encodeValue(e){return uB(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function jse(r,e){let t=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,i)),e.decodeValue(o.slice(i+1))],c=t.get(s)||[];c.push(a),t.set(s,c)}),t}var Hse=/%(\d[a-f0-9])/gi,$se={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function uB(r){return encodeURIComponent(r).replace(Hse,(e,t)=>$se[t]??e)}function N3(r){return`${r}`}var Wc=class r{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new O3,e.fromString){if(e.fromObject)throw new be(2805,!1);this.map=jse(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let n=e.fromObject[t],o=Array.isArray(n)?n.map(N3):[N3(n)];this.map.set(t,o)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(n=>{let o=e[n];Array.isArray(o)?o.forEach(i=>{t.push({param:n,value:i,op:"a"})}):t.push({param:n,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(n=>t+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new r({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(N3(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let n=this.map.get(e.param)||[],o=n.indexOf(N3(e.value));o!==-1&&n.splice(o,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var L3=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function zse(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function dB(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function fB(r){return typeof Blob<"u"&&r instanceof Blob}function pB(r){return typeof FormData<"u"&&r instanceof FormData}function qse(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}var hB="Content-Type",mB="Accept",gB="X-Request-URL",yB="text/plain",vB="application/json",Kse=`${vB}, ${yB}, */*`,Kh=class r{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;keepalive=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(e,t,n,o){this.url=t,this.method=e.toUpperCase();let i;if(zse(this.method)||o?(this.body=n!==void 0?n:null,i=o):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,this.keepalive=!!i.keepalive,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new nu,this.context??=new L3,!this.params)this.params=new Wc,this.urlWithParams=t;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),c=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+c+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||dB(this.body)||fB(this.body)||pB(this.body)||qse(this.body)?this.body:this.body instanceof Wc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||pB(this.body)?null:fB(this.body)?this.body.type||null:dB(this.body)?null:typeof this.body=="string"?yB:this.body instanceof Wc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?vB:null}clone(e={}){let t=e.method||this.method,n=e.url||this.url,o=e.responseType||this.responseType,i=e.keepalive??this.keepalive,s=e.transferCache??this.transferCache,a=e.body!==void 0?e.body:this.body,c=e.withCredentials??this.withCredentials,l=e.reportProgress??this.reportProgress,u=e.headers||this.headers,d=e.params||this.params,h=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((p,m)=>p.set(m,e.setHeaders[m]),u)),e.setParams&&(d=Object.keys(e.setParams).reduce((p,m)=>p.set(m,e.setParams[m]),d)),new r(t,n,a,{params:d,headers:u,context:h,reportProgress:l,responseType:o,withCredentials:c,transferCache:s,keepalive:i})}},Jd=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(Jd||{}),Gh=class{headers;status;statusText;url;ok;type;constructor(e,t=200,n="OK"){this.headers=e.headers||new nu,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},F3=class r extends Gh{constructor(e={}){super(e)}type=Jd.ResponseHeader;clone(e={}){return new r({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},F0=class r extends Gh{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=Jd.Response;clone(e={}){return new r({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},B0=class extends Gh{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Wse=200,Gse=204;function NI(r,e){return{body:e,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive}}var Yh=(()=>{class r{handler;constructor(t){this.handler=t}request(t,n,o={}){let i;if(t instanceof Kh)i=t;else{let c;o.headers instanceof nu?c=o.headers:c=new nu(o.headers);let l;o.params&&(o.params instanceof Wc?l=o.params:l=new Wc({fromObject:o.params})),i=new Kh(t,n,o.body!==void 0?o.body:null,{headers:c,context:o.context,params:l,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache,keepalive:o.keepalive})}let s=Oe(i).pipe(Mc(c=>this.handler.handle(c)));if(t instanceof Kh||o.observe==="events")return s;let a=s.pipe(bo(c=>c instanceof F0));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(Xe(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new be(2806,!1);return c.body}));case"blob":return a.pipe(Xe(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new be(2807,!1);return c.body}));case"text":return a.pipe(Xe(c=>{if(c.body!==null&&typeof c.body!="string")throw new be(2808,!1);return c.body}));case"json":default:return a.pipe(Xe(c=>c.body))}case"response":return a;default:throw new be(2809,!1)}}delete(t,n={}){return this.request("DELETE",t,n)}get(t,n={}){return this.request("GET",t,n)}head(t,n={}){return this.request("HEAD",t,n)}jsonp(t,n){return this.request("JSONP",t,{params:new Wc().append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,n={}){return this.request("OPTIONS",t,n)}patch(t,n,o={}){return this.request("PATCH",t,NI(o,n))}post(t,n,o={}){return this.request("POST",t,NI(o,n))}put(t,n,o={}){return this.request("PUT",t,NI(o,n))}static \u0275fac=function(n){return new(n||r)(Ee(Wh))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})();var Yse=new Ce("");function Xse(r,e){return e(r)}function Qse(r,e,t){return(n,o)=>So(t,()=>e(n,i=>r(i,o)))}var wB=new Ce(""),bB=new Ce(""),EB=new Ce("",{providedIn:"root",factory:()=>!0});var B3=(()=>{class r extends Wh{backend;injector;chain=null;pendingTasks=oe(Fb);contributeToStability=oe(EB);constructor(t,n){super(),this.backend=t,this.injector=n}handle(t){if(this.chain===null){let n=Array.from(new Set([...this.injector.get(wB),...this.injector.get(bB,[])]));this.chain=n.reduceRight((o,i)=>Qse(o,i,this.injector),Xse)}if(this.contributeToStability){let n=this.pendingTasks.add();return this.chain(t,o=>this.backend.handle(o)).pipe(Ad(n))}else return this.chain(t,n=>this.backend.handle(n))}static \u0275fac=function(n){return new(n||r)(Ee(L0),Ee(zr))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})();var Zse=/^\)\]\}',?\n/,Jse=RegExp(`^${gB}:`,"m");function eae(r){return"responseURL"in r&&r.responseURL?r.responseURL:Jse.test(r.getAllResponseHeaders())?r.getResponseHeader(gB):null}var OI=(()=>{class r{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new be(-2800,!1);t.keepalive;let n=this.xhrFactory;return Oe(null).pipe(Jn(()=>new pt(i=>{let s=n.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((y,b)=>s.setRequestHeader(y,b.join(","))),t.headers.has(mB)||s.setRequestHeader(mB,Kse),!t.headers.has(hB)){let y=t.detectContentTypeHeader();y!==null&&s.setRequestHeader(hB,y)}if(t.responseType){let y=t.responseType.toLowerCase();s.responseType=y!=="json"?y:"text"}let a=t.serializeBody(),c=null,l=()=>{if(c!==null)return c;let y=s.statusText||"OK",b=new nu(s.getAllResponseHeaders()),x=eae(s)||t.url;return c=new F3({headers:b,status:s.status,statusText:y,url:x}),c},u=()=>{let{headers:y,status:b,statusText:x,url:A}=l(),P=null;b!==Gse&&(P=typeof s.response>"u"?s.responseText:s.response),b===0&&(b=P?Wse:0);let L=b>=200&&b<300;if(t.responseType==="json"&&typeof P=="string"){let F=P;P=P.replace(Zse,"");try{P=P!==""?JSON.parse(P):null}catch(W){P=F,L&&(L=!1,P={error:W,text:P})}}L?(i.next(new F0({body:P,headers:y,status:b,statusText:x,url:A||void 0})),i.complete()):i.error(new B0({error:P,headers:y,status:b,statusText:x,url:A||void 0}))},d=y=>{let{url:b}=l(),x=new B0({error:y,status:s.status||0,statusText:s.statusText||"Unknown Error",url:b||void 0});i.error(x)},h=!1,p=y=>{h||(i.next(l()),h=!0);let b={type:Jd.DownloadProgress,loaded:y.loaded};y.lengthComputable&&(b.total=y.total),t.responseType==="text"&&s.responseText&&(b.partialText=s.responseText),i.next(b)},m=y=>{let b={type:Jd.UploadProgress,loaded:y.loaded};y.lengthComputable&&(b.total=y.total),i.next(b)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),t.reportProgress&&(s.addEventListener("progress",p),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:Jd.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),t.reportProgress&&(s.removeEventListener("progress",p),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(n){return new(n||r)(Ee(Zd))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})(),xB=new Ce(""),tae="XSRF-TOKEN",rae=new Ce("",{providedIn:"root",factory:()=>tae}),nae="X-XSRF-TOKEN",oae=new Ce("",{providedIn:"root",factory:()=>nae}),U0=class{},iae=(()=>{class r{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,n){this.doc=t,this.cookieName=n}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=M0(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(n){return new(n||r)(Ee(qr),Ee(rae))};static \u0275prov=me({token:r,factory:r.\u0275fac})}return r})();function sae(r,e){let t=r.url.toLowerCase();if(!oe(xB)||r.method==="GET"||r.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(r);let n=oe(U0).getToken(),o=oe(oae);return n!=null&&!r.headers.has(o)&&(r=r.clone({headers:r.headers.set(o,n)})),e(r)}function LI(...r){let e=[Yh,OI,B3,{provide:Wh,useExisting:B3},{provide:L0,useFactory:()=>oe(Yse,{optional:!0})??oe(OI)},{provide:wB,useValue:sae,multi:!0},{provide:xB,useValue:!0},{provide:U0,useClass:iae}];for(let t of r)e.push(...t.\u0275providers);return Bc(e)}var _B=(()=>{class r{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(n){return new(n||r)(Ee(qr))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var it="primary",ey=Symbol("RouteTitle"),jI=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function rf(r){return new jI(r)}function kB(r,e,t){let n=t.path.split("/");if(n.length>r.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<r.length))return null;let o={};for(let i=0;i<n.length;i++){let s=n[i],a=r[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:r.slice(0,n.length),posParams:o}}function cae(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!Ha(r[t],e[t]))return!1;return!0}function Ha(r,e){let t=r?HI(r):void 0,n=e?HI(e):void 0;if(!t||!n||t.length!=n.length)return!1;let o;for(let i=0;i<t.length;i++)if(o=t[i],!RB(r[o],e[o]))return!1;return!0}function HI(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function RB(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;let t=[...r].sort(),n=[...e].sort();return t.every((o,i)=>n[i]===o)}else return r===e}function NB(r){return r.length>0?r[r.length-1]:null}function Xc(r){return L_(r)?r:eu(r)?hr(Promise.resolve(r)):Oe(r)}var lae={exact:LB,subset:FB},OB={exact:uae,subset:dae,ignored:()=>!0};function CB(r,e,t){return lae[t.paths](r.root,e.root,t.matrixParams)&&OB[t.queryParams](r.queryParams,e.queryParams)&&!(t.fragment==="exact"&&r.fragment!==e.fragment)}function uae(r,e){return Ha(r,e)}function LB(r,e,t){if(!ef(r.segments,e.segments)||!j3(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!r.children[n]||!LB(r.children[n],e.children[n],t))return!1;return!0}function dae(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>RB(r[t],e[t]))}function FB(r,e,t){return BB(r,e,e.segments,t)}function BB(r,e,t,n){if(r.segments.length>t.length){let o=r.segments.slice(0,t.length);return!(!ef(o,t)||e.hasChildren()||!j3(o,t,n))}else if(r.segments.length===t.length){if(!ef(r.segments,t)||!j3(r.segments,t,n))return!1;for(let o in e.children)if(!r.children[o]||!FB(r.children[o],e.children[o],n))return!1;return!0}else{let o=t.slice(0,r.segments.length),i=t.slice(r.segments.length);return!ef(r.segments,o)||!j3(r.segments,o,n)||!r.children[it]?!1:BB(r.children[it],e,i,n)}}function j3(r,e,t){return e.every((n,o)=>OB[t](r[o].parameters,n.parameters))}var za=class{root;queryParams;fragment;_queryParamMap;constructor(e=new Mt([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=rf(this.queryParams),this._queryParamMap}toString(){return hae.serialize(this)}},Mt=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return H3(this)}},ou=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=rf(this.parameters),this._parameterMap}toString(){return VB(this)}};function fae(r,e){return ef(r,e)&&r.every((t,n)=>Ha(t.parameters,e[n].parameters))}function ef(r,e){return r.length!==e.length?!1:r.every((t,n)=>t.path===e[n].path)}function pae(r,e){let t=[];return Object.entries(r.children).forEach(([n,o])=>{n===it&&(t=t.concat(e(o,n)))}),Object.entries(r.children).forEach(([n,o])=>{n!==it&&(t=t.concat(e(o,n)))}),t}var ty=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>new nf,providedIn:"root"})}return r})(),nf=class{parse(e){let t=new zI(e);return new za(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${V0(e.root,!0)}`,n=yae(e.queryParams),o=typeof e.fragment=="string"?`#${mae(e.fragment)}`:"";return`${t}${n}${o}`}},hae=new nf;function H3(r){return r.segments.map(e=>VB(e)).join("/")}function V0(r,e){if(!r.hasChildren())return H3(r);if(e){let t=r.children[it]?V0(r.children[it],!1):"",n=[];return Object.entries(r.children).forEach(([o,i])=>{o!==it&&n.push(`${o}:${V0(i,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=pae(r,(n,o)=>o===it?[V0(r.children[it],!1)]:[`${o}:${V0(n,!1)}`]);return Object.keys(r.children).length===1&&r.children[it]!=null?`${H3(r)}/${t[0]}`:`${H3(r)}/(${t.join("//")})`}}function UB(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function U3(r){return UB(r).replace(/%3B/gi,";")}function mae(r){return encodeURI(r)}function $I(r){return UB(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $3(r){return decodeURIComponent(r)}function IB(r){return $3(r.replace(/\+/g,"%20"))}function VB(r){return`${$I(r.path)}${gae(r.parameters)}`}function gae(r){return Object.entries(r).map(([e,t])=>`;${$I(e)}=${$I(t)}`).join("")}function yae(r){let e=Object.entries(r).map(([t,n])=>Array.isArray(n)?n.map(o=>`${U3(t)}=${U3(o)}`).join("&"):`${U3(t)}=${U3(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var vae=/^[^\/()?;#]+/;function FI(r){let e=r.match(vae);return e?e[0]:""}var wae=/^[^\/()?;=#]+/;function bae(r){let e=r.match(wae);return e?e[0]:""}var Eae=/^[^=?&#]+/;function xae(r){let e=r.match(Eae);return e?e[0]:""}var Sae=/^[^&#]+/;function _ae(r){let e=r.match(Sae);return e?e[0]:""}var zI=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Mt([],{}):new Mt([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[it]=new Mt(e,t)),n}parseSegment(){let e=FI(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new be(4009,!1);return this.capture(e),new ou($3(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=bae(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let o=FI(this.remaining);o&&(n=o,this.capture(n))}e[$3(t)]=$3(n)}parseQueryParam(e){let t=xae(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let s=_ae(this.remaining);s&&(n=s,this.capture(n))}let o=IB(t),i=IB(n);if(e.hasOwnProperty(o)){let s=e[o];Array.isArray(s)||(s=[s],e[o]=s),s.push(i)}else e[o]=i}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=FI(this.remaining),o=this.remaining[n.length];if(o!=="/"&&o!==")"&&o!==";")throw new be(4010,!1);let i;n.indexOf(":")>-1?(i=n.slice(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=it);let s=this.parseChildren();t[i]=Object.keys(s).length===1?s[it]:new Mt([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new be(4011,!1)}};function jB(r){return r.segments.length>0?new Mt([],{[it]:r}):r}function HB(r){let e={};for(let[n,o]of Object.entries(r.children)){let i=HB(o);if(n===it&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))e[s]=a;else(i.segments.length>0||i.hasChildren())&&(e[n]=i)}let t=new Mt(r.segments,e);return Cae(t)}function Cae(r){if(r.numberOfChildren===1&&r.children[it]){let e=r.children[it];return new Mt(r.segments.concat(e.segments),e.children)}return r}function iu(r){return r instanceof za}function $B(r,e,t=null,n=null){let o=zB(r);return qB(o,e,t,n)}function zB(r){let e;function t(i){let s={};for(let c of i.children){let l=t(c);s[c.outlet]=l}let a=new Mt(i.url,s);return i===r&&(e=a),a}let n=t(r.root),o=jB(n);return e??o}function qB(r,e,t,n){let o=r;for(;o.parent;)o=o.parent;if(e.length===0)return BI(o,o,o,t,n);let i=Iae(e);if(i.toRoot())return BI(o,o,new Mt([],{}),t,n);let s=Aae(i,o,r),a=s.processChildren?H0(s.segmentGroup,s.index,i.commands):WB(s.segmentGroup,s.index,i.commands);return BI(o,s.segmentGroup,a,t,n)}function z3(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function q0(r){return typeof r=="object"&&r!=null&&r.outlets}function BI(r,e,t,n,o){let i={};n&&Object.entries(n).forEach(([c,l])=>{i[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`});let s;r===e?s=t:s=KB(r,e,t);let a=jB(HB(s));return new za(a,i,o)}function KB(r,e,t){let n={};return Object.entries(r.children).forEach(([o,i])=>{i===e?n[o]=t:n[o]=KB(i,e,t)}),new Mt(r.segments,n)}var q3=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&z3(n[0]))throw new be(4003,!1);let o=n.find(q0);if(o&&o!==NB(n))throw new be(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Iae(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new q3(!0,0,r);let e=0,t=!1,n=r.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new q3(t,e,n)}var Zh=class{segmentGroup;processChildren;index;constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function Aae(r,e,t){if(r.isAbsolute)return new Zh(e,!0,0);if(!t)return new Zh(e,!1,NaN);if(t.parent===null)return new Zh(t,!0,0);let n=z3(r.commands[0])?0:1,o=t.segments.length-1+n;return Dae(t,o,r.numberOfDoubleDots)}function Dae(r,e,t){let n=r,o=e,i=t;for(;i>o;){if(i-=o,n=n.parent,!n)throw new be(4005,!1);o=n.segments.length}return new Zh(n,!1,o-i)}function Tae(r){return q0(r[0])?r[0].outlets:{[it]:r}}function WB(r,e,t){if(r??=new Mt([],{}),r.segments.length===0&&r.hasChildren())return H0(r,e,t);let n=Pae(r,e,t),o=t.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){let i=new Mt(r.segments.slice(0,n.pathIndex),{});return i.children[it]=new Mt(r.segments.slice(n.pathIndex),r.children),H0(i,0,o)}else return n.match&&o.length===0?new Mt(r.segments,{}):n.match&&!r.hasChildren()?qI(r,e,t):n.match?H0(r,0,o):qI(r,e,t)}function H0(r,e,t){if(t.length===0)return new Mt(r.segments,{});{let n=Tae(t),o={};if(Object.keys(n).some(i=>i!==it)&&r.children[it]&&r.numberOfChildren===1&&r.children[it].segments.length===0){let i=H0(r.children[it],e,t);return new Mt(r.segments,i.children)}return Object.entries(n).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=WB(r.children[i],e,s))}),Object.entries(r.children).forEach(([i,s])=>{n[i]===void 0&&(o[i]=s)}),new Mt(r.segments,o)}}function Pae(r,e,t){let n=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};for(;o<r.segments.length;){if(n>=t.length)return i;let s=r.segments[o],a=t[n];if(q0(a))break;let c=`${a}`,l=n<t.length-1?t[n+1]:null;if(o>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!DB(c,l,s))return i;n+=2}else{if(!DB(c,{},s))return i;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}function qI(r,e,t){let n=r.segments.slice(0,e),o=0;for(;o<t.length;){let i=t[o];if(q0(i)){let c=Mae(i.outlets);return new Mt(n,c)}if(o===0&&z3(t[0])){let c=r.segments[e];n.push(new ou(c.path,AB(t[0]))),o++;continue}let s=q0(i)?i.outlets[it]:`${i}`,a=o<t.length-1?t[o+1]:null;s&&a&&z3(a)?(n.push(new ou(s,AB(a))),o+=2):(n.push(new ou(s,{})),o++)}return new Mt(n,{})}function Mae(r){let e={};return Object.entries(r).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=qI(new Mt([],{}),0,n))}),e}function AB(r){let e={};return Object.entries(r).forEach(([t,n])=>e[t]=`${n}`),e}function DB(r,e,t){return r==t.path&&Ha(e,t.parameters)}var $0="imperative",vn=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(vn||{}),_i=class{id;url;constructor(e,t){this.id=e,this.url=t}},of=class extends _i{type=vn.NavigationStart;navigationTrigger;restoredState;constructor(e,t,n="imperative",o=null){super(e,t),this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},zs=class extends _i{urlAfterRedirects;type=vn.NavigationEnd;constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ao=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r[r.Aborted=4]="Aborted",r}(Ao||{}),K0=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(K0||{}),$a=class extends _i{reason;code;type=vn.NavigationCancel;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Gc=class extends _i{reason;code;type=vn.NavigationSkipped;constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o}},em=class extends _i{error;target;type=vn.NavigationError;constructor(e,t,n,o){super(e,t),this.error=n,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},W0=class extends _i{urlAfterRedirects;state;type=vn.RoutesRecognized;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},K3=class extends _i{urlAfterRedirects;state;type=vn.GuardsCheckStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},W3=class extends _i{urlAfterRedirects;state;shouldActivate;type=vn.GuardsCheckEnd;constructor(e,t,n,o,i){super(e,t),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},G3=class extends _i{urlAfterRedirects;state;type=vn.ResolveStart;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Y3=class extends _i{urlAfterRedirects;state;type=vn.ResolveEnd;constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},X3=class{route;type=vn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Q3=class{route;type=vn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Z3=class{snapshot;type=vn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},J3=class{snapshot;type=vn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},e4=class{snapshot;type=vn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},t4=class{snapshot;type=vn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var G0=class{},tm=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function kae(r){return!(r instanceof G0)&&!(r instanceof tm)}function Rae(r,e){return r.providers&&!r._injector&&(r._injector=w0(r.providers,e,`Route: ${r.path}`)),r._injector??e}function $s(r){return r.outlet||it}function Nae(r,e){let t=r.filter(n=>$s(n)===e);return t.push(...r.filter(n=>$s(n)!==e)),t}function ry(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let e=r.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var r4=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return ry(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new om(this.rootInjector)}},om=(()=>{class r{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,n){let o=this.getOrCreateContext(t);o.outlet=n,this.contexts.set(t,o)}onChildOutletDestroyed(t){let n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new r4(this.rootInjector),this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(n){return new(n||r)(Ee(zr))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),n4=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=KI(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=KI(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=WI(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return WI(e,this._root).map(t=>t.value)}};function KI(r,e){if(r===e.value)return e;for(let t of e.children){let n=KI(r,t);if(n)return n}return null}function WI(r,e){if(r===e.value)return[e];for(let t of e.children){let n=WI(r,t);if(n.length)return n.unshift(e),n}return[]}var Si=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Qh(r){let e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}var Y0=class extends n4{snapshot;constructor(e,t){super(e),this.snapshot=t,t9(this,e)}toString(){return this.snapshot.toString()}};function GB(r){let e=Oae(r),t=new cn([new ou("",{})]),n=new cn({}),o=new cn({}),i=new cn({}),s=new cn(""),a=new Yc(t,n,i,s,o,it,r,e.root);return a.snapshot=e.root,new Y0(new Si(a,[]),e)}function Oae(r){let e={},t={},n={},o="",i=new tf([],e,n,o,t,it,r,null,{});return new X0("",new Si(i,[]))}var Yc=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,n,o,i,s,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(Xe(l=>l[ey]))??Oe(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Xe(e=>rf(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Xe(e=>rf(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function o4(r,e,t="emptyOnly"){let n,{routeConfig:o}=r;return e!==null&&(t==="always"||o?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:v(v({},e.params),r.params),data:v(v({},e.data),r.data),resolve:v(v(v(v({},r.data),e.data),o?.data),r._resolvedData)}:n={params:v({},r.params),data:v({},r.data),resolve:v(v({},r.data),r._resolvedData??{})},o&&XB(o)&&(n.resolve[ey]=o.title),n}var tf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[ey]}constructor(e,t,n,o,i,s,a,c,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=rf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=rf(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},X0=class extends n4{url;constructor(e,t){super(t),this.url=e,t9(this,t)}toString(){return YB(this._root)}};function t9(r,e){e.value._routerState=r,e.children.forEach(t=>t9(r,t))}function YB(r){let e=r.children.length>0?` { ${r.children.map(YB).join(", ")} } `:"";return`${r.value}${e}`}function UI(r){if(r.snapshot){let e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,Ha(e.queryParams,t.queryParams)||r.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&r.fragmentSubject.next(t.fragment),Ha(e.params,t.params)||r.paramsSubject.next(t.params),cae(e.url,t.url)||r.urlSubject.next(t.url),Ha(e.data,t.data)||r.dataSubject.next(t.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function GI(r,e){let t=Ha(r.params,e.params)&&fae(r.url,e.url),n=!r.parent!=!e.parent;return t&&!n&&(!r.parent||GI(r.parent,e.parent))}function XB(r){return typeof r.title=="string"||r.title===null}var QB=new Ce(""),ny=(()=>{class r{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=it;activateEvents=new Bt;deactivateEvents=new Bt;attachEvents=new Bt;detachEvents=new Bt;routerOutletData=AF(void 0);parentContexts=oe(om);location=oe($c);changeDetector=oe(Gd);inputBinder=oe(c4,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:n,previousValue:o}=t.name;if(n)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new be(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new be(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new be(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new be(4013,!1);this._activatedRoute=t;let o=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new YI(t,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:c,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(n){return new(n||r)};static \u0275dir=Qt({type:r,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ua]})}return r})(),YI=class{route;childContexts;parent;outletData;constructor(e,t,n,o){this.route=e,this.childContexts=t,this.parent=n,this.outletData=o}get(e,t){return e===Yc?this.route:e===om?this.childContexts:e===QB?this.outletData:this.parent.get(e,t)}},c4=new Ce("");var r9=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=mr({type:r,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(n,o){n&1&&Wr(0,"router-outlet")},dependencies:[ny],encapsulation:2})}return r})();function n9(r){let e=r.children&&r.children.map(n9),t=e?I(v({},r),{children:e}):v({},r);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==it&&(t.component=r9),t}function Lae(r,e,t){let n=Q0(r,e._root,t?t._root:void 0);return new Y0(n,e)}function Q0(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let o=Fae(r,e,t);return new Si(n,o)}else{if(r.shouldAttach(e.value)){let i=r.retrieve(e.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>Q0(r,a)),s}}let n=Bae(e.value),o=e.children.map(i=>Q0(r,i));return new Si(n,o)}}function Fae(r,e,t){return e.children.map(n=>{for(let o of t.children)if(r.shouldReuseRoute(n.value,o.value.snapshot))return Q0(r,n,o);return Q0(r,n)})}function Bae(r){return new Yc(new cn(r.url),new cn(r.params),new cn(r.queryParams),new cn(r.fragment),new cn(r.data),r.outlet,r.component,r)}var rm=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},ZB="ngNavigationCancelingError";function i4(r,e){let{redirectTo:t,navigationBehaviorOptions:n}=iu(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=JB(!1,Ao.Redirect);return o.url=t,o.navigationBehaviorOptions=n,o}function JB(r,e){let t=new Error(`NavigationCancelingError: ${r||""}`);return t[ZB]=!0,t.cancellationCode=e,t}function Uae(r){return eU(r)&&iu(r.url)}function eU(r){return!!r&&r[ZB]}var Vae=(r,e,t,n)=>Xe(o=>(new XI(e,o.targetRouterState,o.currentRouterState,t,n).activate(r),o)),XI=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,n,o,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=i}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),UI(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let o=Qh(t);e.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],n),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,n)})}deactivateRoutes(e,t,n){let o=e.value,i=t?t.value:null;if(o===i)if(o.component){let s=n.getContext(o.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,i=Qh(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(n&&n.outlet){let s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,i=Qh(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let o=Qh(t);e.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],n),this.forwardEvent(new t4(i.value.snapshot))}),e.children.length&&this.forwardEvent(new J3(e.value.snapshot))}activateRoutes(e,t,n){let o=e.value,i=t?t.value:null;if(UI(o),o===i)if(o.component){let s=n.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,n);else if(o.component){let s=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),UI(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,n)}},s4=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Jh=class{component;route;constructor(e,t){this.component=e,this.route=t}};function jae(r,e,t){let n=r._root,o=e?e._root:null;return j0(n,o,t,[n.value])}function Hae(r){let e=r.routeConfig?r.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:r,guards:e}}function im(r,e){let t=Symbol(),n=e.get(r,t);return n===t?typeof r=="function"&&!tC(r)?r:e.get(r):n}function j0(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Qh(e);return r.children.forEach(s=>{$ae(s,i[s.value.outlet],t,n.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>z0(a,t.getContext(s),o)),o}function $ae(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=r.value,s=e?e.value:null,a=t?t.getContext(r.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let c=zae(s,i,i.routeConfig.runGuardsAndResolvers);c?o.canActivateChecks.push(new s4(n)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?j0(r,e,a?a.children:null,n,o):j0(r,e,t,n,o),c&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Jh(a.outlet.component,s))}else s&&z0(e,a,o),o.canActivateChecks.push(new s4(n)),i.component?j0(r,null,a?a.children:null,n,o):j0(r,null,t,n,o);return o}function zae(r,e,t){if(typeof t=="function")return t(r,e);switch(t){case"pathParamsChange":return!ef(r.url,e.url);case"pathParamsOrQueryParamsChange":return!ef(r.url,e.url)||!Ha(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!GI(r,e)||!Ha(r.queryParams,e.queryParams);case"paramsChange":default:return!GI(r,e)}}function z0(r,e,t){let n=Qh(r),o=r.value;Object.entries(n).forEach(([i,s])=>{o.component?e?z0(s,e.children.getContext(i),t):z0(s,null,t):z0(s,e,t)}),o.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Jh(e.outlet.component,o)):t.canDeactivateChecks.push(new Jh(null,o)):t.canDeactivateChecks.push(new Jh(null,o))}function oy(r){return typeof r=="function"}function qae(r){return typeof r=="boolean"}function Kae(r){return r&&oy(r.canLoad)}function Wae(r){return r&&oy(r.canActivate)}function Gae(r){return r&&oy(r.canActivateChild)}function Yae(r){return r&&oy(r.canDeactivate)}function Xae(r){return r&&oy(r.canMatch)}function tU(r){return r instanceof Rs||r?.name==="EmptyError"}var V3=Symbol("INITIAL_VALUE");function nm(){return Jn(r=>ab(r.map(e=>e.pipe(kc(1),j_(V3)))).pipe(Xe(e=>{for(let t of e)if(t!==!0){if(t===V3)return V3;if(t===!1||Qae(t))return t}return!0}),bo(e=>e!==V3),kc(1)))}function Qae(r){return iu(r)||r instanceof rm}function Zae(r,e){return $r(t=>{let{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=t;return s.length===0&&i.length===0?Oe(I(v({},t),{guardsResult:!0})):Jae(s,n,o,r).pipe($r(a=>a&&qae(a)?ece(n,i,r,e):Oe(a)),Xe(a=>I(v({},t),{guardsResult:a})))})}function Jae(r,e,t,n){return hr(r).pipe($r(o=>ice(o.component,o.route,t,e,n)),Rc(o=>o!==!0,!0))}function ece(r,e,t,n){return hr(e).pipe(Mc(o=>Dh(rce(o.route.parent,n),tce(o.route,n),oce(r,o.path,t),nce(r,o.route,t))),Rc(o=>o!==!0,!0))}function tce(r,e){return r!==null&&e&&e(new e4(r)),Oe(!0)}function rce(r,e){return r!==null&&e&&e(new Z3(r)),Oe(!0)}function nce(r,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return Oe(!0);let o=n.map(i=>$1(()=>{let s=ry(e)??t,a=im(i,s),c=Wae(a)?a.canActivate(e,r):So(s,()=>a(e,r));return Xc(c).pipe(Rc())}));return Oe(o).pipe(nm())}function oce(r,e,t){let n=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(s=>Hae(s)).filter(s=>s!==null).map(s=>$1(()=>{let a=s.guards.map(c=>{let l=ry(s.node)??t,u=im(c,l),d=Gae(u)?u.canActivateChild(n,r):So(l,()=>u(n,r));return Xc(d).pipe(Rc())});return Oe(a).pipe(nm())}));return Oe(i).pipe(nm())}function ice(r,e,t,n,o){let i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!i||i.length===0)return Oe(!0);let s=i.map(a=>{let c=ry(e)??o,l=im(a,c),u=Yae(l)?l.canDeactivate(r,e,t,n):So(c,()=>l(r,e,t,n));return Xc(u).pipe(Rc())});return Oe(s).pipe(nm())}function sce(r,e,t,n){let o=e.canLoad;if(o===void 0||o.length===0)return Oe(!0);let i=o.map(s=>{let a=im(s,r),c=Kae(a)?a.canLoad(e,t):So(r,()=>a(e,t));return Xc(c)});return Oe(i).pipe(nm(),rU(n))}function rU(r){return P_(mn(e=>{if(typeof e!="boolean")throw i4(r,e)}),Xe(e=>e===!0))}function ace(r,e,t,n){let o=e.canMatch;if(!o||o.length===0)return Oe(!0);let i=o.map(s=>{let a=im(s,r),c=Xae(a)?a.canMatch(e,t):So(r,()=>a(e,t));return Xc(c)});return Oe(i).pipe(nm(),rU(n))}var Z0=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},J0=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function Xh(r){return wi(new Z0(r))}function cce(r){return wi(new be(4e3,!1))}function lce(r){return wi(JB(!1,Ao.GuardRejected))}var QI=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],o=t.root;for(;;){if(n=n.concat(o.segments),o.numberOfChildren===0)return Oe(n);if(o.numberOfChildren>1||!o.children[it])return cce(`${e.redirectTo}`);o=o.children[it]}}applyRedirectCommands(e,t,n,o,i){return uce(t,o,i).pipe(Xe(s=>{if(s instanceof za)throw new J0(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),e,n);if(s[0]==="/")throw new J0(a);return a}))}applyRedirectCreateUrlTree(e,t,n,o){let i=this.createSegmentGroup(e,t.root,n,o);return new za(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);n[o]=t[a]}else n[o]=i}),n}createSegmentGroup(e,t,n,o){let i=this.createSegments(e,t.segments,n,o),s={};return Object.entries(t.children).forEach(([a,c])=>{s[a]=this.createSegmentGroup(e,c,n,o)}),new Mt(i,s)}createSegments(e,t,n,o){return t.map(i=>i.path[0]===":"?this.findPosParam(e,i,o):this.findOrReturn(i,n))}findPosParam(e,t,n){let o=n[t.path.substring(1)];if(!o)throw new be(4001,!1);return o}findOrReturn(e,t){let n=0;for(let o of t){if(o.path===e.path)return t.splice(n),o;n++}return e}};function uce(r,e,t){if(typeof r=="string")return Oe(r);let n=r,{queryParams:o,fragment:i,routeConfig:s,url:a,outlet:c,params:l,data:u,title:d}=e;return Xc(So(t,()=>n({params:l,data:u,queryParams:o,fragment:i,routeConfig:s,url:a,outlet:c,title:d})))}var ZI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function dce(r,e,t,n,o){let i=nU(r,e,t);return i.matched?(n=Rae(e,n),ace(n,e,t,o).pipe(Xe(s=>s===!0?i:v({},ZI)))):Oe(i)}function nU(r,e,t){if(e.path==="**")return fce(t);if(e.path==="")return e.pathMatch==="full"&&(r.hasChildren()||t.length>0)?v({},ZI):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let o=(e.matcher||kB)(t,r,e);if(!o)return v({},ZI);let i={};Object.entries(o.posParams??{}).forEach(([a,c])=>{i[a]=c.path});let s=o.consumed.length>0?v(v({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function fce(r){return{matched:!0,parameters:r.length>0?NB(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function TB(r,e,t,n){return t.length>0&&mce(r,t,n)?{segmentGroup:new Mt(e,hce(n,new Mt(t,r.children))),slicedSegments:[]}:t.length===0&&gce(r,t,n)?{segmentGroup:new Mt(r.segments,pce(r,t,n,r.children)),slicedSegments:t}:{segmentGroup:new Mt(r.segments,r.children),slicedSegments:t}}function pce(r,e,t,n){let o={};for(let i of t)if(l4(r,e,i)&&!n[$s(i)]){let s=new Mt([],{});o[$s(i)]=s}return v(v({},n),o)}function hce(r,e){let t={};t[it]=e;for(let n of r)if(n.path===""&&$s(n)!==it){let o=new Mt([],{});t[$s(n)]=o}return t}function mce(r,e,t){return t.some(n=>l4(r,e,n)&&$s(n)!==it)}function gce(r,e,t){return t.some(n=>l4(r,e,n))}function l4(r,e,t){return(r.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function yce(r,e,t){return e.length===0&&!r.children[t]}var JI=class{};function vce(r,e,t,n,o,i,s="emptyOnly"){return new e9(r,e,t,n,o,s,i).recognize()}var wce=31,e9=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,n,o,i,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new QI(this.urlSerializer,this.urlTree)}noMatchError(e){return new be(4002,`'${e.segmentGroup}'`)}recognize(){let e=TB(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Xe(({children:t,rootSnapshot:n})=>{let o=new Si(n,t),i=new X0("",o),s=$B(n,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(e){let t=new tf([],Object.freeze({}),Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),it,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,it,t).pipe(Xe(n=>({children:n,rootSnapshot:t})),ln(n=>{if(n instanceof J0)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Z0?this.noMatchError(n):n}))}processSegmentGroup(e,t,n,o,i){return n.segments.length===0&&n.hasChildren()?this.processChildren(e,t,n,i):this.processSegment(e,t,n,n.segments,o,!0,i).pipe(Xe(s=>s instanceof Si?[s]:[]))}processChildren(e,t,n,o){let i=[];for(let s of Object.keys(n.children))s==="primary"?i.unshift(s):i.push(s);return hr(i).pipe(Mc(s=>{let a=n.children[s],c=Nae(t,s);return this.processSegmentGroup(e,c,a,s,o)}),V_((s,a)=>(s.push(...a),s)),Ul(null),U_(),$r(s=>{if(s===null)return Xh(n);let a=oU(s);return bce(a),Oe(a)}))}processSegment(e,t,n,o,i,s,a){return hr(t).pipe(Mc(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,n,o,i,s,a).pipe(ln(l=>{if(l instanceof Z0)return Oe(null);throw l}))),Rc(c=>!!c),ln(c=>{if(tU(c))return yce(n,o,i)?Oe(new JI):Xh(n);throw c}))}processSegmentAgainstRoute(e,t,n,o,i,s,a,c){return $s(n)!==s&&(s===it||!l4(o,i,n))?Xh(o):n.redirectTo===void 0?this.matchSegmentAgainstRoute(e,o,n,i,s,c):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,o,t,n,i,s,c):Xh(o)}expandSegmentAgainstRouteUsingRedirect(e,t,n,o,i,s,a){let{matched:c,parameters:l,consumedSegments:u,positionalParamSegments:d,remainingSegments:h}=nU(t,o,i);if(!c)return Xh(t);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>wce&&(this.allowRedirects=!1));let p=new tf(i,l,Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,PB(o),$s(o),o.component??o._loadedComponent??null,o,MB(o)),m=o4(p,a,this.paramsInheritanceStrategy);return p.params=Object.freeze(m.params),p.data=Object.freeze(m.data),this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,p,e).pipe(Jn(b=>this.applyRedirects.lineralizeSegments(o,b)),$r(b=>this.processSegment(e,n,t,b.concat(h),s,!1,a)))}matchSegmentAgainstRoute(e,t,n,o,i,s){let a=dce(t,n,o,e,this.urlSerializer);return n.path==="**"&&(t.children={}),a.pipe(Jn(c=>c.matched?(e=n._injector??e,this.getChildConfig(e,n,o).pipe(Jn(({routes:l})=>{let u=n._loadedInjector??e,{parameters:d,consumedSegments:h,remainingSegments:p}=c,m=new tf(h,d,Object.freeze(v({},this.urlTree.queryParams)),this.urlTree.fragment,PB(n),$s(n),n.component??n._loadedComponent??null,n,MB(n)),y=o4(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(y.params),m.data=Object.freeze(y.data);let{segmentGroup:b,slicedSegments:x}=TB(t,h,p,l);if(x.length===0&&b.hasChildren())return this.processChildren(u,l,b,m).pipe(Xe(P=>new Si(m,P)));if(l.length===0&&x.length===0)return Oe(new Si(m,[]));let A=$s(n)===i;return this.processSegment(u,l,b,x,A?it:i,!0,m).pipe(Xe(P=>new Si(m,P instanceof Si?[P]:[])))}))):Xh(t)))}getChildConfig(e,t,n){return t.children?Oe({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Oe({routes:t._loadedRoutes,injector:t._loadedInjector}):sce(e,t,n,this.urlSerializer).pipe($r(o=>o?this.configLoader.loadChildren(e,t).pipe(mn(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):lce(t))):Oe({routes:[],injector:e})}};function bce(r){r.sort((e,t)=>e.value.outlet===it?-1:t.value.outlet===it?1:e.value.outlet.localeCompare(t.value.outlet))}function Ece(r){let e=r.value.routeConfig;return e&&e.path===""}function oU(r){let e=[],t=new Set;for(let n of r){if(!Ece(n)){e.push(n);continue}let o=e.find(i=>n.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...n.children),t.add(o)):e.push(n)}for(let n of t){let o=oU(n.children);e.push(new Si(n.value,o))}return e.filter(n=>!t.has(n))}function PB(r){return r.data||{}}function MB(r){return r.resolve||{}}function xce(r,e,t,n,o,i){return $r(s=>vce(r,e,t,n,s.extractedUrl,o,i).pipe(Xe(({state:a,tree:c})=>I(v({},s),{targetSnapshot:a,urlAfterRedirects:c}))))}function Sce(r,e){return $r(t=>{let{targetSnapshot:n,guards:{canActivateChecks:o}}=t;if(!o.length)return Oe(t);let i=new Set(o.map(c=>c.route)),s=new Set;for(let c of i)if(!s.has(c))for(let l of iU(c))s.add(l);let a=0;return hr(s).pipe(Mc(c=>i.has(c)?_ce(c,n,r,e):(c.data=o4(c,c.parent,r).resolve,Oe(void 0))),mn(()=>a++),Th(1),$r(c=>a===s.size?Oe(t):jo))})}function iU(r){let e=r.children.map(t=>iU(t)).flat();return[r,...e]}function _ce(r,e,t,n){let o=r.routeConfig,i=r._resolve;return o?.title!==void 0&&!XB(o)&&(i[ey]=o.title),$1(()=>(r.data=o4(r,r.parent,t).resolve,Cce(i,r,e,n).pipe(Xe(s=>(r._resolvedData=s,r.data=v(v({},r.data),s),null)))))}function Cce(r,e,t,n){let o=HI(r);if(o.length===0)return Oe({});let i={};return hr(o).pipe($r(s=>Ice(r[s],e,t,n).pipe(Rc(),mn(a=>{if(a instanceof rm)throw i4(new nf,a);i[s]=a}))),Th(1),Xe(()=>i),ln(s=>tU(s)?jo:wi(s)))}function Ice(r,e,t,n){let o=ry(e)??n,i=im(r,o),s=i.resolve?i.resolve(e,t):So(o,()=>i(e,t));return Xc(s)}function VI(r){return Jn(e=>{let t=r(e);return t?hr(t).pipe(Xe(()=>e)):Oe(e)})}var o9=(()=>{class r{buildTitle(t){let n,o=t.root;for(;o!==void 0;)n=this.getResolvedTitleForRoute(o)??n,o=o.children.find(i=>i.outlet===it);return n}getResolvedTitleForRoute(t){return t.data[ey]}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(sU),providedIn:"root"})}return r})(),sU=(()=>{class r extends o9{title;constructor(t){super(),this.title=t}updateTitle(t){let n=this.buildTitle(t);n!==void 0&&this.title.setTitle(n)}static \u0275fac=function(n){return new(n||r)(Ee(_B))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),sm=new Ce("",{providedIn:"root",factory:()=>({})}),iy=new Ce(""),aU=(()=>{class r{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=oe(uI);loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Oe(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let n=Xc(t.loadComponent()).pipe(Xe(lU),mn(i=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=i}),Ad(()=>{this.componentLoaders.delete(t)})),o=new Ch(n,()=>new Ht).pipe(_h());return this.componentLoaders.set(t,o),o}loadChildren(t,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Oe({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);let i=cU(n,this.compiler,t,this.onLoadEndListener).pipe(Ad(()=>{this.childrenLoaders.delete(n)})),s=new Ch(i,()=>new Ht).pipe(_h());return this.childrenLoaders.set(n,s),s}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function cU(r,e,t,n){return Xc(r.loadChildren()).pipe(Xe(lU),$r(o=>o instanceof m3||Array.isArray(o)?Oe(o):hr(e.compileModuleAsync(o))),Xe(o=>{n&&n(r);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(t).injector,s=i.get(iy,[],{optional:!0,self:!0}).flat()),{routes:s.map(n9),injector:i}}))}function Ace(r){return r&&typeof r=="object"&&"default"in r}function lU(r){return Ace(r)?r.default:r}var u4=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(Dce),providedIn:"root"})}return r})(),Dce=(()=>{class r{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),uU=new Ce("");var dU=new Ce(""),fU=(()=>{class r{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Ht;transitionAbortWithErrorSubject=new Ht;configLoader=oe(aU);environmentInjector=oe(zr);destroyRef=oe(Yl);urlSerializer=oe(ty);rootContexts=oe(om);location=oe(qh);inputBindingEnabled=oe(c4,{optional:!0})!==null;titleStrategy=oe(o9);options=oe(sm,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=oe(u4);createViewTransition=oe(uU,{optional:!0});navigationErrorHandler=oe(dU,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Oe(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=o=>this.events.next(new X3(o)),n=o=>this.events.next(new Q3(o));this.configLoader.onLoadEndListener=n,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let n=++this.navigationId;this.transitions?.next(I(v({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:n}))}setupNavigations(t){return this.transitions=new cn(null),this.transitions.pipe(bo(n=>n!==null),Jn(n=>{let o=!1;return Oe(n).pipe(Jn(i=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",Ao.SupersededByNewNavigation),jo;this.currentTransition=n,this.currentNavigation={id:i.id,initialUrl:i.rawUrl,extractedUrl:i.extractedUrl,targetBrowserUrl:typeof i.extras.browserUrl=="string"?this.urlSerializer.parse(i.extras.browserUrl):i.extras.browserUrl,trigger:i.source,extras:i.extras,previousNavigation:this.lastSuccessfulNavigation?I(v({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>i.abortController.abort()};let s=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=i.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!s&&a!=="reload"){let c="";return this.events.next(new Gc(i.id,this.urlSerializer.serialize(i.rawUrl),c,K0.IgnoredSameUrlNavigation)),i.resolve(!1),jo}if(this.urlHandlingStrategy.shouldProcessUrl(i.rawUrl))return Oe(i).pipe(Jn(c=>(this.events.next(new of(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?jo:Promise.resolve(c))),xce(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),mn(c=>{n.targetSnapshot=c.targetSnapshot,n.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation=I(v({},this.currentNavigation),{finalUrl:c.urlAfterRedirects});let l=new W0(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(i.currentRawUrl)){let{id:c,extractedUrl:l,source:u,restoredState:d,extras:h}=i,p=new of(c,this.urlSerializer.serialize(l),u,d);this.events.next(p);let m=GB(this.rootComponentType).snapshot;return this.currentTransition=n=I(v({},i),{targetSnapshot:m,urlAfterRedirects:l,extras:I(v({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=l,Oe(n)}else{let c="";return this.events.next(new Gc(i.id,this.urlSerializer.serialize(i.extractedUrl),c,K0.IgnoredByUrlHandlingStrategy)),i.resolve(!1),jo}}),mn(i=>{let s=new K3(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot);this.events.next(s)}),Xe(i=>(this.currentTransition=n=I(v({},i),{guards:jae(i.targetSnapshot,i.currentSnapshot,this.rootContexts)}),n)),Zae(this.environmentInjector,i=>this.events.next(i)),mn(i=>{if(n.guardsResult=i.guardsResult,i.guardsResult&&typeof i.guardsResult!="boolean")throw i4(this.urlSerializer,i.guardsResult);let s=new W3(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot,!!i.guardsResult);this.events.next(s)}),bo(i=>i.guardsResult?!0:(this.cancelNavigationTransition(i,"",Ao.GuardRejected),!1)),VI(i=>{if(i.guards.canActivateChecks.length!==0)return Oe(i).pipe(mn(s=>{let a=new G3(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),Jn(s=>{let a=!1;return Oe(s).pipe(Sce(this.paramsInheritanceStrategy,this.environmentInjector),mn({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",Ao.NoDataFromResolver)}}))}),mn(s=>{let a=new Y3(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),VI(i=>{let s=a=>{let c=[];a.routeConfig?.loadComponent&&!a.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(a.routeConfig).pipe(mn(l=>{a.component=l}),Xe(()=>{})));for(let l of a.children)c.push(...s(l));return c};return ab(s(i.targetSnapshot.root)).pipe(Ul(null),kc(1))}),VI(()=>this.afterPreactivation()),Jn(()=>{let{currentSnapshot:i,targetSnapshot:s}=n,a=this.createViewTransition?.(this.environmentInjector,i.root,s.root);return a?hr(a).pipe(Xe(()=>n)):Oe(n)}),Xe(i=>{let s=Lae(t.routeReuseStrategy,i.targetSnapshot,i.currentRouterState);return this.currentTransition=n=I(v({},i),{targetRouterState:s}),this.currentNavigation.targetRouterState=s,n}),mn(()=>{this.events.next(new G0)}),Vae(this.rootContexts,t.routeReuseStrategy,i=>this.events.next(i),this.inputBindingEnabled),kc(1),Nc(new pt(i=>{let s=n.abortController.signal,a=()=>i.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(bo(()=>!o&&!n.targetRouterState),mn(()=>{this.cancelNavigationTransition(n,n.abortController.signal.reason+"",Ao.Aborted)}))),mn({next:i=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new zs(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects))),this.titleStrategy?.updateTitle(i.targetRouterState.snapshot),i.resolve(!0)},complete:()=>{o=!0}}),Nc(this.transitionAbortWithErrorSubject.pipe(mn(i=>{throw i}))),Ad(()=>{o||this.cancelNavigationTransition(n,"",Ao.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),ln(i=>{if(this.destroyed)return n.resolve(!1),jo;if(o=!0,eU(i))this.events.next(new $a(n.id,this.urlSerializer.serialize(n.extractedUrl),i.message,i.cancellationCode)),Uae(i)?this.events.next(new tm(i.url,i.navigationBehaviorOptions)):n.resolve(!1);else{let s=new em(n.id,this.urlSerializer.serialize(n.extractedUrl),i,n.targetSnapshot??void 0);try{let a=So(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof rm){let{message:c,cancellationCode:l}=i4(this.urlSerializer,a);this.events.next(new $a(n.id,this.urlSerializer.serialize(n.extractedUrl),c,l)),this.events.next(new tm(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),i}catch(a){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(a)}}return jo}))}))}cancelNavigationTransition(t,n,o){let i=new $a(t.id,this.urlSerializer.serialize(t.extractedUrl),n,o);this.events.next(i),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==n?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Tce(r){return r!==$0}var pU=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(Pce),providedIn:"root"})}return r})(),a4=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},Pce=(()=>{class r extends a4{static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),hU=(()=>{class r{urlSerializer=oe(ty);options=oe(sm,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=oe(qh);urlHandlingStrategy=oe(u4);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new za;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:n,targetBrowserUrl:o}){let i=t!==void 0?this.urlHandlingStrategy.merge(t,n):n,s=o??i;return s instanceof za?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:t,finalUrl:n,initialUrl:o}){n&&t?(this.currentUrlTree=n,this.rawUrlTree=this.urlHandlingStrategy.merge(n,o),this.routerState=t):this.rawUrlTree=o}routerState=GB(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:()=>oe(Mce),providedIn:"root"})}return r})(),Mce=(()=>{class r extends hU{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(n=>{n.type==="popstate"&&setTimeout(()=>{t(n.url,n.state,"popstate")})})}handleRouterEvent(t,n){t instanceof of?this.updateStateMemento():t instanceof Gc?this.commitTransition(n):t instanceof W0?this.urlUpdateStrategy==="eager"&&(n.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof G0?(this.commitTransition(n),this.urlUpdateStrategy==="deferred"&&!n.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof $a&&t.code!==Ao.SupersededByNewNavigation&&t.code!==Ao.Redirect?this.restoreHistory(n):t instanceof em?this.restoreHistory(n,!0):t instanceof zs&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:n,id:o}){let{replaceUrl:i,state:s}=n;if(this.location.isCurrentPathEqualTo(t)||i){let a=this.browserPageId,c=v(v({},s),this.generateNgRouterState(o,a));this.location.replaceState(t,"",c)}else{let a=v(v({},s),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(t,"",a)}}restoreHistory(t,n=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.getCurrentUrlTree()===t.finalUrl&&i===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(n&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,n){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function i9(r,e){r.events.pipe(bo(t=>t instanceof zs||t instanceof $a||t instanceof em||t instanceof Gc),Xe(t=>t instanceof zs||t instanceof Gc?0:(t instanceof $a?t.code===Ao.Redirect||t.code===Ao.SupersededByNewNavigation:!1)?2:1),bo(t=>t!==2),kc(1)).subscribe(()=>{e()})}var kce={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Rce={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},su=(()=>{class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=oe(eI);stateManager=oe(hU);options=oe(sm,{optional:!0})||{};pendingTasks=oe(Vc);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=oe(fU);urlSerializer=oe(ty);location=oe(qh);urlHandlingStrategy=oe(u4);injector=oe(zr);_events=new Ht;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=oe(pU);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=oe(iy,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!oe(c4,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Cr;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(n=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(n,i),n instanceof $a&&n.code!==Ao.Redirect&&n.code!==Ao.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof zs)this.navigated=!0;else if(n instanceof tm){let s=n.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(n.url,o.currentRawUrl),c=v({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Tce(o.source)},s);this.scheduleNavigation(a,$0,null,c,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}kae(n)&&this._events.next(n)}catch(o){this.navigationTransitions.transitionAbortWithErrorSubject.next(o)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),$0,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,n,o)=>{this.navigateToSyncWithBrowser(t,o,n)})}navigateToSyncWithBrowser(t,n,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let c=v({},o);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(i.state=c)}let a=this.parseUrl(t);this.scheduleNavigation(a,n,s,i).catch(c=>{this.injector.get(Io)(c)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(n9),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,n={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:c}=n,l=c?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=v(v({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let h=o?o.snapshot:this.routerState.snapshot.root;d=zB(h)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),d=this.currentUrlTree.root}return qB(d,t,u,l??null)}navigateByUrl(t,n={skipLocationChange:!1}){let o=iu(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,$0,null,n)}navigate(t,n={skipLocationChange:!1}){return Nce(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,n){let o;if(n===!0?o=v({},kce):n===!1?o=v({},Rce):o=n,iu(t))return CB(this.currentUrlTree,t,o);let i=this.parseUrl(t);return CB(this.currentUrlTree,i,o)}removeEmptyProps(t){return Object.entries(t).reduce((n,[o,i])=>(i!=null&&(n[o]=i),n),{})}scheduleNavigation(t,n,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,c,l;s?(a=s.resolve,c=s.reject,l=s.promise):l=new Promise((d,h)=>{a=d,c=h});let u=this.pendingTasks.add();return i9(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Nce(r){for(let e=0;e<r.length;e++)if(r[e]==null)throw new be(4008,!1)}var qa=(()=>{class r{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Xl(null);get href(){return js(this.reactiveHref)}set href(t){this.reactiveHref.set(t)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Ht;applicationErrorHandler=oe(Io);options=oe(sm,{optional:!0});constructor(t,n,o,i,s,a){this.router=t,this.route=n,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a,this.reactiveHref.set(oe(new b3("href"),{optional:!0}));let c=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area"||!!(typeof customElements=="object"&&customElements.get(c)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let t=this.preserveFragment,n=o=>o==="merge"||o==="preserve";t||=n(this.queryParamsHandling),t||=!this.queryParamsHandling&&!n(this.options?.defaultQueryParamsHandling),t&&(this.subscription=this.router.events.subscribe(o=>{o instanceof zs&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(iu(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,n,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||n||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,c)?.catch(l=>{this.applicationErrorHandler(l)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.reactiveHref.set(t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t))??"":null)}applyAttributeValue(t,n){let o=this.renderer,i=this.el.nativeElement;n!==null?o.setAttribute(i,t,n):o.removeAttribute(i,t)}get urlTree(){return this.routerLinkInput===null?null:iu(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(n){return new(n||r)(ye(su),ye(Yc),m0("tabindex"),ye(rs),ye(ro),ye(zh))};static \u0275dir=Qt({type:r,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(n,o){n&1&&Ge("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),n&2&&Kd("href",o.reactiveHref(),M7)("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",$h],skipLocationChange:[2,"skipLocationChange","skipLocationChange",$h],replaceUrl:[2,"replaceUrl","replaceUrl",$h],routerLink:"routerLink"},features:[Ua]})}return r})(),s9=(()=>{class r{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new Bt;constructor(t,n,o,i,s){this.router=t,this.element=n,this.renderer=o,this.cdr=i,this.link=s,this.routerEventsSubscription=t.events.subscribe(a=>{a instanceof zs&&this.update()})}ngAfterContentInit(){Oe(this.links.changes,Oe(null)).pipe(Ah()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let t=[...this.links.toArray(),this.link].filter(n=>!!n).map(n=>n.onChanges);this.linkInputChangesSubscription=hr(t).pipe(Ah()).subscribe(n=>{this._isActive!==this.isLinkActive(this.router)(n)&&this.update()})}set routerLinkActive(t){let n=Array.isArray(t)?t:t.split(" ");this.classes=n.filter(o=>!!o)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let t=this.hasActiveLinks();this.classes.forEach(n=>{t?this.renderer.addClass(this.element.nativeElement,n):this.renderer.removeClass(this.element.nativeElement,n)}),t&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){let n=Lce(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return o=>{let i=o.urlTree;return i?t.isActive(i,n):!1}}hasActiveLinks(){let t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static \u0275fac=function(n){return new(n||r)(ye(su),ye(ro),ye(rs),ye(Gd),ye(qa,8))};static \u0275dir=Qt({type:r,selectors:[["","routerLinkActive",""]],contentQueries:function(n,o,i){if(n&1&&oI(i,qa,5),n&2){let s;iI(s=sI())&&(o.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Ua]})}return r})();function Lce(r){return!!r.paths}var Fce=new Ce("");function a9(r,...e){return Bc([{provide:iy,multi:!0,useValue:r},[],{provide:Yc,useFactory:Bce,deps:[su]},{provide:y3,multi:!0,useFactory:Uce},e.map(t=>t.\u0275providers)])}function Bce(r){return r.routerState.root}function Uce(){let r=oe(Yi);return e=>{let t=r.get(qd);if(e!==t.components[0])return;let n=r.get(su),o=r.get(Vce);r.get(jce)===1&&n.initialNavigation(),r.get(Hce,null,{optional:!0})?.setUpPreloading(),r.get(Fce,null,{optional:!0})?.init(),n.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var Vce=new Ce("",{factory:()=>new Ht}),jce=new Ce("",{providedIn:"root",factory:()=>1});var Hce=new Ce("");var ss=new Ce("storage.provider"),au=(o=>(o.IN_MEMORY="in-memory",o.INDEXED_DB="indexed-db",o.IPFS="ipfs",o.HELIA="helia",o))(au||{});function mU(r,e,t,n,o="in-memory"){switch(o){case"indexed-db":return e;case"ipfs":return t;case"helia":return n;case"in-memory":default:return r}}var qs=new Ce("storage.type");function gU(){if(typeof window<"u"){let r=localStorage.getItem("cas-storage-type");if(r==="indexed-db"||r==="ipfs"||r==="helia"||r==="in-memory")return r;if("indexedDB"in window)return"indexed-db"}return"in-memory"}function zce(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne(3);R(),He(t.getHealthyMessage())}}function qce(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne(3);R(),He(t.errorMessage)}}function Kce(r,e){if(r&1&&(_(0,"div",6),Ke(1,zce,2,1,"p",7)(2,qce,2,1,"p",7),E()),r&2){let t=ne(2);R(),re("ngIf",t.isConnected),R(),re("ngIf",!t.isConnected&&t.errorMessage)}}function Wce(r,e){if(r&1&&(_(0,"div",1)(1,"div",2),Wr(2,"span",3),_(3,"span",4),C(4),E()(),Ke(5,Kce,3,2,"div",5),E()),r&2){let t=ne();R(),Ko("connected",t.isConnected)("disconnected",!t.isConnected),R(3),He(t.getStatusText()),R(),re("ngIf",t.showDetails)}}var am=class r{constructor(e,t){this.storageType=e;this.storageProvider=t}StorageType=au;isConnected=!1;showDetails=!1;errorMessage="";destroy$=new Ht;checkInterval=3e4;ngOnInit(){(this.storageType==="ipfs"||this.storageType==="helia")&&(this.checkConnection(),B_(0,this.checkInterval).pipe(Nc(this.destroy$),Jn(()=>this.checkProviderHealth()),ln(e=>(this.errorMessage=e.message||"Connection failed",Oe(!1)))).subscribe(e=>{this.isConnected=e,e&&(this.errorMessage="")}))}checkProviderHealth(){return f(this,null,function*(){return"isHealthy"in this.storageProvider&&typeof this.storageProvider.isHealthy=="function"?yield this.storageProvider.isHealthy():!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}checkConnection(){return f(this,null,function*(){try{this.isConnected=yield this.checkProviderHealth(),this.isConnected&&(this.errorMessage="")}catch(e){this.isConnected=!1,this.errorMessage=e instanceof Error?e.message:"Connection failed"}})}toggleDetails(){this.showDetails=!this.showDetails}getStatusText(){return this.storageType==="ipfs"?`IPFS: ${this.isConnected?"Connected":"Disconnected"}`:this.storageType==="helia"?`Helia: ${this.isConnected?"Active":"Inactive"}`:""}getHealthyMessage(){return this.storageType==="ipfs"?"Node is healthy":this.storageType==="helia"?"Browser IPFS is running":""}static \u0275fac=function(t){return new(t||r)(ye(qs),ye(ss))};static \u0275cmp=mr({type:r,selectors:[["app-ipfs-status-indicator"]],decls:1,vars:1,consts:[["class","ipfs-status",4,"ngIf"],[1,"ipfs-status"],[1,"status-indicator"],[1,"status-dot"],[1,"status-text"],["class","status-details",4,"ngIf"],[1,"status-details"],[4,"ngIf"]],template:function(t,n){t&1&&Ke(0,Wce,6,6,"div",0),t&2&&re("ngIf",n.storageType===n.StorageType.IPFS||n.storageType===n.StorageType.HELIA)},dependencies:[vr,Pn],styles:[".ipfs-status[_ngcontent-%COMP%]{display:inline-block;padding:8px 12px;background-color:#f0f0f0;border-radius:4px;font-size:14px}.status-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer}.status-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;transition:background-color .3s}.connected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background-color:#27ae60;animation:_ngcontent-%COMP%_pulse 2s infinite}.disconnected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background-color:#e74c3c}.status-text[_ngcontent-%COMP%]{font-weight:500}.connected[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{color:#27ae60}.disconnected[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{color:#e74c3c}.status-details[_ngcontent-%COMP%]{margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:12px;color:#666}.status-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #27ae6066}70%{box-shadow:0 0 0 10px #27ae6000}to{box-shadow:0 0 #27ae6000}}"]})};var d4=class r{coverageData={statements:73.81,branches:53.1,functions:83.13,lines:75.5};getCoverageData(){return Oe(this.coverageData)}getStatementsCoverage(){return this.coverageData.statements}getFormattedStatementsCoverage(){return`${this.coverageData.statements}%`}static \u0275fac=function(t){return new(t||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var sy=class r{constructor(e){this.coverageService=e}coveragePercentage="0%";ngOnInit(){this.coveragePercentage=this.coverageService.getFormattedStatementsCoverage()}static \u0275fac=function(t){return new(t||r)(ye(d4))};static \u0275cmp=mr({type:r,selectors:[["app-home"]],decls:195,vars:1,consts:[[1,"home-container"],[1,"ai-hive-disclaimer-top"],[1,"ai-built"],["href","https://o2.services","target","_blank","rel","noopener",1,"ai-link"],[1,"ai-description"],[1,"hero-section"],[1,"hero-header"],[1,"hero-title"],[1,"hero-subtitle"],[1,"hero-actions"],["href","https://github.com/o2alexanderfedin/angular-cas-disot","target","_blank","rel","noopener",1,"hero-button","primary"],[1,"button-icon"],["href","/angular-cas-disot/coverage/cas-app/","target","_blank","rel","noopener",1,"hero-button","secondary"],[1,"intro-section"],[1,"intro-card"],[1,"key-features"],[1,"feature"],[1,"feature-icon"],[1,"how-it-works"],[1,"workflow-grid"],[1,"workflow-step"],[1,"step-number"],["routerLink","/content/upload",1,"action-button"],["routerLink","/disot/create",1,"action-button"],["routerLink","/disot/verify",1,"action-button"],[1,"use-cases"],[1,"use-case-grid"],[1,"use-case-card"],[1,"technical-section"],[1,"tech-grid"],[1,"tech-card"],["href","/angular-cas-disot/coverage/cas-app/","target","_blank","rel","noopener"],[1,"getting-started"],[1,"steps-container"],[1,"step-card"],["routerLink","/settings"],["routerLink","/content/upload"],["routerLink","/disot/create"],[1,"home-footer"],["href","https://github.com/o2alexanderfedin/angular-cas-disot","target","_blank","rel","noopener"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"div",1)(2,"p",2),C(3," Built with "),_(4,"a",3),C(5,"O2.services AI Hive"),E()(),_(6,"p",4),C(7," AI Hive is a dynamic swarm of AI agents that transform customer requirements into shipped products, handling every phase of the software engineering lifecycle. "),E()(),_(8,"header",5)(9,"div",6)(10,"h1",7),C(11,"CAS/DISOT System"),E(),Wr(12,"app-ipfs-status-indicator"),E(),_(13,"p",8),C(14,"Content Addressable Storage with Decentralized Immutable Source of Truth"),E(),_(15,"div",9)(16,"a",10)(17,"span",11),C(18,"\u{1F4C1}"),E(),C(19," View Source Code "),E(),_(20,"a",12)(21,"span",11),C(22,"\u{1F4CA}"),E(),C(23),E()()(),_(24,"section",13)(25,"div",14)(26,"h2"),C(27,"What is CAS/DISOT?"),E(),_(28,"p"),C(29," CAS/DISOT is a decentralized content management system that combines content-addressable storage (CAS) with cryptographic signatures to create an immutable source of truth (DISOT). "),E(),_(30,"div",15)(31,"div",16)(32,"span",17),C(33,"\u{1F510}"),E(),_(34,"strong"),C(35,"Content Addressing:"),E(),C(36," Files are stored and retrieved using their SHA-256 hash "),E(),_(37,"div",16)(38,"span",17),C(39,"\u270D\uFE0F"),E(),_(40,"strong"),C(41,"Digital Signatures:"),E(),C(42," Create signed entries that prove authorship and timestamp "),E(),_(43,"div",16)(44,"span",17),C(45,"\u{1F50D}"),E(),_(46,"strong"),C(47,"Verification:"),E(),C(48," Verify the integrity and authenticity of any content "),E()()()(),_(49,"section",18)(50,"h2"),C(51,"How It Works"),E(),_(52,"div",19)(53,"div",20)(54,"div",21),C(55,"1"),E(),_(56,"h3"),C(57,"Upload Content"),E(),_(58,"p"),C(59,"Upload any file to the system. It will be hashed using SHA-256 and stored by its content hash."),E(),_(60,"button",22),C(61,"Upload Files"),E()(),_(62,"div",20)(63,"div",21),C(64,"2"),E(),_(65,"h3"),C(66,"Create DISOT Entry"),E(),_(67,"p"),C(68,"Sign your content with a cryptographic key to create a timestamped, verifiable entry."),E(),_(69,"button",23),C(70,"Create Entry"),E()(),_(71,"div",20)(72,"div",21),C(73,"3"),E(),_(74,"h3"),C(75,"Share & Verify"),E(),_(76,"p"),C(77,"Share your signed entries. Anyone can verify the authenticity and timestamp of your content."),E(),_(78,"button",24),C(79,"Verify Entries"),E()()()(),_(80,"section",25)(81,"h2"),C(82,"Use Cases"),E(),_(83,"div",26)(84,"div",27)(85,"h3"),C(86,"\u{1F4DD} Blog Posts"),E(),_(87,"p"),C(88,"Create immutable blog posts with verified authorship and timestamps"),E()(),_(89,"div",27)(90,"h3"),C(91,"\u{1F4C4} Documents"),E(),_(92,"p"),C(93,"Store important documents with cryptographic proof of existence"),E()(),_(94,"div",27)(95,"h3"),C(96,"\u{1F5BC}\uFE0F Digital Art"),E(),_(97,"p"),C(98,"Prove ownership and creation date of digital artwork"),E()(),_(99,"div",27)(100,"h3"),C(101,"\u{1F4CA} Research Data"),E(),_(102,"p"),C(103,"Create verifiable research data with immutable timestamps"),E()()()(),_(104,"section",28)(105,"h2"),C(106,"Technical Details"),E(),_(107,"div",29)(108,"div",30)(109,"h3"),C(110,"Content Addressing"),E(),_(111,"ul")(112,"li"),C(113,"SHA-256 hashing ensures unique content identification"),E(),_(114,"li"),C(115,"Automatic deduplication - identical files share the same hash"),E(),_(116,"li"),C(117,"Content integrity verification built-in"),E()()(),_(118,"div",30)(119,"h3"),C(120,"Storage Options"),E(),_(121,"ul")(122,"li")(123,"strong"),C(124,"In-Memory:"),E(),C(125," Fast temporary storage (default)"),E(),_(126,"li")(127,"strong"),C(128,"IndexedDB:"),E(),C(129," Persistent browser storage"),E(),_(130,"li")(131,"strong"),C(132,"IPFS:"),E(),C(133," Distributed storage network"),E(),_(134,"li")(135,"strong"),C(136,"Helia:"),E(),C(137," Browser-native IPFS implementation"),E()()(),_(138,"div",30)(139,"h3"),C(140,"Cryptography"),E(),_(141,"ul")(142,"li"),C(143,"secp256k1 key pairs for digital signatures"),E(),_(144,"li"),C(145,"Timestamp included in signed entries"),E(),_(146,"li"),C(147,"Signature verification for authenticity"),E()()(),_(148,"div",30)(149,"h3"),C(150,"Quality & Testing"),E(),_(151,"ul")(152,"li"),C(153,"402 unit tests ensuring reliability"),E(),_(154,"li"),C(155,"Test-driven development approach"),E(),_(156,"li")(157,"a",31),C(158,"\u{1F4CA} View Code Coverage"),E()()()()()(),_(159,"section",32)(160,"h2"),C(161,"Getting Started"),E(),_(162,"div",33)(163,"div",34)(164,"h3"),C(165,"Step 1: Configure Storage"),E(),_(166,"p"),C(167,"Go to "),_(168,"a",35),C(169,"Settings"),E(),C(170," and choose your preferred storage provider."),E()(),_(171,"div",34)(172,"h3"),C(173,"Step 2: Upload Content"),E(),_(174,"p"),C(175,"Upload files through the "),_(176,"a",36),C(177,"Upload page"),E(),C(178," or drag & drop interface."),E()(),_(179,"div",34)(180,"h3"),C(181,"Step 3: Create Entries"),E(),_(182,"p"),C(183,"Sign your content with "),_(184,"a",37),C(185,"DISOT entries"),E(),C(186," for verifiable authorship."),E()()()(),_(187,"footer",38)(188,"p"),C(189," CAS/DISOT is an open-source project. "),_(190,"a",39),C(191," View on GitHub "),E(),C(192," | "),_(193,"a",31),C(194," \u{1F4CA} Coverage Report "),E()()()()),t&2&&(R(23),rt(" Code Coverage (",n.coveragePercentage,") "))},dependencies:[qa,am],styles:['@charset "UTF-8";.home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.ai-hive-disclaimer-top[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;padding:2rem;border-radius:1rem;margin-bottom:2rem;text-align:center;box-shadow:0 10px 30px #8b5cf64d;position:relative;overflow:hidden}.ai-hive-disclaimer-top[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.1) 50%,transparent 70%);animation:_ngcontent-%COMP%_shimmer 3s infinite}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-built[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1.4rem;font-weight:600;position:relative;z-index:1}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-description[_ngcontent-%COMP%]{margin:0 auto;font-size:1rem;line-height:1.6;max-width:700px;opacity:.95;position:relative;z-index:1}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]{color:#fff;font-weight:700;text-decoration:none;border-bottom:2px solid rgba(255,255,255,.5);transition:all .3s ease}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]:after{content:"\\2728";margin-left:.5rem;display:inline-block;animation:_ngcontent-%COMP%_sparkle 2s ease-in-out infinite;font-size:1.2em}.ai-hive-disclaimer-top[_ngcontent-%COMP%]   .ai-link[_ngcontent-%COMP%]:hover{border-bottom-color:#fff;text-shadow:0 0 20px rgba(255,255,255,.8)}@keyframes _ngcontent-%COMP%_shimmer{0%{transform:translate(-100%) translateY(-100%) rotate(45deg)}to{transform:translate(100%) translateY(100%) rotate(45deg)}}.hero-section[_ngcontent-%COMP%]{text-align:center;padding:3rem 0;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:1rem;margin-bottom:3rem}.hero-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:2rem;flex-wrap:wrap;margin-bottom:1rem}.hero-title[_ngcontent-%COMP%]{font-size:3rem;font-weight:700;margin:0}.hero-subtitle[_ngcontent-%COMP%]{font-size:1.25rem;opacity:.9;margin-bottom:2rem}.hero-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}.hero-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;font-size:1rem;transition:all .2s ease;border:2px solid transparent}.hero-button[_ngcontent-%COMP%]   .button-icon[_ngcontent-%COMP%]{font-size:1.1rem}.hero-button.primary[_ngcontent-%COMP%]{background:#ffffff26;color:#fff;border-color:#ffffff4d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.hero-button.primary[_ngcontent-%COMP%]:hover{background:#ffffff40;border-color:#ffffff80;transform:translateY(-2px)}.hero-button.secondary[_ngcontent-%COMP%]{background:#ffffffe6;color:#667eea;border-color:#ffffffe6}.hero-button.secondary[_ngcontent-%COMP%]:hover{background:#fff;color:#5a67d8;transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.intro-section[_ngcontent-%COMP%]{margin-bottom:3rem}.intro-card[_ngcontent-%COMP%]{background:#f8f9fa;padding:2rem;border-radius:.5rem;box-shadow:0 2px 4px #0000001a}.intro-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}.intro-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.6;color:#555;margin-bottom:1.5rem}.key-features[_ngcontent-%COMP%]{display:grid;gap:1rem}@media (min-width: 768px){.key-features[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.feature[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem}.feature[_ngcontent-%COMP%]   .feature-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.feature[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;color:#333}.how-it-works[_ngcontent-%COMP%]{margin-bottom:3rem}.how-it-works[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.workflow-grid[_ngcontent-%COMP%]{display:grid;gap:2rem}@media (min-width: 768px){.workflow-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.workflow-step[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#fff;border-radius:.5rem;box-shadow:0 2px 8px #0000001a;transition:transform .2s}.workflow-step[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.workflow-step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:50px;height:50px;background:#667eea;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.workflow-step[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:1rem}.workflow-step[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin-bottom:1.5rem;line-height:1.6}.action-button[_ngcontent-%COMP%]{background:#667eea;color:#fff;border:none;padding:.75rem 1.5rem;border-radius:.25rem;cursor:pointer;font-size:1rem;transition:background .2s}.action-button[_ngcontent-%COMP%]:hover{background:#5a67d8}.use-cases[_ngcontent-%COMP%]{margin-bottom:3rem}.use-cases[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.use-case-grid[_ngcontent-%COMP%]{display:grid;gap:1.5rem}@media (min-width: 768px){.use-case-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.use-case-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}}.use-case-card[_ngcontent-%COMP%]{background:#f8f9fa;padding:1.5rem;border-radius:.5rem;text-align:center}.use-case-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem;font-size:1.1rem}.use-case-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:.9rem;line-height:1.5}.technical-section[_ngcontent-%COMP%]{margin-bottom:3rem}.technical-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.tech-grid[_ngcontent-%COMP%]{display:grid;gap:2rem}@media (min-width: 768px){.tech-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.tech-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:.5rem;box-shadow:0 2px 4px #0000001a}.tech-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#667eea;margin-bottom:1rem}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding-left:1.5rem;position:relative;margin-bottom:.5rem;color:#666;line-height:1.5}.tech-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:"\\2022";color:#667eea;position:absolute;left:.5rem}.getting-started[_ngcontent-%COMP%]{margin-bottom:3rem}.getting-started[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#333}.steps-container[_ngcontent-%COMP%]{display:grid;gap:1.5rem}@media (min-width: 768px){.steps-container[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.step-card[_ngcontent-%COMP%]{background:#e9ecef;padding:1.5rem;border-radius:.5rem;border-left:4px solid #667eea}.step-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem}.step-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;line-height:1.5}.step-card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:500}.step-card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.home-footer[_ngcontent-%COMP%]{text-align:center;padding:2rem;border-top:1px solid #e9ecef;margin-top:3rem}.home-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666}.home-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:500}.home-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}@keyframes _ngcontent-%COMP%_sparkle{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}']})};var IU=(()=>{class r{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||r)(ye(rs),ye(ro))};static \u0275dir=Qt({type:r})}return r})(),fm=(()=>{class r extends IU{static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,features:[qo]})}return r})(),sf=new Ce(""),Yce={provide:sf,useExisting:$o(()=>f9),multi:!0},f9=(()=>{class r extends fm{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,o){n&1&&Ge("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Us([Yce]),qo]})}return r})(),Xce={provide:sf,useExisting:$o(()=>as),multi:!0};function Qce(){let r=os()?os().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var Zce=new Ce(""),as=(()=>{class r extends IU{_compositionMode;_composing=!1;constructor(t,n,o){super(t,n),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Qce())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||r)(ye(rs),ye(ro),ye(Zce,8))};static \u0275dir=Qt({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){n&1&&Ge("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Us([Xce]),qo]})}return r})();var p9=new Ce(""),Jce=new Ce("");function ele(r){return e=>{if(e.value==null||r==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}function tle(r){return e=>{if(e.value==null||r==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}function yU(r){return null}function AU(r){return r!=null}function DU(r){return eu(r)?hr(r):r}function TU(r){let e={};return r.forEach(t=>{e=t!=null?v(v({},e),t):e}),Object.keys(e).length===0?null:e}function PU(r,e){return e.map(t=>t(r))}function rle(r){return!r.validate}function MU(r){return r.map(e=>rle(e)?e:t=>e.validate(t))}function nle(r){if(!r)return null;let e=r.filter(AU);return e.length==0?null:function(t){return TU(PU(t,e))}}function kU(r){return r!=null?nle(MU(r)):null}function ole(r){if(!r)return null;let e=r.filter(AU);return e.length==0?null:function(t){let n=PU(t,e).map(DU);return F_(n).pipe(Xe(TU))}}function RU(r){return r!=null?ole(MU(r)):null}function vU(r,e){return r===null?[e]:Array.isArray(r)?[...r,e]:[r,e]}function ile(r){return r._rawValidators}function sle(r){return r._rawAsyncValidators}function c9(r){return r?Array.isArray(r)?r:[r]:[]}function p4(r,e){return Array.isArray(r)?r.includes(e):r===e}function wU(r,e){let t=c9(e);return c9(r).forEach(o=>{p4(t,o)||t.push(o)}),t}function bU(r,e){return c9(e).filter(t=>!p4(r,t))}var h4=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=kU(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=RU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},l9=class extends h4{name;get formDirective(){return null}get path(){return null}},um=class extends h4{_parent=null;name=null;valueAccessor=null},u9=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},ale={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},mke=I(v({},ale),{"[class.ng-submitted]":"isSubmitted"}),Ka=(()=>{class r extends u9{constructor(t){super(t)}static \u0275fac=function(n){return new(n||r)(ye(um,2))};static \u0275dir=Qt({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){n&2&&Ko("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[qo]})}return r})();var ay="VALID",f4="INVALID",cm="PENDING",cy="DISABLED",dm=class{},m4=class extends dm{value;source;constructor(e,t){super(),this.value=e,this.source=t}},ly=class extends dm{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},uy=class extends dm{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},lm=class extends dm{status;source;constructor(e,t){super(),this.status=e,this.source=t}};function cle(r){return(g4(r)?r.validators:r)||null}function lle(r){return Array.isArray(r)?kU(r):r||null}function ule(r,e){return(g4(e)?e.asyncValidators:r)||null}function dle(r){return Array.isArray(r)?RU(r):r||null}function g4(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}var d9=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return js(this.statusReactive)}set status(e){js(()=>this.statusReactive.set(e))}_status=_0(()=>this.statusReactive());statusReactive=Xl(void 0);get valid(){return this.status===ay}get invalid(){return this.status===f4}get pending(){return this.status==cm}get disabled(){return this.status===cy}get enabled(){return this.status!==cy}errors;get pristine(){return js(this.pristineReactive)}set pristine(e){js(()=>this.pristineReactive.set(e))}_pristine=_0(()=>this.pristineReactive());pristineReactive=Xl(!0);get dirty(){return!this.pristine}get touched(){return js(this.touchedReactive)}set touched(e){js(()=>this.touchedReactive.set(e))}_touched=_0(()=>this.touchedReactive());touchedReactive=Xl(!1);get untouched(){return!this.touched}_events=new Ht;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(wU(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(wU(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(bU(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(bU(e,this._rawAsyncValidators))}hasValidator(e){return p4(this._rawValidators,e)}hasAsyncValidator(e){return p4(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(I(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new uy(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new uy(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(I(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new ly(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new ly(!0,n))}markAsPending(e={}){this.status=cm;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new lm(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(I(v({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=cy,this.errors=null,this._forEachChild(o=>{o.disable(I(v({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new m4(this.value,n)),this._events.next(new lm(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(I(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ay,this._forEachChild(n=>{n.enable(I(v({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(I(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ay||this.status===cm)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new m4(this.value,t)),this._events.next(new lm(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(I(v({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?cy:ay}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=cm,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let n=DU(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,o)=>n&&n._find(o),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new lm(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new Bt,this.statusChanges=new Bt}_calculateStatus(){return this._allControlsDisabled()?cy:this.errors?f4:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(cm)?cm:this._anyControlsHaveStatus(f4)?f4:ay}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new ly(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new uy(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){g4(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=lle(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=dle(this._rawAsyncValidators)}};var h9=new Ce("",{providedIn:"root",factory:()=>y4}),y4="always";function fle(r,e){return[...e.path,r]}function ple(r,e,t=y4){mle(r,e),e.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(r.disabled),gle(r,e),vle(r,e),yle(r,e),hle(r,e)}function EU(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function hle(r,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function mle(r,e){let t=ile(r);e.validator!==null?r.setValidators(vU(t,e.validator)):typeof t=="function"&&r.setValidators([t]);let n=sle(r);e.asyncValidator!==null?r.setAsyncValidators(vU(n,e.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let o=()=>r.updateValueAndValidity();EU(e._rawValidators,o),EU(e._rawAsyncValidators,o)}function gle(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&NU(r,e)})}function yle(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&NU(r,e),r.updateOn!=="submit"&&r.markAsTouched()})}function NU(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function vle(r,e){let t=(n,o)=>{e.valueAccessor.writeValue(n),o&&e.viewToModelUpdate(n)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function wle(r,e){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function ble(r){return Object.getPrototypeOf(r.constructor)===fm}function Ele(r,e){if(!e)return null;Array.isArray(e);let t,n,o;return e.forEach(i=>{i.constructor===as?t=i:ble(i)?n=i:o=i}),o||n||t||null}function xU(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function SU(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var xle=class extends d9{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(cle(t),ule(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),g4(t)&&(t.nonNullable||t.initialValueIsDefault)&&(SU(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){xU(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){xU(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){SU(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Sle={provide:um,useExisting:$o(()=>Ks)},_U=Promise.resolve(),Ks=(()=>{class r extends um{_changeDetectorRef;callSetDisabledState;control=new xle;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Bt;constructor(t,n,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=t,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=Ele(this,i)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),wle(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){ple(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){_U.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,o=n!==0&&$h(n);_U.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?fle(t,this._parent):[t]}static \u0275fac=function(n){return new(n||r)(ye(l9,9),ye(p9,10),ye(Jce,10),ye(sf,10),ye(Gd,8),ye(h9,8))};static \u0275dir=Qt({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Us([Sle]),qo,Ua]})}return r})();var _le={provide:sf,useExisting:$o(()=>m9),multi:!0},m9=(()=>{class r extends fm{writeValue(t){let n=t??"";this.setProperty("value",n)}registerOnChange(t){this.onChange=n=>{t(n==""?null:parseFloat(n))}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,o){n&1&&Ge("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Us([_le]),qo]})}return r})(),Cle={provide:sf,useExisting:$o(()=>g9),multi:!0};var Ile=(()=>{class r{_accessors=[];add(t,n){this._accessors.push([t,n])}remove(t){for(let n=this._accessors.length-1;n>=0;--n)if(this._accessors[n][1]===t){this._accessors.splice(n,1);return}}select(t){this._accessors.forEach(n=>{this._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)})}_isSameGroup(t,n){return t[0].control?t[0]._parent===n._control._parent&&t[1].name===n.name:!1}static \u0275fac=function(n){return new(n||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),g9=(()=>{class r extends fm{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=oe(h9,{optional:!0})??y4;constructor(t,n,o,i){super(t,n),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(um),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this.setProperty("checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}setDisabledState(t){(this.setDisabledStateFired||t||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",t),this.setDisabledStateFired=!0}fireUncheck(t){this.writeValue(t)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(n){return new(n||r)(ye(rs),ye(ro),ye(Ile),ye(Yi))};static \u0275dir=Qt({type:r,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(n,o){n&1&&Ge("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Us([Cle]),qo]})}return r})();var Ale={provide:sf,useExisting:$o(()=>Wa),multi:!0};function OU(r,e){return r==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${r}: ${e}`.slice(0,50))}function Dle(r){return r.split(":")[0]}var Wa=(()=>{class r extends fm{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let n=this._getOptionId(t),o=OU(n,t);this.setProperty("value",o)}registerOnChange(t){this.onChange=n=>{this.value=this._getOptionValue(n),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),t))return n;return null}_getOptionValue(t){let n=Dle(t);return this._optionMap.has(n)?this._optionMap.get(n):t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,o){n&1&&Ge("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Us([Ale]),qo]})}return r})(),cu=(()=>{class r{_element;_renderer;_select;id;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(OU(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||r)(ye(ro),ye(rs),ye(Wa,9))};static \u0275dir=Qt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return r})(),Tle={provide:sf,useExisting:$o(()=>LU),multi:!0};function CU(r,e){return r==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${r}: ${e}`.slice(0,50))}function Ple(r){return r.split(":")[0]}var LU=(()=>{class r extends fm{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let n;if(Array.isArray(t)){let o=t.map(i=>this._getOptionId(i));n=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else n=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(t){this.onChange=n=>{let o=[],i=n.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let c=s[a],l=this._getOptionValue(c.value);o.push(l)}}else{let s=n.options;for(let a=0;a<s.length;a++){let c=s[a];if(c.selected){let l=this._getOptionValue(c.value);o.push(l)}}}this.value=o,t(o)}}_registerOption(t){let n=(this._idCounter++).toString();return this._optionMap.set(n,t),n}_getOptionId(t){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,t))return n;return null}_getOptionValue(t){let n=Ple(t);return this._optionMap.has(n)?this._optionMap.get(n)._value:t}static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,o){n&1&&Ge("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Us([Tle]),qo]})}return r})(),lu=(()=>{class r{_element;_renderer;_select;id;_value;constructor(t,n,o){this._element=t,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(CU(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(CU(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||r)(ye(ro),ye(rs),ye(LU,9))};static \u0275dir=Qt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return r})();function FU(r){return typeof r=="number"?r:parseFloat(r)}var BU=(()=>{class r{_validator=yU;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let n=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(n),this._validator=this._enabled?this.createValidator(n):yU,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(n){return new(n||r)};static \u0275dir=Qt({type:r,features:[Ua]})}return r})(),Mle={provide:p9,useExisting:$o(()=>y9),multi:!0},y9=(()=>{class r extends BU{max;inputName="max";normalizeInput=t=>FU(t);createValidator=t=>tle(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&Kd("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[Us([Mle]),qo]})}return r})(),kle={provide:p9,useExisting:$o(()=>v9),multi:!0},v9=(()=>{class r extends BU{min;inputName="min";normalizeInput=t=>FU(t);createValidator=t=>ele(t);static \u0275fac=(()=>{let t;return function(o){return(t||(t=ts(r)))(o||r)}})();static \u0275dir=Qt({type:r,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,o){n&2&&Kd("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Us([kle]),qo]})}return r})();var Rle=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=ns({type:r});static \u0275inj=bi({})}return r})();var Do=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:h9,useValue:t.callSetDisabledState??y4}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=ns({type:r});static \u0275inj=bi({imports:[Rle]})}return r})();var pm=class r{hash(e){return f(this,null,function*(){let t=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")})}verify(e,t){return f(this,null,function*(){return(yield this.hash(e))===t})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var cs=class r{constructor(e,t){this.hashService=e;this.storageService=t}store(e){return f(this,null,function*(){let n={algorithm:"sha256",value:yield this.hashService.hash(e.data)},o=this.getPath(n);return(yield this.storageService.exists(o))||(yield this.storageService.write(o,e.data)),n})}retrieve(e){return f(this,null,function*(){let t=this.getPath(e);try{return{data:yield this.storageService.read(t),hash:e}}catch{throw new Error("Content not found")}})}exists(e){return f(this,null,function*(){let t=this.getPath(e);return this.storageService.exists(t)})}getMetadata(e){return f(this,null,function*(){let t=yield this.retrieve(e);return{hash:e,size:t.data.length,createdAt:new Date}})}getAllContent(){return f(this,null,function*(){let e=yield this.storageService.list(),t="cas/",n=e.filter(i=>i.startsWith(t)).map(i=>f(this,null,function*(){try{let s=yield this.storageService.read(i),a=i.split("/");if(a.length>=3){let c=a[1],l=a[2];return{content:{data:s},hash:{algorithm:c,value:l}}}return null}catch(s){return console.error(`Error reading path ${i}:`,s),null}}));return(yield Promise.all(n)).filter(i=>i!==null)})}getPath(e){return`cas/${e.algorithm}/${e.value}`}static \u0275fac=function(t){return new(t||r)(Ee(pm),Ee(ss))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};function Nle(r,e){r&1&&(_(0,"div",11),C(1," Loading content... "),E())}function Ole(r,e){r&1&&(_(0,"div",12)(1,"p"),C(2,"No content found"),E()())}function Lle(r,e){if(r&1&&(_(0,"span"),C(1),E()),r&2){let t=ne().$implicit;R(),rt("\u2022 ",t.metadata.contentType)}}function Fle(r,e){if(r&1&&(_(0,"span",36),C(1),E()),r&2){let t=ne(2).$implicit;R(),rt("(Detected: ",t.detectedType,")")}}function Ble(r,e){if(r&1&&(_(0,"pre"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function Ule(r,e){if(r&1&&(_(0,"code"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function Vle(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function jle(r,e){if(r&1&&Wr(0,"img",37),r&2){let t=ne(2).$implicit;re("src",t.previewData,Jl)}}function Hle(r,e){if(r&1){let t=Gt();_(0,"div",25)(1,"div",26)(2,"label"),C(3,"Preview as: "),E(),_(4,"select",27),yr("ngModelChange",function(o){at(t);let i=ne().$implicit;return Dr(i.previewType,o)||(i.previewType=o),ct(o)}),Ge("change",function(){at(t);let o=ne().$implicit,i=ne();return ct(i.updatePreview(o))}),_(5,"option",28),C(6,"Text"),E(),_(7,"option",29),C(8,"JSON"),E(),_(9,"option",30),C(10,"Hex"),E(),_(11,"option",31),C(12,"Base64"),E(),_(13,"option",32),C(14,"Image"),E()(),Ke(15,Fle,2,1,"span",33),E(),_(16,"div",34),Ke(17,Ble,2,1,"pre",20)(18,Ule,2,1,"code",20)(19,Vle,2,1,"p",20)(20,jle,1,1,"img",35),E()()}if(r&2){let t=ne().$implicit;R(4),gr("ngModel",t.previewType),R(11),re("ngIf",t.detectedType),R(),re("ngClass","preview-"+t.previewType),R(),re("ngIf",t.previewType==="json"),R(),re("ngIf",t.previewType==="hex"||t.previewType==="base64"),R(),re("ngIf",t.previewType==="text"),R(),re("ngIf",t.previewType==="image")}}function $le(r,e){if(r&1){let t=Gt();_(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),C(4),Vs(5,"uppercase"),E(),_(6,"span",17),C(7),E()(),_(8,"div",18)(9,"code"),C(10),E()(),_(11,"div",19)(12,"span"),C(13),Vs(14,"date"),E(),Ke(15,Lle,2,1,"span",20),E()(),Ke(16,Hle,21,7,"div",21),_(17,"div",22)(18,"button",23),Ge("click",function(o){let i=at(t).$implicit;return ne().selectContent(i.hash),ct(o.stopPropagation())}),C(19," Select "),E(),_(20,"button",24),Ge("click",function(o){let i=at(t).$implicit;return ne().togglePreview(i),ct(o.stopPropagation())}),C(21),E()()()}if(r&2){let t=e.$implicit,n=ne();R(4),He(Wd(5,8,t.hash.algorithm)),R(3),He(n.formatFileSize(t.metadata.size||0)),R(3),He(t.hash.value),R(3),He(tu(14,10,t.metadata.createdAt,"short")),R(2),re("ngIf",t.metadata.contentType),R(),re("ngIf",t.previewData),R(4),re("disabled",t.isLoadingPreview),R(),rt(" ",t.isLoadingPreview?"Loading...":t.previewData?"Hide Preview":"Show Preview"," ")}}var hm=class r{constructor(e){this.casService=e;this.loadContent()}contentSelected=new Bt;closed=new Bt;contentItems=[];filteredItems=[];searchTerm="";isLoading=!1;loadContent(){return f(this,null,function*(){this.isLoading=!0;try{let e=yield this.casService.getAllContent();this.contentItems=[];for(let t of e){let n=yield this.casService.getMetadata(t.hash);this.contentItems.push({hash:t.hash,metadata:n,previewData:null,previewType:null,isLoadingPreview:!1})}this.filterContent()}catch(e){console.error("Failed to load content:",e)}finally{this.isLoading=!1}})}filterContent(){if(!this.searchTerm)this.filteredItems=[...this.contentItems];else{let e=this.searchTerm.toLowerCase();this.filteredItems=this.contentItems.filter(t=>t.hash.value.toLowerCase().includes(e))}}selectContent(e){this.contentSelected.emit(e),this.close()}close(){this.closed.emit()}togglePreview(e){return f(this,null,function*(){e.previewData?(e.previewData=null,e.previewType=null,e.detectedType=void 0):yield this.loadPreview(e)})}loadPreview(e){return f(this,null,function*(){if(!e.isLoadingPreview){e.isLoadingPreview=!0;try{let t=yield this.casService.retrieve(e.hash),n=this.detectContentType(t.data);e.detectedType=n,e.previewType=this.getInitialPreviewType(n,t.data),this.updatePreviewData(e,t.data)}catch(t){console.error("Failed to preview content:",t)}finally{e.isLoadingPreview=!1}}})}detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updatePreview(e){e.previewData&&this.casService.retrieve(e.hash).then(t=>{this.updatePreviewData(e,t.data)}).catch(t=>{console.error("Failed to update preview:",t)})}updatePreviewData(e,t){switch(e.previewType){case"text":try{let c=new TextDecoder().decode(t);e.previewData=c.length>1e3?c.substring(0,1e3)+"...":c}catch{e.previewData="Unable to decode as text"}break;case"json":try{let c=new TextDecoder().decode(t),l=JSON.parse(c);e.previewData=JSON.stringify(l,null,2),e.previewData.length>1e3&&(e.previewData=e.previewData.substring(0,1e3)+"...")}catch{e.previewData="Invalid JSON"}break;case"hex":let o=Math.min(t.length,256);e.previewData=Array.from(t.slice(0,o)).map(c=>c.toString(16).padStart(2,"0")).join(" ").toUpperCase(),t.length>o&&(e.previewData+=" ...");break;case"base64":let i=Math.min(t.length,1e3);e.previewData=btoa(String.fromCharCode(...t.slice(0,i))),t.length>i&&(e.previewData+="...");break;case"image":let s=new Blob([t]),a=new FileReader;a.onload=()=>{e.previewData=a.result},a.readAsDataURL(s);break}}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}static \u0275fac=function(t){return new(t||r)(ye(cs))};static \u0275cmp=mr({type:r,selectors:[["app-content-selection-modal"]],outputs:{contentSelected:"contentSelected",closed:"closed"},decls:14,vars:4,consts:[[1,"modal-backdrop",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-button",3,"click"],[1,"modal-body"],[1,"search-bar"],["type","text","placeholder","Search by hash...",1,"search-input",3,"ngModelChange","ngModel"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"content-list"],["class","content-item",4,"ngFor","ngForOf"],[1,"loading"],[1,"empty-state"],[1,"content-item"],[1,"item-clickable"],[1,"item-header"],[1,"algorithm"],[1,"size"],[1,"hash-value"],[1,"metadata"],[4,"ngIf"],["class","preview-section",4,"ngIf"],[1,"item-actions"],[1,"select-button",3,"click"],[1,"preview-button",3,"click","disabled"],[1,"preview-section"],[1,"preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"preview",3,"ngClass"],["alt","Preview",3,"src",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"]],template:function(t,n){t&1&&(_(0,"div",0),Ge("click",function(){return n.close()}),_(1,"div",1),Ge("click",function(i){return i.stopPropagation()}),_(2,"div",2)(3,"h2"),C(4,"Select Content for DISOT Entry"),E(),_(5,"button",3),Ge("click",function(){return n.close()}),C(6,"\xD7"),E()(),_(7,"div",4)(8,"div",5)(9,"input",6),yr("ngModelChange",function(i){return Dr(n.searchTerm,i)||(n.searchTerm=i),i}),Ge("ngModelChange",function(){return n.filterContent()}),E()(),Ke(10,Nle,2,0,"div",7)(11,Ole,3,0,"div",8),_(12,"div",9),Ke(13,$le,22,13,"div",10),E()()()()),t&2&&(R(9),gr("ngModel",n.searchTerm),R(),re("ngIf",n.isLoading),R(),re("ngIf",!n.isLoading&&n.filteredItems.length===0),R(2),re("ngForOf",n.filteredItems))},dependencies:[vr,Yd,ja,Pn,Xd,Qd,Do,cu,lu,as,Wa,Ka,Ks],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;max-width:800px;width:90%;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 4px 20px #00000026}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #e0e0e0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:30px;color:#999;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.close-button[_ngcontent-%COMP%]:hover{color:#333}.modal-body[_ngcontent-%COMP%]{padding:20px;overflow-y:auto;flex:1}.search-bar[_ngcontent-%COMP%]{margin-bottom:20px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.content-list[_ngcontent-%COMP%]{display:grid;gap:10px}.content-item[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;transition:all .2s;background-color:#f9f9f9;overflow:hidden}.item-clickable[_ngcontent-%COMP%]{padding:15px}.content-item[_ngcontent-%COMP%]:hover   .item-clickable[_ngcontent-%COMP%]{background-color:#e3f2fd}.content-item[_ngcontent-%COMP%]:hover{border-color:#2196f3;transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.algorithm[_ngcontent-%COMP%]{font-weight:600;color:#2196f3;font-size:14px}.size[_ngcontent-%COMP%]{color:#666;font-size:14px}.hash-value[_ngcontent-%COMP%]{margin-bottom:8px;padding:8px;background-color:#fff;border-radius:4px;border:1px solid #e0e0e0}.hash-value[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace;font-size:12px;word-break:break-all;color:#333}.metadata[_ngcontent-%COMP%]{font-size:12px;color:#666;display:flex;gap:10px}.preview-section[_ngcontent-%COMP%]{padding:15px;background-color:#f5f5f5;border-top:1px solid #e0e0e0}.preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.preview-type-select[_ngcontent-%COMP%]{padding:5px;border:1px solid #ddd;border-radius:4px;font-size:14px}.detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}.item-actions[_ngcontent-%COMP%]{padding:10px 15px;background-color:#f9f9f9;border-top:1px solid #e0e0e0;display:flex;gap:10px}.select-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background-color .2s}.select-button[_ngcontent-%COMP%]:hover{background-color:#218838}.preview-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .2s}.preview-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.preview-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};var ls=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=ns({type:r});static \u0275inj=bi({imports:[vr,Do,hm,am,vr,Do]})};function qle(r,e){r&1&&(_(0,"div",7),C(1," Loading content... "),E())}function Kle(r,e){r&1&&(_(0,"div",8)(1,"p"),C(2,"No content found"),E()())}function Wle(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne().$implicit;R(),rt("Type: ",t.metadata.contentType)}}function Gle(r,e){if(r&1&&(_(0,"span",30),C(1),E()),r&2){let t=ne(2).$implicit;R(),rt("(Detected: ",t.detectedType,")")}}function Yle(r,e){if(r&1&&(_(0,"pre"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function Xle(r,e){if(r&1&&(_(0,"code"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function Qle(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne(2).$implicit;R(),He(t.previewData)}}function Zle(r,e){if(r&1&&Wr(0,"img",31),r&2){let t=ne(2).$implicit;re("src",t.previewData,Jl)}}function Jle(r,e){if(r&1){let t=Gt();_(0,"div",19)(1,"div",20)(2,"label"),C(3,"Preview as: "),E(),_(4,"select",21),yr("ngModelChange",function(o){at(t);let i=ne().$implicit;return Dr(i.previewType,o)||(i.previewType=o),ct(o)}),Ge("change",function(){at(t);let o=ne().$implicit,i=ne();return ct(i.updatePreview(o))}),_(5,"option",22),C(6,"Text"),E(),_(7,"option",23),C(8,"JSON"),E(),_(9,"option",24),C(10,"Hex"),E(),_(11,"option",25),C(12,"Base64"),E(),_(13,"option",26),C(14,"Image"),E()(),Ke(15,Gle,2,1,"span",27),E(),_(16,"div",28),Ke(17,Yle,2,1,"pre",14)(18,Xle,2,1,"code",14)(19,Qle,2,1,"p",14)(20,Zle,1,1,"img",29),E()()}if(r&2){let t=ne().$implicit;R(4),gr("ngModel",t.previewType),R(11),re("ngIf",t.detectedType),R(),re("ngClass","preview-"+t.previewType),R(),re("ngIf",t.previewType==="json"),R(),re("ngIf",t.previewType==="hex"||t.previewType==="base64"),R(),re("ngIf",t.previewType==="text"),R(),re("ngIf",t.previewType==="image")}}function eue(r,e){if(r&1){let t=Gt();_(0,"div",9)(1,"div",10)(2,"h3"),C(3),Vs(4,"uppercase"),E(),_(5,"span",11),C(6),E()(),_(7,"div",12)(8,"code"),C(9),E()(),_(10,"div",13)(11,"p"),C(12),Vs(13,"date"),E(),Ke(14,Wle,2,1,"p",14),E(),Ke(15,Jle,21,7,"div",15),_(16,"div",16)(17,"button",17),Ge("click",function(){let o=at(t).$implicit,i=ne();return ct(i.previewContent(o))}),C(18),E(),_(19,"button",18),Ge("click",function(){let o=at(t).$implicit,i=ne();return ct(i.downloadContent(o.hash))}),C(20," Download "),E()()()}if(r&2){let t=e.$implicit,n=ne();R(3),He(Wd(4,8,t.hash.algorithm)),R(3),He(n.formatFileSize(t.metadata.size||0)),R(3),He(t.hash.value),R(3),rt("Created: ",tu(13,10,t.metadata.createdAt,"short")),R(2),re("ngIf",t.metadata.contentType),R(),re("ngIf",t.previewData),R(2),re("disabled",t.previewData!==null),R(),rt(" ",t.previewData!==null?"Preview Loaded":"Load Preview"," ")}}var v4=class r{constructor(e){this.casService=e}filter;contentSelected=new Bt;contentItems=[];filteredItems=[];searchTerm="";isLoading=!1;ngOnInit(){this.loadContentItems()}loadContentItems(){return f(this,null,function*(){this.isLoading=!0;try{let e=yield this.casService.getAllContent();this.contentItems=[];for(let t of e){let n=yield this.casService.getMetadata(t.hash);this.contentItems.push({hash:t.hash,metadata:n,previewData:null,previewType:null})}this.filterContent()}catch(e){console.error("Failed to load content items:",e)}finally{this.isLoading=!1}})}addContentItem(e,t){let n={hash:e,metadata:t,previewData:null,previewType:null};this.contentItems.push(n),this.filterContent()}filterContent(){if(!this.searchTerm)this.filteredItems=[...this.contentItems];else{let e=this.searchTerm.toLowerCase();this.filteredItems=this.contentItems.filter(t=>t.hash.value.toLowerCase().includes(e))}}selectContent(e){this.contentSelected.emit(e)}previewContent(e){return f(this,null,function*(){if(e.previewData===null)try{let t=yield this.casService.retrieve(e.hash),n=this.detectContentType(t.data);e.detectedType=n,e.previewType||(e.previewType=this.getInitialPreviewType(n,t.data)),this.updatePreviewData(e,t.data)}catch(t){console.error("Failed to preview content:",t)}})}detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updatePreview(e){e.previewData&&this.casService.retrieve(e.hash).then(t=>{this.updatePreviewData(e,t.data)}).catch(t=>{console.error("Failed to update preview:",t)})}updatePreviewData(e,t){switch(e.previewType){case"text":try{let c=new TextDecoder().decode(t);e.previewData=c.length>1e3?c.substring(0,1e3)+"...":c}catch{e.previewData="Unable to decode as text"}break;case"json":try{let c=new TextDecoder().decode(t),l=JSON.parse(c);e.previewData=JSON.stringify(l,null,2),e.previewData.length>1e3&&(e.previewData=e.previewData.substring(0,1e3)+"...")}catch{e.previewData="Invalid JSON"}break;case"hex":let o=Math.min(t.length,256);e.previewData=Array.from(t.slice(0,o)).map(c=>c.toString(16).padStart(2,"0")).join(" ").toUpperCase(),t.length>o&&(e.previewData+=" ...");break;case"base64":let i=Math.min(t.length,1e3);e.previewData=btoa(String.fromCharCode(...t.slice(0,i))),t.length>i&&(e.previewData+="...");break;case"image":let s=new Blob([t]),a=new FileReader;a.onload=()=>{e.previewData=a.result},a.readAsDataURL(s);break}}downloadContent(e){return f(this,null,function*(){try{let t=yield this.casService.retrieve(e);this.downloadFile(t.data,e.value)}catch(t){console.error("Failed to download content:",t)}})}downloadFile(e,t){let n=new Blob([e]),o=window.URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}static \u0275fac=function(t){return new(t||r)(ye(cs))};static \u0275cmp=mr({type:r,selectors:[["app-content-list"]],inputs:{filter:"filter"},outputs:{contentSelected:"contentSelected"},decls:9,vars:4,consts:[[1,"content-list"],[1,"search-bar"],["type","text","placeholder","Search by hash...",1,"search-input",3,"ngModelChange","ngModel"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"content-grid"],["class","content-card",4,"ngFor","ngForOf"],[1,"loading"],[1,"empty-state"],[1,"content-card"],[1,"card-header"],[1,"file-size"],[1,"hash-value"],[1,"metadata"],[4,"ngIf"],["class","preview-section",4,"ngIf"],[1,"actions"],[1,"action-button",3,"click","disabled"],[1,"action-button",3,"click"],[1,"preview-section"],[1,"preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"preview",3,"ngClass"],["alt","Preview",3,"src",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"h2"),C(2,"Stored Content"),E(),_(3,"div",1)(4,"input",2),yr("ngModelChange",function(i){return Dr(n.searchTerm,i)||(n.searchTerm=i),i}),Ge("ngModelChange",function(){return n.filterContent()}),E()(),Ke(5,qle,2,0,"div",3)(6,Kle,3,0,"div",4),_(7,"div",5),Ke(8,eue,21,13,"div",6),E()()),t&2&&(R(4),gr("ngModel",n.searchTerm),R(),re("ngIf",n.isLoading),R(),re("ngIf",!n.isLoading&&n.filteredItems.length===0),R(2),re("ngForOf",n.filteredItems))},dependencies:[vr,Yd,ja,Pn,Xd,Qd,ls,cu,lu,as,Wa,Ka,Ks,Do],styles:[".content-list[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.search-bar[_ngcontent-%COMP%]{margin-bottom:20px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}.content-card[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;background-color:#f9f9f9}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.file-size[_ngcontent-%COMP%]{color:#666;font-size:14px}.hash-value[_ngcontent-%COMP%]{margin-bottom:15px;padding:10px;background-color:#e9ecef;border-radius:4px;overflow-wrap:break-word}.hash-value[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace;font-size:12px}.metadata[_ngcontent-%COMP%]{margin-bottom:15px;font-size:14px;color:#666}.metadata[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.preview-section[_ngcontent-%COMP%]{margin-bottom:15px}.preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.preview-type-select[_ngcontent-%COMP%]{padding:5px;border:1px solid #ddd;border-radius:4px;font-size:14px}.detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}.actions[_ngcontent-%COMP%]{display:flex;gap:10px}.action-button[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:none;border-radius:4px;cursor:pointer;font-size:14px;background-color:#007bff;color:#fff;transition:background-color .3s}.action-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};function tue(r,e){if(r&1&&(_(0,"div",8)(1,"p"),C(2),E(),_(3,"p"),C(4),E(),_(5,"p"),C(6),E()()),r&2){let t=ne();R(2),rt("Selected: ",t.selectedFile.name),R(2),rt("Size: ",t.formatFileSize(t.selectedFile.size)),R(2),rt("Type: ",t.selectedFile.type||"Unknown")}}function rue(r,e){if(r&1&&(_(0,"div",9),C(1),E()),r&2){let t=ne();R(),rt(" ",t.errorMessage," ")}}function nue(r,e){if(r&1){let t=Gt();_(0,"div",10)(1,"h3"),C(2,"Content Stored Successfully!"),E(),_(3,"p"),C(4),E(),_(5,"p"),C(6,"Hash: "),_(7,"code"),C(8),E()(),_(9,"button",11),Ge("click",function(){at(t);let o=ne();return ct(o.navigateToContentList())}),C(10," View All Content "),E()()}if(r&2){let t=ne();R(4),rt("Algorithm: ",t.uploadedHash.algorithm),R(4),He(t.uploadedHash.value)}}var w4=class r{constructor(e,t){this.casService=e;this.router=t}contentStored=new Bt;selectedFile=null;uploadedHash=null;isUploading=!1;errorMessage="";onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&(this.selectedFile=t.files[0],this.errorMessage="",this.uploadedHash=null)}uploadFile(){return f(this,null,function*(){if(!this.selectedFile){this.errorMessage="Please select a file";return}this.isUploading=!0,this.errorMessage="";try{let e=yield this.readFileAsArrayBuffer(this.selectedFile),t={data:new Uint8Array(e)};this.uploadedHash=yield this.casService.store(t),this.contentStored.emit(this.uploadedHash)}catch(e){this.errorMessage=`Upload failed: ${e instanceof Error?e.message:"Unknown error"}`}finally{this.isUploading=!1}})}readFileAsArrayBuffer(e){return new Promise((t,n)=>{let o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>n(new Error("Failed to read file")),o.readAsArrayBuffer(e)})}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}navigateToContentList(){this.router.navigate(["/content"])}static \u0275fac=function(t){return new(t||r)(ye(cs),ye(su))};static \u0275cmp=mr({type:r,selectors:[["app-content-upload"]],outputs:{contentStored:"contentStored"},decls:11,vars:6,consts:[["fileInput",""],[1,"content-upload"],[1,"upload-area"],["type","file",1,"file-input",3,"change","disabled"],["class","file-info",4,"ngIf"],[1,"upload-button",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],[1,"file-info"],[1,"error-message"],[1,"success-message"],[1,"view-content-button",3,"click"]],template:function(t,n){if(t&1){let o=Gt();_(0,"div",1)(1,"h2"),C(2,"Upload Content to CAS"),E(),_(3,"div",2)(4,"input",3,0),Ge("change",function(s){return at(o),ct(n.onFileSelected(s))}),E(),Ke(6,tue,7,3,"div",4),_(7,"button",5),Ge("click",function(){return at(o),ct(n.uploadFile())}),C(8),E(),Ke(9,rue,2,1,"div",6)(10,nue,11,2,"div",7),E()()}t&2&&(R(4),re("disabled",n.isUploading),R(2),re("ngIf",n.selectedFile),R(),re("disabled",!n.selectedFile||n.isUploading),R(),rt(" ",n.isUploading?"Uploading...":"Upload to CAS"," "),R(),re("ngIf",n.errorMessage),R(),re("ngIf",n.uploadedHash))},dependencies:[vr,Pn,ls],styles:[".content-upload[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.upload-area[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:30px;text-align:center;background-color:#f9f9f9}.file-input[_ngcontent-%COMP%]{margin-bottom:20px}.file-info[_ngcontent-%COMP%]{margin:20px 0;padding:15px;background-color:#e9ecef;border-radius:4px;text-align:left}.file-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.upload-button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px}.upload-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{color:#dc3545;margin-top:15px;padding:10px;background-color:#f8d7da;border-radius:4px}.success-message[_ngcontent-%COMP%]{color:#155724;margin-top:15px;padding:15px;background-color:#d4edda;border-radius:4px;text-align:left}.success-message[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;word-break:break-all}.view-content-button[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin-top:15px}.view-content-button[_ngcontent-%COMP%]:hover{background-color:#218838}"]})};var mm=class r{constructor(e){this.hashService=e}generateKeyPair(){return f(this,null,function*(){let e=yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),t=yield crypto.subtle.exportKey("jwk",e.privateKey),n=yield crypto.subtle.exportKey("jwk",e.publicKey),o=this.jwkToHex(t),i=this.jwkToHex(n);return{privateKey:o,publicKey:i}})}sign(e,t){return f(this,null,function*(){let n=yield this.hashService.hash(e),o=yield this.hashService.hash(new TextEncoder().encode(n+t)),i=yield this.hashService.hash(new TextEncoder().encode(t+"_public"));return{value:o,algorithm:"secp256k1",publicKey:i}})}verify(e,t){return f(this,null,function*(){try{return yield this.hashService.hash(e),t.algorithm==="secp256k1"&&t.value.length===64&&t.publicKey.length===64&&/^[a-f0-9]{64}$/.test(t.value)}catch{return!1}})}jwkToHex(e){let t=JSON.stringify(e,Object.keys(e).sort());return Array.from(new TextEncoder().encode(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}static \u0275fac=function(t){return new(t||r)(Ee(pm))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var gm=class r{constructor(e,t){this.casService=e;this.signatureService=t}entries=new Map;createEntry(e,t,n){return f(this,null,function*(){let o=new Date,i={contentHash:e,type:t,timestamp:o.toISOString()},s=new TextEncoder().encode(JSON.stringify(i)),a=yield this.signatureService.sign(s,n),c={id:"",contentHash:e,signature:a,timestamp:o,type:t},l=new TextEncoder().encode(JSON.stringify(c)),u=yield this.casService.store({data:l});return c.id=u.value,this.entries.set(c.id,c),c})}verifyEntry(e){return f(this,null,function*(){let t={contentHash:e.contentHash,type:e.type,timestamp:e.timestamp.toISOString()},n=new TextEncoder().encode(JSON.stringify(t));return this.signatureService.verify(n,e.signature)})}getEntry(e){return f(this,null,function*(){if(this.entries.has(e))return this.entries.get(e);try{let t=yield this.casService.retrieve({algorithm:"sha256",value:e}),n=new TextDecoder().decode(t.data),o=JSON.parse(n);return o.timestamp=new Date(o.timestamp),this.entries.set(e,o),o}catch{throw new Error("DISOT entry not found")}})}listEntries(e){return f(this,null,function*(){let t=Array.from(this.entries.values());return e&&(e.type&&(t=t.filter(n=>n.type===e.type)),e.publicKey&&(t=t.filter(n=>n.signature.publicKey===e.publicKey)),e.fromDate&&(t=t.filter(n=>n.timestamp>=e.fromDate)),e.toDate&&(t=t.filter(n=>n.timestamp<=e.toDate))),t.sort((n,o)=>o.timestamp.getTime()-n.timestamp.getTime())})}static \u0275fac=function(t){return new(t||r)(Ee(cs),Ee(mm))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};function oue(r,e){if(r&1){let t=Gt();_(0,"app-content-selection-modal",16),Ge("contentSelected",function(o){at(t);let i=ne();return ct(i.onContentSelected(o))})("closed",function(){at(t);let o=ne();return ct(o.showContentModal=!1)}),E()}}function iue(r,e){if(r&1){let t=Gt();_(0,"div",17)(1,"p")(2,"strong"),C(3,"Algorithm:"),E(),C(4),Vs(5,"uppercase"),E(),_(6,"p")(7,"strong"),C(8,"Hash:"),E(),_(9,"code"),C(10),E()(),_(11,"button",18),Ge("click",function(){at(t);let o=ne();return ct(o.clearContent())}),C(12,"Clear Selection"),E()()}if(r&2){let t=ne();R(4),rt(" ",Wd(5,2,t.contentHash.algorithm)),R(6),He(t.contentHash.value)}}function sue(r,e){if(r&1){let t=Gt();_(0,"div",19)(1,"p"),C(2,"No content selected. Please select content from the content list."),E(),_(3,"button",20),Ge("click",function(){at(t);let o=ne();return ct(o.selectContent())}),C(4,"Select Content"),E()()}}function aue(r,e){if(r&1&&(_(0,"option",21),C(1),E()),r&2){let t=e.$implicit,n=ne();re("value",t),R(),rt(" ",n.formatEntryType(t)," ")}}function cue(r,e){if(r&1&&(_(0,"div",22)(1,"p")(2,"strong"),C(3,"Public Key:"),E()(),_(4,"code"),C(5),E()()),r&2){let t=ne();R(5),He(t.publicKey)}}function lue(r,e){if(r&1){let t=Gt();_(0,"div",2)(1,"h3"),C(2,"Blog Post Content"),E(),_(3,"textarea",23),yr("ngModelChange",function(o){at(t);let i=ne();return Dr(i.blogPostContent,o)||(i.blogPostContent=o),ct(o)}),E()()}if(r&2){let t=ne();R(3),gr("ngModel",t.blogPostContent),re("disabled",t.isCreating)}}function uue(r,e){if(r&1&&(_(0,"div",24),C(1),E()),r&2){let t=ne();R(),rt(" ",t.errorMessage," ")}}function due(r,e){if(r&1&&(_(0,"div",25)(1,"h3"),C(2,"Entry Created Successfully!"),E(),_(3,"div",26)(4,"p")(5,"strong"),C(6,"Entry ID:"),E(),_(7,"code"),C(8),E()(),_(9,"p")(10,"strong"),C(11,"Type:"),E(),C(12),E(),_(13,"p")(14,"strong"),C(15,"Timestamp:"),E(),C(16),Vs(17,"date"),E(),_(18,"p")(19,"strong"),C(20,"Public Key:"),E(),_(21,"code"),C(22),E()(),_(23,"p")(24,"strong"),C(25,"Signature:"),E(),_(26,"code"),C(27),E()()()()),r&2){let t=ne();R(8),He(t.createdEntry.id),R(4),rt(" ",t.formatEntryType(t.createdEntry.type)),R(4),rt(" ",tu(17,5,t.createdEntry.timestamp,"medium")),R(6),He(t.createdEntry.signature.publicKey),R(5),He(t.createdEntry.signature.value)}}function fue(r,e){if(r&1&&(_(0,"span",49),C(1),E()),r&2){let t,n=ne(2).$implicit,o=ne(2);R(),rt("(Detected: ",(t=o.getEntryPreview(n.id))==null?null:t.detectedType,")")}}function pue(r,e){if(r&1&&(_(0,"pre"),C(1),E()),r&2){let t,n=ne(2).$implicit,o=ne(2);R(),He((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function hue(r,e){if(r&1&&(_(0,"code"),C(1),E()),r&2){let t,n=ne(2).$implicit,o=ne(2);R(),He((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function mue(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t,n=ne(2).$implicit,o=ne(2);R(),He((t=o.getEntryPreview(n.id))==null?null:t.previewData)}}function gue(r,e){if(r&1&&Wr(0,"img",50),r&2){let t,n=ne(2).$implicit,o=ne(2);re("src",(t=o.getEntryPreview(n.id))==null?null:t.previewData,Jl)}}function yue(r,e){if(r&1){let t=Gt();_(0,"div",37)(1,"div",38)(2,"label"),C(3,"Preview as: "),E(),_(4,"select",39),yr("ngModelChange",function(o){at(t);let i=ne().$implicit,s=ne(2);return Dr(s.getEntryPreview(i.id).previewType,o)||(s.getEntryPreview(i.id).previewType=o),ct(o)}),Ge("change",function(){at(t);let o=ne().$implicit,i=ne(2);return ct(i.updateEntryPreview(o))}),_(5,"option",40),C(6,"Text"),E(),_(7,"option",41),C(8,"JSON"),E(),_(9,"option",42),C(10,"Hex"),E(),_(11,"option",43),C(12,"Base64"),E(),_(13,"option",44),C(14,"Image"),E()(),Ke(15,fue,2,1,"span",45),E(),_(16,"div",46),Ke(17,pue,2,1,"pre",47)(18,hue,2,1,"code",47)(19,mue,2,1,"p",47)(20,gue,1,1,"img",48),E()()}if(r&2){let t,n,o,i,s,a,c=ne().$implicit,l=ne(2);R(4),gr("ngModel",l.getEntryPreview(c.id).previewType),R(11),re("ngIf",(t=l.getEntryPreview(c.id))==null?null:t.detectedType),R(),re("ngClass","preview-"+((n=l.getEntryPreview(c.id))==null?null:n.previewType)),R(),re("ngIf",((o=l.getEntryPreview(c.id))==null?null:o.previewType)==="json"),R(),re("ngIf",((i=l.getEntryPreview(c.id))==null?null:i.previewType)==="hex"||((i=l.getEntryPreview(c.id))==null?null:i.previewType)==="base64"),R(),re("ngIf",((s=l.getEntryPreview(c.id))==null?null:s.previewType)==="text"),R(),re("ngIf",((a=l.getEntryPreview(c.id))==null?null:a.previewType)==="image")}}function vue(r,e){if(r&1){let t=Gt();_(0,"div",30)(1,"div",31)(2,"div",32)(3,"p")(4,"strong"),C(5,"Type:"),E(),C(6),E(),_(7,"p")(8,"strong"),C(9,"Time:"),E(),C(10),Vs(11,"date"),E(),_(12,"p")(13,"strong"),C(14,"ID:"),E(),_(15,"code",33),C(16),E()(),_(17,"p")(18,"strong"),C(19,"Content Hash:"),E(),_(20,"code",33),C(21),E()()(),_(22,"div",34)(23,"button",35),Ge("click",function(){let o=at(t).$implicit,i=ne(2);return ct(i.toggleEntryPreview(o))}),C(24),E()()(),Ke(25,yue,21,7,"div",36),E()}if(r&2){let t,n,o,i=e.$implicit,s=ne(2);R(6),rt(" ",s.formatEntryType(i.type)),R(4),rt(" ",tu(11,7,i.timestamp,"short")),R(6),He(i.id),R(5),He(i.contentHash.value),R(2),re("disabled",(t=s.getEntryPreview(i.id))==null?null:t.isLoading),R(),rt(" ",(n=s.getEntryPreview(i.id))!=null&&n.isLoading?"Loading...":(n=s.getEntryPreview(i.id))!=null&&n.previewData?"Hide Preview":"Show Preview"," "),R(),re("ngIf",(o=s.getEntryPreview(i.id))==null?null:o.previewData)}}function wue(r,e){if(r&1&&(_(0,"div",27)(1,"h3"),C(2,"Previous Entries"),E(),_(3,"div",28),Ke(4,vue,26,10,"div",29),E()()),r&2){let t=ne();R(4),re("ngForOf",t.previousEntries)}}var b4=class r{constructor(e,t,n){this.disotService=e;this.signatureService=t;this.casService=n}contentHash=null;entryCreated=new Bt;selectedType="document";privateKey="";publicKey="";blogPostContent="";isCreating=!1;errorMessage="";createdEntry=null;previousEntries=[];showContentModal=!1;entryPreviews=new Map;entryTypes=["blog_post","document","image","signature"];ngOnInit(){this.loadPreviousEntries()}generateKeyPair(){return f(this,null,function*(){try{let e=yield this.signatureService.generateKeyPair();this.privateKey=e.privateKey,this.publicKey=e.publicKey,this.errorMessage=""}catch{this.errorMessage="Failed to generate key pair"}})}createEntry(){return f(this,null,function*(){if(!this.privateKey){this.errorMessage="Please enter or generate a private key";return}if(this.selectedType==="blog_post"){if(!this.blogPostContent.trim()){this.errorMessage="Please enter blog post content";return}}else if(!this.contentHash){this.errorMessage="Please select content first";return}this.isCreating=!0,this.errorMessage="";try{let e=this.contentHash;if(this.selectedType==="blog_post"){let t={blogPost:this.blogPostContent},n=JSON.stringify(t),o=new TextEncoder().encode(n);e=yield this.casService.store({data:o})}if(!e)throw new Error("No content hash available");this.createdEntry=yield this.disotService.createEntry(e,this.selectedType,this.privateKey),this.entryCreated.emit(this.createdEntry),yield this.loadPreviousEntries()}catch(e){this.errorMessage=`Failed to create entry: ${e instanceof Error?e.message:"Unknown error"}`,this.createdEntry=null}finally{this.isCreating=!1}})}formatEntryType(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}clearContent(){this.contentHash=null}selectContent(){this.showContentModal=!0}onContentSelected(e){this.contentHash=e,this.showContentModal=!1}loadPreviousEntries(){return f(this,null,function*(){try{this.previousEntries=yield this.disotService.listEntries()}catch(e){console.error("Failed to load previous entries:",e)}})}getEntryPreview(e){return this.entryPreviews.get(e)}toggleEntryPreview(e){return f(this,null,function*(){this.entryPreviews.get(e.id)?.previewData?this.entryPreviews.delete(e.id):yield this.loadEntryPreview(e)})}loadEntryPreview(e){return f(this,null,function*(){let t=this.entryPreviews.get(e.id)||{previewData:null,previewType:null,isLoading:!1};if(!t.isLoading){t.isLoading=!0,this.entryPreviews.set(e.id,t);try{let n=yield this.casService.retrieve(e.contentHash),o=this.detectContentType(n.data);t.detectedType=o,t.previewType=this.getInitialPreviewType(o,n.data),this.updateEntryPreviewData(e.id,n.data)}catch(n){console.error("Failed to preview entry content:",n),t.previewData="Failed to load content",t.previewType="text"}finally{t.isLoading=!1,this.entryPreviews.set(e.id,t)}}})}detectContentType(e){if(e.length>=4){let t=Array.from(e.slice(0,4)).map(n=>n.toString(16).padStart(2,"0")).join("");if(t==="89504e47")return"image/png";if(t.startsWith("ffd8ff"))return"image/jpeg";if(t.startsWith("47494638"))return"image/gif";if(t==="25504446")return"application/pdf"}try{let t=new TextDecoder("utf-8",{fatal:!0}).decode(e.slice(0,1e3));try{return JSON.parse(t),"application/json"}catch{return"text/plain"}}catch{return"application/octet-stream"}}getInitialPreviewType(e,t){return e.startsWith("image/")?"image":e==="application/json"?"json":e==="text/plain"?"text":t.length<=256?"hex":"base64"}updateEntryPreview(e){this.entryPreviews.get(e.id)?.previewData&&this.casService.retrieve(e.contentHash).then(n=>{this.updateEntryPreviewData(e.id,n.data)}).catch(n=>{console.error("Failed to update entry preview:",n)})}updateEntryPreviewData(e,t){let n=this.entryPreviews.get(e);if(!n)return;let o=1e3;switch(n.previewType){case"text":try{let l=new TextDecoder().decode(t);n.previewData=l.length>o?l.substring(0,o)+"...":l}catch{n.previewData="Unable to decode as text"}break;case"json":try{let l=new TextDecoder().decode(t),u=JSON.parse(l);n.previewData=JSON.stringify(u,null,2),n.previewData.length>o&&(n.previewData=n.previewData.substring(0,o)+"...")}catch{n.previewData="Invalid JSON"}break;case"hex":let i=Math.min(t.length,256);n.previewData=Array.from(t.slice(0,i)).map(l=>l.toString(16).padStart(2,"0")).join(" ").toUpperCase(),t.length>i&&(n.previewData+=" ...");break;case"base64":let s=Math.min(t.length,1e3);n.previewData=btoa(String.fromCharCode(...t.slice(0,s))),t.length>s&&(n.previewData+="...");break;case"image":let a=new Blob([t]),c=new FileReader;c.onload=()=>{n.previewData=c.result,this.entryPreviews.set(e,n)},c.readAsDataURL(a);return}this.entryPreviews.set(e,n)}static \u0275fac=function(t){return new(t||r)(ye(gm),ye(mm),ye(cs))};static \u0275cmp=mr({type:r,selectors:[["app-disot-entry"]],inputs:{contentHash:"contentHash"},outputs:{entryCreated:"entryCreated"},decls:28,vars:15,consts:[[1,"disot-entry"],[3,"contentSelected","closed",4,"ngIf"],[1,"form-section"],["class","content-info",4,"ngIf"],["class","no-content",4,"ngIf"],[1,"type-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"key-section"],["placeholder","Enter your private key...","rows","3",1,"key-input",3,"ngModelChange","ngModel","disabled"],[1,"generate-button",3,"click","disabled"],["class","public-key-display",4,"ngIf"],["class","form-section",4,"ngIf"],[1,"create-button",3,"click","disabled"],["class","error-message",4,"ngIf"],["class","success-section",4,"ngIf"],["class","entries-section",4,"ngIf"],[3,"contentSelected","closed"],[1,"content-info"],[1,"clear-button",3,"click"],[1,"no-content"],[1,"select-button",3,"click"],[3,"value"],[1,"public-key-display"],["placeholder","Enter your blog post content...","rows","6",1,"blog-input",3,"ngModelChange","ngModel","disabled"],[1,"error-message"],[1,"success-section"],[1,"entry-details"],[1,"entries-section"],[1,"entries-list"],["class","entry-item",4,"ngFor","ngForOf"],[1,"entry-item"],[1,"entry-header"],[1,"entry-info"],[1,"small-code"],[1,"entry-actions"],[1,"preview-entry-button",3,"click","disabled"],["class","entry-preview-section",4,"ngIf"],[1,"entry-preview-section"],[1,"entry-preview-controls"],[1,"preview-type-select",3,"ngModelChange","change","ngModel"],["value","text"],["value","json"],["value","hex"],["value","base64"],["value","image"],["class","detected-type",4,"ngIf"],[1,"entry-preview",3,"ngClass"],[4,"ngIf"],["alt","Preview",3,"src",4,"ngIf"],[1,"detected-type"],["alt","Preview",3,"src"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"h2"),C(2,"Create DISOT Entry"),E(),Ke(3,oue,1,0,"app-content-selection-modal",1),_(4,"div",2)(5,"h3"),C(6,"Content Information"),E(),Ke(7,iue,13,4,"div",3)(8,sue,5,0,"div",4),E(),_(9,"div",2)(10,"h3"),C(11,"Entry Type"),E(),_(12,"select",5),yr("ngModelChange",function(i){return Dr(n.selectedType,i)||(n.selectedType=i),i}),Ke(13,aue,2,2,"option",6),E()(),_(14,"div",2)(15,"h3"),C(16,"Signing Key"),E(),_(17,"div",7)(18,"textarea",8),yr("ngModelChange",function(i){return Dr(n.privateKey,i)||(n.privateKey=i),i}),E(),_(19,"button",9),Ge("click",function(){return n.generateKeyPair()}),C(20," Generate New Key Pair "),E(),Ke(21,cue,6,1,"div",10),E()(),Ke(22,lue,4,2,"div",11),_(23,"button",12),Ge("click",function(){return n.createEntry()}),C(24),E(),Ke(25,uue,2,1,"div",13)(26,due,28,8,"div",14)(27,wue,5,1,"div",15),E()),t&2&&(R(3),re("ngIf",n.showContentModal),R(4),re("ngIf",n.contentHash),R(),re("ngIf",!n.contentHash),R(4),gr("ngModel",n.selectedType),R(),re("ngForOf",n.entryTypes),R(5),gr("ngModel",n.privateKey),re("disabled",n.isCreating),R(),re("disabled",n.isCreating),R(2),re("ngIf",n.publicKey),R(),re("ngIf",n.selectedType==="blog_post"),R(),re("disabled",!n.contentHash||!n.privateKey||n.isCreating),R(),rt(" ",n.isCreating?"Creating...":"Create Entry"," "),R(),re("ngIf",n.errorMessage),R(),re("ngIf",n.createdEntry),R(),re("ngIf",n.previousEntries.length>0))},dependencies:[vr,Yd,ja,Pn,Xd,Qd,ls,cu,lu,as,Wa,Ka,Ks,hm,Do],styles:[".disot-entry[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{margin-bottom:25px;padding:20px;background-color:#f9f9f9;border-radius:8px}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.content-info[_ngcontent-%COMP%], .no-content[_ngcontent-%COMP%]{padding:15px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px}.content-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.content-info[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;word-break:break-all}.no-content[_ngcontent-%COMP%]{color:#666;font-style:italic}.type-select[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px;background-color:#fff}.key-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.key-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-family:monospace;font-size:14px;border:1px solid #ddd;border-radius:4px;resize:vertical}.generate-button[_ngcontent-%COMP%]{align-self:flex-start;padding:8px 16px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer}.generate-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.clear-button[_ngcontent-%COMP%], .select-button[_ngcontent-%COMP%]{margin-top:10px;padding:8px 16px;border:none;border-radius:4px;cursor:pointer}.clear-button[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.clear-button[_ngcontent-%COMP%]:hover{background-color:#c82333}.select-button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.select-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.public-key-display[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background-color:#e9ecef;border-radius:4px}.public-key-display[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 5px}.public-key-display[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;word-break:break-all;font-family:monospace;font-size:12px}.blog-input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:14px;border:1px solid #ddd;border-radius:4px;resize:vertical}.create-button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:18px;background-color:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer}.create-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.create-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f8d7da;color:#721c24;border-radius:4px}.success-section[_ngcontent-%COMP%]{margin-top:20px;padding:20px;background-color:#d4edda;border-radius:8px}.success-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#155724}.entry-details[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px;margin-top:10px}.entry-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;word-break:break-all}.entry-details[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;font-size:12px}.entries-section[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background-color:#f9f9f9;border-radius:8px}.entries-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.entries-list[_ngcontent-%COMP%]{display:grid;gap:10px}.entry-item[_ngcontent-%COMP%]{background-color:#fff;padding:10px;border:1px solid #e0e0e0;border-radius:4px}.entry-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:14px}.small-code[_ngcontent-%COMP%]{font-size:11px!important;word-break:break-all}.entry-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:15px}.entry-info[_ngcontent-%COMP%]{flex:1}.entry-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:14px}.entry-actions[_ngcontent-%COMP%]{flex-shrink:0}.preview-entry-button[_ngcontent-%COMP%]{padding:6px 12px;background-color:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:background-color .2s}.preview-entry-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268}.preview-entry-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.entry-preview-section[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f5f5f5;border-radius:4px}.entry-preview-controls[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:10px;font-size:14px}.entry-preview-controls[_ngcontent-%COMP%]   .preview-type-select[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.entry-preview-controls[_ngcontent-%COMP%]   .detected-type[_ngcontent-%COMP%]{color:#666;font-style:italic;font-size:12px}.entry-preview[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border:1px solid #e0e0e0;border-radius:4px;max-height:200px;overflow-y:auto;font-size:14px}.entry-preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-wrap:break-word}.entry-preview[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{display:block;font-family:monospace;word-break:break-all}.entry-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto}.entry-preview.preview-hex[_ngcontent-%COMP%]   code[_ngcontent-%COMP%], .entry-preview.preview-base64[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}"]})};function bue(r,e){if(r&1){let t=Gt();_(0,"div",10)(1,"h3"),C(2,"Entry Details"),E(),_(3,"div",11)(4,"div",12)(5,"span",13),C(6,"Entry ID:"),E(),_(7,"code"),C(8),E()(),_(9,"div",12)(10,"span",13),C(11,"Type:"),E(),_(12,"span"),C(13),E()(),_(14,"div",12)(15,"span",13),C(16,"Timestamp:"),E(),_(17,"span"),C(18),E()(),_(19,"div",12)(20,"span",13),C(21,"Content Hash:"),E(),_(22,"code"),C(23),E()(),_(24,"div",12)(25,"span",13),C(26,"Public Key:"),E(),_(27,"code"),C(28),E()(),_(29,"div",12)(30,"span",13),C(31,"Signature:"),E(),_(32,"code"),C(33),E()()(),_(34,"button",14),Ge("click",function(){at(t);let o=ne();return ct(o.verifySignature())}),C(35),E()()}if(r&2){let t=ne();R(8),He(t.disotEntry.id),R(5),He(t.formatEntryType(t.disotEntry.type)),R(5),He(t.formatTimestamp(t.disotEntry.timestamp)),R(5),He(t.disotEntry.contentHash.value),R(5),He(t.disotEntry.signature.publicKey),R(5),He(t.disotEntry.signature.value),R(),re("disabled",t.isVerifying),R(),rt(" ",t.isVerifying?"Verifying...":"Verify Signature"," ")}}function Eue(r,e){r&1&&(_(0,"div",15)(1,"p"),C(2,"No entry loaded. Enter an entry ID above or select an entry from the list."),E()())}function xue(r,e){if(r&1&&(_(0,"div",16),C(1),E()),r&2){let t=ne();R(),rt(" ",t.errorMessage," ")}}function Sue(r,e){r&1&&(_(0,"span"),C(1,"\u2713"),E())}function _ue(r,e){r&1&&(_(0,"span"),C(1,"\u2717"),E())}function Cue(r,e){if(r&1&&(_(0,"div",17)(1,"div",18),Ke(2,Sue,2,0,"span",19)(3,_ue,2,0,"span",19),E(),_(4,"div",20)(5,"h3"),C(6),E(),_(7,"p"),C(8),E()()()),r&2){let t=ne();Ko("valid",t.verificationResult)("invalid",!t.verificationResult),R(2),re("ngIf",t.verificationResult),R(),re("ngIf",!t.verificationResult),R(3),He(t.verificationResult?"Signature Valid":"Signature Invalid"),R(2),He(t.verificationResult?"The signature has been successfully verified.":"The signature verification failed. The entry may have been tampered with.")}}var E4=class r{constructor(e){this.disotService=e}disotEntry=null;isVerifying=!1;verificationResult=null;errorMessage="";verifyById(e){return f(this,null,function*(){if(!e.trim()){this.errorMessage="Please enter an entry ID";return}this.isVerifying=!0,this.errorMessage="",this.verificationResult=null;try{this.disotEntry=yield this.disotService.getEntry(e),yield this.verifySignature()}catch(t){this.errorMessage=`Failed to load entry: ${t instanceof Error?t.message:"Unknown error"}`,this.disotEntry=null}finally{this.isVerifying=!1}})}verifySignature(){return f(this,null,function*(){if(!this.disotEntry){this.errorMessage="No entry to verify";return}this.isVerifying=!0,this.errorMessage="",this.verificationResult=null;try{this.verificationResult=yield this.disotService.verifyEntry(this.disotEntry)}catch(e){this.errorMessage=`Verification failed: ${e instanceof Error?e.message:"Unknown error"}`,this.verificationResult=null}finally{this.isVerifying=!1}})}formatEntryType(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}formatTimestamp(e){return new Date(e).toLocaleString()}static \u0275fac=function(t){return new(t||r)(ye(gm))};static \u0275cmp=mr({type:r,selectors:[["app-signature-verification"]],inputs:{disotEntry:"disotEntry"},decls:15,vars:6,consts:[["entryIdInput",""],[1,"signature-verification"],[1,"lookup-section"],[1,"id-input-group"],["type","text","placeholder","Enter DISOT entry ID...",1,"id-input",3,"disabled"],[1,"lookup-button",3,"click","disabled"],["class","entry-section",4,"ngIf"],["class","no-entry",4,"ngIf"],["class","error-message",4,"ngIf"],["class","verification-result",3,"valid","invalid",4,"ngIf"],[1,"entry-section"],[1,"entry-info"],[1,"info-row"],[1,"label"],[1,"verify-button",3,"click","disabled"],[1,"no-entry"],[1,"error-message"],[1,"verification-result"],[1,"result-icon"],[4,"ngIf"],[1,"result-text"]],template:function(t,n){if(t&1){let o=Gt();_(0,"div",1)(1,"h2"),C(2,"Signature Verification"),E(),_(3,"div",2)(4,"h3"),C(5,"Verify by Entry ID"),E(),_(6,"div",3),Wr(7,"input",4,0),_(9,"button",5),Ge("click",function(){at(o);let s=aI(8);return ct(n.verifyById(s.value))}),C(10," Load & Verify "),E()()(),Ke(11,bue,36,8,"div",6)(12,Eue,3,0,"div",7)(13,xue,2,1,"div",8)(14,Cue,9,8,"div",9),E()}t&2&&(R(7),re("disabled",n.isVerifying),R(2),re("disabled",n.isVerifying),R(2),re("ngIf",n.disotEntry),R(),re("ngIf",!n.disotEntry&&!n.errorMessage),R(),re("ngIf",n.errorMessage),R(),re("ngIf",n.verificationResult!==null))},dependencies:[vr,Pn,ls,Do],styles:[".signature-verification[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.lookup-section[_ngcontent-%COMP%], .entry-section[_ngcontent-%COMP%]{margin-bottom:25px;padding:20px;background-color:#f9f9f9;border-radius:8px}.lookup-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .entry-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.id-input-group[_ngcontent-%COMP%]{display:flex;gap:10px}.id-input[_ngcontent-%COMP%]{flex:1;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:4px}.lookup-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#17a2b8;color:#fff;border:none;border-radius:4px;cursor:pointer;white-space:nowrap}.lookup-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#138496}.entry-info[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px;margin-bottom:20px}.info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:10px;align-items:flex-start}.info-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.label[_ngcontent-%COMP%]{font-weight:700;min-width:120px;margin-right:10px}.info-row[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 4px;border-radius:3px;font-family:monospace;font-size:12px;word-break:break-all}.verify-button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:18px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.verify-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.verify-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.no-entry[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666;font-style:italic}.error-message[_ngcontent-%COMP%]{padding:15px;background-color:#f8d7da;color:#721c24;border-radius:4px;margin-bottom:20px}.verification-result[_ngcontent-%COMP%]{padding:20px;border-radius:8px;display:flex;align-items:center;gap:20px}.verification-result.valid[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.verification-result.invalid[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.result-icon[_ngcontent-%COMP%]{font-size:48px;font-weight:700}.result-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 10px}.result-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})};var x4=class r{constructor(e,t){this.http=e;if(this.config=t,t.mode==="api")this.baseUrl=t.apiEndpoint?t.apiEndpoint+"/api/v0":"/api/v0";else if(t.mode==="gateway"){if(!t.gateway)throw new Error("Invalid IPFS configuration: gateway URL required for gateway mode");this.baseUrl=t.gateway}else throw new Error("Invalid IPFS configuration: unsupported mode")}config;baseUrl;add(e){if(this.config.mode==="gateway")return wi(()=>new Error("Gateway mode does not support uploads"));let t=new FormData,n=new Blob([e],{type:"application/octet-stream"});return t.append("file",n),this.http.post(`${this.baseUrl}/add`,t,{params:{pin:"true"},headers:{}}).pipe(Pc(this.config.timeout),Xe(o=>({cid:o.Hash,size:o.Size||e.length,timestamp:new Date,pinned:!0})),ln(o=>(console.error("IPFS add failed:",o),wi(()=>new Error(`Failed to add to IPFS: ${o.message}`)))))}get(e){let t;return this.config.mode==="api"?this.http.post(`${this.baseUrl}/cat`,null,{params:{arg:e},responseType:"arraybuffer"}).pipe(Pc(this.config.timeout),Xe(n=>new Uint8Array(n)),ln(n=>(console.error("IPFS get failed:",n),wi(()=>new Error(`Failed to get from IPFS: ${n.message}`))))):(t=`${this.config.gateway}/ipfs/${e}`,this.http.get(t,{responseType:"arraybuffer"}).pipe(Pc(this.config.timeout),Xe(n=>new Uint8Array(n)),ln(n=>(console.error("IPFS gateway get failed:",n),wi(()=>new Error(`Failed to get from IPFS gateway: ${n.message}`))))))}pin(e){return this.config.mode==="gateway"?wi(()=>new Error("Gateway mode does not support pinning")):this.http.post(`${this.baseUrl}/pin/add`,null,{params:{arg:e}}).pipe(Pc(this.config.timeout),Xe(()=>!0),ln(t=>(console.error("IPFS pin failed:",t),Oe(!1))))}unpin(e){return this.config.mode==="gateway"?wi(()=>new Error("Gateway mode does not support unpinning")):this.http.post(`${this.baseUrl}/pin/rm`,null,{params:{arg:e}}).pipe(Pc(this.config.timeout),Xe(()=>!0),ln(t=>(console.error("IPFS unpin failed:",t),Oe(!1))))}isHealthy(){return this.config.mode==="api"?this.http.post(`${this.baseUrl}/version`,null,{headers:{"Content-Type":"application/json"}}).pipe(Pc(5e3),Xe(()=>!0),ln(e=>(console.error("IPFS health check failed:",e),Oe(!1)))):this.http.head(this.config.gateway).pipe(Pc(5e3),Xe(()=>!0),ln(()=>Oe(!1)))}getType(){return this.config.mode}static \u0275fac=function(t){return new(t||r)(Ee(Yh),Ee(Ws))};static \u0275prov=me({token:r,factory:r.\u0275fac})};var ym=class r{dbName="cas-storage";storeName="content";version=1;db=null;initializationError=null;initializationPromise;constructor(){this.initializationPromise=this.initializeDb().catch(()=>{})}initializeDb(){return f(this,null,function*(){return new Promise((e,t)=>{let n=indexedDB.open(this.dbName,this.version);n.onerror=()=>{let o=new Error("Failed to open IndexedDB");this.initializationError=o,t(o)},n.onsuccess=o=>{this.db=o.target.result,e()},n.onupgradeneeded=o=>{let i=o.target.result;i.objectStoreNames.contains(this.storeName)||i.createObjectStore(this.storeName)}}).catch(e=>{throw this.initializationError=e,e})})}ensureDb(){return f(this,null,function*(){if(this.initializationError)throw new Error("IndexedDB not available");if(!this.db)try{yield this.initializationPromise}catch{throw new Error("IndexedDB not available")}if(!this.db)throw new Error("IndexedDB not available");return this.db})}read(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);a.onsuccess=()=>{let c=a.result;c&&c instanceof Uint8Array?n(c):c?n(new Uint8Array(c)):o(new Error(`Path not found: ${e}`))},a.onerror=()=>{o(new Error(`Failed to read path: ${e}`))}})})}write(e,t){return f(this,null,function*(){let n=yield this.ensureDb();return new Promise((o,i)=>{let c=n.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(t,e);c.onsuccess=()=>{o()},c.onerror=()=>{i(new Error(`Failed to write path: ${e}`))}})})}exists(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).count(e);a.onsuccess=()=>{n(a.result>0)},a.onerror=()=>{o(new Error(`Failed to check existence: ${e}`))}})})}list(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let s=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();s.onsuccess=()=>{let a=s.result;t(a.map(c=>String(c)))},s.onerror=()=>{n(new Error("Failed to list paths"))}})})}delete(e){return f(this,null,function*(){let t=yield this.ensureDb();return new Promise((n,o)=>{let a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);a.onsuccess=()=>{n()},a.onerror=()=>{o(new Error(`Failed to delete path: ${e}`))}})})}clear(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let s=e.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>{t()},s.onerror=()=>{n(new Error("Failed to clear storage"))}})})}getSize(){return f(this,null,function*(){let e=yield this.ensureDb();return new Promise((t,n)=>{let i=e.transaction([this.storeName],"readonly").objectStore(this.storeName),s=0,a=i.openCursor();a.onsuccess=c=>{let l=c.target.result;l?(l.value instanceof Uint8Array&&(s+=l.value.byteLength),l.continue()):t(s)},a.onerror=()=>{n(new Error("Failed to calculate storage size"))}})})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var vm=class r{constructor(e){this.config=e}publicGateways=["https://ipfs.io","https://gateway.ipfs.io","https://cloudflare-ipfs.com","https://gateway.pinata.cloud","https://ipfs.fleek.co","https://ipfs.infura.io"];generateShareLink(e,t={}){let o=`${t.gateway||this.getDefaultGateway()}/ipfs/${e}`;return t.filename&&(o+=`?filename=${encodeURIComponent(t.filename)}`),t.download&&(o+=t.filename?"&":"?",o+="download=true"),o}generateMultipleShareLinks(e,t={}){return this.publicGateways.map(n=>this.generateShareLink(e,I(v({},t),{gateway:n})))}generateLocalShareLink(e,t={}){let n=this.config.gateway||"http://127.0.0.1:8080";return this.generateShareLink(e,I(v({},t),{gateway:n}))}checkGatewayAvailability(e,t){return f(this,null,function*(){let n=this.generateShareLink(e,{gateway:t});try{return(yield fetch(n,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}})}findAvailableGateway(e){return f(this,null,function*(){if(yield this.checkGatewayAvailability(e,this.config.gateway))return this.config.gateway||"http://127.0.0.1:8080";for(let t of this.publicGateways)if(yield this.checkGatewayAvailability(e,t))return t;return null})}getDefaultGateway(){return this.config.mode==="gateway"&&this.config.gateway?this.config.gateway:this.publicGateways[0]}getPublicGateways(){return[...this.publicGateways]}formatBytes(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}generateProtocolLink(e){return`ipfs://${e}`}generateIPNSLink(e){return`ipns://${e}`}static \u0275fac=function(t){return new(t||r)(Ee(Ws))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var Ws="IPFS_CONFIG",uu=class r{constructor(e,t,n,o){this.shareLinkService=o;this.ipfsClient=new x4(t,e),this.localCache=n,this.loadCidMappings()}ipfsClient;localCache;cidToPathMap=new Map;pathToCidMap=new Map;write(e,t){return f(this,null,function*(){try{yield this.localCache.write(e,t);let n=yield H1(this.ipfsClient.add(t));this.cidToPathMap.set(n.cid,e),this.pathToCidMap.set(e,n.cid),yield this.saveCidMappings(),console.log(`Stored ${e} with CID: ${n.cid}`)}catch(n){throw console.error("Failed to write to IPFS:",n),n}})}read(e){return f(this,null,function*(){try{if(yield this.localCache.exists(e))return yield this.localCache.read(e);let t=this.pathToCidMap.get(e);if(!t)throw new Error(`No CID mapping found for path: ${e}`);let n=yield H1(this.ipfsClient.get(t));return yield this.localCache.write(e,n),n}catch(t){throw console.error("Failed to read from IPFS:",t),t}})}exists(e){return f(this,null,function*(){return(yield this.localCache.exists(e))?!0:this.pathToCidMap.has(e)})}delete(e){return f(this,null,function*(){yield this.localCache.delete(e);let t=this.pathToCidMap.get(e);t&&(this.pathToCidMap.delete(e),this.cidToPathMap.delete(t),yield this.saveCidMappings())})}list(){return f(this,null,function*(){let e=yield this.localCache.list(),t=Array.from(this.pathToCidMap.keys());return Array.from(new Set([...e,...t]))})}loadCidMappings(){return f(this,null,function*(){try{let e=yield this.localCache.read("_ipfs_mappings"),t=JSON.parse(new TextDecoder().decode(e));this.cidToPathMap=new Map(t.cidToPath),this.pathToCidMap=new Map(t.pathToCid)}catch{console.log("No existing CID mappings found")}})}saveCidMappings(){return f(this,null,function*(){let e={cidToPath:Array.from(this.cidToPathMap.entries()),pathToCid:Array.from(this.pathToCidMap.entries())},t=new TextEncoder().encode(JSON.stringify(e));yield this.localCache.write("_ipfs_mappings",t)})}getCidForPath(e){return this.pathToCidMap.get(e)}isHealthy(){return f(this,null,function*(){try{return yield H1(this.ipfsClient.isHealthy())}catch{return!1}})}generateShareLink(e,t){let n=this.getCidForPath(e);return n?this.shareLinkService.generateShareLink(n,{filename:t}):null}generateMultipleShareLinks(e,t){let n=this.getCidForPath(e);return n?this.shareLinkService.generateMultipleShareLinks(n,{filename:t}):[]}getShareLinkService(){return this.shareLinkService}static \u0275fac=function(t){return new(t||r)(Ee(Ws),Ee(Yh),Ee(ym),Ee(vm))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var $U=Symbol.for("@libp2p/connection");var Ga=Symbol.for("@libp2p/content-routing");var af=Symbol.for("@libp2p/peer-discovery");var S4=Symbol.for("@libp2p/peer-id");function us(r){return!!r?.[S4]}var Ya=Symbol.for("@libp2p/peer-routing");var du="keep-alive";var fu=Symbol.for("@libp2p/transport");var wm=function(r){return r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL",r}(wm||{});var Mn=(()=>{class r extends Error{static name="AbortError";constructor(t="The operation was aborted"){super(t),this.name="AbortError"}}return r})(),zU=(()=>{class r extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}}return r})(),qU=(()=>{class r extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}}return r})(),Y=(()=>{class r extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}}return r})(),cf=(()=>{class r extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}}return r})(),w9=(()=>{class r extends Error{static name="InvalidPrivateKeyError";constructor(t="Invalid private key"){super(t),this.name="InvalidPrivateKeyError"}}return r})();var KU=(()=>{class r extends Error{static name="ConnectionClosingError";constructor(t="The connection is closing"){super(t),this.name="ConnectionClosingError"}}return r})(),_4=(()=>{class r extends Error{static name="ConnectionClosedError";constructor(t="The connection is closed"){super(t),this.name="ConnectionClosedError"}}return r})(),C4=(()=>{class r extends Error{static name="ConnectionFailedError";constructor(t="Connection failed"){super(t),this.name="ConnectionFailedError"}}return r})(),pu=(()=>{class r extends Error{static name="MuxerClosedError";constructor(t="The muxer is closed"){super(t),this.name="MuxerClosedError"}}return r})(),WU=(()=>{class r extends Error{static name="StreamResetError";constructor(t="The stream has been reset"){super(t),this.name="StreamResetError"}}return r})(),py=(()=>{class r extends Error{static name="StreamStateError";constructor(t="The stream is in an invalid state"){super(t),this.name="StreamStateError"}}return r})(),kt=(()=>{class r extends Error{static name="NotFoundError";constructor(t="Not found"){super(t),this.name="NotFoundError"}}return r})(),I4=(()=>{class r extends Error{static name="InvalidPeerIdError";constructor(t="Invalid PeerID"){super(t),this.name="InvalidPeerIdError"}}return r})(),bm=(()=>{class r extends Error{static name="InvalidMultiaddrError";constructor(t="Invalid multiaddr"){super(t),this.name="InvalidMultiaddrError"}}return r})(),GU=(()=>{class r extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}}return r})(),Em=(()=>{class r extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}}return r})(),lf=(()=>{class r extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}}return r})(),vt=(()=>{class r extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}}return r})(),YU=(()=>{class r extends Error{static name="ProtocolError";constructor(t="Protocol error"){super(t),this.name="ProtocolError"}}return r})(),Xa=(()=>{class r extends Error{static name="TimeoutError";constructor(t="Timed out"){super(t),this.name="TimeoutError"}}return r})(),Gs=(()=>{class r extends Error{static name="NotStartedError";constructor(t="Not started"){super(t),this.name="NotStartedError"}}return r})();var uf=(()=>{class r extends Error{static name="DialError";constructor(t="Dial error"){super(t),this.name="DialError"}}return r})(),hy=(()=>{class r extends Error{static name="ListenError";constructor(t="Listen error"){super(t),this.name="ListenError"}}return r})(),A4=(()=>{class r extends Error{static name="LimitedConnectionError";constructor(t="Limited connection"){super(t),this.name="LimitedConnectionError"}}return r})(),XU=(()=>{class r extends Error{static name="TooManyInboundProtocolStreamsError";constructor(t="Too many inbound protocol streams"){super(t),this.name="TooManyInboundProtocolStreamsError"}}return r})(),xm=(()=>{class r extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(t="Too many outbound protocol streams"){super(t),this.name="TooManyOutboundProtocolStreamsError"}}return r})(),Qc=(()=>{class r extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}}return r})();var nt=class extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let o=this.#e.get(e);o==null&&(o=[],this.#e.set(e,o)),o.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let o=this.#e.get(e);o!=null&&(o=o.filter(({callback:i})=>i!==t),this.#e.set(e,o))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:o})=>!o),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}};function D4(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}function kn(...r){return f(this,null,function*(){let e=[];for(let t of r)D4(t)&&e.push(t);yield Promise.all(e.map(t=>f(null,null,function*(){t.beforeStart!=null&&(yield t.beforeStart())}))),yield Promise.all(e.map(t=>f(null,null,function*(){yield t.start()}))),yield Promise.all(e.map(t=>f(null,null,function*(){t.afterStart!=null&&(yield t.afterStart())})))})}function oo(...r){return f(this,null,function*(){let e=[];for(let t of r)D4(t)&&e.push(t);yield Promise.all(e.map(t=>f(null,null,function*(){t.beforeStop!=null&&(yield t.beforeStop())}))),yield Promise.all(e.map(t=>f(null,null,function*(){yield t.stop()}))),yield Promise.all(e.map(t=>f(null,null,function*(){t.afterStop!=null&&(yield t.afterStop())})))})}var At=Symbol.for("@libp2p/service-capabilities"),Ci=Symbol.for("@libp2p/service-dependencies");var b9={};Dn(b9,{base64:()=>Yr,base64pad:()=>Due,base64url:()=>Zc,base64urlpad:()=>Tue});var Yr=Wi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Due=Wi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Zc=Wi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Tue=Wi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Pue(r,e){try{if(typeof r=="string"&&r.length>0)return Mue(r);if(typeof r=="number"&&isFinite(r))return e?.long?Rue(r):kue(r);throw new Error("Value is not a string or number.")}catch(t){let n=Nue(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function Mue(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");let e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;let t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*315576e5;case"weeks":case"week":case"w":return t*6048e5;case"days":case"day":case"d":return t*864e5;case"hours":case"hour":case"hrs":case"hr":case"h":return t*36e5;case"minutes":case"minute":case"mins":case"min":case"m":return t*6e4;case"seconds":case"second":case"secs":case"sec":case"s":return t*1e3;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}var P4=Pue;function kue(r){let e=Math.abs(r);return e>=864e5?`${Math.round(r/864e5)}d`:e>=36e5?`${Math.round(r/36e5)}h`:e>=6e4?`${Math.round(r/6e4)}m`:e>=1e3?`${Math.round(r/1e3)}s`:`${r}ms`}function Rue(r){let e=Math.abs(r);return e>=864e5?T4(r,e,864e5,"day"):e>=36e5?T4(r,e,36e5,"hour"):e>=6e4?T4(r,e,6e4,"minute"):e>=1e3?T4(r,e,1e3,"second"):`${r} ms`}function T4(r,e,t,n){let o=e>=t*1.5;return`${Math.round(r/t)} ${n}${o?"s":""}`}function Nue(r){return typeof r=="object"&&r!==null&&"message"in r}function E9(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=o,t.enabled=s,t.humanize=P4,t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,p,m;function y(...b){if(!y.enabled)return;let x=y,A=Number(new Date),P=A-(d||A);x.diff=P,x.prev=d,x.curr=A,d=A,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let L=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(W,H)=>{if(W==="%%")return"%";L++;let U=t.formatters[H];if(typeof U=="function"){let T=b[L];W=U.call(x,T),b.splice(L,1),L--}return W}),t.formatArgs.call(x,b),(x.log||t.log).apply(x,b)}return y.namespace=u,y.useColors=t.useColors(),y.color=t.selectColor(u),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,m=t.enabled(u)),m),set:b=>{h=b}}),typeof t.init=="function"&&t.init(y),y}function n(u,d){let h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function o(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d,h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(u))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var M4=jue(),Oue=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Lue(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function Fue(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+P4(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(n=t))}),r.splice(n,0,e)}var Bue=console.debug??console.log??(()=>{});function Uue(r){try{r?M4?.setItem("debug",r):M4?.removeItem("debug")}catch{}}function Vue(){let r;try{r=M4?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=globalThis.process.env.DEBUG),r}function jue(){try{return localStorage}catch{}}function Hue(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}var QU=E9({formatArgs:Fue,save:Uue,load:Vue,useColors:Lue,setupFormatters:Hue,colors:Oue,storage:M4,log:Bue});var Go=QU;Go.formatters.b=r=>r==null?"undefined":Sr.baseEncode(r);Go.formatters.t=r=>r==null?"undefined":Gi.baseEncode(r);Go.formatters.m=r=>r==null?"undefined":Yr.baseEncode(r);Go.formatters.p=r=>r==null?"undefined":r.toString();Go.formatters.c=r=>r==null?"undefined":r.toString();Go.formatters.k=r=>r==null?"undefined":r.toString();Go.formatters.a=r=>r==null?"undefined":r.toString();Go.formatters.e=r=>r==null?"undefined":ZU(r.stack)??ZU(r.message)??r.toString();function $ue(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function hu(){return{forComponent(r){return Dt(r)}}}function Dt(r){let e=$ue(`${r}:trace`);return Go.enabled(`${r}:trace`)&&Go.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Go(`${r}:trace`)),Object.assign(Go(r),{error:Go(`${r}:error`),trace:e})}function ZU(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}var fe=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}};var S9=xr(eV(),1);var gy=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},_9=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},tV=r=>globalThis.DOMException===void 0?new _9(r):new DOMException(r),rV=r=>{let e=r.reason===void 0?tV("This operation was aborted."):r.reason;return e instanceof Error?e:tV(e)};function Jc(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a,l=new Promise((u,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:p}=e;p.aborted&&d(rV(p)),a=()=>{d(rV(p))},p.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,d);return}let h=new gy;s=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(p){d(p)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?u():o instanceof Error?d(o):(h.message=o??`Promise timed out after ${t} milliseconds`,d(h))},t),f(null,null,function*(){try{u(yield r)}catch(p){d(p)}})}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},l}function C9(r,e,t){let n=0,o=r.length;for(;o>0;){let i=Math.trunc(o/2),s=n+i;t(r[s],e)<=0?(n=++s,o-=i+1):o=i}return n}var R4=class{#e=[];enqueue(e,t){t=v({priority:0},t);let n={priority:t.priority,id:t.id,run:e};if(this.size===0||this.#e[this.size-1].priority>=t.priority){this.#e.push(n);return}let o=C9(this.#e,n,(i,s)=>s.priority-i.priority);this.#e.splice(o,0,n)}setPriority(e,t){let n=this.#e.findIndex(i=>i.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[o]=this.#e.splice(n,1);this.enqueue(o.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}};var mu=class extends S9.default{#e;#t;#r=0;#a;#s;#l=0;#o;#u;#n;#m;#i=0;#d;#c;#g;#w=1n;timeout;constructor(e){if(super(),e=v({carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:R4},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#a=e.intervalCap,this.#s=e.interval,this.#n=new e.queueClass,this.#m=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#g=e.throwOnTimeout===!0,this.#c=e.autoStart===!1}get#b(){return this.#t||this.#r<this.#a}get#E(){return this.#i<this.#d}#x(){this.#i--,this.#f(),this.emit("next")}#S(){this.#v(),this.#y(),this.#u=void 0}get#_(){let e=Date.now();if(this.#o===void 0){let t=this.#l-e;if(t<0)this.#r=this.#e?this.#i:0;else return this.#u===void 0&&(this.#u=setTimeout(()=>{this.#S()},t)),!0}return!1}#f(){if(this.#n.size===0)return this.#o&&clearInterval(this.#o),this.#o=void 0,this.emit("empty"),this.#i===0&&this.emit("idle"),!1;if(!this.#c){let e=!this.#_;if(this.#b&&this.#E){let t=this.#n.dequeue();return t?(this.emit("active"),t(),e&&this.#y(),!0):!1}}return!1}#y(){this.#t||this.#o!==void 0||(this.#o=setInterval(()=>{this.#v()},this.#s),this.#l=Date.now()+this.#s)}#v(){this.#r===0&&this.#i===0&&this.#o&&(clearInterval(this.#o),this.#o=void 0),this.#r=this.#e?this.#i:0,this.#p()}#p(){for(;this.#f(););}get concurrency(){return this.#d}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#d=e,this.#p()}#C(e){return f(this,null,function*(){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})})}setPriority(e,t){this.#n.setPriority(e,t)}add(n){return f(this,arguments,function*(e,t={}){return t.id??=(this.#w++).toString(),t=v({timeout:this.timeout,throwOnTimeout:this.#g},t),new Promise((o,i)=>{this.#n.enqueue(()=>f(this,null,function*(){this.#i++,this.#r++;try{t.signal?.throwIfAborted();let s=e({signal:t.signal});t.timeout&&(s=Jc(Promise.resolve(s),{milliseconds:t.timeout})),t.signal&&(s=Promise.race([s,this.#C(t.signal)]));let a=yield s;o(a),this.emit("completed",a)}catch(s){if(s instanceof gy&&!t.throwOnTimeout){o();return}i(s),this.emit("error",s)}finally{this.#x()}}),t),this.emit("add"),this.#f()})})}addAll(e,t){return f(this,null,function*(){return Promise.all(e.map(n=>f(this,null,function*(){return this.add(n,t)})))})}start(){return this.#c?(this.#c=!1,this.#p(),this):this}pause(){this.#c=!0}clear(){this.#n=new this.#m}onEmpty(){return f(this,null,function*(){this.#n.size!==0&&(yield this.#h("empty"))})}onSizeLessThan(e){return f(this,null,function*(){this.#n.size<e||(yield this.#h("next",()=>this.#n.size<e))})}onIdle(){return f(this,null,function*(){this.#i===0&&this.#n.size===0||(yield this.#h("idle"))})}#h(e,t){return f(this,null,function*(){return new Promise(n=>{let o=()=>{t&&!t()||(this.off(e,o),n())};this.on(e,o)})})}get size(){return this.#n.size}sizeBy(e){return this.#n.filter(e).length}get pending(){return this.#i}get isPaused(){return this.#c}};function N4(r){let e=[ds.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}var I9={};Dn(I9,{base10:()=>Kue});var Kue=CR({prefix:"9",name:"base10",alphabet:"0123456789"});var A9={};Dn(A9,{base16:()=>Wue,base16upper:()=>Gue});var Wue=Wi({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gue=Wi({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var D9={};Dn(D9,{base2:()=>Yue});var Yue=Wi({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var T9={};Dn(T9,{base256emoji:()=>ede});var nV=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Xue=nV.reduce((r,e,t)=>(r[t]=e,r),[]),Que=nV.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Zue(r){return r.reduce((e,t)=>(e+=Xue[t],e),"")}function Jue(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let o=Que[n];if(o==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(o)}return new Uint8Array(e)}var ede=bw({prefix:"\u{1F680}",name:"base256emoji",encode:Zue,decode:Jue});var P9={};Dn(P9,{base8:()=>tde});var tde=Wi({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var M9={};Dn(M9,{identity:()=>rde});var rde=bw({prefix:"\0",name:"identity",encode:r=>_R(r),decode:r=>SR(r)});var Sm={};Dn(Sm,{code:()=>yy,decode:()=>k9,encode:()=>sde,name:()=>ide});var nde=new TextEncoder,ode=new TextDecoder,ide="json",yy=512;function sde(r){return nde.encode(JSON.stringify(r))}function k9(r){return JSON.parse(ode.decode(r))}var Po={};Dn(Po,{code:()=>Tr,decode:()=>lde,encode:()=>cde,name:()=>ade});var ade="raw",Tr=85;function cde(r){return O1(r)}function lde(r){return O1(r)}var R9={};Dn(R9,{identity:()=>wn});var oV=0,ude="identity",iV=O1;function dde(r){return yi(oV,iV(r))}var wn={code:oV,name:ude,encode:iV,digest:dde};var O9={};Dn(O9,{sha256:()=>wt,sha512:()=>O4});function df({name:r,code:e,encode:t}){return new N9(r,e,t)}var N9=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?yi(this.code,t):t.then(n=>yi(this.code,n))}else throw Error("Unknown type, must be binary type")}};function aV(r){return e=>f(null,null,function*(){return new Uint8Array(yield crypto.subtle.digest(r,e))})}var wt=df({name:"sha2-256",code:18,encode:aV("SHA-256")}),O4=df({name:"sha2-512",code:19,encode:aV("SHA-512")});var ff=v(v(v(v(v(v(v(v(v(v({},M9),D9),P9),I9),A9),AR),TR),DR),b9),T9),tOe=v(v({},O9),R9);function Qe(r=0){return new Uint8Array(r)}function wr(r=0){return new Uint8Array(r)}function lV(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var cV=lV("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),L9=lV("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=wr(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),pde=v({utf8:cV,"utf-8":cV,hex:ff.base16,latin1:L9,ascii:L9,binary:L9},ff),L4=pde;function te(r,e="utf8"){let t=L4[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var F9=60;function F4(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:ds[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:ds[e.type],TTL:e.TTL??e.ttl??F9,data:e.data instanceof Uint8Array?te(e.data):e.data}))}}var hde=4;function B9(r,e={}){let t=new mu({concurrency:e.queryConcurrency??hde});return(i,...s)=>f(null,[i,...s],function*(n,o={}){let a=new URLSearchParams;a.set("name",n),N4(o.types).forEach(l=>{a.append("type",ds[l])}),o.onProgress?.(new fe("dns:query",{detail:n}));let c=yield t.add(()=>f(null,null,function*(){let l=yield fetch(`${r}?${a}`,{headers:{accept:"application/dns-json"},signal:o?.signal});if(l.status!==200)throw new Error(`Unexpected HTTP status: ${l.status} - ${l.statusText}`);let u=F4(yield l.json());return o.onProgress?.(new fe("dns:response",{detail:u})),u}),{signal:o.signal});if(c==null)throw new Error("No DNS response received");return c})}function uV(){return[B9("https://cloudflare-dns.com/dns-query"),B9("https://dns.google/resolve")]}var pV=xr(fV(),1);var U9=class{lru;constructor(e){this.lru=(0,pV.default)(e)}get(e,t){let n=!0,o=[];for(let i of t){let s=this.getAnswers(e,i);if(s.length===0){n=!1;break}o.push(...s)}if(n)return F4({answers:o})}getAnswers(e,t){let n=`${e.toLowerCase()}-${t}`,o=this.lru.get(n);if(o!=null){let i=o.filter(s=>s.expires>Date.now()).map(({expires:s,value:a})=>I(v({},a),{TTL:Math.round((s-Date.now())/1e3),type:ds[a.type]}));return i.length===0&&this.lru.remove(n),i}return[]}add(e,t){let n=`${e.toLowerCase()}-${t.type}`,o=this.lru.get(n)??[];o.push({expires:Date.now()+(t.TTL??F9)*1e3,value:t}),this.lru.set(n,o)}remove(e,t){let n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}};function hV(r){return new U9(r)}var mde=1e3,B4=class{resolvers;cache;constructor(e){this.resolvers={},this.cache=hV(e.cacheSize??mde),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=uV())}query(n){return f(this,arguments,function*(e,t={}){let o=N4(t.types),i=t.cached!==!1?this.cache.get(e,o):void 0;if(i!=null)return t.onProgress?.(new fe("dns:cache",{detail:i})),i;let s=`${e.split(".").pop()}.`,a=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),c=[];for(let l of a){if(t.signal?.aborted===!0)break;try{let u=yield l(e,I(v({},t),{types:o}));for(let d of u.Answer)this.cache.add(e,d);return u}catch(u){c.push(u),t.onProgress?.(new fe("dns:error",{detail:u}))}}throw c.length===1?c[0]:new AggregateError(c,`DNS lookup of ${e} ${o} failed`)})}};var ds=function(r){return r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA",r}(ds||{});function U4(r={}){return new B4(r)}function gde(r){return r[Symbol.asyncIterator]!=null}function yde(r){if(gde(r))return f(null,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield e.next()).done;t=!1){let i=n.value;;}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield n.call(e))}finally{if(o)throw o[0]}}});for(let e of r);}var Yo=yde;function ze(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var V4=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},_m=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new V4(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new V4(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var V9=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Xr(r={}){return vde(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function vde(r,e){e=e??{};let t=e.onEnd,n=new _m,o,i,s,a=ze(),c=()=>f(null,null,function*(){try{return n.isEmpty()?s?{done:!0}:yield new Promise((b,x)=>{i=A=>{i=null,n.push(A);try{b(r(n))}catch(P){x(P)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=ze()})}}),l=b=>i!=null?i(b):(n.push(b),o),u=b=>(n=new _m,i!=null?i({error:b}):(n.push({error:b}),o)),d=b=>{if(s)return o;if(e?.objectMode!==!0&&b?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:b})},h=b=>s?o:(s=!0,b!=null?u(b):l({done:!0})),p=()=>(n=new _m,h(),{done:!0}),m=b=>(h(b),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:p,throw:m,push:d,end:h,get readableLength(){return n.size},onEmpty:b=>f(null,null,function*(){let x=b?.signal;if(x?.throwIfAborted(),n.isEmpty())return;let A,P;x!=null&&(A=new Promise((L,F)=>{P=()=>{F(new V9)},x.addEventListener("abort",P)}));try{yield Promise.race([a.promise,A])}finally{P!=null&&x!=null&&x?.removeEventListener("abort",P)}})},t==null)return o;let y=o;return o={[Symbol.asyncIterator](){return this},next(){return y.next()},throw(b){return y.throw(b),t!=null&&(t(b),t=void 0),{done:!0}},return(){return y.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(b){return y.end(b),t!=null&&(t(b),t=void 0),o},get readableLength(){return y.readableLength},onEmpty:b=>y.onEmpty(b)},o}var j9=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}};function Pr(r,e,t,n){return f(this,null,function*(){let o=new j9(n?.errorMessage,n?.errorCode);return t?.aborted===!0?Promise.reject(o):new Promise((i,s)=>{function a(){t?.removeEventListener("abort",u),r.removeEventListener(e,c),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,l)}let c=d=>{try{if(n?.filter?.(d)===!1)return}catch(h){a(),s(h);return}a(),i(d)},l=d=>{a(),s(d.detail)},u=()=>{a(),s(o)};t?.addEventListener("abort",u),r.addEventListener(e,c),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,l)})})}function el(r,e){let t,n=function(){let o=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(o,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}var j4=class extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}},mV=(()=>{class r extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}}return r})();var H4=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};function lt(r,e,t){return f(this,null,function*(){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new H4(t?.errorMessage,t?.errorCode,t?.errorName));let n,o=new H4(t?.errorMessage,t?.errorCode,t?.errorName);try{return yield Promise.race([r,new Promise((i,s)=>{n=()=>{s(o)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}})}var $4=class{deferred;signal;constructor(e){this.signal=e,this.deferred=ze(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new Mn)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function wde(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var z4=class{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=wde(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new Mn),this.cleanup())}join(){return f(this,arguments,function*(e={}){let t=new $4(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise})}run(){return f(this,null,function*(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=yield lt(this.fn(I(v({},this.options??{}),{signal:this.controller.signal})),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}})}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}};var Rn=class extends nt{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,e.metricName!=null&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[],this.emitEmpty=el(this.emitEmpty.bind(this),1),this.emitIdle=el(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}add(e,t){return f(this,null,function*(){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new mV;let n=new z4(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(t).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:n,result:o}}),o)).catch(o=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:n,error:o}}),o})})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new Mn)}),this.clear()}onEmpty(e){return f(this,null,function*(){this.size!==0&&(yield Pr(this,"empty",e?.signal))})}onSizeLessThan(e,t){return f(this,null,function*(){this.size<e||(yield Pr(this,"next",t?.signal,{filter:()=>this.size<e}))})}onIdle(e){return f(this,null,function*(){this.pending===0&&this.size===0||(yield Pr(this,"idle",e?.signal))})}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}toGenerator(e){return M(this,null,function*(){e?.signal?.throwIfAborted();let t=Xr({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},o=c=>{c.detail!=null&&t.push(c.detail)},i=c=>{n(c.detail)},s=()=>{n()},a=()=>{n(new Mn("Queue aborted"))};this.addEventListener("completed",o),this.addEventListener("error",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",a);try{yield*Q(t)}finally{this.removeEventListener("completed",o),this.removeEventListener("error",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",a),n()}})}};var bde=["string","number","bigint","symbol"],Ede=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function gV(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(bde.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(xde(r))return"Buffer";let t=Sde(r);return t||"Object"}function xde(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function Sde(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(Ede.includes(e))return e}var B=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};B.uint=new B(0,"uint",!0);B.negint=new B(1,"negint",!0);B.bytes=new B(2,"bytes",!0);B.string=new B(3,"string",!0);B.array=new B(4,"array",!1);B.map=new B(5,"map",!1);B.tag=new B(6,"tag",!1);B.float=new B(7,"float",!0);B.false=new B(7,"false",!0);B.true=new B(7,"true",!0);B.null=new B(7,"null",!0);B.undefined=new B(7,"undefined",!0);B.break=new B(7,"break",!0);var ie=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Cm=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",_de=new TextDecoder,Cde=new TextEncoder;function q4(r){return Cm&&globalThis.Buffer.isBuffer(r)}function vy(r){return r instanceof Uint8Array?q4(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var bV=Cm?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):vV(r,e,t):(r,e,t)=>t-e>64?_de.decode(r.subarray(e,t)):vV(r,e,t),K4=Cm?r=>r.length>64?globalThis.Buffer.from(r):yV(r):r=>r.length>64?Cde.encode(r):yV(r),Qa=r=>Uint8Array.from(r),Im=Cm?(r,e,t)=>q4(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),EV=Cm?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),vy(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let o of r)n+o.length>t.length&&(o=o.subarray(0,t.length-n)),t.set(o,n),n+=o.length;return t},xV=Cm?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function SV(r,e){if(q4(r)&&q4(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function yV(r){let e=[],t=0;for(let n=0;n<r.length;n++){let o=r.charCodeAt(n);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(o=65536+((o&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128)}return e}function vV(r,e,t){let n=[];for(;e<t;){let o=r[e],i=null,s=o>239?4:o>223?3:o>191?2:1;if(e+s<=t){let a,c,l,u;switch(s){case 1:o<128&&(i=o);break;case 2:a=r[e+1],(a&192)===128&&(u=(o&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(o&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(o&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=s}return H9(n)}var wV=4096;function H9(r){let e=r.length;if(e<=wV)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=wV));return t}var Ide=256,wy=class{constructor(e=Ide){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let o=t.length-(this.maxCursor-this.cursor)-1;t.set(e,o)}else{if(t){let o=t.length-(this.maxCursor-this.cursor)-1;o<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=xV(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Im(n,0,this.cursor)}else t=EV(this.chunks,this.cursor);return e&&this.reset(),t}};var Pe="CBOR decode error:",tl="CBOR encode error:",by=[];by[23]=1;by[24]=2;by[25]=3;by[26]=5;by[27]=9;function rl(r,e,t){if(r.length-e<t)throw new Error(`${Pe} not enough data for type`)}var bn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ii(r,e,t){rl(r,e,1);let n=r[e];if(t.strict===!0&&n<bn[0])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function Ai(r,e,t){rl(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<bn[1])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function Di(r,e,t){rl(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<bn[2])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);return n}function Ti(r,e,t){rl(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],o=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(t.strict===!0&&i<bn[3])throw new Error(`${Pe} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${Pe} integers outside of the safe integer range are not supported`)}function _V(r,e,t,n){return new ie(B.uint,Ii(r,e+1,n),2)}function CV(r,e,t,n){return new ie(B.uint,Ai(r,e+1,n),3)}function IV(r,e,t,n){return new ie(B.uint,Di(r,e+1,n),5)}function AV(r,e,t,n){return new ie(B.uint,Ti(r,e+1,n),9)}function fs(r,e){return Nn(r,0,e.value)}function Nn(r,e,t){if(t<bn[0]){let n=Number(t);r.push([e|n])}else if(t<bn[1]){let n=Number(t);r.push([e|24,n])}else if(t<bn[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<bn[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<bn[4]){let o=[e|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,r.push(o)}else throw new Error(`${Pe} encountered BigInt larger than allowable range`)}}fs.encodedSize=function(e){return Nn.encodedSize(e.value)};Nn.encodedSize=function(e){return e<bn[0]?1:e<bn[1]?2:e<bn[2]?3:e<bn[3]?5:9};fs.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function DV(r,e,t,n){return new ie(B.negint,-1-Ii(r,e+1,n),2)}function TV(r,e,t,n){return new ie(B.negint,-1-Ai(r,e+1,n),3)}function PV(r,e,t,n){return new ie(B.negint,-1-Di(r,e+1,n),5)}var $9=BigInt(-1),MV=BigInt(1);function kV(r,e,t,n){let o=Ti(r,e+1,n);if(typeof o!="bigint"){let i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new ie(B.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${Pe} integers outside of the safe integer range are not supported`);return new ie(B.negint,$9-BigInt(o),9)}function W4(r,e){let t=e.value,n=typeof t=="bigint"?t*$9-MV:t*-1-1;Nn(r,e.type.majorEncoded,n)}W4.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*$9-MV:t*-1-1;return n<bn[0]?1:n<bn[1]?2:n<bn[2]?3:n<bn[3]?5:9};W4.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Ey(r,e,t,n){rl(r,e,t+n);let o=Im(r,e+t,e+t+n);return new ie(B.bytes,o,t+n)}function RV(r,e,t,n){return Ey(r,e,1,t)}function NV(r,e,t,n){return Ey(r,e,2,Ii(r,e+1,n))}function OV(r,e,t,n){return Ey(r,e,3,Ai(r,e+1,n))}function LV(r,e,t,n){return Ey(r,e,5,Di(r,e+1,n))}function FV(r,e,t,n){let o=Ti(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Pe} 64-bit integer bytes lengths not supported`);return Ey(r,e,9,o)}function G4(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===B.string?K4(r.value):r.value),r.encodedBytes}function Am(r,e){let t=G4(e);Nn(r,e.type.majorEncoded,t.length),r.push(t)}Am.encodedSize=function(e){let t=G4(e);return Nn.encodedSize(t.length)+t.length};Am.compareTokens=function(e,t){return Dde(G4(e),G4(t))};function Dde(r,e){return r.length<e.length?-1:r.length>e.length?1:SV(r,e)}function xy(r,e,t,n,o){let i=t+n;rl(r,e,i);let s=new ie(B.string,bV(r,e+t,e+i),i);return o.retainStringBytes===!0&&(s.byteValue=Im(r,e+t,e+i)),s}function BV(r,e,t,n){return xy(r,e,1,t,n)}function UV(r,e,t,n){return xy(r,e,2,Ii(r,e+1,n),n)}function VV(r,e,t,n){return xy(r,e,3,Ai(r,e+1,n),n)}function jV(r,e,t,n){return xy(r,e,5,Di(r,e+1,n),n)}function HV(r,e,t,n){let o=Ti(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Pe} 64-bit integer string lengths not supported`);return xy(r,e,9,o,n)}var $V=Am;function Dm(r,e,t,n){return new ie(B.array,n,t)}function zV(r,e,t,n){return Dm(r,e,1,t)}function qV(r,e,t,n){return Dm(r,e,2,Ii(r,e+1,n))}function KV(r,e,t,n){return Dm(r,e,3,Ai(r,e+1,n))}function WV(r,e,t,n){return Dm(r,e,5,Di(r,e+1,n))}function GV(r,e,t,n){let o=Ti(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Pe} 64-bit integer array lengths not supported`);return Dm(r,e,9,o)}function YV(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return Dm(r,e,1,1/0)}function Y4(r,e){Nn(r,B.array.majorEncoded,e.value)}Y4.compareTokens=fs.compareTokens;Y4.encodedSize=function(e){return Nn.encodedSize(e.value)};function Tm(r,e,t,n){return new ie(B.map,n,t)}function XV(r,e,t,n){return Tm(r,e,1,t)}function QV(r,e,t,n){return Tm(r,e,2,Ii(r,e+1,n))}function ZV(r,e,t,n){return Tm(r,e,3,Ai(r,e+1,n))}function JV(r,e,t,n){return Tm(r,e,5,Di(r,e+1,n))}function ej(r,e,t,n){let o=Ti(r,e+1,n);if(typeof o=="bigint")throw new Error(`${Pe} 64-bit integer map lengths not supported`);return Tm(r,e,9,o)}function tj(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return Tm(r,e,1,1/0)}function X4(r,e){Nn(r,B.map.majorEncoded,e.value)}X4.compareTokens=fs.compareTokens;X4.encodedSize=function(e){return Nn.encodedSize(e.value)};function rj(r,e,t,n){return new ie(B.tag,t,1)}function nj(r,e,t,n){return new ie(B.tag,Ii(r,e+1,n),2)}function oj(r,e,t,n){return new ie(B.tag,Ai(r,e+1,n),3)}function ij(r,e,t,n){return new ie(B.tag,Di(r,e+1,n),5)}function sj(r,e,t,n){return new ie(B.tag,Ti(r,e+1,n),9)}function Q4(r,e){Nn(r,B.tag.majorEncoded,e.value)}Q4.compareTokens=fs.compareTokens;Q4.encodedSize=function(e){return Nn.encodedSize(e.value)};var Nde=20,Ode=21,Lde=22,Fde=23;function aj(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Pe} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ie(B.null,null,1):new ie(B.undefined,void 0,1)}function cj(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Pe} indefinite length items not allowed`);return new ie(B.break,void 0,1)}function z9(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Pe} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Pe} Infinity values are not supported`)}return new ie(B.float,r,e)}function lj(r,e,t,n){return z9(q9(r,e+1),3,n)}function uj(r,e,t,n){return z9(K9(r,e+1),5,n)}function dj(r,e,t,n){return z9(mj(r,e+1),9,n)}function Z4(r,e,t){let n=e.value;if(n===!1)r.push([B.float.majorEncoded|Nde]);else if(n===!0)r.push([B.float.majorEncoded|Ode]);else if(n===null)r.push([B.float.majorEncoded|Lde]);else if(n===void 0)r.push([B.float.majorEncoded|Fde]);else{let o,i=!1;(!t||t.float64!==!0)&&(pj(n),o=q9(Ys,1),n===o||Number.isNaN(n)?(Ys[0]=249,r.push(Ys.slice(0,3)),i=!0):(hj(n),o=K9(Ys,1),n===o&&(Ys[0]=250,r.push(Ys.slice(0,5)),i=!0))),i||(Bde(n),o=mj(Ys,1),Ys[0]=251,r.push(Ys.slice(0,9)))}}Z4.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){pj(n);let o=q9(Ys,1);if(n===o||Number.isNaN(n))return 3;if(hj(n),o=K9(Ys,1),n===o)return 5}return 9};var fj=new ArrayBuffer(9),ps=new DataView(fj,1),Ys=new Uint8Array(fj,0);function pj(r){if(r===1/0)ps.setUint16(0,31744,!1);else if(r===-1/0)ps.setUint16(0,64512,!1);else if(Number.isNaN(r))ps.setUint16(0,32256,!1);else{ps.setFloat32(0,r);let e=ps.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)ps.setUint16(0,31744,!1);else if(t===0)ps.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let o=t-127;o<-24?ps.setUint16(0,0):o<-14?ps.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):ps.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function q9(r,e){if(r.length-e<2)throw new Error(`${Pe} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,o=t&1023,i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,t&32768?-i:i}function hj(r){ps.setFloat32(0,r,!1)}function K9(r,e){if(r.length-e<4)throw new Error(`${Pe} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Bde(r){ps.setFloat64(0,r,!1)}function mj(r,e){if(r.length-e<8)throw new Error(`${Pe} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}Z4.compareTokens=fs.compareTokens;function Pt(r,e,t){throw new Error(`${Pe} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function J4(r){return()=>{throw new Error(`${Pe} ${r}`)}}var ve=[];for(let r=0;r<=23;r++)ve[r]=Pt;ve[24]=_V;ve[25]=CV;ve[26]=IV;ve[27]=AV;ve[28]=Pt;ve[29]=Pt;ve[30]=Pt;ve[31]=Pt;for(let r=32;r<=55;r++)ve[r]=Pt;ve[56]=DV;ve[57]=TV;ve[58]=PV;ve[59]=kV;ve[60]=Pt;ve[61]=Pt;ve[62]=Pt;ve[63]=Pt;for(let r=64;r<=87;r++)ve[r]=RV;ve[88]=NV;ve[89]=OV;ve[90]=LV;ve[91]=FV;ve[92]=Pt;ve[93]=Pt;ve[94]=Pt;ve[95]=J4("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ve[r]=BV;ve[120]=UV;ve[121]=VV;ve[122]=jV;ve[123]=HV;ve[124]=Pt;ve[125]=Pt;ve[126]=Pt;ve[127]=J4("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ve[r]=zV;ve[152]=qV;ve[153]=KV;ve[154]=WV;ve[155]=GV;ve[156]=Pt;ve[157]=Pt;ve[158]=Pt;ve[159]=YV;for(let r=160;r<=183;r++)ve[r]=XV;ve[184]=QV;ve[185]=ZV;ve[186]=JV;ve[187]=ej;ve[188]=Pt;ve[189]=Pt;ve[190]=Pt;ve[191]=tj;for(let r=192;r<=215;r++)ve[r]=rj;ve[216]=nj;ve[217]=oj;ve[218]=ij;ve[219]=sj;ve[220]=Pt;ve[221]=Pt;ve[222]=Pt;ve[223]=Pt;for(let r=224;r<=243;r++)ve[r]=J4("simple values are not supported");ve[244]=Pt;ve[245]=Pt;ve[246]=Pt;ve[247]=aj;ve[248]=J4("simple values are not supported");ve[249]=lj;ve[250]=uj;ve[251]=dj;ve[252]=Pt;ve[253]=Pt;ve[254]=Pt;ve[255]=cj;var Xs=[];for(let r=0;r<24;r++)Xs[r]=new ie(B.uint,r,1);for(let r=-1;r>=-24;r--)Xs[31-r]=new ie(B.negint,r,1);Xs[64]=new ie(B.bytes,new Uint8Array(0),1);Xs[96]=new ie(B.string,"",1);Xs[128]=new ie(B.array,0,1);Xs[160]=new ie(B.map,0,1);Xs[244]=new ie(B.false,!1,1);Xs[245]=new ie(B.true,!0,1);Xs[246]=new ie(B.null,null,1);function gj(r){switch(r.type){case B.false:return Qa([244]);case B.true:return Qa([245]);case B.null:return Qa([246]);case B.bytes:return r.value.length?void 0:Qa([64]);case B.string:return r.value===""?Qa([96]):void 0;case B.array:return r.value===0?Qa([128]):void 0;case B.map:return r.value===0?Qa([160]):void 0;case B.uint:return r.value<24?Qa([Number(r.value)]):void 0;case B.negint:if(r.value>=-24)return Qa([31-Number(r.value)])}}var Vde={float64:!1,mapSorter:$de,quickEncodeToken:gj};function jde(){let r=[];return r[B.uint.major]=fs,r[B.negint.major]=W4,r[B.bytes.major]=Am,r[B.string.major]=$V,r[B.array.major]=Y4,r[B.map.major]=X4,r[B.tag.major]=Q4,r[B.float.major]=Z4,r}var yj=jde(),W9=new wy,tE=class r{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${tl} object contains circular references`);return new r(t,e)}},gu={null:new ie(B.null,null),undefined:new ie(B.undefined,void 0),true:new ie(B.true,!0),false:new ie(B.false,!1),emptyArray:new ie(B.array,0),emptyMap:new ie(B.map,0)},yu={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ie(B.float,r):r>=0?new ie(B.uint,r):new ie(B.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ie(B.uint,r):new ie(B.negint,r)},Uint8Array(r,e,t,n){return new ie(B.bytes,r)},string(r,e,t,n){return new ie(B.string,r)},boolean(r,e,t,n){return r?gu.true:gu.false},null(r,e,t,n){return gu.null},undefined(r,e,t,n){return gu.undefined},ArrayBuffer(r,e,t,n){return new ie(B.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ie(B.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[gu.emptyArray,new ie(B.break)]:gu.emptyArray;n=tE.createCheck(n,r);let o=[],i=0;for(let s of r)o[i++]=eE(s,t,n);return t.addBreakTokens?[new ie(B.array,r.length),o,new ie(B.break)]:[new ie(B.array,r.length),o]},Object(r,e,t,n){let o=e!=="Object",i=o?r.keys():Object.keys(r),s=o?r.size:i.length;if(!s)return t.addBreakTokens===!0?[gu.emptyMap,new ie(B.break)]:gu.emptyMap;n=tE.createCheck(n,r);let a=[],c=0;for(let l of i)a[c++]=[eE(l,t,n),eE(o?r.get(l):r[l],t,n)];return Hde(a,t),t.addBreakTokens?[new ie(B.map,s),a,new ie(B.break)]:[new ie(B.map,s),a]}};yu.Map=yu.Object;yu.Buffer=yu.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))yu[`${r}Array`]=yu.DataView;function eE(r,e={},t){let n=gV(r),o=e&&e.typeEncoders&&e.typeEncoders[n]||yu[n];if(typeof o=="function"){let s=o(r,n,e,t);if(s!=null)return s}let i=yu[n];if(!i)throw new Error(`${tl} unsupported type: ${n}`);return i(r,n,e,t)}function Hde(r,e){e.mapSorter&&r.sort(e.mapSorter)}function $de(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let o=t.type.major,i=yj[o].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function vj(r,e,t,n){if(Array.isArray(e))for(let o of e)vj(r,o,t,n);else t[e.type.major](r,e,n)}function G9(r,e,t){let n=eE(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let o=t.quickEncodeToken(n);if(o)return o;let i=e[n.type.major];if(i.encodedSize){let s=i.encodedSize(n,t),a=new wy(s);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return vy(a.chunks[0])}}return W9.reset(),vj(W9,n,e,t),W9.toBytes(!0)}function vu(r,e){return e=Object.assign({},Vde,e),G9(r,yj,e)}var zde={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},rE=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=Xs[e];if(t===void 0){let n=ve[e];if(!n)throw new Error(`${Pe} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let o=e&31;t=n(this.data,this._pos,o,this.options)}return this._pos+=t.encodedLength,t}},Sy=Symbol.for("DONE"),nE=Symbol.for("BREAK");function qde(r,e,t){let n=[];for(let o=0;o<r.value;o++){let i=Pm(e,t);if(i===nE){if(r.value===1/0)break;throw new Error(`${Pe} got unexpected break to lengthed array`)}if(i===Sy)throw new Error(`${Pe} found array but not enough entries (got ${o}, expected ${r.value})`);n[o]=i}return n}function Kde(r,e,t){let n=t.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=Pm(e,t);if(a===nE){if(r.value===1/0)break;throw new Error(`${Pe} got unexpected break to lengthed map`)}if(a===Sy)throw new Error(`${Pe} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Pe} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in o))throw new Error(`${Pe} found repeat map key "${a}"`);let c=Pm(e,t);if(c===Sy)throw new Error(`${Pe} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function Pm(r,e){if(r.done())return Sy;let t=r.next();if(t.type===B.break)return nE;if(t.type.terminal)return t.value;if(t.type===B.array)return qde(t,r,e);if(t.type===B.map)return Kde(t,r,e);if(t.type===B.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=Pm(r,e);return e.tags[t.value](n)}throw new Error(`${Pe} tag not supported (${t.value})`)}throw new Error("unsupported")}function Y9(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Pe} data to decode must be a Uint8Array`);e=Object.assign({},zde,e);let t=e.tokenizer||new rE(r,e),n=Pm(t,e);if(n===Sy)throw new Error(`${Pe} did not find any content to decode`);if(n===nE)throw new Error(`${Pe} got unexpected break`);return[n,r.subarray(t.pos())]}function Pi(r,e){let[t,n]=Y9(r,e);if(n.length>0)throw new Error(`${Pe} too many terminals, data makes no sense`);return t}function Z(r,e="utf8"){let t=L4[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}var nl="/",wj=new TextEncoder().encode(nl),oE=wj[0],Ot=class r{_buf;constructor(e,t){if(typeof e=="string")this._buf=Z(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==oE)throw new Error("Invalid key")}toString(e="utf8"){return te(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new r(e.join(nl))}static random(){return new r(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new r(e):typeof e.uint8Array=="function"?new r(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=wj),this._buf[0]!==oE){let e=new Uint8Array(this._buf.byteLength+1);e.fill(oE,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===oE;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(nl).slice(1)}type(){return Wde(this.baseNamespace())}name(){return Gde(this.baseNamespace())}instance(e){return new r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(nl)||(e+=nl),e+=this.type(),new r(e)}parent(){let e=this.list();return e.length===1?new r(nl):new r(e.slice(0,-1).join(nl))}child(e){return this.toString()===nl?e:e.toString()===nl?this:new r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return r.withNamespaces([...this.namespaces(),...Yde(e.map(t=>t.namespaces()))])}};function Wde(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Gde(r){let e=r.split(":");return e[e.length-1]}function Yde(r){return[].concat(...r)}function iE({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Xde(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t],i=ce.asCID(n);i!=null?yield[o.join("/"),i]:typeof n=="object"&&(yield*Q(Q9(n,o)))}else{let t=ce.asCID(e);t!=null?yield[r.join("/"),t]:yield*Q(Q9(e,r))}}function*Q9(r,e){if(r==null||r instanceof Uint8Array)return;let t=ce.asCID(r);t!=null&&(yield[e.join("/"),t]);for(let[n,o]of Object.entries(r)){let i=[...e,n];yield*Q(Xde(i,o))}}function*Qde(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t];yield o.join("/"),typeof n=="object"&&ce.asCID(n)==null&&(yield*Q(Z9(n,o)))}else yield*Q(Z9(e,r))}function*Z9(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let o=[...e,t];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&ce.asCID(n)==null&&(yield*Q(Qde(o,n)))}}function Zde(r,e){let t=r;for(let[n,o]of e.entries()){if(t=t[o],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let i=ce.asCID(t);if(i!=null)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}var J9=class{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:n}){if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:iE(),bytes:iE(),value:iE(),asBlock:iE()})}links(){return Q9(this.value,[])}tree(){return Z9(this.value,[])}get(e="/"){return Zde(this.value,e.split("/").filter(Boolean))}};function bj({bytes:r,cid:e,value:t,codec:n}){let o=t!==void 0?t:n?.decode(r);if(o===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new J9({cid:e,bytes:r,value:o})}function Me(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var Sj="/pin/",Ej="/pinned-block/",eA=L1,xj=1;function sE(r){return r.version===0&&(r=r.toV1()),new Ot(`${Sj}${r.toString(eA)}`)}var aE=class{datastore;blockstore;getCodec;constructor(e,t,n){this.datastore=e,this.blockstore=t,this.getCodec=n}add(n){return M(this,arguments,function*(e,t={}){let o=sE(e);if(yield new S(this.datastore.has(o)))throw new Error("Already pinned");let i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");let s=new Rn({concurrency:xj});try{for(var c=O(this.#e(e,s,I(v({},t),{depth:i}))),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let h=u.value;yield new S(this.#t(h,p=>p.pinnedBy.find(m=>Me(m,e.bytes))!=null?!1:(p.pinCount++,p.pinnedBy.push(e.bytes),!0),t)),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}let a={depth:i,metadata:t.metadata??{}};yield new S(this.datastore.put(o,vu(a),t))})}#e(e,t,n){return M(this,null,function*(){if(n.depth===-1)return;let o=yield new S(this.getCodec(e.code)),i=yield new S(this.blockstore.get(e,n)),s=bj({bytes:i,cid:e,codec:o});yield e;for(let[,a]of s.links())yield*Q(yield new S(t.add(()=>f(this,null,function*(){return this.#e(a,t,I(v({},n),{depth:n.depth-1}))}))))})}#t(e,t,n){return f(this,null,function*(){let o=new Ot(`${Ej}${eA.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=Pi(yield this.datastore.get(o,n))}catch(a){if(a.name!=="NotFoundError")throw a}if(t(i)){if(i.pinCount===0&&(yield this.datastore.has(o))){yield this.datastore.delete(o);return}yield this.datastore.put(o,vu(i),n),n.onProgress?.(new fe("helia:pin:add",e))}})}rm(n){return M(this,arguments,function*(e,t={}){let o=sE(e),i=yield new S(this.datastore.get(o,t)),s=Pi(i);yield new S(this.datastore.delete(o,t));let a=new Rn({concurrency:xj});try{for(var c=O(this.#e(e,a,I(v({},t),{depth:s.depth}))),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let h=u.value;yield new S(this.#t(h,p=>(p.pinCount--,p.pinnedBy=p.pinnedBy.filter(m=>Me(m,e.bytes)),!0),I(v({},t),{depth:s.depth}))),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}})}ls(){return M(this,arguments,function*(e={}){try{for(var t=O(this.datastore.query({prefix:Sj+(e.cid!=null?`${e.cid.toString(L1)}`:"")},e)),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let{key:s,value:a}=o.value;let c=ce.parse(s.toString().substring(5),L1),l=Pi(a);yield v({cid:c},l)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})}isPinned(n){return f(this,arguments,function*(e,t={}){let o=new Ot(`${Ej}${eA.encode(e.multihash.bytes)}`);return this.datastore.has(o,t)})}get(e,t){return f(this,null,function*(){let n=sE(e),o=yield this.datastore.get(n,t);return Pi(o)})}setMetadata(e,t,n){return f(this,null,function*(){let o=sE(e),i=yield this.datastore.get(o,n),s=Pi(i);s.metadata=t??{},yield this.datastore.put(o,vu(s),n)})}};var _j=(()=>{class r extends Error{static name="InsufficientProvidersError";constructor(t="Insufficient providers found"){super(t),this.name="InsufficientProvidersError"}}return r})(),_y=(()=>{class r extends Error{static name="NoRoutersAvailableError";constructor(t="No routers available"){super(t),this.name="NoRoutersAvailableError"}}return r})(),Cj=(()=>{class r extends Error{static name="UnknownHashAlgorithmError";constructor(t="Unknown hash algorithm"){super(t),this.name="UnknownHashAlgorithmError"}}return r})(),Ij=(()=>{class r extends Error{static name="UnknownCodecError";constructor(t="Unknown codec"){super(t),this.name="UnknownCodecError"}}return r})();var On=class extends Rn{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}};var tA=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=ze(),this.haveNext=ze()}[Symbol.asyncIterator](){return this}next(){return f(this,null,function*(){if(this.nextResult==null&&(yield this.haveNext.promise),this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=ze(),e})}throw(e){return f(this,null,function*(){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}})}return(){return f(this,null,function*(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e})}push(e,t){return f(this,null,function*(){yield this._push(e,t)})}end(e,t){return f(this,null,function*(){e!=null?yield this.throw(e):yield this._push(void 0,t)})}_push(e,t){return f(this,null,function*(){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)yield this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=ze(),yield lt(this.readNext.promise,t?.signal,t)})}};function cE(){return new tA}function Jde(r){return r[Symbol.asyncIterator]!=null}function efe(r,e,t){return f(this,null,function*(){try{yield Promise.all(r.map(n=>f(null,null,function*(){try{for(var o=O(n),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;yield e.push(c,{signal:t}),t.throwIfAborted()}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}}))),yield e.end(void 0,{signal:t})}catch(n){yield e.end(n,{signal:t}).catch(()=>{})}})}function tfe(r){return M(this,null,function*(){let e=new AbortController,t=cE();efe(r,t,e.signal).catch(()=>{});try{yield*Q(t)}finally{e.abort()}})}function*rfe(r){for(let e of r)yield*Q(e)}function nfe(...r){let e=[];for(let t of r)Jde(t)||e.push(t);return e.length===r.length?rfe(e):tfe(r)}var Mo=nfe;var ofe=5,lE=class{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??ofe,this.findProviders=e.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=e.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=e.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=e.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=e.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}start(){return f(this,null,function*(){yield kn(...this.routers)})}stop(){return f(this,null,function*(){yield oo(...this.routers)})}findProviders(n){return M(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new _y("No content routers available");let o=new On({concurrency:this.providerLookupConcurrency});o.addEventListener("error",()=>{});try{for(var i=O(Mo(o.toGenerator(),...hf(this.routers,"findProviders").map(u=>u.findProviders(e,t)))),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let l=a.value;if(l!=null){if(l.multiaddrs.length===0){if(o.find(l.id)!=null)continue;o.add(()=>f(this,null,function*(){try{let u=yield this.findPeer(l.id,t);return u.multiaddrs.length===0?null:u}catch(u){return this.log.error("could not load multiaddrs for peer %p",l.id,u),null}}),{peerId:l.id,signal:t.signal}).catch(u=>{this.log.error("could not load multiaddrs for peer %p",l.id,u)})}yield l}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}})}provide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new _y("No content routers available");yield Promise.all(hf(this.routers,"provide").map(o=>f(this,null,function*(){yield o.provide(e,t)})))})}cancelReprovide(n){return f(this,arguments,function*(e,t={}){yield Promise.all(hf(this.routers,"cancelReprovide").map(o=>f(this,null,function*(){yield o.cancelReprovide(e,t)})))})}put(e,t,n){return f(this,null,function*(){yield Promise.all(hf(this.routers,"put").map(o=>f(this,null,function*(){yield o.put(e,t,n)})))})}get(e,t){return f(this,null,function*(){return Promise.any(hf(this.routers,"get").map(n=>f(this,null,function*(){return n.get(e,t)})))})}findPeer(e,t){return f(this,null,function*(){if(this.routers.length===0)throw new _y("No peer routers available");let n=this,o=Mo(...hf(this.routers,"findPeer").map(l=>function(){return M(this,null,function*(){try{yield yield new S(l.findPeer(e,t))}catch(u){n.log.error(u)}})}()));try{for(var i=O(o),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;if(l!=null)return l}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw new kt("Could not find peer in routing")})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new _y("No peer routers available");try{for(var o=O(Mo(...hf(this.routers,"getClosestPeers").map(l=>l.getClosestPeers(e,t)))),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;c!=null&&(yield c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}};function hf(r,e){return r.filter(t=>t[e]!=null)}var ol=(()=>{class r extends Error{static name="AbortError";name="AbortError";constructor(t="The operation was aborted",...n){super(t,...n)}}return r})();var Aj=(()=>{class r extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}}return r})();var uE=class{deferred;signal;constructor(e){this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new ol)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function ife(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var dE=class{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=ife(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new ol),this.cleanup())}join(){return f(this,arguments,function*(e={}){let t=new uE(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise})}run(){return f(this,null,function*(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=yield lt(this.fn(I(v({},this.options??{}),{signal:this.controller.signal})),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}})}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}};function rA(r,e){let t,n=function(){let o=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(o,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}var Cy=class extends nt{concurrency;maxSize;queue;pending;sort;autoStart;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=e.autoStart??!0,this.sort=e.sort,this.queue=[],this.emitEmpty=rA(this.emitEmpty.bind(this),1),this.emitIdle=rA(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}add(e,t){return f(this,null,function*(){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new Aj;let n=new dE(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),n.join(t).then(o=>(this.safeDispatchEvent("success",{detail:{job:n,result:o}}),o)).catch(o=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:n,error:o}}),o})})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new ol)}),this.clear()}onEmpty(e){return f(this,null,function*(){this.size!==0&&(yield Pr(this,"empty",e?.signal))})}onSizeLessThan(e,t){return f(this,null,function*(){this.size<e||(yield Pr(this,"next",t?.signal,{filter:()=>this.size<e}))})}onIdle(e){return f(this,null,function*(){this.pending===0&&this.size===0||(yield Pr(this,"idle",e?.signal))})}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}toGenerator(e){return M(this,null,function*(){e?.signal?.throwIfAborted();let t=Xr({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},o=c=>{c.detail!=null&&t.push(c.detail.result)},i=c=>{n(c.detail.error)},s=()=>{n()},a=()=>{n(new ol("Queue aborted"))};this.addEventListener("success",o),this.addEventListener("failure",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",a);try{yield*Q(t)}finally{this.removeEventListener("success",o),this.removeEventListener("failure",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",a),n()}})}};var fE="lock:worker:request-read",pE="lock:worker:abort-read-request",hE="lock:worker:release-read",mE="lock:master:grant-read",gE="lock:master:error-read",yE="lock:worker:request-write",vE="lock:worker:abort-write-request",wE="lock:worker:release-write",bE="lock:master:grant-write",EE="lock:master:error-write",xE="lock:worker:finalize",SE="mortice",Dj={singleProcess:!1};var nA=(r,e,t,n,o,i,s,a,c)=>l=>{if(l.data==null)return;let u={type:l.data.type,name:l.data.name,identifier:l.data.identifier};u.type===o&&r.safeDispatchEvent(t,{detail:{name:u.name,identifier:u.identifier,handler:()=>f(null,null,function*(){e.postMessage({type:c,name:u.name,identifier:u.identifier}),yield new Promise(d=>{let h=p=>{if(p?.data==null)return;let m={type:p.data.type,name:p.data.name,identifier:p.data.identifier};m.type===a&&m.identifier===u.identifier&&(e.removeEventListener("message",h),d())};e.addEventListener("message",h)})}),onError:d=>{e.postMessage({type:s,name:u.name,identifier:u.identifier,error:{message:d.message,name:d.name,stack:d.stack}})}}}),u.type===i&&r.safeDispatchEvent(n,{detail:{name:u.name,identifier:u.identifier}}),u.type===xE&&r.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})};var Tj=(r=10)=>Math.random().toString().substring(2,r+2);var _E=class{name;channel;constructor(e){this.name=e,this.channel=new BroadcastChannel(SE)}readLock(e){return this.sendRequest(fE,pE,mE,gE,hE,e)}writeLock(e){return this.sendRequest(yE,vE,bE,EE,wE,e)}finalize(){this.channel.postMessage({type:xE,name:this.name}),this.channel.close()}sendRequest(e,t,n,o,i,s){return f(this,null,function*(){s?.signal?.throwIfAborted();let a=Tj();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((c,l)=>{let u=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};s?.signal?.addEventListener("abort",u,{once:!0});let d=h=>{if(h.data?.identifier===a&&(h.data?.type===n&&(this.channel.removeEventListener("message",d),s?.signal?.removeEventListener("abort",u),c(()=>{this.channel.postMessage({type:i,identifier:a,name:this.name})})),h.data.type===o)){this.channel.removeEventListener("message",d),s?.signal?.removeEventListener("abort",u);let p=new Error;h.data.error!=null&&(p.message=h.data.error.message,p.name=h.data.error.name,p.stack=h.data.error.stack),l(p)}};this.channel.addEventListener("message",d)})})}};var Pj=r=>{if(r=Object.assign({},Dj,r),!!globalThis.document||r.singleProcess){let t=new BroadcastChannel(SE),n=new nt;return t.addEventListener("message",nA(n,t,"requestReadLock","abortReadLockRequest",fE,pE,gE,hE,mE)),t.addEventListener("message",nA(n,t,"requestWriteLock","abortWriteLockRequest",yE,vE,EE,wE,bE)),n}return new _E(r.name)};var mf=new Map,Iy;function Mj(r){return typeof r?.readLock=="function"&&typeof r?.writeLock=="function"}function sfe(r){if(Iy==null&&(Iy=Pj(r),!Mj(Iy))){let e=Iy;e.addEventListener("requestReadLock",t=>{let n=t.detail.name,o=t.detail.identifier,i=mf.get(n);if(i==null)return;let s=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==o||s.abort()};e.addEventListener("abortReadLockRequest",a),i.readLock({signal:s.signal}).then(c=>f(null,null,function*(){yield t.detail.handler().finally(()=>{c()})})).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{let n=t.detail.name,o=t.detail.identifier,i=mf.get(n);if(i==null)return;let s=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==o||s.abort()};e.addEventListener("abortWriteLockRequest",a),i.writeLock({signal:s.signal}).then(c=>f(null,null,function*(){yield t.detail.handler().finally(()=>{c()})})).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{let n=t.detail.name,o=mf.get(n);o?.finalize()})}return Iy}function oA(r,e){return f(this,null,function*(){let t,n,o=new Promise((s,a)=>{t=s,n=a}),i=()=>{n(new ol)};return e?.signal?.addEventListener("abort",i,{once:!0}),r.add(()=>f(null,null,function*(){yield new Promise(s=>{t(()=>{e?.signal?.removeEventListener("abort",i),s()})})}),{signal:e?.signal}).catch(s=>{n(s)}),o})}var kj=(r,e)=>{let t=mf.get(r);if(t!=null)return t;let n=sfe(e);if(Mj(n))return t=n,mf.set(r,t),t;let o=new Cy({concurrency:1}),i;return t={readLock(a){return f(this,null,function*(){if(i!=null)return oA(i,a);i=new Cy({concurrency:e.concurrency,autoStart:!1});let c=i,l=oA(i,a);return o.add(()=>f(null,null,function*(){c.start(),yield c.onIdle().then(()=>{i===c&&(i=null)})})),l})},writeLock(a){return f(this,null,function*(){return i=null,oA(o,a)})},finalize:()=>{mf.delete(r)},queue:o},mf.set(r,t),e.autoFinalize===!0&&o.addEventListener("idle",()=>{t.finalize()},{once:!0}),t};var afe={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function Ay(r){let e=Object.assign({},afe,r);return kj(e.name,e)}var CE=class{lock;child;pins;started;constructor(e,t,n={}){this.child=e,this.pins=t,this.lock=Ay({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield kn(this.child),this.started=!0})}stop(){return f(this,null,function*(){yield oo(this.child),this.started=!1})}unwrap(){return this.child}put(o,i){return f(this,arguments,function*(e,t,n={}){n?.signal?.throwIfAborted();let s=yield this.lock.readLock();try{return yield this.child.put(e,t,n)}finally{s()}})}putMany(n){return M(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new S(this.lock.readLock());try{yield*Q(this.child.putMany(e,t))}finally{o()}})}get(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.readLock();try{return yield this.child.get(e,t)}finally{o()}})}getMany(n){return M(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new S(this.lock.readLock());try{yield*Q(this.child.getMany(e,t))}finally{o()}})}delete(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.writeLock();try{if(yield this.pins.isPinned(e))throw new Error("CID was pinned");yield this.child.delete(e,t)}finally{o()}})}deleteMany(n){return M(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield new S(this.lock.writeLock());try{let i=this;yield*Q(this.child.deleteMany(function(){return M(this,null,function*(){try{for(var s=O(e),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;if(yield new S(i.pins.isPinned(u)))throw new Error("CID was pinned");yield u}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}})}(),t))}finally{o()}})}has(n){return f(this,arguments,function*(e,t={}){t?.signal?.throwIfAborted();let o=yield this.lock.readLock();try{return yield this.child.has(e,t)}finally{o()}})}getAll(){return M(this,arguments,function*(e={}){e?.signal?.throwIfAborted();let t=yield new S(this.lock.readLock());try{yield*Q(this.child.getAll(e))}finally{t()}})}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}};var iA=new Ot("/version"),Rj=1;function Nj(r){return f(this,null,function*(){if(!(yield r.has(iA))){yield r.put(iA,Z(`${Rj}`));return}let e=yield r.get(iA),t=te(e);if(parseInt(t,10)!==Rj)throw new Error("Unknown datastore version, a datastore migration may be required")})}var Ty={};Dn(Ty,{code:()=>Dy,decode:()=>aA,decodeOptions:()=>pfe,encode:()=>mfe,encodeOptions:()=>dfe,name:()=>hfe,toByteView:()=>Lj});var Oj=42;function Lj(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function cfe(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=ce.asCID(r);if(!e)return null;let t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ie(B.tag,Oj),new ie(B.bytes,t)]}function lfe(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function ufe(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var sA={float64:!0,typeEncoders:{Object:cfe,undefined:lfe,number:ufe}},dfe=I(v({},sA),{typeEncoders:v({},sA.typeEncoders)});function ffe(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return ce.decode(r.subarray(1))}var IE={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};IE.tags[Oj]=ffe;var pfe=I(v({},IE),{tags:IE.tags.slice()}),hfe="dag-cbor",Dy=113,mfe=r=>vu(r,sA),aA=r=>Pi(Lj(r),IE);var My={};Dn(My,{code:()=>Py,decode:()=>DE,encode:()=>Fj,format:()=>Ife,name:()=>Cfe,parse:()=>Dfe,stringify:()=>Ife});var cA=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===B.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===B.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[B.uint.major](e,t){this.prefix(e);let n=String(t.value),o=[];for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);e.push(o)}[B.negint.major](e,t){this[B.uint.major](e,t)}[B.bytes.major](e,t){throw new Error(`${tl} unsupported type: Uint8Array`)}[B.string.major](e,t){this.prefix(e);let n=K4(JSON.stringify(t.value));e.push(n.length>32?vy(n):n)}[B.array.major](e,t){this.prefix(e),this.inRecursive.push({type:B.array,elements:0}),e.push([91])}[B.map.major](e,t){this.prefix(e),this.inRecursive.push({type:B.map,elements:0}),e.push([123])}[B.tag.major](e,t){}[B.float.major](e,t){if(t.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===B.array)e.push([93]);else if(s.type===B.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${tl} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),o=[],i=!1;for(let s=0;s<n.length;s++)o[s]=n.charCodeAt(s),!i&&(o[s]===46||o[s]===101||o[s]===69)&&(i=!0);i||(o.push(46),o.push(48)),e.push(o)}};function gfe(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${tl} complex map keys are not supported`);let t=r[0],n=e[0];if(t.type!==B.string||n.type!==B.string)throw new Error(`${tl} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${tl} unexpected duplicate map keys, this is not supported`)}var yfe={addBreakTokens:!0,mapSorter:gfe};function lA(r,e){return e=Object.assign({},yfe,e),G9(r,new cA,e)}var Mm=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Pe} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Pe} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,n=!1,o=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ie(B.uint,0,this._pos-e);if(o([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Pe} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Pe} unexpected token at position ${this._pos}`);n=!0,this._pos++,o([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,o([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return n?new ie(B.float,s,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new ie(s>=0?B.uint:B.negint,s,this._pos-e):new ie(s>=0?B.uint:B.negint,BigInt(i),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Pe} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let i=this._pos,s=0;i<this.data.length&&s<65536;i++,s++){let a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new ie(B.string,c,s)}}let e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Pe} unexpected end of unicode escape sequence at position ${this._pos}`);let i=0;for(let s=0;s<4;s++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Pe} unexpected unicode escape character at position ${this._pos}`);i=i*16+a,this._pos++}return i},o=()=>{let i=this.ch(),s=null,a=i>239?4:i>223?3:i>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Pe} unexpected unicode sequence at position ${this._pos}`);let c,l,u,d;switch(a){case 1:i<128&&(s=i);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(d=(i&31)<<6|c&63,d>127&&(s=d));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(d=(i&15)<<12|(c&63)<<6|l&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],u=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(d=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,d>65535&&d<1114112&&(s=d))}s===null?(s=65533,a=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|s&1023),t.push(s),this._pos+=a};for(;!this.done();){let i=this.ch(),s;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${Pe} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Pe} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ie(B.string,H9(t),this._pos-e);default:if(i<32)throw new Error(`${Pe} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):o()}}throw new Error(`${Pe} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ie(B.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ie(B.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ie(B.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ie(B.false,!1,5);case 116:return this.expect([116,114,117,101]),new ie(B.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Pe} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ie(B.break,void 0,1);if(this.ch()!==44)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ie(B.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ie(B.break,void 0,1);if(this.ch()!==44)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ie(B.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Pe} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Pe} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function uA(r,e){return e=Object.assign({tokenizer:new Mm(r,e)},e),Pi(r,e)}function wfe(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function bfe(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let e=ce.asCID(r);if(!e)return null;let t=e.toString();return[new ie(B.map,1/0,1),new ie(B.string,"/",1),new ie(B.string,t,t.length),new ie(B.break,void 0,1)]}function AE(r){let e=Yr.encode(r).slice(1);return[new ie(B.map,1/0,1),new ie(B.string,"/",1),new ie(B.map,1/0,1),new ie(B.string,"bytes",5),new ie(B.string,e,e.length),new ie(B.break,void 0,1),new ie(B.break,void 0,1)]}function Qs(r){return AE(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Efe(r){return AE(new Uint8Array(r))}function xfe(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Sfe(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var _fe={typeEncoders:{Object:bfe,Buffer:AE,Uint8Array:AE,Int8Array:Qs,Uint16Array:Qs,Int16Array:Qs,Uint32Array:Qs,Int32Array:Qs,Float32Array:Qs,Float64Array:Qs,Uint8ClampedArray:Qs,BigInt64Array:Qs,BigUint64Array:Qs,DataView:Qs,ArrayBuffer:Efe,undefined:xfe,number:Sfe}},dA=class extends Mm{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===B.map){let t=this._next();if(t.type===B.string&&t.value==="/"){let n=this._next();if(n.type===B.string){if(this._next().type!==B.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ie(B.tag,42,0)}if(n.type===B.map){let o=this._next();if(o.type===B.string&&o.value==="bytes"){let i=this._next();if(i.type===B.string){for(let a=0;a<2;a++)if(this._next().type!==B.break)throw new Error("Invalid encoded Bytes form");let s=Yr.decode(`m${i.value}`);return new ie(B.bytes,s,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(o)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},fA={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};fA.tags[42]=ce.parse;var Cfe="dag-json",Py=297,Fj=r=>lA(r,_fe),DE=r=>{let e=wfe(r),t=Object.assign(fA,{tokenizer:new dA(e,fA)});return uA(e,t)},Ife=r=>Afe.decode(Fj(r));var Afe=new TextDecoder,Dfe=r=>DE(Tfe.encode(r)),Tfe=new TextEncoder;var Ur={};Dn(Ur,{code:()=>un,createLink:()=>Wj,createNode:()=>Kj,decode:()=>Br,encode:()=>Ct,name:()=>Vfe,prepare:()=>Mr,validate:()=>mA});var Pfe=new TextDecoder;function pA(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let o=r[e++];if(t+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[t,e]}function TE(r,e){let t;[t,e]=pA(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function Bj(r,e){let t;return[t,e]=pA(r,e),[t&7,t>>3,e]}function Mfe(r){let e={},t=r.length,n=0;for(;n<t;){let o,i;if([o,i,n]=Bj(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=TE(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=TE(r,n),e.Name=Pfe.decode(s)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=pA(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Uj(r){let e=r.length,t=0,n,o=!1,i;for(;t<e;){let a,c;if([a,c,t]=Bj(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=TE(r,t),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=TE(r,t),n.push(Mfe(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return i&&(s.Data=i),s.Links=n||[],s}var jj=new TextEncoder,Vj=2**32,kfe=2**31;function Rfe(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=ky(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=jj.encode(r.Name);t-=n.length,e.set(n,t),t=ky(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=ky(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Hj(r){let e=Ofe(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=ky(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let o=r.Links.length-1;o>=0;o--){let i=Rfe(r.Links[o],t.subarray(0,n));n-=i,n=ky(t,n,i)-1,t[n]=18}return t}function Nfe(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+km(t)}if(typeof r.Name=="string"){let t=jj.encode(r.Name).length;e+=1+t+km(t)}return typeof r.Tsize=="number"&&(e+=1+km(r.Tsize)),e}function Ofe(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+km(t)}if(r.Links)for(let t of r.Links){let n=Nfe(t);e+=1+n+km(n)}return e}function ky(r,e,t){e-=km(t);let n=e;for(;t>=kfe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function km(r){return r%2===0&&r++,Math.floor((Lfe(r)+6)/7)}function Lfe(r){let e=0;return r>=Vj&&(r=Math.floor(r/Vj),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Ffe[r]}var Ffe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var Bfe=["Data","Links"],Ufe=["Hash","Name","Tsize"],hA=new TextEncoder;function zj(r,e){if(r===e)return 0;let t=r.Name?hA.encode(r.Name):[],n=e.Name?hA.encode(e.Name):[],o=t.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(t[s]!==n[s]){o=t[s],i=n[s];break}return o<i?-1:i<o?1:0}function $j(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function qj(r){if(typeof r.asCID=="object"){let t=ce.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Hash){let t=ce.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=ce.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=ce.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function Mr(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=hA.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(qj),e.Links.sort(zj);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function mA(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!$j(r,Bfe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!$j(t,Ufe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&zj(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Kj(r,e=[]){return Mr({Data:r,Links:e})}function Wj(r,e,t){return qj({Hash:t,Name:r,Tsize:e})}function Gj(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}var Vfe="dag-pb",un=112;function Ct(r){mA(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Hj(e)}function Br(r){let e=Gj(r),t=Uj(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(o=>{let i={};try{i.Hash=ce.decode(o.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return o.Name!==void 0&&(i.Name=o.Name),o.Tsize!==void 0&&(i.Tsize=o.Tsize),i})),n}function Rm(r){return r?.then!=null}function Yj(r=[],e){let t={[un]:Ur,[Tr]:Po,[Dy]:Ty,[Py]:My,[yy]:Sm};return r.forEach(n=>{t[n.code]=n}),n=>f(null,null,function*(){let o=t[n];if(o==null&&e!=null){let i=e(n);Rm(i)?o=yield i:o=i,t[o.code]=o}if(o!=null)return o;throw new Ij(`Could not load codec for ${n}`)})}function Xj(r=[],e){let t={[wt.code]:wt,[O4.code]:O4,[wn.code]:wn};return r.forEach(n=>{t[n.code]=n}),n=>f(null,null,function*(){let o=t[n];if(o==null&&e!=null){let i=e(n);Rm(i)?o=yield i:o=i,t[o.code]=o}if(o!=null)return o;throw new Cj(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)})}function Ze(r){let e=new globalThis.AbortController;function t(){e.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(let i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}let o=e.signal;return o.clear=n,o}var Ry=(()=>{class r extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=r.name;code=r.code;constructor(t="Open failed"){super(t)}}return r})();var wu=(()=>{class r extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=r.name;code=r.code;constructor(t="Put failed"){super(t)}}return r})(),gA=(()=>{class r extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=r.name;code=r.code;constructor(t="Get failed"){super(t)}}return r})(),yA=(()=>{class r extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=r.name;code=r.code;constructor(t="Delete failed"){super(t)}}return r})();var Xo=(()=>{class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(t="Not Found"){super(t)}}return r})();var Zs=class{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}putMany(e,t){return M(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let{cid:a,block:c}=i.value;yield new S(this.put(a,c,t)),yield a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}get(e,t){return Promise.reject(new Error(".get is not implemented"))}getMany(e,t){return M(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;yield{cid:a,block:yield new S(this.get(a,t))}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}deleteMany(e,t){return M(this,null,function*(){try{for(var n=O(e),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;yield new S(this.delete(a,t)),yield a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}getAll(e){return M(this,null,function*(){throw new Error(".getAll is not implemented")})}};var PE=0,ME=class extends Zs{child;constructor(e){super(),this.child=e}put(e,t,n){return e.multihash.code===PE||this.child==null?(n?.signal?.throwIfAborted(),e):this.child.put(e,t,n)}get(e,t){if(e.multihash.code===PE)return t?.signal?.throwIfAborted(),e.multihash.digest;if(this.child==null)throw t?.signal?.throwIfAborted(),new Xo;return this.child.get(e,t)}has(e,t){return e.multihash.code===PE?(t?.signal?.throwIfAborted(),!0):this.child==null?(t?.signal?.throwIfAborted(),!1):this.child.has(e,t)}delete(e,t){if(e.code===PE){t?.signal?.throwIfAborted();return}if(this.child!=null)return this.child.delete(e,t)}getAll(e){return this.child!=null?this.child.getAll(e):(e?.signal?.throwIfAborted(),[])}};function jfe(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:o=>{n.push(o)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}var Nm=jfe;function Hfe(r){return r[Symbol.asyncIterator]!=null}function $fe(r,e){let t=0;if(Hfe(r))return function(){return M(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let h=u.value;(yield new S(e(h,t++)))&&(yield h)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=Nm(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=e(o,t++);if(typeof s.then=="function")return function(){return M(this,null,function*(){(yield new S(s))&&(yield o);for(let c of n)(yield new S(e(c,t++)))&&(yield c)})}();let a=e;return function*(){s===!0&&(yield o);for(let c of n)a(c,t++)&&(yield c)}()}var so=$fe;function zfe(r){return r[Symbol.asyncIterator]!=null}function Qj(r){return r?.then!=null}function qfe(r,e){let t=0;if(zfe(r))return function(){return M(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let h=u.value;let p=e(h,t++);Qj(p)&&(yield new S(p)),yield h}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=Nm(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();if(typeof e(o,t++)?.then=="function")return function(){return M(this,null,function*(){yield o;for(let c of n){let l=e(c,t++);Qj(l)&&(yield new S(l)),yield c}})}();let a=e;return function*(){yield o;for(let c of n)a(c,t++),yield c}()}var gf=qfe;var kE=class{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new ME(e.blockstore),this.getHasher=e.getHasher}put(o,i){return f(this,arguments,function*(e,t,n={}){return(yield this.child.has(e,n))?(n.onProgress?.(new fe("blocks:put:duplicate",e)),e):(n.onProgress?.(new fe("blocks:put:providers:notify",e)),yield Promise.all(this.components.blockBrokers.map(s=>f(this,null,function*(){return s.announce?.(e,t,n)}))),n.onProgress?.(new fe("blocks:put:blockstore:put",e)),this.child.put(e,t,n))})}putMany(n){return M(this,arguments,function*(e,t={}){let o=so(e,a=>f(this,[a],function*({cid:s}){let c=yield this.child.has(s,t);return c&&t.onProgress?.(new fe("blocks:put-many:duplicate",s)),!c})),i=gf(o,c=>f(this,[c],function*({cid:s,block:a}){t.onProgress?.(new fe("blocks:put-many:providers:notify",s)),yield Promise.all(this.components.blockBrokers.map(l=>f(this,null,function*(){return l.announce?.(s,a,t)})))}));t.onProgress?.(new fe("blocks:put-many:blockstore:put-many")),yield*Q(this.child.putMany(i,t))})}get(n){return f(this,arguments,function*(e,t={}){if(t.offline!==!0&&!(yield this.child.has(e,t))){let o=yield this.getHasher(e.multihash.code);t.onProgress?.(new fe("blocks:get:providers:get",e));let i=yield Zj(e,this.components.blockBrokers,o,I(v({},t),{log:this.log}));return t.onProgress?.(new fe("blocks:get:blockstore:put",e)),yield this.child.put(e,i,t),t.onProgress?.(new fe("blocks:get:providers:notify",e)),yield Promise.all(this.components.blockBrokers.map(s=>f(this,null,function*(){return s.announce?.(e,i,t)}))),i}return t.onProgress?.(new fe("blocks:get:blockstore:get",e)),this.child.get(e,t)})}getMany(n){return M(this,arguments,function*(e,t={}){t.onProgress?.(new fe("blocks:get-many:blockstore:get-many")),yield*Q(this.child.getMany(gf(e,o=>f(this,null,function*(){if(t.offline!==!0&&!(yield this.child.has(o,t))){let i=yield this.getHasher(o.multihash.code);t.onProgress?.(new fe("blocks:get-many:providers:get",o));let s=yield Zj(o,this.components.blockBrokers,i,I(v({},t),{log:this.log}));t.onProgress?.(new fe("blocks:get-many:blockstore:put",o)),yield this.child.put(o,s,t),t.onProgress?.(new fe("blocks:get-many:providers:notify",o)),yield Promise.all(this.components.blockBrokers.map(a=>f(this,null,function*(){return a.announce?.(o,s,t)})))}}))))})}delete(n){return f(this,arguments,function*(e,t={}){t.onProgress?.(new fe("blocks:delete:blockstore:delete",e)),yield this.child.delete(e,t)})}deleteMany(n){return M(this,arguments,function*(e,t={}){t.onProgress?.(new fe("blocks:delete-many:blockstore:delete-many")),yield*Q(this.child.deleteMany(function(){return M(this,null,function*(){try{for(var o=O(e),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}(),t))})}has(n){return f(this,arguments,function*(e,t={}){return this.child.has(e,t)})}getAll(){return M(this,arguments,function*(e={}){e.onProgress?.(new fe("blocks:get-all:blockstore:get-many")),yield*Q(this.child.getAll(e))})}},RE=class extends kE{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield kn(this.child,...this.components.blockBrokers),this.started=!0})}stop(){return f(this,null,function*(){yield oo(this.child,...this.components.blockBrokers),this.started=!1})}unwrap(){return this.child}createSession(e,t){let n=this.components.blockBrokers.map(o=>o.createSession==null?o:o.createSession(t));return new vA({blockstore:this.child,blockBrokers:n,getHasher:this.getHasher,logger:this.logger},{root:e})}},vA=class r extends kE{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}put(o,i){return f(this,arguments,function*(e,t,n={}){let s=Ze([this.closeController.signal,n.signal]);try{return yield Ki(r.prototype,this,"put").call(this,e,t,I(v({},n),{signal:s}))}finally{s.clear()}})}putMany(n){return M(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{yield*Q(Ki(r.prototype,this,"putMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}get(n){return f(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{return yield Ki(r.prototype,this,"get").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}getMany(n){return M(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{yield*Q(Ki(r.prototype,this,"getMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}delete(n){return f(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{yield Ki(r.prototype,this,"delete").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}deleteMany(n){return M(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{yield*Q(Ki(r.prototype,this,"deleteMany").call(this,e,I(v({},t),{signal:o})))}finally{o.clear()}})}has(n){return f(this,arguments,function*(e,t={}){let o=Ze([this.closeController.signal,t.signal]);try{return yield Ki(r.prototype,this,"has").call(this,e,I(v({},t),{signal:o}))}finally{o.clear()}})}getAll(){return M(this,arguments,function*(e={}){let t=Ze([this.closeController.signal,e.signal]);try{yield*Q(Ki(r.prototype,this,"getAll").call(this,I(v({},e),{signal:t})))}finally{t.clear()}})}};function Kfe(r){return typeof r.retrieve=="function"}var Wfe=(r,e)=>{if(e==null)throw new Y(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return t=>f(null,null,function*(){let n,o=e.digest(t);if(Rm(o)?n=yield o:n=o,!Me(n.digest,r.multihash.digest))throw new Em("Hash of downloaded block did not match multihash from passed CID")})};function Zj(r,e,t,n){return f(this,null,function*(){let o=Wfe(r,t),i=new AbortController,s=Ze([i.signal,n.signal]);i.signal;let a=[];for(let c of e)Kfe(c)&&a.push(c);try{return yield Promise.any(a.map(c=>f(null,null,function*(){try{let l=!1,u=yield c.retrieve(r,I(v({},n),{signal:s,validateFn:d=>f(null,null,function*(){yield o(d),l=!0})}));return l||(yield o(u)),u}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}})))}finally{i.abort(),s.clear()}})}var Ny=class extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}},Oy=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},NE=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};var Jj={get(r=globalThis){let e=r.crypto;if(e?.subtle==null)throw new NE("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};var Qr=Jj;function zt(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=wr(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var tH=Symbol.for("@achingbrain/uint8arraylist");function eH(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let o=t+n.byteLength;if(e<o)return{buf:n,index:e-t};t=o}throw new RangeError("index is out of bounds")}function Om(r){return!!r?.[tH]}var Ve=class r{bufs;length;[tH]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*Q(this.bufs)}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Om(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Om(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=eH(this.bufs,e);return t.buf[t.index]}set(e,t){let n=eH(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Om(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:o}=this._subList(e,t);return zt(n,o)}subarray(e,t){let{bufs:n,length:o}=this._subList(e,t);return n.length===1?n[0]:zt(n,o)}sublist(e,t){let{bufs:n,length:o}=this._subList(e,t),i=new r;return i.length=o,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,e>=c)continue;let l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(s);break}let d=e-a;n.push(s.subarray(d,d+(t-e)));break}if(l){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(u){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Om(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let d=0;d<i;d++)s[d]=-1;for(let d=0;d<o;d++)s[n[d]]=d;let a=s,c=this.byteLength-n.byteLength,l=n.byteLength-1,u;for(let d=t;d<=c;d+=u){u=0;for(let h=l;h>=0;h--){let p=this.get(d+h);if(n[h]!==p){u=Math.max(1,h-a[p]);break}}if(u===0)return d}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=wr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let o=Qe(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,t,n),this.write(o,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let o=Qe(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,t,n),this.write(o,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let o=Qe(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,t,n),this.write(o,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=wr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let o=Qe(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,t,n),this.write(o,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let o=Qe(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,t,n),this.write(o,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let o=Qe(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,t,n),this.write(o,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let o=Qe(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,t,n),this.write(o,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let o=Qe(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,t,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof r)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Me(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new r;return n.bufs=e,t==null&&(t=e.reduce((o,i)=>o+i.byteLength,0)),n.length=t,n}};var Yfe=parseInt("11111",2),wA=parseInt("10000000",2),Xfe=parseInt("01111111",2),rH={0:Ly,1:Ly,2:Qfe,3:epe,4:tpe,5:Jfe,6:Zfe,16:Ly,22:Ly,48:Ly};function hs(r,e={offset:0}){let t=r[e.offset]&Yfe;if(e.offset++,rH[t]!=null)return rH[t](r,e);throw new Error("No decoder for tag "+t)}function Fy(r,e){let t=0;if((r[e.offset]&wA)===wA){let n=r[e.offset]&Xfe,o="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)o+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(o,16)}else t=r[e.offset],e.offset++;return t}function Ly(r,e){Fy(r,e);let t=[];for(;!(e.offset>=r.byteLength);){let n=hs(r,e);if(n===null)break;t.push(n)}return t}function Qfe(r,e){let t=Fy(r,e),n=e.offset,o=e.offset+t,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return e.offset+=t,Uint8Array.from(i)}function Zfe(r,e){let t=Fy(r,e),n=e.offset+t,o=r[e.offset];e.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;e.offset<n;){let l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let d=0;d<c.length;d++)u+=c[d]<<d*7;a+=`.${u}`,c=[]}}return a}function Jfe(r,e){return e.offset++,null}function epe(r,e){let t=Fy(r,e),n=r[e.offset];e.offset++;let o=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function tpe(r,e){let t=Fy(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function rpe(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);let t=new Ve;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function OE(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let e=rpe(r.byteLength);return new Ve(Uint8Array.from([e.byteLength|wA]),e)}function ko(r){let e=new Ve,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Ve(Uint8Array.from([2]),OE(e),e)}function By(r){let e=Uint8Array.from([0]),t=new Ve(e,r);return new Ve(Uint8Array.from([3]),OE(t),t)}function nH(r){return new Ve(Uint8Array.from([4]),OE(r),r)}function Js(r,e=48){let t=new Ve;for(let n of r)t.append(n);return new Ve(Uint8Array.from([e]),OE(t),t)}var oH="1.2.840.10045.3.1.7",iH="1.3.132.0.34",sH="1.3.132.0.35";function aH(r="P-256"){return f(this,null,function*(){let e=yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:yield crypto.subtle.exportKey("jwk",e.publicKey),privateKey:yield crypto.subtle.exportKey("jwk",e.privateKey)}})}function cH(r,e,t){return f(this,null,function*(){let n=yield crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);t?.signal?.throwIfAborted();let o=yield crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)})}function lH(r,e,t,n){return f(this,null,function*(){let o=yield crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let i=yield crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,e,t.subarray());return n?.signal?.throwIfAborted(),i})}var npe=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),ope=Uint8Array.from([6,5,43,129,4,0,34]),ipe=Uint8Array.from([6,5,43,129,4,0,35]),uH={ext:!0,kty:"EC",crv:"P-256"},dH={ext:!0,kty:"EC",crv:"P-384"},fH={ext:!0,kty:"EC",crv:"P-521"},Lm=32,Fm=48,Bm=66;function pH(r){let e=hs(r);return bA(e)}function bA(r){let e=r[1],t=te(e,"base64url"),n=r[2][1][0],o=1,i,s;if(e.byteLength===Lm)return i=te(n.subarray(o,o+Lm),"base64url"),s=te(n.subarray(o+Lm),"base64url"),new vf(I(v({},uH),{key_ops:["sign"],d:t,x:i,y:s}));if(e.byteLength===Fm)return i=te(n.subarray(o,o+Fm),"base64url"),s=te(n.subarray(o+Fm),"base64url"),new vf(I(v({},dH),{key_ops:["sign"],d:t,x:i,y:s}));if(e.byteLength===Bm)return i=te(n.subarray(o,o+Bm),"base64url"),s=te(n.subarray(o+Bm),"base64url"),new vf(I(v({},fH),{key_ops:["sign"],d:t,x:i,y:s}));throw new Y(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function EA(r){let e=hs(r);return hH(e)}function hH(r){let e=r[1][1][0],t=1,n,o;if(e.byteLength===Lm*2+1)return n=te(e.subarray(t,t+Lm),"base64url"),o=te(e.subarray(t+Lm),"base64url"),new yf(I(v({},uH),{key_ops:["verify"],x:n,y:o}));if(e.byteLength===Fm*2+1)return n=te(e.subarray(t,t+Fm),"base64url"),o=te(e.subarray(t+Fm),"base64url"),new yf(I(v({},dH),{key_ops:["verify"],x:n,y:o}));if(e.byteLength===Bm*2+1)return n=te(e.subarray(t,t+Bm),"base64url"),o=te(e.subarray(t+Bm),"base64url"),new yf(I(v({},fH),{key_ops:["verify"],x:n,y:o}));throw new Y(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function mH(r){return Js([ko(Uint8Array.from([1])),nH(Z(r.d??"","base64url")),Js([yH(r.crv)],160),Js([By(new Ve(Uint8Array.from([4]),Z(r.x??"","base64url"),Z(r.y??"","base64url")))],161)]).subarray()}function gH(r){return Js([ko(Uint8Array.from([1])),Js([yH(r.crv)],160),Js([By(new Ve(Uint8Array.from([4]),Z(r.x??"","base64url"),Z(r.y??"","base64url")))],161)]).subarray()}function yH(r){if(r==="P-256")return npe;if(r==="P-384")return ope;if(r==="P-521")return ipe;throw new Y(`Invalid curve ${r}`)}function vH(r="P-256"){return f(this,null,function*(){let e=yield aH(r);return new vf(e.privateKey)})}var yf=class{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=gH(this.jwk)),this._raw}toMultihash(){return wn.digest(En(this))}toCID(){return ce.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}verify(e,t,n){return f(this,null,function*(){return lH(this.jwk,t,e,n)})}},vf=class{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new yf({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=mH(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}sign(e,t){return f(this,null,function*(){return cH(this.jwk,e,t)})}};var wf=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Vm(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ea(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Ln(r,...e){if(!Vm(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function bf(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ea(r.outputLen),ea(r.blockLen)}function jm(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function bH(r,e){Ln(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function ao(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Ef(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ta(r,e){return r<<32-e|r>>>e}function LE(r,e){return r<<e|r>>>32-e>>>0}var EH=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",spe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Za(r){if(Ln(r),EH)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=spe[r[t]];return e}var il={_0:48,_9:57,A:65,F:70,a:97,f:102};function wH(r){if(r>=il._0&&r<=il._9)return r-il._0;if(r>=il.A&&r<=il.F)return r-(il.A-10);if(r>=il.a&&r<=il.f)return r-(il.a-10)}function Hm(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(EH)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,i=0;o<t;o++,i+=2){let s=wH(r.charCodeAt(i)),a=wH(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}var ape=()=>f(null,null,function*(){});function xH(r,e,t){return f(this,null,function*(){let n=Date.now();for(let o=0;o<r;o++){t(o);let i=Date.now()-n;i>=0&&i<e||(yield ape(),n+=i)}})}function xA(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function bu(r){return typeof r=="string"&&(r=xA(r)),Ln(r),r}function SA(r){return typeof r=="string"&&(r=xA(r)),Ln(r),r}function ki(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];Ln(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}function SH(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}var Um=class{};function Uy(r){let e=n=>r().update(bu(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function sl(r=32){if(wf&&typeof wf.getRandomValues=="function")return wf.getRandomValues(new Uint8Array(r));if(wf&&typeof wf.randomBytes=="function")return Uint8Array.from(wf.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function cpe(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function FE(r,e,t){return r&e^~r&t}function BE(r,e,t){return r&e^r&t^e&t}var xf=class extends Um{constructor(e,t,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=Ef(this.buffer)}update(e){jm(this),e=bu(e),Ln(e);let{view:t,buffer:n,blockLen:o}=this,i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Ef(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jm(this),bH(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;t[s++]=128,ao(this.buffer.subarray(s)),this.padOffset>o-s&&(this.process(n,0),s=0);for(let d=s;d<o;d++)t[d]=0;cpe(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Ef(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=i,e.length=o,e.pos=a,o%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},al=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Fn=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var UE=BigInt(4294967295),_H=BigInt(32);function lpe(r,e=!1){return e?{h:Number(r&UE),l:Number(r>>_H&UE)}:{h:Number(r>>_H&UE)|0,l:Number(r&UE)|0}}function CH(r,e=!1){let t=r.length,n=new Uint32Array(t),o=new Uint32Array(t);for(let i=0;i<t;i++){let{h:s,l:a}=lpe(r[i],e);[n[i],o[i]]=[s,a]}return[n,o]}var _A=(r,e,t)=>r>>>t,CA=(r,e,t)=>r<<32-t|e>>>t,Sf=(r,e,t)=>r>>>t|e<<32-t,_f=(r,e,t)=>r<<32-t|e>>>t,Vy=(r,e,t)=>r<<64-t|e>>>t-32,jy=(r,e,t)=>r>>>t-32|e<<64-t;function Ja(r,e,t,n){let o=(e>>>0)+(n>>>0);return{h:r+t+(o/2**32|0)|0,l:o|0}}var IH=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),AH=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,DH=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),TH=(r,e,t,n,o)=>e+t+n+o+(r/2**32|0)|0,PH=(r,e,t,n,o)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),MH=(r,e,t,n,o,i)=>e+t+n+o+i+(r/2**32|0)|0;var dpe=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Eu=new Uint32Array(64),VE=class extends xf{constructor(e=32){super(64,e,8,!1),this.A=al[0]|0,this.B=al[1]|0,this.C=al[2]|0,this.D=al[3]|0,this.E=al[4]|0,this.F=al[5]|0,this.G=al[6]|0,this.H=al[7]|0}get(){let{A:e,B:t,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,t,n,o,i,s,a,c]}set(e,t,n,o,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)Eu[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let h=Eu[d-15],p=Eu[d-2],m=ta(h,7)^ta(h,18)^h>>>3,y=ta(p,17)^ta(p,19)^p>>>10;Eu[d]=y+Eu[d-7]+m+Eu[d-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){let h=ta(a,6)^ta(a,11)^ta(a,25),p=u+h+FE(a,c,l)+dpe[d]+Eu[d]|0,y=(ta(n,2)^ta(n,13)^ta(n,22))+BE(n,o,i)|0;u=l,l=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+y|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,o,i,s,a,c,l,u)}roundClean(){ao(Eu)}destroy(){this.set(0,0,0,0,0,0,0,0),ao(this.buffer)}};var kH=CH(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),fpe=kH[0],ppe=kH[1],xu=new Uint32Array(80),Su=new Uint32Array(80),jE=class extends xf{constructor(e=64){super(128,e,16,!1),this.Ah=Fn[0]|0,this.Al=Fn[1]|0,this.Bh=Fn[2]|0,this.Bl=Fn[3]|0,this.Ch=Fn[4]|0,this.Cl=Fn[5]|0,this.Dh=Fn[6]|0,this.Dl=Fn[7]|0,this.Eh=Fn[8]|0,this.El=Fn[9]|0,this.Fh=Fn[10]|0,this.Fl=Fn[11]|0,this.Gh=Fn[12]|0,this.Gl=Fn[13]|0,this.Hh=Fn[14]|0,this.Hl=Fn[15]|0}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:p,Gl:m,Hh:y,Hl:b}=this;return[e,t,n,o,i,s,a,c,l,u,d,h,p,m,y,b]}set(e,t,n,o,i,s,a,c,l,u,d,h,p,m,y,b){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=p|0,this.Gl=m|0,this.Hh=y|0,this.Hl=b|0}process(e,t){for(let P=0;P<16;P++,t+=4)xu[P]=e.getUint32(t),Su[P]=e.getUint32(t+=4);for(let P=16;P<80;P++){let L=xu[P-15]|0,F=Su[P-15]|0,W=Sf(L,F,1)^Sf(L,F,8)^_A(L,F,7),H=_f(L,F,1)^_f(L,F,8)^CA(L,F,7),U=xu[P-2]|0,T=Su[P-2]|0,k=Sf(U,T,19)^Vy(U,T,61)^_A(U,T,6),N=_f(U,T,19)^jy(U,T,61)^CA(U,T,6),j=DH(H,N,Su[P-7],Su[P-16]),V=TH(j,W,k,xu[P-7],xu[P-16]);xu[P]=V|0,Su[P]=j|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:p,Fl:m,Gh:y,Gl:b,Hh:x,Hl:A}=this;for(let P=0;P<80;P++){let L=Sf(d,h,14)^Sf(d,h,18)^Vy(d,h,41),F=_f(d,h,14)^_f(d,h,18)^jy(d,h,41),W=d&p^~d&y,H=h&m^~h&b,U=PH(A,F,H,ppe[P],Su[P]),T=MH(U,x,L,W,fpe[P],xu[P]),k=U|0,N=Sf(n,o,28)^Vy(n,o,34)^Vy(n,o,39),j=_f(n,o,28)^jy(n,o,34)^jy(n,o,39),V=n&i^n&a^i&a,X=o&s^o&c^s&c;x=y|0,A=b|0,y=p|0,b=m|0,p=d|0,m=h|0,{h:d,l:h}=Ja(l|0,u|0,T|0,k|0),l=a|0,u=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let G=IH(k,j,X);n=AH(G,T,N,V),o=G|0}({h:n,l:o}=Ja(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=Ja(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=Ja(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ja(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=Ja(this.Eh|0,this.El|0,d|0,h|0),{h:p,l:m}=Ja(this.Fh|0,this.Fl|0,p|0,m|0),{h:y,l:b}=Ja(this.Gh|0,this.Gl|0,y|0,b|0),{h:x,l:A}=Ja(this.Hh|0,this.Hl|0,x|0,A|0),this.set(n,o,i,s,a,c,l,u,d,h,p,m,y,b,x,A)}roundClean(){ao(xu,Su)}destroy(){ao(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var HE=Uy(()=>new VE);var $E=Uy(()=>new jE);var DA=BigInt(0),AA=BigInt(1);function cl(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Hy(r){let e=r.toString(16);return e.length&1?"0"+e:e}function RH(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?DA:BigInt("0x"+r)}function $m(r){return RH(Za(r))}function ec(r){return Ln(r),RH(Za(Uint8Array.from(r).reverse()))}function zE(r,e){return Hm(r.toString(16).padStart(e*2,"0"))}function _u(r,e){return zE(r,e).reverse()}function Yt(r,e,t){let n;if(typeof e=="string")try{n=Hm(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(Vm(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof t=="number"&&o!==t)throw new Error(r+" of length "+t+" expected, got "+o);return n}var IA=r=>typeof r=="bigint"&&DA<=r;function NH(r,e,t){return IA(r)&&IA(e)&&IA(t)&&e<=r&&r<t}function ra(r,e,t,n){if(!NH(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function OH(r){let e;for(e=0;r>DA;r>>=AA,e+=1);return e}var Cf=r=>(AA<<BigInt(r))-AA;function LH(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),i=n(r),s=n(r),a=0,c=()=>{i.fill(1),s.fill(0),a=0},l=(...p)=>t(s,i,...p),u=(p=n(0))=>{s=l(o(0),p),i=l(),p.length!==0&&(s=l(o(1),p),i=l())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,m=[];for(;p<e;){i=l();let y=i.slice();m.push(y),p+=i.length}return ki(...m)};return(p,m)=>{c(),u(p);let y;for(;!(y=m(d()));)u();return c(),y}}function tc(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(o,i,s){let a=r[o];if(s&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${o}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([o,i])=>n(o,i,!1)),Object.entries(t).forEach(([o,i])=>n(o,i,!0))}function zm(r){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let i=r(t,...n);return e.set(t,i),i}}var Ro=BigInt(0),xn=BigInt(1),If=BigInt(2),hpe=BigInt(3),UH=BigInt(4),VH=BigInt(5),jH=BigInt(8);function Jt(r,e){let t=r%e;return t>=Ro?t:e+t}function or(r,e,t){let n=r;for(;e-- >Ro;)n*=n,n%=t;return n}function FH(r,e){if(r===Ro)throw new Error("invert: expected non-zero number");if(e<=Ro)throw new Error("invert: expected positive modulus, got "+e);let t=Jt(r,e),n=e,o=Ro,i=xn,s=xn,a=Ro;for(;t!==Ro;){let l=n/t,u=n%t,d=o-s*l,h=i-a*l;n=t,t=u,o=s,i=a,s=d,a=h}if(n!==xn)throw new Error("invert: does not exist");return Jt(o,e)}function HH(r,e){let t=(r.ORDER+xn)/UH,n=r.pow(e,t);if(!r.eql(r.sqr(n),e))throw new Error("Cannot find square root");return n}function mpe(r,e){let t=(r.ORDER-VH)/jH,n=r.mul(e,If),o=r.pow(n,t),i=r.mul(e,o),s=r.mul(r.mul(i,If),o),a=r.mul(i,r.sub(s,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function gpe(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-xn,t=0;for(;e%If===Ro;)e/=If,t++;let n=If,o=na(r);for(;BH(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return HH;let i=o.pow(n,e),s=(e+xn)/If;return function(c,l){if(c.is0(l))return l;if(BH(c,l)!==1)throw new Error("Cannot find square root");let u=t,d=c.mul(c.ONE,i),h=c.pow(l,e),p=c.pow(l,s);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let m=1,y=c.sqr(h);for(;!c.eql(y,c.ONE);)if(m++,y=c.sqr(y),m===u)throw new Error("Cannot find square root");let b=xn<<BigInt(u-m-1),x=c.pow(d,b);u=m,d=c.sqr(x),h=c.mul(h,d),p=c.mul(p,x)}return p}}function ype(r){return r%UH===hpe?HH:r%jH===VH?mpe:gpe(r)}var $H=(r,e)=>(Jt(r,e)&xn)===xn,vpe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function TA(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=vpe.reduce((n,o)=>(n[o]="function",n),e);return tc(r,t),r}function wpe(r,e,t){if(t<Ro)throw new Error("invalid exponent, negatives unsupported");if(t===Ro)return r.ONE;if(t===xn)return e;let n=r.ONE,o=e;for(;t>Ro;)t&xn&&(n=r.mul(n,o)),o=r.sqr(o),t>>=xn;return n}function $y(r,e,t=!1){let n=new Array(e.length).fill(t?r.ZERO:void 0),o=e.reduce((s,a,c)=>r.is0(a)?s:(n[c]=s,r.mul(s,a)),r.ONE),i=r.inv(o);return e.reduceRight((s,a,c)=>r.is0(a)?s:(n[c]=r.mul(s,n[c]),r.mul(s,a)),i),n}function BH(r,e){let t=(r.ORDER-xn)/If,n=r.pow(e,t),o=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),s=r.eql(n,r.neg(r.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function zH(r,e){e!==void 0&&ea(e);let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function na(r,e,t=!1,n={}){if(r<=Ro)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,i;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");let u=e;u.BITS&&(o=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(t=u.isLE)}else typeof e=="number"&&(o=e),n.sqrt&&(i=n.sqrt);let{nBitLength:s,nByteLength:a}=zH(r,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,l=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:a,MASK:Cf(s),ZERO:Ro,ONE:xn,create:u=>Jt(u,r),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Ro<=u&&u<r},is0:u=>u===Ro,isValidNot0:u=>!l.is0(u)&&l.isValid(u),isOdd:u=>(u&xn)===xn,neg:u=>Jt(-u,r),eql:(u,d)=>u===d,sqr:u=>Jt(u*u,r),add:(u,d)=>Jt(u+d,r),sub:(u,d)=>Jt(u-d,r),mul:(u,d)=>Jt(u*d,r),pow:(u,d)=>wpe(l,u,d),div:(u,d)=>Jt(u*FH(d,r),r),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>FH(u,r),sqrt:i||(u=>(c||(c=ype(r)),c(l,u))),toBytes:u=>t?_u(u,a):zE(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return t?ec(u):$m(u)},invertBatch:u=>$y(l,u),cmov:(u,d,h)=>h?d:u});return Object.freeze(l)}function qH(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function PA(r){let e=qH(r);return e+Math.ceil(e/2)}function KH(r,e,t=!1){let n=r.length,o=qH(e),i=PA(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=t?ec(r):$m(r),a=Jt(s,e-xn)+xn;return t?_u(a,o):zE(a,o)}var Km=BigInt(0),Af=BigInt(1);function qm(r,e){let t=e.negate();return r?t:e}function qE(r,e,t){let n=e==="pz"?s=>s.pz:s=>s.ez,o=$y(r.Fp,t.map(n));return t.map((s,a)=>s.toAffine(o[a])).map(r.fromAffine)}function XH(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function MA(r,e){XH(r,e);let t=Math.ceil(e/r)+1,n=2**(r-1),o=2**r,i=Cf(r),s=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:o,shiftBy:s}}function WH(r,e,t){let{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=t,a=Number(r&o),c=r>>s;a>n&&(a-=i,c+=Af);let l=e*n,u=l+Math.abs(a)-1,d=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:p,offsetF:l}}function bpe(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Epe(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}var kA=new WeakMap,QH=new WeakMap;function RA(r){return QH.get(r)||1}function GH(r){if(r!==Km)throw new Error("invalid wNAF")}function KE(r,e){return{constTimeNegate:qm,hasPrecomputes(t){return RA(t)!==1},unsafeLadder(t,n,o=r.ZERO){let i=t;for(;n>Km;)n&Af&&(o=o.add(i)),i=i.double(),n>>=Af;return o},precomputeWindow(t,n){let{windows:o,windowSize:i}=MA(n,e),s=[],a=t,c=a;for(let l=0;l<o;l++){c=a,s.push(c);for(let u=1;u<i;u++)c=c.add(a),s.push(c);a=c.double()}return s},wNAF(t,n,o){let i=r.ZERO,s=r.BASE,a=MA(t,e);for(let c=0;c<a.windows;c++){let{nextN:l,offset:u,isZero:d,isNeg:h,isNegF:p,offsetF:m}=WH(o,c,a);o=l,d?s=s.add(qm(p,n[m])):i=i.add(qm(h,n[u]))}return GH(o),{p:i,f:s}},wNAFUnsafe(t,n,o,i=r.ZERO){let s=MA(t,e);for(let a=0;a<s.windows&&o!==Km;a++){let{nextN:c,offset:l,isZero:u,isNeg:d}=WH(o,a,s);if(o=c,!u){let h=n[l];i=i.add(d?h.negate():h)}}return GH(o),i},getPrecomputes(t,n,o){let i=kA.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof o=="function"&&(i=o(i)),kA.set(n,i))),i},wNAFCached(t,n,o){let i=RA(t);return this.wNAF(i,this.getPrecomputes(i,t,o),n)},wNAFCachedUnsafe(t,n,o,i){let s=RA(t);return s===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,o),n,i)},setWindowSize(t,n){XH(n,e),QH.set(t,n),kA.delete(t)}}}function ZH(r,e,t,n){let o=e,i=r.ZERO,s=r.ZERO;for(;t>Km||n>Km;)t&Af&&(i=i.add(o)),n&Af&&(s=s.add(o)),o=o.double(),t>>=Af,n>>=Af;return{p1:i,p2:s}}function WE(r,e,t,n){bpe(t,r),Epe(n,e);let o=t.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");let s=r.ZERO,a=OH(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Cf(c),u=new Array(Number(l)+1).fill(s),d=Math.floor((e.BITS-1)/c)*c,h=s;for(let p=d;p>=0;p-=c){u.fill(s);for(let y=0;y<i;y++){let b=n[y],x=Number(b>>BigInt(p)&l);u[x]=u[x].add(t[y])}let m=s;for(let y=u.length-1,b=s;y>0;y--)b=b.add(u[y]),m=m.add(b);if(h=h.add(m),p!==0)for(let y=0;y<c;y++)h=h.double()}return h}function YH(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return TA(e),e}else return na(r)}function GE(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>Km))throw new Error(`CURVE.${a} must be positive bigint`)}let n=YH(e.p,t.Fp),o=YH(e.n,t.Fn),s=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(let a of s)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var rc=BigInt(0),No=BigInt(1),NA=BigInt(2),xpe=BigInt(8),Spe={zip215:!0};function _pe(r,e,t,n){let o=r.sqr(t),i=r.sqr(n),s=r.add(r.mul(e.a,o),i),a=r.add(r.ONE,r.mul(e.d,r.mul(o,i)));return r.eql(s,a)}function Cpe(r,e={}){let{Fp:t,Fn:n}=GE("edwards",r,e),{h:o,n:i}=r;tc(e,{},{uvRatio:"function"});let s=NA<<BigInt(n.BYTES*8)-No,a=y=>t.create(y),c=e.uvRatio||((y,b)=>{try{return{isValid:!0,value:t.sqrt(t.div(y,b))}}catch{return{isValid:!1,value:rc}}});if(!_pe(t,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function l(y,b,x=!1){let A=x?No:rc;return ra("coordinate "+y,b,A,s),b}function u(y){if(!(y instanceof p))throw new Error("ExtendedPoint expected")}let d=zm((y,b)=>{let{ex:x,ey:A,ez:P}=y,L=y.is0();b==null&&(b=L?xpe:t.inv(P));let F=a(x*b),W=a(A*b),H=a(P*b);if(L)return{x:rc,y:No};if(H!==No)throw new Error("invZ was invalid");return{x:F,y:W}}),h=zm(y=>{let{a:b,d:x}=r;if(y.is0())throw new Error("bad point: ZERO");let{ex:A,ey:P,ez:L,et:F}=y,W=a(A*A),H=a(P*P),U=a(L*L),T=a(U*U),k=a(W*b),N=a(U*a(k+H)),j=a(T+a(x*a(W*H)));if(N!==j)throw new Error("bad point: equation left != right (1)");let V=a(A*P),X=a(L*F);if(V!==X)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(b,x,A,P){this.ex=l("x",b),this.ey=l("y",x),this.ez=l("z",A,!0),this.et=l("t",P),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof p)throw new Error("extended point not allowed");let{x,y:A}=b||{};return l("x",x),l("y",A),new p(x,A,No,a(x*A))}static normalizeZ(b){return qE(p,"ez",b)}static msm(b,x){return WE(p,n,b,x)}_setWindowSize(b){this.precompute(b)}precompute(b=8,x=!0){return m.setWindowSize(this,b),x||this.multiply(NA),this}assertValidity(){h(this)}equals(b){u(b);let{ex:x,ey:A,ez:P}=this,{ex:L,ey:F,ez:W}=b,H=a(x*W),U=a(L*P),T=a(A*W),k=a(F*P);return H===U&&T===k}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:b}=r,{ex:x,ey:A,ez:P}=this,L=a(x*x),F=a(A*A),W=a(NA*a(P*P)),H=a(b*L),U=x+A,T=a(a(U*U)-L-F),k=H+F,N=k-W,j=H-F,V=a(T*N),X=a(k*j),G=a(T*j),J=a(N*k);return new p(V,X,J,G)}add(b){u(b);let{a:x,d:A}=r,{ex:P,ey:L,ez:F,et:W}=this,{ex:H,ey:U,ez:T,et:k}=b,N=a(P*H),j=a(L*U),V=a(W*A*k),X=a(F*T),G=a((P+L)*(H+U)-N-j),J=X-V,ae=X+V,de=a(j-x*N),le=a(G*J),Ne=a(ae*de),xe=a(G*de),se=a(J*ae);return new p(le,Ne,se,xe)}subtract(b){return this.add(b.negate())}multiply(b){let x=b;ra("scalar",x,No,i);let{p:A,f:P}=m.wNAFCached(this,x,p.normalizeZ);return p.normalizeZ([A,P])[0]}multiplyUnsafe(b,x=p.ZERO){let A=b;return ra("scalar",A,rc,i),A===rc?p.ZERO:this.is0()||A===No?this:m.wNAFCachedUnsafe(this,A,p.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return m.wNAFCachedUnsafe(this,i).is0()}toAffine(b){return d(this,b)}clearCofactor(){return o===No?this:this.multiplyUnsafe(o)}static fromBytes(b,x=!1){return Ln(b),this.fromHex(b,x)}static fromHex(b,x=!1){let{d:A,a:P}=r,L=t.BYTES;b=Yt("pointHex",b,L),cl("zip215",x);let F=b.slice(),W=b[L-1];F[L-1]=W&-129;let H=ec(F),U=x?s:t.ORDER;ra("pointHex.y",H,rc,U);let T=a(H*H),k=a(T-No),N=a(A*T-P),{isValid:j,value:V}=c(k,N);if(!j)throw new Error("Point.fromHex: invalid y coordinate");let X=(V&No)===No,G=(W&128)!==0;if(!x&&V===rc&&G)throw new Error("Point.fromHex: x=0 and x_0=1");return G!==X&&(V=a(-V)),p.fromAffine({x:V,y:H})}static fromPrivateScalar(b){return p.BASE.multiply(b)}toBytes(){let{x:b,y:x}=this.toAffine(),A=_u(x,t.BYTES);return A[A.length-1]|=b&No?128:0,A}toRawBytes(){return this.toBytes()}toHex(){return Za(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(r.Gx,r.Gy,No,a(r.Gx*r.Gy)),p.ZERO=new p(rc,No,No,rc),p.Fp=t,p.Fn=n;let m=KE(p,n.BYTES*8);return p}function Ipe(r,e){tc(e,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:t,hash:n}=e,{BASE:o,Fp:i,Fn:s}=r,a=s.ORDER,c=e.randomBytes||sl,l=e.adjustScalarBytes||(F=>F),u=e.domain||((F,W,H)=>{if(cl("phflag",H),W.length||H)throw new Error("Contexts/pre-hash are not supported");return F});function d(F){return s.create(F)}function h(F){return d(ec(F))}function p(F){let W=i.BYTES;F=Yt("private key",F,W);let H=Yt("hashed private key",n(F),2*W),U=l(H.slice(0,W)),T=H.slice(W,2*W),k=h(U);return{head:U,prefix:T,scalar:k}}function m(F){let{head:W,prefix:H,scalar:U}=p(F),T=o.multiply(U),k=T.toBytes();return{head:W,prefix:H,scalar:U,point:T,pointBytes:k}}function y(F){return m(F).pointBytes}function b(F=Uint8Array.of(),...W){let H=ki(...W);return h(n(u(H,Yt("context",F),!!t)))}function x(F,W,H={}){F=Yt("message",F),t&&(F=t(F));let{prefix:U,scalar:T,pointBytes:k}=m(W),N=b(H.context,U,F),j=o.multiply(N).toBytes(),V=b(H.context,j,k,F),X=d(N+V*T);ra("signature.s",X,rc,a);let G=i.BYTES,J=ki(j,_u(X,G));return Yt("result",J,G*2)}let A=Spe;function P(F,W,H,U=A){let{context:T,zip215:k}=U,N=i.BYTES;F=Yt("signature",F,2*N),W=Yt("message",W),H=Yt("publicKey",H,N),k!==void 0&&cl("zip215",k),t&&(W=t(W));let j=ec(F.slice(N,2*N)),V,X,G;try{V=r.fromHex(H,k),X=r.fromHex(F.slice(0,N),k),G=o.multiplyUnsafe(j)}catch{return!1}if(!k&&V.isSmallOrder())return!1;let J=b(T,X.toBytes(),V.toBytes(),W);return X.add(V.multiplyUnsafe(J)).subtract(G).clearCofactor().is0()}return o.precompute(8),{getPublicKey:y,sign:x,verify:P,utils:{getExtendedPublicKey:m,randomPrivateKey:()=>c(i.BYTES),precompute(F=8,W=r.BASE){return W.precompute(F,!1)}},Point:r}}function Ape(r){let e={a:r.a,d:r.d,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=na(e.n,r.nBitLength,!0),o={Fp:t,Fn:n,uvRatio:r.uvRatio},i={hash:r.hash,randomBytes:r.randomBytes,adjustScalarBytes:r.adjustScalarBytes,domain:r.domain,prehash:r.prehash,mapToCurve:r.mapToCurve};return{CURVE:e,curveOpts:o,eddsaOpts:i}}function Dpe(r,e){return Object.assign({},e,{ExtendedPoint:e.Point,CURVE:r})}function JH(r){let{CURVE:e,curveOpts:t,eddsaOpts:n}=Ape(r),o=Cpe(e,t),i=Ipe(o,n);return Dpe(r,i)}var zy=BigInt(0),Wm=BigInt(1),YE=BigInt(2);function Tpe(r){return tc(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(v({},r))}function e$(r){let e=Tpe(r),{P:t,type:n,adjustScalarBytes:o,powPminus2:i,randomBytes:s}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=s||sl,l=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),p=a?YE**BigInt(254):YE**BigInt(447),m=a?BigInt(8)*YE**BigInt(251)-Wm:BigInt(4)*YE**BigInt(445)-Wm,y=p+m+Wm,b=T=>Jt(T,t),x=A(d);function A(T){return _u(b(T),u)}function P(T){let k=Yt("u coordinate",T,u);return a&&(k[31]&=127),b(ec(k))}function L(T){return ec(o(Yt("scalar",T,u)))}function F(T,k){let N=U(P(k),L(T));if(N===zy)throw new Error("invalid private or public key received");return A(N)}function W(T){return F(T,x)}function H(T,k,N){let j=b(T*(k-N));return k=b(k-j),N=b(N+j),{x_2:k,x_3:N}}function U(T,k){ra("u",T,zy,t),ra("scalar",k,p,y);let N=k,j=T,V=Wm,X=zy,G=T,J=Wm,ae=zy;for(let le=BigInt(l-1);le>=zy;le--){let Ne=N>>le&Wm;ae^=Ne,{x_2:V,x_3:G}=H(ae,V,G),{x_2:X,x_3:J}=H(ae,X,J),ae=Ne;let xe=V+X,se=b(xe*xe),ft=V-X,jt=b(ft*ft),Le=se-jt,Xt=G+J,Xn=G-J,nn=b(Xn*xe),on=b(Xt*ft),An=nn+on,qi=nn-on;G=b(An*An),J=b(j*b(qi*qi)),V=b(se*jt),X=b(Le*(se+b(h*Le)))}({x_2:V,x_3:G}=H(ae,V,G)),{x_2:X,x_3:J}=H(ae,X,J);let de=i(X);return b(V*de)}return{scalarMult:F,scalarMultBase:W,getSharedSecret:(T,k)=>F(T,k),getPublicKey:T=>W(T),utils:{randomPrivateKey:()=>c(u)},GuBytes:x.slice()}}var mje=BigInt(0),Ppe=BigInt(1),t$=BigInt(2),Mpe=BigInt(3),kpe=BigInt(5),Rpe=BigInt(8),qy={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Rpe,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function n$(r){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),i=qy.p,a=r*r%i*r%i,c=or(a,t$,i)*a%i,l=or(c,Ppe,i)*r%i,u=or(l,kpe,i)*l%i,d=or(u,e,i)*u%i,h=or(d,t,i)*d%i,p=or(h,n,i)*h%i,m=or(p,o,i)*p%i,y=or(m,o,i)*p%i,b=or(y,e,i)*u%i;return{pow_p_5_8:or(b,t$,i)*r%i,b2:a}}function o$(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var r$=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Npe(r,e){let t=qy.p,n=Jt(e*e*e,t),o=Jt(n*n*e,t),i=n$(r*o).pow_p_5_8,s=Jt(r*n*i,t),a=Jt(e*s*s,t),c=s,l=Jt(s*r$,t),u=a===r,d=a===Jt(-r,t),h=a===Jt(-r*r$,t);return u&&(s=c),(d||h)&&(s=l),$H(s,t)&&(s=Jt(-s,t)),{isValid:u||d,value:s}}var Ope=na(qy.p,void 0,!0),Lpe=I(v({},qy),{Fp:Ope,hash:$E,adjustScalarBytes:o$,uvRatio:Npe}),Ky=JH(Lpe);var Wy=(()=>{let r=qy.p;return e$({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:n}=n$(e);return Jt(or(t,Mpe,r)*n,r)},adjustScalarBytes:o$})})();var Df=32,Ri=64,OA=32;var Gm,i$=f(null,null,function*(){try{return yield Qr.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}});function s$(){let r=Ky.utils.randomPrivateKey(),e=Ky.getPublicKey(r);return{privateKey:jpe(r,e),publicKey:e}}function Fpe(r,e){return f(this,null,function*(){let t;r.length===Ri?t=r.subarray(0,32):t=r;let n={crv:"Ed25519",kty:"OKP",x:te(r.subarray(32),"base64url"),d:te(t,"base64url"),ext:!0,key_ops:["sign"]},o=yield Qr.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=yield Qr.get().subtle.sign({name:"Ed25519"},o,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)})}function Bpe(r,e){let t=r.subarray(0,OA);return Ky.sign(e instanceof Uint8Array?e:e.subarray(),t)}function a$(r,e){return f(this,null,function*(){return Gm==null&&(Gm=yield i$),Gm?Fpe(r,e):Bpe(r,e)})}function Upe(r,e,t){return f(this,null,function*(){if(r.buffer instanceof ArrayBuffer){let n=yield Qr.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return yield Qr.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")})}function Vpe(r,e,t){return Ky.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function c$(r,e,t){return f(this,null,function*(){return Gm==null&&(Gm=yield i$),Gm?Upe(r,e,t):Vpe(r,e,t)})}function jpe(r,e){let t=new Uint8Array(Ri);for(let n=0;n<OA;n++)t[n]=r[n],t[OA+n]=e[n];return t}function Ym(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Gy=class{type="Ed25519";raw;constructor(e){this.raw=Qm(e,Df)}toMultihash(){return wn.digest(En(this))}toCID(){return ce.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}verify(e,t,n){n?.signal?.throwIfAborted();let o=c$(this.raw,t,e);return Ym(o)?o.then(i=>(n?.signal?.throwIfAborted(),i)):o}},Xm=class{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=Qm(e,Ri),this.publicKey=new Gy(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();let n=a$(this.raw,e);return Ym(n)?n.then(o=>(t?.signal?.throwIfAborted(),o)):(t?.signal?.throwIfAborted(),n)}};function LA(r){if(r.length>Ri){r=Qm(r,Ri+Df);let n=r.subarray(0,Ri),o=r.subarray(Ri,r.length);return new Xm(n,o)}r=Qm(r,Ri);let e=r.subarray(0,Ri),t=r.subarray(Df);return new Xm(e,t)}function FA(r){return r=Qm(r,Df),new Gy(r)}function u$(){return f(this,null,function*(){let{privateKey:r,publicKey:e}=s$();return new Xm(r,e)})}function Qm(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Y(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}var Hpe=Math.pow(2,7),$pe=Math.pow(2,14),zpe=Math.pow(2,21),BA=Math.pow(2,28),UA=Math.pow(2,35),VA=Math.pow(2,42),jA=Math.pow(2,49),Lt=128,co=127;function _t(r){if(r<Hpe)return 1;if(r<$pe)return 2;if(r<zpe)return 3;if(r<BA)return 4;if(r<UA)return 5;if(r<VA)return 6;if(r<jA)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Zm(r,e,t=0){switch(_t(r)){case 8:e[t++]=r&255|Lt,r/=128;case 7:e[t++]=r&255|Lt,r/=128;case 6:e[t++]=r&255|Lt,r/=128;case 5:e[t++]=r&255|Lt,r/=128;case 4:e[t++]=r&255|Lt,r>>>=7;case 3:e[t++]=r&255|Lt,r>>>=7;case 2:e[t++]=r&255|Lt,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function qpe(r,e,t=0){switch(_t(r)){case 8:e.set(t++,r&255|Lt),r/=128;case 7:e.set(t++,r&255|Lt),r/=128;case 6:e.set(t++,r&255|Lt),r/=128;case 5:e.set(t++,r&255|Lt),r/=128;case 4:e.set(t++,r&255|Lt),r>>>=7;case 3:e.set(t++,r&255|Lt),r>>>=7;case 2:e.set(t++,r&255|Lt),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function HA(r,e){let t=r[e],n=0;if(n+=t&co,t<Lt||(t=r[e+1],n+=(t&co)<<7,t<Lt)||(t=r[e+2],n+=(t&co)<<14,t<Lt)||(t=r[e+3],n+=(t&co)<<21,t<Lt)||(t=r[e+4],n+=(t&co)*BA,t<Lt)||(t=r[e+5],n+=(t&co)*UA,t<Lt)||(t=r[e+6],n+=(t&co)*VA,t<Lt)||(t=r[e+7],n+=(t&co)*jA,t<Lt))return n;throw new RangeError("Could not decode varint")}function Kpe(r,e){let t=r.get(e),n=0;if(n+=t&co,t<Lt||(t=r.get(e+1),n+=(t&co)<<7,t<Lt)||(t=r.get(e+2),n+=(t&co)<<14,t<Lt)||(t=r.get(e+3),n+=(t&co)<<21,t<Lt)||(t=r.get(e+4),n+=(t&co)*BA,t<Lt)||(t=r.get(e+5),n+=(t&co)*UA,t<Lt)||(t=r.get(e+6),n+=(t&co)*VA,t<Lt)||(t=r.get(e+7),n+=(t&co)*jA,t<Lt))return n;throw new RangeError("Could not decode varint")}function Sn(r,e,t=0){return e==null&&(e=wr(_t(r))),e instanceof Uint8Array?Zm(r,e,t):qpe(r,e,t)}function oa(r,e=0){return r instanceof Uint8Array?HA(r,e):Kpe(r,e)}var $A=new Float32Array([-0]),Cu=new Uint8Array($A.buffer);function d$(r,e,t){$A[0]=r,e[t]=Cu[0],e[t+1]=Cu[1],e[t+2]=Cu[2],e[t+3]=Cu[3]}function f$(r,e){return Cu[0]=r[e],Cu[1]=r[e+1],Cu[2]=r[e+2],Cu[3]=r[e+3],$A[0]}var zA=new Float64Array([-0]),lo=new Uint8Array(zA.buffer);function p$(r,e,t){zA[0]=r,e[t]=lo[0],e[t+1]=lo[1],e[t+2]=lo[2],e[t+3]=lo[3],e[t+4]=lo[4],e[t+5]=lo[5],e[t+6]=lo[6],e[t+7]=lo[7]}function h$(r,e){return lo[0]=r[e],lo[1]=r[e+1],lo[2]=r[e+2],lo[3]=r[e+3],lo[4]=r[e+4],lo[5]=r[e+5],lo[6]=r[e+6],lo[7]=r[e+7],zA[0]}var Wpe=BigInt(Number.MAX_SAFE_INTEGER),Gpe=BigInt(Number.MIN_SAFE_INTEGER),Ni=class r{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Tf;if(e<Wpe&&e>Gpe)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,o=e-(n<<32n);return t&&(n=~n|0n,o=~o|0n,++o>m$&&(o=0n,++n>m$&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(e){if(e===0)return Tf;let t=e<0;t&&(e=-e);let n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(e){return typeof e=="number"?r.fromNumber(e):typeof e=="bigint"?r.fromBigInt(e):typeof e=="string"?r.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new r(e.low>>>0,e.high>>>0):Tf}},Tf=new Ni(0,0);Tf.toBigInt=function(){return 0n};Tf.zzEncode=Tf.zzDecode=function(){return this};Tf.length=function(){return 1};var m$=4294967296n;function g$(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function y$(r,e,t){if(t-e<1)return"";let o,i=[],s=0,a;for(;e<t;)a=r[e++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function qA(r,e,t){let n=t,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128);return t-n}function ia(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function XE(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var KA=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ia(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw ia(this,4);return XE(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ia(this,4);return XE(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw ia(this,4);let e=f$(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw ia(this,4);let e=h$(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ia(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return y$(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ia(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ia(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Ni(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw ia(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw ia(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ia(this,8);let e=XE(this.buf,this.pos+=4),t=XE(this.buf,this.pos+=4);return new Ni(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=HA(this.buf,this.pos);return this.pos+=_t(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function WA(r){return new KA(r instanceof Uint8Array?r:r.subarray())}function Fe(r,e,t){let n=WA(r);return e.decode(n,void 0,t)}function GA(r){let e=r??8192,t=e>>>1,n,o=e;return function(s){if(s<1||s>t)return wr(s);o+s>e&&(n=wr(e),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var Pf=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function YA(){}var QA=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},Ype=GA();function Xpe(r){return globalThis.Buffer!=null?wr(r):Ype(r)}var Xy=class{len;head;tail;states;constructor(){this.len=0,this.head=new Pf(YA,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Pf(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new ZA((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(QE,10,Ni.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Ni.fromBigInt(e);return this._push(QE,t.length(),t)}uint64Number(e){return this._push(Zm,_t(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Ni.fromBigInt(e).zzEncode();return this._push(QE,t.length(),t)}sint64Number(e){let t=Ni.fromNumber(e).zzEncode();return this._push(QE,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(XA,1,e?1:0)}fixed32(e){return this._push(Yy,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Ni.fromBigInt(e);return this._push(Yy,4,t.lo)._push(Yy,4,t.hi)}fixed64Number(e){let t=Ni.fromNumber(e);return this._push(Yy,4,t.lo)._push(Yy,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(d$,4,e)}double(e){return this._push(p$,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(XA,1,0):this.uint32(t)._push(Zpe,t,e)}string(e){let t=g$(e);return t!==0?this.uint32(t)._push(qA,t,e):this._push(XA,1,0)}fork(){return this.states=new QA(this),this.head=this.tail=new Pf(YA,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Pf(YA,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=Xpe(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function XA(r,e,t){e[t]=r&255}function Qpe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var ZA=class extends Pf{next;constructor(e,t){super(Qpe,e,t),this.next=void 0}};function QE(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Yy(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Zpe(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Xy.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(Jpe,e,r),this},Xy.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(ehe,e,r),this});function Jpe(r,e,t){e.set(r,t)}function ehe(r,e,t){r.length<40?qA(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(Z(r),t)}function JA(){return new Xy}function Be(r,e){let t=JA();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Qy=function(r){return r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32",r}(Qy||{});function ZE(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function er(r){function e(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let t=function(i,s){let a=e(i);s.int32(a)},n=function(i){let s=i.int32();return e(s)};return ZE("enum",Qy.VARINT,t,n)}function Ue(r,e){return ZE("message",Qy.LENGTH_DELIMITED,r,e)}var qt=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"},Zy=class extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"};var ir=function(r){return r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA",r}(ir||{}),w$=function(r){return r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA",r}(w$||{});(function(r){r.codec=()=>er(w$)})(ir||(ir={}));var nc;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),ir.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=ir.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(nc||(nc={}));var Jy;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),ir.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=ir.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(Jy||(Jy={}));function Oo(r){if(isNaN(r)||r<=0)throw new Y("random bytes length must be a Number bigger than 0");return sl(r)}var t2={};Dn(t2,{MAX_RSA_KEY_SIZE:()=>eD,generateRSAKeyPair:()=>lD,jwkToJWKKeyPair:()=>S$,jwkToPkcs1:()=>ohe,jwkToPkix:()=>oD,jwkToRSAPrivateKey:()=>cD,pkcs1MessageToJwk:()=>rD,pkcs1MessageToRSAPrivateKey:()=>JE,pkcs1ToJwk:()=>nhe,pkcs1ToRSAPrivateKey:()=>iD,pkixMessageToJwk:()=>nD,pkixMessageToRSAPublicKey:()=>aD,pkixToJwk:()=>ihe,pkixToRSAPublicKey:()=>sD});var oc=HE;var Jm=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=t2.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return ce.createV1(114,this._multihash)}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}verify(e,t,n){return x$(this.jwk,t,e,n)}},e2=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=t2.jwkToPkcs1(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}sign(e,t){return E$(this.jwk,e,t)}};var eD=8192,tD=18,the=1062,rhe=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function nhe(r){let e=hs(r);return rD(e)}function rD(r){return{n:te(r[1],"base64url"),e:te(r[2],"base64url"),d:te(r[3],"base64url"),p:te(r[4],"base64url"),q:te(r[5],"base64url"),dp:te(r[6],"base64url"),dq:te(r[7],"base64url"),qi:te(r[8],"base64url"),kty:"RSA"}}function ohe(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Y("JWK was missing components");return Js([ko(Uint8Array.from([0])),ko(Z(r.n,"base64url")),ko(Z(r.e,"base64url")),ko(Z(r.d,"base64url")),ko(Z(r.p,"base64url")),ko(Z(r.q,"base64url")),ko(Z(r.dp,"base64url")),ko(Z(r.dq,"base64url")),ko(Z(r.qi,"base64url"))]).subarray()}function ihe(r){let e=hs(r,{offset:0});return nD(e)}function nD(r){let e=hs(r[1],{offset:0});return{kty:"RSA",n:te(e[0],"base64url"),e:te(e[1],"base64url")}}function oD(r){if(r.n==null||r.e==null)throw new Y("JWK was missing components");return Js([rhe,By(Js([ko(Z(r.n,"base64url")),ko(Z(r.e,"base64url"))]))]).subarray()}function iD(r){let e=hs(r);return JE(e)}function JE(r){let e=rD(r);return cD(e)}function sD(r,e){if(r.byteLength>=the)throw new cf("Key size is too large");let t=hs(r,{offset:0});return aD(t,r,e)}function aD(r,e,t){let n=nD(r);if(t==null){let o=oc(nc.encode({Type:ir.RSA,Data:e}));t=yi(tD,o)}return new Jm(n,t)}function cD(r){if(C$(r)>eD)throw new Y("Key size is too large");let e=S$(r),t=oc(nc.encode({Type:ir.RSA,Data:oD(e.publicKey)})),n=yi(tD,t);return new e2(e.privateKey,new Jm(e.publicKey,n))}function lD(r){return f(this,null,function*(){if(r>eD)throw new Y("Key size is too large");let e=yield _$(r),t=oc(nc.encode({Type:ir.RSA,Data:oD(e.publicKey)})),n=yi(tD,t);return new e2(e.privateKey,new Jm(e.publicKey,n))})}function S$(r){if(r==null)throw new Y("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}function _$(r,e){return f(this,null,function*(){let t=yield Qr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);e?.signal?.throwIfAborted();let n=yield she(t,e);return{privateKey:n[0],publicKey:n[1]}})}function E$(r,e,t){return f(this,null,function*(){let n=yield Qr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);t?.signal?.throwIfAborted();let o=yield Qr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)})}function x$(r,e,t,n){return f(this,null,function*(){let o=yield Qr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let i=yield Qr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,e,t instanceof Uint8Array?t:t.subarray());return n?.signal?.throwIfAborted(),i})}function she(r,e){return f(this,null,function*(){if(r.privateKey==null||r.publicKey==null)throw new Y("Private and public key are required");let t=yield Promise.all([Qr.get().subtle.exportKey("jwk",r.privateKey),Qr.get().subtle.exportKey("jwk",r.publicKey)]);return e?.signal?.throwIfAborted(),t})}function C$(r){if(r.kty!=="RSA")throw new Y("invalid key type");if(r.n==null)throw new Y("invalid key modulus");return Z(r.n,"base64url").length*8}var ex=class extends Um{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,bf(e);let n=bu(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),ao(i)}update(e){return jm(this),this.iHash.update(e),this}digestInto(e){jm(this),Ln(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Iu=(r,e,t)=>new ex(r,e).update(t).digest();Iu.create=(r,e)=>new ex(r,e);function I$(r){r.lowS!==void 0&&cl("lowS",r.lowS),r.prehash!==void 0&&cl("prehash",r.prehash)}var uD=class extends Error{constructor(e=""){super(e)}},ul={Err:uD,_tlv:{encode:(r,e)=>{let{Err:t}=ul;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let n=e.length/2,o=Hy(n);if(o.length/2&128)throw new t("tlv.encode: long form length too big");let i=n>127?Hy(o.length/2|128):"";return Hy(r)+i+o+e},decode(r,e){let{Err:t}=ul,n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");let o=e[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let u of l)s=s<<8|u;if(n+=c,s<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+s);if(a.length!==s)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+s)}}},_int:{encode(r){let{Err:e}=ul;if(r<r2)throw new e("integer: negative integers are not allowed");let t=Hy(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=ul;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return $m(r)}},toSig(r){let{Err:e,_int:t,_tlv:n}=ul,o=Yt("signature",r),{v:i,l:s}=n.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){let{_tlv:e,_int:t}=ul,n=e.encode(2,t.encode(r.r)),o=e.encode(2,t.encode(r.s)),i=n+o;return e.encode(48,i)}},r2=BigInt(0),n2=BigInt(1),ahe=BigInt(2),tx=BigInt(3),che=BigInt(4);function lhe(r,e,t){function n(o){let i=r.sqr(o),s=r.mul(i,o);return r.add(r.add(s,r.mul(o,e)),t)}return n}function A$(r,e,t){let{BYTES:n}=r;function o(i){let s;if(typeof i=="bigint")s=i;else{let a=Yt("private key",i);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{s=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof i}`)}}if(t&&(s=r.create(s)),!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}return o}function uhe(r,e={}){let{Fp:t,Fn:n}=GE("weierstrass",r,e),{h:o,n:i}=r;tc(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:s}=e;if(s&&(!t.is0(r.a)||typeof s.beta!="bigint"||typeof s.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(U,T,k){let{x:N,y:j}=T.toAffine(),V=t.toBytes(N);if(cl("isCompressed",k),k){a();let X=!t.isOdd(j);return ki(D$(X),V)}else return ki(Uint8Array.of(4),V,t.toBytes(j))}function l(U){Ln(U);let T=t.BYTES,k=T+1,N=2*T+1,j=U.length,V=U[0],X=U.subarray(1);if(j===k&&(V===2||V===3)){let G=t.fromBytes(X);if(!t.isValid(G))throw new Error("bad point: is not on curve, wrong x");let J=h(G),ae;try{ae=t.sqrt(J)}catch(Ne){let xe=Ne instanceof Error?": "+Ne.message:"";throw new Error("bad point: is not on curve, sqrt error"+xe)}a();let de=t.isOdd(ae);return(V&1)===1!==de&&(ae=t.neg(ae)),{x:G,y:ae}}else if(j===N&&V===4){let G=t.fromBytes(X.subarray(T*0,T*1)),J=t.fromBytes(X.subarray(T*1,T*2));if(!p(G,J))throw new Error("bad point: is not on curve");return{x:G,y:J}}else throw new Error(`bad point: got length ${j}, expected compressed=${k} or uncompressed=${N}`)}let u=e.toBytes||c,d=e.fromBytes||l,h=lhe(t,r.a,r.b);function p(U,T){let k=t.sqr(T),N=h(U);return t.eql(k,N)}if(!p(r.Gx,r.Gy))throw new Error("bad curve params: generator point");let m=t.mul(t.pow(r.a,tx),che),y=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(m,y)))throw new Error("bad curve params: a or b");function b(U,T,k=!1){if(!t.isValid(T)||k&&t.is0(T))throw new Error(`bad point coordinate ${U}`);return T}function x(U){if(!(U instanceof F))throw new Error("ProjectivePoint expected")}let A=zm((U,T)=>{let{px:k,py:N,pz:j}=U;if(t.eql(j,t.ONE))return{x:k,y:N};let V=U.is0();T==null&&(T=V?t.ONE:t.inv(j));let X=t.mul(k,T),G=t.mul(N,T),J=t.mul(j,T);if(V)return{x:t.ZERO,y:t.ZERO};if(!t.eql(J,t.ONE))throw new Error("invZ was invalid");return{x:X,y:G}}),P=zm(U=>{if(U.is0()){if(e.allowInfinityPoint&&!t.is0(U.py))return;throw new Error("bad point: ZERO")}let{x:T,y:k}=U.toAffine();if(!t.isValid(T)||!t.isValid(k))throw new Error("bad point: x or y not field elements");if(!p(T,k))throw new Error("bad point: equation left != right");if(!U.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function L(U,T,k,N,j){return k=new F(t.mul(k.px,U),k.py,k.pz),T=qm(N,T),k=qm(j,k),T.add(k)}class F{constructor(T,k,N){this.px=b("x",T),this.py=b("y",k,!0),this.pz=b("z",N),Object.freeze(this)}static fromAffine(T){let{x:k,y:N}=T||{};if(!T||!t.isValid(k)||!t.isValid(N))throw new Error("invalid affine point");if(T instanceof F)throw new Error("projective point not allowed");return t.is0(k)&&t.is0(N)?F.ZERO:new F(k,N,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(T){return qE(F,"pz",T)}static fromBytes(T){return Ln(T),F.fromHex(T)}static fromHex(T){let k=F.fromAffine(d(Yt("pointHex",T)));return k.assertValidity(),k}static fromPrivateKey(T){let k=A$(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return F.BASE.multiply(k(T))}static msm(T,k){return WE(F,n,T,k)}precompute(T=8,k=!0){return H.setWindowSize(this,T),k||this.multiply(tx),this}_setWindowSize(T){this.precompute(T)}assertValidity(){P(this)}hasEvenY(){let{y:T}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(T)}equals(T){x(T);let{px:k,py:N,pz:j}=this,{px:V,py:X,pz:G}=T,J=t.eql(t.mul(k,G),t.mul(V,j)),ae=t.eql(t.mul(N,G),t.mul(X,j));return J&&ae}negate(){return new F(this.px,t.neg(this.py),this.pz)}double(){let{a:T,b:k}=r,N=t.mul(k,tx),{px:j,py:V,pz:X}=this,G=t.ZERO,J=t.ZERO,ae=t.ZERO,de=t.mul(j,j),le=t.mul(V,V),Ne=t.mul(X,X),xe=t.mul(j,V);return xe=t.add(xe,xe),ae=t.mul(j,X),ae=t.add(ae,ae),G=t.mul(T,ae),J=t.mul(N,Ne),J=t.add(G,J),G=t.sub(le,J),J=t.add(le,J),J=t.mul(G,J),G=t.mul(xe,G),ae=t.mul(N,ae),Ne=t.mul(T,Ne),xe=t.sub(de,Ne),xe=t.mul(T,xe),xe=t.add(xe,ae),ae=t.add(de,de),de=t.add(ae,de),de=t.add(de,Ne),de=t.mul(de,xe),J=t.add(J,de),Ne=t.mul(V,X),Ne=t.add(Ne,Ne),de=t.mul(Ne,xe),G=t.sub(G,de),ae=t.mul(Ne,le),ae=t.add(ae,ae),ae=t.add(ae,ae),new F(G,J,ae)}add(T){x(T);let{px:k,py:N,pz:j}=this,{px:V,py:X,pz:G}=T,J=t.ZERO,ae=t.ZERO,de=t.ZERO,le=r.a,Ne=t.mul(r.b,tx),xe=t.mul(k,V),se=t.mul(N,X),ft=t.mul(j,G),jt=t.add(k,N),Le=t.add(V,X);jt=t.mul(jt,Le),Le=t.add(xe,se),jt=t.sub(jt,Le),Le=t.add(k,j);let Xt=t.add(V,G);return Le=t.mul(Le,Xt),Xt=t.add(xe,ft),Le=t.sub(Le,Xt),Xt=t.add(N,j),J=t.add(X,G),Xt=t.mul(Xt,J),J=t.add(se,ft),Xt=t.sub(Xt,J),de=t.mul(le,Le),J=t.mul(Ne,ft),de=t.add(J,de),J=t.sub(se,de),de=t.add(se,de),ae=t.mul(J,de),se=t.add(xe,xe),se=t.add(se,xe),ft=t.mul(le,ft),Le=t.mul(Ne,Le),se=t.add(se,ft),ft=t.sub(xe,ft),ft=t.mul(le,ft),Le=t.add(Le,ft),xe=t.mul(se,Le),ae=t.add(ae,xe),xe=t.mul(Xt,Le),J=t.mul(jt,J),J=t.sub(J,xe),xe=t.mul(jt,se),de=t.mul(Xt,de),de=t.add(de,xe),new F(J,ae,de)}subtract(T){return this.add(T.negate())}is0(){return this.equals(F.ZERO)}multiply(T){let{endo:k}=e;if(!n.isValidNot0(T))throw new Error("invalid scalar: out of range");let N,j,V=X=>H.wNAFCached(this,X,F.normalizeZ);if(k){let{k1neg:X,k1:G,k2neg:J,k2:ae}=k.splitScalar(T),{p:de,f:le}=V(G),{p:Ne,f:xe}=V(ae);j=le.add(xe),N=L(k.beta,de,Ne,X,J)}else{let{p:X,f:G}=V(T);N=X,j=G}return F.normalizeZ([N,j])[0]}multiplyUnsafe(T){let{endo:k}=e,N=this;if(!n.isValid(T))throw new Error("invalid scalar: out of range");if(T===r2||N.is0())return F.ZERO;if(T===n2)return N;if(H.hasPrecomputes(this))return this.multiply(T);if(k){let{k1neg:j,k1:V,k2neg:X,k2:G}=k.splitScalar(T),{p1:J,p2:ae}=ZH(F,N,V,G);return L(k.beta,J,ae,j,X)}else return H.wNAFCachedUnsafe(N,T)}multiplyAndAddUnsafe(T,k,N){let j=this.multiplyUnsafe(k).add(T.multiplyUnsafe(N));return j.is0()?void 0:j}toAffine(T){return A(this,T)}isTorsionFree(){let{isTorsionFree:T}=e;return o===n2?!0:T?T(F,this):H.wNAFCachedUnsafe(this,i).is0()}clearCofactor(){let{clearCofactor:T}=e;return o===n2?this:T?T(F,this):this.multiplyUnsafe(o)}toBytes(T=!0){return cl("isCompressed",T),this.assertValidity(),u(F,this,T)}toRawBytes(T=!0){return this.toBytes(T)}toHex(T=!0){return Za(this.toBytes(T))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}F.BASE=new F(r.Gx,r.Gy,t.ONE),F.ZERO=new F(t.ZERO,t.ONE,t.ZERO),F.Fp=t,F.Fn=n;let W=n.BITS,H=KE(F,e.endo?Math.ceil(W/2):W);return F}function D$(r){return Uint8Array.of(r?2:3)}function dhe(r,e,t={}){tc(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=e.randomBytes||sl,o=e.hmac||((N,...j)=>Iu(e.hash,N,ki(...j))),{Fp:i,Fn:s}=r,{ORDER:a,BITS:c}=s;function l(N){let j=a>>n2;return N>j}function u(N){return l(N)?s.neg(N):N}function d(N,j){if(!s.isValidNot0(j))throw new Error(`invalid signature ${N}: out of range 1..CURVE.n`)}class h{constructor(j,V,X){d("r",j),d("s",V),this.r=j,this.s=V,X!=null&&(this.recovery=X),Object.freeze(this)}static fromCompact(j){let V=s.BYTES,X=Yt("compactSignature",j,V*2);return new h(s.fromBytes(X.subarray(0,V)),s.fromBytes(X.subarray(V,V*2)))}static fromDER(j){let{r:V,s:X}=ul.toSig(Yt("DER",j));return new h(V,X)}assertValidity(){}addRecoveryBit(j){return new h(this.r,this.s,j)}recoverPublicKey(j){let V=i.ORDER,{r:X,s:G,recovery:J}=this;if(J==null||![0,1,2,3].includes(J))throw new Error("recovery id invalid");if(a*ahe<V&&J>1)throw new Error("recovery id is ambiguous for h>1 curve");let de=J===2||J===3?X+a:X;if(!i.isValid(de))throw new Error("recovery id 2 or 3 invalid");let le=i.toBytes(de),Ne=r.fromHex(ki(D$((J&1)===0),le)),xe=s.inv(de),se=P(Yt("msgHash",j)),ft=s.create(-se*xe),jt=s.create(G*xe),Le=r.BASE.multiplyUnsafe(ft).add(Ne.multiplyUnsafe(jt));if(Le.is0())throw new Error("point at infinify");return Le.assertValidity(),Le}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,s.neg(this.s),this.recovery):this}toBytes(j){if(j==="compact")return ki(s.toBytes(this.r),s.toBytes(this.s));if(j==="der")return Hm(ul.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Za(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Za(this.toBytes("compact"))}}let p=A$(s,t.allowedPrivateKeyLengths,t.wrapPrivateKey),m={isValidPrivateKey(N){try{return p(N),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let N=a;return KH(n(PA(N)),N)},precompute(N=8,j=r.BASE){return j.precompute(N,!1)}};function y(N,j=!0){return r.fromPrivateKey(N).toBytes(j)}function b(N){if(typeof N=="bigint")return!1;if(N instanceof r)return!0;let V=Yt("key",N).length,X=i.BYTES,G=X+1,J=2*X+1;if(!(t.allowedPrivateKeyLengths||s.BYTES===G))return V===G||V===J}function x(N,j,V=!0){if(b(N)===!0)throw new Error("first arg must be private key");if(b(j)===!1)throw new Error("second arg must be public key");return r.fromHex(j).multiply(p(N)).toBytes(V)}let A=e.bits2int||function(N){if(N.length>8192)throw new Error("input is too large");let j=$m(N),V=N.length*8-c;return V>0?j>>BigInt(V):j},P=e.bits2int_modN||function(N){return s.create(A(N))},L=Cf(c);function F(N){return ra("num < 2^"+c,N,r2,L),s.toBytes(N)}function W(N,j,V=H){if(["recovered","canonical"].some(jt=>jt in V))throw new Error("sign() legacy options not supported");let{hash:X}=e,{lowS:G,prehash:J,extraEntropy:ae}=V;G==null&&(G=!0),N=Yt("msgHash",N),I$(V),J&&(N=Yt("prehashed msgHash",X(N)));let de=P(N),le=p(j),Ne=[F(le),F(de)];if(ae!=null&&ae!==!1){let jt=ae===!0?n(i.BYTES):ae;Ne.push(Yt("extraEntropy",jt))}let xe=ki(...Ne),se=de;function ft(jt){let Le=A(jt);if(!s.isValidNot0(Le))return;let Xt=s.inv(Le),Xn=r.BASE.multiply(Le).toAffine(),nn=s.create(Xn.x);if(nn===r2)return;let on=s.create(Xt*s.create(se+nn*le));if(on===r2)return;let An=(Xn.x===nn?0:2)|Number(Xn.y&n2),qi=on;return G&&l(on)&&(qi=u(on),An^=1),new h(nn,qi,An)}return{seed:xe,k2sig:ft}}let H={lowS:e.lowS,prehash:!1},U={lowS:e.lowS,prehash:!1};function T(N,j,V=H){let{seed:X,k2sig:G}=W(N,j,V);return LH(e.hash.outputLen,s.BYTES,o)(X,G)}r.BASE.precompute(8);function k(N,j,V,X=U){let G=N;j=Yt("msgHash",j),V=Yt("publicKey",V),I$(X);let{lowS:J,prehash:ae,format:de}=X;if("strict"in X)throw new Error("options.strict was renamed to lowS");if(de!==void 0&&!["compact","der","js"].includes(de))throw new Error('format must be "compact", "der" or "js"');let le=typeof G=="string"||Vm(G),Ne=!le&&!de&&typeof G=="object"&&G!==null&&typeof G.r=="bigint"&&typeof G.s=="bigint";if(!le&&!Ne)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let xe,se;try{if(Ne)if(de===void 0||de==="js")xe=new h(G.r,G.s);else throw new Error("invalid format");if(le){try{de!=="compact"&&(xe=h.fromDER(G))}catch(qi){if(!(qi instanceof ul.Err))throw qi}!xe&&de!=="der"&&(xe=h.fromCompact(G))}se=r.fromHex(V)}catch{return!1}if(!xe||J&&xe.hasHighS())return!1;ae&&(j=e.hash(j));let{r:ft,s:jt}=xe,Le=P(j),Xt=s.inv(jt),Xn=s.create(Le*Xt),nn=s.create(ft*Xt),on=r.BASE.multiplyUnsafe(Xn).add(se.multiplyUnsafe(nn));return on.is0()?!1:s.create(on.x)===ft}return Object.freeze({getPublicKey:y,getSharedSecret:x,sign:T,verify:k,utils:m,Point:r,Signature:h})}function fhe(r){let e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=na(e.n,r.nBitLength),o={Fp:t,Fn:n,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:o}}function phe(r){let{CURVE:e,curveOpts:t}=fhe(r),n={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:n}}function hhe(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function T$(r){let{CURVE:e,curveOpts:t,ecdsaOpts:n}=phe(r),o=uhe(e,t),i=dhe(o,n,t);return hhe(r,i)}function P$(r,e){let t=n=>T$(I(v({},r),{hash:n}));return I(v({},t(e)),{create:t})}var rx={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},r$e=BigInt(0),mhe=BigInt(1),dD=BigInt(2),M$=(r,e)=>(r+e/dD)/e;function ghe(r){let e=rx.p,t=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,d=or(u,t,e)*u%e,h=or(d,t,e)*u%e,p=or(h,dD,e)*l%e,m=or(p,o,e)*p%e,y=or(m,i,e)*m%e,b=or(y,a,e)*y%e,x=or(b,c,e)*b%e,A=or(x,a,e)*y%e,P=or(A,t,e)*u%e,L=or(P,s,e)*m%e,F=or(L,n,e)*l%e,W=or(F,dD,e);if(!fD.eql(fD.sqr(W),r))throw new Error("Cannot find square root");return W}var fD=na(rx.p,void 0,void 0,{sqrt:ghe}),sa=P$(I(v({},rx),{Fp:fD,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let e=rx.n,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-mhe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,s=BigInt("0x100000000000000000000000000000000"),a=M$(i*r,e),c=M$(-n*r,e),l=Jt(r-a*t-c*o,e),u=Jt(-a*n-c*i,e),d=l>s,h=u>s;if(d&&(l=e-l),h&&(u=e-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:d,k1:l,k2neg:h,k2:u}}}}),HE);var k$=32;function R$(r,e,t){let n=wt.digest(e instanceof Uint8Array?e:e.subarray());if(Ym(n))return n.then(({digest:o})=>(t?.signal?.throwIfAborted(),sa.sign(o,r).toDERRawBytes())).catch(o=>{throw o.name==="AbortError"?o:new Ny(String(o))});try{return sa.sign(n.digest,r).toDERRawBytes()}catch(o){throw new Ny(String(o))}}function N$(r,e,t,n){let o=wt.digest(t instanceof Uint8Array?t:t.subarray());if(Ym(o))return o.then(({digest:i})=>(n?.signal?.throwIfAborted(),sa.verify(e,i,r))).catch(i=>{throw i.name==="AbortError"?i:new Oy(String(i))});try{return n?.signal?.throwIfAborted(),sa.verify(e,o.digest,r)}catch(i){throw new Oy(String(i))}}var o2=class{type="secp256k1";raw;_key;constructor(e){this._key=F$(e),this.raw=O$(this._key)}toMultihash(){return wn.digest(En(this))}toCID(){return ce.createV1(114,this.toMultihash())}toString(){return Sr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}verify(e,t,n){return N$(this._key,t,e,n)}},i2=class{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=L$(e),this.publicKey=new o2(t??B$(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Me(this.raw,e.raw)}sign(e,t){return R$(this.raw,e,t)}};function pD(r){return new i2(r)}function hD(r){return new o2(r)}function U$(){return f(this,null,function*(){let r=yhe();return new i2(r)})}function O$(r){return sa.ProjectivePoint.fromHex(r).toRawBytes(!0)}function L$(r){try{return sa.getPublicKey(r,!0),r}catch(e){throw new w9(String(e))}}function F$(r){try{return sa.ProjectivePoint.fromHex(r),r}catch(e){throw new cf(String(e))}}function B$(r){try{return sa.getPublicKey(r,!0)}catch(e){throw new w9(String(e))}}function yhe(){return sa.utils.randomPrivateKey()}function eg(r,e){return f(this,null,function*(){if(r==="Ed25519")return u$();if(r==="secp256k1")return U$();if(r==="RSA")return lD(vhe(e));if(r==="ECDSA")return vH(whe(e));throw new Qc})}function Vr(r,e){let{Type:t,Data:n}=nc.decode(r),o=n??new Uint8Array;switch(t){case ir.RSA:return sD(o,e);case ir.Ed25519:return FA(o);case ir.secp256k1:return hD(o);case ir.ECDSA:return EA(o);default:throw new Qc}}function nx(r){let{Type:e,Data:t}=nc.decode(r.digest),n=t??new Uint8Array;switch(e){case ir.Ed25519:return FA(n);case ir.secp256k1:return hD(n);case ir.ECDSA:return EA(n);default:throw new Qc}}function En(r){return nc.encode({Type:ir[r.type],Data:r.raw})}function V$(r){let e=Jy.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case ir.RSA:return iD(t);case ir.Ed25519:return LA(t);case ir.secp256k1:return pD(t);case ir.ECDSA:return pH(t);default:throw new Qc}}function j$(r){if(r.byteLength===Ri)return LA(r);if(r.byteLength===k$)return pD(r);let e=hs(r),t=e[2]?.[0];if(t===oH||t===iH||t===sH)return bA(e);if(e.length>8)return JE(e);throw new Y("Could not extract private key from raw bytes")}function Mf(r){return Jy.encode({Type:ir[r.type],Data:r.raw})}function vhe(r){return r==null?2048:parseInt(r,10)}function whe(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Y("Unsupported curve, should be P-256, P-384 or P-521")}function ox(r){return f(this,null,function*(){if(r.type==="RSA")return{privateKey:yield crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:yield crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:yield crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:yield crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Y("Only RSA and ECDSA keys are supported")})}function H$(r,e,t,n){bf(r);let o=SH({dkLen:32,asyncTick:10},n),{c:i,dkLen:s,asyncTick:a}=o;if(ea(i),ea(s),ea(a),i<1)throw new Error("iterations (c) should be >= 1");let c=SA(e),l=SA(t),u=new Uint8Array(s),d=Iu.create(r,c),h=d._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:a,DK:u,PRF:d,PRFSalt:h}}function $$(r,e,t,n,o){return r.destroy(),e.destroy(),n&&n.destroy(),ao(o),t}function z$(r,e,t,n){let{c:o,dkLen:i,DK:s,PRF:a,PRFSalt:c}=H$(r,e,t,n),l,u=new Uint8Array(4),d=Ef(u),h=new Uint8Array(a.outputLen);for(let p=1,m=0;m<i;p++,m+=a.outputLen){let y=s.subarray(m,m+a.outputLen);d.setInt32(0,p,!1),(l=c._cloneInto(l)).update(u).digestInto(h),y.set(h.subarray(0,y.length));for(let b=1;b<o;b++){a._cloneInto(l).update(h).digestInto(h);for(let x=0;x<y.length;x++)y[x]^=h[x]}}return $$(a,c,s,l,h)}function ix(r,e,t,n){return f(this,null,function*(){let{c:o,dkLen:i,asyncTick:s,DK:a,PRF:c,PRFSalt:l}=H$(r,e,t,n),u,d=new Uint8Array(4),h=Ef(d),p=new Uint8Array(c.outputLen);for(let m=1,y=0;y<i;m++,y+=c.outputLen){let b=a.subarray(y,y+c.outputLen);h.setInt32(0,m,!1),(u=l._cloneInto(u)).update(d).digestInto(p),b.set(p.subarray(0,b.length)),yield xH(o-1,s,()=>{c._cloneInto(u).update(p).digestInto(p);for(let x=0;x<b.length;x++)b[x]^=p[x]})}return $$(c,l,a,u,p)})}var s2=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Au=new Uint32Array(80),sx=class extends xf{constructor(){super(64,20,8,!1),this.A=s2[0]|0,this.B=s2[1]|0,this.C=s2[2]|0,this.D=s2[3]|0,this.E=s2[4]|0}get(){let{A:e,B:t,C:n,D:o,E:i}=this;return[e,t,n,o,i]}set(e,t,n,o,i){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0}process(e,t){for(let c=0;c<16;c++,t+=4)Au[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)Au[c]=LE(Au[c-3]^Au[c-8]^Au[c-14]^Au[c-16],1);let{A:n,B:o,C:i,D:s,E:a}=this;for(let c=0;c<80;c++){let l,u;c<20?(l=FE(o,i,s),u=1518500249):c<40?(l=o^i^s,u=1859775393):c<60?(l=BE(o,i,s),u=2400959708):(l=o^i^s,u=3395469782);let d=LE(n,5)+l+a+u+Au[c]|0;a=s,s=i,i=LE(o,30),o=n,n=d}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,this.set(n,o,i,s,a)}roundClean(){ao(Au)}destroy(){this.set(0,0,0,0,0),ao(this.buffer)}},q$=Uy(()=>new sx);var K$=q$;var tg=$E;var W$={sha1:K$,"sha2-256":oc,"sha2-512":tg};function a2(r,e,t,n,o){if(o!=="sha1"&&o!=="sha2-256"&&o!=="sha2-512"){let a=Object.keys(W$).join(" / ");throw new Y(`Hash '${o}' is unknown or not supported. Must be ${a}`)}let i=W$[o],s=z$(i,r,e,{c:t,dkLen:n});return Yr.encode(s).substring(1)}var mD={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},G$={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Y$=new globalThis.TextEncoder;function bhe(r,e){let t=mD[e],n=G$[e];for(let o=0;o<r.length;o++)n^=BigInt(r[o]),n=BigInt.asUintN(e,n*t);return n}function Ehe(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");let n=mD[e],o=G$[e],i=r;for(;i.length>0;){let s=Y$.encodeInto(i,t);i=i.slice(s.read);for(let a=0;a<s.written;a++)o^=BigInt(t[a]),o=BigInt.asUintN(e,o*n)}return o}function gD(r,{size:e=32,utf8Buffer:t}={}){if(!mD[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return Ehe(r,e,t);r=Y$.encode(r)}return bhe(r,e)}var c2={hash:r=>Number(gD(r,{size:32})),hashV:(r,e)=>xhe(c2.hash(r,e))};function xhe(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),Z(e,"base16")}var yD=64,aa=class{fp;h;seed;constructor(e,t,n,o=2){if(o>yD)throw new TypeError("Invalid Fingerprint Size");let i=t.hashV(e,n),s=Qe(o);for(let a=0;a<s.length;a++)s[a]=i[a];s.length===0&&(s[0]=7),this.fp=s,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?Me(this.fp,e.fp):!1}};function kf(r,e){return Math.floor(Math.random()*(e-r))+r}var Rf=class{contents;constructor(e){this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof aa))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof aa))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof aa))throw new TypeError("Invalid Fingerprint");let t=kf(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof aa))throw new TypeError("Invalid Fingerprint");let t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}};var She=500,l2=class{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??c2,this.seed=e.seed??kf(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Z(e));let t=new aa(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Rf(this.bucketSize)),this.buckets[o]==null&&(this.buckets[o]=new Rf(this.bucketSize)),this.buckets[n].add(t)||this.buckets[o].add(t))return this.count++,!0;let i=[n,o],s=i[kf(0,i.length-1)];this.buckets[s]==null&&(this.buckets[s]=new Rf(this.bucketSize));for(let a=0;a<She;a++){let c=this.buckets[s].swap(t);if(c!=null&&(s=(s^c.hash())%this.filterSize,this.buckets[s]==null&&(this.buckets[s]=new Rf(this.bucketSize)),this.buckets[s].add(c)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=Z(e));let t=new aa(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=this.buckets[n]?.has(t)??!1;if(o)return o;let i=(n^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){typeof e=="string"&&(e=Z(e));let t=new aa(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,o=this.buckets[n]?.remove(t)??!1;if(o)return this.count--,o;let i=(n^t.hash())%this.filterSize,s=this.buckets[i]?.remove(t)??!1;return s&&this.count--,s}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}},_he={1:.5,2:.84,4:.95,8:.98};function Che(r=.001){return r>.002?2:r>1e-5?4:8}function X$(r,e=.001){let t=Che(e),n=_he[t],o=Math.round(r/n),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),yD);return{filterSize:o,bucketSize:t,fingerprintSize:i}}var rg=class{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??c2,this.seed=e.seed??kf(0,Math.pow(2,10)),this.filterSeries=[new l2({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Z(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){let n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new l2({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Z(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Z(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}};function uo(r,e=.001,t){return new rg(v(v({},X$(r,e)),t??{}))}var Nf=class extends nt{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??1,this.maxProviders=t.maxProviders??5,this.providers=[],this.evictionFilter=uo(this.maxProviders),this.initialProviders=t.providers??[]}retrieve(n){return f(this,arguments,function*(e,t={}){let o=Yr.encode(e.multihash.bytes),i=this.requests.get(o);if(i!=null)return this.log("join existing request for %c",e),i;let s=ze();if(this.requests.set(o,s.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.initialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),yield this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",e)}let a=!1,c=new Rn({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,s.resolve(d.detail.result)}),c.addEventListener("idle",()=>{if(a||t.signal?.aborted===!0){this.log.trace("session idle, found block");return}Promise.resolve().then(()=>f(this,null,function*(){this.log("no session peers had block for for %c, finding new providers",e);for(let d=0;d<this.minProviders&&this.providers.length!==0;d++){let h=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(h)}yield this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(o),s.resolve(yield this.retrieve(e,t))})).catch(d=>{this.log.error("could not find new providers for %c",e,d),s.reject(d)})});let l=d=>{c.add(()=>f(this,null,function*(){return this.queryProvider(e,d.detail,t)}),{provider:d.detail}).catch(h=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(d=>f(this,null,function*(){return c.add(()=>f(this,null,function*(){return this.queryProvider(e,d,t)}),{provider:d})}))).catch(d=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,d)});let u=()=>{s.reject(new Mn(t.signal?.reason??"Session aborted")),c.abort()};t.signal?.addEventListener("abort",u);try{return yield s.promise}finally{this.removeEventListener("provider",l),t.signal?.removeEventListener("abort",u),c.clear(),this.requests.delete(o)}})}evict(e){this.evictionFilter.add(this.toEvictionKey(e));let t=this.providers.findIndex(n=>this.equals(n,e));t!==-1&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(this.providers.find(t=>this.equals(t,e))!=null||this.isEvicted(e))}findProviders(e,t,n){return f(this,null,function*(){let o=ze(),i=0;return Promise.resolve().then(()=>f(this,null,function*(){if(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.initialProviders.length>0)for(;i<t&&this.initialProviders.length>0;){let u=this.initialProviders.pop();if(u==null)break;let d=yield this.convertToProvider(u,n);if(n.signal?.aborted===!0)break;if(d!=null&&!this.hasProvider(d)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(d),this.safeDispatchEvent("provider",{detail:d}),i++,i===t&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(i<this.maxProviders)try{for(var s=O(this.findNewProviders(e,n)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;if(i===this.maxProviders||n.signal?.aborted===!0)break;if(!this.hasProvider(u)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(u),this.safeDispatchEvent("provider",{detail:u}),i++,i===t&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new _j(`Found ${i} of ${t} ${this.name} providers for ${e}`)})).catch(s=>{this.log.error("error searching routing for potential session peers for %c",e,s.errors??s),o.reject(s)}),o.promise})}};var ax=class{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??hu(),this.log=this.logger.forComponent("helia"),this.getHasher=Xj(e.hashers,e.loadHasher),this.getCodec=Yj(e.codecs,e.loadCodec),this.dns=e.dns??U4(),this.metrics=e.metrics;let t=v({blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics},e.components??{});this.routing=t.routing=new lE(t,{routers:(e.routers??[]).flatMap(o=>{let i=[o];return o[Ga]!=null&&i.push(o[Ga]),o[Ya]!=null&&i.push(o[Ya]),i}),providerLookupConcurrency:e.providerLookupConcurrency});let n=new RE(t);this.pins=new aE(e.datastore,n,this.getCodec),this.blockstore=new CE(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(o=>o(t))}start(){return f(this,null,function*(){yield Nj(this.datastore),yield kn(this.blockstore,this.datastore,this.routing)})}stop(){return f(this,null,function*(){yield oo(this.blockstore,this.datastore,this.routing)})}gc(){return f(this,arguments,function*(e={}){let t=yield this.blockstore.lock.writeLock();try{let n=this,o=this.blockstore.unwrap();this.log("gc start"),yield Yo(o.deleteMany(function(){return M(this,null,function*(){try{for(var i=O(o.getAll()),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let{cid:l}=a.value;try{if(yield new S(n.pins.isPinned(l,e)))continue;yield l,e.onProgress?.(new fe("helia:gc:deleted",l))}catch(u){n.log.error("Error during gc",u),e.onProgress?.(new fe("helia:gc:error",u))}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}})}()))}finally{t()}this.log("gc finished")})}};var cx=class r extends ax{libp2p;constructor(e){super(I(v({},e),{components:{libp2p:e.libp2p}})),this.libp2p=e.libp2p}start(){return f(this,null,function*(){yield Ki(r.prototype,this,"start").call(this),yield this.libp2p.start()})}stop(){return f(this,null,function*(){yield Ki(r.prototype,this,"stop").call(this),yield this.libp2p.stop()})}};var lx=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},ng=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},ux=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},u2=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function dx(r){return r[Symbol.asyncIterator]!=null}function Q$(r,e){if(r.byteLength>e)throw new ng("Message length too long")}var px=r=>{let e=_t(r),t=wr(e);return Sn(r,t),px.bytes=e,t};px.bytes=0;function dl(r,e){e=e??{};let t=e.lengthEncoder??px,n=e?.maxDataLength??4194304;function*o(i){Q$(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*Q(s),i instanceof Uint8Array?yield i:yield*Q(i)}return dx(r)?function(){return M(this,null,function*(){try{for(var i=O(r),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let l=a.value;yield*Q(o(l))}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}})}():function*(){for(let i of r)yield*Q(o(i))}()}dl.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??px,n=e?.maxDataLength??4194304;return Q$(r,n),new Ve(t(r.byteLength),r)};var og=function(r){return r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA",r}(og||{}),vD=r=>{let e=oa(r);return vD.bytes=_t(e),e};vD.bytes=0;function fl(r,e){let t=new Ve,n=og.LENGTH,o=-1,i=e?.lengthDecoder??vD,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===og.LENGTH)try{if(o=i(t),o<0)throw new lx("Invalid message length");if(o>a)throw new ng("Message length too long");let l=i.bytes;t.consume(l),e?.onLength!=null&&e.onLength(o),n=og.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>s)throw new ux("Message length length too long");break}throw l}if(n===og.DATA){if(t.byteLength<o)break;let l=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(l),yield l,n=og.LENGTH}}}return dx(r)?function(){return M(this,null,function*(){try{for(var l=O(r),u,d,h;u=!(d=yield new S(l.next())).done;u=!1){let p=d.value;t.append(p),yield*Q(c())}}catch{h=[d]}finally{try{u&&(d=l.return)&&(yield new S(d.call(l)))}finally{if(h)throw h[0]}}if(t.byteLength>0)throw new u2("Unexpected end of input")})}():function*(){for(let l of r)t.append(l),yield*Q(c());if(t.byteLength>0)throw new u2("Unexpected end of input")}()}fl.fromReader=(r,e)=>{let t=1,n=function(){return M(this,null,function*(){for(;;)try{let{done:i,value:s}=yield new S(r.next(t));if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}})}(),o=i=>{t=i};return fl(n,I(v({},e??{}),{onLength:o}))};function The(r){return r[Symbol.asyncIterator]!=null}function Phe(r,e){let t=0;if(The(r))return function(){return M(this,null,function*(){try{for(var c=O(r),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let h=u.value;yield e(h,t++)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}})}();let n=Nm(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=e(o,t++);if(typeof s.then=="function")return function(){return M(this,null,function*(){yield yield new S(s);for(let c of n)yield e(c,t++)})}();let a=e;return function*(){yield s;for(let c of n)yield a(c,t++)}()}var _n=Phe;function lr(r,...e){if(r==null)throw new Error("Empty pipeline");if(wD(r)){let n=r;r=()=>n.source}else if(ez(r)||J$(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&wD(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)wD(t[n])&&(t[n]=khe(t[n]));return Mhe(...t)}var Mhe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},J$=r=>r?.[Symbol.asyncIterator]!=null,ez=r=>r?.[Symbol.iterator]!=null,wD=r=>r==null?!1:r.sink!=null&&r.source!=null,khe=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=Xr({objectMode:!0});t.then(()=>{n.end()},s=>{n.end(s)});let o,i=r.source;if(J$(i))o=function(){return M(this,null,function*(){yield*Q(i),n.end()})};else if(ez(i))o=function*(){yield*Q(i),n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Mo(n,o())}return r.source};function Rhe(r){return r[Symbol.asyncIterator]!=null}function Nhe(r,e){return Rhe(r)?function(){return M(this,null,function*(){let t=0;if(!(e<1))try{for(var n=O(r),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;if(yield a,t++,t===e)return}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}():function*(){let t=0;if(!(e<1)){for(let n of r)if(yield n,t++,t===e)return}}()}var Du=Nhe;var d2="/ipfs/bitswap/1.2.0";var Zr=function(r){return r.WantBlock="WantBlock",r.WantHave="WantHave",r}(Zr||{}),tz=function(r){return r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave",r}(tz||{});(function(r){r.codec=()=>er(tz)})(Zr||(Zr={}));var ig;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),Zr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={cid:Qe(0),priority:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.priority=t.int32();break}case 3:{i.cancel=t.bool();break}case 4:{i.wantType=Zr.codec().decode(t);break}case 5:{i.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(ig||(ig={}));var hx;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(let i of t.entries)n.uint32(10),ig.codec().encode(i,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={entries:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.entries!=null&&i.entries.length===o.limits.entries)throw new qt('Decode error - map field "entries" had too many elements');i.entries.push(ig.codec().decode(t,t.uint32(),{limits:o.limits?.entries$}));break}case 2:{i.full=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(hx||(hx={}));var sg;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={prefix:Qe(0),data:Qe(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.prefix=t.bytes();break}case 2:{i.data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(sg||(sg={}));var ca=function(r){return r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock",r}(ca||{}),bD=function(r){return r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock",r}(bD||{});(function(r){r.codec=()=>er(bD)})(ca||(ca={}));var ag;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&bD[t.type]!==0&&(n.uint32(16),ca.codec().encode(t.type,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={cid:Qe(0),type:ca.HaveBlock},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.type=ca.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(ag||(ag={}));var Of;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),hx.codec().encode(t.wantlist,n)),t.blocks!=null)for(let i of t.blocks)n.uint32(26),sg.codec().encode(i,n);if(t.blockPresences!=null)for(let i of t.blockPresences)n.uint32(34),ag.codec().encode(i,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={blocks:[],blockPresences:[],pendingBytes:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.wantlist=hx.codec().decode(t,t.uint32(),{limits:o.limits?.wantlist});break}case 3:{if(o.limits?.blocks!=null&&i.blocks.length===o.limits.blocks)throw new qt('Decode error - map field "blocks" had too many elements');i.blocks.push(sg.codec().decode(t,t.uint32(),{limits:o.limits?.blocks$}));break}case 4:{if(o.limits?.blockPresences!=null&&i.blockPresences.length===o.limits.blockPresences)throw new qt('Decode error - map field "blockPresences" had too many elements');i.blockPresences.push(ag.codec().decode(t,t.uint32(),{limits:o.limits?.blockPresences$}));break}case 5:{i.pendingBytes=t.int32();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(Of||(Of={}));function rz(r,e){for(let[t,n]of e.wantlist.entries()){let o=r.wantlist.get(t);o!=null&&(o.priority>n.priority&&(n.priority=o.priority),n.cancel=n.cancel??o.cancel,n.wantType=n.wantType??o.wantType,n.sendDontHave=n.sendDontHave??o.sendDontHave),r.wantlist.set(t,n)}for(let[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(let[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}var nz=(()=>{class r extends Error{static name="BlockTooLargeError";constructor(t="Block too large"){super(t),this.name="BlockTooLargeError"}}return r})();var Ohe=4193648,Lhe=Ohe+16;function*oz(r,e){let t=[...r.wantlist.values()],n=[...r.blockPresences.values()],o=[...r.blocks.values()],i=0,s=0,a=0,c=!1;for(;;){let l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0},u=Of.encode(l).byteLength,{added:d,hasMore:h,newSize:p}=ED(o,l.blocks,a,e,u,Fhe);a+=d,u=p;let m=h;({added:d,hasMore:h,newSize:p}=ED(n,l.blockPresences,s,e,u,Bhe)),s+=d,u=p;let y=h;if({added:d,hasMore:h,newSize:p}=ED(t,l.wantlist.entries,i,e,u,Uhe),i+=d,u=p,c=!m&&!y&&!h,c||(l.wantlist.full=!1),yield Of.encode(l),c)break}}function ED(r,e,t,n,o,i){let s=0,a=!1;for(let c=t;c<r.length;c++){let l=r[c],u=i(l);if(u>Lhe)throw new nz("Cannot send block as after encoding it is over the max message size");let d=o+u;if(d>n){a=!0;break}e.push(l),s++,o=d}return{hasMore:a,added:s,newSize:o}}function Fhe(r){return xD(3,sg.encode(r))}function Bhe(r){return xD(4,ag.encode(r))}function Uhe(r){return xD(1,ig.encode(r))}function xD(r,e){let t=_t(r),n=_t(e.byteLength);return t+n+e.byteLength}var mx=class extends nt{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(e,t={}){super(),this.log=e.logger.forComponent("helia:bitswap:network"),this.libp2p=e.libp2p,this.routing=e.routing,this.protocols=t.protocols??[d2],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=t.maxInboundStreams??1024,this.maxOutboundStreams=t.maxOutboundStreams??1024,this.messageReceiveTimeout=t.messageReceiveTimeout??5e3,this.runOnLimitedConnections=t.runOnLimitedConnections??!1,this.maxIncomingMessageSize=t.maxIncomingMessageSize??4194304,this.maxOutgoingMessageSize=t.maxOutgoingMessageSize??t.maxIncomingMessageSize??4194304,this.metrics={blocksSent:e.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:e.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new On({concurrency:t.messageSendConcurrency??50,metrics:e.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",n=>{this.log.error("error sending wantlist to peer",n.detail)})}start(){return f(this,null,function*(){if(this.running)return;this.running=!0,yield this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});let e={onConnect:t=>{this.safeDispatchEvent("peer:connected",{detail:t})},onDisconnect:t=>{this.safeDispatchEvent("peer:disconnected",{detail:t})}};this.registrarIds=[];for(let t of this.protocols)this.registrarIds.push(yield this.libp2p.register(t,e));this.libp2p.getConnections().forEach(t=>{this.safeDispatchEvent("peer:connected",{detail:t.remotePeer})})})}stop(){return f(this,null,function*(){if(this.running=!1,yield this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(let e of this.registrarIds)this.libp2p.unregister(e);this.registrarIds=[]}})}_onStream(e){if(!this.running)return;let{stream:t,connection:n}=e;Promise.resolve().then(()=>f(this,null,function*(){this.log("incoming new bitswap %s stream from %p",t.protocol,n.remotePeer);let o=()=>{t.status==="open"?t.abort(new Xa(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",t.status)},i=AbortSignal.timeout(this.messageReceiveTimeout);i.addEventListener("abort",o),yield t.closeWrite(),yield lr(t,s=>fl(s,{maxDataLength:this.maxIncomingMessageSize}),s=>f(this,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield a.next()).done;c=!1){let d=l.value;try{let h=Of.decode(d);this.log("incoming new bitswap %s message from %p on stream",t.protocol,n.remotePeer,t.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:n.remotePeer,message:h}}),i.removeEventListener("abort",o),i=AbortSignal.timeout(this.messageReceiveTimeout),i.addEventListener("abort",o)}catch(h){this.log.error("error reading incoming bitswap message from %p on stream",n.remotePeer,t.id,h),t.abort(h);break}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}}))})).catch(o=>{this.log.error("error handling incoming stream from %p",n.remotePeer,o),t.abort(o)})}findProviders(e,t){return M(this,null,function*(){t?.onProgress?.(new fe("bitswap:network:find-providers",e));try{for(var n=O(this.routing.findProviders(e,t)),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;(yield new S(this.libp2p.isDialable(a.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})))&&(yield a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}findAndConnect(e,t){return f(this,null,function*(){t?.providers!=null&&(yield Promise.all(t.providers.map(n=>f(this,null,function*(){return this.connectTo(n).catch(o=>{this.log.error("could not connect to supplied provider - %e",o)})})))),yield Yo(_n(Du(this.findProviders(e,t),t?.maxProviders??3),n=>f(this,null,function*(){return this.connectTo(n.id,t)}))).catch(n=>{this.log.error(n)})})}sendMessage(e,t,n){return f(this,null,function*(){if(!this.running)throw new Error("network isn't running");let o=this.sendQueue.queue.find(i=>e.equals(i.options.peerId)&&i.status==="queued");if(o!=null){o.options.message=rz(o.options.message,t),yield o.join({signal:n?.signal});return}yield this.sendQueue.add(i=>f(this,null,function*(){let s=i?.message;if(s==null)throw new Y("No message to send");this.log("sendMessage to %p",e),i?.onProgress?.(new fe("bitswap:network:send-wantlist",e));let a=yield this.libp2p.dialProtocol(e,d2,i);yield a.closeRead();try{yield lr(oz(s,this.maxOutgoingMessageSize),c=>dl(c),a),yield a.close(i)}catch(c){i?.onProgress?.(new fe("bitswap:network:send-wantlist:error",{peer:e,error:c})),this.log.error("error sending message to %p",e,c),a.abort(c)}this._updateSentStats(s.blocks)}),{peerId:e,signal:n?.signal,message:t})})}connectTo(e,t){return f(this,null,function*(){if(!this.running)throw new Gs("Network isn't running");t?.onProgress?.(new fe("bitswap:network:dial",e));let[n]=yield Promise.all([this.libp2p.dial(e,t),Pr(this.libp2p,"peer:identify",t?.signal,{filter:o=>{if(!o.detail.peerId.equals(e))return!1;if(o.detail.protocols.includes(d2))return!0;throw new lf(`${e} did not support ${d2}`)}})]);return n})}_updateSentStats(e){let t=0;for(let n of e.values())t+=n.data.byteLength;this.metrics.dataSent?.increment(t),this.metrics.blocksSent?.increment(e.size)}};var iz=Symbol.for("nodejs.util.inspect.custom"),Ghe=114,f2=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[S4]=!0;toString(){return this.string==null&&(this.string=Sr.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return ce.createV1(Ghe,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Me(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Me(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[iz](){return`PeerId(${this.toString()})`}},p2=class extends f2{type="RSA";publicKey;constructor(e){super(I(v({},e),{type:"RSA"})),this.publicKey=e.publicKey}},h2=class extends f2{type="Ed25519";publicKey;constructor(e){super(I(v({},e),{type:"Ed25519"})),this.publicKey=e.publicKey}},m2=class extends f2{type="secp256k1";publicKey;constructor(e){super(I(v({},e),{type:"secp256k1"})),this.publicKey=e.publicKey}},Yhe=2336,g2=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=wn.digest(Z(this.url))}[iz](){return`PeerId(${this.url})`}[S4]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return ce.createV1(Yhe,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=te(e)),e.toString()===this.toString())}};var Xhe=114,sz=2336;function sr(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=Nt(Sr.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return la(ce.parse(r));if(e==null)throw new Y('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=Nt(e.decode(r))}return Jr(t)}function ic(r){if(r.type==="Ed25519")return new h2({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new m2({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new p2({multihash:r.toCID().multihash,publicKey:r});throw new Qc}function az(r){return ic(r.publicKey)}function Jr(r){if(Zhe(r))return new p2({multihash:r});if(Qhe(r))try{let e=nx(r);if(e.type==="Ed25519")return new h2({multihash:r,publicKey:e});if(e.type==="secp256k1")return new m2({multihash:r,publicKey:e})}catch{let t=te(r.digest);return new g2(new URL(t))}throw new Em("Supplied PeerID Multihash is invalid")}function la(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==Xhe&&r.code!==sz)throw new GU("Supplied PeerID CID is invalid");if(r.code===sz){let e=te(r.multihash.digest);return new g2(new URL(e))}return Jr(r.multihash)}function Qhe(r){return r.code===wn.code}function Zhe(r){return r.code===wt.code}function Lf(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),o=n.value;return n.done===!0||o==null?{done:!0,value:void 0}:{done:!1,value:e(o)}}};return t}function gx(r){let e=Nt(Sr.decode(`z${r}`));return Jr(e)}var fo=class{map;constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Lf(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return Lf(this.map.values(),e=>e.key)}values(){return Lf(this.map.values(),e=>e.value)}get size(){return this.map.size}};var Oi=class r{set;constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Lf(this.set.entries(),e=>{let t=gx(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=gx(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return Lf(this.set.values(),e=>gx(e))}intersection(e){let t=new r;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new r;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new r;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};function SD(){return new Oi}var yx=class{filter;constructor(e,t){this.filter=uo(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}};function _D(r,e=.001){return new yx(r,e)}var CD=class extends fo{metric;constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function pl(r){let{name:e,metrics:t}=r,n;return t!=null?n=new CD({name:e,metrics:t}):n=new fo,n}var hl=class{full;pendingBytes;wantlist;blocks;blockPresences;constructor(e=!1,t=0){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){let n=Yr.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){let n=Yr.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){let n=Yr.encode(e.multihash.bytes);this.blocks.set(n,t)}};function Jhe(r){let e=new Uint8Array(r.reduce((n,o)=>n+_t(o),0)),t=0;for(let n of r)e=Sn(n,e,t),t+=_t(n);return e}var cz=Jhe;function ID(r){return cz([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}var vx=class{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(e,t){this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??1024}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}sendBlocksToPeer(e){return f(this,null,function*(){let t=new hl,n=new Set;for(let[o,i]of this.wants.entries())try{let s=yield this.blockstore.get(i.cid,e);i.wantType===Zr.WantHave?s.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),n.add(o),t.addBlock(i.cid,{data:s,prefix:ID(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ca.HaveBlock})):(this.log("sending block for %c",i.cid),n.add(o),t.addBlock(i.cid,{data:s,prefix:ID(i.cid)}))}catch(s){if(s.name!=="NotFoundError")throw s;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||i.sentDoNotHave===!0)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ca.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),yield this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((o,i)=>o+i.data.byteLength,0));for(let o of n)this.wants.delete(o)}})}};var wx=class{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(e,t={}){this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=pl({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(o=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,o)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){let t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){let t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}receiveMessage(e,t){return f(this,null,function*(){let n=this.ledgerMap.get(e);if(n==null&&(n=new vx({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(t.blocks?.reduce((o,i)=>o+i.data.byteLength,0)??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(let o of t.wantlist.entries){let i=ce.decode(o.cid),s=te(i.multihash.bytes,"base64");o.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,i),n.wants.delete(s)):(o.wantType===Zr.WantHave?this.log("peer %p wanted block presence for %c",e,i):this.log("peer %p wanted block for %c",e,i),n.wants.set(s,{cid:i,priority:o.priority,wantType:o.wantType??Zr.WantBlock,sendDontHave:o.sendDontHave??!1}))}}this.log("send blocks to peer"),yield n.sendBlocksToPeer()})}receivedBlock(e,t){return f(this,null,function*(){let n=te(e.multihash.bytes,"base64"),o=[];for(let i of this.ledgerMap.values())i.wants.has(n)&&o.push(i);yield Promise.all(o.map(i=>f(this,null,function*(){return i.sendBlocksToPeer(t)})))})}peerDisconnected(e){this.ledgerMap.delete(e)}};var AD=class extends Nf{wantList;network;libp2p;constructor(e,t){super(e,I(v({},t),{name:"helia:bitswap:session"})),this.wantList=e.wantList,this.network=e.network,this.libp2p=e.libp2p}queryProvider(e,t,n){return f(this,null,function*(){this.log("sending WANT-BLOCK for %c to %p",e,t);let o=yield this.wantList.wantSessionBlock(e,t,n);if(this.log("%p %s %c",t,o.has?"has":"does not have",e),o.has&&o.block!=null)return o.block;throw new Error("Provider did not have block")})}findNewProviders(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(this.network.findProviders(e,t)),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;yield c.id}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}toEvictionKey(e){return e.toMultihash().bytes}equals(e,t){return e.equals(t)}convertToProvider(e,t){return f(this,null,function*(){return us(e)?e:(yield this.libp2p.dial(e,t)).remotePeer})}};function lz(r,e){return new AD(r,e)}var bx=class{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(e){this.blocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=e.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.blocksReceived?.increment(n)}updateDuplicateBlocksReceived(e=1,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateBlocksReceived?.increment(n)}updateDataReceived(e,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.dataReceived?.increment(n)}updateDuplicateDataReceived(e,t){let n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateDataReceived?.increment(n)}};var DD=class extends Map{metric;constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function en(r){let{name:e,metrics:t}=r,n;return t!=null?n=new DD({name:e,metrics:t}):n=new Map,n}function eme(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=oa(r);e.push(t),r=r.slice(_t(t))}return e}var uz=eme;var Ex=class extends nt{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(e,t={}){super(),this.peers=pl({name:"helia_bitswap_peers",metrics:e.metrics}),this.wants=en({name:"helia_bitswap_wantlist",metrics:e.metrics}),this.network=e.network,this.sendMessagesDelay=t.sendMessagesDelay??10,this.log=e.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=t.hashLoader,this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(o=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,o)})}),this.network.addEventListener("peer:connected",n=>{this.peerConnected(n.detail).catch(o=>{this.log.error("error processing newly connected bitswap peer %p",n.detail,o)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}addEntry(e,t){return f(this,null,function*(){let n=te(e.multihash.bytes,"base64"),o=this.wants.get(n);o==null&&(o={cid:e,priority:t.priority??1,wantType:t.wantType??Zr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(n,o)),o.wantType===Zr.WantHave&&t.wantType===Zr.WantBlock&&(o.wantType=Zr.WantBlock),yield this.sendMessagesDebounced();try{return t.wantType===Zr.WantBlock?(yield Pr(this,"block",t?.signal,{filter:a=>Me(e.multihash.digest,a.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(yield Pr(this,"presence",t?.signal,{filter:s=>Me(e.multihash.digest,s.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{t.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",e),o.cancel=!0,yield this.sendMessagesDebounced())}})}sendMessagesDebounced(){return f(this,null,function*(){yield this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(e=>{this.log("error sending messages to peers",e)})},this.sendMessagesDelay)})}sendMessages(){return f(this,null,function*(){this.sendingMessages=ze(),yield Promise.all([...this.peers.entries()].map(n=>f(this,[n],function*([e,t]){let o=new Set,i=new hl;for(let[s,a]of this.wants.entries())t.has(s)||a.cancel||(o.add(s),i.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(i.wantlist.size!==0)try{yield this.network.sendMessage(e,i);for(let s of o)t.add(s)}catch(s){this.log.error("error sending full wantlist to new peer",s)}}))).catch(e=>{this.log.error("error sending messages",e)});for(let[e,t]of this.wants)if(t.cancel){this.wants.delete(e);for(let n of this.peers.values())n.delete(e)}this.sendingMessages.resolve()})}has(e){let t=te(e.multihash.bytes,"base64");return this.wants.has(t)}wantSessionPresence(o,i){return f(this,arguments,function*(e,t,n={}){let s=new hl;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:Zr.WantHave,priority:1}),yield this.network.sendMessage(t,s),(yield Pr(this,"presence",n.signal,{filter:c=>t.equals(c.detail.sender)&&Me(e.multihash.digest,c.detail.cid.multihash.digest)})).detail})}wantBlock(n){return f(this,arguments,function*(e,t={}){return this.addEntry(e,I(v({},t),{wantType:Zr.WantBlock}))})}wantSessionBlock(o,i){return f(this,arguments,function*(e,t,n={}){let s=new hl;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:Zr.WantBlock,priority:1}),yield this.network.sendMessage(t,s),(yield Pr(this,"presence",n.signal,{filter:c=>t.equals(c.detail.sender)&&Me(e.multihash.digest,c.detail.cid.multihash.digest)})).detail})}receivedBlock(e,t){return f(this,null,function*(){let n=te(e.multihash.bytes,"base64"),o=this.wants.get(n);o!=null&&(o.cancel=!0,yield this.sendMessagesDebounced())})}receiveMessage(e,t){return f(this,null,function*(){this.log("received message from %p with %d blocks",e,t.blocks.length);let n=!1;for(let o of t.blocks){if(o.prefix==null||o.data==null)continue;let i=uz(o.prefix),s=i[0],a=i[1],c=i[2],l=c===wt.code?wt:yield this.hashLoader?.getHasher(c);if(l==null){this.log.error("unknown hash algorithm",c);continue}let u=l.digest(o.data);u.then!=null&&(u=yield u);let d=ce.create(s===0?0:1,a,u);this.log("received block from %p for %c",e,d),this.safeDispatchEvent("block",{detail:{sender:e,cid:d,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:e,cid:d,has:!0,block:o.data}});let h=te(d.multihash.bytes,"base64"),p=this.wants.get(h);p!=null&&(p.cancel=!0,n=!0)}for(let{cid:o,type:i}of t.blockPresences){let s=ce.decode(o);this.log("received %s from %p for %c",i,e,s),this.safeDispatchEvent("presence",{detail:{sender:e,cid:s,has:i===ca.HaveBlock}})}n&&(yield this.sendMessagesDebounced())})}peerConnected(e){return f(this,null,function*(){let t=new Set,n=new hl(!0);for(let[o,i]of this.wants.entries())i.cancel||(t.add(o),n.addWantlistEntry(i.cid,{cid:i.cid.bytes,priority:1,wantType:Zr.WantBlock,cancel:!1,sendDontHave:!1}));if(n.wantlist.size===0){this.peers.set(e,t);return}try{yield this.network.sendMessage(e,n),this.peers.set(e,t)}catch(o){this.log.error("error sending full wantlist to new peer %p",e,o)}})}peerDisconnected(e){this.peers.delete(e)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}};var xx=class{log;logger;stats;network;blockstore;peerWantLists;wantList;libp2p;constructor(e,t={}){this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.libp2p=e.libp2p,this.stats=new bx(e),this.network=new mx(e,t),this.peerWantLists=new wx(I(v({},e),{network:this.network}),t),this.wantList=new Ex(I(v({},e),{network:this.network}),t)}createSession(e={}){return lz({wantList:this.wantList,network:this.network,logger:this.logger,libp2p:this.libp2p},e)}want(n){return f(this,arguments,function*(e,t={}){let o=new AbortController,i=Ze([o.signal,t.signal]);o.signal,this.network.findAndConnect(e,I(v({},t),{signal:i})).catch(s=>{o.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(yield this.wantList.wantBlock(e,I(v({},t),{signal:i}))).block}finally{o.abort(),i.clear()}})}notify(o,i){return f(this,arguments,function*(e,t,n={}){yield Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])})}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}start(){return f(this,null,function*(){this.wantList.start(),yield this.network.start()})}stop(){return f(this,null,function*(){this.wantList.stop(),yield this.network.stop()})}};var dz=(r,e={})=>new xx(r,e);var TD=class{bitswap;started;constructor(e,t={}){let{getHasher:n}=e;this.bitswap=dz(e,v({hashLoader:{getHasher:o=>f(this,null,function*(){return n(o)})}},t)),this.started=!1}isStarted(){return this.started}start(){return f(this,null,function*(){yield this.bitswap.start(),this.started=!0})}stop(){return f(this,null,function*(){yield this.bitswap.stop(),this.started=!1})}announce(e,t,n){return f(this,null,function*(){yield this.bitswap.notify(e,t,n)})}retrieve(n){return f(this,arguments,function*(e,t={}){return this.bitswap.want(e,t)})}createSession(e){let t=this.bitswap.createSession(e);return{announce:(n,o,i)=>f(this,null,function*(){yield this.bitswap.notify(n,o,i)}),retrieve:(n,o)=>f(this,null,function*(){return t.retrieve(n,o)})}}};function PD(r={}){return e=>new TD(e,r)}var Lo=(()=>{class r extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}return r})(),Ff=(()=>{class r extends Error{static name="ValidationError";name="ValidationError"}return r})(),MD=(()=>{class r extends Error{static name="InvalidParametersError";name="InvalidParametersError"}return r})(),fz=(()=>{class r extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}return r})();var Sx=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*o)-1;for(;;){let u=this.readAtomically(()=>{let d=this.readChar();if(d===void 0)return;let h=Number.parseInt(d,e);if(!Number.isNaN(h))return h});if(u===void 0)break;if(i*=e,i+=u,i>l||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let o=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[o]=s[0],t[o+1]=s[1],t[o+2]=s[2],t[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];t[o]=i>>8,t[o+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=e(i.subarray(0,s));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var pz=45,tme=15,cg=new Sx;function _x(r){if(!(r.length>tme))return cg.new(r).parseWith(()=>cg.readIPv4Addr())}function Cx(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>pz))return cg.new(r).parseWith(()=>cg.readIPv6Addr())}function lg(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>pz)return;let t=cg.new(r).parseWith(()=>cg.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Li(r){return!!_x(r)}function ug(r){return!!Cx(r)}function RD(r){return e=>te(e,r)}function ND(r){return e=>Z(e,r)}function dg(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function Bf(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function hz(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=Z(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Bf(n);return zt([t,o],t.length+o.length)}function mz(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=Gi.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Bf(n);return zt([t,o],t.length+o.length)}function OD(r){let e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=te(e,"base32"),o=dg(t);return`${n}:${o}`}var LD=function(r){r=r.toString().trim();let e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{let o=parseInt(t,10);if(isNaN(o)||o<0||o>255)throw new Lo("Invalid byte value in IP address");e[n]=o}),e},gz=function(r){let e=0;r=r.toString().trim();let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=Li(t[n]),s;i&&(s=LD(t[n]),t[n]=te(s.subarray(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,te(s.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");let i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new Lo("Invalid byte value in IP address");o[e++]=i>>8&255,o[e++]=i&255}return o},yz=function(r){if(r.byteLength!==4)throw new Lo("IPv4 address was incorrect length");let e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},vz=function(r){if(r.byteLength!==16)throw new Lo("IPv6 address was incorrect length");let e=[];for(let n=0;n<r.byteLength;n+=2){let o=r[n],i=r[n+1],s=`${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(s)}let t=e.join(":");try{let n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new Lo(`Invalid IPv6 address "${t}"`)}};function wz(r){try{let e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Lo(`Invalid IPv6 address "${r}"`)}}var kD=Object.values(ff).map(r=>r.decoder),rme=function(){let r=kD[0].or(kD[1]);return kD.slice(2).forEach(e=>r=r.or(e)),r}();function bz(r){return rme.decode(r)}function Ez(r){return e=>r.encoder.encode(e)}function nme(r){if(parseInt(r).toString()!==r)throw new Ff("Value must be an integer")}function ome(r){if(r<0)throw new Ff("Value must be a positive integer, or zero")}function ime(r){return e=>{if(e>r)throw new Ff(`Value must be smaller than or equal to ${r}`)}}function sme(...r){return e=>{for(let t of r)t(e)}}var y2=sme(nme,ome,ime(65535));var Cn=-1,FD=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new fz(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){let t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},Qo=new FD,Ome=[{code:4,name:"ip4",size:32,valueToBytes:LD,bytesToValue:yz,validate:r=>{if(!Li(r))throw new Ff(`Invalid IPv4 address "${r}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Bf,bytesToValue:dg,validate:y2},{code:273,name:"udp",size:16,valueToBytes:Bf,bytesToValue:dg,validate:y2},{code:33,name:"dccp",size:16,valueToBytes:Bf,bytesToValue:dg,validate:y2},{code:41,name:"ip6",size:128,valueToBytes:gz,bytesToValue:vz,stringToValue:wz,validate:r=>{if(!ug(r))throw new Ff(`Invalid IPv6 address "${r}"`)}},{code:42,name:"ip6zone",size:Cn},{code:43,name:"ipcidr",size:8,bytesToValue:RD("base10"),valueToBytes:ND("base10")},{code:53,name:"dns",size:Cn,resolvable:!0},{code:54,name:"dns4",size:Cn,resolvable:!0},{code:55,name:"dns6",size:Cn,resolvable:!0},{code:56,name:"dnsaddr",size:Cn,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:Bf,bytesToValue:dg,validate:y2},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:Cn,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:421,name:"p2p",aliases:["ipfs"],size:Cn,bytesToValue:RD("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?ND("base58btc")(r):ce.parse(r).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:OD,valueToBytes:hz},{code:445,name:"onion3",size:296,bytesToValue:OD,valueToBytes:mz},{code:446,name:"garlic64",size:Cn},{code:447,name:"garlic32",size:Cn},{code:448,name:"tls"},{code:449,name:"sni",size:Cn},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:Cn,bytesToValue:Ez(Zc),valueToBytes:bz},{code:480,name:"http"},{code:481,name:"http-path",size:Cn,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:Cn}];Ome.forEach(r=>{Qo.addProtocol(r)});function xz(r){let e=[],t=0;for(;t<r.length;){let n=oa(r,t),o=Qo.getProtocol(n),i=_t(n),s=Lme(o,r,t+i),a=0;s>0&&o.size===Cn&&(a=_t(s));let c=i+a+s,l={code:n,name:o.name,bytes:r.subarray(t,t+c)};if(s>0){let u=t+i+a,d=r.subarray(u,u+s);l.value=o.bytesToValue?.(d)??te(d)}e.push(l),t+=c}return e}function Sz(r){let e=0,t=[];for(let n of r){if(n.bytes==null){let o=Qo.getProtocol(n.code),i=_t(n.code),s,a=0,c=0;n.value!=null&&(s=o.valueToBytes?.(n.value)??Z(n.value),a=s.byteLength,o.size===Cn&&(c=_t(a)));let l=new Uint8Array(i+c+a),u=0;Zm(n.code,l,u),u+=i,s!=null&&(o.size===Cn&&(Zm(a,l,u),u+=c),l.set(s,u)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return zt(t,e)}function _z(r){if(r.charAt(0)!=="/")throw new Lo('String multiaddr must start with "/"');let e=[],t="protocol",n="",o="";for(let i=1;i<r.length;i++){let s=r.charAt(i);s!=="/"&&(t==="protocol"?o+=r.charAt(i):n+=r.charAt(i));let a=i===r.length-1;if(s==="/"||a){let c=Qo.getProtocol(o);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",o="",t="protocol";continue}else if(a)throw new Lo(`Component ${o} was missing value`);t="value"}else if(t==="value"){let l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new Lo(`Component ${o} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",o="",t="protocol"}}}if(o!==""&&n!=="")throw new Lo("Incomplete multiaddr");return e}function Cz(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;let t=Qo.getProtocol(e.code);if(t==null)throw new Lo(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function Lme(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:oa(e,t)}var Fme=Symbol.for("nodejs.util.inspect.custom"),HD=Symbol.for("@multiformats/multiaddr"),Bme=[53,54,55,56],jD=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}};function Ume(r){if(r==null&&(r="/"),Pu(r))return r.getComponents();if(r instanceof Uint8Array)return xz(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),_z(r);if(Array.isArray(r))return r;throw new Lo("Must be a string, Uint8Array, Component[], or another Multiaddr")}var Ax=class r{[HD]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=Ume(e),t.validate!==!1&&Vme(this)}get bytes(){return this.#r==null&&(this.#r=Sz(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=Cz(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let e,t,n,o,i="";for(let{code:a,name:c,value:l}of this.#e)a===42&&(i=`%${l??""}`),Bme.includes(a)&&(t="tcp",o=443,n=`${l??""}${i}`,e=a===55?6:4),(a===6||a===273)&&(t=c==="tcp"?"tcp":"udp",o=parseInt(l??"")),(a===4||a===41)&&(t="tcp",n=`${l??""}${i}`,e=a===41?6:4);if(e==null||t==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:o}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:e,value:t})=>{let n=Qo.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#e.map(({code:e})=>e)}protoNames(){return this.#e.map(({name:e})=>e)}tuples(){return this.#e.map(({code:e,value:t})=>{if(t==null)return[e];let n=Qo.getProtocol(e),o=[e];return t!=null&&o.push(n.valueToBytes?.(t)??Z(t)),o})}stringTuples(){return this.#e.map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){let t=new r(e);return new r([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new MD(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new r(n.slice(0,o),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new r(this.#e.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#e.forEach(({code:n,value:o})=>{n===421&&e.push([n,o]),n===290&&(e=[])});let t=e.pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?te(Sr.decode(`z${n}`),"base58btc"):te(ce.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let e of this.#e)if(Qo.getProtocol(e.code).path)return e.value??null;return null}equals(e){return Me(this.bytes,e.bytes)}resolve(e){return f(this,null,function*(){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=Iz.get(t.name);if(n==null)throw new jD(`no available resolver for ${t.name}`);return(yield n(this,e)).map(i=>we(i))})}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==4&&this.#e[0].code!==41||this.#e[1].code!==6&&this.#e[1].code!==273)}[Fme](){return`Multiaddr(${this.toString()})`}};function Vme(r){r.getComponents().forEach(e=>{let t=Qo.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function Az(r,e,t){let n=0;for(let o of r)if(!(n<e)){if(n>t)break;if(o!==255)return!1;n++}return!0}function Dz(r,e,t,n){let o=0;for(let i of r)if(!(o<t)){if(o>n)break;if(i!==e[o])return!1;o++}return!0}function $D(r){switch(r.length){case Hf:return r.join(".");case $f:{let e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Tz(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;(n&128)!=0;)e++,n=n<<1;if((n&128)!=0)return-1;for(let o=t+1;o<r.length;o++)if(r[o]!=0)return-1;break}return e}function Pz(r){let e="0x";for(let t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}var Hf=4,$f=16,RGe=parseInt("0xFFFF",16),jme=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function v2(r,e){e.length===$f&&r.length===Hf&&Az(e,0,11)&&(e=e.slice(12)),e.length===Hf&&r.length===$f&&Dz(r,jme,0,11)&&(r=r.slice(12));let t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");let n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=r[o]&e[o];return n}function Mz(r,e){if(typeof e=="string"&&(e=lg(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function zD(r){let[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=Hf,o=_x(e);if(o==null&&(n=$f,o=Cx(e),o==null))throw new Error("Failed to parse given CIDR: "+r);let i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n*8)throw new Error("Failed to parse given CIDR: "+r);let s=qD(i,8*n);return{network:v2(o,s),mask:s}}function qD(r,e){if(e!==8*Hf&&e!==8*$f)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");let t=e/8,n=new Uint8Array(t);for(let o=0;o<t;o++){if(r>=8){n[o]=255,r-=8;continue}n[o]=255-(255>>r),r=0}return n}var zf=class{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=zD(e));else{let n=lg(e);if(n==null)throw new Error("Failed to parse network");t=String(t);let o=parseInt(t,10);if(Number.isNaN(o)||String(o).length!==t.length||o<0||o>n.length*8){let i=lg(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=qD(o,8*n.length);this.network=v2(n,this.mask)}}contains(e){return Mz({network:this.network,mask:this.mask},e)}toString(){let e=Tz(this.mask),t=e!==-1?String(e):Pz(this.mask);return $D(this.network)+"/"+t}};function kz(r,e){return new zf(r).contains(e)}function KD(r){let e,t;if(r.getComponents().forEach(n=>{(n.name==="ip4"||n.name==="ip6")&&(t=n.value),n.name==="ipcidr"&&(e=n.value)}),e==null||t==null)throw new Error("Invalid multiaddr");return new zf(t,e)}var Iz=new Map;function Pu(r){return!!r?.[HD]}function we(r){return new Ax(r)}function ms(r){let e=Qo.getProtocol(r);return{code:e.code,size:e.size??0,name:e.name,resolvable:!!e.resolvable,path:!!e.path}}var Hme=[6,53,56,54,55];function Rz(r){return Lz("sni",r)?.value}function Nz(r){let e=Lz("tcp",r)?.value;return e==null?"":`:${e}`}function Lz(r,e){return e.find(t=>t.name===r)}function Oz(r){return r.some(({code:e})=>e===448)}function da(r,e){let t=Fz[r.name];if(t==null)throw new Error(`Can't interpret protocol ${r.name}`);let n=t(r,e);return r.code===41?`[${n}]`:n}var Fz={ip4:(r,e)=>r.value,ip6:(r,e)=>e.length===0?r.value:`[${r.value}]`,tcp:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${da(t,e)}:${r.value}`},udp:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${da(t,e)}:${r.value}`},dnsaddr:(r,e)=>r.value,dns4:(r,e)=>r.value,dns6:(r,e)=>r.value,dns:(r,e)=>r.value,ipfs:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${da(t,e)}`},p2p:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${da(t,e)}`},http:(r,e)=>{let t=Oz(e),n=Rz(e),o=Nz(e);if(t&&n!=null)return`https://${n}${o}`;let i=t?"https://":"http://",s=e.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=da(s,e);return a=a?.replace("tcp://",""),`${i}${a}`},"http-path":(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=da(t,e),o=decodeURIComponent(r.value??"");return`${n}${o}`},tls:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return da(t,e)},sni:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return da(t,e)},https:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=da(t,e);return n=n?.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{let t=Oz(e),n=Rz(e),o=Nz(e);if(t&&n!=null)return`wss://${n}${o}`;let i=t?"wss://":"ws://",s=e.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=da(s,e);return a=a?.replace("tcp://",""),`${i}${a}`},wss:(r,e)=>{let t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=da(t,e);return n=n?.replace("tcp://",""),`wss://${n}`}};function pg(r,e){let n=we(r).getComponents(),o=n.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let i=Fz[o.name];if(i==null)throw new Error(`No interpreter found for ${o.name}`);let s=i(o,n)??"";return e?.assumeHttp!==!1&&Hme.includes(o.code)&&(s=s.replace(/^.*:\/\//,""),o.value==="443"?s=`https://${s}`:s=`http://${s}`),(s.startsWith("http://")||s.startsWith("https://")||s.startsWith("ws://")||s.startsWith("wss://"))&&(s=new URL(s).toString(),s.endsWith("/")&&(s=s.substring(0,s.length-1))),s}var hg=class{url;#e=0;#t=0;#r=0;#a=0;#s=new Map;log;transformRequestInit;constructor(e,{logger:t,transformRequestInit:n}){this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#l(e){let t=e.multihash.bytes;return Yr.encode(t)}getRawBlock(e,t){return f(this,null,function*(){let n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",t?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);let o=this.#l(e),i=new AbortController,s=()=>{i.abort()};t?.addEventListener("abort",s);try{let a=this.#s.get(o);if(a==null){this.#e++;let c={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?yield this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(u=>f(this,null,function*(){if(this.log("GET %s %d",n,u.status),!u.ok)throw this.#t++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return this.#a++,new Uint8Array(yield u.arrayBuffer())})),this.#s.set(o,a)}return yield a}catch{throw t?.aborted===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(this.#t++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t?.removeEventListener("abort",s),this.#s.delete(o)}})}reliability(){return this.#e===0?1:this.#r>0?-1/0:this.#a/(this.#e+this.#t*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#e,errors:this.#t,invalidBlocks:this.#r,successes:this.#a,pendingResponses:this.#s.size}}};var Uz=xr(Bz(),1),$me=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],zme=$me.map(r=>new Uz.Netmask(r));function WD(r){for(let e of zme)if(e.contains(r))return!0;return!1}function qme(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function Kme(r){let e=r.split(":");if(e.length<2)return!1;let t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return WD(o)}function Wme(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function Gme(r){let e=r.split(":"),t=e[e.length-1];return WD(t)}function Yme(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function Fo(r){if(Li(r))return WD(r);if(qme(r))return Kme(r);if(Wme(r))return Gme(r);if(ug(r))return Yme(r)}var Xme=r=>r.toString().split("/").slice(1),mg=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),ut=r=>({match:e=>mg(t=>t===r).match(e),pattern:r}),qf=()=>({match:r=>mg(e=>typeof e=="string").match(r),pattern:"{string}"}),gg=()=>({match:r=>mg(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),Ut=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{Sr.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),b2=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{Zc.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),Rt=r=>({match:e=>{let t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),po=(...r)=>({match:e=>{let t;for(let n of r){let o=n.match(e);o!==!1&&(t==null||o.length<t.length)&&(t=o)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),bt=(...r)=>({match:e=>{for(let t of r){let n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Vt(...r){function e(o){let i=Xme(o);for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function t(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}var Qme=Ut(),Vz=Vt(Qme),Tx=bt(ut("dns4"),qf()),Px=bt(ut("dns6"),qf()),Mx=bt(ut("dnsaddr"),qf()),YD=bt(ut("dns"),qf()),IYe=Vt(Tx,Rt(Ut())),AYe=Vt(Px,Rt(Ut())),DYe=Vt(Mx,Rt(Ut())),E2=Vt(po(YD,Mx,Tx,Px),Rt(Ut())),jz=bt(ut("ip4"),mg(Li)),Hz=bt(ut("ip6"),mg(ug)),XD=po(jz,Hz),ml=po(XD,YD,Tx,Px,Mx),$z=Vt(po(XD,bt(po(YD,Mx,Tx,Px),Rt(Ut())))),QD=Vt(jz),ZD=Vt(Hz),zz=Vt(XD),JD=bt(ml,ut("tcp"),gg()),x2=bt(ml,ut("udp"),gg()),Kf=Vt(bt(JD,Rt(Ut()))),TYe=Vt(x2),eT=bt(x2,ut("quic"),Rt(Ut())),kx=bt(x2,ut("quic-v1"),Rt(Ut())),Zme=po(eT,kx),PYe=Vt(eT),qz=Vt(kx),GD=po(ml,JD,x2,eT,kx),Kz=po(bt(GD,ut("ws"),Rt(Ut()))),gl=Vt(Kz),Wz=po(bt(GD,ut("wss"),Rt(Ut())),bt(GD,ut("tls"),Rt(bt(ut("sni"),qf())),ut("ws"),Rt(Ut()))),Wf=Vt(Wz),Gz=bt(x2,ut("webrtc-direct"),Rt(b2()),Rt(b2()),Rt(Ut())),S2=Vt(Gz),Yz=bt(kx,ut("webtransport"),Rt(b2()),Rt(b2()),Rt(Ut())),tT=Vt(Yz),Dx=po(Kz,Wz,bt(JD,Rt(Ut())),bt(Zme,Rt(Ut())),bt(ml,Rt(Ut())),Gz,Yz,Ut()),Rx=Vt(Dx),Jme=bt(Dx,ut("p2p-circuit"),Ut()),Zo=Vt(Jme),ege=po(bt(Dx,ut("p2p-circuit"),ut("webrtc"),Rt(Ut())),bt(Dx,ut("webrtc"),Rt(Ut())),bt(ut("webrtc"),Rt(Ut()))),_2=Vt(ege),tge=po(bt(ml,ut("tcp"),gg(),ut("http"),Rt(Ut())),bt(ml,ut("http"),Rt(Ut()))),Xz=Vt(tge),rge=po(bt(ml,ut("tcp"),po(bt(ut("443"),ut("http")),bt(gg(),ut("https")),bt(gg(),ut("tls"),ut("http"))),Rt(Ut())),bt(ml,ut("tls"),ut("http"),Rt(Ut())),bt(ml,ut("https"),Rt(Ut()))),Qz=Vt(rge),nge=po(bt(ut("memory"),qf(),Rt(Ut()))),MYe=Vt(nge);function rT(r,e,t){return r.filter(n=>{if(Qz.matches(n)||e&&Xz.matches(n))return t||E2.matches(n)?!0:Fo(n.toOptions().host)===!1;if(!e&&t){let{host:o}=n.toOptions();if(o==="127.0.0.1"||o==="localhost"||o.endsWith(".localhost"))return!0}return!1})}function Nx(s,a,c,l,u){return M(this,arguments,function*(r,e,t,n,o,i={}){try{for(var d=O(e.findProviders(r,i)),h,p,m;h=!(p=yield new S(d.next())).done;h=!1){let y=p.value;let b=rT(y.multiaddrs,n,o);if(b.length===0)continue;let x=pg(b[0]);yield new hg(x,{logger:t,transformRequestInit:i.transformRequestInit})}}catch{m=[p]}finally{try{h&&(p=d.return)&&(yield new S(p.call(d)))}finally{if(m)throw m[0]}}})}var nT=class extends Nf{routing;allowInsecure;allowLocal;transformRequestInit;constructor(e,t){super(e,I(v({},t),{name:"helia:trustless-gateway:session"})),this.routing=e.routing,this.allowInsecure=t.allowInsecure??Ox,this.allowLocal=t.allowLocal??Lx,this.transformRequestInit=t.transformRequestInit}queryProvider(e,t,n){return f(this,null,function*(){this.log("fetching BLOCK for %c from %s",e,t.url);let o=yield t.getRawBlock(e,n.signal);return this.log.trace("got block for %c from %s",e,t.url),yield n.validateFn?.(o),o})}findNewProviders(n){return M(this,arguments,function*(e,t={}){yield*Q(Nx(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,I(v({},t),{transformRequestInit:this.transformRequestInit})))})}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}convertToProvider(e,t){return f(this,null,function*(){if(us(e))return;let n=rT(Array.isArray(e)?e:[e],this.allowInsecure,this.allowLocal);if(n.length===0)return;let o=pg(n[0]);return new hg(o,{logger:this.logger,transformRequestInit:this.transformRequestInit})})}};function Zz(r,e){return new nT(r,e)}var Fx=class{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??Ox,this.allowLocal=t.allowLocal??Lx,this.transformRequestInit=t.transformRequestInit}retrieve(n){return f(this,arguments,function*(e,t={}){let o=[];try{for(var i=O(Nx(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,I(v({},t),{transformRequestInit:this.transformRequestInit}))),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;this.log("getting block for %c from %s",e,l.url);try{let u=yield l.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,l.url);try{yield t.validateFn?.(u)}catch(d){this.log.error("failed to validate block for %c from %s",e,l.url,d);continue}return u}catch(u){if(this.log.error("failed to get block for %c from %s",e,l.url,u),u instanceof Error?o.push(u):o.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${l.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,l.url);break}}}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw o.length>0?new AggregateError(o,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)})}createSession(e={}){return Zz({logger:this.logger,routing:this.routing},I(v({},e),{allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit}))}};var Ox=!1,Lx=!1;function oT(r={}){return e=>new Fx(e,r)}function Bx(t){return M(this,arguments,function*(r,e={}){let n=r.getReader();try{for(;;){let o=yield new S(n.read());if(o.done)return;yield o.value}}finally{e.preventCancel!==!0&&(yield new S(n.cancel())),n.releaseLock()}})}var lge=xr(Ux(),1);var yl=(()=>{class r extends Error{static name="SignatureVerificationError";constructor(t="Record signature verification failed"){super(t),this.name="SignatureVerificationError"}}return r})(),Jz=(()=>{class r extends Error{static name="RecordExpiredError";constructor(t="Record has expired"){super(t),this.name="RecordExpiredError"}}return r})(),Vx=(()=>{class r extends Error{static name="UnsupportedValidityError";constructor(t="The validity type is unsupported"){super(t),this.name="UnsupportedValidityError"}}return r})(),eq=(()=>{class r extends Error{static name="RecordTooLargeError";constructor(t="The record is too large"){super(t),this.name="RecordTooLargeError"}}return r})(),tq=(()=>{class r extends Error{static name="InvalidValueError";constructor(t="Value must be a valid content path starting with /"){super(t),this.name="InvalidValueError"}}return r})(),rq=(()=>{class r extends Error{static name="InvalidRecordDataError";constructor(t="Invalid record data"){super(t),this.name="InvalidRecordDataError"}}return r})(),sT=(()=>{class r extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(t="Invalid embedded public key"){super(t),this.name="InvalidEmbeddedPublicKeyError"}}return r})();var Jo;(function(r){let e;(function(o){o.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(o){o[o.EOL=0]="EOL"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.value!=null&&(i.uint32(10),i.bytes(o.value)),o.signatureV1!=null&&(i.uint32(18),i.bytes(o.signatureV1)),o.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(o.validityType,i)),o.validity!=null&&(i.uint32(34),i.bytes(o.validity)),o.sequence!=null&&(i.uint32(40),i.uint64(o.sequence)),o.ttl!=null&&(i.uint32(48),i.uint64(o.ttl)),o.pubKey!=null&&(i.uint32(58),i.bytes(o.pubKey)),o.signatureV2!=null&&(i.uint32(66),i.bytes(o.signatureV2)),o.data!=null&&(i.uint32(74),i.bytes(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.value=o.bytes();break}case 2:{a.signatureV1=o.bytes();break}case 3:{a.validityType=r.ValidityType.codec().decode(o);break}case 4:{a.validity=o.bytes();break}case 5:{a.sequence=o.uint64();break}case 6:{a.ttl=o.uint64();break}case 7:{a.pubKey=o.bytes();break}case 8:{a.signatureV2=o.bytes();break}case 9:{a.data=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(Jo||(Jo={}));var oge=Dt("ipns:utils"),nq=Z("/ipns/");var ige=0,sge=18;function oq(r){let e;if(r.pubKey!=null)try{e=Vr(r.pubKey)}catch(t){throw oge.error(t),t}if(e!=null)return e}function iq(r){let e=Z("ipns-signature:");return zt([e,r])}function C2(r){return"signatureV1"in r?Jo.encode({value:Z(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:Z(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):Jo.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function ac(r){let e=Jo.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new yl("Missing data or signatureV2");let t=sq(e.data),n=age(t.Value),o=te(t.Validity);if(e.value!=null&&e.signatureV1!=null)return cge(e),{value:n,validityType:Jo.ValidityType.EOL,validity:o,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:Jo.ValidityType.EOL,validity:o,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function I2(r){return zt([nq,r.bytes])}function yg(r){let e=Nt(r.slice(nq.length));if(!jx(e,ige)&&!jx(e,sge))throw new Em("Multihash in IPNS key was not identity or sha2-256");return e}function sq(r){let e=Pi(r);if(e.ValidityType===0)e.ValidityType=Jo.ValidityType.EOL;else throw new Vx("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function age(r){let e=te(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${ce.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${ce.parse(e).toV1().toString()}`}catch{}throw new tq("Value must be a valid content path starting with /")}function cge(r){if(r.data==null)throw new rq("Record data is missing");let e=sq(r.data);if(!Me(e.Value,r.value??new Uint8Array(0)))throw new yl('Field "value" did not match between protobuf and CBOR');if(!Me(e.Validity,r.validity??new Uint8Array(0)))throw new yl('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new yl('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new yl('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new yl('Field "ttl" did not match between protobuf and CBOR')}function jx(r,e){return r.code===e}var CXe=Dt("ipns"),IXe=5*60*1e9,uge="/ipns/",AXe=uge.length;var aq=xr(Ux(),1);var Hx=Dt("ipns:validator"),dge=1024*10,fge=(r,e)=>f(null,null,function*(){let t=ac(e),n;try{let o=iq(t.data);n=yield r.verify(o,t.signatureV2)}catch{n=!1}if(!n)throw Hx.error("record signature verification failed"),new yl("Record signature verification failed");if(t.validityType===Jo.ValidityType.EOL){if(aq.default.fromString(t.validity).toDate().getTime()<Date.now())throw Hx.error("record has expired"),new Jz("record has expired")}else if(t.validityType!=null)throw Hx.error("the validity type is unsupported"),new Vx("The validity type is unsupported");Hx("ipns record for %s is valid",t.value)});function $x(r,e){return f(this,null,function*(){if(e.byteLength>dge)throw new eq("The record is too large");let t=yg(r),n;jx(t,0)&&(n=nx(t));let o=ac(e),i=oq(o)??n;if(i==null)throw new sT("Could not extract public key from IPNS record or routing key");let s=I2(i.toMultihash());if(!Me(s,r))throw new sT("Embedded public key did not match routing key");yield fge(i,e)})}var zx=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"};function A2(t){return M(this,arguments,function*(r,e={}){let n=/\r?\n/,o=new TextDecoder("utf8"),i="";try{for(var s=O(r),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;if(typeof u=="string"&&(u=new TextEncoder().encode(u)),Om(u)&&(u=u.subarray()),i+=o.decode(u,{stream:!0}),i.length>(e?.maxMessageLength??i.length))throw new zx("Incoming message too long");let d=i.split(n);i=d.pop()??"";for(let h=0;h<d.length;h++)yield JSON.parse(d[h])}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}i+=o.decode(),i!==""&&(yield JSON.parse(i))})}var qx=(()=>{class r extends Error{static name="InvalidRequestError";constructor(t="Invalid request"){super(t),this.name="InvalidRequestError"}}return r})(),vl=(()=>{class r extends Error{static name="BadResponseError";constructor(t="Bad response"){super(t),this.name="BadResponseError"}}return r})();function pge(r){return r[Symbol.asyncIterator]!=null}function hge(r){if(pge(r))return f(null,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield e.next()).done;t=!1){let i=n.value;return i}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield n.call(e))}finally{if(o)throw o[0]}}});for(let e of r)return e}var vg=hge;var cq=Z("/ipns/");function lq(r){return Me(r.subarray(0,cq.byteLength),cq)}var Kx=class{client;constructor(e){this.client=e}findProviders(n){return M(this,arguments,function*(e,t={}){yield*Q(_n(this.client.getProviders(e,t),o=>({id:o.ID,multiaddrs:o.Addrs??[]})))})}provide(){return f(this,null,function*(){})}cancelReprovide(){return f(this,null,function*(){})}put(e,t,n){return f(this,null,function*(){if(!lq(e))return;let o=yg(e),i=ce.createV1(114,o),s=ac(t);yield this.client.putIPNS(i,s,n)})}get(e,t){return f(this,null,function*(){if(!lq(e))throw new kt("Not found");let n=yg(e),o=ce.createV1(114,n);try{let i=yield this.client.getIPNS(o,t);return C2(i)}catch(i){throw i.name==="BadResponseError"?new kt("Not found"):i}})}},Wx=class{client;constructor(e){this.client=e}findPeer(n){return f(this,arguments,function*(e,t={}){let o=yield vg(this.client.getPeers(e,t));if(o!=null)return{id:o.ID,multiaddrs:o.Addrs??[]};throw new kt("Not found")})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){})}};var Bn=Dt("delegated-routing-v1-http-api-client"),Gx={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"},Yx=class{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new mu({concurrency:t.concurrentRequests??Gx.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Gx.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new Kx(this),this.peerRouting=new Wx(this),this.cacheName=t.cacheName??Gx.cacheName,this.cacheTTL=t.cacheTTL??Gx.cacheTTL}get[Ga](){return this.contentRouting}get[Ya](){return this.peerRouting}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=yield globalThis.caches?.open(this.cacheName),this.cache!=null&&Bn("cache enabled with ttl %d",this.cacheTTL)))})}stop(){return f(this,null,function*(){this.httpQueue.clear(),this.shutDownController.abort(),yield globalThis.caches?.delete(this.cacheName),this.started=!1})}getProviders(n){return M(this,arguments,function*(e,t={}){Bn("getProviders starts: %c",e);let o=AbortSignal.timeout(this.timeout),i=Ze([this.shutDownController.signal,o,t.signal]);let s=ze(),a=ze();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));try{yield new S(s.promise);let h=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#t(h,t.filterAddrs,t.filterProtocols);let p={headers:{Accept:"application/x-ndjson"},signal:i},m=yield new S(this.#r(h.toString(),p));if(m==null)throw new vl("No response received");if(!m.ok)throw m.status===404?new kt("No matching records found"):m.status===422?new qx("Request does not conform to schema or semantic constraints"):new vl(`Unexpected status code: ${m.status}`);if(m.body==null)throw new vl("Routing response had no body");let y=m.headers.get("Content-Type");if(y==null)throw new vl("No Content-Type header received");if(y?.startsWith("application/json")){let b=yield new S(m.json());for(let x of b.Providers){let A=this.#e(x);A!=null&&(yield A)}}else if(y.includes("application/x-ndjson"))try{for(var c=O(A2(Bx(m.body))),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let b=u.value;let x=this.#e(b);x!=null&&(yield x)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}else throw new vl(`Unsupported Content-Type: ${y}`)}finally{i.clear(),a.resolve(),Bn("getProviders finished: %c",e)}})}getPeers(n){return M(this,arguments,function*(e,t={}){Bn("getPeers starts: %c",e);let o=AbortSignal.timeout(this.timeout),i=Ze([this.shutDownController.signal,o,t.signal]);let s=ze(),a=ze();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));try{yield new S(s.promise);let h=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#t(h,t.filterAddrs,t.filterProtocols);let p={headers:{Accept:"application/x-ndjson"},signal:i},m=yield new S(this.#r(h.toString(),p));if(m.status===404)throw new kt("No matching records found");if(m.status===422)throw new qx("Request does not conform to schema or semantic constraints");if(m.body==null)throw new vl("Routing response had no body");if(m.headers.get("Content-Type")==="application/json"){let b=yield new S(m.json());for(let x of b.Peers){let A=this.#e(x);A!=null&&(yield A)}}else try{for(var c=O(A2(Bx(m.body))),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let b=u.value;let x=this.#e(b);x!=null&&(yield x)}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}}catch(h){Bn.error("getPeers errored:",h)}finally{i.clear(),a.resolve(),Bn("getPeers finished: %c",e)}})}getIPNS(n){return f(this,arguments,function*(e,t={}){Bn("getIPNS starts: %s",e);let o=AbortSignal.timeout(this.timeout),i=Ze([this.shutDownController.signal,o,t.signal]);let s=ze(),a=ze();this.httpQueue.add(()=>f(this,null,function*(){return s.resolve(),a.promise}));let c=`${this.clientUrl}routing/v1/ipns/${e}`;try{yield s.promise;let l={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},u=yield this.#r(c,l);if(Bn("getIPNS GET %s %d",c,u.status),u.status===404)throw new kt("No matching records found");if(u.status===422)throw new qx("Request does not conform to schema or semantic constraints");if(u.body==null)throw new vl("GET ipns response had no body");let d=yield u.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&(yield $x(I2(e.multihash),h)),ac(h)}catch(l){throw Bn.error("getIPNS GET %s error:",c,l),l}finally{i.clear(),a.resolve(),Bn("getIPNS finished: %s",e)}})}putIPNS(o,i){return f(this,arguments,function*(e,t,n={}){Bn("putIPNS starts: %c",e);let s=AbortSignal.timeout(this.timeout),a=Ze([this.shutDownController.signal,s,n.signal]);let c=ze(),l=ze();this.httpQueue.add(()=>f(this,null,function*(){return c.resolve(),l.promise}));let u=`${this.clientUrl}routing/v1/ipns/${e}`;try{yield c.promise;let d=C2(t),h={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:d,signal:a},p=yield this.#r(u,h);if(Bn("putIPNS PUT %s %d",u,p.status),p.status!==200)throw new vl("PUT ipns response had status other than 200")}catch(d){throw Bn.error("putIPNS PUT %s error:",u,d.stack),d}finally{a.clear(),l.resolve(),Bn("putIPNS finished: %c",e)}})}#e(e){try{let t=[],n=e.Addrs?.map(we)??[];return e.Protocols!=null&&t.push(...e.Protocols),e.Protocol!=null&&(t.push(e.Protocol),delete e.Protocol),I(v({},e),{Schema:"peer",ID:sr(e.ID),Addrs:n,Protocols:t})}catch(t){Bn.error("could not conform record to peer schema",t)}}#t(e,t,n){if(t!=null||this.filterAddrs!=null){let o=t?.join(",")??this.filterAddrs?.join(",")??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){let o=n?.join(",")??this.filterProtocols?.join(",")??"";o!==""&&e.searchParams.set("filter-protocols",o)}}#r(e,t){return f(this,null,function*(){let n=t.method??"GET",o=`${n}-${e}`;if(n==="GET"){let c=yield this.cache?.match(e);if(c!=null){if(parseInt(c.headers.get("x-cache-expires")??"0",10)>Date.now())return Bn("returning cached response for %s",o),c;yield this.cache?.delete(e)}}let i=this.inFlightRequests.get(o);if(i!=null){let c=yield i;return Bn("deduplicating outgoing request for %s",o),c.clone()}let s=fetch(e,t).then(c=>f(this,null,function*(){if(this.cache!=null&&c.ok&&n==="GET"){let l=Date.now()+this.cacheTTL,u=new Headers(c.headers);u.set("x-cache-expires",l.toString());let d=new Response(c.clone().body,{status:c.status,statusText:c.statusText,headers:u});yield this.cache.put(e,d)}return c})).finally(()=>{this.inFlightRequests.delete(o)});return this.inFlightRequests.set(o,s),yield s})}};function uq(r,e={}){return new Yx(new URL(r),e)}function aT(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}var dq="[a-fA-F\\d:]",Mu=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${dq})|(?<=${dq})(?=\\s|$))`:"",fa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",tn="[a-fA-F\\d]{1,4}",Xx=`
(?:
(?:${tn}:){7}(?:${tn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${tn}:){6}(?:${fa}|:${tn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${tn}:){5}(?::${fa}|(?::${tn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${tn}:){4}(?:(?::${tn}){0,1}:${fa}|(?::${tn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${tn}:){3}(?:(?::${tn}){0,2}:${fa}|(?::${tn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${tn}:){2}(?:(?::${tn}){0,3}:${fa}|(?::${tn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${tn}:){1}(?:(?::${tn}){0,4}:${fa}|(?::${tn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${tn}){0,5}:${fa}|(?::${tn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),mge=new RegExp(`(?:^${fa}$)|(?:^${Xx}$)`),gge=new RegExp(`^${fa}$`),yge=new RegExp(`^${Xx}$`),cT=r=>r&&r.exact?mge:new RegExp(`(?:${Mu(r)}${fa}${Mu(r)})|(?:${Mu(r)}${Xx}${Mu(r)})`,"g");cT.v4=r=>r&&r.exact?gge:new RegExp(`${Mu(r)}${fa}${Mu(r)}`,"g");cT.v6=r=>r&&r.exact?yge:new RegExp(`${Mu(r)}${Xx}${Mu(r)}`,"g");var lT=cT;function uT(r){let e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}function fq(){return!1}var{toString:vge}=Object.prototype;function dT(r){return vge.call(r)==="[object RegExp]"}var pq={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function fT(r,e={}){if(!dT(r))throw new TypeError("Expected a RegExp instance");let t=Object.keys(pq).map(o=>(typeof e[o]=="boolean"?e[o]:r[o])?pq[o]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function pT(r,e,{timeout:t}={}){try{return uT(()=>fT(r).test(e),{timeout:t})()}catch(n){if(fq(n))return!1;throw n}}var wge=15,bge=45,hq={timeout:400};function hT(r){return r.length>bge?!1:pT(lT.v6({exact:!0}),r,hq)}function mq(r){return r.length>wge?!1:pT(lT.v4({exact:!0}),r,hq)}var gq={http:"80",https:"443",ws:"80",wss:"443"},Ege=["http","https","ws","wss"];function yq(r,e){e=e??{};let t=e.defaultDnsType??"dns",{scheme:n,hostname:o,port:i,path:s}=xge(r),a=[Sge(o,t),_ge(i,n),Cge(n)];s!=null&&a.push(Ige(s));let c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return we(c)}function xge(r){let[e]=r.split(":");Ege.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:o,pathname:i,search:s}=new URL(r);if(o==null||o===""){let c=Age(e);c!=null&&(o=c),c==null&&t==="http:"&&(o="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),s!=null&&s!==""&&(a=a??"",a+=s),{scheme:e,hostname:n,port:o,path:a}}function Sge(r,e){if(!(r==null||r==="")){if(mq(r))return["ip4",r];if(hT(r))return["ip6",r];if(r[0]==="["){let t=r.substring(1,r.length-1);if(hT(t))return["ip6",t]}return[e,r]}}function _ge(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function Cge(r){if(r.match(/^tcp$|^udp$/)==null)return r==="https"?["/tls/http"]:r==="wss"?["/tls/ws"]:[r]}function Ige(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function Age(r){if(!(r==null||r===""||gq[r]==null))return gq[r]}var Dge=["https://trustless-gateway.link","https://4everland.io"],Tge=2336;function Pge(r){return r=r.toString(),{id:la(ce.createV1(Tge,wn.digest(Z(r)))),multiaddrs:[yq(r)]}}var mT=class{gateways;shuffle;constructor(e={}){this.gateways=(e.gateways??Dge).map(t=>Pge(t)),this.shuffle=e.shuffle??!0}findProviders(e,t){return M(this,null,function*(){yield*Q((this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(n=>I(v({},n),{protocols:["transport-ipfs-gateway-http"]})))})}};function gT(r={}){return new mT(r)}var yT=class{libp2p;constructor(e){this.libp2p=e}provide(e,t){return f(this,null,function*(){yield this.libp2p.contentRouting.provide(e,t)})}cancelReprovide(e,t){return f(this,null,function*(){yield this.libp2p.contentRouting.cancelReprovide(e,t)})}findProviders(e,t){return M(this,null,function*(){yield*Q(this.libp2p.contentRouting.findProviders(e,t))})}put(e,t,n){return f(this,null,function*(){yield this.libp2p.contentRouting.put(e,t,n)})}get(e,t){return f(this,null,function*(){return this.libp2p.contentRouting.get(e,t)})}findPeer(e,t){return f(this,null,function*(){return this.libp2p.peerRouting.findPeer(e,t)})}getClosestPeers(e,t){return M(this,null,function*(){yield*Q(this.libp2p.peerRouting.getClosestPeers(e,t))})}};function vT(r){return new yT(r)}var D2=class extends Zs{data;constructor(){super(),this.data=new Map}put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(Gi.encode(e.multihash.bytes),t),e}get(e,t){t?.signal?.throwIfAborted();let n=this.data.get(Gi.encode(e.multihash.bytes));if(n==null)throw new Xo;return n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(Gi.encode(e.multihash.bytes))}delete(e,t){return f(this,null,function*(){t?.signal?.throwIfAborted(),this.data.delete(Gi.encode(e.multihash.bytes))})}getAll(e){return M(this,null,function*(){e?.signal?.throwIfAborted();for(let[t,n]of this.data.entries())yield{cid:ce.createV1(Tr,Nt(Gi.decode(t))),block:n},e?.signal?.throwIfAborted()})}};var bZe=Dt("blockstore:core:tiered");var vq="SHARDING";function kge(r){return r[Symbol.asyncIterator]!=null}function Rge(r){if(kge(r))return f(null,null,function*(){let t=[];try{for(var n=O(r),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t.push(a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t});let e=[];for(let t of r)e.push(t);return e}var pa=Rge;function Nge(r){return r[Symbol.asyncIterator]!=null}function Oge(r,e){return Nge(r)?function(){return M(this,null,function*(){let t=yield new S(pa(r));yield*Q(t.sort(e))})}():function*(){let t=pa(r);yield*Q(t.sort(e))}()}var Gf=Oge;var ha=class{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}putMany(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let{key:c,value:l}=s.value;yield new S(this.put(c,l,t)),yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}getMany(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;yield{key:c,value:yield new S(this.get(c,t))}}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}deleteMany(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(e),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;yield new S(this.delete(c,t)),yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:n=>f(this,null,function*(){yield Yo(this.putMany(e,n)),e=[],yield Yo(this.deleteMany(t,n)),t=[]})}}_all(e,t){return M(this,null,function*(){throw new Error("._all is not implemented")})}_allKeys(e,t){return M(this,null,function*(){throw new Error("._allKeys is not implemented")})}query(e,t){let n=this._all(e,t);if(e.prefix!=null){let o=e.prefix;n=so(n,i=>i.key.toString().startsWith(o))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>so(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>Gf(o,i),n)),e.offset!=null){let o=0,i=e.offset;n=so(n,()=>o++>=i)}return e.limit!=null&&(n=Du(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){let o=e.prefix;n=so(n,i=>i.toString().startsWith(o))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>so(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>Gf(o,i),n)),e.offset!=null){let o=e.offset,i=0;n=so(n,()=>i++>=o)}return e.limit!=null&&(n=Du(n,e.limit)),n}};var Yf=class extends ha{data;constructor(){super(),this.data=new Map}put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(e.toString(),t),e}get(e,t){t?.signal?.throwIfAborted();let n=this.data.get(e.toString());if(n==null)throw new Xo;return n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(e.toString())}delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(e.toString())}*_all(e,t){t?.signal?.throwIfAborted();for(let[n,o]of this.data.entries())yield{key:new Ot(n),value:o},t?.signal?.throwIfAborted()}*_allKeys(e,t){t?.signal?.throwIfAborted();for(let n of this.data.keys())yield new Ot(n),t?.signal?.throwIfAborted()}};var oJe=new Ot(vq);var vJe=Dt("datastore:core:tiered");function wg(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}var{hasOwnProperty:Eq}=Object.prototype,{propertyIsEnumerable:Lge}=Object,bg=(r,e,t)=>{Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})},Fge=void 0,bq={concatArrays:!1,ignoreUndefined:!1},Qx=r=>{let e=[];for(let t in r)Eq.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)Lge.call(r,n)&&e.push(n)}return e};function Eg(r){return Array.isArray(r)?Bge(r):wg(r)?Uge(r):r}function Bge(r){let e=r.slice(0,0);return Qx(r).forEach(t=>{bg(e,t,Eg(r[t]))}),e}function Uge(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Qx(r).forEach(t=>{bg(e,t,Eg(r[t]))}),e}var xq=(r,e,t,n)=>(t.forEach(o=>{typeof e[o]>"u"&&n.ignoreUndefined||(o in r&&r[o]!==Object.getPrototypeOf(r)?bg(r,o,wT(r[o],e[o],n)):bg(r,o,Eg(e[o])))}),r),Vge=(r,e,t)=>{let n=r.slice(0,0),o=0;return[r,e].forEach(i=>{let s=[];for(let a=0;a<i.length;a++)Eq.call(i,a)&&(s.push(String(a)),i===r?bg(n,o++,i[a]):bg(n,o++,Eg(i[a])));n=xq(n,i,Qx(i).filter(a=>!s.includes(a)),t)}),n};function wT(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?Vge(r,e,t):!wg(e)||!wg(r)?Eg(e):xq(r,e,Qx(e),t)}function kr(...r){let e=wT(Eg(bq),this!==Fge&&this||{},bq),t={_:{}};for(let n of r)if(n!==void 0){if(!wg(n))throw new TypeError("`"+n+"` is not an Option Object");t=wT(t,{_:n},e)}return t._}var SK=xr(Mq(),1);var xg={};Dn(xg,{create:()=>Jge,derivedEmptyPasswordKey:()=>Zx});var Zx={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Jge(r){let e=r?.algorithm??"AES-GCM",t=r?.keyLength??16,n=r?.nonceLength??12,o=r?.digest??"SHA-256",i=r?.saltLength??16,s=r?.iterations??32767,a=Qr.get();t*=8;function c(d,h){return f(this,null,function*(){let p=a.getRandomValues(new Uint8Array(i)),m=a.getRandomValues(new Uint8Array(n)),y={name:e,iv:m};typeof h=="string"&&(h=Z(h));let b;if(h.length===0){b=yield a.subtle.importKey("jwk",Zx,{name:"AES-GCM"},!0,["encrypt"]);try{let A={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},P=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);b=yield a.subtle.deriveKey(A,P,{name:e,length:t},!0,["encrypt"])}catch{b=yield a.subtle.importKey("jwk",Zx,{name:"AES-GCM"},!0,["encrypt"])}}else{let A={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},P=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);b=yield a.subtle.deriveKey(A,P,{name:e,length:t},!0,["encrypt"])}let x=yield a.subtle.encrypt(y,b,d);return zt([p,y.iv,new Uint8Array(x)])})}function l(d,h){return f(this,null,function*(){let p=d.subarray(0,i),m=d.subarray(i,i+n),y=d.subarray(i+n),b={name:e,iv:m};typeof h=="string"&&(h=Z(h));let x;if(h.length===0)try{let P={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},L=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);x=yield a.subtle.deriveKey(P,L,{name:e,length:t},!0,["decrypt"])}catch{x=yield a.subtle.importKey("jwk",Zx,{name:"AES-GCM"},!0,["decrypt"])}else{let P={name:"PBKDF2",salt:p,iterations:s,hash:{name:o}},L=yield a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);x=yield a.subtle.deriveKey(P,L,{name:e,length:t},!0,["decrypt"])}let A=yield a.subtle.decrypt(b,x,y);return new Uint8Array(A)})}return{encrypt:c,decrypt:l}}var ws={};Dn(ws,{Any:()=>cc,BaseBlock:()=>Un,BaseStringBlock:()=>Hq,BitString:()=>ma,BmpString:()=>ep,Boolean:()=>Zf,CharacterString:()=>lp,Choice:()=>Cg,Constructed:()=>dn,DATE:()=>O2,DateTime:()=>F2,Duration:()=>B2,EndOfContent:()=>k2,Enumerated:()=>Jf,GeneralString:()=>cp,GeneralizedTime:()=>up,GraphicString:()=>ap,HexBlock:()=>lc,IA5String:()=>sp,Integer:()=>Fi,Null:()=>ri,NumericString:()=>rp,ObjectIdentifier:()=>Bi,OctetString:()=>ho,Primitive:()=>El,PrintableString:()=>np,RawData:()=>ST,RelativeObjectIdentifier:()=>N2,Repeated:()=>dp,Sequence:()=>ur,Set:()=>ni,TIME:()=>U2,TeletexString:()=>op,TimeOfDay:()=>L2,UTCTime:()=>Ou,UniversalString:()=>tp,Utf8String:()=>ys,ValueBlock:()=>oi,VideotexString:()=>ip,ViewWriter:()=>_g,VisibleString:()=>Nu,compareSchema:()=>Ru,fromBER:()=>Ui,verifySchema:()=>O1e});var ht=xr(bl());function Xf(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function ku(r,e,t=-1){let n=t,o=r,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(r<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let l=new Uint8Array(c);for(let u=a-1;u>=0;u--){let d=Math.pow(2,u*e);l[i-u-1]=Math.floor(o/d),o-=l[i-u-1]*d}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function e6(...r){let e=0,t=0;for(let i of r)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of r)o.set(i,t),t+=i.length;return o}function ET(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let n=Xf(t,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,Xf(i,8)-n}function kq(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let s=t-e,a=ku(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=ku(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function Rq(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function ei(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(t)}var QJe=Math.log(2);function t6(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function _T(r){let e=0,t=0;for(let o=0;o<r.length;o++){let i=r[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<r.length;o++){let i=r[o];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function xl(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var _g=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return _T(this.items)}},T2=[new Uint8Array([1])],Nq="0123456789",xT="name",Oq="valueHexView",l1e="isHexOnly",u1e="idBlock",d1e="tagClass",f1e="tagNumber",p1e="isConstructed",h1e="fromBER",m1e="toBER",g1e="local",ti="",ga=new ArrayBuffer(0),r6=new Uint8Array(0),M2="EndOfContent",Uq="OCTET STRING",Vq="BIT STRING";function lc(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?ht.BufferSourceConverter.toUint8Array(i.valueHex):r6}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!xl(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ga)}toJSON(){return I(v({},super.toJSON()),{isHexOnly:this.isHexOnly,valueHex:ht.Convert.ToHex(this.valueHexView)})}},e.NAME="hexBlock",e}var Ig=(()=>{class r{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(t){this.valueBeforeDecodeView=new Uint8Array(t)}constructor({blockLength:t=0,error:n=ti,warnings:o=[],valueBeforeDecode:i=r6}={}){this.blockLength=t,this.error=n,this.warnings=o,this.valueBeforeDecodeView=ht.BufferSourceConverter.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ht.Convert.ToHex(this.valueBeforeDecodeView)}}}return r.NAME="baseBlock",r})(),oi=(()=>{class r extends Ig{fromBER(t,n,o){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}return r.NAME="valueBlock",r})(),y1e=(()=>{class r extends lc(Ig){constructor({idBlock:t={}}={}){var n,o,i,s;super(),t?(this.isHexOnly=(n=t.isHexOnly)!==null&&n!==void 0?n:!1,this.valueHexView=t.valueHex?ht.BufferSourceConverter.toUint8Array(t.valueHex):r6,this.tagClass=(o=t.tagClass)!==null&&o!==void 0?o:-1,this.tagNumber=(i=t.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=t.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(t=!1){let n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",ga}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){let i=new Uint8Array(1);if(!t){let s=this.tagNumber;s&=31,n|=s,i[0]=n}return i.buffer}if(!this.isHexOnly){let i=ku(this.tagNumber,7),s=new Uint8Array(i),a=i.byteLength,c=new Uint8Array(a+1);if(c[0]=n|31,!t){for(let l=0;l<a-1;l++)c[l+1]=s[l]|128;c[a]=s[a-1]}return c.buffer}let o=new Uint8Array(this.valueHexView.byteLength+1);if(o[0]=n|31,!t){let i=this.valueHexView;for(let s=0;s<i.length-1;s++)o[s+1]=i[s]|128;o[this.valueHexView.byteLength]=i[i.length-1]}return o.buffer}fromBER(t,n,o){let i=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,i,n,o))return-1;let s=i.subarray(n,n+o);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;let c=s[0]&31;if(c!==31)this.tagNumber=c,this.blockLength=1;else{let l=1,u=this.valueHexView=new Uint8Array(255),d=255;for(;s[l]&128;){if(u[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===d){d+=255;let p=new Uint8Array(d);for(let m=0;m<u.length;m++)p[m]=u[m];u=this.valueHexView=new Uint8Array(d)}}this.blockLength=l+1,u[l-1]=s[l]&127;let h=new Uint8Array(l);for(let p=0;p<l;p++)h[p]=u[p];u=this.valueHexView=new Uint8Array(l),u.set(h),this.blockLength<=9?this.tagNumber=Xf(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return n+this.blockLength}toJSON(){return I(v({},super.toJSON()),{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}return r.NAME="identificationBlock",r})(),v1e=(()=>{class r extends Ig{constructor({lenBlock:t={}}={}){var n,o,i;super(),this.isIndefiniteForm=(n=t.isIndefiniteForm)!==null&&n!==void 0?n:!1,this.longFormUsed=(o=t.longFormUsed)!==null&&o!==void 0?o:!1,this.length=(i=t.length)!==null&&i!==void 0?i:0}fromBER(t,n,o){let i=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,i,n,o))return-1;let s=i.subarray(n,n+o);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,n+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,n+this.blockLength;let a=s[0]&127;if(a>8)return this.error="Too big integer",-1;if(a+1>s.length)return this.error="End of input reached before message was fully decoded",-1;let c=n+1,l=i.subarray(c,c+a);return l[a-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Xf(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,n+this.blockLength}toBER(t=!1){let n,o;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return n=new ArrayBuffer(1),t===!1&&(o=new Uint8Array(n),o[0]=128),n;if(this.longFormUsed){let i=ku(this.length,8);if(i.byteLength>127)return this.error="Too big length",ga;if(n=new ArrayBuffer(i.byteLength+1),t)return n;let s=new Uint8Array(i);o=new Uint8Array(n),o[0]=i.byteLength|128;for(let a=0;a<i.byteLength;a++)o[a+1]=s[a];return n}return n=new ArrayBuffer(1),t===!1&&(o=new Uint8Array(n),o[0]=this.length),n}toJSON(){return I(v({},super.toJSON()),{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}return r.NAME="lengthBlock",r})(),Ie={},Un=(()=>{class r extends Ig{constructor(a={},s){var c=a,{name:t=ti,optional:n=!1,primitiveSchema:o}=c,i=pr(c,["name","optional","primitiveSchema"]);super(i),this.name=t,this.optional=n,o&&(this.primitiveSchema=o),this.idBlock=new y1e(i),this.lenBlock=new v1e(i),this.valueBlock=s?new s(i):new oi(i)}fromBER(t,n,o){let i=this.valueBlock.fromBER(t,n,this.lenBlock.isIndefiniteForm?o:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(t,n){let o=n||new _g;n||jq(this);let i=this.idBlock.toBER(t);if(o.write(i),this.lenBlock.isIndefiniteForm)o.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(t,o),o.write(new ArrayBuffer(2));else{let s=this.valueBlock.toBER(t);this.lenBlock.length=s.byteLength;let a=this.lenBlock.toBER(t);o.write(a),o.write(s)}return n?ga:o.final()}toJSON(){let t=I(v({},super.toJSON()),{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(t.primitiveSchema=this.primitiveSchema.toJSON()),t}toString(t="ascii"){return t==="ascii"?this.onAsciiEncoding():ht.Convert.ToHex(this.toBER())}onAsciiEncoding(){let t=this.constructor.NAME,n=ht.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${t} : ${n}`}isEqual(t){if(this===t)return!0;if(!(t instanceof this.constructor))return!1;let n=this.toBER(),o=t.toBER();return Rq(n,o)}}return r.NAME="BaseBlock",r})();function jq(r){var e;if(r instanceof Ie.Constructed)for(let t of r.valueBlock.value)jq(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var Hq=(()=>{class r extends Un{getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}constructor(i={},o){var s=i,{value:t=ti}=s,n=pr(s,["value"]);super(n,o),t&&this.fromString(t)}fromBER(t,n,o){let i=this.valueBlock.fromBER(t,n,this.lenBlock.isIndefiniteForm?o:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}return r.NAME="BaseStringBlock",r})(),w1e=(()=>{class r extends lc(oi){constructor(o={}){var i=o,{isHexOnly:t=!0}=i,n=pr(i,["isHexOnly"]);super(n),this.isHexOnly=t}}return r.NAME="PrimitiveValueBlock",r})(),$q,El=class extends Un{constructor(e={}){super(e,w1e),this.idBlock.isConstructed=!1}};$q=El;Ie.Primitive=$q;El.NAME="PRIMITIVE";function b1e(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Ag(r,e=0,t=r.length){let n=e,o=new Un({},oi),i=new Ig;if(!xl(i,r,e,t))return o.error=i.error,{offset:-1,result:o};if(!r.subarray(e,e+t).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(r,e,t);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,t-=o.idBlock.blockLength,a=o.lenBlock.fromBER(r,e,t),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,t-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=Un;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=Ie.EndOfContent;break;case 1:c=Ie.Boolean;break;case 2:c=Ie.Integer;break;case 3:c=Ie.BitString;break;case 4:c=Ie.OctetString;break;case 5:c=Ie.Null;break;case 6:c=Ie.ObjectIdentifier;break;case 10:c=Ie.Enumerated;break;case 12:c=Ie.Utf8String;break;case 13:c=Ie.RelativeObjectIdentifier;break;case 14:c=Ie.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=Ie.Sequence;break;case 17:c=Ie.Set;break;case 18:c=Ie.NumericString;break;case 19:c=Ie.PrintableString;break;case 20:c=Ie.TeletexString;break;case 21:c=Ie.VideotexString;break;case 22:c=Ie.IA5String;break;case 23:c=Ie.UTCTime;break;case 24:c=Ie.GeneralizedTime;break;case 25:c=Ie.GraphicString;break;case 26:c=Ie.VisibleString;break;case 27:c=Ie.GeneralString;break;case 28:c=Ie.UniversalString;break;case 29:c=Ie.CharacterString;break;case 30:c=Ie.BmpString;break;case 31:c=Ie.DATE;break;case 32:c=Ie.TimeOfDay;break;case 33:c=Ie.DateTime;break;case 34:c=Ie.Duration;break;default:{let l=o.idBlock.isConstructed?new Ie.Constructed:new Ie.Primitive;l.idBlock=o.idBlock,l.lenBlock=o.lenBlock,l.warnings=o.warnings,o=l}}break;case 2:case 3:case 4:default:c=o.idBlock.isConstructed?Ie.Constructed:Ie.Primitive}return o=b1e(o,c),a=o.fromBER(r,e,o.lenBlock.isIndefiniteForm?t:o.lenBlock.length),o.valueBeforeDecodeView=r.subarray(n,n+o.blockLength),{offset:a,result:o}}function Ui(r){if(!r.byteLength){let e=new Un({},oi);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ag(ht.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function E1e(r,e){return r?1:e}var Qf=(()=>{class r extends oi{constructor(i={}){var s=i,{value:t=[],isIndefiniteForm:n=!1}=s,o=pr(s,["value","isIndefiniteForm"]);super(o),this.value=t,this.isIndefiniteForm=n}fromBER(t,n,o){let i=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,i,n,o))return-1;if(this.valueBeforeDecodeView=i.subarray(n,n+o),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),n;let s=n;for(;E1e(this.isIndefiniteForm,o)>0;){let a=Ag(i,s,o);if(a.offset===-1)return this.error=a.result.error,this.warnings.concat(a.result.warnings),-1;if(s=a.offset,this.blockLength+=a.result.blockLength,o-=a.result.blockLength,this.value.push(a.result),this.isIndefiniteForm&&a.result.constructor.NAME===M2)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===M2?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(t,n){let o=n||new _g;for(let i=0;i<this.value.length;i++)this.value[i].toBER(t,o);return n?ga:o.final()}toJSON(){let t=I(v({},super.toJSON()),{isIndefiniteForm:this.isIndefiniteForm,value:[]});for(let n of this.value)t.value.push(n.toJSON());return t}}return r.NAME="ConstructedValueBlock",r})(),zq,dn=class extends Un{constructor(e={}){super(e,Qf),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};zq=dn;Ie.Constructed=zq;dn.NAME="CONSTRUCTED";var x1e=(()=>{class r extends oi{fromBER(t,n,o){return n}toBER(t){return ga}}return r.override="EndOfContentValueBlock",r})(),qq,k2=class extends Un{constructor(e={}){super(e,x1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};qq=k2;Ie.EndOfContent=qq;k2.NAME=M2;var Kq,ri=class extends Un{constructor(e={}){super(e,oi),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};Kq=ri;Ie.Null=Kq;ri.NAME="NULL";var S1e=(()=>{class r extends lc(oi){get value(){for(let t of this.valueHexView)if(t>0)return!0;return!1}set value(t){this.valueHexView[0]=t?255:0}constructor(o={}){var i=o,{value:t}=i,n=pr(i,["value"]);super(n),n.valueHex?this.valueHexView=ht.BufferSourceConverter.toUint8Array(n.valueHex):this.valueHexView=new Uint8Array(1),t&&(this.value=t)}fromBER(t,n,o){let i=ht.BufferSourceConverter.toUint8Array(t);return xl(this,i,n,o)?(this.valueHexView=i.subarray(n,n+o),o>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ET.call(this),this.blockLength=o,n+o):-1}toBER(){return this.valueHexView.slice()}toJSON(){return I(v({},super.toJSON()),{value:this.value})}}return r.NAME="BooleanValueBlock",r})(),Wq,Zf=class extends Un{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,S1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};Wq=Zf;Ie.Boolean=Wq;Zf.NAME="BOOLEAN";var _1e=(()=>{class r extends lc(Qf){constructor(o={}){var i=o,{isConstructed:t=!1}=i,n=pr(i,["isConstructed"]);super(n),this.isConstructed=t}fromBER(t,n,o){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=Qf.prototype.fromBER.call(this,t,n,o),i===-1)return i;for(let s=0;s<this.value.length;s++){let a=this.value[s].constructor.NAME;if(a===M2){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(a!==Uq)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(t,n,o),this.blockLength=o;return i}toBER(t,n){return this.isConstructed?Qf.prototype.toBER.call(this,t,n):t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return I(v({},super.toJSON()),{isConstructed:this.isConstructed})}}return r.NAME="OctetStringValueBlock",r})(),CT,ho=class extends Un{constructor(o={}){var i=o,{idBlock:e={},lenBlock:t={}}=i,n=pr(i,["idBlock","lenBlock"]);var s,a;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((a=n.value)===null||a===void 0)&&a.length)),super(v({idBlock:v({isConstructed:n.isConstructed},e),lenBlock:I(v({},t),{isIndefiniteForm:!!n.isIndefiniteForm})},n),_1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){let s=Ag(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return dn.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=ht.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof CT&&e.push(t.valueBlock.valueHexView);return ht.BufferSourceConverter.concat(e)}};CT=ho;Ie.OctetString=CT;ho.NAME=Uq;var C1e=(()=>{class r extends lc(Qf){constructor(i={}){var s=i,{unusedBits:t=0,isConstructed:n=!1}=s,o=pr(s,["unusedBits","isConstructed"]);super(o),this.unusedBits=t,this.isConstructed=n,this.blockLength=this.valueHexView.byteLength}fromBER(t,n,o){if(!o)return n;let i=-1;if(this.isConstructed){if(i=Qf.prototype.fromBER.call(this,t,n,o),i===-1)return i;for(let c of this.value){let l=c.constructor.NAME;if(l===M2){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==Vq)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let u=c.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return i}let s=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,s,n,o))return-1;let a=s.subarray(n,n+o);if(this.unusedBits=a[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let c=a.subarray(1);try{if(c.byteLength){let l=Ag(c,0,c.byteLength);l.offset!==-1&&l.offset===o-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=a.subarray(1),this.blockLength=a.length,n+o}toBER(t,n){if(this.isConstructed)return Qf.prototype.toBER.call(this,t,n);if(t)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ga;let o=new Uint8Array(this.valueHexView.length+1);return o[0]=this.unusedBits,o.set(this.valueHexView,1),o.buffer}toJSON(){return I(v({},super.toJSON()),{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}return r.NAME="BitStringValueBlock",r})(),Gq,ma=class extends Un{constructor(o={}){var i=o,{idBlock:e={},lenBlock:t={}}=i,n=pr(i,["idBlock","lenBlock"]);var s,a;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((a=n.value)===null||a===void 0)&&a.length)),super(v({idBlock:v({isConstructed:n.isConstructed},e),lenBlock:I(v({},t),{isIndefiniteForm:!!n.isIndefiniteForm})},n),C1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return dn.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let s of t)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};Gq=ma;Ie.BitString=Gq;ma.NAME=Vq;var Yq;function I1e(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l=0,u=c<s?s:c,d=0;for(let h=u;h>=0;h--,d++){switch(!0){case d<a.length:l=i[s-d]+a[c-d]+t[0];break;default:l=i[s-d]+t[0]}switch(t[0]=l/10,!0){case d>=i.length:i=e6(new Uint8Array([l%10]),i);break;default:i[s-d]=l%10}}return t[0]>0&&(i=e6(t,i)),i}function Lq(r){if(r>=T2.length)for(let e=T2.length;e<=r;e++){let t=new Uint8Array([0]),n=T2[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+t[0]]);t[0]=i[0]/10,n[o]=i[0]%10}t[0]>0&&(n=e6(t,n)),T2.push(n)}return T2[r]}function A1e(r,e){let t=0,n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l,u=0;for(let d=c;d>=0;d--,u++)switch(l=i[s-u]-a[c-u]-t,!0){case l<0:t=1,i[s-u]=l+10;break;default:t=0,i[s-u]=l}if(t>0)for(let d=s-c+1;d>=0;d--,u++)if(l=i[s-u]-t,l<0)t=1,i[s-u]=l+10;else{t=0,i[s-u]=l;break}return i.slice()}var R2=class extends lc(oi){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ET.call(this)))}constructor(n={}){var o=n,{value:e}=o,t=pr(o,["value"]);super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(kq(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,o=0){let i=this.fromBER(e,t,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let o=super.fromBER(e,t,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec})}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let l=0;l<8;l++){if((o&1)===1)switch(n){case e:t=A1e(Lq(n),t),s="-";break;default:t=I1e(t,Lq(n))}n++,o>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(s+=Nq.charAt(t[c]));return a===!1&&(s+=Nq.charAt(0)),s}};Yq=R2;R2.NAME="IntegerValueBlock";Object.defineProperty(Yq.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var P2,Fi=class extends Un{constructor(e={}){super(e,R2),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return t6(),BigInt(this.valueBlock.toString())}static fromBigInt(e){t6();let t=BigInt(e),n=new _g,o=t.toString(16).replace(/^-/,""),i=new Uint8Array(ht.Convert.FromHex(o));if(t<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let l=BigInt(`0x${ht.Convert.ToHex(a)}`)+t,u=ht.BufferSourceConverter.toUint8Array(ht.Convert.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new P2({valueHex:n.final()})}convertToDER(){let e=new P2({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new P2({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};P2=Fi;Ie.Integer=P2;Fi.NAME="INTEGER";var Xq,Jf=class extends Fi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Xq=Jf;Ie.Enumerated=Xq;Jf.NAME="ENUMERATED";var Fq=(()=>{class r extends lc(oi){constructor(i={}){var s=i,{valueDec:t=-1,isFirstSid:n=!1}=s,o=pr(s,["valueDec","isFirstSid"]);super(o),this.valueDec=t,this.isFirstSid=n}fromBER(t,n,o){if(!o)return n;let i=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,i,n,o))return-1;let s=i.subarray(n,n+o);this.valueHexView=new Uint8Array(o);for(let c=0;c<o&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let a=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)a[c]=this.valueHexView[c];return this.valueHexView=a,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xf(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),n+this.blockLength)}set valueBigInt(t){t6();let n=BigInt(t).toString(2);for(;n.length%7;)n="0"+n;let o=new Uint8Array(n.length/7);for(let i=0;i<o.length;i++)o[i]=parseInt(n.slice(i*7,i*7+7),2)+(i+1<o.length?128:0);this.fromBER(o.buffer,0,o.length)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=i[a]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let n=ku(this.valueDec,7);if(n.byteLength===0)return this.error="Error during encoding SID value",ga;let o=new Uint8Array(n.byteLength);if(!t){let i=new Uint8Array(n),s=n.byteLength-1;for(let a=0;a<s;a++)o[a]=i[a]|128;o[s]=i[s]}return o}toString(){let t="";if(this.isHexOnly)t=ht.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let n=this.valueDec;this.valueDec<=39?t="0.":this.valueDec<=79?(t="1.",n-=40):(t="2.",n-=80),t+=n.toString()}else t=this.valueDec.toString();return t}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}return r.NAME="sidBlock",r})(),D1e=(()=>{class r extends oi{constructor(o={}){var i=o,{value:t=ti}=i,n=pr(i,["value"]);super(n),this.value=[],t&&this.fromString(t)}fromBER(t,n,o){let i=n;for(;o>0;){let s=new Fq;if(i=s.fromBER(t,i,o),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,o-=s.blockLength,this.value.push(s)}return i}toBER(t){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(t);if(i.byteLength===0)return this.error=this.value[o].error,ga;n.push(i)}return _T(n)}fromString(t){this.value=[];let n=0,o=0,i="",s=!1;do if(o=t.indexOf(".",n),o===-1?i=t.substring(n):i=t.substring(n,o),n=o+1,s){let a=this.value[0],c=0;switch(a.valueDec){case 0:break;case 1:c=40;break;case 2:c=80;break;default:this.value=[];return}let l=parseInt(i,10);if(isNaN(l))return;a.valueDec=l+c,s=!1}else{let a=new Fq;if(i>Number.MAX_SAFE_INTEGER){t6();let c=BigInt(i);a.valueBigInt=c}else if(a.valueDec=parseInt(i,10),isNaN(a.valueDec))return;this.value.length||(a.isFirstSid=!0,s=!0),this.value.push(a)}while(o!==-1)}toString(){let t="",n=!1;for(let o=0;o<this.value.length;o++){n=this.value[o].isHexOnly;let i=this.value[o].toString();o!==0&&(t=`${t}.`),n?(i=`{${i}}`,this.value[o].isFirstSid?t=`2.{${i} - 80}`:t+=i):t+=i}return t}toJSON(){let t=I(v({},super.toJSON()),{value:this.toString(),sidArray:[]});for(let n=0;n<this.value.length;n++)t.sidArray.push(this.value[n].toJSON());return t}}return r.NAME="ObjectIdentifierValueBlock",r})(),Qq,Bi=class extends Un{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,D1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return I(v({},super.toJSON()),{value:this.getValue()})}};Qq=Bi;Ie.ObjectIdentifier=Qq;Bi.NAME="OBJECT IDENTIFIER";var Bq=(()=>{class r extends lc(Ig){constructor(o={}){var i=o,{valueDec:t=0}=i,n=pr(i,["valueDec"]);super(n),this.valueDec=t}fromBER(t,n,o){if(o===0)return n;let i=ht.BufferSourceConverter.toUint8Array(t);if(!xl(this,i,n,o))return-1;let s=i.subarray(n,n+o);this.valueHexView=new Uint8Array(o);for(let c=0;c<o&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let a=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)a[c]=this.valueHexView[c];return this.valueHexView=a,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xf(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),n+this.blockLength)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=i[a]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let n=ku(this.valueDec,7);if(n.byteLength===0)return this.error="Error during encoding SID value",ga;let o=new Uint8Array(n.byteLength);if(!t){let i=new Uint8Array(n),s=n.byteLength-1;for(let a=0;a<s;a++)o[a]=i[a]|128;o[s]=i[s]}return o.buffer}toString(){let t="";return this.isHexOnly?t=ht.Convert.ToHex(this.valueHexView):t=this.valueDec.toString(),t}toJSON(){return I(v({},super.toJSON()),{valueDec:this.valueDec})}}return r.NAME="relativeSidBlock",r})(),T1e=(()=>{class r extends oi{constructor(o={}){var i=o,{value:t=ti}=i,n=pr(i,["value"]);super(n),this.value=[],t&&this.fromString(t)}fromBER(t,n,o){let i=n;for(;o>0;){let s=new Bq;if(i=s.fromBER(t,i,o),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,o-=s.blockLength,this.value.push(s)}return i}toBER(t,n){let o=[];for(let i=0;i<this.value.length;i++){let s=this.value[i].toBER(t);if(s.byteLength===0)return this.error=this.value[i].error,ga;o.push(s)}return _T(o)}fromString(t){this.value=[];let n=0,o=0,i="";do{o=t.indexOf(".",n),o===-1?i=t.substring(n):i=t.substring(n,o),n=o+1;let s=new Bq;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(o!==-1);return!0}toString(){let t="",n=!1;for(let o=0;o<this.value.length;o++){n=this.value[o].isHexOnly;let i=this.value[o].toString();o!==0&&(t=`${t}.`),n&&(i=`{${i}}`),t+=i}return t}toJSON(){let t=I(v({},super.toJSON()),{value:this.toString(),sidArray:[]});for(let n=0;n<this.value.length;n++)t.sidArray.push(this.value[n].toJSON());return t}}return r.NAME="RelativeObjectIdentifierValueBlock",r})(),Zq,N2=class extends Un{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,T1e),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return I(v({},super.toJSON()),{value:this.getValue()})}};Zq=N2;Ie.RelativeObjectIdentifier=Zq;N2.NAME="RelativeObjectIdentifier";var Jq,ur=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Jq=ur;Ie.Sequence=Jq;ur.NAME="SEQUENCE";var eK,ni=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};eK=ni;Ie.Set=eK;ni.NAME="SET";var P1e=(()=>{class r extends lc(oi){constructor(n={}){var t=pr(n,[]);super(t),this.isHexOnly=!0,this.value=ti}toJSON(){return I(v({},super.toJSON()),{value:this.value})}}return r.NAME="StringValueBlock",r})(),M1e=(()=>{class r extends P1e{}return r.NAME="SimpleStringValueBlock",r})(),vs=(()=>{class r extends Hq{constructor(n={}){var t=pr(n,[]);super(t,M1e)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,ht.BufferSourceConverter.toUint8Array(t))}fromString(t){let n=t.length,o=this.valueBlock.valueHexView=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);this.valueBlock.value=t}}return r.NAME="SIMPLE STRING",r})(),k1e=(()=>{class r extends vs{fromBuffer(t){this.valueBlock.valueHexView=ht.BufferSourceConverter.toUint8Array(t);try{this.valueBlock.value=ht.Convert.ToUtf8String(t)}catch(n){this.warnings.push(`Error during "decodeURIComponent": ${n}, using raw string`),this.valueBlock.value=ht.Convert.ToBinary(t)}}fromString(t){this.valueBlock.valueHexView=new Uint8Array(ht.Convert.FromUtf8String(t)),this.valueBlock.value=t}}return r.NAME="Utf8StringValueBlock",r})(),tK,ys=class extends k1e{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};tK=ys;Ie.Utf8String=tK;ys.NAME="UTF8String";var R1e=(()=>{class r extends vs{fromBuffer(t){this.valueBlock.value=ht.Convert.ToUtf16String(t),this.valueBlock.valueHexView=ht.BufferSourceConverter.toUint8Array(t)}fromString(t){this.valueBlock.value=t,this.valueBlock.valueHexView=new Uint8Array(ht.Convert.FromUtf16String(t))}}return r.NAME="BmpStringValueBlock",r})(),rK,ep=class extends R1e{constructor(t={}){var e=pr(t,[]);super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};rK=ep;Ie.BmpString=rK;ep.NAME="BMPString";var N1e=(()=>{class r extends vs{fromBuffer(t){let n=ArrayBuffer.isView(t)?t.slice().buffer:t.slice(0),o=new Uint8Array(n);for(let i=0;i<o.length;i+=4)o[i]=o[i+3],o[i+1]=o[i+2],o[i+2]=0,o[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(n))}fromString(t){let n=t.length,o=this.valueBlock.valueHexView=new Uint8Array(n*4);for(let i=0;i<n;i++){let s=ku(t.charCodeAt(i),8),a=new Uint8Array(s);if(a.length>4)continue;let c=4-a.length;for(let l=a.length-1;l>=0;l--)o[i*4+l+c]=a[l]}this.valueBlock.value=t}}return r.NAME="UniversalStringValueBlock",r})(),nK,tp=class extends N1e{constructor(t={}){var e=pr(t,[]);super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};nK=tp;Ie.UniversalString=nK;tp.NAME="UniversalString";var oK,rp=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};oK=rp;Ie.NumericString=oK;rp.NAME="NumericString";var iK,np=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};iK=np;Ie.PrintableString=iK;np.NAME="PrintableString";var sK,op=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};sK=op;Ie.TeletexString=sK;op.NAME="TeletexString";var aK,ip=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};aK=ip;Ie.VideotexString=aK;ip.NAME="VideotexString";var cK,sp=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};cK=sp;Ie.IA5String=cK;sp.NAME="IA5String";var lK,ap=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};lK=ap;Ie.GraphicString=lK;ap.NAME="GraphicString";var uK,Nu=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};uK=Nu;Ie.VisibleString=uK;Nu.NAME="VisibleString";var dK,cp=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};dK=cp;Ie.GeneralString=dK;cp.NAME="GeneralString";var fK,lp=class extends vs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};fK=lp;Ie.CharacterString=fK;lp.NAME="CharacterString";var pK,Ou=class extends Nu{constructor(o={}){var i=o,{value:e,valueDate:t}=i,n=pr(i,["value","valueDate"]);if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ht.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=ei(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=ei(this.month,2),t[2]=ei(this.day,2),t[3]=ei(this.hour,2),t[4]=ei(this.minute,2),t[5]=ei(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return I(v({},super.toJSON()),{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}};pK=Ou;Ie.UTCTime=pK;Ou.NAME="UTCTime";var hK,up=class extends Ou{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,h=n.indexOf("+"),p="";if(h===-1&&(h=n.indexOf("-"),d=-1),h!==-1){if(p=n.substring(h+1),n=n.substring(0,h),p.length!==2&&p.length!==4)throw new Error("Wrong input string for conversion");let m=parseInt(p.substring(0,2),10);if(isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*m,p.length===4){if(m=parseInt(p.substring(2,4),10),isNaN(m.valueOf()))throw new Error("Wrong input string for conversion");c=d*m}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){let d=new Number(`0${n.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),o=n.substring(0,l)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}let u=s.exec(o);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(ei(this.year,4)),t.push(ei(this.month,2)),t.push(ei(this.day,2)),t.push(ei(this.hour,2)),t.push(ei(this.minute,2)),t.push(ei(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(ei(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return I(v({},super.toJSON()),{millisecond:this.millisecond})}};hK=up;Ie.GeneralizedTime=hK;up.NAME="GeneralizedTime";var mK,O2=class extends ys{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};mK=O2;Ie.DATE=mK;O2.NAME="DATE";var gK,L2=class extends ys{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};gK=L2;Ie.TimeOfDay=gK;L2.NAME="TimeOfDay";var yK,F2=class extends ys{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};yK=F2;Ie.DateTime=yK;F2.NAME="DateTime";var vK,B2=class extends ys{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};vK=B2;Ie.Duration=vK;B2.NAME="Duration";var wK,U2=class extends ys{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};wK=U2;Ie.TIME=wK;U2.NAME="TIME";var cc=class{constructor({name:e=ti,optional:t=!1}={}){this.name=e,this.optional=t}},Cg=class extends cc{constructor(n={}){var o=n,{value:e=[]}=o,t=pr(o,["value"]);super(t),this.value=e}},dp=class extends cc{constructor(o={}){var i=o,{value:e=new cc,local:t=!1}=i,n=pr(i,["value","local"]);super(n),this.value=e,this.local=t}},ST=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=ht.BufferSourceConverter.toUint8Array(e)}constructor({data:e=r6}={}){this.dataView=ht.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let o=t+n;return this.dataView=ht.BufferSourceConverter.toUint8Array(e).subarray(t,o),o}toBER(e){return this.dataView.slice().buffer}};function Ru(r,e,t){if(t instanceof Cg){for(let i of t.value)if(Ru(r,e,i).verified)return{verified:!0,result:r};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(xT)&&(i.name=t.name),i}}if(t instanceof cc)return t.hasOwnProperty(xT)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(u1e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(h1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(m1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(d1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(f1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(p1e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(l1e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(Oq in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&(r[t.name]=e)),t instanceof Ie.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof dp&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){let l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof dp){if(s=Ru(r,e.valueBlock.value[c],t.valueBlock.value[0].value),s.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&delete r[t.name]),s;if(xT in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};g1e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=Ru(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),s.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&delete r[t.name]),s;if(s.verified===!1){let c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&Oq in e.valueBlock){let i=Ag(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,ti),t.name&&(delete r[t.name],s.name=t.name)),s}return Ru(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function O1e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=Ag(ht.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:Ru(t.result,t.result,e)}function n6(r,e){return f(this,null,function*(){let n=yield xg.create().encrypt(r,e);return Yr.encode(n)})}function IT(r,e,t){return f(this,null,function*(){if(r.type==="RSA")return U1e(r,e,t);if(r.type==="Ed25519")return L1e(r,e,t);if(r.type==="secp256k1")return F1e(r,e,t);if(r.type==="ECDSA")return B1e(r,e,t);throw new Qc})}function L1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return n6(Mf(r),e);throw new Y(`export format '${t}' is not supported`)})}function F1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return n6(Mf(r),e);throw new Y("Export format is not supported")})}function B1e(r,e,t="libp2p-key"){return f(this,null,function*(){if(t==="libp2p-key")return n6(Mf(r),e);throw new Y(`export format '${t}' is not supported`)})}function U1e(r,e,t="pkcs-8"){return f(this,null,function*(){if(t==="pkcs-8")return V1e(r,e);if(t==="libp2p-key")return n6(Mf(r),e);throw new Y("Export format is not supported")})}function V1e(r,e){return f(this,null,function*(){let t=Qr.get(),o=new ur({value:[new Fi({value:0}),new ur({value:[new Bi({value:"1.2.840.113549.1.1.1"}),new ri]}),new ho({valueHex:r.raw})]}).toBER(),i=new Uint8Array(o,0,o.byteLength),s=Oo(16),a=yield ix(tg,e,s,{c:1e4,dkLen:32}),c=Oo(16),l=yield t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=yield t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),d=new ur({value:[new ho({valueHex:s}),new Fi({value:1e4}),new Fi({value:32}),new ur({value:[new Bi({value:"1.2.840.113549.2.11"}),new ri]})]}),h=new ur({value:[new Bi({value:"1.2.840.113549.1.5.13"}),new ur({value:[new ur({value:[new Bi({value:"1.2.840.113549.1.5.12"}),d]}),new ur({value:[new Bi({value:"2.16.840.1.101.3.4.1.42"}),new ho({valueHex:c})]})]})]}),m=new ur({value:[h,new ho({valueHex:u})]}).toBER(),y=new Uint8Array(m,0,m.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...te(y,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)})}function AT(r,e){return f(this,null,function*(){try{let t=yield j1e(r,e);return V$(t)}catch{}if(!r.includes("BEGIN"))throw new Y("Encrypted key was not a libp2p-key or a PEM file");return H1e(r,e)})}function j1e(r,e){return f(this,null,function*(){let t=Yr.decode(r);return xg.create().decrypt(t,e)})}function H1e(r,e){return f(this,null,function*(){let t=Qr.get(),n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let i=Z(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:s}=Ui(i),{iv:a,salt:c,iterations:l,keySize:u,cipherText:d}=$1e(s),h=yield ix(tg,e,c,{c:l,dkLen:u}),p=yield t.subtle.importKey("raw",h,"AES-CBC",!1,["decrypt"]),m=V2(yield t.subtle.decrypt({name:"AES-CBC",iv:a},p,d)),{result:y}=Ui(m);n=xK(y)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){let i=Z(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:s}=Ui(i);n=xK(s)}else throw new Y("Could not parse private key from PEM data");let o=j$(n);if(o.type!=="RSA")throw new Y("Could not parse RSA private key from PEM data");return o})}function $1e(r){let e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Y("Only pkcs5PBES2 encrypted private keys are supported");let n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Y("Only pkcs5PBKDF2 key derivation functions are supported");let i=n.valueBlock.value[1],s=V2(i.valueBlock.value[0].getValue()),a=1e4,c=32;if(i.valueBlock.value.length===3)a=Number(i.valueBlock.value[1].toBigInt()),c=Number(i.valueBlock.value[2].toBigInt());else if(i.valueBlock.value.length===2)throw new Y("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");let l=e.valueBlock.value[1].valueBlock.value[1],u=l.valueBlock.value[0].toString();if(u!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(u!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Y("Only AES-CBC encryption schemes are supported")}}}}let d=V2(l.valueBlock.value[1].getValue());return{cipherText:V2(r.valueBlock.value[1].getValue()),salt:s,iterations:a,keySize:c,iv:d}}function xK(r){return V2(r.valueBlock.value[2].getValue())}function V2(r){return new Uint8Array(r,0,r.byteLength)}var z1e="/pkcs8/",TT="/info/",j2=new WeakMap,fp={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},DT={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Dg(r){return r==null||typeof r!="string"?!1:r===(0,SK.default)(r.trim())&&r.length>0}function Vn(){return f(this,null,function*(){let t=Math.random()*800+200;yield new Promise(n=>setTimeout(n,t))})}function pp(r){return new Ot(z1e+r)}function Tg(r){return new Ot(TT+r)}function q1e(r){return f(this,null,function*(){let e=Mf(r),t=yield wt.digest(e);return Sr.encode(t.bytes).substring(1)})}var o6=class{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=kr(DT,t),this.self=t.selfKey??"self",this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<fp.minKeyLength)throw new Error(`dek.keyLength must be least ${fp.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<fp.minSaltLength)throw new Error(`dek.saltLength must be least ${fp.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<fp.minIterationCount)throw new Error(`dek.iterationCount must be least ${fp.minIterationCount}`);let n=this.init.pass!=null&&this.init.dek?.salt!=null?a2(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";j2.set(this,{dek:n})}[Symbol.toStringTag]="@libp2p/keychain";[At]=["@libp2p/keychain"];static generateOptions(){let e=Object.assign({},DT),t=Math.ceil(fp.minSaltLength/3)*3;return e.dek.salt=te(Oo(t),"base64"),e}static get options(){return DT}findKeyByName(e){return f(this,null,function*(){if(!Dg(e))throw yield Vn(),new Y(`Invalid key name '${e}'`);let t=Tg(e);try{let n=yield this.components.datastore.get(t);return JSON.parse(te(n))}catch(n){throw yield Vn(),this.log.error(n),new kt(`Key '${e}' does not exist.`)}})}findKeyById(e){return f(this,null,function*(){try{let s={prefix:TT};try{for(var t=O(this.components.datastore.query(s)),n,o,i;n=!(o=yield t.next()).done;n=!1){let a=o.value;let c=JSON.parse(te(a.value));if(c.id===e)return c}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}throw new Y(`Key with id '${e}' does not exist.`)}catch(s){throw yield Vn(),s}})}importKey(e,t){return f(this,null,function*(){if(!Dg(e))throw yield Vn(),new Y(`Invalid key name '${e}'`);if(t==null)throw yield Vn(),new Y("Key is required");let n=pp(e);if(yield this.components.datastore.has(n))throw yield Vn(),new Y(`Key '${e}' already exists`);let i,s;try{i=yield q1e(t);let l=j2.get(this);if(l==null)throw new Y("dek missing");let u=l.dek;s=yield IT(t,u,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw yield Vn(),l}let a={name:e,id:i},c=this.components.datastore.batch();return c.put(n,Z(s)),c.put(Tg(e),Z(JSON.stringify(a))),yield c.commit(),a})}exportKey(e){return f(this,null,function*(){if(!Dg(e))throw yield Vn(),new Y(`Invalid key name '${e}'`);let t=pp(e);try{let n=yield this.components.datastore.get(t),o=te(n),i=j2.get(this);if(i==null)throw new Y("dek missing");let s=i.dek;return yield AT(o,s)}catch(n){throw yield Vn(),n}})}removeKey(e){return f(this,null,function*(){if(!Dg(e)||e===this.self)throw yield Vn(),new Y(`Invalid key name '${e}'`);let t=pp(e),n=yield this.findKeyByName(e),o=this.components.datastore.batch();return o.delete(t),o.delete(Tg(e)),yield o.commit(),n})}listKeys(){return f(this,null,function*(){let e={prefix:TT},t=[];try{for(var n=O(this.components.datastore.query(e)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t.push(JSON.parse(te(a.value)))}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t})}renameKey(e,t){return f(this,null,function*(){if(!Dg(e)||e===this.self)throw yield Vn(),new Y(`Invalid old key name '${e}'`);if(!Dg(t)||t===this.self)throw yield Vn(),new Y(`Invalid new key name '${t}'`);let n=pp(e),o=pp(t),i=Tg(e),s=Tg(t);if(yield this.components.datastore.has(o))throw yield Vn(),new Y(`Key '${t}' already exists`);try{let c=yield this.components.datastore.get(n),l=yield this.components.datastore.get(i),u=JSON.parse(te(l));u.name=t;let d=this.components.datastore.batch();return d.put(o,c),d.put(s,Z(JSON.stringify(u))),d.delete(n),d.delete(i),yield d.commit(),u}catch(c){throw yield Vn(),c}})}rotateKeychainPass(e,t){return f(this,null,function*(){if(typeof e!="string")throw yield Vn(),new Y(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw yield Vn(),new Y(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw yield Vn(),new Y(`Invalid pass length ${t.length}`);this.log("recreating keychain");let n=j2.get(this);if(n==null)throw new Y("dek missing");let o=n.dek;this.init.pass=t;let i=t!=null&&this.init.dek?.salt!=null?a2(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";j2.set(this,{dek:i});let s=yield this.listKeys();for(let a of s){let c=yield this.components.datastore.get(pp(a.name)),l=te(c),u=yield AT(l,o),d=i.toString(),h=yield IT(u,d,u.type==="RSA"?"pkcs-8":"libp2p-key"),p=this.components.datastore.batch(),m={name:a.name,id:a.id};p.put(pp(a.name),Z(h)),p.put(Tg(a.name),Z(JSON.stringify(m))),yield p.commit()}this.log("keychain reconstructed")})}};function i6(r={}){return e=>new o6(e,r)}function PT(t){return f(this,arguments,function*(r,e={}){let n=e.selfKey??"self",o=i6(e)({datastore:r,logger:hu()}),i;return(yield r.has(new Ot(`/pkcs8/${n}`)))?i=yield o.exportKey(n):(i=yield eg(e.keyType??"Ed25519"),yield o.importKey(n,i)),i})}var MT=class{dns;canResolve(e){return e.getComponents().some(({name:t})=>t==="dnsaddr")}resolve(e,t){return f(this,null,function*(){let n=e.getComponents().find(c=>c.name==="dnsaddr")?.value;if(n==null)return[e];let i=yield this.getDNS(t).query(`_dnsaddr.${n}`,{signal:t?.signal,types:[ds.TXT]}),s=e.getComponents().find(c=>c.name==="p2p")?.value,a=[];for(let c of i.Answer){let l=c.data.replace(/["']/g,"").trim().split("=")[1];l!=null&&(s!=null&&!l.includes(s)||a.push(we(l)))}return a})}getDNS(e){return e.dns!=null?e.dns:(this.dns==null&&(this.dns=U4()),this.dns)}},hp=new MT;var K1e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:hp}},transportManager:{faultTolerance:wm.FATAL_ALL}};function _K(r){return f(this,null,function*(){let e=kr(K1e,r);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new Y("Private network is enforced, but no protector was provided");return e})}var H2;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={publicKey:Qe(0),payloadType:Qe(0),payload:Qe(0),signature:Qe(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(H2||(H2={}));var s6=class extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}};var ya=(()=>{class r{static createFromProtobuf=t=>{let n=H2.decode(t),o=Vr(n.publicKey);return new r({publicKey:o,payloadType:n.payloadType,payload:n.payload,signature:n.signature})};static seal=(t,n,o)=>f(null,null,function*(){if(n==null)throw new Error("Missing private key");let i=t.domain,s=t.codec,a=t.marshal(),c=CK(i,s,a),l=yield n.sign(c.subarray(),o);return new r({publicKey:n.publicKey,payloadType:s,payload:a,signature:l})});static openAndCertify=(t,n,o)=>f(null,null,function*(){let i=r.createFromProtobuf(t);if(!(yield i.validate(n,o)))throw new s6("Envelope signature is not valid for the given domain");return i});publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:n,payloadType:o,payload:i,signature:s}=t;this.publicKey=n,this.payloadType=o,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=H2.encode({publicKey:En(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return t==null?!1:Me(this.marshal(),t.marshal())}validate(t,n){return f(this,null,function*(){let o=CK(t,this.payloadType,this.payload);return this.publicKey.verify(o.subarray(),this.signature,n)})}}return r})(),CK=(r,e,t)=>{let n=Z(r),o=Sn(n.byteLength),i=Sn(e.length),s=Sn(t.length);return new Ve(o,n,i,e,s,t)};function IK(r,e){let t=(n,o)=>n.toString().localeCompare(o.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,o)=>e[o].equals(n)))}var AK="libp2p-peer-record",DK=Uint8Array.from([3,1]);var $2;(function(r){let e;(function(n){let o;n.codec=()=>(o==null&&(o=Ue((i,s,a={})=>{a.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),a.lengthDelimited!==!1&&s.ldelim()},(i,s,a={})=>{let c={multiaddr:Qe(0)},l=s==null?i.len:i.pos+s;for(;i.pos<l;){let u=i.uint32();switch(u>>>3){case 1:{c.multiaddr=i.bytes();break}default:{i.skipType(u&7);break}}}return c})),o),n.encode=i=>Be(i,n.codec()),n.decode=(i,s)=>Fe(i,n.codec(),s)})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=Ue((n,o,i={})=>{if(i.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let s of n.addresses)o.uint32(26),r.AddressInfo.codec().encode(s,o);i.lengthDelimited!==!1&&o.ldelim()},(n,o,i={})=>{let s={peerId:Qe(0),seq:0n,addresses:[]},a=o==null?n.len:n.pos+o;for(;n.pos<a;){let c=n.uint32();switch(c>>>3){case 1:{s.peerId=n.bytes();break}case 2:{s.seq=n.uint64();break}case 3:{if(i.limits?.addresses!=null&&s.addresses.length===i.limits.addresses)throw new qt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(n,n.uint32(),{limits:i.limits?.addresses$}));break}default:{n.skipType(c&7);break}}}return s})),t),r.encode=n=>Be(n,r.codec()),r.decode=(n,o)=>Fe(n,r.codec(),o)})($2||($2={}));var Vi=(()=>{class r{static createFromProtobuf=t=>{let n=$2.decode(t),o=Jr(Nt(n.peerId)),i=(n.addresses??[]).map(a=>we(a.multiaddr)),s=n.seq;return new r({peerId:o,multiaddrs:i,seqNumber:s})};static DOMAIN=AK;static CODEC=DK;peerId;multiaddrs;seqNumber;domain=r.DOMAIN;codec=r.CODEC;marshaled;constructor(t){let{peerId:n,multiaddrs:o,seqNumber:i}=t;this.peerId=n,this.multiaddrs=o??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=$2.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof r)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!IK(this.multiaddrs,t.multiaddrs))}}return r})();var Sl;(function(r){let e;(function(o){let i;o.codec=()=>(i==null&&(i=Ue((s,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),s.key!=null&&s.key!==""&&(a.uint32(10),a.string(s.key)),s.value!=null&&s.value.byteLength>0&&(a.uint32(18),a.bytes(s.value)),c.lengthDelimited!==!1&&a.ldelim()},(s,a,c={})=>{let l={key:"",value:Qe(0)},u=a==null?s.len:s.pos+a;for(;s.pos<u;){let d=s.uint32();switch(d>>>3){case 1:{l.key=s.string();break}case 2:{l.value=s.bytes();break}default:{s.skipType(d&7);break}}}return l})),i),o.encode=s=>Be(s,o.codec()),o.decode=(s,a)=>Fe(s,o.codec(),a)})(e=r.Peer$metadataEntry||(r.Peer$metadataEntry={}));let t;(function(o){let i;o.codec=()=>(i==null&&(i=Ue((s,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),s.key!=null&&s.key!==""&&(a.uint32(10),a.string(s.key)),s.value!=null&&(a.uint32(18),c6.codec().encode(s.value,a)),c.lengthDelimited!==!1&&a.ldelim()},(s,a,c={})=>{let l={key:""},u=a==null?s.len:s.pos+a;for(;s.pos<u;){let d=s.uint32();switch(d>>>3){case 1:{l.key=s.string();break}case 2:{l.value=c6.codec().decode(s,s.uint32(),{limits:c.limits?.value});break}default:{s.skipType(d&7);break}}}return l})),i),o.encode=s=>Be(s,o.codec()),o.decode=(s,a)=>Fe(s,o.codec(),a)})(t=r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.addresses!=null)for(let a of o.addresses)i.uint32(10),a6.codec().encode(a,i);if(o.protocols!=null)for(let a of o.protocols)i.uint32(18),i.string(a);if(o.publicKey!=null&&(i.uint32(34),i.bytes(o.publicKey)),o.peerRecordEnvelope!=null&&(i.uint32(42),i.bytes(o.peerRecordEnvelope)),o.metadata!=null&&o.metadata.size!==0)for(let[a,c]of o.metadata.entries())i.uint32(50),r.Peer$metadataEntry.codec().encode({key:a,value:c},i);if(o.tags!=null&&o.tags.size!==0)for(let[a,c]of o.tags.entries())i.uint32(58),r.Peer$tagsEntry.codec().encode({key:a,value:c},i);o.updated!=null&&(i.uint32(64),i.uint64Number(o.updated)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={addresses:[],protocols:[],metadata:new Map,tags:new Map},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{if(s.limits?.addresses!=null&&a.addresses.length===s.limits.addresses)throw new qt('Decode error - map field "addresses" had too many elements');a.addresses.push(a6.codec().decode(o,o.uint32(),{limits:s.limits?.addresses$}));break}case 2:{if(s.limits?.protocols!=null&&a.protocols.length===s.limits.protocols)throw new qt('Decode error - map field "protocols" had too many elements');a.protocols.push(o.string());break}case 4:{a.publicKey=o.bytes();break}case 5:{a.peerRecordEnvelope=o.bytes();break}case 6:{if(s.limits?.metadata!=null&&a.metadata.size===s.limits.metadata)throw new Zy('Decode error - map field "metadata" had too many elements');let u=r.Peer$metadataEntry.codec().decode(o,o.uint32());a.metadata.set(u.key,u.value);break}case 7:{if(s.limits?.tags!=null&&a.tags.size===s.limits.tags)throw new Zy('Decode error - map field "tags" had too many elements');let u=r.Peer$tagsEntry.codec().decode(o,o.uint32(),{limits:{value:s.limits?.tags$value}});a.tags.set(u.key,u.value);break}case 8:{a.updated=o.uint64Number();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(Sl||(Sl={}));var a6;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={multiaddr:Qe(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(a6||(a6={}));var c6;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={value:0},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(c6||(c6={}));function W1e(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;r.type==="RSA"&&(t=r.toMultihash());let n=Vr(e.publicKey,t);return ic(n)}function TK(r,e,t){let n=Sl.decode(e);return Pg(r,n,t)}function Pg(r,e,t){let n=new Map,o=BigInt(Date.now());for(let[i,s]of e.tags.entries())s.expiry!=null&&s.expiry<o||n.set(i,s);return I(v({},e),{id:W1e(r,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:s})=>({multiaddr:we(i),isCertified:s??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n})}function PK(r,e){return G1e(r.addresses,e.addresses)&&Y1e(r.protocols,e.protocols)&&X1e(r.publicKey,e.publicKey)&&Q1e(r.peerRecordEnvelope,e.peerRecordEnvelope)&&Z1e(r.metadata,e.metadata)&&J1e(r.tags,e.tags)}function G1e(r,e){return kK(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Me(t.multiaddr,n.multiaddr)))}function Y1e(r,e){return kK(r,e,(t,n)=>t===n)}function X1e(r,e){return MK(r,e)}function Q1e(r,e){return MK(r,e)}function Z1e(r,e){return RK(r,e,(t,n)=>Me(t,n))}function J1e(r,e){return RK(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function MK(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Me(r,e):!1}function kK(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function RK(r,e,t){if(r.size!==e.size)return!1;for(let[n,o]of r.entries()){let i=e.get(n);if(i==null||!t(o,i))return!1}return!0}var kT="/peers/";function z2(r){if(!us(r)||r.type==null)throw new Y("Invalid PeerId");let e=r.toCID().toString();return new Ot(`${kT}${e}`)}function NK(r,e,t,n,o){return f(this,null,function*(){let i=new Map;for(let s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=we(s.multiaddr)),!Pu(s.multiaddr))throw new Y("Multiaddr was invalid");if(!(yield e(r,s.multiaddr,o)))continue;let a=s.isCertified??!1,c=s.multiaddr.toString(),l=i.get(c);l!=null?s.isCertified=l.isCertified||a:i.set(c,{multiaddr:s.multiaddr,isCertified:a})}return[...i.values()].sort((s,a)=>s.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({isCertified:s,multiaddr:a})=>{let c=a.getPeerId();return r.equals(c)&&(a=a.decapsulate(we(`/p2p/${r}`))),{isCertified:s,multiaddr:a.bytes}})})}function u6(r,e,t,n){return f(this,null,function*(){if(e==null)throw new Y("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Y("publicKey bytes do not match peer id publicKey bytes");let o=n.existingPeer?.peer;if(o!=null&&!r.equals(o.id))throw new Y("peer id did not match existing peer id");let i=o?.addresses??[],s=new Set(o?.protocols??[]),a=o?.metadata??new Map,c=o?.tags??new Map,l=o?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(s=new Set(e.protocols)),e.metadata!=null){let h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=l6(h,{validate:OK})}if(e.tags!=null){let h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=l6(h,{validate:LK,map:FK})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(s=new Set([...s,...e.protocols])),e.metadata!=null){let h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(let[p,m]of h)m==null?a.delete(p):a.set(p,m);a=l6([...a.entries()],{validate:OK})}if(e.tags!=null){let h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),p=new Map(c);for(let[m,y]of h)y==null?p.delete(m):p.set(m,y);c=l6([...p.entries()],{validate:LK,map:FK})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;o?.id.publicKey!=null?u=En(o.id.publicKey):e.publicKey!=null?u=En(e.publicKey):r.publicKey!=null&&(u=En(r.publicKey));let d={addresses:yield NK(r,n.addressFilter??(()=>f(null,null,function*(){return!0})),i,n.existingPeer?.peerPB.addresses,n),protocols:[...s.values()].sort((h,p)=>h.localeCompare(p)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return d.addresses.forEach(h=>{h.observed=n.existingPeer?.peerPB.addresses?.find(p=>Me(p.multiaddr,p.multiaddr))?.observed??Date.now()}),r.type!=="RSA"&&delete d.publicKey,d})}function l6(r,e){let t=new Map;for(let[n,o]of r)o!=null&&e.validate(n,o);for(let[n,o]of r.sort(([i],[s])=>i.localeCompare(s)))o!=null&&t.set(n,e.map?.(n,o)??o);return t}function OK(r,e){if(typeof r!="string")throw new Y("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Y("Metadata value must be a Uint8Array")}function LK(r,e){if(typeof r!="string")throw new Y("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Y("Tag value must be an integer");if(e.value<0||e.value>100)throw new Y("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Y("Tag ttl must be an integer");if(e.ttl<0)throw new Y("Tag ttl must be between greater than 0")}}function FK(r,e){let t;e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl)));let n={value:e.value??0};return t!=null&&(n.expiry=t),n}function BK(r){let e=r.toString().split("/")[2],t=ce.parse(e,Gi);return la(t)}function RT(r,e,t){let n=BK(r);return TK(n,e,t)}function e0e(r,e){return{prefix:kT,filters:(r.filters??[]).map(t=>({key:n,value:o})=>t(RT(n,o,e))),orders:(r.orders??[]).map(t=>(n,o)=>t(RT(n.key,n.value,e),RT(o.key,o.value,e)))}}var d6=class{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=pl({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??36e5,this.maxPeerAge=t.maxPeerAge??216e5}getLock(e){let t=this.locks.get(e);return t==null&&(t={refs:0,lock:Ay({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,t.refs===0&&(t.lock.finalize(),this.locks.delete(e))}getReadLock(e,t){return f(this,null,function*(){let n=this.getLock(e);try{let o=yield n.lock.readLock(t);return()=>{o(),this.maybeRemoveLock(e,n)}}catch(o){throw this.maybeRemoveLock(e,n),o}})}getWriteLock(e,t){return f(this,null,function*(){let n=this.getLock(e);try{let o=yield n.lock.writeLock(t);return()=>{o(),this.maybeRemoveLock(e,n)}}catch(o){throw this.maybeRemoveLock(e,n),o}})}has(e,t){return f(this,null,function*(){try{return yield this.load(e,t),!0}catch(n){if(n.name!=="NotFoundError")throw n}return!1})}delete(e,t){return f(this,null,function*(){this.peerId.equals(e)||(yield this.datastore.delete(z2(e),t))})}load(e,t){return f(this,null,function*(){let n=z2(e),o=yield this.datastore.get(n,t),i=Sl.decode(o);if(this.#r(e,i))throw yield this.datastore.delete(n,t),new kt;return Pg(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)})}save(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield u6(e,t,"patch",I(v({},n),{addressFilter:this.addressFilter}));return this.#t(e,i,o)})}patch(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield u6(e,t,"patch",I(v({},n),{addressFilter:this.addressFilter,existingPeer:o}));return this.#t(e,i,o)})}merge(e,t,n){return f(this,null,function*(){let o=yield this.#e(e,n),i=yield u6(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:o});return this.#t(e,i,o)})}all(e){return M(this,null,function*(){try{for(var t=O(this.datastore.query(e0e(e??{},this.maxAddressAge),e)),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let{key:s,value:a}=o.value;let c=BK(s);if(c.equals(this.peerId))continue;let l=Sl.decode(a);if(this.#r(c,l)){yield new S(this.datastore.delete(s,e));continue}yield Pg(c,l,this.peerId.equals(c)?1/0:this.maxAddressAge)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})}#e(e,t){return f(this,null,function*(){try{let n=z2(e),o=yield this.datastore.get(n,t),i=Sl.decode(o);if(this.#r(e,i))throw yield this.datastore.delete(n,t),new kt;return{peerPB:i,peer:Pg(e,i,this.maxAddressAge)}}catch(n){n.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",n)}})}#t(e,t,n,o){return f(this,null,function*(){t.updated=Date.now();let i=Sl.encode(t);return yield this.datastore.put(z2(e),i,o),{peer:Pg(e,t,this.maxAddressAge),previous:n?.peer,updated:n==null||!PK(t,n.peerPB)}})}#r(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;let n=t.updated<Date.now()-this.maxPeerAge,o=Date.now()-this.maxAddressAge,i=t.addresses.filter(s=>s.observed!=null&&s.observed>o);return n&&i.length===0}};var NT=class{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new d6(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";forEach(e,t){return f(this,null,function*(){try{for(var n=O(this.store.all(t)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;e(a)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}})}all(e){return f(this,null,function*(){return pa(this.store.all(e))})}delete(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{yield this.store.delete(e,t)}finally{n()}})}has(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{return yield this.store.has(e,t)}finally{this.log.trace("has release read lock"),n?.()}})}get(e,t){return f(this,null,function*(){let n=yield this.store.getReadLock(e,t);try{return yield this.store.load(e,t)}finally{n?.()}})}getInfo(e,t){return f(this,null,function*(){let n=yield this.get(e,t);return{id:n.id,multiaddrs:n.addresses.map(({multiaddr:o})=>o)}})}save(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.save(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}patch(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.patch(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}merge(e,t,n){return f(this,null,function*(){let o=yield this.store.getWriteLock(e,n);try{let i=yield this.store.merge(e,t,n);return this.#e(e,i),i.peer}finally{o?.()}})}consumePeerRecord(e,t,n){return f(this,null,function*(){let o=us(t)?t:us(t?.expectedPeer)?t.expectedPeer:void 0,i=us(t)||t===void 0?n:t,s=yield ya.openAndCertify(e,Vi.DOMAIN,i),a=la(s.publicKey.toCID());if(o?.equals(a)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",o,a),!1;let c=Vi.createFromProtobuf(s.payload),l;try{l=yield this.get(a,i)}catch(u){if(u.name!=="NotFoundError")throw u}if(l?.peerRecordEnvelope!=null){let u=ya.createFromProtobuf(l.peerRecordEnvelope),d=Vi.createFromProtobuf(u.payload);if(d.seqNumber>=c.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",d.seqNumber,c.seqNumber),!1}return yield this.patch(c.peerId,{peerRecordEnvelope:e,addresses:c.multiaddrs.map(u=>({isCertified:!0,multiaddr:u}))},i),!0})}#e(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}};function UK(r,e={}){return new NT(r,e)}var VK=864e13;var t0e=448,OT=449,r0e=53,n0e=54,o0e=55,i0e=56,f6=class{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=en({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){let t=this.findHost(e);for(let n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);let o=Fo(n)===!0;this.mappings.set(n,{domain:e,verified:o,expires:o?VK-Date.now():0,lastVerified:o?VK-Date.now():void 0})})}remove(e){let t=this.findHost(e),n=!1;for(let[o,i]of this.mappings.entries())i.domain===t&&(this.log("removing %s to %s DNS mapping %e",o,i.domain,new Error("where")),this.mappings.delete(o),n=n||i.verified);return n}getAll(e){let t=[];for(let n=0;n<e.length;n++){let i=e[n].multiaddr.stringTuples(),s=i[0][1];if(s!=null)for(let[a,c]of this.mappings.entries()){if(s!==a)continue;this.maybeAddSNITuple(i,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:we(`/${i.map(u=>[ms(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){for(let n=0;n<e.length;n++)if(e[n][0]===t0e&&e[n+1]?.[0]!==OT)return e.splice(n+1,0,[OT,t]),!0;return!1}confirm(e,t){let n=this.findHost(e),o=!1;for(let[i,s]of this.mappings.entries())s.domain===n&&(this.log("marking %s to %s DNS mapping as verified",i,s.domain),o=s.verified,s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now());return o}unconfirm(e,t){let n=this.findHost(e),o=!1;for(let[i,s]of this.mappings.entries())s.domain===n&&(this.log("removing verification of %s to %s DNS mapping",i,s.domain),o=o||s.verified,s.verified=!1,s.expires=Date.now()+t);return o}findHost(e){for(let t of e.stringTuples())if(t[0]===OT||t[0]===r0e||t[0]===n0e||t[0]===o0e||t[0]===i0e)return t[1]}};var LT=4,FT=41,BT=6,s0e=273,p6=class{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=en({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){let t=e.stringTuples();for(let n of this.mappings.values())for(let o of n)if(o.externalIp===t[0][1])return!0;return!1}add(e,t,n,o=t,i="tcp"){let s=`${e}-${t}-${i}`,a=this.mappings.get(s)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:o,externalFamily:Li(n)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(s,a)}remove(e){let t=e.stringTuples(),n=t[0][1]??"",o=t[1][0]===BT?"tcp":"udp",i=parseInt(t[1][1]??"0"),s=!1;for(let[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){let u=c[l];u.externalIp===n&&u.externalPort===i&&u.protocol===o&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,n,i,o),s=s||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return s}getAll(e){let t=[];for(let{multiaddr:n}of e){let o=n.stringTuples(),i;if((o[0][0]===LT||o[0][0]===FT)&&o[1][0]===BT?i=`${o[0][1]}-${o[1][1]}-tcp`:(o[0][0]===LT||o[0][0]===FT)&&o[1][0]===s0e&&(i=`${o[0][1]}-${o[1][1]}-udp`),i==null)continue;let s=this.mappings.get(i);if(s!=null)for(let a of s)o[0][0]=a.externalFamily===4?LT:FT,o[0][1]=a.externalIp,o[1][1]=`${a.externalPort}`,t.push({multiaddr:we(`/${o.map(c=>[ms(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){let o=e.stringTuples()[0][1],i=!1;for(let s of this.mappings.values())for(let a of s)a.externalIp===o&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){let n=e.stringTuples(),o=n[0][1]??"",i=n[1][0]===BT?"tcp":"udp",s=parseInt(n[1][1]??"0"),a=!1;for(let c of this.mappings.values())for(let l=0;l<c.length;l++){let u=c[l];u.externalIp===o&&u.externalPort===s&&u.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,o,s,i),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}};function jK(r){try{for(let{code:e,value:t}of r.getComponents())if(e!==42&&t!=null){if(e===4)return t.startsWith("169.254.");if(e===41)return t.toLowerCase().startsWith("fe80")}}catch{}return!1}function h6(r){try{for(let{code:e}of r.getComponents())if(e!==42)return e===4||e===41}catch{}return!1}function bs(r){try{if(!h6(r))return!1;let[[,e]]=r.stringTuples();return e==null?!1:Fo(e)??!1}catch{}return!0}var a0e={maxObservedAddresses:10},m6=class{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=en({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??a0e.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(let t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(bs(e)||jK(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:we(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){let t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){let n=e.toString(),o=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=o.verified;return o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,o),i}};var c0e=[4,41,53,54,55,56];function UT(r){try{for(let{code:e}of r.getComponents())if(e!==42)return c0e.includes(e)}catch{}return!1}var l0e={maxObservedAddresses:10},g6=class{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=en({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??l0e.maxObservedAddresses}get(e,t){if(bs(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};let n=this.toKey(e),o=this.addresses.get(n);return o==null&&(o={verified:!UT(e),expires:0},this.addresses.set(n,o)),{multiaddr:e,verified:o.verified,type:"transport",expires:o.expires,lastVerified:o.lastVerified}}has(e){let t=this.toKey(e);return this.addresses.has(t)}remove(e){let t=this.toKey(e),n=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){let n=this.toKey(e),o=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},i=o.verified;return o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now(),this.addresses.set(n,o),i}unconfirm(e,t){let n=this.toKey(e),o=this.addresses.get(n)??{verified:!1,expires:0},i=o.verified;return o.verified=!1,o.expires=Date.now()+t,this.addresses.set(n,o),i}toKey(e){if(UT(e)){let t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}};var HK=6e4,$K={maxObservedAddresses:10,addressVerificationTTL:HK*10,addressVerificationRetry:HK*5},u0e=r=>r;function VT(r,e){let t=r.getPeerId();return t!=null&&sr(t).equals(e)&&(r=r.decapsulate(we(`/p2p/${e.toString()}`))),r}var y6=class{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){let{listen:n=[],announce:o=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(s=>s.toString()),this.announce=new Set(o.map(s=>s.toString())),this.appendAnnounce=new Set(i.map(s=>s.toString())),this.observed=new m6(e,t),this.dnsMappings=new f6(e,t),this.ipMappings=new p6(e,t),this.transportAddresses=new g6(e,t),this.announceFilter=t.announceFilter??u0e,this.observedAddressFilter=uo(1024),this.addressVerificationTTL=t.addressVerificationTTL??$K.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??$K.addressVerificationRetry,this._updatePeerStoreAddresses=el(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){let e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>we(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>we(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>we(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){let t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=VT(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=VT(e,this.components.peerId);let n=!0;(t?.type==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=VT(e,this.components.peerId);let n=!1;this.observed.has(e)&&!this.observed.remove(e)&&n&&(n=!1),this.transportAddresses.has(e)&&!this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),this.dnsMappings.has(e)&&!this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),this.ipMappings.has(e)&&!this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&n&&(n=!1),n&&this._updatePeerStoreAddresses()}getAddresses(){let e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;let o=n.multiaddr.toString();return e.has(o)?!1:(e.add(o),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{let o=we(n);return o.getComponents().pop()?.value===this.components.peerId.toString()?o:o.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){let e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(o=>{o.updateAnnounceAddrs(e)}),e.map(o=>({multiaddr:o,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(o=>this.transportAddresses.get(o,this.addressVerificationTTL)));let n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(o=>{o.updateAnnounceAddrs(n)}),t=t.concat(n.map(o=>({multiaddr:o,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(we(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,o=t,i="tcp"){this.ipMappings.add(e,t,n,o,i),this.observed.removePrefixed(`/ip${Li(n)?4:6}/${n}/${i}/${o}`)}removePublicAddressMapping(e,t,n,o=t,i="tcp"){this.ipMappings.remove(we(`/ip${Li(n)?4:6}/${n}/${i}/${o}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;let t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||Fo(t.host)===!0)return!1;let n=this.components.transportManager.getListeners(),o=[i=>gl.exactMatch(i)||Wf.exactMatch(i),i=>Kf.exactMatch(i),i=>qz.exactMatch(i)];for(let i of o){if(!i(e))continue;let s=n.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&i(u)).length>0);if(s.length!==1)continue;let a=s[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;let c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}};var v6=class extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}},w6=class extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}},Mg=class extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}},q2=class extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}},b6=class extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}},E6=class extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}},x6=class extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}},K2=class extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}},S6=class extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}},_6=class extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}},C6=class extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}},I6=class extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}},A6=class extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}},mp=class extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}},gp=class extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}},D6=class extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}},T6=class extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}};var jT=class{components={};_started=!1;constructor(e={}){this.components={};for(let[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=hu())}isStarted(){return this._started}_invokeStartableMethod(e){return f(this,null,function*(){yield Promise.all(Object.values(this.components).filter(t=>D4(t)).map(t=>f(this,null,function*(){yield t[e]?.()})))})}beforeStart(){return f(this,null,function*(){yield this._invokeStartableMethod("beforeStart")})}start(){return f(this,null,function*(){yield this._invokeStartableMethod("start"),this._started=!0})}afterStart(){return f(this,null,function*(){yield this._invokeStartableMethod("afterStart")})}beforeStop(){return f(this,null,function*(){yield this._invokeStartableMethod("beforeStop")})}stop(){return f(this,null,function*(){yield this._invokeStartableMethod("stop"),this._started=!1})}afterStop(){return f(this,null,function*(){yield this._invokeStartableMethod("afterStop")})}},f0e=["metrics","connectionProtector","dns"],p0e=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function zK(r={}){let e=new jT(r);return new Proxy(e,{get(n,o,i){if(typeof o=="string"&&!p0e.includes(o)){let s=e.components[o];if(s==null&&!f0e.includes(o))throw new v6(`${o} not set`);return s}return Reflect.get(n,o,i)},set(n,o,i){return typeof o=="string"?e.components[o]=i:Reflect.set(n,o,i),!0}})}function qK(r){let e={};for(let t of Object.values(r.components))for(let n of h0e(t))e[n]=!0;for(let t of Object.values(r.components))for(let n of m0e(t))if(e[n]!==!0)throw new w6(`Service "${g0e(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function h0e(r){return Array.isArray(r?.[At])?r[At]:[]}function m0e(r){return Array.isArray(r?.[Ci])?r[Ci]:[]}function g0e(r){return r?.[Symbol.toStringTag]??r?.toString()??"unknown"}var y0e=4,v0e=41;function KK(r={}){return v({denyDialPeer:()=>f(null,null,function*(){return!1}),denyDialMultiaddr:e=>f(null,null,function*(){if(gl.matches(e))return!1;let t=e.stringTuples();return t[0][0]===y0e||t[0][0]===v0e?!!Fo(`${t[0][1]}`):!1}),denyInboundConnection:()=>f(null,null,function*(){return!1}),denyOutboundConnection:()=>f(null,null,function*(){return!1}),denyInboundEncryptedConnection:()=>f(null,null,function*(){return!1}),denyOutboundEncryptedConnection:()=>f(null,null,function*(){return!1}),denyInboundUpgradedConnection:()=>f(null,null,function*(){return!1}),denyOutboundUpgradedConnection:()=>f(null,null,function*(){return!1}),filterMultiaddrForPeer:()=>f(null,null,function*(){return!0})},r)}var WK=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},w0e=new WeakMap;function b0e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:o}={})=>{if(o?.aborted)return Promise.reject(WK());let i,s,a,c=r??clearTimeout,l=()=>{c(i),a(WK())},u=()=>{o&&o.removeEventListener("abort",l)},d=new Promise((h,p)=>{s=()=>{u(),h(n)},a=p,i=(e??setTimeout)(s,t)});return o&&o.addEventListener("abort",l,{once:!0}),w0e.set(d,()=>{c(i),i=null,s()}),d}}var E0e=b0e(),P6=E0e;var kg=class{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new HT}consume(o){return f(this,arguments,function*(e,t=1,n={}){let i=this.getKey(e),s=this._getKeySecDuration(n),a=this.memoryStorage.incrby(i,t,s);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)throw this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this.memoryStorage.set(i,a.consumedPoints,this.blockDuration)),new j4("Rate limit exceeded",a);if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),yield P6(c)}return a})}penalty(e,t=1,n={}){let o=this.getKey(e),i=this._getKeySecDuration(n),s=this.memoryStorage.incrby(o,t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}reward(e,t=1,n={}){let o=this.getKey(e),i=this._getKeySecDuration(n),s=this.memoryStorage.incrby(o,-t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}block(e,t){let n=t*1e3,o=this.points+1;return this.memoryStorage.set(this.getKey(e),o,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:o,isFirstInDuration:!1}}set(e,t,n=0){let o=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:o===0?-1:o,consumedPoints:t,isFirstInDuration:!1}}get(e){let t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}},HT=class{storage;constructor(){this.storage=new Map}incrby(e,t,n){let o=this.storage.get(e);if(o!=null){let i=o.expiresAt!=null?o.expiresAt.getTime()-new Date().getTime():-1;return o.expiresAt==null||i>0?(o.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:o.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let o=n*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);let s={value:t,expiresAt:o>0?new Date(Date.now()+o):void 0};return this.storage.set(e,s),o>0&&(s.timeoutId=setTimeout(()=>{this.storage.delete(e)},o),s.timeoutId.unref!=null&&s.timeoutId.unref()),{remainingPoints:0,msBeforeNext:o===0?-1:o,consumedPoints:s.value,isFirstInDuration:!0}}get(e){let t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){let t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}};function M6(r){if(us(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){let n=e[0].getPeerId();t=n==null?void 0:sr(n),e.forEach(o=>{if(!Pu(o))throw new bm("Invalid multiaddr");let i=o.getPeerId();if(i==null){if(t!=null)throw new Y("Multiaddrs must all have the same peer id or have no peer id")}else{let s=sr(i);if(t?.equals(s)!==!0)throw new Y("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Vz.exactMatch(n)),{peerId:t,multiaddrs:e}}var x0e=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];function GK(r,e){return f(this,null,function*(){let t=r?.streams?.map(o=>o.protocol)??[],n=e?.closableProtocols??x0e;if(!(t.filter(o=>o!=null&&!n.includes(o)).length>0))try{yield r?.close(e)}catch(o){r?.abort(o)}})}function W2(r){try{let e;typeof r=="string"?e=we(r):e=r;let t=new Set([...e.getComponents().map(n=>n.name)]);if(!t.has("ipcidr")){let o=t.has("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(o)}return KD(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}var k6=class{connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.allow=(t.allow??[]).map(n=>W2(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}_maybePruneConnections(){return f(this,null,function*(){let e=this.connectionManager.getConnections(),t=e.length,n=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,n),t<=n)return;let o=new fo;for(let c of e){let l=c.remotePeer;if(!o.has(l)){o.set(l,0);try{let u=yield this.peerStore.get(l);o.set(l,[...u.tags.values()].reduce((d,h)=>d+h.value,0))}catch(u){u.name!=="NotFoundError"&&this.log.error("error loading peer tags",u)}}}let i=this.sortConnections(e,o),s=Math.max(t-n,0),a=[];for(let c of i)if(this.log("too many connections open - closing a connection to %p",c.remotePeer),this.allow.some(u=>u.contains(c.remoteAddr.nodeAddress().address))||a.push(c),a.length===s)break;yield Promise.all(a.map(c=>f(this,null,function*(){yield GK(c,{signal:AbortSignal.timeout(1e3)})}))),this.events.safeDispatchEvent("connection:prune",{detail:a})})}sortConnections(e,t){return e.sort((n,o)=>{let i=n.timeline.open,s=o.timeline.open;return i<s?1:i>s?-1:0}).sort((n,o)=>n.direction==="outbound"&&o.direction==="inbound"?1:n.direction==="inbound"&&o.direction==="outbound"?-1:0).sort((n,o)=>n.streams.length>o.streams.length?1:n.streams.length<o.streams.length?-1:0).sort((n,o)=>{let i=t.get(n.remotePeer)??0,s=t.get(o.remotePeer)??0;return i>s?1:i<s?-1:0})}};var YK="last-dial-failure",XK="last-dial-success";var QK=100,R6=50;var N6=class extends Rn{constructor(e={}){super(I(v({},e),{sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0}))}};function ZK(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function $T(r){if(!h6(r))return!1;let{address:e}=r.nodeAddress();return ZK(e)}function S0e(r,e){let t=Kf.exactMatch(r.multiaddr),n=Kf.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;let o=Wf.exactMatch(r.multiaddr),i=Wf.exactMatch(e.multiaddr);if(o&&!i)return-1;if(!o&&i)return 1;let s=gl.exactMatch(r.multiaddr),a=gl.exactMatch(e.multiaddr);if(s&&!a)return-1;if(!s&&a)return 1;let c=_2.exactMatch(r.multiaddr),l=_2.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;let u=S2.exactMatch(r.multiaddr),d=S2.exactMatch(e.multiaddr);if(u&&!d)return-1;if(!u&&d)return 1;let h=tT.exactMatch(r.multiaddr),p=tT.exactMatch(e.multiaddr);return h&&!p?-1:!h&&p?1:0}function _0e(r,e){let t=$T(r.multiaddr),n=$T(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function C0e(r,e){let t=bs(r.multiaddr),n=bs(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function I0e(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function A0e(r,e){let t=Zo.exactMatch(r.multiaddr),n=Zo.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function JK(r){return r.sort(S0e).sort(I0e).sort(A0e).sort(C0e).sort(_0e)}function zT(r,e,t){return f(this,null,function*(){let n=t.depth??0;if(n>(t.maxRecursiveDepth??32))throw new T6("Max recursive depth reached");let o=!1,i=[];for(let s of Object.values(e))if(s.canResolve(r)){o=!0;let a=yield s.resolve(r,t);for(let c of a)i.push(...yield zT(c,e,I(v({},t),{depth:n+1})))}return o===!1&&i.push(r),i})}var G2={maxParallelDials:R6,maxDialQueueLength:500,maxPeerAddrsToDial:25,dialTimeout:1e4,resolvers:{dnsaddr:hp}},O6=class{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;resolvers;constructor(e,t={}){this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??G2.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??G2.maxDialQueueLength,this.dialTimeout=t.dialTimeout??G2.dialTimeout,this.connections=t.connections??new fo,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.resolvers=t.resolvers??G2.resolvers,this.shutDownController=new AbortController,this.shutDownController.signal,this.queue=new N6({concurrency:t.maxParallelDials??G2.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{n.detail?.name!==Mn.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}dial(n){return f(this,arguments,function*(e,t={}){let{peerId:o,multiaddrs:i}=M6(e),s=Array.from(this.connections.values()).flat().find(c=>t.force===!0?!1:c.remotePeer.equals(o)?!0:i.find(l=>l.equals(c.remoteAddr)));if(s?.status==="open")return this.log("already connected to %a",s.remoteAddr),t.onProgress?.(new fe("dial-queue:already-connected")),s;let a=this.queue.queue.find(c=>{if(o?.equals(c.options.peerId)===!0)return!0;let l=c.options.multiaddrs;if(l==null)return!1;for(let u of i)if(l.has(u.toString()))return!0;return!1});if(a!=null){this.log("joining existing dial target for %p",o);for(let c of i)a.options.multiaddrs.add(c.toString());return t.onProgress?.(new fe("dial-queue:already-in-dial-queue")),a.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new uf("Dial queue is full");return this.log("creating dial target for %p",o,i.map(c=>c.toString())),t.onProgress?.(new fe("dial-queue:add-to-dial-queue")),this.queue.add(c=>f(this,null,function*(){c.onProgress?.(new fe("dial-queue:start-dial"));let l=Ze([this.shutDownController.signal,c.signal]);try{return yield this.dialPeer(c,l)}finally{l.clear()}}),{peerId:o,priority:t.priority??GT,multiaddrs:new Set(i.map(c=>c.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})})}dialPeer(e,t){return f(this,null,function*(){let n=e.peerId,o=e.multiaddrs,i=new Set,s=e.multiaddrs.size===0,a=0,c=0,l=[];for(this.log("starting dial to %p",n);s||o.size>0;){c++,s=!1;let u=[],d=new Set(e.multiaddrs);o.clear(),this.log("calculating addrs to dial %p from %s",n,[...d]);let h=yield this.calculateMultiaddrs(n,d,I(v({},e),{signal:t}));for(let p of h){if(i.has(p.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",p.multiaddr,n);continue}u.push(p)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,u.map(p=>p.multiaddr.toString())),e?.onProgress?.(new fe("dial-queue:calculated-addresses",u));for(let p of u){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new uf("Peer had more than maxPeerAddrsToDial");a++;try{let m=yield this.components.transportManager.dial(p.multiaddr,I(v({},e),{signal:t}));this.log("dial to %a succeeded",p.multiaddr);try{yield this.components.peerStore.merge(m.remotePeer,{multiaddrs:[m.remoteAddr],metadata:{[XK]:Z(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",n,y)}return m}catch(m){if(this.log.error("dial failed to %a",p.multiaddr,m),i.add(p.multiaddr.toString()),n!=null)try{yield this.components.peerStore.merge(n,{metadata:{[YK]:Z(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",n,y)}if(t.aborted)throw new Xa(m.message);l.push(m)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")})}calculateMultiaddrs(o){return f(this,arguments,function*(e,t=new Set,n={}){let i=[...t].map(h=>({multiaddr:we(h),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new uf("Tried to dial self");if((yield this.components.connectionGater.denyDialPeer?.(e))===!0)throw new K2("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{let h=yield this.components.peerStore.get(e);i.push(...h.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:p})=>p.toString()))}catch(h){if(h.name!=="NotFoundError")throw h}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{let h=yield this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:p})=>p.toString())),i.push(...h.multiaddrs.map(p=>({multiaddr:p,isCertified:!1})))}catch(h){h.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,h)}}}let s=(yield Promise.all(i.map(h=>f(this,null,function*(){let p=yield zT(h.multiaddr,this.resolvers,v({dns:this.components.dns,log:this.log},n));return p.length===1&&p[0].equals(h.multiaddr)?h:p.map(m=>({multiaddr:m,isCertified:!1}))})))).flat();if(e!=null){let h=`/p2p/${e.toString()}`;s=s.map(p=>p.multiaddr.getComponents().pop()?.name!=="p2p"?{multiaddr:p.multiaddr.encapsulate(h),isCertified:p.isCertified}:p)}let a=s.filter(h=>{if(this.components.transportManager.dialTransportForMultiaddr(h.multiaddr)==null)return!1;let p=h.multiaddr.getPeerId();return e!=null&&p!=null?e.equals(p):!0}),c=new Map;for(let h of a){let p=h.multiaddr.toString(),m=c.get(p);if(m!=null){m.isCertified=m.isCertified||h.isCertified||!1;continue}c.set(p,h)}let l=[...c.values()];if(l.length===0)throw new C6("The dial request has no valid addresses");let u=[];for(let h of l)this.components.connectionGater.denyDialMultiaddr!=null&&(yield this.components.connectionGater.denyDialMultiaddr(h.multiaddr))||u.push(h);let d=this.addressSorter==null?JK(u):u.sort(this.addressSorter);if(d.length===0)throw new K2("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:h})=>h.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:h})=>h.toString())),d})}isDialable(n){return f(this,arguments,function*(e,t={}){Array.isArray(e)||(e=[e]);try{let o=yield this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?o.find(i=>!Zo.matches(i.multiaddr))!=null:!0}catch(o){this.log.trace("error calculating if multiaddr(s) were dialable",o)}return!1})}};var sW=xr(oW(),1);var T0e=Object.prototype.toString,P0e=r=>T0e.call(r)==="[object Error]",M0e=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function YT(r){return r&&P0e(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:M0e.has(r.message):!1}var XT=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},iW=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};function QT(r,e){return f(this,null,function*(){return new Promise((t,n)=>{e=v({},e),e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.retries??=10;let o=sW.default.operation(e),i=()=>{o.stop(),n(e.signal?.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",i,{once:!0});let s=()=>{e.signal?.removeEventListener("abort",i),o.stop()};o.attempt(a=>f(null,null,function*(){try{let c=yield r(a);s(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof XT)throw c.originalError;if(c instanceof TypeError&&!YT(c))throw c;if(iW(c,a,e),(yield e.shouldRetry(c))||(o.stop(),n(c)),yield e.onFailedAttempt(c),!o.retry(c))throw o.mainError()}catch(l){iW(l,a,e),s(),n(l)}}}))})})}var L6=class{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new On({concurrency:t.maxParallelReconnects??5,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(o=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,o)})})}maybeReconnect(e){return f(this,null,function*(){if(!this.started)return;let t=yield this.peerStore.get(e);aW(t)&&(this.queue.has(e)||this.queue.add(n=>f(this,null,function*(){yield QT(o=>f(this,null,function*(){if(this.started)try{yield this.connectionManager.openConnection(e,{signal:n?.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,o,this.retries,i),i}}),{signal:n?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})}),{peerId:e}).catch(n=>f(this,null,function*(){this.log.error("failed to reconnect to %p - %e",e,n);let o={};[...t.tags.keys()].forEach(i=>{i.startsWith(du)&&(o[i]=void 0)}),yield this.peerStore.merge(e,{tags:o}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})})).catch(n=>f(this,null,function*(){this.log.error("failed to remove keep-alive tag from %p - %e",e,n)})))})}start(){this.started=!0}afterStart(){return f(this,null,function*(){Promise.resolve().then(()=>f(this,null,function*(){let e=yield this.peerStore.all({filters:[t=>aW(t)]});yield Promise.all(e.map(t=>f(this,null,function*(){yield this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})})))})).catch(e=>{this.log.error(e)})})}stop(){this.started=!1,this.queue.abort()}};function aW(r){for(let e of r.tags.keys())if(e.startsWith(du))return!0;return!1}var GT=50,ZT={maxConnections:QK,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},F6=class{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??ZT.maxConnections,this.maxConnections<1)throw new Y("Connection Manager maxConnections must be greater than 0");this.connections=new fo,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(n=>W2(n)),this.deny=(t.deny??[]).map(n=>W2(n)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??ZT.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new kg({points:t.inboundConnectionThreshold??ZT.inboundConnectionThreshold,duration:1}),this.connectionPruner=new k6({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:t.allow?.map(n=>we(n))}),this.dialQueue=new O6(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??R6,maxDialQueueLength:t.maxDialQueueLength??500,maxPeerAddrsToDial:t.maxPeerAddrsToDial??25,dialTimeout:t.dialTimeout??1e4,resolvers:t.resolvers??{dnsaddr:hp},connections:this.connections}),this.reconnectQueue=new L6({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";start(){return f(this,null,function*(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(let t of this.connections.values())for(let n of t)e[n.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let n of t)for(let o of n.streams){let i=`${o.direction} ${o.protocol??"unnegotiated"}`;e[i]=(e[i]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let n of this.connections.values())for(let o of n){let i={};for(let s of o.streams){let a=`${s.direction} ${s.protocol??"unnegotiated"}`;i[a]=(i[a]??0)+1}for(let[s,a]of Object.entries(i))e[s]=e[s]??[],e[s].push(a)}let t={};for(let[n,o]of Object.entries(e)){o=o.sort((s,a)=>s-a);let i=Math.floor(o.length*.9);t[n]=o[i]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),yield kn(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")})}stop(){return f(this,null,function*(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),yield oo(this.reconnectQueue,this.dialQueue,this.connectionPruner);let e=[];for(let t of this.connections.values())for(let n of t)e.push(f(this,null,function*(){try{yield n.close()}catch(o){this.log.error(o)}}));this.log("closing %d connections",e.length),yield Promise.all(e),this.connections.clear(),this.log("stopped")})}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new Y("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}_onConnect(e){return f(this,null,function*(){let{detail:t}=e;if(!this.started){yield t.close();return}if(t.status!=="open")return;let n=t.remotePeer,o=!this.connections.has(n),i=this.connections.get(n)??[];i.push(t),this.connections.set(n,i),n.publicKey!=null&&n.type==="RSA"&&(yield this.peerStore.patch(n,{publicKey:n.publicKey})),o&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})})}onDisconnect(e){let{detail:t}=e,n=t.remotePeer,i=(this.connections.get(n)??[]).filter(s=>s.id!==t.id);this.connections.set(n,i),i.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}openConnection(n){return f(this,arguments,function*(e,t={}){if(!this.started)throw new Gs("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();let{peerId:o}=M6(e);if(this.peerId.equals(o))throw new I4("Can not dial self");if(o!=null&&t.force!==!0){this.log("dial %p",o);let c=this.getConnections(o).find(l=>l.limits==null);if(c!=null)return this.log("had an existing non-limited connection to %p",o),t.onProgress?.(new fe("dial-queue:already-connected")),c}let i=yield this.dialQueue.dial(e,I(v({},t),{priority:t.priority??GT}));if(i.status!=="open")throw new _4("Remote closed connection during opening");let s=this.connections.get(i.remotePeer);s==null&&(s=[],this.connections.set(i.remotePeer,s));let a=!1;for(let c of s)if(c.id===i.id&&(a=!0),t.force!==!0&&c.id!==i.id&&c.remoteAddr.equals(i.remoteAddr))return i.abort(new bm("Duplicate multiaddr connection")),c;return a||s.push(i),i}finally{this.outboundPendingConnections--}})}closeConnections(n){return f(this,arguments,function*(e,t={}){let o=this.connections.get(e)??[];yield Promise.all(o.map(i=>f(this,null,function*(){try{yield i.close(t)}catch(s){i.abort(s)}})))})}acceptIncomingConnection(e){return f(this,null,function*(){if(this.deny.some(o=>o.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(o=>o.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let o=e.remoteAddr.nodeAddress().address;try{yield this.inboundConnectionRateLimiter.consume(o,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,o),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)})}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){let e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>we(n))}))}isDialable(n){return f(this,arguments,function*(e,t={}){return this.dialQueue.isDialable(e,t)})}};var Rg=class{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){let n=this.alpha(t,this.previousTime),o=e-this.movingAverage,i=n*o;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+o*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*o}else this.movingAverage=e;this.previousTime=t}};var N0e=1.2,O0e=2,L0e=5e3,F0e=6e4,B0e=5e3,va=class{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(e={}){let t=e.interval??B0e;this.success=new Rg(t),this.failure=new Rg(t),this.next=new Rg(t),this.failureMultiplier=e.failureMultiplier??O0e,this.timeoutMultiplier=e.timeoutMultiplier??N0e,this.minTimeout=e.minTimeout??L0e,this.maxTimeout=e.maxTimeout??F0e,e.metricName!=null&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);let n=AbortSignal.timeout(t),o=Ze([e.signal,n]);return o.start=Date.now(),o.timeout=t,o}cleanUp(e){let t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}};var B6=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function vp(r,e){let t=cE();r.sink(t).catch(s=>f(null,null,function*(){yield t.end(s)})),r.sink=s=>f(null,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield a.next()).done;c=!1){let d=l.value;yield t.push(d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}yield t.end()});let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new Ve;return{read:s=>f(null,null,function*(){if(s?.signal?.throwIfAborted(),s?.bytes==null){let{done:c,value:l}=yield lt(n.next(),s?.signal);return c===!0?null:l}for(;o.byteLength<s.bytes;){let{value:c,done:l}=yield lt(n.next(),s?.signal);if(l===!0)throw new B6("unexpected end of input");o.append(c)}let a=o.sublist(0,s.bytes);return o.consume(s.bytes),a}),write:(s,a)=>f(null,null,function*(){a?.signal?.throwIfAborted(),s instanceof Uint8Array?yield t.push(s,a):yield t.push(s.subarray(),a)}),unwrap:()=>{if(o.byteLength>0){let s=r.source;r.source=function(){return M(this,null,function*(){e?.yieldBytes===!1?yield o:yield*Q(o),yield*Q(s)})}()}return r}}}var U0e=1e4,V0e="1.0.0",j0e="ping",H0e="ipfs",cW=32,$0e=!0,U6=class{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??H0e}/${j0e}/${V0e}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??U0e,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??$0e,this.timeout=new va(I(v({},t.pingTimeout??{}),{metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"}))}[Symbol.toStringTag]="@libp2p/connection-monitor";[At]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(()=>f(this,null,function*(){let t=Date.now();try{let n=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),o=yield e.newStream(this.protocol,{signal:n,runOnLimitedConnection:!0}),i=vp(o);t=Date.now(),yield Promise.all([i.write(Oo(cW),{signal:n}),i.read({bytes:cW,signal:n})]),e.rtt=Date.now()-t,yield i.unwrap().close({signal:n})}catch(n){if(n.name!=="UnsupportedProtocolError")throw n;e.rtt=(Date.now()-t)/2}})).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}};var V6=class{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()}),getAttributesFromYieldedValue:(n,o)=>I(v({},o),{providers:[...Array.isArray(o.providers)?o.providers:[],n.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{cid:n.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([n])=>({key:te(n,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([n])=>({key:te(n,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}start(){return f(this,null,function*(){this.started=!0})}stop(){return f(this,null,function*(){this.started=!1})}findProviders(n){return M(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Mg("No content routers available");let o=this,i=new Oi;try{for(var s=O(Mo(...o.routers.filter(d=>d.findProviders instanceof Function).map(d=>d.findProviders(e,t)))),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;u!=null&&(u.multiaddrs.length>0&&(yield new S(this.components.peerStore.merge(u.id,{multiaddrs:u.multiaddrs},t))),!i.has(u.id)&&(i.add(u.id),yield u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}})}provide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Mg("No content routers available");yield Promise.all(this.routers.filter(o=>o.provide instanceof Function).map(o=>f(this,null,function*(){yield o.provide(e,t)})))})}cancelReprovide(n){return f(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new Mg("No content routers available");yield Promise.all(this.routers.filter(o=>o.cancelReprovide instanceof Function).map(o=>f(this,null,function*(){yield o.cancelReprovide(e,t)})))})}put(e,t,n){return f(this,null,function*(){if(!this.isStarted())throw new Gs;yield Promise.all(this.routers.filter(o=>o.put instanceof Function).map(o=>f(this,null,function*(){yield o.put(e,t,n)})))})}get(e,t){return f(this,null,function*(){if(!this.isStarted())throw new Gs;return Promise.any(this.routers.filter(n=>n.get instanceof Function).map(n=>f(this,null,function*(){return n.get(e,t)})))})}};var j6=globalThis.CustomEvent??Event;function Bo(t){return M(this,arguments,function*(r,e={}){let n=e.concurrency??1/0;n<1&&(n=1/0);let o=e.ordered??!1,i=new EventTarget,s=[],a=ze(),c=ze(),l=!1,u,d=!1;i.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(()=>f(null,null,function*(){try{try{for(var y=O(r),b,x,A;b=!(x=yield y.next()).done;b=!1){let P=x.value;if(s.length===n&&(a=ze(),yield a.promise),d)break;let L={done:!1};s.push(L),P().then(F=>{L.done=!0,L.ok=!0,L.value=F,i.dispatchEvent(new j6("task-complete"))},F=>{L.done=!0,L.err=F,i.dispatchEvent(new j6("task-complete"))})}}catch{A=[x]}finally{try{b&&(x=y.return)&&(yield x.call(y))}finally{if(A)throw A[0]}}l=!0,i.dispatchEvent(new j6("task-complete"))}catch(P){u=P,i.dispatchEvent(new j6("task-complete"))}}));function h(){return o?s[0]?.done:!!s.find(y=>y.done)}function*p(){for(;s.length>0&&s[0].done;){let y=s[0];if(s.shift(),y.ok)yield y.value;else throw d=!0,a.resolve(),y.err;a.resolve()}}function*m(){for(;h();)for(let y=0;y<s.length;y++)if(s[y].done){let b=s[y];if(s.splice(y,1),y--,b.ok)yield b.value;else throw d=!0,a.resolve(),b.err;a.resolve()}}for(;;){if(h()||(c=ze(),yield new S(c.promise)),u!=null||(o?yield*Q(p()):yield*Q(m()),u!=null))throw u;if(l&&s.length===0)break}})}var H6=class{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{peer:n.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],o)=>I(v({},o),{key:te(n,"base36")}),getAttributesFromYieldedValue:(n,o)=>I(v({},o),{peers:[...Array.isArray(o.peers)?o.peers:[],n.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";findPeer(e,t){return f(this,null,function*(){if(this.routers.length===0)throw new q2("No peer routers available");if(e.toString()===this.peerId.toString())throw new b6("Should not try to find self");let n=this,o=Mo(...this.routers.filter(l=>l.findPeer instanceof Function).map(l=>function(){return M(this,null,function*(){try{yield yield new S(l.findPeer(e,t))}catch(u){n.log.error(u)}})}()));try{for(var i=O(o),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;if(l!=null)return l.multiaddrs.length>0&&(yield this.peerStore.merge(l.id,{multiaddrs:l.multiaddrs},t)),l}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}throw new kt})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){if(this.routers.length===0)throw new q2("No peer routers available");let o=this,i=uo(1024);try{for(var s=O(Bo(function(){return M(this,null,function*(){let d=Mo(...o.routers.filter(b=>b.getClosestPeers instanceof Function).map(b=>b.getClosestPeers(e,t)));try{for(var h=O(d),p,m,y;p=!(m=yield new S(h.next())).done;p=!1){let b=m.value;yield()=>f(null,null,function*(){if(b.multiaddrs.length===0)try{b=yield o.findPeer(b.id,I(v({},t),{useCache:!1}))}catch(x){o.log.error("could not find peer multiaddrs",x);return}return b})}}catch{y=[m]}finally{try{p&&(m=h.return)&&(yield new S(m.call(h)))}finally{if(y)throw y[0]}}})}())),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;u!=null&&(u.multiaddrs.length>0&&(yield new S(this.peerStore.merge(u.id,{multiaddrs:u.multiaddrs},t))),!i.has(u.id.toMultihash().bytes)&&(i.add(u.id.toMultihash().bytes),yield u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}})}};var $6=class extends nt{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}walk(e){return M(this,null,function*(){this.walking||this.startWalk(),this.walkers++;let t=Ze([this.shutdownController.signal,e?.signal]);try{for(;;)this.needNext?.resolve(),this.needNext=ze(),yield(yield new S(Pr(this,"walk:peer",t,{errorEvent:"walk:error"}))).detail}finally{t.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}})}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;let e=Ze([this.walkController.signal,this.shutdownController.signal]);let t=Date.now(),n=0;Promise.resolve().then(()=>f(this,null,function*(){for(this.log("start walk");this.walkers>0;)try{let c=Oo(32),l=Date.now();try{for(var o=O(this.peerRouting.getClosestPeers(c,{signal:e})),i,s,a;i=!(s=yield o.next()).done;i=!1){let u=s.value;e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",u.id,Date.now()-l,this.walkers),n++,this.safeDispatchEvent("walk:peer",{detail:u}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),yield lt(this.needNext.promise,e)),l=Date.now()}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}this.log("walk iteration for %b and %d walkers finished, found %d peers",c,this.walkers,n)}catch(c){this.log.error("random walk errored",c),this.safeDispatchEvent("walk:error",{detail:c})}this.log("no walkers left, ended walk")})).catch(o=>{this.log.error("random walk errored",o)}).finally(()=>{this.log("finished walk, found %d peers after %dms",n,Date.now()-t),this.walking=!1})}};var JT=32,eP=64,z6=class{log;topologies;handlers;components;constructor(e){this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,e.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{let t={};for(let[n,o]of this.topologies)t[n]=o.size;return t}}),this.handlers=en({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw new E6(`No handler registered for protocol ${e}`);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}handle(e,t,n){return f(this,null,function*(){if(this.handlers.has(e)&&n?.force!==!0)throw new x6(`Handler already registered for protocol ${e}`);let o=kr.bind({ignoreUndefined:!0})({maxInboundStreams:JT,maxOutboundStreams:eP},n);this.handlers.set(e,{handler:t,options:o}),yield this.components.peerStore.merge(this.components.peerId,{protocols:[e]},n)})}unhandle(e,t){return f(this,null,function*(){(Array.isArray(e)?e:[e]).forEach(o=>{this.handlers.delete(o)}),yield this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)})}register(e,t){return f(this,null,function*(){if(t==null)throw new Y("invalid topology");let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,o=this.topologies.get(e);return o==null&&(o=new Map,this.topologies.set(e,o)),o.set(n,t),n})}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail,n={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(t,n).then(o=>{for(let i of o.protocols){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())a.filter?.has(t)!==!1&&(a.filter?.remove(t),a.onDisconnect?.(t))}}).catch(o=>{o.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,o)})}_onPeerUpdate(e){let{peer:t,previous:n}=e.detail,o=(n?.protocols??[]).filter(i=>!t.protocols.includes(i));for(let i of o){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())a.filter?.has(t.id)!==!1&&(a.filter?.remove(t.id),a.onDisconnect?.(t.id))}}_onPeerIdentify(e){let t=e.detail.protocols,n=e.detail.connection,o=e.detail.peerId;for(let i of t){let s=this.topologies.get(i);if(s!=null)for(let a of s.values())n.limits!=null&&a.notifyOnLimitedConnection!==!0||a.filter?.has(o)!==!0&&(a.filter?.add(o),a.onConnect?.(o,n))}}};var q6=class{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=en({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=en({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??wm.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){let t=e[Symbol.toStringTag];if(t==null)throw new Y("Transport must have a valid tag");if(this.transports.has(t))throw new Y(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}afterStart(){return f(this,null,function*(){let e=this.components.addressManager.getListenAddrs();yield this.listen(e)})}stop(){return f(this,null,function*(){let e=[];for(let[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){let o=n.pop();o!=null&&e.push(o.close())}yield Promise.all(e),this.log("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1})}dial(e,t){return f(this,null,function*(){let n=this.dialTransportForMultiaddr(e);if(n==null)throw new D6(`No transport available for address ${String(e)}`);return t?.onProgress?.(new fe("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,I(v({},t),{upgrader:this.components.upgrader}))})}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(let t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(let t of this.transports.values())if(t.listenFilter([e]).length>0)return t}listen(e){return f(this,null,function*(){if(!this.isStarted())throw new Gs("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}let t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new S6)});let n=[];for(let[i,s]of this.transports.entries()){let a=s.listenFilter(e);for(let c of a){this.log("creating listener for %s on %a",i,c);let l=s.createListener({upgrader:this.components.upgrader}),u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{let d=u.findIndex(h=>h===l);u.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),QD.matches(c)?t.ipv4.attempts++:ZD.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),QD.matches(c)&&t.ipv4.success++,ZD.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,d),t.errors.set(c.toString(),d),d}))}}let o=yield Promise.allSettled(n);if(!(o.length>0&&o.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===wm.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new _6(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,s])=>`
  ${i}: ${`${s.stack??s}`.split(`
`).join(`
  `)}
`).join("")}`)}})}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;let t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}remove(e){return f(this,null,function*(){let t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);let n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){let o=t.pop();o!=null&&n.push(o.close())}yield Promise.all(n),this.transports.delete(e),this.listeners.delete(e)})}removeAll(){return f(this,null,function*(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));yield Promise.all(e)})}};var jn="/multistream/1.0.0";var K6=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},W6=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},G6=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function uc(r,e={}){let t=vp(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=_t(e.maxDataLength));let n=e?.lengthDecoder??oa,o=e?.lengthEncoder??Sn;return{read:s=>f(null,null,function*(){let a=-1,c=new Ve;for(;;){c.append(yield t.read(I(v({},s),{bytes:1})));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new K6("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new G6("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new W6("message length too long");return t.read(I(v({},s),{bytes:a}))}),write:(s,a)=>f(null,null,function*(){yield t.write(new Ve(o(s.byteLength),s),a)}),writeV:(s,a)=>f(null,null,function*(){let c=new Ve(...s.flatMap(l=>[o(l.byteLength),l]));yield t.write(c,a)}),unwrap:()=>t.unwrap()}}var z0e=Z(`
`);function wp(r,e,t){return f(this,null,function*(){yield r.write(e,t)})}function lW(r,e,t){return f(this,null,function*(){yield r.writeV(e,t)})}function q0e(r,e){return f(this,null,function*(){let t=yield r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==z0e[0])throw e.log.error("Invalid mss message - missing newline",t),new vt("Missing newline");return t.sublist(0,-1)})}function Lu(r,e){return f(this,null,function*(){let t=yield q0e(r,e);return te(t.subarray())})}function Y2(r,e,t){return f(this,null,function*(){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return K0e(r,e[0],t);let n=uc(r,I(v({},t),{maxDataLength:1024})),o=e.shift();if(o==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',jn,o);let i=Z(`${jn}
`),s=Z(`${o}
`);yield lW(n,[i,s],t),t.log.trace("select: reading multistream-select header");let a=yield Lu(n,t);if(t.log.trace('select: read "%s"',a),a===jn&&(t.log.trace("select: reading protocol response"),a=yield Lu(n,t),t.log.trace('select: read "%s"',a)),a===o)return{stream:n.unwrap(),protocol:o};for(let c of e){t.log.trace('select: write "%s"',c),yield wp(n,Z(`${c}
`),t),t.log.trace("select: reading protocol response");let l=yield Lu(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new lf("protocol selection failed")})}function K0e(r,e,t){let n=r.sink.bind(r),o=r.source,i=!1,s=!1,a=ze(),c=!1,l=!1,u=ze(),d=!1,h=!1,p=ze(),m=uc({sink:n,source:o},I(v({},t),{maxDataLength:1024}));r.sink=A=>f(null,null,function*(){let{sink:P}=m.unwrap();yield P(function(){return M(this,null,function*(){let L=!1;try{for(var F=O(A),W,H,U;W=!(H=yield new S(F.next())).done;W=!1){let T=H.value;if(l&&(yield new S(u.promise)),c)yield T;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',jn,e,T.byteLength);let k=`${e}
`;yield new Ve(Uint8Array.from([19]),Z(`${jn}
`),Sn(k.length),Z(k),T).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',jn,e,T.byteLength),c=!0,l=!1,u.resolve(),y().catch(N=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,N)})}L=!0}}catch{U=[H]}finally{try{W&&(H=F.return)&&(yield new S(H.call(F)))}finally{if(U)throw U[0]}}L||(yield new S(y()))})}())});function y(){return f(this,null,function*(){if(s){t.log.trace("optimistic: already negotiating %s stream",e),yield a.promise;return}s=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),yield b()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),yield x())}finally{s=!1,i=!0,a.resolve()}})}function b(){return f(this,null,function*(){if(l){yield u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',jn,e),yield m.writeV([Z(`${jn}
`),Z(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',jn,e)}finally{c=!0,l=!1,u.resolve()}})}function x(){return f(this,null,function*(){if(h){yield p.promise;return}h=!0;try{t.log.trace("optimistic: reading multistream select header");let A=yield Lu(m,t);if(t.log.trace('optimistic: read multistream select header "%s"',A),A===jn&&(A=yield Lu(m,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',A,e),A!==e)throw new lf("protocol selection failed")}finally{d=!0,h=!1,p.resolve()}})}if(r.source=function(){return M(this,null,function*(){yield new S(y()),t.log.trace('optimistic: reading data from "%s" stream',e),yield*Q(m.unwrap().source)})}(),r.closeRead!=null){let A=r.closeRead.bind(r);r.closeRead=P=>f(null,null,function*(){i||(yield y().catch(L=>{t.log.error("could not negotiate protocol before close read",L)})),yield A(P)})}if(r.closeWrite!=null){let A=r.closeWrite.bind(r);r.closeWrite=P=>f(null,null,function*(){i||(yield y().catch(L=>{t.log.error("could not negotiate protocol before close write",L)})),yield A(P)})}if(r.close!=null){let A=r.close.bind(r);r.close=P=>f(null,null,function*(){let L=[];l&&L.push(u.promise),h&&L.push(p.promise),L.length>0?yield lt(Promise.all(L),P?.signal):(i=!0,s=!1,a.resolve()),yield A(P)})}return{stream:r,protocol:e}}function X2(r,e,t){return f(this,null,function*(){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);let n=uc(r,I(v({},t),{maxDataLength:1024,maxLengthLength:2}));for(;;){t.log.trace("handle: reading incoming string");let o=yield Lu(n,t);if(t.log.trace('handle: read "%s"',o),o===jn){t.log.trace('handle: respond with "%s" for "%s"',jn,o),yield wp(n,Z(`${jn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',jn,o);continue}if(e.includes(o))return t.log.trace('handle: respond with "%s" for "%s"',o,o),yield wp(n,Z(`${o}
`),t),t.log.trace('handle: responded with "%s" for "%s"',o,o),{stream:n.unwrap(),protocol:o};if(o==="ls"){let i=new Ve(...e.map(s=>dl.single(Z(`${s}
`))),Z(`
`));t.log.trace('handle: respond with "%s" for %s',e,o),yield wp(n,i,t),t.log.trace('handle: responded with "%s" for %s',e,o);continue}t.log.trace('handle: respond with "na" for "%s"',o),yield wp(n,Z(`na
`),t),t.log('handle: responded with "na" for "%s"',o)}})}var G0e=500,rP=class{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){let{remoteAddr:t,remotePeer:n,newStream:o,close:i,abort:s,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=o,this._close=i,this._abort=s,this._getStreams=a,this.tags=[]}[Symbol.toStringTag]="Connection";[$U]=!0;get streams(){return this._getStreams()}newStream(e,t){return f(this,null,function*(){if(this.status==="closing")throw new KU("the connection is being closed");if(this.status==="closed")throw new _4("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&t?.runOnLimitedConnection!==!0)throw new A4("Cannot open protocol stream on limited connection");let n=yield this._newStream(e,t);return n.direction="outbound",n})}close(){return f(this,arguments,function*(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){let t=AbortSignal.timeout(G0e);e=I(v({},e),{signal:t})}try{this.log.trace("closing underlying transport"),yield this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}})}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}};function dW(r){return new rP(r)}function X0e(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return JT}function Q0e(r,e,t={}){try{let{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??eP}function fW(r,e,t){let n=0;return t.streams.forEach(o=>{o.direction===e&&o.protocol===r&&n++}),n}var Y6=class{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=en({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(n=>{this.connectionEncrypters.set(n.protocol,n)}),this.streamMuxers=en({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(n=>{this.streamMuxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??1e4,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??1e4,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??1e4,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";shouldBlockConnection(e,...t){return f(this,null,function*(){let n=this.components.connectionGater[e];if(n==null)return;if((yield n.apply(this.components.connectionGater,t))===!0)throw new I6(`The multiaddr connection is blocked by gater.${e}`)})}createInboundAbortSignal(e){let t=Ze([AbortSignal.timeout(this.inboundUpgradeTimeout),e]);return t}upgradeInbound(e,t){return f(this,null,function*(){let n=!1,o=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),n=yield lt(this.components.connectionManager.acceptIncomingConnection(e),o),!n)throw new A6("Connection denied");yield lt(this.shouldBlockConnection("denyInboundConnection",e),o),yield this._performUpgrade(e,"inbound",I(v({},t),{signal:o}))}catch(i){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[i.name??"Error"]:!0}),i}finally{o.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}})}upgradeOutbound(e,t){return f(this,null,function*(){try{this.metrics.dials?.increment({outbound:!0});let n=e.remoteAddr.getPeerId(),o;n!=null&&(o=sr(n),yield lt(this.shouldBlockConnection("denyOutboundConnection",o,e),t.signal));let i="outbound";return t.initiator===!1&&(i="inbound"),yield this._performUpgrade(e,i,t)}catch(n){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[n.name??"Error"]:!0}),n}})}_performUpgrade(e,t,n){return f(this,null,function*(){let o,i,s,a,c;this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if(n?.skipProtection!==!0){let u=this.components.connectionProtector;u!=null&&(e.log("protecting the %s connection",t),l=yield u.protect(e,n))}try{if(o=l,n?.skipEncryption!==!0){n?.onProgress?.(new fe(`upgrader:encrypt-${t}-connection`)),{conn:o,remotePeer:i,protocol:c,streamMuxer:a}=yield t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n);let u=v(v({},l),o);yield this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,u)}else{let u=e.remoteAddr.getPeerId();if(u==null)throw new bm(`${t} connection that skipped encryption must have a peer id`);let d=sr(u);c="native",i=d}if(i.equals(this.components.peerId)){let u=new I4("Can not dial self");throw e.abort(u),u}if(s=o,n?.muxerFactory!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){n?.onProgress?.(new fe(`upgrader:multiplex-${t}-connection`));let u=yield t==="inbound"?this._multiplexInbound(v(v({},l),o),this.streamMuxers,n):this._multiplexOutbound(v(v({},l),o),this.streamMuxers,n);a=u.muxerFactory,s=u.stream}}catch(u){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,u),u}return yield this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:s,muxerFactory:a,remotePeer:i,limits:n?.limits})})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:o,upgradedConn:i,remotePeer:s,muxerFactory:a,limits:c}=e,l,u,d;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:m=>{if(d==null)return;let y=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);Promise.resolve().then(()=>f(this,null,function*(){let b=this.components.registrar.getProtocols(),{stream:x,protocol:A}=yield X2(m,b,{signal:y,log:m.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",A);let P=X0e(A,this.components.registrar);if(fW(A,"inbound",d)===P){let F=new XU(`Too many inbound protocol streams for protocol "${A}" - limit ${P}`);throw m.abort(F),F}m.source=x.source,m.sink=x.sink,m.protocol=A,x.closeWrite!=null&&(m.closeWrite=x.closeWrite),x.closeRead!=null&&(m.closeRead=x.closeRead),x.close!=null&&(m.close=x.close),yield this.components.peerStore.merge(s,{protocols:[A]},{signal:y}),this.components.metrics?.trackProtocolStream(m,d),this._onStream({connection:d,stream:m,protocol:A})})).catch(b=>f(this,null,function*(){d.log.error("error handling incoming stream id %s - %e",m.id,b),m.timeline.close==null&&(yield m.close({signal:y}).catch(x=>m.abort(x)))}))}}),u=(b,...x)=>f(this,[b,...x],function*(m,y={}){if(l==null)throw new mp("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",m);let A=yield l.newStream();d.log.trace("started new stream %s for protocols %s",A.id,m);try{if(y.signal==null){A.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",m);let H=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);y=I(v({},y),{signal:H})}A.log.trace("selecting protocol from protocols %s",m);let{stream:P,protocol:L}=yield Y2(A,m,I(v({},y),{log:A.log,yieldBytes:!0}));A.log.trace("selected protocol %s",L);let F=Q0e(L,this.components.registrar,y),W=fW(L,"outbound",d);if(W>=F){let H=new xm(`Too many outbound protocol streams for protocol "${L}" - ${W}/${F}`);throw A.abort(H),H}return yield this.components.peerStore.merge(s,{protocols:[L]}),A.source=P.source,A.sink=P.sink,A.protocol=L,P.closeWrite!=null&&(A.closeWrite=P.closeWrite),P.closeRead!=null&&(A.closeRead=P.closeRead),P.close!=null&&(A.close=P.close),this.components.metrics?.trackProtocolStream(A,d),A}catch(P){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,m,P),A.timeline.close==null&&A.abort(P),P}}),Promise.all([l.sink(i.source),i.sink(l.source)]).catch(m=>{d.log.error("error piping data through muxer - %e",m)}));let h=o.timeline;o.timeline=new Proxy(h,{set:(...m)=>(m[1]==="close"&&m[2]!=null&&h.close==null&&f(this,null,function*(){try{d.status==="open"&&(yield d.close())}catch(y){d.log.error("error closing connection after timeline close %e",y)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}}).catch(y=>{d.log.error("error thrown while dispatching connection:close event %e",y)}),Reflect.set(...m))}),o.timeline.upgraded=Date.now();let p=()=>{throw new mp("Connection is not multiplexed")};return d=dW({remoteAddr:o.remoteAddr,remotePeer:s,status:"open",direction:n,timeline:o.timeline,multiplexer:l?.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??p,getStreams:()=>l?.streams??[],close:m=>f(this,null,function*(){yield l?.close(m),yield o.close(m)}),abort:m=>{o.abort(m),l?.abort(m)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=h,d}_onStream(e){let{connection:t,stream:n,protocol:o}=e,{handler:i,options:s}=this.components.registrar.getHandler(o);if(t.limits!=null&&s.runOnLimitedConnection!==!0)throw new A4("Cannot open protocol stream on limited connection");i({connection:t,stream:n})}_encryptInbound(e,t){return f(this,null,function*(){let n=Array.from(this.connectionEncrypters.keys());try{let{stream:o,protocol:i}=yield X2(e,n,I(v({},t),{log:e.log})),s=this.connectionEncrypters.get(i);if(s==null)throw new gp(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),I(v({},yield s.secureInbound(o,t)),{protocol:i})}catch(o){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,o),new gp(o.message)}})}_encryptOutbound(e,t){return f(this,null,function*(){let n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);let{stream:o,protocol:i}=yield Y2(e,n,I(v({},t),{log:e.log,yieldBytes:!0})),s=this.connectionEncrypters.get(i);if(s==null)throw new gp(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),I(v({},yield s.secureOutbound(o,t)),{protocol:i})}catch(o){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,o),new gp(o.message)}})}_multiplexOutbound(e,t,n){return f(this,null,function*(){let o=Array.from(t.keys());e.log("outbound selecting muxer %s",o);try{e.log.trace("selecting stream muxer from %s",o);let{stream:i,protocol:s}=yield Y2(e,o,I(v({},n),{log:e.log,yieldBytes:!0}));e.log("selected %s as muxer protocol",s);let a=t.get(s);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing outbound connection",i),new mp(String(i))}})}_multiplexInbound(e,t,n){return f(this,null,function*(){let o=Array.from(t.keys());e.log("inbound handling muxers %s",o);try{let{stream:i,protocol:s}=yield X2(e,o,I(v({},n),{log:e.log})),a=t.get(s);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing inbound connection",i),new mp(String(i))}})}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}};var X6="2.8.12",Q6="js-libp2p";function Z6(r,e){return`${r??Q6}/${e??X6} browser/${globalThis.navigator.userAgent}`}var J6=class extends nt{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";let t=new nt,n=t.dispatchEvent.bind(t);t.dispatchEvent=l=>{let u=n(l),d=this.dispatchEvent(new CustomEvent(l.type,{detail:l.detail}));return u||d},this.peerId=e.peerId,this.logger=e.logger??hu(),this.log=this.logger.forComponent("libp2p"),this.services={};let o=e.nodeInfo?.name??Q6,i=e.nodeInfo?.version??X6,s=this.components=zK({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:o,version:i,userAgent:e.nodeInfo?.userAgent??Z6(o,i)},logger:this.logger,events:t,datastore:e.datastore??new Yf,connectionGater:KK(e.connectionGater),dns:e.dns});e.metrics!=null&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",UK(s,v({addressFilter:this.components.connectionGater.filterMultiaddrForPeer},e.peerStore))),s.events.addEventListener("peer:update",l=>{if(l.detail.previous==null){let u={id:l.detail.peer.id,multiaddrs:l.detail.peer.addresses.map(d=>d.multiaddr)};s.events.safeDispatchEvent("peer:discovery",{detail:u})}}),e.connectionProtector!=null&&this.configureComponent("connectionProtector",e.connectionProtector(s)),this.components.upgrader=new Y6(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((l,u)=>this.configureComponent(`connection-encryption-${u}`,l(this.components))),streamMuxers:(e.streamMuxers??[]).map((l,u)=>this.configureComponent(`stream-muxers-${u}`,l(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new q6(this.components,e.transportManager)),this.configureComponent("connectionManager",new F6(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new U6(this.components,e.connectionMonitor)),this.configureComponent("registrar",new z6(this.components)),this.configureComponent("addressManager",new y6(this.components,e.addresses));let a=(e.peerRouters??[]).map((l,u)=>this.configureComponent(`peer-router-${u}`,l(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new H6(this.components,{routers:a}));let c=(e.contentRouters??[]).map((l,u)=>this.configureComponent(`content-router-${u}`,l(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new V6(this.components,{routers:c})),this.configureComponent("randomWalk",new $6(this.components)),(e.peerDiscovery??[]).forEach((l,u)=>{this.configureComponent(`peer-discovery-${u}`,l(this.components)).addEventListener("peer",h=>{this.#e(h)})}),e.transports?.forEach((l,u)=>{this.components.transportManager.add(this.configureComponent(`transport-${u}`,l(this.components)))}),e.services!=null)for(let l of Object.keys(e.services)){let u=e.services[l],d=u(this.components);if(d==null){this.log.error("service factory %s returned null or undefined instance",l);continue}this.services[l]=d,this.configureComponent(l,d),d[Ga]!=null&&(this.log("registering service %s for content routing",l),c.push(d[Ga])),d[Ya]!=null&&(this.log("registering service %s for peer routing",l),a.push(d[Ya])),d[af]!=null&&(this.log("registering service %s for peer discovery",l),d[af].addEventListener?.("peer",h=>{this.#e(h)}))}qK(s)}configureComponent(e,t){return t==null&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}start(){return f(this,null,function*(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{yield this.components.beforeStart?.(),yield this.components.start(),yield this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",yield this.stop(),e}}})}stop(){return f(this,null,function*(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",yield this.components.beforeStop?.(),yield this.components.stop(),yield this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))})}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let e=new Oi;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}dial(n){return f(this,arguments,function*(e,t={}){return this.components.connectionManager.openConnection(e,v({priority:75},t))})}dialProtocol(o,i){return f(this,arguments,function*(e,t,n={}){if(t==null)throw new Y("no protocols were provided to open a stream");if(t=Array.isArray(t)?t:[t],t.length===0)throw new Y("no protocols were provided to open a stream");return(yield this.dial(e,n)).newStream(t,n)})}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}hangUp(n){return f(this,arguments,function*(e,t={}){Pu(e)&&(e=sr(e.getPeerId()??"")),yield this.components.connectionManager.closeConnections(e,t)})}getPublicKey(n){return f(this,arguments,function*(e,t={}){if(this.log("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;try{let a=yield this.peerStore.get(e,t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}let o=zt([Z("/pk/"),e.toMultihash().bytes]),i=yield this.contentRouting.get(o,t),s=Vr(i);return yield this.peerStore.patch(e,{publicKey:s},t),s})}handle(e,t,n){return f(this,null,function*(){Array.isArray(e)||(e=[e]),yield Promise.all(e.map(o=>f(this,null,function*(){yield this.components.registrar.handle(o,t,n)})))})}unhandle(e,t){return f(this,null,function*(){Array.isArray(e)||(e=[e]),yield Promise.all(e.map(n=>f(this,null,function*(){yield this.components.registrar.unhandle(n,t)})))})}register(e,t,n){return f(this,null,function*(){return this.components.registrar.register(e,t,n)})}unregister(e){this.components.registrar.unregister(e)}isDialable(n){return f(this,arguments,function*(e,t={}){return this.components.connectionManager.isDialable(e,t)})}#e(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(n=>{this.log.error(n)})}};function hW(){return f(this,arguments,function*(r={}){r.privateKey??=yield eg("Ed25519");let e=new J6(I(v({},yield _K(r)),{peerId:az(r.privateKey)}));return r.start!==!1&&(yield e.start()),e})}function nP(){let r=ze(),e=!1;return{sink:t=>f(null,null,function*(){if(e)throw new Error("already piped");e=!0,r.resolve(t)}),source:function(){return M(this,null,function*(){let t=yield new S(r.promise);yield*Q(t)})}()}}function mW(){let r=nP(),e=nP();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}var Ng=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function yW(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function e5(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function t5(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function mo(r,...e){if(!yW(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function oP(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function vW(r,e){mo(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function _l(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Cl(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Z0e(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var J0e=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function eye(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function r5(r){if(typeof r=="string")r=eye(r);else if(yW(r))r=n5(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function wW(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function bW(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}var iP=(r,e)=>{function t(n,...o){if(mo(n),!J0e)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let u=o[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?mo(u):mo(u,r.nonceLength)}let i=r.tagLength;i&&o[1]!==void 0&&mo(o[1]);let s=e(n,...o),a=(u,d)=>{if(d!==void 0){if(u!==2)throw new Error("cipher output not supported");mo(d)}},c=!1;return{encrypt(u,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,mo(u),a(s.encrypt.length,d),s.encrypt(u,d)},decrypt(u,d){if(mo(u),i&&u.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(s.decrypt.length,d),s.decrypt(u,d)}}}return Object.assign(t,r),t};function sP(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!tye(e))throw new Error("invalid output, must be aligned");return e}function gW(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function EW(r,e,t){e5(t);let n=new Uint8Array(16),o=Z0e(n);return gW(o,0,BigInt(e),t),gW(o,8,BigInt(r),t),n}function tye(r){return r.byteOffset%4===0}function n5(r){return Uint8Array.from(r)}var SW=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),rye=SW("expand 16-byte k"),nye=SW("expand 32-byte k"),oye=_l(rye),iye=_l(nye);function De(r,e){return r<<e|r>>>32-e}function aP(r){return r.byteOffset%4===0}var o5=64,sye=16,_W=2**32-1,xW=new Uint32Array;function aye(r,e,t,n,o,i,s,a){let c=o.length,l=new Uint8Array(o5),u=_l(l),d=aP(o)&&aP(i),h=d?_l(o):xW,p=d?_l(i):xW;for(let m=0;m<c;s++){if(r(e,t,n,u,s,a),s>=_W)throw new Error("arx: counter overflow");let y=Math.min(o5,c-m);if(d&&y===o5){let b=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let x=0,A;x<sye;x++)A=b+x,p[A]=h[A]^u[x];m+=o5;continue}for(let b=0,x;b<y;b++)x=m+b,i[x]=o[x]^l[b];m+=y}}function cP(r,e){let{allowShortKeys:t,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=wW({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return t5(o),t5(s),e5(i),e5(t),(a,c,l,u,d=0)=>{mo(a),mo(c),mo(l);let h=l.length;if(u===void 0&&(u=new Uint8Array(h)),mo(u),t5(d),d<0||d>=_W)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);let p=[],m=a.length,y,b;if(m===32)p.push(y=n5(a)),b=iye;else if(m===16&&t)y=new Uint8Array(32),y.set(a),y.set(a,16),b=oye,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);aP(c)||p.push(c=n5(c));let x=_l(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(b,x,_l(c.subarray(0,16)),x),c=c.subarray(16)}let A=16-o;if(A!==c.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){let L=new Uint8Array(12);L.set(c,i?0:12-c.length),c=L,p.push(c)}let P=_l(c);return aye(r,b,x,P,l,u,d,s),Cl(...p),u}}var Hn=(r,e)=>r[e++]&255|(r[e++]&255)<<8,lP=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=r5(e),mo(e,32);let t=Hn(e,0),n=Hn(e,2),o=Hn(e,4),i=Hn(e,6),s=Hn(e,8),a=Hn(e,10),c=Hn(e,12),l=Hn(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Hn(e,16+2*u)}process(e,t,n=!1){let o=n?0:2048,{h:i,r:s}=this,a=s[0],c=s[1],l=s[2],u=s[3],d=s[4],h=s[5],p=s[6],m=s[7],y=s[8],b=s[9],x=Hn(e,t+0),A=Hn(e,t+2),P=Hn(e,t+4),L=Hn(e,t+6),F=Hn(e,t+8),W=Hn(e,t+10),H=Hn(e,t+12),U=Hn(e,t+14),T=i[0]+(x&8191),k=i[1]+((x>>>13|A<<3)&8191),N=i[2]+((A>>>10|P<<6)&8191),j=i[3]+((P>>>7|L<<9)&8191),V=i[4]+((L>>>4|F<<12)&8191),X=i[5]+(F>>>1&8191),G=i[6]+((F>>>14|W<<2)&8191),J=i[7]+((W>>>11|H<<5)&8191),ae=i[8]+((H>>>8|U<<8)&8191),de=i[9]+(U>>>5|o),le=0,Ne=le+T*a+k*(5*b)+N*(5*y)+j*(5*m)+V*(5*p);le=Ne>>>13,Ne&=8191,Ne+=X*(5*h)+G*(5*d)+J*(5*u)+ae*(5*l)+de*(5*c),le+=Ne>>>13,Ne&=8191;let xe=le+T*c+k*a+N*(5*b)+j*(5*y)+V*(5*m);le=xe>>>13,xe&=8191,xe+=X*(5*p)+G*(5*h)+J*(5*d)+ae*(5*u)+de*(5*l),le+=xe>>>13,xe&=8191;let se=le+T*l+k*c+N*a+j*(5*b)+V*(5*y);le=se>>>13,se&=8191,se+=X*(5*m)+G*(5*p)+J*(5*h)+ae*(5*d)+de*(5*u),le+=se>>>13,se&=8191;let ft=le+T*u+k*l+N*c+j*a+V*(5*b);le=ft>>>13,ft&=8191,ft+=X*(5*y)+G*(5*m)+J*(5*p)+ae*(5*h)+de*(5*d),le+=ft>>>13,ft&=8191;let jt=le+T*d+k*u+N*l+j*c+V*a;le=jt>>>13,jt&=8191,jt+=X*(5*b)+G*(5*y)+J*(5*m)+ae*(5*p)+de*(5*h),le+=jt>>>13,jt&=8191;let Le=le+T*h+k*d+N*u+j*l+V*c;le=Le>>>13,Le&=8191,Le+=X*a+G*(5*b)+J*(5*y)+ae*(5*m)+de*(5*p),le+=Le>>>13,Le&=8191;let Xt=le+T*p+k*h+N*d+j*u+V*l;le=Xt>>>13,Xt&=8191,Xt+=X*c+G*a+J*(5*b)+ae*(5*y)+de*(5*m),le+=Xt>>>13,Xt&=8191;let Xn=le+T*m+k*p+N*h+j*d+V*u;le=Xn>>>13,Xn&=8191,Xn+=X*l+G*c+J*a+ae*(5*b)+de*(5*y),le+=Xn>>>13,Xn&=8191;let nn=le+T*y+k*m+N*p+j*h+V*d;le=nn>>>13,nn&=8191,nn+=X*u+G*l+J*c+ae*a+de*(5*b),le+=nn>>>13,nn&=8191;let on=le+T*b+k*y+N*m+j*p+V*h;le=on>>>13,on&=8191,on+=X*d+G*u+J*l+ae*c+de*a,le+=on>>>13,on&=8191,le=(le<<2)+le|0,le=le+Ne|0,Ne=le&8191,le=le>>>13,xe+=le,i[0]=Ne,i[1]=xe,i[2]=se,i[3]=ft,i[4]=jt,i[5]=Le,i[6]=Xt,i[7]=Xn,i[8]=nn,i[9]=on}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,n[0]=e[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(o^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535;Cl(n)}update(e){oP(this),e=r5(e),mo(e);let{buffer:t,blockLen:n}=this,o=e.length;for(let i=0;i<o;){let s=Math.min(n-this.pos,o-i);if(s===n){for(;n<=o-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Cl(this.h,this.r,this.buffer,this.pad)}digestInto(e){oP(this),vW(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=n[s]>>>0,e[i++]=n[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function cye(r){let e=(n,o)=>r(o).update(r5(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var CW=cye(r=>new lP(r));function DW(r,e,t,n,o,i=20){let s=r[0],a=r[1],c=r[2],l=r[3],u=e[0],d=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],x=e[7],A=o,P=t[0],L=t[1],F=t[2],W=s,H=a,U=c,T=l,k=u,N=d,j=h,V=p,X=m,G=y,J=b,ae=x,de=A,le=P,Ne=L,xe=F;for(let ft=0;ft<i;ft+=2)W=W+k|0,de=De(de^W,16),X=X+de|0,k=De(k^X,12),W=W+k|0,de=De(de^W,8),X=X+de|0,k=De(k^X,7),H=H+N|0,le=De(le^H,16),G=G+le|0,N=De(N^G,12),H=H+N|0,le=De(le^H,8),G=G+le|0,N=De(N^G,7),U=U+j|0,Ne=De(Ne^U,16),J=J+Ne|0,j=De(j^J,12),U=U+j|0,Ne=De(Ne^U,8),J=J+Ne|0,j=De(j^J,7),T=T+V|0,xe=De(xe^T,16),ae=ae+xe|0,V=De(V^ae,12),T=T+V|0,xe=De(xe^T,8),ae=ae+xe|0,V=De(V^ae,7),W=W+N|0,xe=De(xe^W,16),J=J+xe|0,N=De(N^J,12),W=W+N|0,xe=De(xe^W,8),J=J+xe|0,N=De(N^J,7),H=H+j|0,de=De(de^H,16),ae=ae+de|0,j=De(j^ae,12),H=H+j|0,de=De(de^H,8),ae=ae+de|0,j=De(j^ae,7),U=U+V|0,le=De(le^U,16),X=X+le|0,V=De(V^X,12),U=U+V|0,le=De(le^U,8),X=X+le|0,V=De(V^X,7),T=T+k|0,Ne=De(Ne^T,16),G=G+Ne|0,k=De(k^G,12),T=T+k|0,Ne=De(Ne^T,8),G=G+Ne|0,k=De(k^G,7);let se=0;n[se++]=s+W|0,n[se++]=a+H|0,n[se++]=c+U|0,n[se++]=l+T|0,n[se++]=u+k|0,n[se++]=d+N|0,n[se++]=h+j|0,n[se++]=p+V|0,n[se++]=m+X|0,n[se++]=y+G|0,n[se++]=b+J|0,n[se++]=x+ae|0,n[se++]=A+de|0,n[se++]=P+le|0,n[se++]=L+Ne|0,n[se++]=F+xe|0}function lye(r,e,t,n){let o=r[0],i=r[1],s=r[2],a=r[3],c=e[0],l=e[1],u=e[2],d=e[3],h=e[4],p=e[5],m=e[6],y=e[7],b=t[0],x=t[1],A=t[2],P=t[3];for(let F=0;F<20;F+=2)o=o+c|0,b=De(b^o,16),h=h+b|0,c=De(c^h,12),o=o+c|0,b=De(b^o,8),h=h+b|0,c=De(c^h,7),i=i+l|0,x=De(x^i,16),p=p+x|0,l=De(l^p,12),i=i+l|0,x=De(x^i,8),p=p+x|0,l=De(l^p,7),s=s+u|0,A=De(A^s,16),m=m+A|0,u=De(u^m,12),s=s+u|0,A=De(A^s,8),m=m+A|0,u=De(u^m,7),a=a+d|0,P=De(P^a,16),y=y+P|0,d=De(d^y,12),a=a+d|0,P=De(P^a,8),y=y+P|0,d=De(d^y,7),o=o+l|0,P=De(P^o,16),m=m+P|0,l=De(l^m,12),o=o+l|0,P=De(P^o,8),m=m+P|0,l=De(l^m,7),i=i+u|0,b=De(b^i,16),y=y+b|0,u=De(u^y,12),i=i+u|0,b=De(b^i,8),y=y+b|0,u=De(u^y,7),s=s+d|0,x=De(x^s,16),h=h+x|0,d=De(d^h,12),s=s+d|0,x=De(x^s,8),h=h+x|0,d=De(d^h,7),a=a+c|0,A=De(A^a,16),p=p+A|0,c=De(c^p,12),a=a+c|0,A=De(A^a,8),p=p+A|0,c=De(c^p,7);let L=0;n[L++]=o,n[L++]=i,n[L++]=s,n[L++]=a,n[L++]=b,n[L++]=x,n[L++]=A,n[L++]=P}var uye=cP(DW,{counterRight:!1,counterLength:4,allowShortKeys:!1}),dye=cP(DW,{counterRight:!1,counterLength:8,extendNonceFn:lye,allowShortKeys:!1});var fye=new Uint8Array(16),IW=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(fye.subarray(t))},pye=new Uint8Array(32);function AW(r,e,t,n,o){let i=r(e,t,pye),s=CW.create(i);o&&IW(s,o),IW(s,n);let a=EW(n.length,o?o.length:0,!0);s.update(a);let c=s.digest();return Cl(i,a),c}var TW=r=>(e,t,n)=>({encrypt(i,s){let a=i.length;s=sP(a+16,s,!1),s.set(i);let c=s.subarray(0,-16);r(e,t,c,c,1);let l=AW(r,e,t,c,n);return s.set(l,a),Cl(l),s},decrypt(i,s){s=sP(i.length-16,s,!1);let a=i.subarray(0,-16),c=i.subarray(-16),l=AW(r,e,t,a,n);if(!bW(c,l))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),r(e,t,s,s,1),Cl(l),s}}),uP=iP({blockSize:64,nonceLength:12,tagLength:16},TW(uye)),Tat=iP({blockSize:64,nonceLength:24,tagLength:16},TW(dye));function MW(r,e,t){return bf(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Iu(r,bu(t),bu(e))}var dP=Uint8Array.from([0]),PW=Uint8Array.of();function kW(r,e,t,n=32){bf(r),ea(n);let o=r.outputLen;if(n>255*o)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(n/o);t===void 0&&(t=PW);let s=new Uint8Array(i*o),a=Iu.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)dP[0]=u+1,c.update(u===0?PW:l).update(t).update(dP).digestInto(l),s.set(l,o*u),a._cloneInto(c);return a.destroy(),c.destroy(),ao(l,dP),s.slice(0,n)}var fP={hashSHA256(r){return oc(r.subarray())},getHKDF(r,e){let t=MW(oc,e,r),o=kW(oc,t,void 0,96),i=o.subarray(0,32),s=o.subarray(32,64),a=o.subarray(64,96);return[i,s,a]},generateX25519KeyPair(){let r=Wy.utils.randomPrivateKey();return{publicKey:Wy.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Wy.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Wy.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return uP(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,o){return uP(n,e,t).decrypt(r.subarray(),o)}};var RW=fP;function NW(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var Og=r=>{let e=wr(2);return e[0]=r>>8,e[1]=r,e};Og.bytes=2;var Q2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};Q2.bytes=2;function OW(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function pP(r,e){!e.enabled||!Ng||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${te(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${te(r.privateKey,"hex")}`)):e("Missing local static keys."))}function hP(r,e){!e.enabled||!Ng||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${te(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${te(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function LW(r,e){!e.enabled||!Ng||e(r?`REMOTE_STATIC_PUBLIC_KEY ${te(r.subarray(),"hex")}`:"Missing remote static public key.")}function mP(r,e){!e.enabled||!Ng||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${te(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function gP(r,e,t){!t.enabled||!Ng||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&te(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&te(e.k,"hex")}`))}function wa(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=wr(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}var i5=(()=>{class r extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}return r})();var hye=0,mye=4294967295,gye="Cipherstate has reached maximum n, a new handshake must be performed",s5=class{n;bytes;view;constructor(e=hye){this.n=e,this.bytes=Qe(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>mye)throw new Error(gye)}};var bp=Qe(0),Lg=class{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new s5(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();let o=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),o}},yP=class{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let n=Z(t,"utf-8");this.h=yye(e,n),this.ck=this.h,this.cs=new Lg(e)}mixKey(e){let[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new Lg(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Ve(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,bp);return[new Lg(this.crypto,e),new Lg(this.crypto,t)]}},vP=class{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:n,prologue:o,initiator:i,s,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new yP(t,n),this.ss.mixHash(o),this.initiator=i,this.s=s,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");let o=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},Z2=class extends vP{writeMessageA(e){return new Ve(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new Ve(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new Ve(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new i5(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new i5(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new i5(`handshake stage 2 validation fail: ${t.message}`)}}};function yye(r,e){if(e.length<=32){let t=Qe(32);return t.set(e),t}else return r.hash(e)}var a5;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(let i of t.streamMuxers)n.uint32(18),n.string(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={webtransportCerthashes:[],streamMuxers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new qt('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&i.streamMuxers.length===o.limits.streamMuxers)throw new qt('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(a5||(a5={}));var J2;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),a5.codec().encode(t.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={identityKey:Qe(0),identitySig:Qe(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=a5.codec().decode(t,t.uint32(),{limits:o.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(J2||(J2={}));function wP(r,e,t){return f(this,null,function*(){let n=yield r.sign(FW(e));return J2.encode({identityKey:En(r.publicKey),identitySig:n,extensions:t})})}function bP(r,e,t){return f(this,null,function*(){try{let n=J2.decode(r),o=Vr(n.identityKey);if(t?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");let i=FW(e);if(!(yield o.verify(i,n.identitySig)))throw new Error("Invalid payload signature");return n}catch(n){throw new zU(n.message)}})}function FW(r){let e=Z("noise-libp2p-static-key:");return r instanceof Uint8Array?zt([e,r],e.length+r.length):(r.prepend(e),r)}function BW(r,e){return f(this,null,function*(){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,u=yield wP(i,a.publicKey,l),d=new Z2({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:s,s:a});pP(d.s,t),t.trace("Stage 0 - Initiator starting to send first message."),yield n.write(d.writeMessageA(bp),e),t.trace("Stage 0 - Initiator finished sending first message."),hP(d.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");let h=d.readMessageB(yield n.read(e));t.trace("Stage 1 - Initiator received the message."),mP(d.re,t),LW(d.rs,t),t.trace("Initiator going to check remote's signature...");let p=yield bP(h,d.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),yield n.write(d.writeMessageC(u),e),t.trace("Stage 2 - Initiator sent message with signed payload.");let[m,y]=d.ss.split();return gP(m,y,t),{payload:p,encrypt:b=>m.encryptWithAd(bp,b),decrypt:(b,x)=>y.decryptWithAd(bp,b,x)}})}function UW(r,e){return f(this,null,function*(){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,u=yield wP(i,a.publicKey,l),d=new Z2({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:s,s:a});pP(d.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(yield n.read(e)),t.trace("Stage 0 - Responder received first message."),mP(d.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),yield n.write(d.writeMessageB(u),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),hP(d.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");let h=d.readMessageC(yield n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");let p=yield bP(h,d.rs,c),[m,y]=d.ss.split();return gP(m,y,t),{payload:p,encrypt:b=>y.encryptWithAd(bp,b),decrypt:(b,x)=>m.decryptWithAd(bp,b,x)}})}var jW=16;function HW(r,e){return function(t){return M(this,null,function*(){try{for(var n=O(t),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;for(let c=0;c<a.length;c+=65519){let l=c+65519;l>a.length&&(l=a.length);let u;a instanceof Uint8Array?u=r.encrypt(a.subarray(c,l)):u=r.encrypt(a.sublist(c,l)),e?.encryptedPackets.increment(),yield new Ve(Og(u.byteLength),u)}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}}function $W(r,e){return function(t){return M(this,null,function*(){try{for(var n=O(t),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;for(let c=0;c<a.length;c+=65535){let l=c+65535;if(l>a.length&&(l=a.length),l-jW<c)throw new Error("Invalid chunk");let u=a.sublist(c,l),d=a.subarray(c,l-jW);try{let h=r.decrypt(u,d);e?.decryptedPackets.increment(),yield h}catch(h){throw e?.decryptErrors.increment(),h}}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}})}}var c5=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:n,extensions:o,crypto:i,prologueBytes:s}=t,{metrics:a}=e;this.components=e;let c=i??RW;this.crypto=NW(c),this.extensions=v({webtransportCerthashes:[]},o),this.metrics=a?OW(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=s??Qe(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[At]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];secureOutbound(e,t){return f(this,null,function*(){let n=uc(e,{lengthEncoder:Og,lengthDecoder:Q2,maxDataLength:65535}),o=yield this.performHandshakeInitiator(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=yield this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Vr(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:ic(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}})}getStreamMuxer(e){if(e==null||e.length===0)return;let t=this.components.upgrader.getStreamMuxers();if(t!=null)for(let n of e){let o=t.get(n);if(o!=null)return o}if(e.length)throw new qU("Early muxer negotiation was requested but the initiator and responder had no common muxers")}secureInbound(e,t){return f(this,null,function*(){let n=uc(e,{lengthEncoder:Og,lengthDecoder:Q2,maxDataLength:65535}),o=yield this.performHandshakeResponder(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=yield this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Vr(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:ic(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}})}performHandshakeInitiator(e,t,n,o){return f(this,null,function*(){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=yield BW({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:v({streamMuxers:s,webtransportCerthashes:[]},this.extensions)},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i})}performHandshakeResponder(e,t,n,o){return f(this,null,function*(){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=yield UW({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:v({streamMuxers:s,webtransportCerthashes:[]},this.extensions)},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i})}createSecureConnection(e,t){return f(this,null,function*(){let[n,o]=mW(),i=e.unwrap();return yield lr(n,HW(t,this.metrics),i,s=>fl(s,{lengthDecoder:Q2}),$W(t,this.metrics),n),o})}};function l5(r={}){return e=>new c5(e,r)}function u5(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}var Il=(()=>{class r extends Error{static name="InvalidFrameError";constructor(t="The frame was invalid"){super(t),this.name="InvalidFrameError"}}return r})(),d5=(()=>{class r extends Error{static name="UnrequestedPingError";constructor(t="Unrequested ping error"){super(t),this.name="UnrequestedPingError"}}return r})(),f5=(()=>{class r extends Error{static name="NotMatchingPingError";constructor(t="Unrequested ping error"){super(t),this.name="NotMatchingPingError"}}return r})(),zW=(()=>{class r extends Error{static name="InvalidStateError";constructor(t="Invalid state"){super(t),this.name="InvalidStateError"}}return r})(),qW=(()=>{class r extends Error{static name="StreamAlreadyExistsError";constructor(t="Strean already exists"){super(t),this.name="StreamAlreadyExistsError"}}return r})(),KW=(()=>{class r extends Error{static name="DecodeInvalidVersionError";constructor(t="Decode invalid version"){super(t),this.name="DecodeInvalidVersionError"}}return r})(),WW=(()=>{class r extends Error{static name="BothClientsError";constructor(t="Both clients"){super(t),this.name="BothClientsError"}}return r})(),p5=(()=>{class r extends Error{static name="ReceiveWindowExceededError";constructor(t="Receive window exceeded"){super(t),this.name="ReceiveWindowExceededError"}}return r})();var GW=new Set([Il.name,d5.name,f5.name,qW.name,KW.name,WW.name,p5.name]),tv=256*1024,YW=16*1024*1024;var XW={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:tv,maxStreamWindowSize:YW,maxMessageSize:64*1024};function QW(r){if(r.keepAliveInterval<=0)throw new Y("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Y("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Y("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<tv)throw new Y("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Y("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Y("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Y("MaxMessageSize must be greater than a kilobyte")}var jr=function(r){return r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway",r}(jr||{}),br=function(r){return r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST",r}(br||{}),clt=Object.values(br).filter(r=>typeof r!="string"),ZW=0,ba=function(r){return r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError",r}(ba||{}),Fu=12;var JW=2**24;function vye(r){if(r[0]!==ZW)throw new Il("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*JW+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*JW+(r[9]<<16)+(r[10]<<8)+r[11]}}var h5=class{source;buffer;frameInProgress;constructor(e){this.source=wye(e),this.buffer=new Ve,this.frameInProgress=!1}emitFrames(){return M(this,null,function*(){try{for(var e=O(this.source),t,n,o;t=!(n=yield new S(e.next())).done;t=!1){let i=n.value;for(this.buffer.append(i);;){let s=this.readHeader();if(s===void 0)break;let{type:a,length:c}=s;a===jr.Data?(this.frameInProgress=!0,yield{header:s,readData:this.readBytes.bind(this,c)}):yield{header:s}}}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield new S(n.call(e)))}finally{if(o)throw o[0]}}})}readHeader(){if(this.frameInProgress)throw new zW("decoding frame already in progress");if(this.buffer.length<Fu)return;let e=vye(this.buffer.subarray(0,Fu));return this.buffer.consume(Fu),e}readBytes(e){return f(this,null,function*(){if(this.buffer.length<e)try{for(var n=O(this.source),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(this.buffer.append(a),this.buffer.length>=e)break}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}let t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t})}};function wye(r){if(r[Symbol.iterator]!==void 0){let e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){let e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function EP(r){let e=new Uint8Array(Fu);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function eG(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function m5(r,e){let t=u5(r).return?.();eG(t)&&t.catch(n=>{e.error("could not cause iterator to return",n)})}var bye=5e3;function xP(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Bu=class{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=ze(),this.closed=ze(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??bye,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=Xr({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}sink(e){return f(this,null,function*(){if(this.writeStatus!=="ready")throw new py(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let s={signal:this.sinkController.signal};if(this.direction==="outbound"){let c=this.sendNewStream(s);xP(c)&&(yield c)}let a=()=>{m5(e,this.log)};try{this.sinkController.signal.addEventListener("abort",a),this.log.trace("sink reading from source");try{for(var t=O(e),n,o,i;n=!(o=yield t.next()).done;n=!1){let c=o.value;c=c instanceof Uint8Array?new Ve(c):c;let l=this.sendData(c,s);xP(l)&&(this.sendingData=ze(),yield l,this.sendingData.resolve(),this.sendingData=void 0)}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}}finally{this.sinkController.signal.removeEventListener("abort",a)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),yield this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(s){throw this.log.trace("sink ended with error, calling abort with error",s),this.abort(s),s}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}})}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}close(e){return f(this,null,function*(){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",yield lt(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))})}closeRead(){return f(this,arguments,function*(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),yield this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")})}closeWrite(){return f(this,arguments,function*(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),yield lt(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&(yield lt(this.sendingData.promise,e.signal)),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),yield lt(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))})}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();xP(t)&&t.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;let e=new WU("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}};var Ea=function(r){return r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished",r}(Ea||{}),g5=class extends Bu{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super(I(v({},e),{onEnd:t=>{this.state=Ea.Finished,e.onEnd?.(t)}})),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=tv,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=gf(this.source,()=>{this.sendWindowUpdate()})}sendNewStream(){return f(this,null,function*(){})}sendData(n){return f(this,arguments,function*(e,t={}){for(e=e.sublist();e.byteLength!==0;){if(this.sendWindowCapacity===0&&(this.log?.trace("wait for send window capacity, status %s",this.status),yield this.waitForSendWindowCapacity(t),this.status==="closed"||this.status==="aborted"||this.status==="reset")){this.log?.trace("%s while waiting for send window capacity",this.status);return}let o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-Fu,e.length),i=this.getSendFlags();this.sendFrame({type:jr.Data,flag:i,streamID:this._id,length:o},e.sublist(0,o)),this.sendWindowCapacity-=o,e.consume(o)}})}sendReset(){return f(this,null,function*(){this.sendFrame({type:jr.WindowUpdate,flag:br.RST,streamID:this._id,length:0})})}sendCloseWrite(){return f(this,null,function*(){let e=this.getSendFlags()|br.FIN;this.sendFrame({type:jr.WindowUpdate,flag:e,streamID:this._id,length:0})})}sendCloseRead(){return f(this,null,function*(){})}waitForSendWindowCapacity(){return f(this,arguments,function*(e={}){if(this.sendWindowCapacity>0)return;let t,n,o=()=>{this.status==="open"||this.status==="closing"?n(new Mn("Stream aborted")):t()};e.signal?.addEventListener("abort",o);try{yield new Promise((i,s)=>{this.sendWindowCapacityUpdate=()=>{i()},n=s,t=i})}finally{e.signal?.removeEventListener("abort",o)}})}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);let t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,t===0&&e.length>0&&this.sendWindowCapacityUpdate?.()}handleData(e,t){return f(this,null,function*(){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new p5("Receive window exceeded");let n=yield t();this.recvWindowCapacity-=e.length,this.sourcePush(n)})}processFlags(e){(e&br.ACK)===br.ACK&&this.state===Ea.SYNSent&&(this.state=Ea.Established),(e&br.FIN)===br.FIN&&this.remoteCloseWrite(),(e&br.RST)===br.RST&&this.reset()}getSendFlags(){switch(this.state){case Ea.Init:return this.state=Ea.SYNSent,br.SYN;case Ea.SYNReceived:return this.state=Ea.Established,br.ACK;default:return 0}}sendWindowUpdate(){let e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(e===0&&n>-1&&t-this.epochStart<n*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&e===0)return;let o=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:jr.WindowUpdate,flag:e,streamID:this._id,length:o})}};var tG="/yamux/1.0.0",Eye=500,y5=class{protocol=tG;_components;_init;constructor(e,t={}){this._components=e,this._init=t}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[At]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new SP(this._components,v(v({},this._init),e))}},SP=class{protocol=tG;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e,t){this.client=t.direction==="outbound",this.config=v(v({},XW),t),this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),QW(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=Xr({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(n=>{n.destroy()})}}),this.sink=n=>f(this,null,function*(){let o=()=>{let d=u5(n);if(d.return!=null){let h=d.return();xye(h)&&h.catch(p=>{this.log?.("could not cause sink source to return",p)})}},i,s;try{let d=new h5(n);try{this.closeController.signal.addEventListener("abort",o);try{for(var a=O(d.emitFrames()),c,l,u;c=!(l=yield a.next()).done;c=!1){let h=l.value;yield this.handleFrame(h.header,h.readData)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}}finally{this.closeController.signal.removeEventListener("abort",o)}i=ba.NormalTermination}catch(d){GW.has(d.name)?(this.log?.error("protocol error in sink",d),i=ba.ProtocolError):(this.log?.error("internal error in sink",d),i=ba.InternalError),s=d}this.log?.trace("muxer sink ended"),s!=null?this.abort(s,i):yield this.close({reason:i})}),this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(n=>this.log?.error("keepalive error: %s",n)),this.ping().catch(n=>this.log?.error("ping error: %s",n))}get streams(){return Array.from(this._streams.values())}newStream(e){if(this.remoteGoAway!==void 0)throw new pu("Muxer closed remotely");if(this.localGoAway!==void 0)throw new pu("Muxer closed locally");let t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new xm("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",t);let n=this._newStream(t,e,Ea.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}ping(){return f(this,null,function*(){if(this.remoteGoAway!==void 0)throw new pu("Muxer closed remotely");if(this.localGoAway!==void 0)throw new pu("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((o,i)=>{let s=()=>{i(new pu("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",s,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",s),o()}}),resolve:e};let t=Date.now();this.sendPing(this.activePing.id);try{yield this.activePing.promise}finally{delete this.activePing}let n=Date.now();this.rtt=n-t}else yield this.activePing.promise;return this.rtt})}getRTT(){return this.rtt}close(){return f(this,arguments,function*(e={}){if(this.closeController.signal.aborted)return;let t=e?.reason??ba.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),e.signal==null){let n=AbortSignal.timeout(Eye);e=I(v({},e),{signal:n})}try{yield Promise.all([...this._streams.values()].map(n=>f(this,null,function*(){return n.close(e)}))),this.sendGoAway(t),this._closeMuxer()}catch(n){this.abort(n)}})}abort(e,t){if(!this.closeController.signal.aborted){t=t??ba.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(let n of this._streams.values())n.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,o){if(this._streams.get(e)!=null)throw new Y("Stream already exists with that id");let i=new g5({id:e.toString(),name:t,state:n,direction:o,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:this.logger.forComponent(`libp2p:yamux:${o}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}keepAliveLoop(){return f(this,null,function*(){for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{yield lt(new Promise(t=>{e=setTimeout(t,this.config.keepAliveInterval)}),this.closeController.signal),this.ping().catch(t=>this.log?.error("ping error: %s",t))}catch{clearInterval(e);return}}})}handleFrame(e,t){return f(this,null,function*(){let{streamID:n,type:o,length:i}=e;if(this.log?.trace("received frame %o",e),n===0)switch(o){case jr.Ping:{this.handlePing(e);return}case jr.GoAway:{this.handleGoAway(i);return}default:throw new Il("Invalid frame type")}else switch(e.type){case jr.Data:case jr.WindowUpdate:{yield this.handleStreamMessage(e,t);return}default:throw new Il("Invalid frame type")}})}handlePing(e){if(e.flag===br.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,br.ACK);else if(e.flag===br.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Il("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new d5("ping not requested");if(this.activePing.id!==e)throw new f5("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",ba[e]??"unknown"),this.remoteGoAway=e;for(let t of this._streams.values())t.reset();this._closeMuxer()}handleStreamMessage(e,t){return f(this,null,function*(){let{streamID:n,flag:o,type:i}=e;(o&br.SYN)===br.SYN&&this.incomingStream(n);let s=this._streams.get(n);if(s===void 0){if(i===jr.Data){if(this.log?.("discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");yield t()}else this.log?.trace("frame for missing stream id=%s",n);return}switch(i){case jr.WindowUpdate:{s.handleWindowUpdate(e);return}case jr.Data:{if(t===void 0)throw new Error("unreachable");yield s.handleData(e,t);return}default:throw new Error("unreachable")}})}incomingStream(e){if(this.client!==(e%2===0))throw new Y("Both endpoints are clients");if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:jr.WindowUpdate,flag:br.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:jr.WindowUpdate,flag:br.RST,streamID:e,length:0});return}let t=this._newStream(e,void 0,Ea.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===jr.Data){if(t===void 0)throw new Il("Invalid frame");this.source.push(new Ve(EP(e),t))}else this.source.push(EP(e))}sendPing(e,t=br.SYN){t===br.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:jr.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=ba.NormalTermination){this.log?.("sending GoAway reason=%s",ba[e]),this.localGoAway=e,this.sendFrame({type:jr.GoAway,flag:0,streamID:0,length:e})}};function xye(r){return r!=null&&typeof r.then=="function"}function rG(r={}){return e=>new y5(e,r)}function v5(r){try{for(let{code:e,value:t}of r.getComponents())if(t!=null&&e===41)return kz("2000::/3",t)}catch{}return!1}function nG(r,e,t){let n,o,i=!1;function s(){let l={signal:o.signal};if(t?.timeout!=null){let u=Ze([o.signal,AbortSignal.timeout(t.timeout)]);l.signal=u}i=!0,Promise.resolve().then(()=>f(null,null,function*(){yield r(l)})).catch(()=>{}).finally(()=>{i=!1,!o.signal.aborted&&(n=setTimeout(s,e))})}let a=el(s,t?.debounce??100),c=!1;return{setInterval:l=>{e!==l&&(e=l,n!=null&&(clearTimeout(n),n=setTimeout(s,e)))},setTimeout:l=>{t??={},t.timeout=l},run:()=>{i||(clearTimeout(n),a())},start:()=>{c||(c=!0,o=new AbortController,o.signal,t?.runImmediately===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),o?.abort(),c=!1}}}function tr(r,e){let t=uc(r,e),n={read:(o,i)=>f(null,null,function*(){let s=yield t.read(i);return o.decode(s)}),write:(o,i,s)=>f(null,null,function*(){yield t.write(i.encode(o),s)}),writeV:(o,i,s)=>f(null,null,function*(){yield t.writeV(o.map(a=>i.encode(a)),s)}),pb:o=>({read:i=>f(null,null,function*(){return n.read(o,i)}),write:(i,s)=>f(null,null,function*(){return n.write(i,o,s)}),writeV:(i,s)=>f(null,null,function*(){return n.writeV(i,o,s)}),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}var oG="libp2p",iG="autonat",sG="1.0.0";var ar;(function(r){let e;(function(l){l.DIAL="DIAL",l.DIAL_RESPONSE="DIAL_RESPONSE"})(e=r.MessageType||(r.MessageType={}));let t;(function(l){l[l.DIAL=0]="DIAL",l[l.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(t||(t={})),function(l){l.codec=()=>er(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(l){l.OK="OK",l.E_DIAL_ERROR="E_DIAL_ERROR",l.E_DIAL_REFUSED="E_DIAL_REFUSED",l.E_BAD_REQUEST="E_BAD_REQUEST",l.E_INTERNAL_ERROR="E_INTERNAL_ERROR"})(n=r.ResponseStatus||(r.ResponseStatus={}));let o;(function(l){l[l.OK=0]="OK",l[l.E_DIAL_ERROR=100]="E_DIAL_ERROR",l[l.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",l[l.E_BAD_REQUEST=200]="E_BAD_REQUEST",l[l.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(o||(o={})),function(l){l.codec=()=>er(o)}(n=r.ResponseStatus||(r.ResponseStatus={}));let i;(function(l){let u;l.codec=()=>(u==null&&(u=Ue((d,h,p={})=>{if(p.lengthDelimited!==!1&&h.fork(),d.id!=null&&(h.uint32(10),h.bytes(d.id)),d.addrs!=null)for(let m of d.addrs)h.uint32(18),h.bytes(m);p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={addrs:[]},y=h==null?d.len:d.pos+h;for(;d.pos<y;){let b=d.uint32();switch(b>>>3){case 1:{m.id=d.bytes();break}case 2:{if(p.limits?.addrs!=null&&m.addrs.length===p.limits.addrs)throw new qt('Decode error - map field "addrs" had too many elements');m.addrs.push(d.bytes());break}default:{d.skipType(b&7);break}}}return m})),u),l.encode=d=>Be(d,l.codec()),l.decode=(d,h)=>Fe(d,l.codec(),h)})(i=r.PeerInfo||(r.PeerInfo={}));let s;(function(l){let u;l.codec=()=>(u==null&&(u=Ue((d,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),d.peer!=null&&(h.uint32(10),r.PeerInfo.codec().encode(d.peer,h)),p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={},y=h==null?d.len:d.pos+h;for(;d.pos<y;){let b=d.uint32();switch(b>>>3){case 1:{m.peer=r.PeerInfo.codec().decode(d,d.uint32(),{limits:p.limits?.peer});break}default:{d.skipType(b&7);break}}}return m})),u),l.encode=d=>Be(d,l.codec()),l.decode=(d,h)=>Fe(d,l.codec(),h)})(s=r.Dial||(r.Dial={}));let a;(function(l){let u;l.codec=()=>(u==null&&(u=Ue((d,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),d.status!=null&&(h.uint32(8),r.ResponseStatus.codec().encode(d.status,h)),d.statusText!=null&&(h.uint32(18),h.string(d.statusText)),d.addr!=null&&(h.uint32(26),h.bytes(d.addr)),p.lengthDelimited!==!1&&h.ldelim()},(d,h,p={})=>{let m={},y=h==null?d.len:d.pos+h;for(;d.pos<y;){let b=d.uint32();switch(b>>>3){case 1:{m.status=r.ResponseStatus.codec().decode(d);break}case 2:{m.statusText=d.string();break}case 3:{m.addr=d.bytes();break}default:{d.skipType(b&7);break}}}return m})),u),l.encode=d=>Be(d,l.codec()),l.decode=(d,h)=>Fe(d,l.codec(),h)})(a=r.DialResponse||(r.DialResponse={}));let c;r.codec=()=>(c==null&&(c=Ue((l,u,d={})=>{d.lengthDelimited!==!1&&u.fork(),l.type!=null&&(u.uint32(8),r.MessageType.codec().encode(l.type,u)),l.dial!=null&&(u.uint32(18),r.Dial.codec().encode(l.dial,u)),l.dialResponse!=null&&(u.uint32(26),r.DialResponse.codec().encode(l.dialResponse,u)),d.lengthDelimited!==!1&&u.ldelim()},(l,u,d={})=>{let h={},p=u==null?l.len:l.pos+u;for(;l.pos<p;){let m=l.uint32();switch(m>>>3){case 1:{h.type=r.MessageType.codec().decode(l);break}case 2:{h.dial=r.Dial.codec().decode(l,l.uint32(),{limits:d.limits?.dial});break}case 3:{h.dialResponse=r.DialResponse.codec().decode(l,l.uint32(),{limits:d.limits?.dialResponse});break}default:{l.skipType(m&7);break}}}return h})),c),r.encode=l=>Be(l,r.codec()),r.decode=(l,u)=>Fe(l,r.codec(),u)})(ar||(ar={}));var Dye=4,Tye=8,w5=class{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(e,t){this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??oG}/${iG}/${sG}`,this.timeout=t.timeout??3e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??20,this.connectionThreshold=t.connectionThreshold??80,this.maxMessageSize=t.maxMessageSize??8192,this.dialResults=en({name:"libp2p_autonat_dial_results",metrics:e.metrics}),this.findPeers=nG(this.findRandomPeers.bind(this),6e4),this.addressFilter=uo(1024)}[Symbol.toStringTag]="@libp2p/autonat";[At]=["@libp2p/autonat"];get[Ci](){return["@libp2p/identify"]}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(yield this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=yield this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&(yield this.components.registrar.unhandle(this.topologyId)),this.dialResults.clear(),this.findPeers.stop(),this.started=!1})}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}findRandomPeers(e){return f(this,null,function*(){if(this.allAddressesAreVerified())return;let t=Ze([AbortSignal.timeout(1e4),e?.signal]);try{this.log("starting random walk to find peers to run AutoNAT");try{for(var n=O(this.components.randomWalk.walk({signal:t})),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(!(yield this.components.connectionManager.isDialable(a.multiaddrs))){this.log.trace("random peer %p was not dialable %s",a.id,a.multiaddrs.map(c=>c.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",a.id),yield this.components.connectionManager.openConnection(a.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}}catch{}})}handleIncomingAutonatStream(e){return f(this,null,function*(){let t=AbortSignal.timeout(this.timeout);let n=tr(e.stream,{maxDataLength:this.maxMessageSize}).pb(ar);try{let o=yield n.read({signal:t}),i=yield this.handleAutonatMessage(o,e.connection,{signal:t});yield n.write(i,{signal:t}),yield n.unwrap().unwrap().close({signal:t})}catch(o){this.log.error("error handling incoming autonat stream - %e",o),e.stream.abort(o)}})}handleAutonatMessage(e,t,n){return f(this,null,function*(){let o=this.components.addressManager.getAddresses().map(d=>d.toOptions().host),i=e.dial;if(i==null)return this.log.error("dial was missing from message"),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let s,a=i.peer;if(a?.id==null)return this.log.error("PeerId missing from message"),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{let d=Nt(a.id);s=Jr(d)}catch(d){return this.log.error("invalid PeerId - %e",d),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",s),!t.remotePeer.equals(s))return this.log("target peer %p did not equal sending peer %p",s,t.remotePeer),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};let c=a.addrs.map(d=>we(d)).filter(d=>{let h=d.toOptions();return bs(d)?!1:h.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",d,t.remoteAddr),!1):o.includes(h.host)?!1:this.components.transportManager.dialTransportForMultiaddr(d)==null?(this.log.trace("not dialing %a - transport unsupported",d),!1):!0}).map(d=>(d.getPeerId()==null&&(d=d.encapsulate(`/p2p/${s.toString()}`)),d));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",s),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(d=>d.toString()).join(", "),s);let l="",u=c[0];for(let d of c){let h;u=d;try{if(h=yield this.components.connectionManager.openConnection(d,n),!h.remoteAddr.equals(d))throw this.log.error("tried to dial %a but dialed %a",d,h.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",s,d),{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.OK,addr:h.remoteAddr.decapsulateCode(ms("p2p").code).bytes}}}catch(p){this.log.error("could not dial %p - %e",s,p),l=p.message}finally{h!=null&&(yield h.close())}}return{type:ar.MessageType.DIAL_RESPONSE,dialResponse:{status:ar.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:u.bytes}}})}getFirstUnverifiedMultiaddr(e,t){let n=this.components.addressManager.getAddressesWithMetadata().sort((o,i)=>o.type==="observed"&&i.type!=="observed"?1:i.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!v5(o.multiaddr))||bs(o.multiaddr)));for(let o of n){let i=o.multiaddr.toString(),s=this.dialResults.get(i);if(s!=null){if(s.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",s.multiaddr,e);continue}if(s.queue.size>10){this.log.trace("%a already has enough peers queued",s.multiaddr);continue}}if(s==null){let a=o.expires<Date.now();if(a&&this.addressFilter.remove?.(i),this.addressFilter.has(i))continue;this.addressFilter.add(i),this.log.trace("creating dial result %s %s",a?"to revalidate":"for",i),s={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:SD(),queue:new On({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(i,s)}return s}}removeOutdatedMultiaddrResults(){let e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(let t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}verifyExternalAddresses(e){return f(this,null,function*(){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();let n=(yield this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:s})=>s.toOptions().family===6),o=this.getNetworkSegment(e.remoteAddr),i=this.getFirstUnverifiedMultiaddr(o,n);if(i==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){i.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",i.multiaddr),this.confirmAddress(i)):this.log("skipping verifying %a because we are too close to the connection limit",i.multiaddr);return}i.queue.add(s=>f(this,null,function*(){yield this.askPeerToVerify(e,o,s)}),{peerId:e.remotePeer,multiaddr:i.multiaddr}).catch(s=>{i?.result==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,i?.multiaddr,s)})})}askPeerToVerify(e,t,n){return f(this,null,function*(){let o=this.dialResults.get(n.multiaddr.toString());if(o==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}let i=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);let s=yield e.newStream(this.protocol,{signal:i});try{let a=tr(s).pb(ar),[,c]=yield Promise.all([a.write({type:ar.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:i}),a.read({signal:i})]);if(c.type!==ar.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}let l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==ar.ResponseStatus.OK&&l!==ar.ResponseStatus.E_DIAL_ERROR)return;if(o=this.dialResults.get(n.multiaddr.toString()),o==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(o.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(o.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(o.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(o.verifyingPeers.add(e.remotePeer),o.networkSegments.push(t),l===ar.ResponseStatus.OK){if(o.success++,o.type!=="observed"){this.confirmAddress(o);return}}else l===ar.ResponseStatus.E_DIAL_ERROR&&o.failure++;this.log("%a success %d failure %d",o.multiaddr,o.success,o.failure),o.success===Dye&&this.confirmAddress(o),o.failure===Tye&&this.unconfirmAddress(o)}finally{try{yield s.close({signal:i})}catch(a){s.abort(a)}}})}hasConnectionCapacity(){let t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){let t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}};function aG(r={}){return e=>new w5(e,r)}var Pye=_e("dns4"),Mye=_e("dns6"),kye=_e("dnsaddr"),xp=Hr(_e("dns"),kye,Pye,Mye),x5=Hr(_e("ip4"),_e("ip6")),Fg=Hr(Ye(x5,_e("tcp")),Ye(xp,_e("tcp"))),S5=Ye(x5,_e("udp")),Rye=Ye(S5,_e("utp")),Nye=Ye(S5,_e("quic")),Oye=Ye(S5,_e("quic-v1")),_P=Hr(Ye(Fg,_e("ws")),Ye(xp,_e("ws"))),b5=Hr(Ye(_P,_e("p2p")),_P),CP=Hr(Ye(Fg,_e("wss")),Ye(xp,_e("wss")),Ye(Fg,_e("tls"),_e("ws")),Ye(xp,_e("tls"),_e("ws"))),E5=Hr(Ye(CP,_e("p2p")),CP),IP=Hr(Ye(Fg,_e("http")),Ye(x5,_e("http")),Ye(xp,_e("http"))),AP=Hr(Ye(Fg,_e("https")),Ye(x5,_e("https")),Ye(xp,_e("https"))),cG=Ye(S5,_e("webrtc-direct"),_e("certhash")),dG=Hr(Ye(cG,_e("p2p")),cG),lG=Ye(Oye,_e("webtransport"),_e("certhash"),_e("certhash")),fG=Hr(Ye(lG,_e("p2p")),lG),pG=Hr(Ye(b5,_e("p2p-webrtc-star"),_e("p2p")),Ye(E5,_e("p2p-webrtc-star"),_e("p2p")),Ye(b5,_e("p2p-webrtc-star")),Ye(E5,_e("p2p-webrtc-star"))),kut=Hr(Ye(b5,_e("p2p-websocket-star"),_e("p2p")),Ye(E5,_e("p2p-websocket-star"),_e("p2p")),Ye(b5,_e("p2p-websocket-star")),Ye(E5,_e("p2p-websocket-star"))),hG=Hr(Ye(IP,_e("p2p-webrtc-direct"),_e("p2p")),Ye(AP,_e("p2p-webrtc-direct"),_e("p2p")),Ye(IP,_e("p2p-webrtc-direct")),Ye(AP,_e("p2p-webrtc-direct"))),Sp=Hr(_P,CP,IP,AP,pG,hG,Fg,Rye,Nye,xp,dG,fG),Rut=Hr(Ye(Sp,_e("p2p-stardust"),_e("p2p")),Ye(Sp,_e("p2p-stardust"))),Uu=Hr(Ye(Sp,_e("p2p")),pG,hG,dG,fG,_e("p2p")),uG=Hr(Ye(Uu,_e("p2p-circuit"),Uu),Ye(Uu,_e("p2p-circuit")),Ye(_e("p2p-circuit"),Uu),Ye(Sp,_e("p2p-circuit")),Ye(_e("p2p-circuit"),Sp),_e("p2p-circuit")),mG=()=>Hr(Ye(uG,mG),uG),Ep=mG(),gG=Hr(Ye(Ep,Uu,Ep),Ye(Uu,Ep),Ye(Ep,Uu),Ep,Uu);var Nut=Hr(Ye(Ep,_e("webrtc"),_e("p2p")),Ye(Ep,_e("webrtc")),Ye(Sp,_e("webrtc"),_e("p2p")),Ye(Sp,_e("webrtc")),_e("webrtc"));function yG(r){function e(t){let n;try{n=we(t)}catch{return!1}let o=r(n.protoNames());return o===null?!1:o===!0||o===!1?o:o.length===0}return e}function Ye(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(o=>(n=typeof o=="function"?o().partialMatch(t):o.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:yG(e),partialMatch:e}}function Hr(...r){function e(n){let o=null;return r.some(i=>{let s=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return s!=null?(o=s,!0):!1}),o}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:yG(e),partialMatch:e}}function _e(r){let e=r;function t(o){let i;try{i=we(o)}catch{return!1}let s=i.protoNames();return s.length===1&&s[0]===e}function n(o){return o.length===0?null:o[0]===e?o.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var Lye="bootstrap",Fye=50,Bye=1e3,Uye=(()=>{class r extends nt{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??Bye,this.list=[];for(let o of n.list){if(!gG.matches(o)){this.log.error("Invalid multiaddr");continue}let i=we(o),s=i.getPeerId();if(s==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}let a={id:sr(s),multiaddrs:[i]};this.list.push(a)}this._init=n}[af]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[At]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}_discoverBootstrapPeers(){return f(this,null,function*(){if(this.timer!=null)for(let t of this.list){if(yield this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??Lye]:{value:this._init.tagValue??Fye,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}})}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}return r})();function vG(r){return e=>new Uye(e,r)}var DP=1e3,wG=60*DP,bG=290;var zut=2*60*wG,EG=1,_5=2e3,xG=100;var rv=`${du}-circuit-relay`,qut=`${du}-circuit-relay-source`,Kut=2*wG,Wut=BigInt(1<<17),_p="/libp2p/circuit/relay/0.2.0/hop",TP="/libp2p/circuit/relay/0.2.0/stop",Gut=30*DP,Yut=30*DP,PP=300,SG=4096,_G=.001;var Vu;(function(r){let e;(function(o){o.RESERVE="RESERVE",o.CONNECT="CONNECT",o.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.RESERVE=0]="RESERVE",o[o.CONNECT=1]="CONNECT",o[o.STATUS=2]="STATUS"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.peer!=null&&(i.uint32(18),Bg.codec().encode(o.peer,i)),o.reservation!=null&&(i.uint32(26),C5.codec().encode(o.reservation,i)),o.limit!=null&&(i.uint32(34),Ug.codec().encode(o.limit,i)),o.status!=null&&(i.uint32(40),go.codec().encode(o.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.peer=Bg.codec().decode(o,o.uint32(),{limits:s.limits?.peer});break}case 3:{a.reservation=C5.codec().decode(o,o.uint32(),{limits:s.limits?.reservation});break}case 4:{a.limit=Ug.codec().decode(o,o.uint32(),{limits:s.limits?.limit});break}case 5:{a.status=go.codec().decode(o);break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(Vu||(Vu={}));var dc;(function(r){let e;(function(o){o.CONNECT="CONNECT",o.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.CONNECT=0]="CONNECT",o[o.STATUS=1]="STATUS"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.peer!=null&&(i.uint32(18),Bg.codec().encode(o.peer,i)),o.limit!=null&&(i.uint32(26),Ug.codec().encode(o.limit,i)),o.status!=null&&(i.uint32(32),go.codec().encode(o.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.peer=Bg.codec().decode(o,o.uint32(),{limits:s.limits?.peer});break}case 3:{a.limit=Ug.codec().decode(o,o.uint32(),{limits:s.limits?.limit});break}case 4:{a.status=go.codec().decode(o);break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(dc||(dc={}));var Bg;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={id:Qe(0),addrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(o.limits?.addrs!=null&&i.addrs.length===o.limits.addrs)throw new qt('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(Bg||(Bg={}));var C5;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);t.voucher!=null&&(n.uint32(26),A5.codec().encode(t.voucher,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={expire:0n,addrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.expire=t.uint64();break}case 2:{if(o.limits?.addrs!=null&&i.addrs.length===o.limits.addrs)throw new qt('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}case 3:{i.voucher=A5.codec().decode(t,t.uint32(),{limits:o.limits?.voucher});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(C5||(C5={}));var Ug;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.duration=t.uint32();break}case 2:{i.data=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(Ug||(Ug={}));var go=function(r){return r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE",r}(go||{}),CG=function(r){return r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE",r}(CG||{});(function(r){r.codec=()=>er(CG)})(go||(go={}));var I5;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={relay:Qe(0),peer:Qe(0),expiration:0n},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.relay=t.bytes();break}case 2:{i.peer=t.bytes();break}case 3:{i.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(I5||(I5={}));var A5;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),I5.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={publicKey:Qe(0),payloadType:Qe(0),signature:Qe(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=I5.codec().decode(t,t.uint32(),{limits:o.limits?.payload});break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(A5||(A5={}));var MP=(()=>{class r extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}return r})(),IG=(()=>{class r extends Error{static name="DoubleRelayError";name="DoubleRelayError"}return r})(),AG=(()=>{class r extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}return r})();function kP(r){let e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}var nv=class{expires;bytes;constructor(e){e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;let e={};if(this.bytes!=null){let t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){let t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}},D5=Vt(bt(Rx.matchers[0],ut("p2p-circuit"))),T5=Vt(ut("p2p-circuit"));function RP(r){let{stream:e,remoteAddr:t,logger:n,onDataRead:o,onDataWrite:i}=r,s=n.forComponent("libp2p:stream:converter"),a=!1,c=!1,l=e.close.bind(e);e.close=m=>f(null,null,function*(){yield l(m),p(!0)});let u=e.abort.bind(e);e.abort=m=>{u(m),p(!0)};let d=e.sink.bind(e);e.sink=m=>f(null,null,function*(){try{yield d(lr(m,y=>gf(y,b=>i?.(b))))}catch(y){y.type!=="aborted"&&s.error("%s error in sink",t,y)}finally{c=!0,p()}});let h={log:s,sink:e.sink,source:function(){return M(this,null,function*(){try{try{for(var m=O(e.source),y,b,x;y=!(b=yield new S(m.next())).done;y=!1){let A=b.value;o?.(A),yield A}}catch{x=[b]}finally{try{y&&(b=m.return)&&(yield new S(b.call(m)))}finally{if(x)throw x[0]}}}finally{a=!0,p()}})}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function p(m){m===!0&&(a=!0,c=!0),a&&c&&h.timeline.close==null&&(h.timeline.close=Date.now())}return h}var P5=class extends nt{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=e,this.started=!1,this.running=!1,this.filter=t.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}start(){return f(this,null,function*(){this.topologyId=yield this.components.registrar.register(_p,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0})}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(()=>f(this,null,function*(){this.log("searching peer store for relays");let e=yield this.components.peerStore.all({filters:[a=>a.protocols.includes(_p)],orders:[()=>Math.random()<.5?1:-1,(a,c)=>{let l=DG(a),u=DG(c);return l>u?-1:u>l?1:0}]});for(let a of e)this.log.trace("found relay peer %p in peer store",a.id),this.safeDispatchEvent("relay:discover",{detail:a.id});this.log("found %d relay peers in peer store",e.length);let t=this.queue=new On({concurrency:5});this.log("start random walk");try{for(var n=O(this.components.randomWalk.walk({signal:this.discoveryController.signal})),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(this.log.trace("found random peer %p",a.id),t.has(a.id)){this.log.trace("random peer %p was already in queue",a.id);continue}if(this.components.connectionManager.getConnections(a.id)?.length>0){this.log.trace("random peer %p was already connected",a.id);continue}if(!(yield this.components.connectionManager.isDialable(a.multiaddrs))){this.log.trace("random peer %p was not dialable",a.id,a.multiaddrs.map(c=>c.toString()));continue}t.queued>10&&(this.log.trace("wait for space in queue for %p",a.id),yield t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",a.id,t.size,t.running),t.add(this.dialPeer,{peerId:a.id,signal:this.discoveryController.signal}).catch(c=>{this.log.error("error opening connection to random peer %p",a.id,c)})}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}this.log("stop random walk"),yield t.onIdle()})).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(e){this.log.trace("maybe dialing discovered peer %p - %e",e.detail.id),this.maybeDialPeer(e).catch(t=>{this.log.trace("error dialing discovered peer %p - %e",e.detail.id,t)})}maybeDialPeer(e){return f(this,null,function*(){if(this.queue==null)return;let t=e.detail.id,n=e.detail.multiaddrs;if(this.queue.has(t)){this.log.trace("random peer %p was already in queue",t);return}if(this.components.connectionManager.getConnections(t)?.length>0){this.log.trace("random peer %p was already connected",t);return}if(!(yield this.components.connectionManager.isDialable(n))){this.log.trace("random peer %p was not dialable",t);return}this.queue?.add(this.dialPeer,{peerId:e.detail.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to discovered peer %p",e.detail.id,o)})})}dialPeer(n){return f(this,arguments,function*({peerId:e,signal:t}){let o=Ze([AbortSignal.timeout(5e3),t]);try{yield this.components.connectionManager.openConnection(e,{signal:o})}finally{o.clear()}})}};function DG(r){let e=r.metadata.get("last-dial-success");return e==null?0:new Date(te(e)).getTime()}var NP=class extends nt{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??_5,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),this.relay?.equals(e.detail.relay)===!0&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(t=>{this.addressManager.removeObservedAddr(t)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{let{details:t}=e.detail;t.type!=="configured"&&t.id===this.reservationId&&this.addedRelay(e.detail)};listen(e){return f(this,null,function*(){if(T5.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(D5.exactMatch(e)){this.log("listen on specific relay server %a",e);let t=AbortSignal.timeout(this.listenTimeout);let n=e.decapsulate("/p2p-circuit"),o=yield this.connectionManager.openConnection(n,{signal:t});if(!this.reservationStore.hasReservation(o.remotePeer)){this.log("making reservation on peer %p",o.remotePeer);let i=yield this.reservationStore.addRelay(o.remotePeer,"configured");this.addedRelay(i)}}else throw new hy(`Could not listen on p2p-circuit address "${e}"`)})}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}close(){return f(this,null,function*(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(t=>we(t).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(t=>{this.addressManager.confirmObservedAddr(t,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}};function TG(r){return new NP(r)}var PG="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var MG=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=PG[t[r]&63];return e};var Vye=60*1e3*10,jye=60*1e3*5,Hye=30*1e3,M5=class extends nt{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new fo,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??xG,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??_5,this.started=!1,this.relayFilter=uo(100),this.reserveQueue=new On({concurrency:t?.reservationConcurrency??EG,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",n=>{[...this.reservations.values()].find(i=>i.connection===n.detail.id)!=null&&this.#t(n.detail.remotePeer).catch(i=>{this.log("could not remove relay %p - %e",n.detail,i)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(()=>f(this,null,function*(){let e=yield this.peerStore.all({filters:[t=>t.tags.has(rv)]});this.log("removing tag from %d old relays",e.length),yield Promise.all(e.map(t=>f(this,null,function*(){yield this.peerStore.merge(t.id,{tags:{[rv]:void 0}})}))),this.log("redialing %d old relays",e.length),yield Promise.all(e.map(t=>f(this,null,function*(){return this.addRelay(t.id,"discovered")}))),this.#r()})).catch(e=>{this.log.error(e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){let e=MG();return this.pendingReservations.push(e),this.#r(),e}addRelay(e,t){return f(this,null,function*(){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new hy("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new AG("The reservation queue is full");let n=this.reserveQueue.find(e);if(n!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",e),n.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new hy("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(()=>f(this,null,function*(){let o=Date.now();try{let i=this.reservations.get(e);if(i!=null){let m=this.connectionManager.getConnections(e),y=!1;if(m.length===0&&this.log("already have relay reservation with %p but we are no longer connected",e),m.map(b=>b.id).includes(i.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),y=!0),y&&kP(i.reservation.expire)>Vye)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:i};yield this.#t(e)}if(t==="discovered"&&this.pendingReservations.length===0)throw new MP("Not making reservation on discovered relay because we do not need any more relays");let s=AbortSignal.timeout(this.reservationCompletionTimeout);let a=yield this.connectionManager.openConnection(e,{signal:s});if(Zo.matches(a.remoteAddr))throw new IG("not creating reservation over relayed connection");let c=yield this.#e(a,{signal:s}),l=kP(c.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+l).toString());let u=Math.min(Math.max(l-jye,Hye),Math.pow(2,31)-1),d=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(m=>f(this,null,function*(){this.log.error("could not refresh reservation to relay %p - %e",e,m),yield this.#t(e)})).catch(m=>{this.log.error("could not remove expired reservation to relay %p - %e",e,m)})},u),h;if(t==="discovered"){let m=this.pendingReservations.pop();if(m==null)throw new MP("Made reservation on relay but did not need any more discovered relays");h={timeout:d,reservation:c,type:t,connection:a.id,id:m}}else h={timeout:d,reservation:c,type:t,connection:a.id};this.reservations.set(e,h),yield this.peerStore.merge(e,{tags:{[rv]:{value:1,ttl:l}}}),this.#r();let p={relay:e,details:h};return this.safeDispatchEvent("relay:created-reservation",{detail:p}),p}catch(i){throw t==="discovered"&&i.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-o,i),(i.name==="DialError"||i.name==="UnsupportedProtocolError")&&this.relayFilter.add(e.toMultihash().bytes),this.#t(e).catch(s=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,s)}),i}}),{peerId:e})})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return e==null?this.reservations.size:[...this.reservations.values()].reduce((t,n)=>(n.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}#e(e,t){return f(this,null,function*(){t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);let n=yield e.newStream(_p,t),i=tr(n).pb(Vu);this.log.trace("send RESERVE to %p",e.remotePeer),yield i.write({type:Vu.Type.RESERVE},t);let s;try{this.log.trace("reading response from %p",e.remotePeer),s=yield i.read(t)}catch(c){throw n.abort(c),c}finally{n.status!=="closed"&&(yield n.close(t))}if(this.log.trace("read response %o",s),s.status===go.OK&&s.reservation!=null){let c=new Set;c.add(e.remoteAddr.toString());for(let l of s.reservation.addrs){let u=we(l);u.getPeerId()==null&&(u=u.encapsulate(`/p2p/${e.remotePeer}`)),u=we(u.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),c.add(u.toString())}return s.reservation.addrs=[...c].map(l=>we(l).bytes),s.reservation}let a=`reservation failed with status ${s.status??"undefined"}`;throw this.log.error(a),new Error(a)})}#t(e){return f(this,null,function*(){let t=this.reservations.get(e);t!=null&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),t.type==="discovered"&&this.pendingReservations.push(t.id),yield this.peerStore.merge(e,{tags:{[rv]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#r())})}#r(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=uo(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}};var $ye=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(we)}catch{return!1}return!0},kG={maxInboundStopStreams:PP,maxOutboundStopStreams:PP,stopTimeout:3e4},k5=class{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??kG.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??kG.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new P5(e,{filter:t.discoveryFilter??_D(SG,_G)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(o=>{o.name!=="HadEnoughRelaysError"&&o.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,o)})}),this.reservationStore=new M5(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[At]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[Ci](){return this.discovery!=null?["@libp2p/identify"]:[]}[fu]=!0;isStarted(){return this.started}start(){return f(this,null,function*(){this.shutdownController=new AbortController,this.shutdownController.signal,yield this.registrar.handle(TP,e=>{let t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),yield kn(this.discovery,this.reservationStore),this.started=!0})}stop(){return f(this,null,function*(){this.shutdownController.abort(),yield oo(this.discovery,this.reservationStore),yield this.registrar.unhandle(TP),this.started=!1})}dial(e,t){return f(this,null,function*(){if(e.protoCodes().filter(p=>p===bG).length!==1){let p="Invalid circuit relay address";throw this.log.error(p,e),new uf(p)}let n=e.toString().split("/p2p-circuit"),o=we(n[0]),i=we(n[n.length-1]),s=o.getPeerId(),a=i.getPeerId();if(s==null||a==null){let p=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${p}`),new uf(`C${p}`)}let c=sr(s),l=sr(a),d=this.connectionManager.getConnections(c)[0];d==null?(yield this.peerStore.merge(c,{multiaddrs:[o]}),t.onProgress?.(new fe("circuit-relay:open-connection")),d=yield this.connectionManager.openConnection(c,t)):t.onProgress?.(new fe("circuit-relay:reuse-connection"));let h;try{t.onProgress?.(new fe("circuit-relay:open-hop-stream")),h=yield d.newStream(_p,t);let p=tr(h),m=p.pb(Vu);t.onProgress?.(new fe("circuit-relay:write-connect-message")),yield m.write({type:Vu.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[we(i).bytes]}},t),t.onProgress?.(new fe("circuit-relay:read-connect-response"));let y=yield m.read(t);if(y.status!==go.OK)throw new vt(`failed to connect via relay with status ${y?.status?.toString()??"undefined"}`);let b=new nv(y.limit),x=RP({stream:p.unwrap(),remoteAddr:e,localAddr:o.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:b.onData,onDataWrite:b.onData});return this.log("new outbound relayed connection %a",x.remoteAddr),yield this.upgrader.upgradeOutbound(x,I(v({},t),{limits:b.getLimits()}))}catch(p){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,p),h?.abort(p),p}})}createListener(e){return TG({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>D5.exactMatch(t)||T5.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Zo.exactMatch(t))}onStop(o,i){return f(this,arguments,function*({connection:e,stream:t},n){if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),yield this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}let s=tr(t).pb(dc),a=yield s.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,a.type),a?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),yield s.write({type:dc.Type.STATUS,status:go.MALFORMED_MESSAGE},{signal:n}),yield t.close();return}if(a.type!==dc.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),yield s.write({type:dc.Type.STATUS,status:go.UNEXPECTED_MESSAGE},{signal:n}),yield t.close();return}if(!$ye(a)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),yield s.write({type:dc.Type.STATUS,status:go.MALFORMED_MESSAGE},{signal:n}),yield t.close({signal:n});return}let c=Jr(Nt(a.peer.id));if((yield this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,c))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),yield s.write({type:dc.Type.STATUS,status:go.PERMISSION_DENIED},{signal:n}),yield t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),yield s.write({type:dc.Type.STATUS,status:go.OK},{signal:n});let l=new nv(a.limit),u=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${c.toString()}`),d=this.addressManager.getAddresses()[0],h=RP({stream:s.unwrap().unwrap(),remoteAddr:u,localAddr:d,logger:this.logger,onDataRead:l.onData,onDataWrite:l.onData});this.log("new inbound relayed connection %a",h.remoteAddr),yield this.upgrader.upgradeInbound(h,{limits:l.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",h.remoteAddr)})}};function OP(r={}){return e=>new k5(e,r)}var xa;(function(r){let e;(function(o){o.UNUSED="UNUSED",o.CONNECT="CONNECT",o.SYNC="SYNC"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.UNUSED=0]="UNUSED",o[o.CONNECT=100]="CONNECT",o[o.SYNC=300]="SYNC"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.observedAddresses!=null)for(let a of o.observedAddresses)i.uint32(18),i.bytes(a);s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={observedAddresses:[]},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{if(s.limits?.observedAddresses!=null&&a.observedAddresses.length===s.limits.observedAddresses)throw new qt('Decode error - map field "observedAddresses" had too many elements');a.observedAddresses.push(o.bytes());break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(xa||(xa={}));function LP(r,e){return Zo.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:E2.matches(r)?!0:zz.matches(r)?Fo(r.toOptions().host)===!1:!1}var RG=1024*4,NG=100,R5={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1},N5=class{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(e,t){this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??R5.timeout,this.retries=t.retries??R5.retries,this.maxInboundStreams=t.maxInboundStreams??R5.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??R5.maxOutboundStreams}[Symbol.toStringTag]="@libp2p/dcutr";[Ci]=["@libp2p/identify"];isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(this.topologyId=yield this.registrar.register(ov,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{Zo.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),yield this.registrar.handle(ov,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)})}stop(){return f(this,null,function*(){yield this.registrar.unhandle(ov),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1})}upgradeInbound(e){return f(this,null,function*(){if(yield this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){let o={signal:AbortSignal.timeout(this.timeout)};try{t=yield e.newStream([ov],{signal:o.signal,runOnLimitedConnection:!0});let i=tr(t,{maxDataLength:RG}).pb(xa);this.log("B sending connect to %p",e.remotePeer);let s=Date.now();yield i.write({type:xa.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(d=>d.bytes)},o),this.log("B receiving connect from %p",e.remotePeer);let a=yield i.read(o);if(a.type!==xa.Type.CONNECT)throw this.log("A sent wrong message type"),new vt("DCUtR message type was incorrect");let c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new vt("DCUtR connect message had no multiaddrs");let l=Date.now()-s;this.log("A sending sync, rtt %dms",l),yield i.write({type:xa.Type.SYNC,observedAddresses:[]},o),this.log("A waiting for half RTT"),yield P6(l/2),this.log("B dialing",c);let u=yield this.connectionManager.openConnection(c,{signal:o.signal,priority:NG,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,u.remoteAddr),yield e.close(o);break}catch(i){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,i),t?.abort(i),n===this.retries)throw i}finally{t!=null&&(yield t.close(o))}}})}attemptUnilateralConnectionUpgrade(e){return f(this,null,function*(){let n=(yield this.peerStore.get(e.remotePeer)).addresses.map(o=>{let i=o.multiaddr;return i.getPeerId()==null?i.encapsulate(`/p2p/${e.remotePeer}`):i}).filter(o=>LP(o,this.transportManager));if(n.length>0){let o=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);let i=yield this.connectionManager.openConnection(n,{signal:o,force:!0});if(Zo.exactMatch(i.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,i.remoteAddr),yield e.close({signal:o}),!0}catch(i){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,i)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1})}handleIncomingUpgrade(e,t){return f(this,null,function*(){let n={signal:AbortSignal.timeout(this.timeout)};try{let o=tr(e,{maxDataLength:RG}).pb(xa);this.log("A receiving connect");let i=yield o.read(n);if(i.type!==xa.Type.CONNECT)throw this.log("B sent wrong message type"),new vt("DCUtR message type was incorrect");if(i.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new vt("DCUtR connect message had no multiaddrs");let s=this.getDialableMultiaddrs(i.observedAddresses);if(s.length===0)throw this.log("B had no dialable multiaddrs"),new vt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),yield o.write({type:xa.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(yield o.read(n)).type!==xa.Type.SYNC)throw new vt("DCUtR message type was incorrect");this.log("A dialing",s);let c=yield this.connectionManager.openConnection(s,{signal:n.signal,priority:NG,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),yield t.close(n)}catch(o){this.log.error("incoming DCUtR from %p failed",t.remotePeer,o),e.abort(o)}finally{yield e.close(n)}})}getDialableMultiaddrs(e){let t=[];for(let n of e)if(!(n==null||n.length===0))try{let o=we(n);if(!LP(o,this.transportManager))continue;t.push(o)}catch{}return t}};var ov="/libp2p/dcutr";function OG(r={}){return e=>new N5(e,r)}var LG="0.1.0",FG="id",BG="id/push",UG="1.0.0",VG="1.0.0";var ju;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={listenAddrs:[],protocols:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 5:{i.protocolVersion=t.string();break}case 6:{i.agentVersion=t.string();break}case 1:{i.publicKey=t.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&i.listenAddrs.length===o.limits.listenAddrs)throw new qt('Decode error - map field "listenAddrs" had too many elements');i.listenAddrs.push(t.bytes());break}case 4:{i.observedAddr=t.bytes();break}case 3:{if(o.limits?.protocols!=null&&i.protocols.length===o.limits.protocols)throw new qt('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 8:{i.signedPeerRecord=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(ju||(ju={}));var ii={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function jG(r){if(r!=null&&r.length>0)try{return we(r)}catch{}}function Kye(r,e){return e??r.userAgent}function O5(r,e,t,n,o){return f(this,null,function*(){if(t("received identify from %p",n.remotePeer),o==null)throw new vt("message was null or undefined");let i={};if(o.listenAddrs.length>0&&(i.addresses=o.listenAddrs.map(c=>({isCertified:!1,multiaddr:we(c)}))),o.protocols.length>0&&(i.protocols=o.protocols),o.publicKey!=null){let c=Vr(o.publicKey);if(!ic(c).equals(n.remotePeer))throw new vt("public key did not match remote PeerId");i.publicKey=c}let s;if(o.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=o.signedPeerRecord,l=yield ya.openAndCertify(c,Vi.DOMAIN),u=Vi.createFromProtobuf(l.payload),d=la(l.publicKey.toCID());if(!u.peerId.equals(d))throw new vt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new vt("signing key does not match remote PeerId");let h;try{h=yield r.get(u.peerId)}catch(p){if(p.name!=="NotFoundError")throw p}if(h!=null&&(i.metadata=h.metadata,h.peerRecordEnvelope!=null)){let p=ya.createFromProtobuf(h.peerRecordEnvelope),m=Vi.createFromProtobuf(p.payload);m.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,u.seqNumber),u=m,c=h.peerRecordEnvelope)}i.peerRecordEnvelope=c,i.addresses=u.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),s={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,i),yield r.patch(n.remotePeer,i),o.agentVersion!=null||o.protocolVersion!=null){let c={};o.agentVersion!=null&&(c.AgentVersion=Z(o.agentVersion)),o.protocolVersion!=null&&(c.ProtocolVersion=Z(o.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),yield r.merge(n.remotePeer,{metadata:c})}let a={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(c=>we(c)),observedAddr:o.observedAddr==null?void 0:we(o.observedAddr),protocols:o.protocols,signedPeerRecord:s,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a})}var Vg=class{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(e,t){this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??ii.timeout,this.maxInboundStreams=t.maxInboundStreams??ii.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??ii.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??ii.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??ii.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??ii.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??ii.protocolPrefix}/${LG}`,agentVersion:Kye(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}start(){return f(this,null,function*(){this.started||(yield this.peerStore.merge(this.peerId,{metadata:{AgentVersion:Z(this.host.agentVersion),ProtocolVersion:Z(this.host.protocolVersion)}}),yield this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)})}stop(){return f(this,null,function*(){yield this.registrar.unhandle(this.protocol),this.started=!1})}};var L5=class extends Vg{connectionManager;concurrency;_push;constructor(e,t={}){super(e,I(v({},t),{protocol:`/${t.protocolPrefix??ii.protocolPrefix}/${BG}/${VG}`,log:e.logger.forComponent("libp2p:identify-push")})),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??ii.concurrency,this._push=el(this.sendPushMessage.bind(this),t.debounce??1e3),(t.runOnSelfUpdate??ii.runOnSelfUpdate)&&e.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error("error pushing updates to peers - %e",o)})})}[At]=["@libp2p/identify-push"];push(){return f(this,null,function*(){this._push()})}sendPushMessage(){return f(this,null,function*(){if(this.isStarted())try{let e=this.addressManager.getAddresses().map(u=>u.decapsulateCode(ms("p2p").code)),t=new Vi({peerId:this.peerId,multiaddrs:e}),n=yield ya.seal(t,this.privateKey),o=this.registrar.getProtocols(),i=yield this.peerStore.get(this.peerId),s=te(i.metadata.get("AgentVersion")??Z(this.host.agentVersion)),a=te(i.metadata.get("ProtocolVersion")??Z(this.host.protocolVersion)),c=this;function l(){return M(this,null,function*(){for(let u of c.connectionManager.getConnections())(yield new S(c.peerStore.get(u.remotePeer))).protocols.includes(c.protocol)&&(yield()=>f(null,null,function*(){let h,p=AbortSignal.timeout(c.timeout);try{h=yield u.newStream(c.protocol,{signal:p,runOnLimitedConnection:c.runOnLimitedConnection}),yield tr(h,{maxDataLength:c.maxMessageSize}).pb(ju).write({listenAddrs:e.map(y=>y.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:s,protocolVersion:a},{signal:p}),yield h.close({signal:p})}catch(m){c.log.error("could not push identify update to peer",m),h?.abort(m)}}))})}yield Yo(Bo(l(),{concurrency:this.concurrency}))}catch(e){this.log.error("error pushing updates to peers - %e",e)}})}handleProtocol(e){return f(this,null,function*(){let{connection:t,stream:n}=e;try{if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");let o={signal:AbortSignal.timeout(this.timeout)},s=yield tr(n,{maxDataLength:this.maxMessageSize}).pb(ju).read(o);yield n.close(o),yield O5(this.peerStore,this.events,this.log,t,s)}catch(o){this.log.error("received invalid message",o),n.abort(o);return}this.log.trace("handled push from %p",t.remotePeer)})}};var F5=class extends Vg{constructor(e,t={}){super(e,I(v({},t),{protocol:`/${t.protocolPrefix??ii.protocolPrefix}/${FG}/${UG}`,log:e.logger.forComponent("libp2p:identify")})),(t.runOnConnectionOpen??ii.runOnConnectionOpen)&&e.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(i=>{i.name!==lf.name&&this.log.error("error during identify trigged by connection:open",i)})})}[At]=["@libp2p/identify"];_identify(n){return f(this,arguments,function*(e,t={}){let o;if(t.signal==null){let i=AbortSignal.timeout(this.timeout);t=I(v({},t),{signal:i})}try{o=yield e.newStream(this.protocol,I(v({},t),{runOnLimitedConnection:this.runOnLimitedConnection}));let s=yield tr(o,{maxDataLength:this.maxMessageSize}).pb(ju).read(t);return yield o.close(t),s}catch(i){throw o?.abort(i),i}})}identify(n){return f(this,arguments,function*(e,t={}){let o=yield this._identify(e,t),{publicKey:i,protocols:s,observedAddr:a}=o;if(i==null)throw new vt("public key was missing from identify message");let c=Vr(i),l=la(c.toCID());if(!e.remotePeer.equals(l))throw new vt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new vt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,s),O5(this.peerStore,this.events,this.log,e,o)})}maybeAddObservedAddress(e){let t=jG(e);if(t==null)return;if(this.log.trace("our observed address was %a",t),bs(t)){this.log.trace("our observed address was private");return}let n=t.getComponents();if((n[0].code===41||n[0].code===42&&n[1].code===41)&&!v5(t)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Kf.exactMatch(t)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(t))}handleProtocol(e){return f(this,null,function*(){let{connection:t,stream:n}=e,o=AbortSignal.timeout(this.timeout);try{let i=yield this.peerStore.get(this.peerId),s=this.addressManager.getAddresses().map(u=>u.decapsulateCode(ms("p2p").code)),a=i.peerRecordEnvelope;if(s.length>0&&a==null){let u=new Vi({peerId:this.peerId,multiaddrs:s});a=(yield ya.seal(u,this.privateKey)).marshal().subarray()}let c=t.remoteAddr.bytes;$z.matches(t.remoteAddr)||(c=void 0),yield tr(n).pb(ju).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:En(this.privateKey.publicKey),listenAddrs:s.map(u=>u.bytes),signedPeerRecord:a,observedAddr:c,protocols:i.protocols},{signal:o}),yield n.close({signal:o})}catch(i){this.log.error("could not respond to identify request",i),n.abort(i)}})}};function HG(r={}){return e=>new F5(e,r)}function $G(r={}){return e=>new L5(e,r)}var Cp=1e3,FP=60*Cp,iv=60*FP,zG=36*iv,qG="/ipfs/kad/1.0.0",KG=48*iv;var WG=24*iv,GG=10,YG=16384,XG=iv,BP=iv,ypt=10*Cp,QG=10*Cp;var B5=20,Hu=10,ZG=5*FP,JG=Cp,eY=5*Cp,tY=5*FP,rY=30*Cp,nY=180*Cp,UP=`${du}-kad-dht`;var sv;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={key:Qe(0),value:Qe(0),timeReceived:""},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(sv||(sv={}));function oY(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),o=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),s=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${o}:${i}:${s}.${c}Z`}function iY(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),o=parseInt(t[2],10)-1,i=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,o,i,s,a,c,l))}var $n=class r{key;value;timeReceived;constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return sv.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:oY(this.timeReceived)}}static deserialize(e){let t=sv.decode(e);return new r(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=iY(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new r(e.key,e.value,t)}};var $u=class extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}},U5=class extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}},V5=class extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}};var sY;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(sY||(sY={}));var Ft=function(r){return r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING",r}(Ft||{}),VP=function(r){return r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING",r}(VP||{});(function(r){r.codec=()=>er(VP)})(Ft||(Ft={}));var av=function(r){return r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT",r}(av||{}),aY=function(r){return r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT",r}(aY||{});(function(r){r.codec=()=>er(aY)})(av||(av={}));var jg;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(let i of t.multiaddrs)n.uint32(18),n.bytes(i);t.connection!=null&&(n.uint32(24),av.codec().encode(t.connection,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={id:Qe(0),multiaddrs:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(o.limits?.multiaddrs!=null&&i.multiaddrs.length===o.limits.multiaddrs)throw new qt('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=av.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(jg||(jg={}));var zu;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.type!=null&&VP[t.type]!==0&&(n.uint32(8),Ft.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(let i of t.closer)n.uint32(66),jg.codec().encode(i,n);if(t.providers!=null)for(let i of t.providers)n.uint32(74),jg.codec().encode(i,n);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={type:Ft.PUT_VALUE,closer:[],providers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.type=Ft.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(o.limits?.closer!=null&&i.closer.length===o.limits.closer)throw new qt('Decode error - map field "closer" had too many elements');i.closer.push(jg.codec().decode(t,t.uint32(),{limits:o.limits?.closer$}));break}case 9:{if(o.limits?.providers!=null&&i.providers.length===o.limits.providers)throw new qt('Decode error - map field "providers" had too many elements');i.providers.push(jg.codec().decode(t,t.uint32(),{limits:o.limits?.providers$}));break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Be(t,r.codec()),r.decode=(t,n)=>Fe(t,r.codec(),n)})(zu||(zu={}));function jP(r,e={}){let t=I(v({},r),{name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type});return e.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function cv(r,e={}){let t=I(v({},r),{name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]});return e.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function j5(r,e={}){let t=I(v({},r),{name:"FINAL_PEER",type:2});return e.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Sa(r,e={}){let t=I(v({},r),{name:"QUERY_ERROR",type:3});return e.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function HP(r,e={}){let t=I(v({},r),{name:"PROVIDER",type:4});return e.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:t})),t}function lv(r,e={}){let t=I(v({},r),{name:"VALUE",type:5});return e.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:t})),t}function $P(r,e={}){let t=I(v({},r),{name:"DIAL_PEER",type:7});return e.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function cY(r,e={}){let t=I(v({},r),{name:"PATH_ENDED",type:8});return e.onProgress?.(new CustomEvent("kad-dht:query:path-ended",{detail:t})),t}function lY(r,e,t){if(t.length===0)throw new Y("No records given");let o=te(e).split("/");if(o.length<3)throw new Y("Record key does not have a selector function");let i=r[o[1].toString()];if(i==null)throw new V5(`No selector function configured for key type "${o[1]}"`);return t.length===1?0:i(e,t)}function Yye(r,e){return 0}var uY={pk:Yye};function Hg(r,e,t){return f(this,null,function*(){let n=e.key,i=te(n).split("/");if(i.length<3)return;let s=r[i[1].toString()];if(s==null)throw new Y(`No validator available for key type "${i[1]}"`);yield s(n,e.value,t)})}var Xye=(r,e,t)=>f(null,null,function*(){if(!(r instanceof Uint8Array))throw new Y('"key" must be a Uint8Array');if(r.byteLength<5)throw new Y("Invalid public key record");if(te(r.subarray(0,4))!=="/pk/")throw new Y("key was not prefixed with /pk/");let o=Vr(e),i=r.slice(4);if(!Me(i,o.toMultihash().bytes))throw new Y("public key does not match passed in key")}),dY={pk:Xye};var Qye=Z("/pk/");function fY(r){return I(v({},r),{multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let o=Fo(n);return o==null?!0:!o})})}function qu(r,e){return f(this,null,function*(){let t=yield wt.digest(r);return e?.signal?.throwIfAborted(),t.digest})}function si(r,e){return f(this,null,function*(){return qu(r.toMultihash().bytes,e)})}function Ku(r,e){return new Ot(`${r}/${te(e,"base32")}`,!1)}function pY(r){return zt([Qye,r.toMultihash().bytes])}function hY(r){return te(r.subarray(0,4))==="/pk/"}function mY(r){let e=Nt(r.subarray(4));return Jr(e)}function zP(r,e){let t=new Date;return new $n(r,e,t).serialize()}var Zye=290,Jye=54,e2e=55,t2e=56,r2e=4,n2e=41;function gY(r){let e=r.stringTuples();for(let t of e)if(t[0]===Zye)return!1;if(e[0][0]===Jye||e[0][0]===e2e||e[0][0]===t2e)return!0;if(e[0][0]===r2e||e[0][0]===n2e){let t=Fo(`${e[0][1]}`);return t==null||!t}return!1}function H5(r){let e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:ce.createV1(Tr,Nt(Z(n,"base32"))),peerId:sr(t)}}function $5(r,e,t){let n=typeof e=="string"?e:te(e.multihash.bytes,"base32"),o=[r,n];return t!=null&&o.push(t.toString()),new Ot(o.join("/"))}function z5(r){return new Date(oa(r))}function Ip(r,e,t){return function(...n){return M(this,null,function*(){let o=e.queryTime?.timer(t),i=e.errorTime?.timer(t),s=!1;try{e.queries?.increment({[t]:!0}),yield*Q(r(...n))}catch(a){throw s=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),s||o?.()}})}}function q5(r,e,t){return function(...n){return f(this,null,function*(){let o=e?.queryTime?.timer(t),i=e?.errorTime?.timer(t),s=!1;try{return e.queries?.increment({[t]:!0}),yield r(...n)}catch(a){throw s=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),s||o?.()}})}}var K5=class{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){let{validators:n,selectors:o,peerRouting:i,queryManager:s,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=o,this.peerRouting=i,this.queryManager=s,this.network=a,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}getLocal(e,t){return f(this,null,function*(){this.log("getLocal %b",e);let n=Ku(this.datastorePrefix,e);this.log("fetching record for key %k",n);let o=yield this.components.datastore.get(n,t);this.log("found %k in local datastore",n);let i=$n.deserialize(o);return yield Hg(this.validators,i,t),i})}sendCorrectionRecord(e,t,n,o){return M(this,null,function*(){this.log("sendCorrection for %b",e);let i=zP(e,n);for(let{value:u,from:d}of t){if(Me(u,n)){this.log("record was ok");continue}if(this.components.peerId.equals(d)){try{let m=Ku(this.datastorePrefix,e);this.log(`Storing corrected record for key ${m.toString()}`),yield new S(this.components.datastore.put(m,i.subarray(),o))}catch(m){this.log.error("Failed error correcting self",m)}continue}let h=!1,p={type:Ft.PUT_VALUE,key:e,record:i};try{for(var s=O(this.network.sendRequest(d,p,o)),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let m=c.value;m.name==="PEER_RESPONSE"&&m.record!=null&&Me(m.record.value,$n.deserialize(i).value)&&(h=!0),yield m}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}if(!h)throw new $u("Could not send correction");this.log.error("Failed error correcting entry")}})}put(e,t,n){return M(this,null,function*(){this.log("put key %b value %b",e,t);let o=zP(e,t),i=Ku(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),yield new S(this.components.datastore.put(i,o.subarray(),n)),yield*Q(lr(this.peerRouting.getClosestPeers(e,I(v({},n),{signal:n.signal})),s=>_n(s,a=>()=>f(this,null,function*(){if(a.name!=="FINAL_PEER")return[a];let c=[],l={type:Ft.PUT_VALUE,key:e,record:o};this.log("send put to %p",a.peer.id);try{for(var u=O(this.network.sendRequest(a.peer.id,l,I(v({},n),{path:a.path}))),d,h,p;d=!(h=yield u.next()).done;d=!1){let m=h.value;c.push(m),m.name==="PEER_RESPONSE"&&(m.record!=null&&Me(m.record.value,$n.deserialize(o).value)||c.push(Sa({from:a.peer.id,error:new $u("Value not put correctly"),path:m.path},n)))}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield h.call(u))}finally{if(p)throw p[0]}}return c})),s=>Bo(s,{ordered:!1,concurrency:Hu}),function(s){return M(this,null,function*(){try{for(var a=O(s),c,l,u;c=!(l=yield new S(a.next())).done;c=!1){let d=l.value;yield*Q(d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new S(l.call(a)))}finally{if(u)throw u[0]}}})}))})}get(e,t){return M(this,null,function*(){this.log("get %b",e);let n=[];try{for(var a=O(this.getMany(e,t)),c,l,u;c=!(l=yield new S(a.next())).done;c=!1){let d=l.value;if(d.name==="VALUE"){n.push(d);continue}yield d}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new S(l.call(a)))}finally{if(u)throw u[0]}}if(n.length===0)return;let o=n.map(d=>d.value),i=0;try{i=lY(this.selectors,e,o)}catch(d){if(d.name!=="InvalidParametersError")throw d}let s=o[i];if(this.log("GetValue %b %b",e,s),s==null)throw new kt("Best value was not found");yield*Q(this.sendCorrectionRecord(e,n,s,I(v({},t),{path:{index:-1,queued:0,running:0,total:0}}))),yield n[i]})}getMany(n){return M(this,arguments,function*(e,t={}){this.log("getMany values for %b",e);try{let s=yield new S(this.getLocal(e,t));yield lv({value:s.value,from:this.components.peerId,path:{index:-1,running:0,queued:0,total:0}},t)}catch(s){this.log("error getting local value for %b",e,s)}let o=this,i=function(l){return M(this,arguments,function*({peer:s,signal:a,path:c}){try{for(var u=O(o.peerRouting.getValueOrPeers(s.id,e,I(v({},t),{signal:a,path:c}))),d,h,p;d=!(h=yield new S(u.next())).done;d=!1){let m=h.value;yield m,m.name==="PEER_RESPONSE"&&m.record!=null&&(yield lv({from:s.id,value:m.record.value,path:c},t))}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new S(h.call(u)))}finally{if(p)throw p[0]}}})};yield*Q(this.queryManager.run(e,i,t))})}};function yY(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function uv(r){if(r.id==null)throw new Error("Invalid peer in message");let e=Nt(r.id);return{id:Jr(e),multiaddrs:(r.multiaddrs??[]).map(t=>we(t))}}var W5=class{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){let{network:n,peerRouting:o,queryManager:i,routingTable:s,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=o,this.queryManager=i,this.routingTable=s,this.providers=a,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PROVIDER"&&(u.providers??=[],u.providers.push(...l.providers.map(d=>d.id.toString()))),u)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PEER_RESPONSE"&&l.messageName==="ADD_PROVIDER"&&(u.providers??=[],u.providers.push(l.from.toString())),u)})??this.provide}provide(o,i){return M(this,arguments,function*(e,t,n={}){this.log("provide %s",e);let s=e.multihash.bytes;yield new S(this.providers.addProvider(e,this.components.peerId,n));let a={type:Ft.ADD_PROVIDER,key:s,providers:[yY({id:this.components.peerId,multiaddrs:t})]},c=0,l=this;function u(p){return M(this,null,function*(){try{l.log("sending provider record for %s to %p",e,p.peer.id);try{for(var m=O(l.network.sendMessage(p.peer.id,a,I(v({},n),{path:p.path}))),y,b,x;y=!(b=yield new S(m.next())).done;y=!1){let A=b.value;A.name==="PEER_RESPONSE"&&(l.log("sent provider record for %s to %p",e,p.peer.id),c++),yield A}}catch{x=[b]}finally{try{y&&(b=m.return)&&(yield new S(b.call(m)))}finally{if(x)throw x[0]}}}catch(A){l.log.error("error sending provide record to peer %p",p.peer.id,A),yield Sa({from:p.peer.id,error:A,path:p.path},n)}})}let d=Xr({objectMode:!0}),h=new Rn({concurrency:Hu});h.addEventListener("idle",()=>{d.end()}),h.addEventListener("error",p=>{this.log.error("error publishing provider record to peer - %e",p)}),h.add(()=>f(this,null,function*(){let p=[];try{for(var m=O(this.peerRouting.getClosestPeers(s,n)),y,b,x;y=!(b=yield m.next()).done;y=!1){let A=b.value;d.push(A),A.name==="FINAL_PEER"&&p.push(A)}}catch{x=[b]}finally{try{y&&(b=m.return)&&(yield b.call(m))}finally{if(x)throw x[0]}}p.forEach(A=>{h.add(()=>f(this,null,function*(){try{for(var P=O(u(A)),L,F,W;L=!(F=yield P.next()).done;L=!1){let H=F.value;d.push(H)}}catch{W=[F]}finally{try{L&&(F=P.return)&&(yield F.call(P))}finally{if(W)throw W[0]}}})).catch(P=>{this.log.error("error publishing provider record to peer - %e",P)})})})).catch(p=>{d.end(p)}),yield*Q(d),this.log("sent provider records to %d peers",c)})}findProviders(e,t){return M(this,null,function*(){let n=this.routingTable.kBucketSize,o=0,i=e.multihash.bytes,s=this;this.log("findProviders %c",e);let a=yield new S(this.providers.getProviders(e,t));if(a.length>0){let m=[];for(let y of a.slice(0,n))try{let b=yield new S(this.components.peerStore.get(y,t));m.push({id:y,multiaddrs:b.addresses.map(({multiaddr:x})=>x)})}catch(b){if(b.name!=="NotFoundError")throw b;this.log("no peer store entry for %p",y)}if(yield cv({from:this.components.peerId,messageType:Ft.GET_PROVIDERS,providers:m,path:{index:-1,queued:0,running:0,total:0}},t),yield HP({from:this.components.peerId,providers:m,path:{index:-1,queued:0,running:0,total:0}},t),o+=m.length,o>=n)return}let c=function(x){return M(this,arguments,function*({peer:m,signal:y,path:b}){let A={type:Ft.GET_PROVIDERS,key:i};yield*Q(s.network.sendRequest(m.id,A,I(v({},t),{signal:y,path:b})))})},l=new Oi(a);try{for(var u=O(this.queryManager.run(i,c,t)),d,h,p;d=!(h=yield new S(u.next())).done;d=!1){let m=h.value;if(yield m,m.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",m.providers.length,e,m.closer.length);let y=[];for(let b of m.providers)l.has(b.id)||(l.add(b.id),y.push(b));if(y.length>0&&(yield HP({from:m.from,providers:y,path:m.path},t),o+=y.length,o>=n))return}}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new S(h.call(u)))}finally{if(p)throw p[0]}}})}};var G5=class extends nt{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new va(I(v({},t.timeout??{}),{metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`})),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([n,o],i){return I(v({},i),{to:n.toString(),"message type":`${o.type}`})},getAttributesFromYieldedValue:(n,o)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,s)=>{o[`providers-${s}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,s)=>{o[`closer-${s}`]=i.id.toString()})),o)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([n,o],i){return I(v({},i),{to:n.toString(),"message type":`${o.type}`})},getAttributesFromYieldedValue:(n,o)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,s)=>{o[`providers-${s}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,s)=>{o[`closer-${s}`]=i.id.toString()})),o)})??this.sendMessage}start(){return f(this,null,function*(){this.running||(this.running=!0)})}stop(){return f(this,null,function*(){this.running=!1})}isStarted(){return this.running}sendRequest(e,t,n){return M(this,null,function*(){if(!this.running)return;let o=t.type;if(o==null)throw new Y("Message type was missing");let i,s=this.timeout.getTimeoutSignal(n);n=I(v({},n),{signal:s});try{this.metrics.operations?.increment({[o]:!0}),this.log("dialling %p",e),yield $P({peer:e,path:n.path},n);let a=yield new S(this.components.connectionManager.openConnection(e,n));i=yield new S(a.newStream(this.protocol,n)),this.log("sending %s to %p",t.type,e),yield jP({to:e,type:o,path:n.path},n);let c=yield new S(this._writeReadMessage(i,t,n));i.close(n).catch(l=>{this.log.error("error closing stream to %p",e,l),i?.abort(l)}),yield cv({from:e,messageType:c.type,closer:c.closer.map(uv),providers:c.providers.map(uv),record:c.record==null?void 0:$n.deserialize(c.record),path:n.path},n)}catch(a){this.metrics.errors?.increment({[o]:!0}),i?.abort(a),n.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,a),yield Sa({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(s)}})}sendMessage(e,t,n){return M(this,null,function*(){if(!this.running)return;let o=t.type;if(o==null)throw new Y("Message type was missing");let i,s=this.timeout.getTimeoutSignal(n);n=I(v({},n),{signal:s});try{this.metrics.operations?.increment({[o]:!0}),this.log("dialling %p",e),yield $P({peer:e,path:n.path},n);let a=yield new S(this.components.connectionManager.openConnection(e,n));i=yield new S(a.newStream(this.protocol,n)),this.log("sending %s to %p",t.type,e),yield jP({to:e,type:o,path:n.path},n),yield new S(this._writeMessage(i,t,n)),i.close(n).catch(c=>{this.log.error("error closing stream to %p",e,c),i?.abort(c)}),yield cv({from:e,messageType:o,path:n.path},n)}catch(a){this.metrics.errors?.increment({[o]:!0}),i?.abort(a),yield Sa({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(s)}})}_writeMessage(e,t,n){return f(this,null,function*(){yield tr(e).write(t,zu,n)})}_writeReadMessage(e,t,n){return f(this,null,function*(){let o=tr(e);yield o.write(t,zu,n);let i=yield o.read(zu,n);return i.closer.forEach(s=>{this.safeDispatchEvent("peer",{detail:uv(s)})}),i.providers.forEach(s=>{this.safeDispatchEvent("peer",{detail:uv(s)})}),i})}};function Ap(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}var Wu=class{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return[...this.peerDistances]}add(o){return f(this,arguments,function*(e,t={index:-1,queued:0,running:0,total:0},n){let i=yield si(e.id,n);this.addWithKadId(e,i,t)})}addWithKadId(e,t,n={index:-1,queued:0,running:0,total:0}){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;let o={peer:e,distance:wa(this.originDhtKey,t),path:n};if(this.peerDistances.length===this.capacity){let s=this.peerDistances[this.peerDistances.length-1];if(s!=null&&Ap(o.distance,s.distance)!==-1)return}let i=!1;for(let s=0;s<this.peerDistances.length;s++){let a=Ap(this.peerDistances[s].distance,o.distance);if(a===0||a===1){i=!0,this.peerDistances.splice(s,0,o);break}}i||this.peerDistances.push(o),this.peerDistances=this.peerDistances.slice(0,this.capacity)}isCloser(e,t){return f(this,null,function*(){if(this.length===0)return!0;let n=yield si(e,t),o=wa(n,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return Ap(o,i)===-1})}anyCloser(e,t){return f(this,null,function*(){return e.length===0?!1:Promise.any(e.map(n=>f(this,null,function*(){return this.isCloser(n,t)})))})}};var Y5=class{log;routingTable;network;validators;queryManager;components;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}findPeerLocal(e,t){return f(this,null,function*(){let n,o=yield this.routingTable.find(e,t);if(o!=null){this.log("findPeerLocal found %p in routing table",e);try{n=yield this.components.peerStore.get(o,t)}catch(i){if(i.name!=="NotFoundError")throw i}}if(n==null)try{n=yield this.components.peerStore.get(e,t)}catch(i){if(i.name!=="NotFoundError")throw i}if(n!=null)return this.log("findPeerLocal found %p in peer store",e),{id:n.id,multiaddrs:n.addresses.map(i=>i.multiaddr)}})}_getValueSingle(e,t,n){return M(this,null,function*(){let o={type:Ft.GET_VALUE,key:t};yield*Q(this.network.sendRequest(e,o,n))})}getPublicKeyFromNode(n){return M(this,arguments,function*(e,t={}){let o=pY(e),i={index:-1,queued:0,running:0,total:0};try{for(var s=O(this._getValueSingle(e,o,I(v({},t),{path:i}))),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;if(yield u,u.name==="PEER_RESPONSE"&&u.record!=null){let d=Vr(u.record.value),h=ic(d);if(!h.equals(e))throw new cf("public key does not match id");if(h.publicKey==null)throw new cf("public key missing");yield lv({from:e,value:u.record.value,path:i},t)}}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}throw new $u(`Node not responding with its public key: ${e.toString()}`)})}findPeer(n){return M(this,arguments,function*(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){let l=yield new S(this.findPeerLocal(e,t));if(l!=null){this.log("found local"),yield j5({from:this.components.peerId,peer:l,path:{index:-1,queued:0,running:0,total:0}},t);return}}let o=!1;if(t.useNetwork!==!1){let l=this,u=function(m){return M(this,arguments,function*({peer:d,signal:h,path:p}){let y={type:Ft.FIND_NODE,key:e.toMultihash().bytes};try{for(var b=O(l.network.sendRequest(d.id,y,I(v({},t),{signal:h,path:p}))),x,A,P;x=!(A=yield new S(b.next())).done;x=!1){let L=A.value;if(yield L,L.name==="PEER_RESPONSE"){let F=L.closer.find(W=>W.id.equals(e));F!=null&&(yield j5({from:L.from,peer:F,path:L.path},t))}}}catch{P=[A]}finally{try{x&&(A=b.return)&&(yield new S(A.call(b)))}finally{if(P)throw P[0]}}})};try{for(var i=O(this.queryManager.run(e.toMultihash().bytes,u,t)),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let d=a.value;d.name==="FINAL_PEER"&&(o=!0),yield d}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}}if(!o)throw new kt("Not found")})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){this.log("getClosestPeers to %b",e);let o=yield new S(qu(e,t)),i=new Wu(o,this.routingTable.kBucketSize),s=this,a=function(h){return M(this,arguments,function*({peer:c,path:l,peerKadId:u,signal:d}){s.log("getClosestPeers asking %p",c.id);let p={type:Ft.FIND_NODE,key:e};yield*Q(s.network.sendRequest(c.id,p,I(v({},t),{signal:d,path:l}))),i.addWithKadId(c,u,l)})};yield*Q(this.queryManager.run(e,a,t)),this.log("found %d peers close to %b",i.length,e);for(let{peer:c,path:l}of i.peers)try{if(c.multiaddrs.length===0&&(c=yield new S(s.components.peerStore.getInfo(c.id,t))),c.multiaddrs.length===0)continue;yield j5({from:this.components.peerId,peer:yield new S(s.components.peerStore.getInfo(c.id,t)),path:{index:l.index,queued:0,running:0,total:0}},t)}catch{continue}})}getValueOrPeers(e,t,n){return M(this,null,function*(){try{for(var o=O(this._getValueSingle(e,t,n)),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;if(c.name==="PEER_RESPONSE"&&c.record!=null)try{yield new S(this._verifyRecordOnline(c.record,n))}catch{let u="invalid record received, discarded";this.log(u),yield Sa({from:c.from,error:new $u(u),path:n.path},n);continue}yield c}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}_verifyRecordOnline(e,t){return f(this,null,function*(){if(e.timeReceived==null)throw new U5("invalid record received");yield Hg(this.validators,new $n(e.key,e.value,e.timeReceived),t)})}getClosestPeersOffline(e,t){return f(this,null,function*(){let n=[];try{let s=Nt(e),a=Jr(s),c=yield this.components.peerStore.get(a,t);n.push({id:c.id,multiaddrs:c.addresses.map(({multiaddr:l})=>l)})}catch{}let o=yield qu(e,t),i=this.routingTable.closestPeers(o,t);for(let s of i)try{n.push(yield this.components.peerStore.getInfo(s,t))}catch(a){if(a.name!=="NotFoundError")throw a}return n.length>0?this.log("getClosestPeersOffline returning the %d closest peer(s) %b we know",n.length,e):this.log("getClosestPeersOffline could not any peers close to %b with %d peers in the routing table",e,this.routingTable.size),n})}};var X5=class{log;datastore;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore}addProvider(e,t,n){return f(this,null,function*(){this.log.trace("%p provides %s",t,e),yield this.writeProviderEntry(e,t,n)})}removeProvider(e,t,n){return f(this,null,function*(){let o=$5(this.datastorePrefix,e,t);this.log.trace("%p no longer provides %s",t,e),yield this.datastore.delete(o,n)})}getProviders(e,t){return f(this,null,function*(){this.log.trace("get providers for %c",e);let n=yield this.loadProviders(e,t);return this.log.trace("got %d providers for %c",n.size,e),[...n.keys()]})}writeProviderEntry(e,t,n){return f(this,null,function*(){let o=$5(this.datastorePrefix,e,t),i=Sn(n?.time?.getTime()??Date.now());yield this.datastore.put(o,i,n)})}loadProviders(e,t){return f(this,null,function*(){let n=new fo,o=$5(this.datastorePrefix,e);try{for(var i=O(this.datastore.query({prefix:o.toString()},t)),s,a,c;s=!(a=yield i.next()).done;s=!1){let l=a.value;let{peerId:u}=H5(l.key);n.set(u,z5(l.value))}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield a.call(i))}finally{if(c)throw c[0]}}return n})}};var i2e=r=>{let e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function s2e(r,e,t){let n,o=new Promise((i,s)=>{if(t=v({rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1},t),!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();let a=[e].flat(),c=[],{addListener:l,removeListener:u}=i2e(r),d=(...p)=>{let m=t.multiArgs?p:p[0];t.filter&&!t.filter(m)||(c.push(m),t.count===c.length&&(n(),i(c)))},h=p=>{n(),s(p)};n=()=>{for(let p of a)u(p,d);for(let p of t.rejectionEvents)u(p,h)};for(let p of a)l(p,d);for(let p of t.rejectionEvents)l(p,h);t.signal&&t.signal.addEventListener("abort",()=>{h(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(o.cancel=n,typeof t.timeout=="number"){let i=Jc(o,{milliseconds:t.timeout});return i.cancel=n,i}return o}function vY(r,e,t){typeof t=="function"&&(t={filter:t}),t=I(v({},t),{count:1,resolveImmediately:!1});let n=s2e(r,e,t),o=n.then(i=>i[0]);return o.cancel=n.cancel,o}function wY(r){return M(this,null,function*(){let{key:e,startingPeers:t,ourPeerId:n,query:o,alpha:i,path:s,numPaths:a,log:c,peersSeen:l,connectionManager:u,signal:d}=r,h=Xr({objectMode:!0}),p=new Rn({concurrency:i,sort:(b,x)=>Ap(b.options.distance,x.options.distance)});p.addEventListener("idle",()=>{h.push(cY({path:{index:s,queued:p.queued,running:p.running,total:p.size}},r)),h.end()}),p.addEventListener("error",b=>{c.error("error during query - %e",b.detail)});let m=()=>{p.abort(),h.end(new Mn)};d.addEventListener("abort",m);try{let x=function(A,P){if(A==null)return;l.add(A.id.toMultihash().bytes);let L=wa(P,b);p.add(()=>f(null,null,function*(){try{try{for(var F=O(o(I(v({},r),{key:e,peer:A,path:{index:s,queued:p.queued,running:p.running,total:p.size},numPaths:a,peerKadId:P,signal:d}))),W,H,U;W=!(H=yield F.next()).done;W=!1){let T=H.value;if(T.name==="PEER_RESPONSE")for(let k of T.closer){if(l.has(k.id.toMultihash().bytes)){c("already seen %p in query",k.id);continue}if(n.equals(k.id)){c("not querying ourselves");continue}if(!(yield u.isDialable(k.multiaddrs))){c("not querying undialable peer");continue}let N=yield si(k.id,{signal:d}),j=wa(N,b);if(Ap(j,L)!==-1){c("skipping %p as they are not closer to %b than %p",k.id,e,A);continue}c("querying closer peer %p",k.id),x(k,N)}h.push(I(v({},T),{path:{index:s,queued:p.queued,running:p.running,total:p.size}}))}}catch{U=[H]}finally{try{W&&(H=F.return)&&(yield H.call(F))}finally{if(U)throw U[0]}}}catch(T){h.push(Sa({from:A.id,error:T,path:{index:s,queued:p.queued,running:p.running-1,total:p.size-1}},r))}}),{distance:L}).catch(F=>{c.error("error during query - %e",F)})};var y=x;let b=yield new S(qu(e,{signal:d}));yield new S(Promise.all(t.map(A=>f(null,null,function*(){x({id:A,multiaddrs:[]},yield si(A,{signal:d}))})))),yield*Q(h)}finally{d.removeEventListener("abort",m)}})}var Q5=class{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;allowQueryWithZeroPeers;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??B5,this.alpha=t.alpha??Hu,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.allowQueryWithZeroPeers=t.allowQueryWithZeroPeers??!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)})}stop(){return f(this,null,function*(){this.running=!1,this.shutDownController.abort()})}run(o,i){return M(this,arguments,function*(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){let m=AbortSignal.timeout(nY);n=I(v({},n),{signal:m})}let s=new AbortController,a=Ze([this.shutDownController.signal,s.signal,n.signal]);s.signal;let c=this.logger.forComponent(`${this.logPrefix}:query:`+te(e,"base58btc")),l=!1;try{this.routingTable.size===0&&!this.allowQueryWithZeroPeers&&(c("routing table was empty, waiting for some peers before running%s query",n.isSelfQuery===!0?" self":""),yield new S(vY(this.routingTable,"peer:add",{signal:a,filter:P=>!this.peerId.equals(P.detail)})),c("routing table has peers, continuing with%s query",n.isSelfQuery===!0?" self":"")),n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(c("waiting for initial self query before continuing"),yield new S(lt(this.initialQuerySelfHasRun.promise,a)),this.initialQuerySelfHasRun=void 0),c("query:start");let m=yield new S(qu(e,{signal:a})),y=this.routingTable.closestPeers(m,{count:this.routingTable.kBucketSize}),b=y.sort(()=>Math.random()>.5?1:-1).reduce((P,L,F)=>(P[F%this.disjointPaths].push(L),P),new Array(this.disjointPaths).fill(0).map(()=>[])).filter(P=>P.length>0);if(y.length===0){c.error("running query with no peers");return}let x=uo(1024),A=b.map((P,L)=>wY(I(v({},n),{key:e,startingPeers:P,ourPeerId:this.peerId,signal:a,query:t,path:L,numPaths:b.length,alpha:this.alpha,log:c,peersSeen:x,onProgress:n.onProgress,connectionManager:this.connectionManager})));try{for(var u=O(Mo(...A)),d,h,p;d=!(h=yield new S(u.next())).done;d=!1){let P=h.value;if(P.name==="QUERY_ERROR"&&c.error("query error",P.error),P.name==="PEER_RESPONSE")for(let L of[...P.closer,...P.providers])(yield new S(this.connectionManager.isDialable(L.multiaddrs,{signal:a})))&&(yield new S(this.routingTable.add(L.id,{signal:a})));a.throwIfAborted(),yield P}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new S(h.call(u)))}finally{if(p)throw p[0]}}l=!0}catch(m){if(this.running)throw m}finally{l||(c("query exited early"),s.abort()),a.clear(),c("query finished")}})}};function a2e(r){return r[Symbol.asyncIterator]!=null}function c2e(r){if(a2e(r))return f(null,null,function*(){let e=0;try{for(var t=O(r),n,o,i;n=!(o=yield t.next()).done;n=!1){let s=o.value;e++}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}return e});{let e=0;for(let t of r)e++;return e}}var Z5=c2e;var J5=class{log;peerId;peerRouting;events;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.events=e.events,this.running=!1,this.peerRouting=t.peerRouting,this.count=t.count??B5,this.interval=t.interval??ZG,this.initialInterval=t.initialInterval??JG,this.queryTimeout=t.queryTimeout??eY,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=q5(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}querySelf(){return f(this,null,function*(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=ze(),this.running){this.controller=new AbortController;let e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){let n=AbortSignal.timeout(this.queryTimeout);e.push(n)}let t=Ze(e);this.controller.signal;try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let n=Date.now(),o=yield lr(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>Du(s,this.count),s=>f(this,null,function*(){return Z5(s)}));t?.throwIfAborted();let i=Date.now()-n;this.log("self-query found %d peers in %dms",o,i),this.events.dispatchEvent(new CustomEvent("kad-dht:query:self",{detail:{peers:o,duration:i}}))}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))})}};var e8=class extends nt{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new Rn({concurrency:t.concurrency??GG,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new va(I(v({},t.timeout??{}),{metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`})),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??WG,this.maxQueueSize=t.maxQueueSize??YG,this.validity=t.validity??KG,this.interval=t.interval??XG,this.contentRouting=t.contentRouting,this.running=!1,this.reprovide=q5(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(BP)}).catch(e=>{this.log.error("error running reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}cleanUp(e){return f(this,null,function*(){try{this.safeDispatchEvent("reprovide:start");try{for(var t=O(this.datastore.query({prefix:this.datastorePrefix},e)),n,o,i;n=!(o=yield t.next()).done;n=!1){let s=o.value;try{let{cid:a,peerId:c}=H5(s.key),l=z5(s.value).getTime(),u=l+this.validity,d=Date.now(),h=d>u;this.log.trace("comparing: %d < %d = %s %s",l,d-this.validity,h,h?"(expired)":""),h&&(yield this.datastore.delete(s.key,e)),this.peerId.equals(c)&&d-u<this.reprovideThreshold&&this.queueReprovide(a).catch(p=>{this.log.error("could not reprovide %c - %e",a,p)})}catch(a){this.log.error("error processing datastore key %s - %e",s.key,a.message)}}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i[0]}}this.log("reprovide/cleanup successful")}finally{this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(BP)}).catch(s=>{this.log.error("error running re-provide - %e",s)})},this.interval))}})}queueReprovide(e,t){return f(this,null,function*(){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),yield this.reprovideQueue.onSizeLessThan(this.maxQueueSize,t);let n=this.reprovideQueue.queue.find(o=>o.options.cid.equals(e));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",e),n.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(o=>f(this,null,function*(){if(o.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);let i=this.reprovideTimeout.getTimeoutSignal(o);try{yield this.reprovide(o.cid,o)}finally{this.reprovideTimeout.cleanUp(i)}this.log.trace("re-provided %c",e)}),{signal:this.shutdownController?.signal,cid:e}).catch(o=>{this.log.error("could not re-provide key %c - %e",e,o)})})}reprovide(e,t){return f(this,null,function*(){yield Yo(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))})}};var l2e=20,u2e=5e3,d2e="kad-close",f2e=50,t8=class{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??u2e,this.peerSetSize=t.peerSetSize??l2e,this.closeTagName=t.closeTagName??d2e,this.closeTagValue=t.closeTagValue??f2e,this.closestPeers=new Oi,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}start(){return f(this,null,function*(){if(this.running)return;this.running=!0;let e=yield si(this.components.peerId);this.newPeers=new Wu(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)})}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(t=>{this.log.error("error adding peer to distance list - %e",t)})}updatePeerTags(){return f(this,null,function*(){let e=new Oi(this.newPeers?.peers.map(({peer:o})=>o.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,yield Promise.all([...[...t].map(o=>f(this,null,function*(){yield this.components.peerStore.merge(o,{tags:{[this.closeTagName]:{value:this.closeTagValue},[UP]:{value:1}}})})),...[...n].map(o=>f(this,null,function*(){yield this.components.peerStore.merge(o,{tags:{[this.closeTagName]:void 0,[UP]:void 0}})}))])})}};function dv(r){return Array.isArray(r?.peers)}var r8=class{peerId;root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e,t){this.peerId=e.peerId,this.prefixLength=t.prefixLength??bY,this.kBucketSize=t.kBucketSize??fv,this.splitThreshold=t.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=t.numberOfOldContactsToPing??EY,this.lastPingThreshold=t.lastPingThreshold??xY,this.ping=t.ping,this.verify=t.verify,this.onAdd=t.onAdd,this.onRemove=t.onRemove,this.addingPeerMap=pl({name:`${t.metricsPrefix}_adding_peer_map`,metrics:e.metrics}),this.root={prefix:"",depth:0,peers:[]}}start(){return f(this,null,function*(){yield this.addSelfPeer(this.peerId)})}stop(){this.addingPeerMap.clear(),this.root={prefix:"",depth:0,peers:[]}}addSelfPeer(e,t){return f(this,null,function*(){this.localPeer={peerId:e,kadId:yield si(e,t),lastPing:Date.now()}})}add(e,t){return f(this,null,function*(){let n={peerId:e,kadId:yield si(e,t),lastPing:0},o=this.addingPeerMap.get(e);if(o!=null)return o;try{let i=this._add(n,t);this.addingPeerMap.set(e,i),yield i}finally{this.addingPeerMap.delete(e)}})}_add(e,t){return f(this,null,function*(){let n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){yield this._split(n,t),yield this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!h2e(e,this.lastPingThreshold)){n.peers.push(e),yield this.onAdd?.(e,n,t);return}(yield this.verify(e,t))&&(e.lastPing=Date.now(),yield this._add(e,t));return}let o=n.peers.filter(u=>!(u.peerId.equals(this.localPeer?.peerId)||u.lastPing>Date.now()-this.lastPingThreshold)).sort((u,d)=>u.lastPing<d.lastPing?-1:u.lastPing>d.lastPing?1:0).slice(0,this.numberOfNodesToPing),i=!1;try{for(var s=O(this.ping(o,t)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;i=!0,yield this.remove(u.kadId,t)}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}i&&(yield this._add(e,t))})}*closest(e,t){let n=new Wu(e,t?.count??this.kBucketSize);for(let o of this.toIterable())t?.exclude?.some(i=>i.equals(o.peerId))!==!0&&n.addWithKadId({id:o.peerId,multiaddrs:[]},o.kadId);yield*Q(_n(n.peers,({peer:o})=>o.id))}count(){function e(t){if(dv(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){let t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}remove(e,t){return f(this,null,function*(){let n=this._determineBucket(e),o=this._indexOf(n,e);if(o>-1){let i=n.peers.splice(o,1)[0];yield this.onRemove?.(i,n,t)}})}*toIterable(){function*e(t){if(dv(t)){yield*Q(t.peers);return}yield*Q(e(t.left)),yield*Q(e(t.right))}yield*Q(e(this.root))}distance(e,t){return BigInt("0x"+te(wa(e,t),"base16"))}_determineBucket(e){let t=te(e,"base2");function n(o,i=0){return dv(o)?o:t[i]==="0"?n(o.left,i+1):n(o.right,i+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Me(n.kadId,t))}_split(e,t){return f(this,null,function*(){let n={prefix:"0",depth:e.depth+1,peers:[]},o={prefix:"1",depth:e.depth+1,peers:[]};for(let i of e.peers)te(i.kadId,"base2")[e.depth]==="0"?(n.peers.push(i),yield this.onMove?.(i,e,n,t)):(o.peers.push(i),yield this.onMove?.(i,e,o,t));p2e(e,n,o)})}};function p2e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function h2e(r,e){return r.lastPing<Date.now()-e}var fv=20,bY=6;var m2e=20,g2e=100,EY=3;var y2e=20,v2e=100,SY="kad-peer",w2e=1,xY=6e5,b2e=!0,E2e=1e3,n8=class extends nt{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;shutdownController;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??fv,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??SY,this.peerTagValue=t.peerTagValue??w2e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??b2e,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??E2e,this.shutdownController=new AbortController,this.pingOldContactQueue=new On({concurrency:t.pingOldContactConcurrency??y2e,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??v2e}),this.pingOldContactTimeout=new va(I(v({},t.pingOldContactTimeout??{}),{metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`})),this.pingNewContactQueue=new On({concurrency:t.pingNewContactConcurrency??m2e,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??g2e}),this.pingNewContactTimeout=new va(I(v({},t.pingNewContactTimeout??{}),{metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`})),this.kb=new r8(e,{kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved,metricsPrefix:t.metricsPrefix}),this.closestPeerTagger=new t8(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.shutdownController=new AbortController,yield kn(this.closestPeerTagger,this.kb))})}afterStart(){return f(this,null,function*(){let e=0;Promise.resolve().then(()=>f(this,null,function*(){if(!this.populateFromDatastoreOnStart)return;let t=Ze([this.shutdownController.signal,AbortSignal.timeout(2e4)]);try{for(let n of yield this.components.peerStore.all({filters:[o=>o.protocols.includes(this.protocol)&&o.tags.has(SY)],limit:this.populateFromDatastoreLimit,signal:t})){if(!this.running)return;try{yield this.add(n.id,{signal:t}),e++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),yield this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}}finally{t.clear()}this.log("added %d peer store peers to the routing table",e)})).catch(t=>{this.log.error("error adding %d, peer store peers to the routing table - %e",e,t)})})}stop(){return f(this,null,function*(){this.running=!1,yield oo(this.closestPeerTagger,this.kb),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort(),this.shutdownController.abort()})}peerAdded(e,t,n){return f(this,null,function*(){this.components.peerId.equals(e.peerId)||(yield this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}},n)),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})})}peerRemoved(e,t,n){return f(this,null,function*(){this.components.peerId.equals(e.peerId)||(yield this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}},n)),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})})}pingOldContacts(e,t){return M(this,null,function*(){if(!this.running)return;let n=[];for(let c of e){if(this.kb.get(c.kadId)==null){this.log("asked to ping contact %p that was not in routing table",c.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),n.push(()=>f(this,null,function*(){let l=this.pingOldContactQueue.find(c.peerId);if(l!=null)return this.log("asked to ping contact %p was already being pinged",c.peerId),(yield l.join(t))?void 0:c;if(!(yield this.pingOldContactQueue.add(d=>f(this,null,function*(){let h=this.pingOldContactTimeout.getTimeoutSignal(),p=Ze([h,this.shutdownController.signal,d?.signal]);try{return yield this.pingContact(c,d)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(h),p.clear()}}),{peerId:c.peerId,signal:t?.signal})))return c}))}try{for(var o=O(Bo(n)),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;c!=null&&(yield c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}verifyNewContact(e,t){return f(this,null,function*(){let n=this.pingNewContactTimeout.getTimeoutSignal(),o=Ze([n,this.shutdownController.signal,t?.signal]);try{let i=this.pingNewContactQueue.find(e.peerId);return i!=null?(this.log("joining existing ping to add new peer %p to routing table",e.peerId),yield i.join({signal:o})):yield this.pingNewContactQueue.add(s=>f(this,null,function*(){return this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,s)}),{peerId:e.peerId,signal:o})}catch{return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(n),o.clear()}})}pingContact(e,t){return f(this,null,function*(){let n;try{return this.log("pinging contact %p",e.peerId),yield this.components.ping.ping(e.peerId,t),this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0}catch(o){return this.log("error pinging old contact %p - %e",e.peerId,o),n?.abort(o),!1}})}get size(){return this.kb==null?0:this.kb.count()}find(e,t){return f(this,null,function*(){let n=yield si(e,t);return this.kb.get(n)?.peerId})}closestPeer(e){let t=this.closestPeers(e,{count:1});if(t.length>0)return t[0]}closestPeers(e,t){return this.kb==null?[]:[...this.kb.closest(e,t)]}add(e,t){return f(this,null,function*(){if(this.kb==null)throw new Error("RoutingTable is not started");yield this.kb.add(e,t)})}remove(e,t){return f(this,null,function*(){if(this.kb==null)throw new Error("RoutingTable is not started");let n=yield si(e,t);yield this.kb.remove(n,t)})}updateMetrics(){if(this.metrics==null||this.kb==null)return;let e=0,t=0,n=0,o=20,i=0;function s(a){if(dv(a)){a.depth>n&&(n=a.depth),t++,e+=a.peers.length,a.peers.length<o&&(o=a.peers.length),a.peers.length>i&&(i=a.peers.length);return}s(a.left),s(a.right)}s(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(o),this.metrics.routingTableKadBucketMaxOccupancy.update(i),this.metrics.routingTableKadBucketMaxDepth.update(n)}};var _Y=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];var o8=15,i8=class{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){let{peerRouting:n,routingTable:o,refreshInterval:i,refreshQueryTimeout:s,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=o,this.refreshInterval=i??tY,this.refreshQueryTimeout=s??rY,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}afterStart(){return f(this,null,function*(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)})}stop(){return f(this,null,function*(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)})}refreshTable(e=!1,t){this.log("refreshing routing table");let n=this._maxCommonPrefix(),o=this._getTrackedCommonPrefixLengthsForRefresh(n);this.log(`max common prefix length ${n}`),this.log(`tracked CPLs [ ${o.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(o.map((i,s)=>f(this,null,function*(){try{if(yield this._refreshCommonPrefixLength(s,i,e,t),this._numPeersForCpl(n)===0){let a=Math.min(2*(s+1),o.length-1);for(let c=s+1;c<a+1;c++)try{yield this._refreshCommonPrefixLength(c,i,e,t)}catch(l){this.log.error(l)}}}catch(a){this.log.error(a)}}))).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}_refreshCommonPrefixLength(e,t,n,o){return f(this,null,function*(){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let i=this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);let s=Ze([o?.signal,AbortSignal.timeout(this.refreshQueryTimeout)]);try{let a=yield Z5(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${a} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{s.clear()}})}_getTrackedCommonPrefixLengthsForRefresh(e){e>o8&&(e=o8);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}_generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");let t=Oo(2),n=(t[1]<<8)+t[0],o=this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),i=Nt(o);return Jr(i)}_makePeerId(e,t,n){if(n>o8)throw new Error(`Cannot generate peer ID for common prefix length greater than ${o8}`);let s=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=s&a|t&~a,l=_Y[c],u=new ArrayBuffer(34),d=new DataView(u,0,u.byteLength);return d.setUint8(0,wt.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(let{kadId:e}of this.routingTable.kb.toIterable()){let t=wa(this.routingTable.kb.localPeer.kadId,e),n=0;for(let o of t)if(o===0)n++;else break;yield n}}};var s8=class{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}handle(e,t){return f(this,null,function*(){if(t.key==null||t.key.length===0)throw new vt("Missing key");let n;try{n=ce.decode(t.key)}catch{throw new vt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),yield Promise.all(t.providers.map(o=>f(this,null,function*(){let i=Nt(o.id),s=Jr(i),a=o.multiaddrs.map(c=>we(c));if(!e.equals(s)){this.log("invalid provider peer %p from %p",o.id,e);return}if(o.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),yield this.providers.addProvider(n,s),yield this.peerStore.merge(s,{multiaddrs:a})})))})}};var a8=class{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){let{peerRouting:n,logPrefix:o}=t;this.log=e.logger.forComponent(`${o}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}handle(e,t){return f(this,null,function*(){this.log("incoming request from %p for peers close to %b",e,t.key);try{if(t.key==null)throw new vt("Invalid FIND_NODE message received - key was missing");let n=yield this.peerRouting.getClosestPeersOffline(t.key,{exclude:[e,this.peerId]});Me(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(ms("p2p").code))});let o={type:Ft.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(s=>s.bytes)})),providers:[]};return o.closer.length===0?this.log("could not find any peers closer to %b for %p",t.key,e):this.log("found %d peers close to %b for %p",o.closer.length,t.key,e),o}catch(n){throw this.log("error during finding peers closer to %b for %p - %e",t.key,e,n),n}})}};var c8=class{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){let{peerRouting:n,providers:o,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=o,this.peerInfoMapper=t.peerInfoMapper}handle(e,t){return f(this,null,function*(){if(t.key==null)throw new vt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=ce.decode(t.key)}catch{throw new vt("Invalid CID")}this.log("%p asking for providers for %s",e,n);let[o,i]=yield Promise.all([pa(_n(yield this.providers.getProviders(n),a=>f(this,null,function*(){let c=yield this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}}))),this.peerRouting.getClosestPeersOffline(t.key)]),s={type:Ft.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:o.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",s.providers.length,s.closer.length),s})}_getAddresses(e){return f(this,null,function*(){return[]})}};var l8=class{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}handle(e,t){return f(this,null,function*(){let n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new vt("Invalid key");let o={type:Ft.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(hY(n)){this.log("is public key");let a=mY(n),c;try{let l=yield this.peerStore.get(a);if(l.id.publicKey==null)throw new kt("No public key found in key book");c=En(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),o.record=new $n(n,c,new Date).serialize(),o}let[i,s]=yield Promise.all([this._checkLocalDatastore(n),this.peerRouting.getClosestPeersOffline(n)]);return i!=null&&(this.log("had record for %b in local datastore",n),o.record=i.serialize()),s.length>0&&(this.log("had %s closer peers in routing table",s.length),o.closer=s.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),o})}_checkLocalDatastore(e){return f(this,null,function*(){this.log("checkLocalDatastore looking for %b",e);let t=Ku(this.datastorePrefix,e),n;try{n=yield this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}let o=$n.deserialize(n);if(o.timeReceived==null||Date.now()-o.timeReceived.getTime()>zG){yield this.datastore.delete(t);return}return o})}};var u8=class{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}handle(e,t){return f(this,null,function*(){return this.log("ping from %p",e),t})}};var d8=class{components;validators;log;datastorePrefix;constructor(e,t){let{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}handle(e,t){return f(this,null,function*(){let n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){let o=`Empty record from: ${e.toString()}`;throw this.log.error(o),new vt(o)}try{let o=$n.deserialize(t.record);yield Hg(this.validators,o),o.timeReceived=new Date;let i=Ku(this.datastorePrefix,o.key);yield this.components.datastore.put(i,o.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(o){this.log("did not put record for key %b into datastore %o",n,o)}return t})}};var f8=class{handlers;log;metrics;incomingMessageTimeout;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`),rpcTime:e.metrics?.registerMetricGroup(`${t.metricsPrefix}_inbound_rpc_time_seconds`,{label:"operation"})},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.incomingMessageTimeout=t.incomingMessageTimeout??1e4,this.handlers={[Ft.GET_VALUE.toString()]:new l8(e,t),[Ft.PUT_VALUE.toString()]:new d8(e,t),[Ft.FIND_NODE.toString()]:new a8(e,t),[Ft.ADD_PROVIDER.toString()]:new s8(e,t),[Ft.GET_PROVIDERS.toString()]:new c8(e,t),[Ft.PING.toString()]:new u8(e,t)}}handleMessage(e,t){return f(this,null,function*(){let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return this.metrics.operations?.increment({[t.type]:!0}),yield n.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}})}onIncomingStream(e){let t="unknown";Promise.resolve().then(()=>f(this,null,function*(){let{stream:n,connection:o}=e,i=()=>{n.abort(new Xa)},s=AbortSignal.timeout(this.incomingMessageTimeout);s.addEventListener("abort",i);let a=tr(n).pb(zu);try{for(;;){let c=yield a.read({signal:s}),l=this.metrics?.rpcTime?.timer(c.type.toString()),u=this.metrics?.rpcTime?.timer(c.type.toString()),d=!1;try{this.log("incoming %s from %p",c.type,o.remotePeer);let h=yield this.handleMessage(o.remotePeer,c);h!=null&&(yield a.write(h,{signal:s}))}catch(h){throw d=!0,u?.(),h}finally{d||l?.()}s.removeEventListener("abort",i),s=AbortSignal.timeout(this.incomingMessageTimeout),s.addEventListener("abort",i)}}catch(c){n.abort(c)}})).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};var p8=class extends nt{log;components;protocol;running;registrarId;constructor(e,t){super();let{protocol:n,logPrefix:o}=t;this.components=e,this.log=e.logger.forComponent(`${o}:topology-listener`),this.running=!1,this.protocol=n}isStarted(){return this.running}start(){return f(this,null,function*(){this.running||(this.running=!0,this.registrarId=yield this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))})}stop(){return f(this,null,function*(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)})}};var qP=class{dht;constructor(e){this.dht=e}provide(n){return f(this,arguments,function*(e,t={}){yield Yo(this.dht.provide(e,t))})}cancelReprovide(e){return f(this,null,function*(){yield this.dht.cancelReprovide(e)})}findProviders(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.findProviders(e,t)),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;c.name==="PROVIDER"&&(yield*Q(c.providers))}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}put(e,t,n){return f(this,null,function*(){yield Yo(this.dht.put(e,t,n))})}get(e,t){return f(this,null,function*(){try{for(var n=O(this.dht.get(e,t)),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;if(a.name==="VALUE")return a.value}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}throw new kt("Could not find value for key")})}},KP=class{dht;constructor(e){this.dht=e}findPeer(n){return f(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.findPeer(e,t)),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;if(c.name==="FINAL_PEER")return c.peer}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}throw new kt("Peer not found")})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){try{for(var o=O(this.dht.getClosestPeers(e,t)),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;c.name==="FINAL_PEER"&&(yield c.peer)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}},x2e=32,S2e=64,h8=class extends nt{k;a;d;protocol;routingTable;providers;network;peerRouting;components;log;running;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;onPeerConnectTimeout;constructor(e,t={}){super();let n=t.logPrefix??"libp2p:kad-dht",o=t.datastorePrefix??"/dht",i=t.metricsPrefix??"libp2p_kad_dht",s={queries:e.metrics?.registerMetricGroup(`${i}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${i}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${i}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${i}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(n),this.k=t.kBucketSize??fv,this.a=t.alpha??Hu,this.d=t.disjointPaths??this.a,this.protocol=t.protocol??qG,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??x2e,this.maxOutboundStreams=t.maxOutboundStreams??S2e,this.peerInfoMapper=t.peerInfoMapper??fY,this.onPeerConnectTimeout=t.onPeerConnectTimeout??QG,this.providers=new X5(e,I(v({},t.providers),{logPrefix:n,datastorePrefix:o})),this.validators=v(v({},dY),t.validators),this.selectors=v(v({},uY),t.selectors),this.network=new G5(e,{protocol:this.protocol,logPrefix:n,metricsPrefix:i}),this.routingTable=new n8(e,{kBucketSize:this.k,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:n,metricsPrefix:i,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});let a=ze();t.allowQueryWithZeroPeers===!0&&a.resolve(),this.queryManager=new Q5(e,{disjointPaths:this.d,alpha:this.a,logPrefix:n,metricsPrefix:i,initialQuerySelfHasRun:a,routingTable:this.routingTable,allowQueryWithZeroPeers:t.allowQueryWithZeroPeers}),this.peerRouting=new Y5(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:n}),this.contentFetching=new K5(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:n,datastorePrefix:o}),this.contentRouting=new W5(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:n}),this.routingTableRefresh=new i8(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:n}),this.rpc=new f8(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:n,metricsPrefix:i,datastorePrefix:o,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new p8(e,{protocol:this.protocol,logPrefix:n}),this.querySelf=new J5(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:n,initialQuerySelfHasRun:a,operationMetrics:s}),this.reprovider=new e8(e,I(v({},t.reprovide),{logPrefix:n,metricsPrefix:i,datastorePrefix:o,contentRouting:this.contentRouting,operationMetrics:s})),this.network.addEventListener("peer",c=>{let l=c.detail;this.onPeerConnect(l).catch(u=>{this.log.error("could not add %p to routing table",l.id,u)}),this.dispatchEvent(new CustomEvent("peer",{detail:l}))}),this.topologyListener.addEventListener("peer",c=>{let l=c.detail;Promise.resolve().then(()=>f(this,null,function*(){let u=yield this.components.peerStore.get(l),d={id:l,multiaddrs:u.addresses.map(({multiaddr:h})=>h),protocols:u.protocols};yield this.onPeerConnect(d)})).catch(u=>{this.log.error("could not add %p to routing table - %e - %e",l,u)})}),this.dhtPeerRouting=new KP(this),this.dhtContentRouting=new qP(this),t.clientMode==null&&e.events.addEventListener("self:peer:update",c=>{this.log("received update of self-peer info"),Promise.resolve().then(()=>f(this,null,function*(){let l=c.detail.peer.addresses.some(({multiaddr:d})=>gY(d)),u=this.getMode();l&&u==="client"?yield this.setMode("server"):u==="server"&&!l&&(yield this.setMode("client"))})).catch(l=>{this.log.error("error setting dht server mode",l)})}),this.get=Ip(this.get.bind(this),s,"GET_VALUE"),this.findProviders=Ip(this.findProviders.bind(this),s,"FIND_PROVIDERS"),this.findPeer=Ip(this.findPeer.bind(this),s,"FIND_PEER"),this.getClosestPeers=Ip(this.getClosestPeers.bind(this),s,"GET_CLOSEST_PEERS"),this.provide=Ip(this.provide.bind(this),s,"PROVIDE"),this.put=Ip(this.put.bind(this),s,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[At]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery","@libp2p/kad-dht"];[Ci]=["@libp2p/identify","@libp2p/ping"];get[Ga](){return this.dhtContentRouting}get[Ya](){return this.dhtPeerRouting}get[af](){return this}onPeerConnect(e){return f(this,null,function*(){if(this.log.trace("peer %p connected",e.id),e=this.peerInfoMapper(e),e.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(n=>n.toString()));return}let t=AbortSignal.timeout(this.onPeerConnectTimeout);try{yield this.routingTable.add(e.id,{signal:t})}catch(n){this.log.error("could not add %p to routing table",e.id,n)}})}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}setMode(e,t){return f(this,null,function*(){if(e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}if(yield this.components.registrar.unhandle(this.protocol,t),e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}e==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,yield this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{signal:t?.signal,maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))})}start(){return f(this,null,function*(){this.running||(this.running=!0,yield this.setMode(this.clientMode?"client":"server",{force:!0}),yield kn(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),yield kn(this.querySelf))})}stop(){return f(this,null,function*(){this.running=!1,yield oo(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)})}put(o,i){return M(this,arguments,function*(e,t,n={}){yield*Q(this.contentFetching.put(e,t,n))})}get(n){return M(this,arguments,function*(e,t={}){yield*Q(this.contentFetching.get(e,t))})}provide(n){return M(this,arguments,function*(e,t={}){yield*Q(this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t))})}cancelReprovide(e,t){return f(this,null,function*(){yield this.providers.removeProvider(e,this.components.peerId,t)})}findProviders(n){return M(this,arguments,function*(e,t={}){yield*Q(this.contentRouting.findProviders(e,t))})}findPeer(n){return M(this,arguments,function*(e,t={}){yield*Q(this.peerRouting.findPeer(e,t))})}getClosestPeers(n){return M(this,arguments,function*(e,t={}){yield*Q(this.peerRouting.getClosestPeers(e,t))})}refreshRoutingTable(e){return f(this,null,function*(){this.routingTableRefresh.refreshTable(!0,e)})}};function CY(r={}){return e=>new h8(e,r)}var It=function(r){return r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR",r}(It||{}),pv=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),WP=Object.freeze({NEW_STREAM:It.NEW_STREAM,MESSAGE:It.MESSAGE_INITIATOR,CLOSE:It.CLOSE_INITIATOR,RESET:It.RESET_INITIATOR}),IY=Object.freeze({MESSAGE:It.MESSAGE_RECEIVER,CLOSE:It.CLOSE_RECEIVER,RESET:It.RESET_RECEIVER});var GP=1<<20,_2e=4<<20,m8=class{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=GP,t=_2e){this._buffer=new Ve,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new vt("Unprocessed message queue size too large!");let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}let{id:n,type:o,length:i,offset:s}=this._headerInfo;if(this._buffer.length-s<i)break;let c={id:n,type:o};(o===It.NEW_STREAM||o===It.MESSAGE_INITIATOR||o===It.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(s,s+i)),t.push(c),this._buffer.consume(s+i),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=DY(e),{value:o,offset:i}=DY(e,n),s=t&7;if(pv[s]==null)throw new Error(`Invalid type received: ${s}`);if(o>this._maxMessageSize)throw new vt("Message size too large");return{id:t>>3,type:s,offset:n+i,length:o}}},C2e=128,AY=127;function DY(r,e=0){let t=0,n=0,o=e,i,s=r.length;do{if(o>=s||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(o++),t+=n<28?(i&AY)<<n:(i&AY)*Math.pow(2,n),n+=7}while(i>=C2e);return e=o-e,{value:t,offset:e}}var YP=10*1024,XP=class{_pool;_poolOffset;constructor(){this._pool=wr(YP),this._poolOffset=0}write(e,t){let n=this._pool,o=this._poolOffset;Sn(e.id<<3|e.type,n,o),o+=_t(e.id<<3|e.type),(e.type===It.NEW_STREAM||e.type===It.MESSAGE_INITIATOR||e.type===It.MESSAGE_RECEIVER)&&e.data!=null?(Sn(e.data.length,n,o),o+=_t(e.data.length)):(Sn(0,n,o),o+=_t(0));let i=n.subarray(this._poolOffset,o);YP-o<100?(this._pool=wr(YP),this._poolOffset=0):this._poolOffset=o,t.append(i),(e.type===It.NEW_STREAM||e.type===It.MESSAGE_INITIATOR||e.type===It.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},I2e=new XP;function TY(r){return M(this,null,function*(){try{for(var e=O(r),t,n,o;t=!(n=yield new S(e.next())).done;t=!1){let i=n.value;let s=new Ve;I2e.write(i,s),yield s}}catch{o=[n]}finally{try{t&&(n=e.return)&&(yield new S(n.call(e)))}finally{if(o)throw o[0]}}})}var g8=class extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}};var QP=class extends Bu{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types=e.direction==="outbound"?WP:IY,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}sendNewStream(){return f(this,null,function*(){yield this.send({id:this.streamId,type:WP.NEW_STREAM,data:new Ve(Z(this.name))})})}sendData(e){return f(this,null,function*(){for(e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxDataSize);yield this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}})}sendReset(){return f(this,null,function*(){yield this.send({id:this.streamId,type:this.types.RESET})})}sendCloseWrite(){return f(this,null,function*(){yield this.send({id:this.streamId,type:this.types.CLOSE})})}sendCloseRead(){return f(this,null,function*(){})}};function PY(r){let{id:e,name:t,send:n,onEnd:o,type:i="initiator",maxMsgSize:s=GP}=r;return new QP({id:i==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:i==="initiator"?"outbound":"inbound",maxDataSize:s,onEnd:o,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${i}:${e}`)})}var A2e=1024,D2e=1024,T2e=1024*1024*4,P2e=5,M2e=500;function MY(r){let e=I(v({},r),{type:`${pv[r.type]} (${r.type})`});return r.type===It.NEW_STREAM&&(e.data=te(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===It.MESSAGE_INITIATOR||r.type===It.MESSAGE_RECEIVER)&&(e.data=te(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var y8=class{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(e,t){t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??M2e,this.sink=this._createSink(),this._source=Xr({objectMode:!0,onEnd:()=>{for(let n of this._streams.initiators.values())n.destroy();for(let n of this._streams.receivers.values())n.destroy()}}),this.source=lr(this._source,n=>TY(n)),this.closeController=new AbortController,this.rateLimiter=new kg({points:t.disconnectThreshold??P2e,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new pu("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){return f(this,null,function*(){if(this.closeController.signal.aborted)return;let t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{yield Promise.all(this.streams.map(n=>f(this,null,function*(){return n.close({signal:t})}))),this._source.end(),yield this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}})}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){let{id:t,name:n}=e,o=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:o})}_newStream(e){let{id:t,name:n,type:o,registry:i}=e;if(this.log("new %s stream %s",o,t),o==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??D2e))throw new xm("Too many outbound streams open");if(i.has(t))throw new Error(`${o} stream ${t} already exists!`);let c=PY({id:t,name:n,send:l=>f(this,null,function*(){this.log.enabled&&this.log.trace("%s stream %s send",o,t,MY(l)),this._source.push(l)}),type:o,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",o,t,c.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return i.set(t,c),c}_createSink(){return t=>f(this,null,function*(){let n=()=>{m5(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{let c=new m8(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);try{for(var o=O(t),i,s,a;i=!(s=yield o.next()).done;i=!1){let l=s.value;for(let u of c.write(l))yield this._handleIncoming(u)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}this._source.end()}catch(c){this.log("error in sink",c),this._source.end(c)}finally{this.closeController.signal.removeEventListener("abort",n)}})}_handleIncoming(e){return f(this,null,function*(){let{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",MY(e)),e.type===It.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??A2e)){this.log("too many inbound streams open"),this._source.push({id:t,type:It.RESET_RECEIVER});try{yield this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:te(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){this.log("missing stream %s for message type %s",t,pv[n]);try{yield this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}let s=this._init.maxStreamBufferSize??T2e;try{switch(n){case It.MESSAGE_INITIATOR:case It.MESSAGE_RECEIVER:if(i.sourceReadableLength()>s)throw this._source.push({id:e.id,type:n===It.MESSAGE_INITIATOR?It.RESET_RECEIVER:It.RESET_INITIATOR}),new g8("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");i.sourcePush(e.data);break;case It.CLOSE_INITIATOR:case It.CLOSE_RECEIVER:i.remoteCloseWrite();break;case It.RESET_INITIATOR:case It.RESET_RECEIVER:i.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),i.abort(a)}})}};var ZP=class{protocol="/mplex/6.7.0";_init;components;constructor(e,t={}){this.components=e,this._init=t}[Symbol.toStringTag]="@libp2p/mplex";[At]=["@libp2p/stream-multiplexing"];createStreamMuxer(e={}){return new y8(this.components,v(v({},e),this._init))}};function kY(r={}){return e=>new ZP(e,r)}var RY="1.0.0",NY="ping",OY="ipfs";var v8=class{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;log;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??OY}/${NY}/${RY}`,this.timeout=t.timeout??1e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??1,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[At]=["@libp2p/ping"];start(){return f(this,null,function*(){yield this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(this.protocol),this.started=!1})}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);let{stream:t}=e,n=Date.now(),o=vp(t),i=!1;Promise.resolve().then(()=>f(this,null,function*(){for(;;){let s=AbortSignal.timeout(this.timeout);s.addEventListener("abort",()=>{t?.abort(new Xa("ping timeout"))});let a=yield o.read({bytes:32,signal:s});yield o.write(a,{signal:s}),i=!0}})).catch(s=>{i&&s.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,s),t?.abort(s))}).finally(()=>{let s=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,s);let a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t?.abort(c)})})}ping(n){return f(this,arguments,function*(e,t={}){this.log("pinging %p",e);let o=Date.now(),i=Oo(32),s=yield this.components.connectionManager.openConnection(e,t),a;if(t.signal==null){let c=AbortSignal.timeout(this.timeout);t=I(v({},t),{signal:c})}try{a=yield s.newStream(this.protocol,I(v({},t),{runOnLimitedConnection:this.runOnLimitedConnection}));let c=vp(a),[,l]=yield Promise.all([c.write(i,t),c.read(I(v({},t),{bytes:32}))]),u=Date.now()-o;if(!Me(i,l.subarray()))throw new YU(`Received wrong ping ack after ${u}ms`);return this.log("ping %p complete in %dms",s.remotePeer,u),u}catch(c){throw this.log.error("error while pinging %p",s.remotePeer,c),a?.abort(c),c}finally{a!=null&&(yield a.close(t))}})}};function LY(r={}){return e=>new v8(e,r)}var yo;(function(r){let e;(function(o){o.FIN="FIN",o.STOP_SENDING="STOP_SENDING",o.RESET="RESET",o.FIN_ACK="FIN_ACK"})(e=r.Flag||(r.Flag={}));let t;(function(o){o[o.FIN=0]="FIN",o[o.STOP_SENDING=1]="STOP_SENDING",o[o.RESET=2]="RESET",o[o.FIN_ACK=3]="FIN_ACK"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.flag!=null&&(i.uint32(8),r.Flag.codec().encode(o.flag,i)),o.message!=null&&(i.uint32(18),i.bytes(o.message)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.flag=r.Flag.codec().decode(o);break}case 2:{a.message=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(yo||(yo={}));var FY=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],eM=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),BY="libp2p+webrtc+v1/";var UY=466,VY=2*1024*1024,jY=30*1e3,$g=16*1024;function O2e(r=$g){let e=_t(r-_t(r)),t=1+_t(Object.keys(yo.Flag).length-1),n=1,o=r-e-t-n,i=_t(o);return e+t+n+i}var HY=O2e(),$Y=5e3,zY=5e3,qY=3e4,tM="/webrtc",hv="/webrtc-signaling/0.0.1",KY="/libp2p/webrtc-direct/certificate",WY="webrtc-direct-certificate-private-key";var GY=12096e5,rM=864e5;var YY=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},L2e=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}();var F2e=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}();var B2e=function(){function r(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"}return r}();var U2e=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var V2e=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var j2e=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,H2e=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,XY=3,$2e=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",j2e]],QY=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function JY(r){return r?ZY(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new V2e:typeof navigator<"u"?ZY(navigator.userAgent):K2e()}function z2e(r){return r!==""&&$2e.reduce(function(e,t){var n=t[0],o=t[1];if(e)return e;var i=o.exec(r);return!!i&&[n,i]},!1)}function ZY(r){var e=z2e(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new U2e;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<XY&&(o=YY(YY([],o,!0),W2e(XY-o.length),!0)):o=[];var i=o.join("."),s=q2e(r),a=H2e.exec(r);return a&&a[1]?new B2e(t,i,s,a[1]):new L2e(t,i,s)}function q2e(r){for(var e=0,t=QY.length;e<t;e++){var n=QY[e],o=n[0],i=n[1],s=i.exec(r);if(s)return o}return null}function K2e(){var r=typeof process<"u"&&process.version;return r?new F2e(process.version.slice(1)):null}function W2e(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var eX=JY(),mv=eX!=null&&eX.name==="firefox",w8=function(){return M(this,null,function*(){})},b8=r=>f(null,null,function*(){});function tX(r,e,t=qY,n){r.readyState==="open"&&Promise.resolve().then(()=>f(null,null,function*(){if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);let o=ze(),i=!1;r.bufferedAmountLowThreshold=0;let s=()=>{i||(n.log("%s drain channel closed before drain",e),o.resolve())};r.addEventListener("close",s,{once:!0}),r.addEventListener("bufferedamountlow",()=>{i=!0,r.removeEventListener("close",s),o.resolve()}),yield Jc(o.promise,{milliseconds:t})}})).then(()=>f(null,null,function*(){r.readyState==="open"&&r.close()})).catch(o=>{n.log.error("error closing outbound stream",o)})}function nM(r){return f(this,null,function*(){return r=r??{},typeof r=="function"&&(r=yield r()),r.iceServers=r.iceServers??FY.map(e=>({urls:[e]})),r})}var rX=(r=32)=>BY+[...Array(r)].map(()=>eM.at(Math.floor(Math.random()*eM.length))).join("");var Dp=class{log;peerConnection;remoteAddr;timeline;metrics;source=w8();sink=b8;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let n=this.peerConnection,o=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",o),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}close(e){return f(this,null,function*(){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}};var oM=class extends Bu{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=o=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(()=>f(this,null,function*(){if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{yield Jc(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(i){this.log.error("error receiving FIN_ACK",i)}})).then(()=>{this.incomingData.end(),t?.(o)}).catch(i=>{this.log.error("error ending stream",i)}).finally(()=>{this.channel.close()})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=Xr(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??jY,this.maxBufferedAmount=e.maxBufferedAmount??VY,this.maxMessageSize=(e.maxMessageSize??$g)-HY,this.receiveFinAck=ze(),this.finAckTimeout=e.closeTimeout??$Y,this.openTimeout=e.openTimeout??zY,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new py("Unknown datachannel state")}this.channel.onopen=o=>{this.timeline.open=new Date().getTime()},this.channel.onclose=o=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(i=>{this.log.error("error closing stream after channel closed",i)})},this.channel.onerror=o=>{this.log.trace("received onerror event"),this.closeController.abort();let i=o.error;this.abort(i)},this.channel.onmessage=o=>f(this,null,function*(){let{data:i}=o;i===null||i.byteLength===0||this.incomingData.push(new Uint8Array(i,0,i.byteLength))});let n=this;Promise.resolve().then(()=>f(this,null,function*(){try{for(var o=O(fl(this.incomingData)),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;let l=n.processIncomingProtobuf(c);l!=null&&n.sourcePush(new Ve(l))}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}})).catch(o=>{this.log.error("error processing incoming data channel messages",o)})}sendNewStream(){}_sendMessage(e,t=!0){return f(this,null,function*(){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new py(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){let n=AbortSignal.timeout(this.openTimeout),o=Ze([this.closeController.signal,n]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),yield Pr(this.channel,"open",o)}finally{o.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let n=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),o=Ze([this.closeController.signal,n]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),yield Pr(this.channel,"bufferedamountlow",o)}catch(i){throw n.aborted?new Xa(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):i}finally{o.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(e.subarray())}catch(n){this.log.error("error while sending message",n)}})}sendData(e){return f(this,null,function*(){let t=e.byteLength;for(e=e.sublist();e.byteLength>0;){let n=Math.min(e.byteLength,this.maxMessageSize),o=e.subarray(0,n),i=yo.encode({message:o}),s=dl.single(i);this.log.trace("sending %d/%d bytes on channel",o.byteLength,t),yield this._sendMessage(s),e.consume(n)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)})}sendReset(){return f(this,null,function*(){try{yield this._sendFlag(yo.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}finally{this.channel.close()}})}sendCloseWrite(e){return f(this,null,function*(){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(yield this._sendFlag(yo.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{yield lt(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(n){this.log.error("failed to await FIN_ACK",n)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()})}sendCloseRead(){return f(this,null,function*(){this.channel.readyState==="open"&&(yield this._sendFlag(yo.Flag.STOP_SENDING))})}processIncomingProtobuf(e){let t=yo.decode(e);if(t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===yo.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(yo.Flag.FIN_ACK).catch(n=>{this.log.error("error sending FIN_ACK immediately",n)})),t.flag===yo.Flag.RESET&&this.reset(),t.flag===yo.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===yo.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return t.message}_sendFlag(e){return f(this,null,function*(){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());let t=yo.encode({flag:e}),n=dl.single(t);try{return yield this._sendMessage(n,!1),!0}catch(o){this.log.error("could not send flag %s - %e",e.toString(),o)}return!1})}};function zg(r){let{channel:e,direction:t,handshake:n}=r;return new oM(v({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`)},r))}var Gu=class{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??tM,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}let o={},i=zg(v({channel:n,direction:"inbound",onEnd:s=>{o.onEnd(s)},logger:e.logger},this.dataChannelOptions));o.stream=i,o.channel=n,o.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(s=>s.stream.id!==i.id)},this.bufferedStreams.push(o)}}createStreamMuxer(e){return new iM(this.components,I(v({},e),{peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol}))}},iM=class{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??tM,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}let o=n.id,i=zg(v({channel:n,direction:"inbound",onEnd:()=>{this.#e(i,n),this.log("incoming channel %s ended",o)},logger:this.logger},this.dataChannelOptions));this.streams.push(i),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(i)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),this.#e(n.stream,n.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(n.stream)})})}#e(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),tX(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(n=>n.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}close(e){return f(this,null,function*(){try{yield Promise.all(this.streams.map(t=>f(this,null,function*(){return t.close(e)})))}catch(t){this.abort(t)}})}abort(e){for(let t of this.streams)t.abort(e)}source=w8();sink=b8;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let n=zg(v({channel:e,direction:"outbound",onEnd:()=>{this.#e(n,e),this.log("outgoing channel %s ended",t)},logger:this.logger},this.dataChannelOptions));return this.streams.push(n),this.metrics?.increment({outgoing_stream:!0}),n}};var E8=globalThis.RTCPeerConnection,x8=globalThis.RTCSessionDescription,nX=globalThis.RTCIceCandidate;var Yu=class extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}},xs=class extends Yu{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}};var S8=class extends Yu{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}};var _8=class extends Yu{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}},C8=class extends Yu{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}};var ai;(function(r){let e;(function(o){o.SDP_OFFER="SDP_OFFER",o.SDP_ANSWER="SDP_ANSWER",o.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.SDP_OFFER=0]="SDP_OFFER",o[o.SDP_ANSWER=1]="SDP_ANSWER",o[o.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.data!=null&&(i.uint32(18),i.string(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.data=o.string();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Be(o,r.codec()),r.decode=(o,i)=>Fe(o,r.codec(),i)})(ai||(ai={}));var I8=(r,e,t)=>f(null,null,function*(){try{let n=ze();for(G2e(r,n);;){let o=yield Promise.race([n.promise,e.read({signal:t.signal}).catch(()=>{})]);if(o==null){t.signal?.throwIfAborted();break}if(o.type!==ai.Type.ICE_CANDIDATE)throw new vt("ICE candidate message expected");let i=JSON.parse(o.data??"null");if(i===""||i===null){t.onProgress?.(new fe("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}let s=new nX(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new fe("webrtc:add-ice-candidate",s.candidate)),yield r.addIceCandidate(s)}catch(a){t.log.error("%s bad candidate received",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate",t.direction,n),t.signal?.aborted===!0&&A8(r)!=="connected")throw n}});function A8(r){return mv?r.iceConnectionState:r.connectionState}function G2e(r,e){r[mv?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(A8(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new C4("RTCPeerConnection was closed"));break;default:break}}}function oX(u){return f(this,arguments,function*({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:o,connectionManager:i,transportManager:s,log:a,logger:c,onProgress:l}){let{baseAddr:d}=iX(o);n?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);let h=d.getPeerId();if(h==null)throw new Y("Relay peer was missing");let p=i.getConnections(sr(h)),m,y=!1;p.length===0?(l?.(new fe("webrtc:dial-relay")),m=yield s.dial(d,{signal:t,onProgress:l}),y=!0):(l?.(new fe("webrtc:reuse-relay-connection")),m=p[0]);try{l?.(new fe("webrtc:open-signaling-stream"));let b=yield m.newStream(hv,{signal:t,runOnLimitedConnection:!0}),x=tr(b).pb(ai),A=new E8(r),P=new Gu({logger:c},{peerConnection:A,dataChannelOptions:e});try{let L=A.createDataChannel("init");A.onicecandidate=({candidate:U})=>{let T=JSON.stringify(U?.toJSON()??null);a.trace("initiator sending ICE candidate %o",U),x.write({type:ai.Type.ICE_CANDIDATE,data:T},{signal:t}).catch(k=>{a.error("error sending ICE candidate",k)})},A.onicecandidateerror=U=>{a.error("initiator ICE candidate error",U)};let F=yield A.createOffer().catch(U=>{throw a.error("could not execute createOffer",U),new xs("Failed to set createOffer")});a.trace("initiator send SDP offer %s",F.sdp),l?.(new fe("webrtc:send-sdp-offer")),yield x.write({type:ai.Type.SDP_OFFER,data:F.sdp},{signal:t}),yield A.setLocalDescription(F).catch(U=>{throw a.error("could not execute setLocalDescription",U),new xs("Failed to set localDescription")}),l?.(new fe("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let W=yield x.read({signal:t});if(W.type!==ai.Type.SDP_ANSWER)throw new xs("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",W.data);let H=new x8({type:"answer",sdp:W.data});return yield A.setRemoteDescription(H).catch(U=>{throw a.error("could not execute setRemoteDescription",U),new xs("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l?.(new fe("webrtc:read-ice-candidates")),yield I8(A,x,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),L.close(),l?.(new fe("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),yield b.close({signal:t}),a.trace("initiator connected to remote address %s",o),{remoteAddress:o,peerConnection:A,muxerFactory:P}}catch(L){throw a.error("outgoing signaling error",L),A.close(),b.abort(L),L}finally{A.onicecandidate=null,A.onicecandidateerror=null}}finally{if(y)try{yield m.close({signal:t})}catch(b){m.abort(b)}}})}var sX=Vt(Rx.matchers[0],ut("p2p-circuit")),D8=class r extends nt{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}listen(){return f(this,null,function*(){this.events.addEventListener("transport:listening",this.onTransportListening)})}onTransportListening(e){e.detail.getAddrs().filter(n=>sX.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof r)).map(e=>e.getAddrs().filter(t=>sX.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}close(){return f(this,null,function*(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})})}};function aX(i){return f(this,arguments,function*({peerConnection:r,stream:e,signal:t,connection:n,log:o}){o.trace("new inbound signaling stream");let s=tr(e).pb(ai);try{r.onicecandidate=({candidate:d})=>{let h=JSON.stringify(d?.toJSON()??null);o.trace("recipient sending ICE candidate %s",h),s.write({type:ai.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{o.error("error sending ICE candidate",p)})},o.trace("recipient read SDP offer");let c=yield s.read({signal:t});if(c.type!==ai.Type.SDP_OFFER)throw new xs(`expected message type SDP_OFFER, received: ${c.type??"undefined"} `);o.trace("recipient received SDP offer %s",c.data);let l=new x8({type:"offer",sdp:c.data});yield r.setRemoteDescription(l).catch(d=>{throw o.error("could not execute setRemoteDescription",d),new xs("Failed to set remoteDescription")});let u=yield r.createAnswer().catch(d=>{throw o.error("could not execute createAnswer",d),new xs("Failed to create answer")});o.trace("recipient send SDP answer %s",u.sdp),yield s.write({type:ai.Type.SDP_ANSWER,data:u.sdp},{signal:t}),yield r.setLocalDescription(u).catch(d=>{throw o.error("could not execute setLocalDescription",d),new xs("Failed to set localDescription")}),o.trace("recipient read candidates until connected"),yield I8(r,s,{direction:"recipient",signal:t,log:o})}catch(c){if(A8(r)!=="connected")throw o.error("error while handling signaling stream from peer %a",n.remoteAddr,c),r.close(),c;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,c)}let a=we(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return o.trace("recipient connected to remote address %s",a),{remoteAddress:a}})}var T8=class{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[fu]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[At]=["@libp2p/transport"];[Ci]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}start(){return f(this,null,function*(){yield this.components.registrar.handle(hv,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0})}stop(){return f(this,null,function*(){yield this.components.registrar.unhandle(hv),this._started=!1})}createListener(e){return new D8(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(_2.exactMatch)}dialFilter(e){return this.listenFilter(e)}dial(e,t){return f(this,null,function*(){this.log.trace("dialing address: %a",e);let{remoteAddress:n,peerConnection:o,muxerFactory:i}=yield oX({rtcConfiguration:yield nM(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new Dp(this.components,{peerConnection:o,timeline:{open:Date.now()},remoteAddr:n,metrics:this.metrics?.dialerEvents}),a=yield t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(o,s),a})}_onProtocol(o,i){return f(this,arguments,function*({connection:e,stream:t},n){let s=new E8(yield nM(this.init.rtcConfiguration)),a=new Gu(this.components,{peerConnection:s,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:c}=yield aX({peerConnection:s,connection:e,stream:t,signal:n,log:this.log});yield t.close({signal:n});let l=new Dp(this.components,{peerConnection:s,timeline:{open:new Date().getTime()},remoteAddr:c,metrics:this.metrics?.listenerEvents});yield this.components.upgrader.upgradeInbound(l,{skipEncryption:!0,skipProtection:!0,muxerFactory:a,signal:n}),this._closeOnShutdown(s,l)}catch(c){throw this.log.error("incoming signaling error",c),s.close(),t.abort(c),c}})}_closeOnShutdown(e,t){let n=()=>{t.close().catch(o=>{this.log.error("could not close WebRTCMultiaddrConnection",o)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}};function iX(r){let e=r.toString().split("/webrtc/");if(e.length!==2)throw new Y("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Y("p2p-circuit protocol was not present in multiaddr");let t=we(e[0]),o=we("/"+e[1]).getPeerId();if(o==null)throw new Y("destination peer id was missing");let i=t.protos().pop();if(i===void 0)throw new Y("invalid multiaddr");return i.name!=="p2p"&&(t=t.encapsulate(`/p2p/${o}`)),{baseAddr:t,peerId:sr(o)}}var RAt=xr(lX());var z=function(r){return r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice",r}(z||{}),D=function(r){return r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null",r}(D||{});var sM=xr(bl()),fc=class{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(sM.BufferSourceConverter.isBufferSource(e))this.unusedBits=t,this.value=sM.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof ma))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new ma({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new ma({name:e})}toNumber(){let e="",t=new Uint8Array(this.value);for(let n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;let o=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};var aM=xr(bl()),je=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):aM.BufferSourceConverter.isBufferSource(e)?this.buffer=aM.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ho))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ho({valueHex:this.buffer})}toSchema(e){return new ho({name:e})}};var Y2e={fromASN:r=>r instanceof ri?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new ri;let e=Ui(r);if(e.result.error)throw new Error(e.result.error);return e.result}},X2e={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Fi({value:+r})},Q2e={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Jf({value:r})},gt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Fi({valueHex:r})};var Z2e={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ma({valueHex:r})},J2e={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Bi({value:r})},eve={fromASN:r=>r.valueBlock.value,toASN:r=>new Zf({value:r})},qg={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ho({valueHex:r})},uX={fromASN:r=>new je(r.getValue()),toASN:r=>r.toASN()};function Ss(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}var cM=Ss(ys),tve=Ss(ep),rve=Ss(tp),nve=Ss(rp),ove=Ss(np),ive=Ss(op),sve=Ss(ip),ave=Ss(sp),cve=Ss(ap),lve=Ss(Nu),uve=Ss(cp),dve=Ss(lp),fve={fromASN:r=>r.toDate(),toASN:r=>new Ou({valueDate:r})},pve={fromASN:r=>r.toDate(),toASN:r=>new up({valueDate:r})},hve={fromASN:()=>null,toASN:()=>new ri};function Kg(r){switch(r){case D.Any:return Y2e;case D.BitString:return Z2e;case D.BmpString:return tve;case D.Boolean:return eve;case D.CharacterString:return dve;case D.Enumerated:return Q2e;case D.GeneralString:return uve;case D.GeneralizedTime:return pve;case D.GraphicString:return cve;case D.IA5String:return ave;case D.Integer:return X2e;case D.Null:return hve;case D.NumericString:return nve;case D.ObjectIdentifier:return J2e;case D.OctetString:return qg;case D.PrintableString:return ove;case D.TeletexString:return ive;case D.UTCTime:return fve;case D.UniversalString:return rve;case D.Utf8String:return cM;case D.VideotexString:return sve;case D.VisibleString:return lve;default:return null}}function _s(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:_s(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function uM(r){var e;if(r){let t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:uM(t)}return!1}function dX(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}var P8=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:z.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=t?i:"",c;if(typeof s.type=="number"){let u=D[s.type],d=ws[u];if(!d)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new d({name:a})}else _s(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===z.Choice?c=new cc({name:a}):(c=this.create(s.type,!1),c.name=a):c=new cc({name:a});let l=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let u=s.repeated==="set"?ni:ur;c=new u({name:"",value:[new dp({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||_s(s.type)){let u=s.repeated?dn:El;o.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let u=!!s.repeated,d=u?c:this.get(s.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,o.push(new dn({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:d}))}else o.push(new dn({optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=l,o.push(c)}switch(n.type){case z.Sequence:return new ur({value:o,name:""});case z.Set:return new ni({value:o,name:""});case z.Choice:return new Cg({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}};var Uo=new P8;var K=r=>e=>{let t;Uo.has(e)?t=Uo.get(e):(t=Uo.createDefault(e),Uo.set(e,t)),Object.assign(t,r)};var w=r=>(e,t)=>{let n;Uo.has(e.constructor)?n=Uo.get(e.constructor):(n=Uo.createDefault(e.constructor),Uo.set(e.constructor,n));let o=Object.assign({},r);if(typeof o.type=="number"&&!o.converter){let i=Kg(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);o.converter=i}n.items[t]=o};var gv=class extends Error{constructor(){super(...arguments),this.schemas=[]}};var yv=class{static parse(e,t){let n=Ui(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(_s(t))return new t().fromASN(e);let o=Uo.get(t);Uo.cache(t);let i=o.schema;if(e.constructor===dn&&o.type!==z.Choice){i=new dn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(let c in o.items)delete e[c]}let s=Ru({},e,i);if(!s.verified)throw new gv(`Data does not match to ${t.name} ASN1 schema. ${s.result.error}`);let a=new t;if(uM(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let c=o.itemType;if(typeof c=="number"){let l=Kg(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,u=>l.fromASN(u))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(let c in o.items){let l=s.result[c];if(!l)continue;let u=o.items[c],d=u.type;if(typeof d=="number"||_s(d)){let h=(n=u.converter)!==null&&n!==void 0?n:_s(d)?new d:null;if(!h)throw new Error("Converter is empty");if(u.repeated)if(u.implicit){let p=u.repeated==="sequence"?ur:ni,m=new p;m.valueBlock=l.valueBlock;let y=Ui(m.toBER(!1));if(y.offset===-1)throw new Error(`Cannot parse the child item. ${y.result.error}`);if(!("value"in y.result.valueBlock&&Array.isArray(y.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let b=y.result.valueBlock.value;a[c]=Array.from(b,x=>h.fromASN(x))}else a[c]=Array.from(l,p=>h.fromASN(p));else{let p=l;if(u.implicit){let m;if(_s(d))m=new d().toSchema("");else{let y=D[d],b=ws[y];if(!b)throw new Error(`Cannot get '${y}' class from asn1js module`);m=new b}m.valueBlock=p.valueBlock,p=Ui(m.toBER(!1)).result}a[c]=h.fromASN(p)}}else if(u.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,h=>this.fromASN(h,d))}else a[c]=this.fromASN(l,d)}return a}catch(o){throw o instanceof gv&&o.schemas.push(t.name),o}}};var vv=class r{static serialize(e){return e instanceof Un?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&_s(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let t=e.constructor,n=Uo.get(t);Uo.cache(t);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=Kg(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",t,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&dX(this.serialize(a.defaultValue),this.serialize(c)))continue;let l=r.toAsnItem(a,s,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||_s(a.type))){let u={};u.valueHex=l instanceof ri?l.valueBeforeDecodeView:l.valueBlock.toBER(),o.push(new El(v({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context}},u)))}else o.push(new dn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else o.push(new dn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?o=o.concat(l):o.push(l)}let i;switch(n.type){case z.Sequence:i=new ur({value:o});break;case z.Set:i=new ni({value:o});break;case z.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,t,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${t}' doesn't have converter for type ${D[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,l=>s.toASN(l)),c=e.repeated==="sequence"?ur:ni;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?ur:ni;i=new a({value:s})}else i=this.toASN(o);return i}};var Re=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let t of e)this.push(t)}}};var dM=xr(bl());var ge=class r{static serialize(e){return vv.serialize(e)}static parse(e,t){return yv.parse(e,t)}static toString(e){let t=dM.BufferSourceConverter.isBufferSource(e)?dM.BufferSourceConverter.toArrayBuffer(e):r.serialize(e),n=Ui(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};var fX=xr(bl()),wv=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");let n=t[0]?t[0].split(":"):[],o=t[1]?t[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=t.slice(0,n).join(":"),c=t.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[t,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(t)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){let t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){let n=t.length/2,o=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(fX.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}};var pX=xr(bl()),fM,pM,hM,rn=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};g([w({type:D.TeletexString})],rn.prototype,"teletexString",void 0);g([w({type:D.PrintableString})],rn.prototype,"printableString",void 0);g([w({type:D.UniversalString})],rn.prototype,"universalString",void 0);g([w({type:D.Utf8String})],rn.prototype,"utf8String",void 0);g([w({type:D.BmpString})],rn.prototype,"bmpString",void 0);rn=g([K({type:z.Choice})],rn);var Wg=class extends rn{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?pX.Convert.ToHex(this.anyValue):super.toString())}};g([w({type:D.IA5String})],Wg.prototype,"ia5String",void 0);g([w({type:D.Any})],Wg.prototype,"anyValue",void 0);Wg=g([K({type:z.Choice})],Wg);var Tp=class{constructor(e={}){this.type="",this.value=new Wg,Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Tp.prototype,"type",void 0);g([w({type:Wg})],Tp.prototype,"value",void 0);var Xu=fM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,fM.prototype)}};Xu=fM=g([K({type:z.Set,itemType:Tp})],Xu);var mM=pM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,pM.prototype)}};mM=pM=g([K({type:z.Sequence,itemType:Xu})],mM);var Kt=hM=class extends mM{constructor(e){super(e),Object.setPrototypeOf(this,hM.prototype)}};Kt=hM=g([K({type:z.Sequence})],Kt);var mve={fromASN:r=>wv.toString(qg.fromASN(r)),toASN:r=>qg.toASN(wv.fromString(r))},Qu=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Qu.prototype,"typeId",void 0);g([w({type:D.Any,context:0})],Qu.prototype,"value",void 0);var bv=class{constructor(e={}){this.partyName=new rn,Object.assign(this,e)}};g([w({type:rn,optional:!0,context:0,implicit:!0})],bv.prototype,"nameAssigner",void 0);g([w({type:rn,context:1,implicit:!0})],bv.prototype,"partyName",void 0);var qe=class{constructor(e={}){Object.assign(this,e)}};g([w({type:Qu,context:0,implicit:!0})],qe.prototype,"otherName",void 0);g([w({type:D.IA5String,context:1,implicit:!0})],qe.prototype,"rfc822Name",void 0);g([w({type:D.IA5String,context:2,implicit:!0})],qe.prototype,"dNSName",void 0);g([w({type:D.Any,context:3,implicit:!0})],qe.prototype,"x400Address",void 0);g([w({type:Kt,context:4,implicit:!1})],qe.prototype,"directoryName",void 0);g([w({type:bv,context:5})],qe.prototype,"ediPartyName",void 0);g([w({type:D.IA5String,context:6,implicit:!0})],qe.prototype,"uniformResourceIdentifier",void 0);g([w({type:D.OctetString,context:7,implicit:!0,converter:mve})],qe.prototype,"iPAddress",void 0);g([w({type:D.ObjectIdentifier,context:8,implicit:!0})],qe.prototype,"registeredID",void 0);qe=g([K({type:z.Choice})],qe);var Zu="1.3.6.1.5.5.7",Ju=`${Zu}.1`,hX=`${Zu}.2`,Pp=`${Zu}.3`,M8=`${Zu}.48`,Cvt=`${hX}.1`,Ivt=`${hX}.2`,gM=`${M8}.1`,yM=`${M8}.2`,vM=`${M8}.3`,wM=`${M8}.5`,Je="2.5.29";var bM,k8=`${Ju}.1`,Al=class{constructor(e={}){this.accessMethod="",this.accessLocation=new qe,Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Al.prototype,"accessMethod",void 0);g([w({type:qe})],Al.prototype,"accessLocation",void 0);var Mp=bM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,bM.prototype)}};Mp=bM=g([K({type:z.Sequence,itemType:Al})],Mp);var R8=`${Je}.35`,kp=class extends je{},pc=class{constructor(e={}){e&&Object.assign(this,e)}};g([w({type:kp,context:0,optional:!0,implicit:!0})],pc.prototype,"keyIdentifier",void 0);g([w({type:qe,context:1,optional:!0,implicit:!0,repeated:"sequence"})],pc.prototype,"authorityCertIssuer",void 0);g([w({type:D.Integer,context:2,optional:!0,implicit:!0,converter:gt})],pc.prototype,"authorityCertSerialNumber",void 0);var N8=`${Je}.19`,Rp=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};g([w({type:D.Boolean,defaultValue:!1})],Rp.prototype,"cA",void 0);g([w({type:D.Integer,optional:!0})],Rp.prototype,"pathLenConstraint",void 0);var EM,dr=EM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,EM.prototype)}};dr=EM=g([K({type:z.Sequence,itemType:qe})],dr);var xM,gve=`${Je}.29`,mX=xM=class extends dr{constructor(e){super(e),Object.setPrototypeOf(this,xM.prototype)}};mX=xM=g([K({type:z.Sequence})],mX);var SM,L8=`${Je}.32`,owt=`${L8}.0`,Dl=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};g([w({type:D.IA5String})],Dl.prototype,"ia5String",void 0);g([w({type:D.VisibleString})],Dl.prototype,"visibleString",void 0);g([w({type:D.BmpString})],Dl.prototype,"bmpString",void 0);g([w({type:D.Utf8String})],Dl.prototype,"utf8String",void 0);Dl=g([K({type:z.Choice})],Dl);var Ev=class{constructor(e={}){this.organization=new Dl,this.noticeNumbers=[],Object.assign(this,e)}};g([w({type:Dl})],Ev.prototype,"organization",void 0);g([w({type:D.Integer,repeated:"sequence"})],Ev.prototype,"noticeNumbers",void 0);var xv=class{constructor(e={}){Object.assign(this,e)}};g([w({type:Ev,optional:!0})],xv.prototype,"noticeRef",void 0);g([w({type:Dl,optional:!0})],xv.prototype,"explicitText",void 0);var O8=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.IA5String})],O8.prototype,"cPSuri",void 0);g([w({type:xv})],O8.prototype,"userNotice",void 0);O8=g([K({type:z.Choice})],O8);var Sv=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Sv.prototype,"policyQualifierId",void 0);g([w({type:D.Any})],Sv.prototype,"qualifier",void 0);var Np=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Np.prototype,"policyIdentifier",void 0);g([w({type:Sv,repeated:"sequence",optional:!0})],Np.prototype,"policyQualifiers",void 0);var _v=SM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,SM.prototype)}};_v=SM=g([K({type:z.Sequence,itemType:Np})],_v);var fwt=`${Je}.20`,Cv=class{constructor(e=0){this.value=e}};g([w({type:D.Integer})],Cv.prototype,"value",void 0);Cv=g([K({type:z.Choice})],Cv);var wwt=`${Je}.27`,gX=class extends Cv{};gX=g([K({type:z.Choice})],gX);var _M,F8=`${Je}.31`,hc=function(r){return r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise",r}(hc||{}),Iv=class extends fc{toJSON(){let e=[],t=this.toNumber();return t&hc.aACompromise&&e.push("aACompromise"),t&hc.affiliationChanged&&e.push("affiliationChanged"),t&hc.cACompromise&&e.push("cACompromise"),t&hc.certificateHold&&e.push("certificateHold"),t&hc.cessationOfOperation&&e.push("cessationOfOperation"),t&hc.keyCompromise&&e.push("keyCompromise"),t&hc.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&hc.superseded&&e.push("superseded"),t&hc.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}},Tl=class{constructor(e={}){Object.assign(this,e)}};g([w({type:qe,context:0,repeated:"sequence",implicit:!0})],Tl.prototype,"fullName",void 0);g([w({type:Xu,context:1,implicit:!0})],Tl.prototype,"nameRelativeToCRLIssuer",void 0);Tl=g([K({type:z.Choice})],Tl);var mc=class{constructor(e={}){Object.assign(this,e)}};g([w({type:Tl,context:0,optional:!0})],mc.prototype,"distributionPoint",void 0);g([w({type:Iv,context:1,optional:!0,implicit:!0})],mc.prototype,"reasons",void 0);g([w({type:qe,context:2,optional:!0,repeated:"sequence",implicit:!0})],mc.prototype,"cRLIssuer",void 0);var ed=_M=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,_M.prototype)}};ed=_M=g([K({type:z.Sequence,itemType:mc})],ed);var CM,Nwt=`${Je}.46`,yX=CM=class extends ed{constructor(e){super(e),Object.setPrototypeOf(this,CM.prototype)}};yX=CM=g([K({type:z.Sequence,itemType:mc})],yX);var Hwt=`${Je}.28`,ji=class r{constructor(e={}){this.onlyContainsUserCerts=r.ONLY,this.onlyContainsCACerts=r.ONLY,this.indirectCRL=r.ONLY,this.onlyContainsAttributeCerts=r.ONLY,Object.assign(this,e)}};ji.ONLY=!1;g([w({type:Tl,context:0,optional:!0})],ji.prototype,"distributionPoint",void 0);g([w({type:D.Boolean,context:1,defaultValue:ji.ONLY,implicit:!0})],ji.prototype,"onlyContainsUserCerts",void 0);g([w({type:D.Boolean,context:2,defaultValue:ji.ONLY,implicit:!0})],ji.prototype,"onlyContainsCACerts",void 0);g([w({type:Iv,context:3,optional:!0,implicit:!0})],ji.prototype,"onlySomeReasons",void 0);g([w({type:D.Boolean,context:4,defaultValue:ji.ONLY,implicit:!0})],ji.prototype,"indirectCRL",void 0);g([w({type:D.Boolean,context:5,defaultValue:ji.ONLY,implicit:!0})],ji.prototype,"onlyContainsAttributeCerts",void 0);var vX=`${Je}.21`,B8=function(r){return r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise",r}(B8||{}),Av=class{constructor(e=B8.unspecified){this.reason=B8.unspecified,this.reason=e}toJSON(){return B8[this.reason]}toString(){return this.toJSON()}};g([w({type:D.Enumerated})],Av.prototype,"reason",void 0);Av=g([K({type:z.Choice})],Av);var IM,U8=`${Je}.37`,Dv=IM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,IM.prototype)}};Dv=IM=g([K({type:z.Sequence,itemType:D.ObjectIdentifier})],Dv);var Jwt=`${U8}.0`,wX=`${Pp}.1`,bX=`${Pp}.2`,EX=`${Pp}.3`,xX=`${Pp}.4`,SX=`${Pp}.8`,_X=`${Pp}.9`;var obt=`${Je}.54`,AM=class{constructor(e=new ArrayBuffer(0)){this.value=e}};g([w({type:D.Integer,converter:gt})],AM.prototype,"value",void 0);AM=g([K({type:z.Choice})],AM);var CX=`${Je}.24`,Tv=class{constructor(e){this.value=new Date,e&&(this.value=e)}};g([w({type:D.GeneralizedTime})],Tv.prototype,"value",void 0);Tv=g([K({type:z.Choice})],Tv);var DM,gbt=`${Je}.18`,IX=DM=class extends dr{constructor(e){super(e),Object.setPrototypeOf(this,DM.prototype)}};IX=DM=g([K({type:z.Sequence})],IX);var V8=`${Je}.15`,gc=function(r){return r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly",r}(gc||{}),Gg=class extends fc{toJSON(){let e=this.toNumber(),t=[];return e&gc.cRLSign&&t.push("crlSign"),e&gc.dataEncipherment&&t.push("dataEncipherment"),e&gc.decipherOnly&&t.push("decipherOnly"),e&gc.digitalSignature&&t.push("digitalSignature"),e&gc.encipherOnly&&t.push("encipherOnly"),e&gc.keyAgreement&&t.push("keyAgreement"),e&gc.keyCertSign&&t.push("keyCertSign"),e&gc.keyEncipherment&&t.push("keyEncipherment"),e&gc.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}};var TM,Ibt=`${Je}.30`,Yg=class{constructor(e={}){this.base=new qe,this.minimum=0,Object.assign(this,e)}};g([w({type:qe})],Yg.prototype,"base",void 0);g([w({type:D.Integer,context:0,defaultValue:0,implicit:!0})],Yg.prototype,"minimum",void 0);g([w({type:D.Integer,context:1,optional:!0,implicit:!0})],Yg.prototype,"maximum",void 0);var j8=TM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,TM.prototype)}};j8=TM=g([K({type:z.Sequence,itemType:Yg})],j8);var H8=class{constructor(e={}){Object.assign(this,e)}};g([w({type:j8,context:0,optional:!0,implicit:!0})],H8.prototype,"permittedSubtrees",void 0);g([w({type:j8,context:1,optional:!0,implicit:!0})],H8.prototype,"excludedSubtrees",void 0);var kbt=`${Je}.36`,$8=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.Integer,context:0,implicit:!0,optional:!0,converter:gt})],$8.prototype,"requireExplicitPolicy",void 0);g([w({type:D.Integer,context:1,implicit:!0,optional:!0,converter:gt})],$8.prototype,"inhibitPolicyMapping",void 0);var PM,Fbt=`${Je}.33`,Pv=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Pv.prototype,"issuerDomainPolicy",void 0);g([w({type:D.ObjectIdentifier})],Pv.prototype,"subjectDomainPolicy",void 0);var AX=PM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,PM.prototype)}};AX=PM=g([K({type:z.Sequence,itemType:Pv})],AX);var MM,kM=`${Je}.17`,z8=MM=class extends dr{constructor(e){super(e),Object.setPrototypeOf(this,MM.prototype)}};z8=MM=g([K({type:z.Sequence})],z8);var zn=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],zn.prototype,"type",void 0);g([w({type:D.Any,repeated:"set"})],zn.prototype,"values",void 0);var RM,Jbt=`${Je}.9`,DX=RM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,RM.prototype)}};DX=RM=g([K({type:z.Sequence,itemType:zn})],DX);var NM=`${Je}.14`,ci=class extends kp{};var c3t=`${Je}.16`,q8=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.GeneralizedTime,context:0,implicit:!0,optional:!0})],q8.prototype,"notBefore",void 0);g([w({type:D.GeneralizedTime,context:1,implicit:!0,optional:!0})],q8.prototype,"notAfter",void 0);var K8=function(r){return r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate",r}(K8||{}),W8=class extends fc{toJSON(){let e=[],t=this.toNumber();return t&K8.pKIXCertificate&&e.push("pKIXCertificate"),t&K8.newExtensions&&e.push("newExtensions"),t&K8.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}},G8=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new W8,Object.assign(this,e)}};g([w({type:D.GeneralString})],G8.prototype,"entrustVers",void 0);g([w({type:W8})],G8.prototype,"entrustInfoFlags",void 0);var OM,y3t=`${Ju}.11`,TX=OM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,OM.prototype)}};TX=OM=g([K({type:z.Sequence,itemType:Al})],TX);var PX=xr(bl()),ue=class r{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof r&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&PX.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};g([w({type:D.ObjectIdentifier})],ue.prototype,"algorithm",void 0);g([w({type:D.Any,optional:!0})],ue.prototype,"parameters",void 0);var qn=class{constructor(e={}){this.algorithm=new ue,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:ue})],qn.prototype,"algorithm",void 0);g([w({type:D.BitString})],qn.prototype,"subjectPublicKey",void 0);var Rr=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};g([w({type:D.UTCTime})],Rr.prototype,"utcTime",void 0);g([w({type:D.GeneralizedTime})],Rr.prototype,"generalTime",void 0);Rr=g([K({type:z.Choice})],Rr);var Pl=class{constructor(e){this.notBefore=new Rr(new Date),this.notAfter=new Rr(new Date),e&&(this.notBefore=new Rr(e.notBefore),this.notAfter=new Rr(e.notAfter))}};g([w({type:Rr})],Pl.prototype,"notBefore",void 0);g([w({type:Rr})],Pl.prototype,"notAfter",void 0);var LM,Kn=class r{constructor(e={}){this.extnID="",this.critical=r.CRITICAL,this.extnValue=new je,Object.assign(this,e)}};Kn.CRITICAL=!1;g([w({type:D.ObjectIdentifier})],Kn.prototype,"extnID",void 0);g([w({type:D.Boolean,defaultValue:Kn.CRITICAL})],Kn.prototype,"critical",void 0);g([w({type:je})],Kn.prototype,"extnValue",void 0);var Hi=LM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,LM.prototype)}};Hi=LM=g([K({type:z.Sequence,itemType:Kn})],Hi);var td=function(r){return r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3",r}(td||{});var Wn=class{constructor(e={}){this.version=td.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ue,this.issuer=new Kt,this.validity=new Pl,this.subject=new Kt,this.subjectPublicKeyInfo=new qn,Object.assign(this,e)}};g([w({type:D.Integer,context:0,defaultValue:td.v1})],Wn.prototype,"version",void 0);g([w({type:D.Integer,converter:gt})],Wn.prototype,"serialNumber",void 0);g([w({type:ue})],Wn.prototype,"signature",void 0);g([w({type:Kt})],Wn.prototype,"issuer",void 0);g([w({type:Pl})],Wn.prototype,"validity",void 0);g([w({type:Kt})],Wn.prototype,"subject",void 0);g([w({type:qn})],Wn.prototype,"subjectPublicKeyInfo",void 0);g([w({type:D.BitString,context:1,implicit:!0,optional:!0})],Wn.prototype,"issuerUniqueID",void 0);g([w({type:D.BitString,context:2,implicit:!0,optional:!0})],Wn.prototype,"subjectUniqueID",void 0);g([w({type:Hi,context:3,optional:!0})],Wn.prototype,"extensions",void 0);var Cs=class{constructor(e={}){this.tbsCertificate=new Wn,this.signatureAlgorithm=new ue,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:Wn})],Cs.prototype,"tbsCertificate",void 0);g([w({type:ue})],Cs.prototype,"signatureAlgorithm",void 0);g([w({type:D.BitString})],Cs.prototype,"signatureValue",void 0);var Op=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Rr,Object.assign(this,e)}};g([w({type:D.Integer,converter:gt})],Op.prototype,"userCertificate",void 0);g([w({type:Rr})],Op.prototype,"revocationDate",void 0);g([w({type:Kn,optional:!0,repeated:"sequence"})],Op.prototype,"crlEntryExtensions",void 0);var $i=class{constructor(e={}){this.signature=new ue,this.issuer=new Kt,this.thisUpdate=new Rr,Object.assign(this,e)}};g([w({type:D.Integer,optional:!0})],$i.prototype,"version",void 0);g([w({type:ue})],$i.prototype,"signature",void 0);g([w({type:Kt})],$i.prototype,"issuer",void 0);g([w({type:Rr})],$i.prototype,"thisUpdate",void 0);g([w({type:Rr,optional:!0})],$i.prototype,"nextUpdate",void 0);g([w({type:Op,repeated:"sequence",optional:!0})],$i.prototype,"revokedCertificates",void 0);g([w({type:Kn,optional:!0,context:0,repeated:"sequence"})],$i.prototype,"crlExtensions",void 0);var Lp=class{constructor(e={}){this.tbsCertList=new $i,this.signatureAlgorithm=new ue,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:$i})],Lp.prototype,"tbsCertList",void 0);g([w({type:ue})],Lp.prototype,"signatureAlgorithm",void 0);g([w({type:D.BitString})],Lp.prototype,"signature",void 0);var pe=xr(bl());var _a=class{constructor(e={}){this.issuer=new Kt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:Kt})],_a.prototype,"issuer",void 0);g([w({type:D.Integer,converter:gt})],_a.prototype,"serialNumber",void 0);var Fp=class{constructor(e={}){Object.assign(this,e)}};g([w({type:ci,context:0,implicit:!0})],Fp.prototype,"subjectKeyIdentifier",void 0);g([w({type:_a})],Fp.prototype,"issuerAndSerialNumber",void 0);Fp=g([K({type:z.Choice})],Fp);var vo=function(r){return r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5",r}(vo||{}),Bp=class extends ue{};Bp=g([K({type:z.Sequence})],Bp);var Mv=class extends ue{};Mv=g([K({type:z.Sequence})],Mv);var li=class extends ue{};li=g([K({type:z.Sequence})],li);var kv=class extends ue{};kv=g([K({type:z.Sequence})],kv);var kX=class extends ue{};kX=g([K({type:z.Sequence})],kX);var Y8=class extends ue{};Y8=g([K({type:z.Sequence})],Y8);var Ca=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Ca.prototype,"attrType",void 0);g([w({type:D.Any,repeated:"set"})],Ca.prototype,"attrValues",void 0);var FM,ui=class{constructor(e={}){this.version=vo.v0,this.sid=new Fp,this.digestAlgorithm=new Bp,this.signatureAlgorithm=new Mv,this.signature=new je,Object.assign(this,e)}};g([w({type:D.Integer})],ui.prototype,"version",void 0);g([w({type:Fp})],ui.prototype,"sid",void 0);g([w({type:Bp})],ui.prototype,"digestAlgorithm",void 0);g([w({type:Ca,repeated:"set",context:0,implicit:!0,optional:!0})],ui.prototype,"signedAttrs",void 0);g([w({type:Mv})],ui.prototype,"signatureAlgorithm",void 0);g([w({type:je})],ui.prototype,"signature",void 0);g([w({type:Ca,repeated:"set",context:1,implicit:!0,optional:!0})],ui.prototype,"unsignedAttrs",void 0);var Rv=FM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,FM.prototype)}};Rv=FM=g([K({type:z.Set,itemType:ui})],Rv);var RX=class extends Rr{};RX=g([K({type:z.Choice})],RX);var NX=class extends ui{};NX=g([K({type:z.Sequence})],NX);var Nv=class{constructor(e={}){this.acIssuer=new qe,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};g([w({type:qe})],Nv.prototype,"acIssuer",void 0);g([w({type:D.Integer})],Nv.prototype,"acSerial",void 0);g([w({type:zn,repeated:"sequence"})],Nv.prototype,"attrs",void 0);var BM,Ov=BM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,BM.prototype)}};Ov=BM=g([K({type:z.Sequence,itemType:D.ObjectIdentifier})],Ov);var Xg=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};g([w({type:D.Integer,optional:!0})],Xg.prototype,"pathLenConstraint",void 0);g([w({type:Ov,implicit:!0,context:0,optional:!0})],Xg.prototype,"permittedAttrs",void 0);g([w({type:Ov,implicit:!0,context:1,optional:!0})],Xg.prototype,"excludedAttrs",void 0);g([w({type:D.Boolean,defaultValue:!0})],Xg.prototype,"permitUnSpecified",void 0);var Is=class{constructor(e={}){this.issuer=new dr,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:dr})],Is.prototype,"issuer",void 0);g([w({type:D.Integer,converter:gt})],Is.prototype,"serial",void 0);g([w({type:D.BitString,optional:!0})],Is.prototype,"issuerUID",void 0);var OX=function(r){return r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes",r}(OX||{}),As=class{constructor(e={}){this.digestedObjectType=OX.publicKey,this.digestAlgorithm=new ue,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.Enumerated})],As.prototype,"digestedObjectType",void 0);g([w({type:D.ObjectIdentifier,optional:!0})],As.prototype,"otherObjectTypeID",void 0);g([w({type:ue})],As.prototype,"digestAlgorithm",void 0);g([w({type:D.BitString})],As.prototype,"objectDigest",void 0);var Up=class{constructor(e={}){Object.assign(this,e)}};g([w({type:dr,optional:!0})],Up.prototype,"issuerName",void 0);g([w({type:Is,context:0,implicit:!0,optional:!0})],Up.prototype,"baseCertificateID",void 0);g([w({type:As,context:1,implicit:!0,optional:!0})],Up.prototype,"objectDigestInfo",void 0);var Vp=class{constructor(e={}){Object.assign(this,e)}};g([w({type:qe,repeated:"sequence"})],Vp.prototype,"v1Form",void 0);g([w({type:Up,context:0,implicit:!0})],Vp.prototype,"v2Form",void 0);Vp=g([K({type:z.Choice})],Vp);var jp=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};g([w({type:D.GeneralizedTime})],jp.prototype,"notBeforeTime",void 0);g([w({type:D.GeneralizedTime})],jp.prototype,"notAfterTime",void 0);var rd=class{constructor(e={}){Object.assign(this,e)}};g([w({type:Is,implicit:!0,context:0,optional:!0})],rd.prototype,"baseCertificateID",void 0);g([w({type:dr,implicit:!0,context:1,optional:!0})],rd.prototype,"entityName",void 0);g([w({type:As,implicit:!0,context:2,optional:!0})],rd.prototype,"objectDigestInfo",void 0);var LX=function(r){return r[r.v2=1]="v2",r}(LX||{}),di=class{constructor(e={}){this.version=LX.v2,this.holder=new rd,this.issuer=new Vp,this.signature=new ue,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new jp,this.attributes=[],Object.assign(this,e)}};g([w({type:D.Integer})],di.prototype,"version",void 0);g([w({type:rd})],di.prototype,"holder",void 0);g([w({type:Vp})],di.prototype,"issuer",void 0);g([w({type:ue})],di.prototype,"signature",void 0);g([w({type:D.Integer,converter:gt})],di.prototype,"serialNumber",void 0);g([w({type:jp})],di.prototype,"attrCertValidityPeriod",void 0);g([w({type:zn,repeated:"sequence"})],di.prototype,"attributes",void 0);g([w({type:D.BitString,optional:!0})],di.prototype,"issuerUniqueID",void 0);g([w({type:Hi,optional:!0})],di.prototype,"extensions",void 0);var Hp=class{constructor(e={}){this.acinfo=new di,this.signatureAlgorithm=new ue,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:di})],Hp.prototype,"acinfo",void 0);g([w({type:ue})],Hp.prototype,"signatureAlgorithm",void 0);g([w({type:D.BitString})],Hp.prototype,"signatureValue",void 0);var X8=function(r){return r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret",r}(X8||{}),Qg=class extends fc{};var Zg=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier,implicit:!0,context:0})],Zg.prototype,"type",void 0);g([w({type:D.Any,implicit:!0,context:1})],Zg.prototype,"value",void 0);var Lv=class{constructor(e={}){this.policyId="",this.classList=new Qg(X8.unclassified),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Lv.prototype,"policyId",void 0);g([w({type:Qg,defaultValue:new Qg(X8.unclassified)})],Lv.prototype,"classList",void 0);g([w({type:Zg,repeated:"set"})],Lv.prototype,"securityCategories",void 0);var Jg=class{constructor(e={}){Object.assign(this,e)}};g([w({type:je})],Jg.prototype,"cotets",void 0);g([w({type:D.ObjectIdentifier})],Jg.prototype,"oid",void 0);g([w({type:D.Utf8String})],Jg.prototype,"string",void 0);var Q8=class{constructor(e={}){this.values=[],Object.assign(this,e)}};g([w({type:dr,implicit:!0,context:0,optional:!0})],Q8.prototype,"policyAuthority",void 0);g([w({type:Jg,repeated:"sequence"})],Q8.prototype,"values",void 0);var Qxt=`${Ju}.4`,Zxt=`${Ju}.6`,Jxt=`${Ju}.10`,e6t=`${Je}.55`,Fv=`${Zu}.10`,t6t=`${Fv}.1`,r6t=`${Fv}.2`,n6t=`${Fv}.3`,o6t=`${Fv}.4`,i6t=`${Fv}.6`,UM="2.5.4",s6t=`${UM}.72`;var VM,e1=class{constructor(e={}){this.targetCertificate=new Is,Object.assign(this,e)}};g([w({type:Is})],e1.prototype,"targetCertificate",void 0);g([w({type:qe,optional:!0})],e1.prototype,"targetName",void 0);g([w({type:As,optional:!0})],e1.prototype,"certDigestInfo",void 0);var t1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:qe,context:0,implicit:!0})],t1.prototype,"targetName",void 0);g([w({type:qe,context:1,implicit:!0})],t1.prototype,"targetGroup",void 0);g([w({type:e1,context:2,implicit:!0})],t1.prototype,"targetCert",void 0);t1=g([K({type:z.Choice})],t1);var Z8=VM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,VM.prototype)}};Z8=VM=g([K({type:z.Sequence,itemType:t1})],Z8);var jM,FX=jM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,jM.prototype)}};FX=jM=g([K({type:z.Sequence,itemType:Z8})],FX);var J8=class{constructor(e={}){Object.assign(this,e)}};g([w({type:dr,implicit:!0,context:0,optional:!0})],J8.prototype,"roleAuthority",void 0);g([w({type:qe,implicit:!0,context:1})],J8.prototype,"roleName",void 0);var Bv=class{constructor(e={}){this.service=new qe,this.ident=new qe,Object.assign(this,e)}};g([w({type:qe})],Bv.prototype,"service",void 0);g([w({type:qe})],Bv.prototype,"ident",void 0);g([w({type:je,optional:!0})],Bv.prototype,"authInfo",void 0);var HM,Uv=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Uv.prototype,"otherCertFormat",void 0);g([w({type:D.Any})],Uv.prototype,"otherCert",void 0);var $p=class{constructor(e={}){Object.assign(this,e)}};g([w({type:Cs})],$p.prototype,"certificate",void 0);g([w({type:Hp,context:2,implicit:!0})],$p.prototype,"v2AttrCert",void 0);g([w({type:Uv,context:3,implicit:!0})],$p.prototype,"other",void 0);$p=g([K({type:z.Choice})],$p);var zp=HM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,HM.prototype)}};zp=HM=g([K({type:z.Set,itemType:$p})],zp);var Ds=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Ds.prototype,"contentType",void 0);g([w({type:D.Any,context:0})],Ds.prototype,"content",void 0);var r1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:je})],r1.prototype,"single",void 0);g([w({type:D.Any})],r1.prototype,"any",void 0);r1=g([K({type:z.Choice})],r1);var qp=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],qp.prototype,"eContentType",void 0);g([w({type:r1,context:0,optional:!0})],qp.prototype,"eContent",void 0);var Vv=class{constructor(e={}){Object.assign(this,e)}};g([w({type:je,context:0,implicit:!0,optional:!0})],Vv.prototype,"value",void 0);g([w({type:je,converter:uX,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Vv.prototype,"constructedValue",void 0);Vv=g([K({type:z.Choice})],Vv);var nd=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new kv,Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],nd.prototype,"contentType",void 0);g([w({type:kv})],nd.prototype,"contentEncryptionAlgorithm",void 0);g([w({type:Vv,optional:!0})],nd.prototype,"encryptedContent",void 0);var od=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],od.prototype,"keyAttrId",void 0);g([w({type:D.Any,optional:!0})],od.prototype,"keyAttr",void 0);var $M,n1=class{constructor(e={}){this.subjectKeyIdentifier=new ci,Object.assign(this,e)}};g([w({type:ci})],n1.prototype,"subjectKeyIdentifier",void 0);g([w({type:D.GeneralizedTime,optional:!0})],n1.prototype,"date",void 0);g([w({type:od,optional:!0})],n1.prototype,"other",void 0);var o1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:n1,context:0,implicit:!0,optional:!0})],o1.prototype,"rKeyId",void 0);g([w({type:_a,optional:!0})],o1.prototype,"issuerAndSerialNumber",void 0);o1=g([K({type:z.Choice})],o1);var jv=class{constructor(e={}){this.rid=new o1,this.encryptedKey=new je,Object.assign(this,e)}};g([w({type:o1})],jv.prototype,"rid",void 0);g([w({type:je})],jv.prototype,"encryptedKey",void 0);var eS=$M=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,$M.prototype)}};eS=$M=g([K({type:z.Sequence,itemType:jv})],eS);var Hv=class{constructor(e={}){this.algorithm=new ue,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:ue})],Hv.prototype,"algorithm",void 0);g([w({type:D.BitString})],Hv.prototype,"publicKey",void 0);var Kp=class{constructor(e={}){Object.assign(this,e)}};g([w({type:ci,context:0,implicit:!0,optional:!0})],Kp.prototype,"subjectKeyIdentifier",void 0);g([w({type:Hv,context:1,implicit:!0,optional:!0})],Kp.prototype,"originatorKey",void 0);g([w({type:_a,optional:!0})],Kp.prototype,"issuerAndSerialNumber",void 0);Kp=g([K({type:z.Choice})],Kp);var Ml=class{constructor(e={}){this.version=vo.v3,this.originator=new Kp,this.keyEncryptionAlgorithm=new li,this.recipientEncryptedKeys=new eS,Object.assign(this,e)}};g([w({type:D.Integer})],Ml.prototype,"version",void 0);g([w({type:Kp,context:0})],Ml.prototype,"originator",void 0);g([w({type:je,context:1,optional:!0})],Ml.prototype,"ukm",void 0);g([w({type:li})],Ml.prototype,"keyEncryptionAlgorithm",void 0);g([w({type:eS})],Ml.prototype,"recipientEncryptedKeys",void 0);var i1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:ci,context:0,implicit:!0})],i1.prototype,"subjectKeyIdentifier",void 0);g([w({type:_a})],i1.prototype,"issuerAndSerialNumber",void 0);i1=g([K({type:z.Choice})],i1);var id=class{constructor(e={}){this.version=vo.v0,this.rid=new i1,this.keyEncryptionAlgorithm=new li,this.encryptedKey=new je,Object.assign(this,e)}};g([w({type:D.Integer})],id.prototype,"version",void 0);g([w({type:i1})],id.prototype,"rid",void 0);g([w({type:li})],id.prototype,"keyEncryptionAlgorithm",void 0);g([w({type:je})],id.prototype,"encryptedKey",void 0);var Wp=class{constructor(e={}){this.keyIdentifier=new je,Object.assign(this,e)}};g([w({type:je})],Wp.prototype,"keyIdentifier",void 0);g([w({type:D.GeneralizedTime,optional:!0})],Wp.prototype,"date",void 0);g([w({type:od,optional:!0})],Wp.prototype,"other",void 0);var sd=class{constructor(e={}){this.version=vo.v4,this.kekid=new Wp,this.keyEncryptionAlgorithm=new li,this.encryptedKey=new je,Object.assign(this,e)}};g([w({type:D.Integer})],sd.prototype,"version",void 0);g([w({type:Wp})],sd.prototype,"kekid",void 0);g([w({type:li})],sd.prototype,"keyEncryptionAlgorithm",void 0);g([w({type:je})],sd.prototype,"encryptedKey",void 0);var ad=class{constructor(e={}){this.version=vo.v0,this.keyEncryptionAlgorithm=new li,this.encryptedKey=new je,Object.assign(this,e)}};g([w({type:D.Integer})],ad.prototype,"version",void 0);g([w({type:Y8,context:0,optional:!0})],ad.prototype,"keyDerivationAlgorithm",void 0);g([w({type:li})],ad.prototype,"keyEncryptionAlgorithm",void 0);g([w({type:je})],ad.prototype,"encryptedKey",void 0);var $v=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],$v.prototype,"oriType",void 0);g([w({type:D.Any})],$v.prototype,"oriValue",void 0);var kl=class{constructor(e={}){Object.assign(this,e)}};g([w({type:id,optional:!0})],kl.prototype,"ktri",void 0);g([w({type:Ml,context:1,implicit:!0,optional:!0})],kl.prototype,"kari",void 0);g([w({type:sd,context:2,implicit:!0,optional:!0})],kl.prototype,"kekri",void 0);g([w({type:ad,context:3,implicit:!0,optional:!0})],kl.prototype,"pwri",void 0);g([w({type:$v,context:4,implicit:!0,optional:!0})],kl.prototype,"ori",void 0);kl=g([K({type:z.Choice})],kl);var zM,zv=zM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,zM.prototype)}};zv=zM=g([K({type:z.Set,itemType:kl})],zv);var qM,BX=`${Zu}.16`,i8t=`${BX}.2`,s8t=`${BX}.4`,s1=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],s1.prototype,"otherRevInfoFormat",void 0);g([w({type:D.Any})],s1.prototype,"otherRevInfo",void 0);var tS=class{constructor(e={}){this.other=new s1,Object.assign(this,e)}};g([w({type:s1,context:1,implicit:!0})],tS.prototype,"other",void 0);tS=g([K({type:z.Choice})],tS);var a1=qM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,qM.prototype)}};a1=qM=g([K({type:z.Set,itemType:tS})],a1);var c1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:zp,context:0,implicit:!0,optional:!0})],c1.prototype,"certs",void 0);g([w({type:a1,context:1,implicit:!0,optional:!0})],c1.prototype,"crls",void 0);var KM,WM=KM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,KM.prototype)}};WM=KM=g([K({type:z.Set,itemType:Ca})],WM);var Gp=class{constructor(e={}){this.version=vo.v0,this.recipientInfos=new zv,this.encryptedContentInfo=new nd,Object.assign(this,e)}};g([w({type:D.Integer})],Gp.prototype,"version",void 0);g([w({type:c1,context:0,implicit:!0,optional:!0})],Gp.prototype,"originatorInfo",void 0);g([w({type:zv})],Gp.prototype,"recipientInfos",void 0);g([w({type:nd})],Gp.prototype,"encryptedContentInfo",void 0);g([w({type:WM,context:1,implicit:!0,optional:!0})],Gp.prototype,"unprotectedAttrs",void 0);var UX="1.2.840.113549.1.7.2";var GM,rS=GM=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,GM.prototype)}};rS=GM=g([K({type:z.Set,itemType:Bp})],rS);var Rl=class{constructor(e={}){this.version=vo.v0,this.digestAlgorithms=new rS,this.encapContentInfo=new qp,this.signerInfos=new Rv,Object.assign(this,e)}};g([w({type:D.Integer})],Rl.prototype,"version",void 0);g([w({type:rS})],Rl.prototype,"digestAlgorithms",void 0);g([w({type:qp})],Rl.prototype,"encapContentInfo",void 0);g([w({type:zp,context:0,implicit:!0,optional:!0})],Rl.prototype,"certificates",void 0);g([w({type:a1,context:1,implicit:!0,optional:!0})],Rl.prototype,"crls",void 0);g([w({type:Rv})],Rl.prototype,"signerInfos",void 0);var Yp="1.2.840.10045.2.1";var qv="1.2.840.10045.4.1",nS="1.2.840.10045.4.3.1",Kv="1.2.840.10045.4.3.2",Wv="1.2.840.10045.4.3.3",Gv="1.2.840.10045.4.3.4";var YM="1.2.840.10045.3.1.7";var XM="1.3.132.0.34";var QM="1.3.132.0.35";function Yv(r){return new ue({algorithm:r})}var jX=Yv(qv),rSt=Yv(nS),HX=Yv(Kv),$X=Yv(Wv),zX=Yv(Gv);var Xv=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],Xv.prototype,"fieldType",void 0);g([w({type:D.Any})],Xv.prototype,"parameters",void 0);Xv=g([K({type:z.Sequence})],Xv);var ZM=class extends je{};var l1=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.OctetString})],l1.prototype,"a",void 0);g([w({type:D.OctetString})],l1.prototype,"b",void 0);g([w({type:D.BitString,optional:!0})],l1.prototype,"seed",void 0);l1=g([K({type:z.Sequence})],l1);var qX=function(r){return r[r.ecpVer1=1]="ecpVer1",r}(qX||{}),yc=class{constructor(e={}){this.version=qX.ecpVer1,Object.assign(this,e)}};g([w({type:D.Integer})],yc.prototype,"version",void 0);g([w({type:Xv})],yc.prototype,"fieldID",void 0);g([w({type:l1})],yc.prototype,"curve",void 0);g([w({type:ZM})],yc.prototype,"base",void 0);g([w({type:D.Integer,converter:gt})],yc.prototype,"order",void 0);g([w({type:D.Integer,optional:!0})],yc.prototype,"cofactor",void 0);yc=g([K({type:z.Sequence})],yc);var vc=class{constructor(e={}){Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],vc.prototype,"namedCurve",void 0);g([w({type:D.Null})],vc.prototype,"implicitCurve",void 0);g([w({type:yc})],vc.prototype,"specifiedCurve",void 0);vc=g([K({type:z.Choice})],vc);var u1=class{constructor(e={}){this.version=1,this.privateKey=new je,Object.assign(this,e)}};g([w({type:D.Integer})],u1.prototype,"version",void 0);g([w({type:je})],u1.prototype,"privateKey",void 0);g([w({type:vc,context:0,optional:!0})],u1.prototype,"parameters",void 0);g([w({type:D.BitString,context:1,optional:!0})],u1.prototype,"publicKey",void 0);var Xp=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.Integer,converter:gt})],Xp.prototype,"r",void 0);g([w({type:D.Integer,converter:gt})],Xp.prototype,"s",void 0);var fi="1.2.840.113549.1.1",wc=`${fi}.1`,KX=`${fi}.7`,WX=`${fi}.9`,cd=`${fi}.10`,GX=`${fi}.2`,YX=`${fi}.4`,d1=`${fi}.5`,XX=`${fi}.14`;var oS=`${fi}.11`,f1=`${fi}.12`,p1=`${fi}.13`,JM=`${fi}.15`,ek=`${fi}.16`,Qp="1.3.14.3.2.26",iS="2.16.840.1.101.3.4.2.4",Zp="2.16.840.1.101.3.4.2.1",Jp="2.16.840.1.101.3.4.2.2",eh="2.16.840.1.101.3.4.2.3",QX="2.16.840.1.101.3.4.2.5",ZX="2.16.840.1.101.3.4.2.6",JX="1.2.840.113549.2.2",eQ="1.2.840.113549.2.5",ld=`${fi}.8`;function fn(r){return new ue({algorithm:r,parameters:null})}var PSt=fn(JX),MSt=fn(eQ),Nl=fn(Qp),kSt=fn(iS),RSt=fn(Zp),NSt=fn(Jp),OSt=fn(eh),LSt=fn(QX),FSt=fn(ZX),sS=new ue({algorithm:ld,parameters:ge.serialize(Nl)}),tk=new ue({algorithm:WX,parameters:ge.serialize(qg.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))}),BSt=fn(wc),USt=fn(GX),VSt=fn(YX),jSt=fn(d1),HSt=fn(JM),$St=fn(ek),zSt=fn(f1),qSt=fn(p1),KSt=fn(JM),WSt=fn(ek);var h1=class{constructor(e={}){this.hashAlgorithm=new ue(Nl),this.maskGenAlgorithm=new ue({algorithm:ld,parameters:ge.serialize(Nl)}),this.pSourceAlgorithm=new ue(tk),Object.assign(this,e)}};g([w({type:ue,context:0,defaultValue:Nl})],h1.prototype,"hashAlgorithm",void 0);g([w({type:ue,context:1,defaultValue:sS})],h1.prototype,"maskGenAlgorithm",void 0);g([w({type:ue,context:2,defaultValue:tk})],h1.prototype,"pSourceAlgorithm",void 0);var e_t=new ue({algorithm:KX,parameters:ge.serialize(new h1)});var bc=class{constructor(e={}){this.hashAlgorithm=new ue(Nl),this.maskGenAlgorithm=new ue({algorithm:ld,parameters:ge.serialize(Nl)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};g([w({type:ue,context:0,defaultValue:Nl})],bc.prototype,"hashAlgorithm",void 0);g([w({type:ue,context:1,defaultValue:sS})],bc.prototype,"maskGenAlgorithm",void 0);g([w({type:D.Integer,context:2,defaultValue:20})],bc.prototype,"saltLength",void 0);g([w({type:D.Integer,context:3,defaultValue:1})],bc.prototype,"trailerField",void 0);var a_t=new ue({algorithm:cd,parameters:ge.serialize(new bc)});var th=class{constructor(e={}){this.digestAlgorithm=new ue,this.digest=new je,Object.assign(this,e)}};g([w({type:ue})],th.prototype,"digestAlgorithm",void 0);g([w({type:je})],th.prototype,"digest",void 0);var rk,m1=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.Integer,converter:gt})],m1.prototype,"prime",void 0);g([w({type:D.Integer,converter:gt})],m1.prototype,"exponent",void 0);g([w({type:D.Integer,converter:gt})],m1.prototype,"coefficient",void 0);var aS=rk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,rk.prototype)}};aS=rk=g([K({type:z.Sequence,itemType:m1})],aS);var Ts=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.Integer})],Ts.prototype,"version",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"modulus",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"publicExponent",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"privateExponent",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"prime1",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"prime2",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"exponent1",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"exponent2",void 0);g([w({type:D.Integer,converter:gt})],Ts.prototype,"coefficient",void 0);g([w({type:aS,optional:!0})],Ts.prototype,"otherPrimeInfos",void 0);var g1=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.Integer,converter:gt})],g1.prototype,"modulus",void 0);g([w({type:D.Integer,converter:gt})],g1.prototype,"publicExponent",void 0);var tQ=function(r){return r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped",r}(tQ||{}),Gn=tQ;var xve="injectionTokens";function nk(r){let e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(xve,r)||{};return Object.keys(t).forEach(n=>{e[+n]=t[n]}),e}function rQ(r,e,t,n){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?i(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function Qv(r){return!!r.useClass}function y1(r){return!!r.useFactory}var v1=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},n=!1,o,i=()=>(n||(o=e(this.wrap()),n=!0),o);return new Proxy(t,this.createHandler(i))}createHandler(e){let t={},n=o=>{t[o]=(...i)=>{i[0]=e();let s=Reflect[o];return s(...i)}};return this.reflectMethods.forEach(n),t}};function ud(r){return typeof r=="string"||typeof r=="symbol"}function ok(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function cS(r){return typeof r=="object"&&"token"in r&&"transform"in r}function nQ(r){return typeof r=="function"||r instanceof v1}function rh(r){return!!r.useToken}function nh(r){return r.useValue!=null}function oQ(r){return Qv(r)||nh(r)||rh(r)||y1(r)}var oh=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};var lS=class extends oh{};var ih=class{constructor(){this.scopedResolutions=new Map}};function Sve(r,e){return r===null?`at position #${e}`:`"${r.split(",")[e].trim()}" at position #${e}`}function _ve(r,e,t="    "){return[r,...e.message.split(`
`).map(n=>t+n)].join(`
`)}function ik(r,e,t){let[,n=null]=r.toString().match(/constructor\(([\w, ]+)\)/)||[],o=Sve(n,e);return _ve(`Cannot inject the dependency ${o} of "${r.name}" constructor. Reason:`,t)}function iQ(r){return!(typeof r.dispose!="function"||r.dispose.length>0)}var sk=class extends oh{},ak=class extends oh{},uS=class{constructor(){this.preResolution=new sk,this.postResolution=new ak}};var lk=new Map,ck=class r{constructor(e){this.parent=e,this._registry=new lS,this.interceptors=new uS,this.disposed=!1,this.disposables=new Set}register(e,t,n={lifecycle:Gn.Transient}){this.ensureNotDisposed();let o;if(oQ(t)?o=t:o={useClass:t},rh(o)){let i=[e],s=o;for(;s!=null;){let a=s.useToken;if(i.includes(a))throw new Error(`Token registration cycle detected! ${[...i,a].join(" -> ")}`);i.push(a);let c=this._registry.get(a);c&&rh(c.provider)?s=c.provider:s=null}}if((n.lifecycle===Gn.Singleton||n.lifecycle==Gn.ContainerScoped||n.lifecycle==Gn.ResolutionScoped)&&(nh(o)||y1(o)))throw new Error(`Cannot use lifecycle "${Gn[n.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:o,options:n}),this}registerType(e,t){return this.ensureNotDisposed(),ud(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),ud(e)){if(ud(t))return this.register(e,{useToken:t},{lifecycle:Gn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Gn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let n=e;return t&&!ud(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:Gn.Singleton})}resolve(e,t=new ih,n=!1){this.ensureNotDisposed();let o=this.getRegistration(e);if(!o&&ud(e)){if(n)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),o){let i=this.resolveRegistration(o,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(nQ(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let n=[];for(let o of this.interceptors.preResolution.getAll(e))o.options.frequency!="Once"&&n.push(o),o.callback(e,t);this.interceptors.preResolution.setAll(e,n)}}executePostResolutionInterceptor(e,t,n){if(this.interceptors.postResolution.has(e)){let o=[];for(let i of this.interceptors.postResolution.getAll(e))i.options.frequency!="Once"&&o.push(i),i.callback(e,t,n);this.interceptors.postResolution.setAll(e,o)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Gn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let n=e.options.lifecycle===Gn.Singleton,o=e.options.lifecycle===Gn.ContainerScoped,i=n||o,s;return nh(e.provider)?s=e.provider.useValue:rh(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Qv(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):y1(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,t),e.options.lifecycle===Gn.ResolutionScoped&&t.scopedResolutions.set(e,s),s}resolveAll(e,t=new ih,n=!1){this.ensureNotDisposed();let o=this.getAllRegistrations(e);if(!o&&ud(e)){if(n)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),o){let s=o.map(a=>this.resolveRegistration(a,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(n=>!nh(n.provider)).map(n=>(n.instance=void 0,n)))}createChildContainer(){this.ensureNotDisposed();let e=new r(this);for(let[t,n]of this._registry.entries())n.some(({options:o})=>o.lifecycle===Gn.ContainerScoped)&&e._registry.setAll(t,n.map(o=>o.options.lifecycle===Gn.ContainerScoped?{provider:o.provider,options:o.options}:o));return e}beforeResolution(e,t,n={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:n})}afterResolution(e,t,n={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:n})}dispose(){return rQ(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let n=t.dispose();n&&e.push(n)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof v1)return e.createProxy(o=>this.resolve(o,t));let n=(()=>{let o=lk.get(e);if(!o||o.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let i=o.map(this.resolveParams(t,e));return new e(...i)})();return iQ(n)&&this.disposables.add(n),n}resolveParams(e,t){return(n,o)=>{try{return ok(n)?cS(n)?n.multiple?this.resolve(n.transform).transform(this.resolveAll(n.token,new ih,n.isOptional),...n.transformArgs):this.resolve(n.transform).transform(this.resolve(n.token,e,n.isOptional),...n.transformArgs):n.multiple?this.resolveAll(n.token,new ih,n.isOptional):this.resolve(n.token,e,n.isOptional):cS(n)?this.resolve(n.transform,e).transform(this.resolve(n.token,e),...n.transformArgs):this.resolve(n,e)}catch(i){throw new Error(ik(t,o,i))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}},fr=new ck;function Cve(r){return function(e){lk.set(e,nk(e)),r&&r.token&&(Array.isArray(r.token)?r.token.forEach(t=>{fr.register(t,e)}):fr.register(r.token,e))}}var dd=Cve;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var dk,sh=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};g([w({type:D.ObjectIdentifier})],sh.prototype,"attrId",void 0);g([w({type:D.Any,repeated:"set"})],sh.prototype,"attrValues",void 0);var sQ=dk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,dk.prototype)}};sQ=dk=g([K({type:z.Sequence,itemType:sh})],sQ);var fk,aQ=fk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,fk.prototype)}};aQ=fk=g([K({type:z.Sequence,itemType:Ds})],aQ);var Ive="1.2.840.113549",Ave=`${Ive}.1`,cQ=`${Ave}.12`,w1=`${cQ}.1`,U7t=`${w1}.1`,V7t=`${w1}.2`,j7t=`${w1}.3`,H7t=`${w1}.4`,$7t=`${w1}.5`,z7t=`${w1}.6`,ah=`${cQ}.10.1`;var W7t=`${ah}.1`,G7t=`${ah}.2`,Y7t=`${ah}.3`,X7t=`${ah}.4`,Q7t=`${ah}.5`,Z7t=`${ah}.6`,dS="1.2.840.113549.1.9";var fS=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],fS.prototype,"certId",void 0);g([w({type:D.Any,context:0})],fS.prototype,"certValue",void 0);var lQ=`${dS}.22`,nIt=`${lQ}.1`,oIt=`${lQ}.2`;var pS=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],pS.prototype,"crlId",void 0);g([w({type:D.Any,context:0})],pS.prototype,"crltValue",void 0);var Dve=`${dS}.23`,lIt=`${Dve}.1`;var hS=class extends je{},fd=class{constructor(e={}){this.encryptionAlgorithm=new ue,this.encryptedData=new hS,Object.assign(this,e)}};g([w({type:ue})],fd.prototype,"encryptionAlgorithm",void 0);g([w({type:hS})],fd.prototype,"encryptedData",void 0);var pk,uQ=function(r){return r[r.v1=0]="v1",r}(uQ||{}),mS=class extends je{},hk=pk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,pk.prototype)}};hk=pk=g([K({type:z.Sequence,itemType:zn})],hk);var pd=class{constructor(e={}){this.version=uQ.v1,this.privateKeyAlgorithm=new ue,this.privateKey=new mS,Object.assign(this,e)}};g([w({type:D.Integer})],pd.prototype,"version",void 0);g([w({type:ue})],pd.prototype,"privateKeyAlgorithm",void 0);g([w({type:mS})],pd.prototype,"privateKey",void 0);g([w({type:hk,implicit:!0,context:0,optional:!0})],pd.prototype,"attributes",void 0);var dQ=class extends pd{};dQ=g([K({type:z.Sequence})],dQ);var fQ=class extends fd{};fQ=g([K({type:z.Sequence})],fQ);var gS=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],gS.prototype,"secretTypeId",void 0);g([w({type:D.Any,context:0})],gS.prototype,"secretValue",void 0);var hd=class{constructor(e={}){this.mac=new th,this.macSalt=new je,this.iterations=1,Object.assign(this,e)}};g([w({type:th})],hd.prototype,"mac",void 0);g([w({type:je})],hd.prototype,"macSalt",void 0);g([w({type:D.Integer,defaultValue:1})],hd.prototype,"iterations",void 0);var ch=class{constructor(e={}){this.version=3,this.authSafe=new Ds,this.macData=new hd,Object.assign(this,e)}};g([w({type:D.Integer})],ch.prototype,"version",void 0);g([w({type:Ds})],ch.prototype,"authSafe",void 0);g([w({type:hd,optional:!0})],ch.prototype,"macData",void 0);var mk,b1=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:D.ObjectIdentifier})],b1.prototype,"bagId",void 0);g([w({type:D.Any,context:0})],b1.prototype,"bagValue",void 0);g([w({type:sh,repeated:"set",optional:!0})],b1.prototype,"bagAttributes",void 0);var pQ=mk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,mk.prototype)}};pQ=mk=g([K({type:z.Sequence,itemType:b1})],pQ);var gk,yk,vk,Nr="1.2.840.113549.1.9",d9t=`${Nr}.0`,AQ=`${Nr}.24`,Jv=`${Nr}.25`,DQ=`${Nr}.26`,TQ=`${Nr}.27`,f9t=`${AQ}.1`,p9t=`${AQ}.2`,h9t=`${Nr}.1`,m9t=`${Nr}.2`,g9t=`${Nr}.3`,y9t=`${Nr}.4`,v9t=`${Nr}.5`,w9t=`${Nr}.6`,Ik=`${Nr}.7`,b9t=`${Nr}.8`,E9t=`${Nr}.9`,x9t=`${Nr}.13`,wS=`${Nr}.14`,S9t=`${Nr}.15`,_9t=`${Nr}.20`,C9t=`${Nr}.21`;var I9t=`${Jv}.1`,A9t=`${Jv}.2`,D9t=`${Jv}.3`,T9t=`${Jv}.4`,P9t=`${Jv}.5`,ew="1.3.6.1.5.5.7.9",M9t=`${ew}.1`,k9t=`${ew}.2`,R9t=`${ew}.3`,N9t=`${ew}.4`,O9t=`${ew}.5`,L9t=`${DQ}.1`,F9t=`${DQ}.2`,B9t=`${TQ}.1`,U9t=`${TQ}.2`,V9t=`${Nr}.16`,j9t=`${Nr}.22`,H9t=`${Nr}.23`,$9t=`${UM}.65`,yS=class extends rn{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};g([w({type:D.IA5String})],yS.prototype,"ia5String",void 0);yS=g([K({type:z.Choice})],yS);var hQ=class extends Ds{};hQ=g([K({type:z.Sequence})],hQ);var mQ=class extends ch{};mQ=g([K({type:z.Sequence})],mQ);var gQ=class extends fd{};gQ=g([K({type:z.Sequence})],gQ);var wk=class{constructor(e=""){this.value=e}toString(){return this.value}};g([w({type:D.IA5String})],wk.prototype,"value",void 0);wk=g([K({type:z.Choice})],wk);var yQ=class extends yS{};yQ=g([K({type:z.Choice})],yQ);var vQ=class extends rn{};vQ=g([K({type:z.Choice})],vQ);var bk=class{constructor(e=new Date){this.value=e}};g([w({type:D.GeneralizedTime})],bk.prototype,"value",void 0);bk=g([K({type:z.Choice})],bk);var wQ=class extends rn{};wQ=g([K({type:z.Choice})],wQ);var Ek=class{constructor(e="M"){this.value=e}toString(){return this.value}};g([w({type:D.PrintableString})],Ek.prototype,"value",void 0);Ek=g([K({type:z.Choice})],Ek);var vS=class{constructor(e=""){this.value=e}toString(){return this.value}};g([w({type:D.PrintableString})],vS.prototype,"value",void 0);vS=g([K({type:z.Choice})],vS);var bQ=class extends vS{};bQ=g([K({type:z.Choice})],bQ);var EQ=class extends rn{};EQ=g([K({type:z.Choice})],EQ);var xk=class{constructor(e=""){this.value=e}toString(){return this.value}};g([w({type:D.ObjectIdentifier})],xk.prototype,"value",void 0);xk=g([K({type:z.Choice})],xk);var xQ=class extends Rr{};xQ=g([K({type:z.Choice})],xQ);var Sk=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};g([w({type:D.Integer})],Sk.prototype,"value",void 0);Sk=g([K({type:z.Choice})],Sk);var SQ=class extends ui{};SQ=g([K({type:z.Sequence})],SQ);var Zv=class extends rn{};Zv=g([K({type:z.Choice})],Zv);var _Q=gk=class extends Hi{constructor(e){super(e),Object.setPrototypeOf(this,gk.prototype)}};_Q=gk=g([K({type:z.Sequence})],_Q);var CQ=yk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,yk.prototype)}};CQ=yk=g([K({type:z.Set,itemType:Ca})],CQ);var _k=class{constructor(e=""){this.value=e}toString(){return this.value}};g([w({type:D.BmpString})],_k.prototype,"value",void 0);_k=g([K({type:z.Choice})],_k);var Ck=class extends ue{};Ck=g([K({type:z.Sequence})],Ck);var IQ=vk=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,vk.prototype)}};IQ=vk=g([K({type:z.Sequence,itemType:Ck})],IQ);var Ak,tw=Ak=class extends Re{constructor(e){super(e),Object.setPrototypeOf(this,Ak.prototype)}};tw=Ak=g([K({type:z.Sequence,itemType:zn})],tw);var Ec=class{constructor(e={}){this.version=0,this.subject=new Kt,this.subjectPKInfo=new qn,this.attributes=new tw,Object.assign(this,e)}};g([w({type:D.Integer})],Ec.prototype,"version",void 0);g([w({type:Kt})],Ec.prototype,"subject",void 0);g([w({type:qn})],Ec.prototype,"subjectPKInfo",void 0);g([w({type:tw,implicit:!0,context:0})],Ec.prototype,"attributes",void 0);var E1=class{constructor(e={}){this.certificationRequestInfo=new Ec,this.signatureAlgorithm=new ue,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};g([w({type:Ec})],E1.prototype,"certificationRequestInfo",void 0);g([w({type:ue})],E1.prototype,"signatureAlgorithm",void 0);g([w({type:D.BitString})],E1.prototype,"signature",void 0);var aw="crypto.algorithm",Fk=class{getAlgorithms(){return fr.resolveAll(aw)}toAsnAlgorithm(e){v({},e);for(let t of this.getAlgorithms()){let n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let t=new ue({algorithm:e.name});if("parameters"in e){let n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},x1="crypto.algorithmProvider";fr.registerSingleton(x1,Fk);var SS,mi="1.3.36.3.3.2.8.1.1",PQ=`${mi}.1`,MQ=`${mi}.2`,kQ=`${mi}.3`,RQ=`${mi}.4`,NQ=`${mi}.5`,OQ=`${mi}.6`,LQ=`${mi}.7`,FQ=`${mi}.8`,BQ=`${mi}.9`,UQ=`${mi}.10`,VQ=`${mi}.11`,jQ=`${mi}.12`,HQ=`${mi}.13`,$Q=`${mi}.14`,zQ="brainpoolP160r1",qQ="brainpoolP160t1",KQ="brainpoolP192r1",WQ="brainpoolP192t1",GQ="brainpoolP224r1",YQ="brainpoolP224t1",XQ="brainpoolP256r1",QQ="brainpoolP256t1",ZQ="brainpoolP320r1",JQ="brainpoolP320t1",eZ="brainpoolP384r1",tZ="brainpoolP384t1",rZ="brainpoolP512r1",nZ="brainpoolP512t1",Er="ECDSA",nw=SS=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Er.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return jX;case"sha-256":return HX;case"sha-384":return $X;case"sha-512":return zX}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=YM;break;case"K-256":t=SS.SECP256K1;break;case"P-384":t=XM;break;case"P-521":t=QM;break;case zQ:t=PQ;break;case qQ:t=MQ;break;case KQ:t=kQ;break;case WQ:t=RQ;break;case GQ:t=NQ;break;case YQ:t=OQ;break;case XQ:t=LQ;break;case QQ:t=FQ;break;case ZQ:t=BQ;break;case JQ:t=UQ;break;case eZ:t=VQ;break;case tZ:t=jQ;break;case rZ:t=HQ;break;case nZ:t=$Q;break}if(t)return new ue({algorithm:Yp,parameters:ge.serialize(new vc({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case qv:return{name:Er,hash:{name:"SHA-1"}};case Kv:return{name:Er,hash:{name:"SHA-256"}};case Wv:return{name:Er,hash:{name:"SHA-384"}};case Gv:return{name:Er,hash:{name:"SHA-512"}};case Yp:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(ge.parse(e.parameters,vc).namedCurve){case YM:return{name:Er,namedCurve:"P-256"};case SS.SECP256K1:return{name:Er,namedCurve:"K-256"};case XM:return{name:Er,namedCurve:"P-384"};case QM:return{name:Er,namedCurve:"P-521"};case PQ:return{name:Er,namedCurve:zQ};case MQ:return{name:Er,namedCurve:qQ};case kQ:return{name:Er,namedCurve:KQ};case RQ:return{name:Er,namedCurve:WQ};case NQ:return{name:Er,namedCurve:GQ};case OQ:return{name:Er,namedCurve:YQ};case LQ:return{name:Er,namedCurve:XQ};case FQ:return{name:Er,namedCurve:QQ};case BQ:return{name:Er,namedCurve:ZQ};case UQ:return{name:Er,namedCurve:JQ};case VQ:return{name:Er,namedCurve:eZ};case jQ:return{name:Er,namedCurve:tZ};case HQ:return{name:Er,namedCurve:rZ};case $Q:return{name:Er,namedCurve:nZ}}}}return null}};nw.SECP256K1="1.3.132.0.10";nw=SS=g([dd()],nw);fr.registerSingleton(aw,nw);var oZ=Symbol("name"),iZ=Symbol("value"),rr=(()=>{class r{constructor(t,n={},o=""){this[oZ]=t,this[iZ]=o;for(let i in n)this[i]=n[i]}}return r.NAME=oZ,r.VALUE=iZ,r})(),Bk=class{static toTextObject(e){let t=new rr("Algorithm Identifier",{},Sc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Yp:{let n=new nw().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}},Sc=class{static toString(e){let t=this.items[e];return t||e}};Sc.items={[Qp]:"sha1",[iS]:"sha224",[Zp]:"sha256",[Jp]:"sha384",[eh]:"sha512",[wc]:"rsaEncryption",[d1]:"sha1WithRSAEncryption",[XX]:"sha224WithRSAEncryption",[oS]:"sha256WithRSAEncryption",[f1]:"sha384WithRSAEncryption",[p1]:"sha512WithRSAEncryption",[Yp]:"ecPublicKey",[qv]:"ecdsaWithSHA1",[nS]:"ecdsaWithSHA224",[Kv]:"ecdsaWithSHA256",[Wv]:"ecdsaWithSHA384",[Gv]:"ecdsaWithSHA512",[wX]:"TLS WWW server authentication",[bX]:"TLS WWW client authentication",[EX]:"Code Signing",[xX]:"E-mail Protection",[SX]:"Time Stamping",[_X]:"OCSP Signing",[UX]:"Signed Data"};var CS=(()=>{class r{static serialize(t){return this.serializeObj(t).join(`
`)}static pad(t=0){return"".padStart(2*t," ")}static serializeObj(t,n=0){let o=[],i=this.pad(n++),s="",a=t[rr.VALUE];a&&(s=` ${a}`),o.push(`${i}${t[rr.NAME]}:${s}`),i=this.pad(n);for(let c in t){if(typeof c=="symbol")continue;let l=t[c],u=c?`${c}: `:"";if(typeof l=="string"||typeof l=="number"||typeof l=="boolean")o.push(`${i}${u}${l}`);else if(l instanceof Date)o.push(`${i}${u}${l.toUTCString()}`);else if(Array.isArray(l))for(let d of l)d[rr.NAME]=c,o.push(...this.serializeObj(d,n));else if(l instanceof rr)l[rr.NAME]=c,o.push(...this.serializeObj(l,n));else if(pe.BufferSourceConverter.isBufferSource(l))c?(o.push(`${i}${u}`),o.push(...this.serializeBufferSource(l,n+1))):o.push(...this.serializeBufferSource(l,n));else if("toTextObject"in l){let d=l.toTextObject();d[rr.NAME]=c,o.push(...this.serializeObj(d,n))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return o}static serializeBufferSource(t,n=0){let o=this.pad(n),i=pe.BufferSourceConverter.toUint8Array(t),s=[];for(let a=0;a<i.length;){let c=[];for(let l=0;l<16&&a<i.length;l++){l===8&&c.push("");let u=i[a++].toString(16).padStart(2,"0");c.push(u)}s.push(`${o}${c.join(" ")}`)}return s}static serializeAlgorithm(t){return this.algorithmSerializer.toTextObject(t)}}return r.oidSerializer=Sc,r.algorithmSerializer=Bk,r})(),cw=(()=>{class r{constructor(...t){if(t.length===1){let n=t[0];this.rawData=ge.serialize(n),this.onInit(n)}else{let n=ge.parse(t[0],t[1]);this.rawData=pe.BufferSourceConverter.toArrayBuffer(t[0]),this.onInit(n)}}equal(t){return t instanceof r?(0,pe.isEqual)(t.rawData,this.rawData):!1}toString(t="text"){switch(t){case"asn":return ge.toString(this.rawData);case"text":return CS.serialize(this.toTextObject());case"hex":return pe.Convert.ToHex(this.rawData);case"base64":return pe.Convert.ToBase64(this.rawData);case"base64url":return pe.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let t=this.toTextObjectEmpty();return t[""]=this.rawData,t}toTextObjectEmpty(t){return new rr(this.getTextName(),{},t)}}return r.NAME="ASN",r})(),Ps=class r extends cw{constructor(...e){let t;pe.BufferSourceConverter.isBufferSource(e[0])?t=pe.BufferSourceConverter.toArrayBuffer(e[0]):t=ge.serialize(new Kn({extnID:e[0],critical:e[1],extnValue:new je(pe.BufferSourceConverter.toArrayBuffer(e[2]))})),super(t,Kn)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[rr.NAME]===r.NAME&&(e[rr.NAME]=Sc.toString(this.type)),e}},pZ,ow=class r{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[pZ]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(r.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(r.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=r.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(r.DEFAULT,e);return this}};pZ=Symbol.toStringTag;ow.DEFAULT="default";var wo=new ow,kve=/^[0-2](?:\.[1-9][0-9]*)+$/;function Rve(r){return new RegExp(kve).test(r)}var IS=class{constructor(e={}){this.items={};for(let t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return Rve(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}},pi=new IS;pi.register("CN","2.5.4.3");pi.register("L","2.5.4.7");pi.register("ST","2.5.4.8");pi.register("O","2.5.4.10");pi.register("OU","2.5.4.11");pi.register("C","2.5.4.6");pi.register("DC","0.9.2342.19200300.100.1.25");pi.register("E","1.2.840.113549.1.9.1");pi.register("G","2.5.4.42");pi.register("I","2.5.4.43");pi.register("SN","2.5.4.4");pi.register("T","2.5.4.12");function Nve(r,e){return`\\${pe.Convert.ToHex(pe.Convert.FromUtf8String(e)).toUpperCase()}`}function Ove(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,Nve)}var Ia=class r{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new IS,this.asn=new Kt;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Kt?this.asn=e:pe.BufferSourceConverter.isBufferSource(e)?this.asn=ge.parse(e,Kt):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||pi.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||pi.get(e)}toString(){return this.asn.map(e=>e.map(t=>{let n=this.getName(t.type)||t.type,o=t.value.anyValue?`#${pe.Convert.ToHex(t.value.anyValue)}`:Ove(t.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${pe.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(o)}return t}fromString(e){let t=new Kt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let l=o[3];s=this.getTypeOid(s);let u=this.createAttribute(s,a);i==="+"?t[t.length-1].push(u):t.push(new Xu([u])),i=l}return t}fromJSON(e){let t=new Kt;for(let n of e){let o=new Xu;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let l=this.createAttribute(s,c);o.push(l)}}t.push(o)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let n=new Tp({type:e});if(typeof t=="object")for(let o in t)switch(o){case"ia5String":n.value.ia5String=t[o];break;case"utf8String":n.value.utf8String=t[o];break;case"universalString":n.value.universalString=t[o];break;case"bmpString":n.value.bmpString=t[o];break;case"printableString":n.value.printableString=t[o];break}else if(t[0]==="#")n.value.anyValue=pe.Convert.FromHex(t.slice(1));else{let o=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:r.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return ge.serialize(this.asn)}getThumbprint(...e){return f(this,null,function*(){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||wo.get()):n=e[0]||wo.get(),yield n.subtle.digest(o,this.toArrayBuffer())})}},hZ="Cannot initialize GeneralName from ASN.1 data.",sZ=`${hZ} Unsupported string format in use.`,Lve=`${hZ} Value doesn't match to GUID regular expression.`,aZ=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,cZ="1.3.6.1.4.1.311.25.1",lZ="1.3.6.1.4.1.311.20.2.3",Dk="dns",Tk="dn",Pk="email",Mk="ip",kk="url",Rk="guid",Nk="upn",bS="id",xc=class extends cw{constructor(...e){let t;if(e.length===2)switch(e[0]){case Tk:{let n=new Ia(e[1]).toArrayBuffer(),o=ge.parse(n,Kt);t=new qe({directoryName:o});break}case Dk:t=new qe({dNSName:e[1]});break;case Pk:t=new qe({rfc822Name:e[1]});break;case Rk:{let n=new RegExp(aZ,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?pe.Convert.ToHex(new Uint8Array(pe.Convert.FromHex(i)).reverse()):i).join("");t=new qe({otherName:new Qu({typeId:cZ,value:ge.serialize(new je(pe.Convert.FromHex(o)))})});break}case Mk:t=new qe({iPAddress:e[1]});break;case bS:t=new qe({registeredID:e[1]});break;case Nk:{t=new qe({otherName:new Qu({typeId:lZ,value:ge.serialize(cM.toASN(e[1]))})});break}case kk:t=new qe({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else pe.BufferSourceConverter.isBufferSource(e[0])?t=ge.parse(e[0],qe):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=Dk,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Pk,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Mk,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=kk,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=bS,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Tk,this.value=new Ia(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===cZ){this.type=Rk;let t=ge.parse(e.otherName.value,je),n=new RegExp(aZ,"i").exec(pe.Convert.ToHex(t));if(!n)throw new Error(Lve);this.value=n.slice(1).map((o,i)=>i<3?pe.Convert.ToHex(new Uint8Array(pe.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===lZ)this.type=Nk,this.value=ge.parse(e.otherName.value,rn).toString();else throw new Error(sZ);else throw new Error(sZ)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Tk:case Dk:case Rk:case Mk:case bS:case Nk:case kk:e=this.type.toUpperCase();break;case Pk:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===bS&&(t=Sc.toString(t)),new rr(e,void 0,t)}},AS=(()=>{class r extends cw{constructor(t){let n;if(t instanceof dr)n=t;else if(Array.isArray(t)){let o=[];for(let i of t)if(i instanceof qe)o.push(i);else{let s=ge.parse(new xc(i.type,i.value).rawData,qe);o.push(s)}n=new dr(o)}else if(pe.BufferSourceConverter.isBufferSource(t))n=ge.parse(t,dr);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(n)}onInit(t){let n=[];for(let o of t){let i=null;try{i=new xc(o)}catch{continue}n.push(i)}this.items=n}toJSON(){return this.items.map(t=>t.toJSON())}toTextObject(){let t=super.toTextObjectEmpty();for(let n of this.items){let o=n.toTextObject(),i=t[o[rr.NAME]];Array.isArray(i)||(i=[],t[o[rr.NAME]]=i),i.push(o)}return t}}return r.NAME="GeneralNames",r})(),rw="-{5}",iw="\\n",Fve=`[^${iw}]+`,Bve=`${rw}BEGIN (${Fve}(?=${rw}))${rw}`,Uve=`${rw}END \\1${rw}`,S1="\\n",Vve=`[^:${iw}]+`,jve=`(?:[^${iw}]+${S1}(?: +[^${iw}]+${S1})*)`,Hve="[a-zA-Z0-9=+/]+",$ve=`(?:${Hve}${S1})+`,uZ=`${Bve}${S1}(?:((?:${Vve}: ${jve})+))?${S1}?(${$ve})${Uve}`,lh=(()=>{class r{static isPem(t){return typeof t=="string"&&new RegExp(uZ,"g").test(t.replace(/\r/g,""))}static decodeWithHeaders(t){t=t.replace(/\r/g,"");let n=new RegExp(uZ,"g"),o=[],i=null;for(;i=n.exec(t);){let s=i[3].replace(new RegExp(`[${iw}]+`,"g"),""),a={type:i[1],headers:[],rawData:pe.Convert.FromBase64(s)},c=i[2];if(c){let l=c.split(new RegExp(S1,"g")),u=null;for(let d of l){let[h,p]=d.split(/:(.*)/);if(p===void 0){if(!u)throw new Error("Cannot parse PEM string. Incorrect header value");u.value+=h.trim()}else u&&a.headers.push(u),u={key:h,value:p.trim()}}u&&a.headers.push(u)}o.push(a)}return o}static decode(t){return this.decodeWithHeaders(t).map(o=>o.rawData)}static decodeFirst(t){let n=this.decode(t);if(!n.length)throw new RangeError("PEM string doesn't contain any objects");return n[0]}static encode(t,n){if(Array.isArray(t)){let o=new Array;return n?t.forEach(i=>{if(!pe.BufferSourceConverter.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");o.push(this.encodeStruct({type:n,rawData:pe.BufferSourceConverter.toArrayBuffer(i)}))}):t.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");o.push(this.encodeStruct(i))}),o.join(`
`)}else{if(!n)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:n,rawData:pe.BufferSourceConverter.toArrayBuffer(t)})}}static encodeStruct(t){var n;let o=t.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${o}-----`),!((n=t.headers)===null||n===void 0)&&n.length){for(let u of t.headers)i.push(`${u.key}: ${u.value}`);i.push("")}let s=pe.Convert.ToBase64(t.rawData),a,c=0,l=Array();for(;c<s.length&&(s.length-c<64?a=s.substring(c):(a=s.substring(c,c+64),c+=64),a.length!==0);)if(l.push(a),a.length<64)break;return i.push(...l),i.push(`-----END ${o}-----`),i.join(`
`)}}return r.CertificateTag="CERTIFICATE",r.CrlTag="CRL",r.CertificateRequestTag="CERTIFICATE REQUEST",r.PublicKeyTag="PUBLIC KEY",r.PrivateKeyTag="PRIVATE KEY",r})(),_1=class r extends cw{static isAsnEncoded(e){return pe.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(lh.isPem(e))return lh.decode(e)[0];if(pe.Convert.isHex(e))return pe.Convert.FromHex(e);if(pe.Convert.isBase64(e))return pe.Convert.FromBase64(e);if(pe.Convert.isBase64Url(e))return pe.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let t=pe.Convert.ToBinary(e);return lh.isPem(t)?lh.decode(t)[0]:pe.Convert.isHex(t)?pe.Convert.FromHex(t):pe.Convert.isBase64(t)?pe.Convert.FromBase64(t):pe.Convert.isBase64Url(t)?pe.Convert.FromBase64Url(t):pe.BufferSourceConverter.toArrayBuffer(e)}}constructor(...e){r.isAsnEncoded(e[0])?super(r.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return lh.encode(this.rawData,this.tag);default:return super.toString(e)}}},md=class r extends _1{static create(n){return f(this,arguments,function*(e,t=wo.get()){if(e instanceof r)return e;if(ow.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let o=yield t.subtle.exportKey("spki",e);return new r(o)}else{if(e.publicKey)return e.publicKey;if(pe.BufferSourceConverter.isBufferSource(e))return new r(e);throw new TypeError("Unsupported PublicKeyType")}})}constructor(e){_1.isAsnEncoded(e)?super(e,qn):super(e),this.tag=lh.PublicKeyTag}export(...e){return f(this,null,function*(){let t,n=["verify"],o=v({hash:"SHA-256"},this.algorithm);e.length>1?(o=e[0]||o,n=e[1]||n,t=e[2]||wo.get()):t=e[0]||wo.get();let i=this.rawData,s=ge.parse(this.rawData,qn);return s.algorithm.algorithm===cd&&(i=zve(s,i)),t.subtle.importKey("spki",i,o,!0,n)})}onInit(e){let t=fr.resolve(x1),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case wc:{let o=ge.parse(e.subjectPublicKey,g1),i=pe.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=pe.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}getThumbprint(...e){return f(this,null,function*(){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||wo.get()):n=e[0]||wo.get(),yield n.subtle.digest(o,this.rawData)})}getKeyIdentifier(...e){return f(this,null,function*(){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=wo.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=wo.get();let o=ge.parse(this.rawData,qn);return yield t.subtle.digest(n,o.subjectPublicKey)})}toTextObject(){let e=this.toTextObjectEmpty(),t=ge.parse(this.rawData,qn);switch(e.Algorithm=CS.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Yp:e["EC Point"]=t.subjectPublicKey;break;case wc:default:e["Raw Data"]=t.subjectPublicKey}return e}};function zve(r,e){return r.algorithm=new ue({algorithm:wc,parameters:null}),e=ge.serialize(r),e}var qve=(()=>{class r extends Ps{static create(i){return f(this,arguments,function*(t,n=!1,o=wo.get()){if("name"in t&&"serialNumber"in t)return new r(t,n);let a=yield(yield md.create(t,o)).getKeyIdentifier(o);return new r(pe.Convert.ToHex(a),n)})}constructor(...t){if(pe.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(typeof t[0]=="string"){let n=new pc({keyIdentifier:new kp(pe.Convert.FromHex(t[0]))});super(R8,t[1],ge.serialize(n))}else{let n=t[0],o=n.name instanceof AS?ge.parse(n.name.rawData,dr):n.name,i=new pc({authorityCertIssuer:o,authorityCertSerialNumber:pe.Convert.FromHex(n.serialNumber)});super(R8,t[1],ge.serialize(i))}}onInit(t){super.onInit(t);let n=ge.parse(t.extnValue,pc);n.keyIdentifier&&(this.keyId=pe.Convert.ToHex(n.keyIdentifier)),(n.authorityCertIssuer||n.authorityCertSerialNumber)&&(this.certId={name:n.authorityCertIssuer||[],serialNumber:n.authorityCertSerialNumber?pe.Convert.ToHex(n.authorityCertSerialNumber):""})}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ge.parse(this.value,pc);return n.authorityCertIssuer&&(t["Authority Issuer"]=new AS(n.authorityCertIssuer).toTextObject()),n.authorityCertSerialNumber&&(t["Authority Serial Number"]=n.authorityCertSerialNumber),n.keyIdentifier&&(t[""]=n.keyIdentifier),t}}return r.NAME="Authority Key Identifier",r})(),$k=(()=>{class r extends Ps{constructor(...t){if(pe.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ge.parse(this.value,Rp);this.ca=n.cA,this.pathLength=n.pathLenConstraint}else{let n=new Rp({cA:t[0],pathLenConstraint:t[1]});super(N8,t[2],ge.serialize(n)),this.ca=t[0],this.pathLength=t[1]}}toTextObject(){let t=this.toTextObjectWithoutValue();return this.ca&&(t.CA=this.ca),this.pathLength!==void 0&&(t["Path Length"]=this.pathLength),t}}return r.NAME="Basic Constraints",r})();var Kve=(()=>{class r extends Ps{constructor(...t){if(pe.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ge.parse(this.value,Dv);this.usages=n.map(o=>o)}else{let n=new Dv(t[0]);super(U8,t[1],ge.serialize(n)),this.usages=t[0]}}toTextObject(){let t=this.toTextObjectWithoutValue();return t[""]=this.usages.map(n=>Sc.toString(n)).join(", "),t}}return r.NAME="Extended Key Usages",r})();var Wve=(()=>{class r extends Ps{constructor(...t){if(pe.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ge.parse(this.value,Gg);this.usages=n.toNumber()}else{let n=new Gg(t[0]);super(V8,t[1],ge.serialize(n)),this.usages=t[0]}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ge.parse(this.value,Gg);return t[""]=n.toJSON().join(", "),t}}return r.NAME="Key Usages",r})(),Gve=(()=>{class r extends Ps{static create(i){return f(this,arguments,function*(t,n=!1,o=wo.get()){let a=yield(yield md.create(t,o)).getKeyIdentifier(o);return new r(pe.Convert.ToHex(a),n)})}constructor(...t){if(pe.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let n=ge.parse(this.value,ci);this.keyId=pe.Convert.ToHex(n)}else{let n=typeof t[0]=="string"?pe.Convert.FromHex(t[0]):t[0],o=new ci(n);super(NM,t[1],ge.serialize(o)),this.keyId=pe.Convert.ToHex(n)}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=ge.parse(this.value,ci);return t[""]=n,t}}return r.NAME="Subject Key Identifier",r})(),Yve=(()=>{class r extends Ps{constructor(...t){pe.BufferSourceConverter.isBufferSource(t[0])?super(t[0]):super(kM,t[1],new AS(t[0]||[]).rawData)}onInit(t){super.onInit(t);let n=ge.parse(t.extnValue,z8);this.names=new AS(n)}toTextObject(){let t=this.toTextObjectWithoutValue(),n=this.names.toTextObject();for(let o in n)t[o]=n[o];return t}}return r.NAME="Subject Alternative Name",r})(),hi=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new Ps(e),n=this.items.get(t.type);return n?new n(e):t}};hi.items=new Map;var Xve=(()=>{class r extends Ps{constructor(...t){var n;if(pe.BufferSourceConverter.isBufferSource(t[0])){super(t[0]);let o=ge.parse(this.value,_v);this.policies=o.map(i=>i.policyIdentifier)}else{let o=t[0],i=(n=t[1])!==null&&n!==void 0?n:!1,s=new _v(o.map(a=>new Np({policyIdentifier:a})));super(L8,i,ge.serialize(s)),this.policies=o}}toTextObject(){let t=this.toTextObjectWithoutValue();return t.Policy=this.policies.map(n=>new rr("",{},Sc.toString(n))),t}}return r.NAME="Certificate Policies",r})();hi.register(L8,Xve);var Qve=(()=>{class r extends Ps{constructor(...t){var n;if(pe.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(Array.isArray(t[0])&&typeof t[0][0]=="string"){let i=t[0].map(a=>new mc({distributionPoint:new Tl({fullName:[new qe({uniformResourceIdentifier:a})]})})),s=new ed(i);super(F8,t[1],ge.serialize(s))}else{let o=new ed(t[0]);super(F8,t[1],ge.serialize(o))}(n=this.distributionPoints)!==null&&n!==void 0||(this.distributionPoints=[])}onInit(t){super.onInit(t);let n=ge.parse(t.extnValue,ed);this.distributionPoints=n}toTextObject(){let t=this.toTextObjectWithoutValue();return t["Distribution Point"]=this.distributionPoints.map(n=>{var o;let i={};return n.distributionPoint&&(i[""]=(o=n.distributionPoint.fullName)===null||o===void 0?void 0:o.map(s=>new xc(s).toString()).join(", ")),n.reasons&&(i.Reasons=n.reasons.toString()),n.cRLIssuer&&(i["CRL Issuer"]=n.cRLIssuer.map(s=>s.toString()).join(", ")),i}),t}}return r.NAME="CRL Distribution Points",r})(),Zve=(()=>{class r extends Ps{constructor(...t){var n,o,i,s;if(pe.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else if(t[0]instanceof Mp){let a=new Mp(t[0]);super(k8,t[1],ge.serialize(a))}else{let a=t[0],c=new Mp;xS(c,a,gM,"ocsp"),xS(c,a,yM,"caIssuers"),xS(c,a,vM,"timeStamping"),xS(c,a,wM,"caRepository"),super(k8,t[1],ge.serialize(c))}(n=this.ocsp)!==null&&n!==void 0||(this.ocsp=[]),(o=this.caIssuers)!==null&&o!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(t){super.onInit(t),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],ge.parse(t.extnValue,Mp).forEach(o=>{switch(o.accessMethod){case gM:this.ocsp.push(new xc(o.accessLocation));break;case yM:this.caIssuers.push(new xc(o.accessLocation));break;case vM:this.timeStamping.push(new xc(o.accessLocation));break;case wM:this.caRepository.push(new xc(o.accessLocation));break}})}toTextObject(){let t=this.toTextObjectWithoutValue();return this.ocsp.length&&ES(t,"OCSP",this.ocsp),this.caIssuers.length&&ES(t,"CA Issuers",this.caIssuers),this.timeStamping.length&&ES(t,"Time Stamping",this.timeStamping),this.caRepository.length&&ES(t,"CA Repository",this.caRepository),t}}return r.NAME="Authority Info Access",r})();function ES(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{let n=new rr("");t.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[rr.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),r[e]=n}}function xS(r,e,t,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new xc("url",s)),r.push(new Al({accessMethod:t,accessLocation:ge.parse(s.rawData,qe)}))})}var zk=(()=>{class r extends cw{constructor(...t){let n;if(pe.BufferSourceConverter.isBufferSource(t[0]))n=pe.BufferSourceConverter.toArrayBuffer(t[0]);else{let o=t[0],i=Array.isArray(t[1])?t[1].map(s=>pe.BufferSourceConverter.toArrayBuffer(s)):[];n=ge.serialize(new zn({type:o,values:i}))}super(n,zn)}onInit(t){this.type=t.type,this.values=t.values}toTextObject(){let t=this.toTextObjectWithoutValue();return t.Value=this.values.map(n=>new rr("",{"":n})),t}toTextObjectWithoutValue(){let t=this.toTextObjectEmpty();return t[rr.NAME]===r.NAME&&(t[rr.NAME]=Sc.toString(this.type)),t}}return r.NAME="Attribute",r})(),Jve=(()=>{class r extends zk{constructor(...t){var n;if(pe.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else{let o=new Zv({printableString:t[0]});super(Ik,[ge.serialize(o)])}(n=this.password)!==null&&n!==void 0||(this.password="")}onInit(t){if(super.onInit(t),this.values[0]){let n=ge.parse(this.values[0],Zv);this.password=n.toString()}}toTextObject(){let t=this.toTextObjectWithoutValue();return t[rr.VALUE]=this.password,t}}return r.NAME="Challenge Password",r})(),ewe=(()=>{class r extends zk{constructor(...t){var n;if(pe.BufferSourceConverter.isBufferSource(t[0]))super(t[0]);else{let o=t[0],i=new Hi;for(let s of o)i.push(ge.parse(s.rawData,Kn));super(wS,[ge.serialize(i)])}(n=this.items)!==null&&n!==void 0||(this.items=[])}onInit(t){if(super.onInit(t),this.values[0]){let n=ge.parse(this.values[0],Hi);this.items=n.map(o=>hi.create(ge.serialize(o)))}}toTextObject(){let t=this.toTextObjectWithoutValue(),n=this.items.map(o=>o.toTextObject());for(let o of n)t[o[rr.NAME]]=o;return t}}return r.NAME="Extensions",r})(),sw=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new zk(e),n=this.items.get(t.type);return n?new n(e):t}};sw.items=new Map;var TS="crypto.signatureFormatter",Uk=class{toAsnSignature(e,t){return pe.BufferSourceConverter.toArrayBuffer(t)}toWebSignature(e,t){return pe.BufferSourceConverter.toArrayBuffer(t)}},_S,Vk=_S=class{static createPssParams(e,t){let n=_S.getHashAlgorithm(e);return n?new bc({hashAlgorithm:n,maskGenAlgorithm:new ue({algorithm:ld,parameters:ge.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){let t=fr.resolve(x1);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ue({algorithm:d1,parameters:null});case"sha-256":return new ue({algorithm:oS,parameters:null});case"sha-384":return new ue({algorithm:f1,parameters:null});case"sha-512":return new ue({algorithm:p1,parameters:null})}}else return new ue({algorithm:wc,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let t=_S.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ue({algorithm:cd,parameters:ge.serialize(t)})}else return new ue({algorithm:cd,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case wc:return{name:"RSASSA-PKCS1-v1_5"};case d1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case oS:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case f1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case p1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case cd:if(e.parameters){let t=ge.parse(e.parameters,bc);return{name:"RSA-PSS",hash:fr.resolve(x1).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};Vk=_S=g([dd()],Vk);fr.registerSingleton(aw,Vk);var jk=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ue({algorithm:Qp});case"sha-256":return new ue({algorithm:Zp});case"sha-384":return new ue({algorithm:Jp});case"sha-512":return new ue({algorithm:eh})}return null}toWebAlgorithm(e){switch(e.algorithm){case Qp:return{name:"SHA-1"};case Zp:return{name:"SHA-256"};case Jp:return{name:"SHA-384"};case eh:return{name:"SHA-512"}}return null}};jk=g([dd()],jk);fr.registerSingleton(aw,jk);var Ol=class r{addPadding(e,t){let n=pe.BufferSourceConverter.toUint8Array(t),o=new Uint8Array(e);return o.set(n,e-n.length),o}removePadding(e,t=!1){let n=pe.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(t&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){let n=e.namedCurve,o=r.namedCurveSize.get(n)||r.defaultNamedCurveSize,i=new Xp,s=pe.BufferSourceConverter.toUint8Array(t);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),ge.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){let n=ge.parse(t,Xp),o=e.namedCurve,i=r.namedCurveSize.get(o)||r.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return(0,pe.combine)(s,a)}return null}};Ol.namedCurveSize=new Map;Ol.defaultNamedCurveSize=32;var Ok="1.3.101.110",dZ="1.3.101.111",Lk="1.3.101.112",fZ="1.3.101.113",Hk=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Lk;break;case"x25519":t=Ok;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Lk;break;case"ed448":t=fZ;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Ok;break;case"x448":t=dZ;break}}return t?new ue({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Lk:return{name:"Ed25519"};case fZ:return{name:"EdDSA",namedCurve:"Ed448"};case Ok:return{name:"X25519"};case dZ:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Hk=g([dd()],Hk);fr.registerSingleton(aw,Hk);var qk=(()=>{class r extends _1{constructor(t){_1.isAsnEncoded(t)?super(t,Cs):super(t),this.tag=lh.CertificateTag}onInit(t){let n=t.tbsCertificate;this.tbs=ge.serialize(n);let o=new Uint8Array(n.serialNumber);o.length>1&&o[0]===0&&o[1]>127&&(o=o.slice(1)),this.serialNumber=pe.Convert.ToHex(o),this.subjectName=new Ia(n.subject),this.subject=new Ia(n.subject).toString(),this.issuerName=new Ia(n.issuer),this.issuer=this.issuerName.toString();let i=fr.resolve(x1);this.signatureAlgorithm=i.toWebAlgorithm(t.signatureAlgorithm),this.signature=t.signatureValue;let s=n.validity.notBefore.utcTime||n.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;let a=n.validity.notAfter.utcTime||n.validity.notAfter.generalTime;if(!a)throw new Error("Cannot get 'notAfter' value");this.notAfter=a,this.extensions=[],n.extensions&&(this.extensions=n.extensions.map(c=>hi.create(ge.serialize(c)))),this.publicKey=new md(n.subjectPublicKeyInfo)}getExtension(t){for(let n of this.extensions)if(typeof t=="string"){if(n.type===t)return n}else if(n instanceof t)return n;return null}getExtensions(t){return this.extensions.filter(n=>typeof t=="string"?n.type===t:n instanceof t)}verify(){return f(this,arguments,function*(t={},n=wo.get()){let o,i,s=t.publicKey;try{if(!s)o=v(v({},this.publicKey.algorithm),this.signatureAlgorithm),i=yield this.publicKey.export(o,["verify"],n);else if("publicKey"in s)o=v(v({},s.publicKey.algorithm),this.signatureAlgorithm),i=yield s.publicKey.export(o,["verify"],n);else if(s instanceof md)o=v(v({},s.algorithm),this.signatureAlgorithm),i=yield s.export(o,["verify"],n);else if(pe.BufferSourceConverter.isBufferSource(s)){let u=new md(s);o=v(v({},u.algorithm),this.signatureAlgorithm),i=yield u.export(o,["verify"],n)}else o=v(v({},s.algorithm),this.signatureAlgorithm),i=s}catch{return!1}let a=fr.resolveAll(TS).reverse(),c=null;for(let u of a)if(c=u.toWebSignature(o,this.signature),c)break;if(!c)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let l=yield n.subtle.verify(this.signatureAlgorithm,i,c,this.tbs);if(t.signatureOnly)return l;{let d=(t.date||new Date).getTime();return l&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}})}getThumbprint(...t){return f(this,null,function*(){let n,o="SHA-1";return t[0]&&(t[0].subtle?n=t[0]:(o=t[0]||o,n=t[1])),n??(n=wo.get()),yield n.subtle.digest(o,this.rawData)})}isSelfSigned(){return f(this,arguments,function*(t=wo.get()){return this.subject===this.issuer&&(yield this.verify({signatureOnly:!0},t))})}toTextObject(){let t=this.toTextObjectEmpty(),n=ge.parse(this.rawData,Cs),o=n.tbsCertificate,i=new rr("",{Version:`${td[o.version]} (${o.version})`,"Serial Number":o.serialNumber,"Signature Algorithm":CS.serializeAlgorithm(o.signature),Issuer:this.issuer,Validity:new rr("",{"Not Before":o.validity.notBefore.getTime(),"Not After":o.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(o.issuerUniqueID&&(i["Issuer Unique ID"]=o.issuerUniqueID),o.subjectUniqueID&&(i["Subject Unique ID"]=o.subjectUniqueID),this.extensions.length){let s=new rr("");for(let a of this.extensions){let c=a.toTextObject();s[c[rr.NAME]]=c}i.Extensions=s}return t.Data=i,t.Signature=new rr("",{Algorithm:CS.serializeAlgorithm(n.signatureAlgorithm),"":n.signatureValue}),t}}return r.NAME="Certificate",r})();var DS=class{static createSelfSigned(n){return f(this,arguments,function*(e,t=wo.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)})}static create(n){return f(this,arguments,function*(e,t=wo.get()){var o;let i;e.publicKey instanceof md?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:pe.BufferSourceConverter.isBufferSource(e.publicKey)?i=e.publicKey:i=yield t.subtle.exportKey("spki",e.publicKey);let s=e.serialNumber?pe.BufferSourceConverter.toUint8Array(pe.Convert.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));if(s[0]>127){let x=new Uint8Array(s.length+1);x[0]=0,x.set(s,1),s=x}let a=e.notBefore||new Date,c=e.notAfter||new Date(a.getTime()+31536e6),l=new Cs({tbsCertificate:new Wn({version:td.v3,serialNumber:s,validity:new Pl({notBefore:a,notAfter:c}),extensions:new Hi(((o=e.extensions)===null||o===void 0?void 0:o.map(x=>ge.parse(x.rawData,Kn)))||[]),subjectPublicKeyInfo:ge.parse(i,qn)})});if(e.subject){let x=e.subject instanceof Ia?e.subject:new Ia(e.subject);l.tbsCertificate.subject=ge.parse(x.toArrayBuffer(),Kt)}if(e.issuer){let x=e.issuer instanceof Ia?e.issuer:new Ia(e.issuer);l.tbsCertificate.issuer=ge.parse(x.toArrayBuffer(),Kt)}let u={hash:"SHA-256"},d="signingKey"in e?v(v(v({},u),e.signingAlgorithm),e.signingKey.algorithm):v(v({},u),e.signingAlgorithm),h=fr.resolve(x1);l.tbsCertificate.signature=l.signatureAlgorithm=h.toAsnAlgorithm(d);let p=ge.serialize(l.tbsCertificate),m="signingKey"in e?yield t.subtle.sign(d,e.signingKey,p):e.signature,y=fr.resolveAll(TS).reverse(),b=null;for(let x of y)if(b=x.toAsnSignature(d,m),b)break;if(!b)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return l.signatureValue=b,new qk(ge.serialize(l))})}};hi.register(N8,$k);hi.register(U8,Kve);hi.register(V8,Wve);hi.register(NM,Gve);hi.register(R8,qve);hi.register(kM,Yve);hi.register(F8,Qve);hi.register(k8,Zve);sw.register(Ik,Jve);sw.register(wS,ewe);fr.registerSingleton(TS,Uk);fr.registerSingleton(TS,Ol);Ol.namedCurveSize.set("P-256",32);Ol.namedCurveSize.set("K-256",32);Ol.namedCurveSize.set("P-384",48);Ol.namedCurveSize.set("P-521",66);var PS=class extends nt{listen(){return f(this,null,function*(){throw new _8("WebRTCTransport.createListener")})}getAddrs(){return[]}updateAnnounceAddrs(){}close(){return f(this,null,function*(){})}};var Kk=Object.values(ff).map(r=>r.decoder).reduce((r,e)=>r.or(e)),twe=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function mZ(r){return r?.match(twe)?.groups?.fingerprint}function Wk(r){let t=r.stringTuples().filter(n=>n[0]===UY).map(n=>n[1])[0];if(t===void 0||t==="")throw new Y(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function rwe(r){return _r.decode(Kk.decode(r))}function nwe(r){let e=rwe(Wk(r)),t=owe(e.code),n=e.digest.reduce((i,s)=>i+s.toString(16).padStart(2,"0"),""),o=n.match(/.{1,2}/g);if(o==null)throw new S8(n,r.toString());return`${t} ${o.join(":").toUpperCase()}`}function gZ(r){let e=r.split(":").map(o=>parseInt(o,16)),t=Uint8Array.from(e),n=yi(wt.code,t);return we(`/certhash/${Zc.encode(n.bytes)}`)}function owe(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new C8(r)}}function yZ(r,e){let{host:t,port:n,family:o}=r.toOptions(),i=nwe(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${o} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${$g}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function vZ(r,e){let{host:t,port:n,family:o}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
c=IN IP${o} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${$g}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function Gk(r,e){if(r.sdp===void 0)throw new Y("Can't munge a missing SDP");let t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}var Yk=Z("libp2p-webrtc-noise:");function bZ(r,e,t){let n=r.trim().toLowerCase().replaceAll(":",""),o=Z(n,"hex"),i=yi(wt.code,o),s=Kk.decode(Wk(e)),a=Yk.byteLength+i.bytes.byteLength+s.byteLength;return t==="server"?zt([Yk,s,i.bytes],a):zt([Yk,i.bytes,s],a)}var iwe=mv?"iceconnectionstatechange":"connectionstatechange";function EZ(r,e,t){return f(this,null,function*(){let n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");let d=yield r.createOffer();t.log.trace("client created local offer %s",d.sdp);let h=Gk(d,e);t.log.trace("client setting local offer %s",h.sdp),yield r.setLocalDescription(h);let p=yZ(t.remoteAddr,e);t.log.trace("client setting server description %s",p.sdp),yield r.setRemoteDescription(p)}else{let d=vZ(t.remoteAddr,e);t.log.trace("server setting client %s %s",d.type,d.sdp),yield r.setRemoteDescription(d),t.log.trace("server creating local answer");let h=yield r.createAnswer();t.log.trace("server created local answer");let p=Gk(h,e);t.log.trace("server setting local description %s",h.sdp),yield r.setLocalDescription(p)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),yield Pr(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){let d=r.remoteFingerprint()?.value??"";t.remoteAddr=t.remoteAddr.encapsulate(gZ(d))}let o=mZ(r.localDescription?.sdp);if(o==null)throw new Yu("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);let i=bZ(o,t.remoteAddr,t.role),s=l5({prologueBytes:i})(t),a=zg(v({channel:n,direction:"outbound",handshake:!0,logger:t.logger},t.dataChannel??{})),c=new Dp(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(iwe,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":c.close().catch(d=>{t.log.error("error closing connection",d),c.abort(d)});break;default:break}}),t.events?.increment({peer_connection:!0});let l=new Gu(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),yield s.secureInbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),yield t.upgrader.upgradeOutbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal});t.log.trace("%s secure outbound",t.role);let u=yield s.secureOutbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});c.remoteAddr=c.remoteAddr.encapsulate(`/p2p/${u.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),yield t.upgrader.upgradeInbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal})}catch(o){throw n.close(),o}})}function xZ(r,e,t,n){return f(this,null,function*(){n==null&&(n=yield RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));let o=typeof t=="function"?yield t():t;return new RTCPeerConnection(I(v({},o??{}),{certificates:[n]}))})}function SZ(r){return f(this,null,function*(){let e=yield ox(r),t=yield crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...te(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)})}var MS=class{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new nt,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Y("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[fu]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[At]=["@libp2p/transport"];start(){return f(this,null,function*(){this.certificate=yield this.getCertificate()})}stop(){return f(this,null,function*(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0})}dial(e,t){return f(this,null,function*(){this.log("dial %a",e),t.signal.throwIfAborted();let n,o=e.getPeerId();o!=null&&(n=sr(o));let i=rX(),s=yield xZ("client",i,typeof this.init.rtcConfiguration=="function"?yield this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return yield EZ(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(a){throw s.close(),a}})}createListener(e){if(this.certificate==null)throw new Gs;return new PS(this.components,I(v(v({},this.init),e),{certificate:this.certificate,emitter:this.emitter}))}listenFilter(e){return e.filter(S2.exactMatch)}dialFilter(e){return this.listenFilter(e)}getCertificate(e){return f(this,null,function*(){if(swe(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=yield this.loadOrCreatePrivateKey(),{pem:n,certhash:o}=yield this.loadOrCreateCertificate(t,e);return{privateKey:yield SZ(t),pem:n,certhash:o}})}loadOrCreatePrivateKey(){return f(this,null,function*(){if(this.privateKey!=null)return this.privateKey;let e=this.init.certificateKeychainName??WY,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new kt;this.log.trace("checking for stored private key"),this.privateKey=yield t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=yield eg("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),yield t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey})}loadOrCreateCertificate(e,t){return f(this,null,function*(){if(this.certificate!=null&&t!==!0)return this.certificate;let n,o=new Ot(this.init.certificateDatastoreKey??KY),i=yield ox(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new kt;this.log.trace("checking for stored TLS certificate"),n=yield this.loadCertificate(o,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=yield this.createCertificate(o,i)}let s=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??rM)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},s),{pem:n.toString("pem"),certhash:Zc.encode((yield wt.digest(new Uint8Array(n.rawData))).bytes)}})}loadCertificate(e,t){return f(this,null,function*(){let n=yield this.components.datastore.get(e),o=new qk(n),i=o.notAfter.getTime()-(this.init.certificateRenewalThreshold??rM);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new kt;this.log("loaded certificate, expires in %d ms",i);let s=yield o.publicKey.export(crypto),a=yield crypto.subtle.exportKey("raw",s),c=yield crypto.subtle.exportKey("raw",t.publicKey);if(!Me(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new kt;return this.log("loaded certificate, expiry time is %o",i),o})}createCertificate(e,t){return f(this,null,function*(){let n=new Date,o=new Date(Date.now()+(this.init.certificateLifespan??GY));n.setMilliseconds(0),o.setMilliseconds(0);let i=yield DS.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:o,keys:t,extensions:[new $k(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),yield this.components.datastore.put(e,Z(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i})}getKeychain(){try{return this.components.keychain}catch{}}};function swe(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function _Z(r){return e=>new MS(e,r)}function CZ(r){return e=>new T8(e,r)}var IZ=r=>f(null,null,function*(){if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&(yield new Promise((e,t)=>{function n(){r.removeEventListener("open",o),r.removeEventListener("error",i)}function o(){n(),e()}function i(s){n(),t(s.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",o),r.addEventListener("error",i)}))});var AZ=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,n=>f(null,null,function*(){try{for(var o=O(n),i,s,a;i=!(s=yield o.next()).done;i=!1){let c=s.value;try{yield IZ(r)}catch(l){if(l.message==="socket closed")break;throw l}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(c)}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield s.call(o))}finally{if(a)throw a[0]}}e.closeOnEnd!=null&&r.readyState<=1&&(yield new Promise((c,l)=>{r.addEventListener("close",u=>{if(u.wasClean||u.code===1006)c();else{let d=Object.assign(new Error("ws error"),{event:u});l(d)}}),setTimeout(()=>{r.close()})}))}));var MZ=xr(TZ(),1);function PZ(r){return r instanceof ArrayBuffer||r?.constructor?.name==="ArrayBuffer"&&typeof r?.byteLength=="number"}var kZ=r=>{r.binaryType="arraybuffer";let e=()=>f(null,null,function*(){yield new Promise((i,s)=>{if(n){i();return}if(o!=null){s(o);return}let a=u=>{r.removeEventListener("open",c),r.removeEventListener("error",l),u()},c=()=>{a(i)},l=u=>{a(()=>{s(u.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})}),t=function(){return M(this,null,function*(){let i=new MZ.EventIterator(({push:u,stop:d,fail:h})=>{let p=y=>{let b=null;typeof y.data=="string"&&(b=Z(y.data)),PZ(y.data)&&(b=new Uint8Array(y.data)),y.data instanceof Uint8Array&&(b=y.data),b!=null&&u(b)},m=y=>{h(y.error??new Error("Socket error"))};return r.addEventListener("message",p),r.addEventListener("error",m),r.addEventListener("close",d),()=>{r.removeEventListener("message",p),r.removeEventListener("error",m),r.removeEventListener("close",d)}},{highWaterMark:1/0});yield new S(e());try{for(var s=O(i),a,c,l;a=!(c=yield new S(s.next())).done;a=!1){let u=c.value;yield PZ(u)?new Uint8Array(u):u}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield new S(c.call(s)))}finally{if(l)throw l[0]}}})}(),n=r.readyState===1,o;return r.addEventListener("open",()=>{n=!0,o=null}),r.addEventListener("close",()=>{n=!1,o=null}),r.addEventListener("error",i=>{n||(o=i.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};var RZ=(r,e)=>{e=e??{};let t=kZ(r),n=e.remoteAddress,o=e.remotePort;if(r.url!=null)try{let s=new URL(r.url);n=s.hostname,o=parseInt(s.port,10)}catch{}if(n==null||o==null)throw new Error("Remote connection did not have address and/or port");return{sink:AZ(r,e),source:t,connected:()=>f(null,null,function*(){yield t.connected()}),close:()=>f(null,null,function*(){(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&(yield new Promise(s=>{r.addEventListener("close",()=>{s()}),r.close()}))}),destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:o,socket:r}};var NZ=WebSocket;var cwe={"http:":"ws:","https:":"wss:"},OZ="ws:",LZ=(r,e)=>{if(r.startsWith("//")&&(r=`${e?.protocol??OZ}${r}`),r.startsWith("/")&&e!=null){let n=e.protocol??OZ,o=e.host,i=e.port!=null&&o?.endsWith(`:${e.port}`)!==!0?`:${e.port}`:"";r=`${n}//${o}${i}${r}`}let t=new URL(r);for(let[n,o]of Object.entries(cwe))t.protocol===n&&(t.protocol=o);return t};function FZ(r,e){let t=typeof window>"u"?void 0:window.location;e=e??{};let n=LZ(r,t),o=new NZ(n.toString(),e.websocket);return RZ(o,e)}function BZ(r){return r.filter(e=>Wf.exactMatch(e)||gl.exactMatch(e))}function UZ(){throw new Error("WebSocket Servers can not be created in the browser!")}function VZ(r,e,t){let n=t.logger.forComponent("libp2p:websockets:maconn"),o=t.metrics,i=t.metricPrefix??"",s={log:n,sink(c){return f(this,null,function*(){try{yield r.sink(function(){return M(this,null,function*(){try{for(var l=O(c),u,d,h;u=!(d=yield new S(l.next())).done;u=!1){let p=d.value;p instanceof Uint8Array?yield p:yield p.subarray()}}catch{h=[d]}finally{try{u&&(d=l.return)&&(yield new S(d.call(l)))}finally{if(h)throw h[0]}}})}())}catch(l){l.type!=="aborted"&&n.error(l)}})},source:r.source,remoteAddr:e,timeline:{open:Date.now()},close(){return f(this,arguments,function*(c={}){let l=Date.now();if(c.signal==null){let d=AbortSignal.timeout(500);c=I(v({},c),{signal:d})}let u=()=>{let{host:d,port:h}=s.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",d,h,Date.now()-l),this.abort(new Mn("Socket close timeout"))};c.signal?.addEventListener("abort",u);try{yield r.close()}catch(d){n.error("error closing WebSocket gracefully",d),this.abort(d)}finally{c.signal?.removeEventListener("abort",u),s.timeline.close=Date.now()}})},abort(c){let{host:l,port:u}=s.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",l,u,c),r.destroy(),s.timeline.close=Date.now(),o?.increment({[`${i}error`]:!0})}};return r.socket.addEventListener("close",()=>{o?.increment({[`${i}close`]:!0}),s.timeline.close==null&&(s.timeline.close=Date.now())},{once:!0}),s}var Zk=class{log;init;logger;metrics;components;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[fu]=!0;[Symbol.toStringTag]="@libp2p/websockets";[At]=["@libp2p/transport"];dial(e,t){return f(this,null,function*(){this.log("dialing %s",e),t=t??{};let n=yield this._connect(e,t),o=VZ(n,e,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",o.remoteAddr);let i=yield t.upgrader.upgradeOutbound(o,t);return this.log("outbound connection %s upgraded",o.remoteAddr),i})}_connect(e,t){return f(this,null,function*(){t?.signal?.throwIfAborted();let n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);let o=ze(),i=FZ(pg(e),this.init);i.socket.addEventListener("error",()=>{let s=new C4(`Could not connect to ${e.toString()}`);this.log.error("connection error:",s),this.metrics?.dialerEvents.increment({error:!0}),o.reject(s)});try{t.onProgress?.(new fe("websockets:open-connection")),yield lt(Promise.race([i.connected(),o.promise]),t.signal)}catch(s){throw t.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),i.close().catch(a=>{this.log.error("error closing raw socket",a)}),s}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),i})}createListener(e){return UZ({logger:this.logger,events:this.components.events,metrics:this.components.metrics},v(v({},this.init),e))}listenFilter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):BZ(e)}dialFilter(e){return this.listenFilter(e)}};function jZ(r={}){return e=>new Zk(e,r)}var Jk=xr(Ux(),1);function HZ(r,e){let t=e.map((n,o)=>({record:ac(n),index:o}));return t.sort((n,o)=>{let i=n.record.sequence,s=o.record.sequence;if(i>s)return-1;if(i<s)return 1;if(n.record.validityType===Jo.ValidityType.EOL&&o.record.validityType===Jo.ValidityType.EOL){let a=Jk.default.fromString(n.record.validity).toDate(),c=Jk.default.fromString(o.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}var $Z="5.4.2",zZ="helia";var qZ={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function KZ(r={}){let e=`${zZ}/${$Z} ${Z6()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[OP(),CZ(),_Z(),jZ()],connectionEncrypters:[l5()],streamMuxers:[rG(),kY()],peerDiscovery:[vG(qZ)],services:{autoNAT:aG(),dcutr:OG(),delegatedRouting:()=>uq("https://delegated-ipfs.dev",aT()),dht:CY({clientMode:!0,validators:{ipns:$x},selectors:{ipns:HZ}}),identify:HG(),identifyPush:$G(),keychain:i6(r.keychain),ping:LY()}}}function WZ(r){return f(this,null,function*(){let e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=yield PT(r.datastore,r.keychain));let t=KZ(e);return t.datastore=t.datastore??r.datastore,yield hW(I(v(v({},t),e),{start:!1}))})}function GZ(){return f(this,arguments,function*(r={}){let e=r.datastore??new Yf,t=r.blockstore??new D2,n;return uwe(r.libp2p)?n=r.libp2p:n=yield WZ(I(v({},r),{libp2p:I(v({dns:r.dns},r.libp2p),{start:void 0}),datastore:e})),I(v({},r),{libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[oT(),PD()],routers:r.routers??[vT(n),gT()],metrics:n.metrics,start:r.start??!0})})}function uwe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function YZ(){return f(this,arguments,function*(r={}){let e=yield GZ(r),t=new cx(e);return r.start!==!1&&(yield t.start()),t})}function dwe(r){return r[Symbol.asyncIterator]!=null}function fwe(r,e=1){return e=Number(e),dwe(r)?function(){return M(this,null,function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");try{for(var n=O(r),o,i,s;o=!(i=yield new S(n.next())).done;o=!1){let a=i.value;for(t.push(a);t.length>=e;)yield t.slice(0,e),t=t.slice(e)}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield new S(i.call(n)))}finally{if(s)throw s[0]}}for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)})}():function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}()}var NS=fwe;function uw(r,e=1){return M(this,null,function*(){try{for(var t=O(NS(r,e)),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let s=o.value;let a=s.map(c=>f(null,null,function*(){return c().then(l=>({ok:!0,value:l}),l=>({ok:!1,err:l}))}));for(let c=0;c<a.length;c++){let l=yield new S(a[c]);if(l.ok)yield l.value;else throw l.err}}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})}var pwe=262144,dw=(r={})=>{let e=r.chunkSize??pwe;return function(n){return M(this,null,function*(){let o=new Ve,i=0,s=!1;try{for(var a=O(n),c,l,u;c=!(l=yield new S(a.next())).done;c=!1){let d=l.value;for(o.append(d),i+=d.length;i>=e;)if(yield o.slice(0,e),s=!0,e===o.length)o=new Ve,i=0;else{let h=new Ve;h.append(o.sublist(e)),o=h,i-=e}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new S(l.call(a)))}finally{if(u)throw u[0]}}(!s||i>0)&&(yield o.subarray(0,i))})}};var eR=(()=>{class r extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=r.name;code=r.code;constructor(t="Invalid type"){super(t)}}return r})(),XZ=(()=>{class r extends Error{static name="InvalidUnixFSMessageError";static code="ERR_INVALID_MESSAGE";name=r.name;code=r.code;constructor(t="Invalid message"){super(t)}}return r})();var Aa;(function(r){let e;(function(o){o.Raw="Raw",o.Directory="Directory",o.File="File",o.Metadata="Metadata",o.Symlink="Symlink",o.HAMTShard="HAMTShard"})(e=r.DataType||(r.DataType={}));let t;(function(o){o[o.Raw=0]="Raw",o[o.Directory=1]="Directory",o[o.File=2]="File",o[o.Metadata=3]="Metadata",o[o.Symlink=4]="Symlink",o[o.HAMTShard=5]="HAMTShard"})(t||(t={})),function(o){o.codec=()=>er(t)}(e=r.DataType||(r.DataType={}));let n;r.codec=()=>(n==null&&(n=Ue((o,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),o.Type!=null&&(i.uint32(8),r.DataType.codec().encode(o.Type,i)),o.Data!=null&&(i.uint32(18),i.bytes(o.Data)),o.filesize!=null&&(i.uint32(24),i.uint64(o.filesize)),o.blocksizes!=null)for(let a of o.blocksizes)i.uint32(32),i.uint64(a);o.hashType!=null&&(i.uint32(40),i.uint64(o.hashType)),o.fanout!=null&&(i.uint32(48),i.uint64(o.fanout)),o.mode!=null&&(i.uint32(56),i.uint32(o.mode)),o.mtime!=null&&(i.uint32(66),OS.codec().encode(o.mtime,i)),s.lengthDelimited!==!1&&i.ldelim()},(o,i)=>{let s={blocksizes:[]},a=i==null?o.len:o.pos+i;for(;o.pos<a;){let c=o.uint32();switch(c>>>3){case 1:s.Type=r.DataType.codec().decode(o);break;case 2:s.Data=o.bytes();break;case 3:s.filesize=o.uint64();break;case 4:s.blocksizes.push(o.uint64());break;case 5:s.hashType=o.uint64();break;case 6:s.fanout=o.uint64();break;case 7:s.mode=o.uint32();break;case 8:s.mtime=OS.codec().decode(o,o.uint32());break;default:o.skipType(c&7);break}}return s})),n),r.encode=o=>Be(o,r.codec()),r.decode=o=>Fe(o,r.codec())})(Aa||(Aa={}));var OS;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Seconds!=null&&(n.uint32(8),n.int64(t.Seconds)),t.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(t.FractionalNanoseconds)),o.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let o={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let s=t.uint32();switch(s>>>3){case 1:o.Seconds=t.int64();break;case 2:o.FractionalNanoseconds=t.fixed32();break;default:t.skipType(s&7);break}}return o})),e),r.encode=t=>Be(t,r.codec()),r.decode=t=>Fe(t,r.codec())})(OS||(OS={}));var QZ;(function(r){let e;r.codec=()=>(e==null&&(e=Ue((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.MimeType!=null&&(n.uint32(10),n.string(t.MimeType)),o.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let o={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let s=t.uint32();switch(s>>>3){case 1:o.MimeType=t.string();break;default:t.skipType(s&7);break}}return o})),e),r.encode=t=>Be(t,r.codec()),r.decode=t=>Fe(t,r.codec())})(QZ||(QZ={}));var ZZ={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},hwe=["directory","hamt-sharded-directory"],JZ=parseInt("0644",8),eJ=parseInt("0755",8),tJ=BigInt(1024),We=class r{static unmarshal(e){let t=Aa.decode(e);if(t.fanout!=null&&t.fanout>tJ)throw new XZ(`Fanout size was too large - ${t.fanout} > ${tJ}`);let n=new r({type:ZZ[t.Type!=null?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:t.mtime!=null?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return n._originalMode=t.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:n,blockSizes:o,hashType:i,fanout:s,mtime:a,mode:c}=e;if(t!=null&&!Object.values(ZZ).includes(t))throw new eR("Type: "+t+" is not valid");this.type=t??"file",this.data=n,this.hashType=i,this.fanout=s,this.blockSizes=o??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){e==null?this._mode=this.isDirectory()?eJ:JZ:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return hwe.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Aa.DataType.Raw;break;case"directory":e=Aa.DataType.Directory;break;case"file":e=Aa.DataType.File;break;case"metadata":e=Aa.DataType.Metadata;break;case"symlink":e=Aa.DataType.Symlink;break;case"hamt-sharded-directory":e=Aa.DataType.HAMTShard;break;default:throw new eR(`Type: ${e} is not valid`)}let t=this.data;(this.data==null||this.data.length===0)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===JZ&&!this.isDirectory()&&(n=void 0),n===eJ&&this.isDirectory()&&(n=void 0));let o;return this.mtime!=null&&(o={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Aa.encode({Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:o})}};var Da=(r,e,t)=>f(null,null,function*(){t.codec==null&&(t.codec=Ur);let n=yield wt.digest(r),o=ce.create(t.cidVersion,t.codec.code,n);return yield e.put(o,r,t),o});function rJ(r){return function(t,n){return M(this,null,function*(){let o=0n;try{for(var i=O(t.content),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let l=a.value;yield()=>f(null,null,function*(){let u,d={codec:Ur,cidVersion:r.cidVersion,onProgress:r.onProgress};r.rawLeaves?(d.codec=Po,d.cidVersion=1):(u=new We({type:r.leafType,data:l}),l=Ct({Data:u.marshal(),Links:[]}));let h=yield Da(l,n,d);return o+=BigInt(l.byteLength),r.onProgress?.(new fe("unixfs:importer:progress:file:write",{bytesWritten:o,cid:h,path:t.path})),{cid:h,unixfs:u,size:BigInt(l.length),block:l}})}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}})}}var nJ=(()=>{class r extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r.name;code=r.code;constructor(t="Invalid parameters"){super(t)}}return r})();var C1=(()=>{class r extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=r.name;code=r.code;constructor(t="Invalid content"){super(t)}}return r})();var oJ=(r,e,t)=>f(null,null,function*(){let n=new We({type:"directory",mtime:r.mtime,mode:r.mode}),o=Ct(Mr({Data:n.marshal()})),i=yield Da(o,e,t),s=r.path;return{cid:i,path:s,unixfs:n,size:BigInt(o.length),originalPath:r.originalPath,block:o}});function mwe(r,e,t){return M(this,null,function*(){let n=-1,o;try{for(var i=O(uw(t.bufferImporter(r,e),t.blockWriteConcurrency)),s,a,c;s=!(a=yield new S(i.next())).done;s=!1){let l=a.value;if(n++,n===0){o=I(v({},l),{single:!0});continue}else n===1&&o!=null&&(yield I(v({},o),{block:void 0,single:void 0}),o=void 0);yield I(v({},l),{block:void 0})}}catch{c=[a]}finally{try{s&&(a=i.return)&&(yield new S(a.call(i)))}finally{if(c)throw c[0]}}o!=null&&(yield o)})}function iJ(r){return r.single===!0}var gwe=(r,e,t)=>function(o){return f(this,null,function*(){if(o.length===1&&iJ(o[0])&&t.reduceSingleLeafToSelf){let u=o[0],d=u.block;return iJ(u)&&(r.mtime!==void 0||r.mode!==void 0)&&(u.unixfs=new We({type:"file",mtime:r.mtime,mode:r.mode,data:u.block}),d={Data:u.unixfs.marshal(),Links:[]},u.block=Ct(Mr(d)),u.cid=yield Da(u.block,e,I(v({},t),{cidVersion:t.cidVersion})),u.size=BigInt(u.block.length)),t.onProgress?.(new fe("unixfs:importer:progress:file:layout",{cid:u.cid,path:u.originalPath})),{cid:u.cid,path:r.path,unixfs:u.unixfs,size:u.size,originalPath:u.originalPath}}let i=new We({type:"file",mtime:r.mtime,mode:r.mode}),s=o.filter(u=>u.cid.code===Tr&&u.size>0||u.unixfs!=null&&u.unixfs.data==null&&u.unixfs.fileSize()>0n?!0:!!u.unixfs?.data?.length).map(u=>u.cid.code===Tr?(i.addBlockSize(u.size),{Name:"",Tsize:Number(u.size),Hash:u.cid}):(u.unixfs?.data==null?i.addBlockSize(u.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(u.unixfs.data.length)),{Name:"",Tsize:Number(u.size),Hash:u.cid})),a={Data:i.marshal(),Links:s},c=Ct(Mr(a)),l=yield Da(c,e,t);return t.onProgress?.(new fe("unixfs:importer:progress:file:layout",{cid:l,path:r.originalPath})),{cid:l,path:r.path,unixfs:i,size:BigInt(c.length+a.Links.reduce((u,d)=>u+(d.Tsize??0),0)),originalPath:r.originalPath,block:c}})},sJ=(r,e,t)=>f(null,null,function*(){return t.layout(mwe(r,e,t),gwe(r,e,t))});function ywe(r){return Symbol.iterator in r}function vwe(r){return Symbol.asyncIterator in r}function wwe(r){try{if(r instanceof Uint8Array)return function(){return M(this,null,function*(){yield r})}();if(ywe(r))return function(){return M(this,null,function*(){yield*Q(r)})}();if(vwe(r))return r}catch{throw new C1("Content was invalid")}throw new C1("Content was invalid")}function aJ(r){return function(t,n){return M(this,null,function*(){try{for(var o=O(t),i,s,a;i=!(s=yield new S(o.next())).done;i=!1){let c=s.value;let l;if(c.path!=null&&(l=c.path,c.path=c.path.split("/").filter(u=>u!=null&&u!==".").join("/")),bwe(c)){let u={path:c.path,mtime:c.mtime,mode:c.mode,content:function(){return M(this,null,function*(){let h=0n;try{for(var p=O(r.chunker(r.chunkValidator(wwe(c.content)))),m,y,b;m=!(y=yield new S(p.next())).done;m=!1){let x=y.value;let A=BigInt(x.byteLength);h+=A,r.onProgress?.(new fe("unixfs:importer:progress:file:read",{bytesRead:h,chunkSize:A,path:c.path})),yield x}}catch{b=[y]}finally{try{m&&(y=p.return)&&(yield new S(y.call(p)))}finally{if(b)throw b[0]}}})}(),originalPath:l},d=r.fileBuilder??sJ;yield()=>f(null,null,function*(){return d(u,n,r)})}else if(c.path!=null){let u={path:c.path,mtime:c.mtime,mode:c.mode,originalPath:l},d=r.dirBuilder??oJ;yield()=>f(null,null,function*(){return d(u,n,r)})}else throw new Error("Import candidate must have content or path or both")}}catch{a=[s]}finally{try{i&&(s=o.return)&&(yield new S(s.call(o)))}finally{if(a)throw a[0]}}})}}function bwe(r){return r.content!=null}var cJ=()=>function(e){return M(this,null,function*(){try{for(var t=O(e),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let s=o.value;if(s.length===void 0)throw new C1("Content was invalid");if(typeof s=="string"||s instanceof String)yield Z(s.toString());else if(Array.isArray(s))yield Uint8Array.from(s);else if(s instanceof Uint8Array)yield s;else throw new C1("Content was invalid")}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})};var Ewe=174;function fw(r){let e=r?.maxChildrenPerNode??Ewe;return function t(n,o){return f(this,null,function*(){let i=[];try{for(var s=O(NS(n,e)),a,c,l;a=!(c=yield s.next()).done;a=!1){let u=c.value;i.push(yield o(u))}}catch{l=[c]}finally{try{a&&(c=s.return)&&(yield c.call(s))}finally{if(l)throw l[0]}}return i.length>1?t(i,o):i[0]})}}var _c=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},pw=ce.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),hw=ce.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");var uh=class extends _c{_children;constructor(e,t){super(e,t),this._children=new Map}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)})}get(e){return f(this,null,function*(){return Promise.resolve(this._children.get(e))})}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}*eachChildSeries(){for(let[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(let[e,t]of this._children.entries())t.size!=null&&t.cid!=null&&(this.nodeSize+=e.length+(this.options.cidVersion===1?hw.bytes.byteLength:pw.bytes.byteLength));return this.nodeSize}flush(e){return M(this,null,function*(){let t=[];for(let[h,p]of this._children.entries()){let m=p;if(p instanceof _c)try{for(var c=O(p.flush(e)),l,u,d;l=!(u=yield new S(c.next())).done;l=!1){let y=u.value;m=y,yield y}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new S(u.call(c)))}finally{if(d)throw d[0]}}m.size!=null&&m.cid!=null&&t.push({Name:h,Tsize:Number(m.size),Hash:m.cid})}let n=new We({type:"directory",mtime:this.mtime,mode:this.mode}),o={Data:n.marshal(),Links:t},i=Ct(Mr(o)),s=yield new S(Da(i,e,this.options)),a=i.length+o.Links.reduce((h,p)=>h+(p.Tsize??0),0);this.cid=s,this.size=a,yield{cid:s,unixfs:n,path:this.path,size:BigInt(a)}})}};var FS=xr(dJ(),1);function xwe(r){let e=new Array(4);for(let t=0;t<4;t++)e[t]=r&255,r=r>>8;return new Uint8Array(e)}var AMt=df({name:"murmur3-32",code:35,encode:r=>xwe(FS.default.x86.hash32(r))}),dh=df({name:"murmur3-128",code:34,encode:r=>gh.fromHex(FS.default.x64.hash128(r))}),DMt=df({name:"murmur3-x64-64",code:34,encode:r=>gh.fromHex(FS.default.x64.hash128(r)).subarray(0,8)});var hJ=xr(BS(),1);var zi=class r{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new hJ.default,this.key=null}put(e,t){return f(this,null,function*(){let n=yield this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)})}get(e){return f(this,null,function*(){let t=yield this._findChild(e);if(t!=null)return t.value})}del(e){return f(this,null,function*(){let t=yield this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)})}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof r?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let t of e)t instanceof r?yield*Q(t.eachLeafSeries()):yield t}serialize(e,t){let n=[];return t(this._children.reduce((o,i,s)=>(i!=null&&(i instanceof r?o.push(i.serialize(e,t)):o.push(e(i,s))),o),n))}asyncTransform(e,t){return f(this,null,function*(){return mJ(this,e,t)})}toJSON(){return this.serialize(Awe,Dwe)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}_findChild(e){return f(this,null,function*(){let t=yield this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof r)&&n!=null&&n.key===e)return n})}_findPlace(e){return f(this,null,function*(){let t=this._options.hash(typeof e=="string"?Z(e):e),n=yield t.take(this._options.bits),o=this._children.get(n);return o instanceof r?o._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:o}})}_findNewBucketAndPos(e){return f(this,null,function*(){let t=yield this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){let n=new r(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);let o=yield n._findPlace(t.existingChild.hash);return o.bucket._putAt(o,t.existingChild.key,t.existingChild.value),n._findNewBucketAndPos(t.hash)}return t})}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(Iwe);if(e!=null&&!(e instanceof r)){let t=e.hash;t.untake(this._options.bits);let n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function Iwe(r){return!!r}function Awe(r,e){return r.key}function Dwe(r){return r}function mJ(r,e,t){return f(this,null,function*(){let n=[];for(let o of r._children.compactArray())if(o instanceof zi)yield mJ(o,e,t);else{let i=yield e(o);n.push({bitField:r._children.bitField(),children:i})}return t(n)})}var Twe=[255,254,252,248,240,224,192,128],Pwe=[1,3,7,15,31,63,127,255],US=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let o=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,t),a=Mwe(o,i-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Mwe(r,e,t){let n=kwe(e,t);return(r&n)>>>e}function kwe(r,e){return Twe[r]&Pwe[Math.min(e+r-1,7)]}function gJ(r){function e(t){return t instanceof VS?t:new VS(t,r)}return e}var VS=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}take(e){return f(this,null,function*(){let t=e;for(;this._availableBits<t;)yield this._produceMoreBits();let n=0;for(;t>0;){let o=this._buffers[this._currentBufferIndex],i=Math.min(o.availableBits(),t),s=o.take(i);n=(n<<i)+s,t-=i,this._availableBits-=i,o.availableBits()===0&&this._currentBufferIndex++}return n})}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],o=Math.min(n.totalBits()-n.availableBits(),t);n.untake(o),t-=o,this._availableBits+=o,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}_produceMoreBits(){return f(this,null,function*(){this._depth++;let e=this._depth>0?zt([this._value,Uint8Array.from([this._depth])]):this._value,t=yield this._hashFn(e),n=new US(t);this._buffers.push(n),this._availableBits+=n.availableBits()})}};function I1(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:r.bits??8,hash:gJ(r.hashFn)};return new zi(e)}function Rwe(r){return f(this,null,function*(){return(yield dh.encode(r)).slice(0,8).reverse()})}var yJ=BigInt(34),Nwe=8,tR=class extends _c{_bucket;constructor(e,t){super(e,t),this._bucket=I1({hashFn:Rwe,bits:t.shardFanoutBits??Nwe})}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,yield this._bucket.put(e,t)})}get(e){return f(this,null,function*(){return this._bucket.get(e)})}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}*eachChildSeries(){for(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=bJ(this._bucket,this,this.options),this.nodeSize)}flush(e){return M(this,null,function*(){try{for(var t=O(wJ(this._bucket,e,this,this.options)),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let s=o.value;yield I(v({},s),{path:this.path})}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})}},vJ=tR;function wJ(r,e,t,n){return M(this,null,function*(){let o=r._children,i=(r.tableSize()-1).toString(16).length,s=[],a=0n;for(let W=0;W<o.length;W++){let H=o.get(W);if(H==null)continue;let U=W.toString(16).toUpperCase().padStart(i,"0");if(H instanceof zi){let T;try{for(var m=O(wJ(H,e,null,n)),y,b,x;y=!(b=yield new S(m.next())).done;y=!1){let k=b.value;T=k}}catch{x=[b]}finally{try{y&&(b=m.return)&&(yield new S(b.call(m)))}finally{if(x)throw x[0]}}if(T==null)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:U,Tsize:Number(T.size),Hash:T.cid}),a+=T.size}else if(Owe(H.value)){let T=H.value,k;try{for(var A=O(T.flush(e)),P,L,F;P=!(L=yield new S(A.next())).done;P=!1){let j=L.value;k=j,yield k}}catch{F=[L]}finally{try{P&&(L=A.return)&&(yield new S(L.call(A)))}finally{if(F)throw F[0]}}if(k==null)throw new Error("Did not flush dir");let N=U+H.key;s.push({Name:N,Tsize:Number(k.size),Hash:k.cid}),a+=k.size}else{let T=H.value;if(T.cid==null)continue;let k=U+H.key,N=T.size;s.push({Name:k,Tsize:Number(N),Hash:T.cid}),a+=BigInt(N??0)}}let c=Uint8Array.from(o.bitField().reverse()),l=new We({type:"hamt-sharded-directory",data:c,fanout:BigInt(r.tableSize()),hashType:yJ,mtime:t?.mtime,mode:t?.mode}),u={Data:l.marshal(),Links:s},d=Ct(Mr(u)),h=yield new S(Da(d,e,n)),p=BigInt(d.byteLength)+a;yield{cid:h,unixfs:l,size:p}})}function Owe(r){return typeof r.flush=="function"}function bJ(r,e,t){let n=r._children,o=(r.tableSize()-1).toString(16).length,i=[];for(let l=0;l<n.length;l++){let u=n.get(l);if(u==null)continue;let d=l.toString(16).toUpperCase().padStart(o,"0");if(u instanceof zi){let h=bJ(u,null,t);i.push({Name:d,Tsize:Number(h),Hash:t.cidVersion===0?pw:hw})}else if(typeof u.value.flush=="function"){let p=u.value.nodeSize();i.push({Name:d+u.key,Tsize:Number(p),Hash:t.cidVersion===0?pw:hw})}else{let h=u.value;if(h.cid==null)continue;let p=d+u.key,m=h.size;i.push({Name:p,Tsize:Number(m),Hash:h.cid})}}let s=Uint8Array.from(n.bitField().reverse()),a=new We({type:"hamt-sharded-directory",data:s,fanout:BigInt(r.tableSize()),hashType:yJ,mtime:e?.mtime,mode:e?.mode});return Ct(Mr({Data:a.marshal(),Links:i})).length}function rR(r,e,t,n){return f(this,null,function*(){let o=e;e instanceof uh&&e.estimateNodeSize()>t&&(o=yield Lwe(e,n));let i=o.parent;if(i!=null){if(o!==e){if(r!=null&&(r.parent=o),o.parentKey==null)throw new Error("No parent key found");yield i.put(o.parentKey,o)}return rR(o,i,t,n)}return o})}function Lwe(r,e){return f(this,null,function*(){let t=new vJ({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for(let{key:n,child:o}of r.eachChildSeries())yield t.put(n,o);return t})}var EJ=(r="")=>r.split(new RegExp("(?<!\\\\)\\/")).filter(Boolean);function Fwe(r,e,t){return f(this,null,function*(){let n=EJ(r.path??""),o=n.length-1,i=e,s="";for(let a=0;a<n.length;a++){let c=n[a];s+=`${s!==""?"/":""}${c}`;let l=a===o;if(i.dirty=!0,i.cid=void 0,i.size=void 0,l)yield i.put(c,r),e=yield rR(null,i,t.shardSplitThresholdBytes,t);else{let u=yield i.get(c);(u==null||!(u instanceof _c))&&(u=new uh({root:!1,dir:!0,parent:i,parentKey:c,path:s,dirty:!0,flat:!0,mtime:u?.unixfs?.mtime,mode:u?.unixfs?.mode},t)),yield i.put(c,u),i=u}}return e})}function xJ(r,e){return M(this,null,function*(){if(!(r instanceof _c)){r.unixfs?.isDirectory()===!0&&(yield r);return}yield*Q(r.flush(e))})}function SJ(r){return function(t,n){return M(this,null,function*(){let o=new uh({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r),i,s=!1;try{for(var a=O(t),c,l,u;c=!(l=yield new S(a.next())).done;c=!1){let d=l.value;if(d==null)continue;let h=`${d.originalPath??""}`.split("/")[0];h!=null&&h!==""&&(i==null?(i=h,s=!0):i!==h&&(s=!1)),o=yield new S(Fwe(d,o,r)),d.unixfs?.isDirectory()!==!0&&(yield d)}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new S(l.call(a)))}finally{if(u)throw u[0]}}if(r.wrapWithDirectory||s&&o.childCount()>1)yield*Q(xJ(o,n));else for(let d of o.eachChildSeries())d!=null&&(yield*Q(xJ(d.child,n)))})}}function fh(n,o){return M(this,arguments,function*(r,e,t={}){let i;Symbol.asyncIterator in r||Symbol.iterator in r?i=r:i=[r];let s=t.wrapWithDirectory??!1,a=t.shardSplitThresholdBytes??262144,c=t.shardFanoutBits??8,l=t.cidVersion??1,u=t.rawLeaves??!0,d=t.leafType??"file",h=t.fileImportConcurrency??50,p=t.blockWriteConcurrency??10,m=t.reduceSingleLeafToSelf??!0,y=t.chunker??dw(),b=t.chunkValidator??cJ(),x=t.dagBuilder??aJ({chunker:y,chunkValidator:b,wrapWithDirectory:s,layout:t.layout??fw(),bufferImporter:t.bufferImporter??rJ({cidVersion:l,rawLeaves:u,leafType:d,onProgress:t.onProgress}),blockWriteConcurrency:p,reduceSingleLeafToSelf:m,cidVersion:l,onProgress:t.onProgress,dirBuilder:t.dirBuilder,fileBuilder:t.fileBuilder}),A=t.treeBuilder??SJ({wrapWithDirectory:s,shardSplitThresholdBytes:a,shardFanoutBits:c,cidVersion:l,onProgress:t.onProgress});try{for(var P=O(A(uw(x(i,e),h),e)),L,F,W;L=!(F=yield new S(P.next())).done;L=!1){let H=F.value;yield{cid:H.cid,path:H.path,unixfs:H.unixfs,size:H.size}}}catch{W=[F]}finally{try{L&&(F=P.return)&&(yield new S(F.call(P)))}finally{if(W)throw W[0]}}})}function _J(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield vg(fh([r],e,t));if(i==null)throw new nJ("Nothing imported");return i})}function CJ(n,o){return f(this,arguments,function*(r,e,t={}){return _J({content:r},e,t)})}function IJ(n,o){return f(this,arguments,function*(r,e,t={}){return _J({content:r},e,t)})}function Bwe(r){return r[Symbol.asyncIterator]!=null}function Uwe(r){if(Bwe(r))return f(null,null,function*(){let t;try{for(var n=O(r),o,i,s;o=!(i=yield n.next()).done;o=!1){let a=i.value;t=a}}catch{s=[i]}finally{try{o&&(i=n.return)&&(yield i.call(n))}finally{if(s)throw s[0]}}return t});let e;for(let t of r)e=t;return e}var Ta=Uwe;var Pa=class extends Error{name;code;constructor(e,t,n){super(e),this.name=t,this.code=n}},Cc=class extends Pa{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}},gi=class extends Pa{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PB_NODE")}},gd=class extends Pa{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}},gw=class extends Pa{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}},jS=class extends Pa{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}},A1=class extends Pa{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}},HS=class extends Pa{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}},yd=class extends Pa{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}},pn=class extends Pa{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}};var yw={cidVersion:1,rawLeaves:!0,layout:fw({maxChildrenPerNode:1024}),chunker:dw({chunkSize:1048576})};function $S(n,o){return M(this,arguments,function*(r,e,t={}){yield*Q(fh(r,e,v(v({},yw),t)))})}function AJ(n,o){return f(this,arguments,function*(r,e,t={}){let{cid:i}=yield CJ(r,e,v(v({},yw),t));return i})}function DJ(n,o){return f(this,arguments,function*(r,e,t={}){let{cid:i}=yield IJ(r,e,v(v({},yw),t));return i})}function TJ(n,o){return f(this,arguments,function*(r,e,t={}){if(r.path==null)throw new pn("path is required");if(r.content==null)throw new pn("content is required");let i=yield Ta($S([r],e,I(v(v({},yw),t),{wrapWithDirectory:!0})));if(i==null)throw new pn("Nothing imported");return i.cid})}function PJ(n,o){return f(this,arguments,function*(r,e,t={}){if(r.content!=null)throw new pn("Directories cannot have content, use addFile instead");let s=yield(r.path==null?vg:Ta)($S([I(v({},r),{path:r.path??"-"})],e,I(v(v({},yw),t),{wrapWithDirectory:r.path!=null})));if(s==null)throw new pn("Nothing imported");return s.cid})}var MJ=(()=>{class r extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=r.name;code=r.code;constructor(t="Bad path"){super(t)}}return r})(),Ic=(()=>{class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(t="Not found"){super(t)}}return r})(),kJ=(()=>{class r extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=r.name;code=r.code;constructor(t="No resolver"){super(t)}}return r})(),Yn=(()=>{class r extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=r.name;code=r.code;constructor(t="Not UnixFS"){super(t)}}return r})(),RJ=(()=>{class r extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=r.name;code=r.code;constructor(t="Over read"){super(t)}}return r})(),NJ=(()=>{class r extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=r.name;code=r.code;constructor(t="Under read"){super(t)}}return r})(),OJ=(()=>{class r extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=r.name;code=r.code;constructor(t="No Property found"){super(t)}}return r})(),vw=(()=>{class r extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r.name;code=r.code;constructor(t="Invalid parameters"){super(t)}}return r})();function D1(r,e,t,n,o,i,s){let a=r,c=o;for(;i.length>0;){let l=i[0];if(l in a){i.shift(),c=`${c}/${l}`;let u=ce.asCID(a[l]);if(u!=null)return{entry:{type:"object",name:n,path:o,cid:t,node:e,depth:s,size:BigInt(e.length),content:function(){return M(this,null,function*(){yield r})}},next:{cid:u,name:l,path:c,toResolve:i}};a=a[l]}else throw new OJ(`No property named ${l} found in node ${t}`)}return{entry:{type:"object",name:n,path:o,cid:t,node:e,depth:s,size:BigInt(e.length),content:function(){return M(this,null,function*(){yield r})}}}}var Vwe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=aA(c);return D1(l,c,r,e,t,n,i)}),LJ=Vwe;var jwe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=DE(c);return D1(l,c,r,e,t,n,i)}),FJ=jwe;function Hwe(r,e,t,n){let o=BigInt(r.length),i=BigInt(e+o);return t>=i||n<e?new Uint8Array(0):(n>=e&&n<i&&(r=r.subarray(0,Number(n-e))),t>=e&&t<i&&(r=r.subarray(Number(t-e))),r)}var ph=Hwe;var $we=(r,e=0,t=r)=>{let n=BigInt(r),o=BigInt(e??0),i=BigInt(t);if(i!==n&&(i=o+i),i>n&&(i=n),o<0n)throw new vw("Offset must be greater than or equal to 0");if(o>n)throw new vw("Offset must be less than the file size");if(i<0n)throw new vw("Length must be greater than or equal to 0");if(i>n)throw new vw("Length must be less than the file size");return{start:o,end:i}},T1=$we;var zwe=r=>{function e(){return M(this,arguments,function*(t={}){let{start:n,end:o}=T1(r.length,t.offset,t.length),i=ph(r,0n,n,o);t.onProgress?.(new fe("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:o-n,fileSize:BigInt(r.byteLength)})),yield i})}return e},qwe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){if(n.length>0)throw new Ic(`No link named ${t} found in raw node ${r}`);let c=Nt(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:zwe(c.digest),depth:i,size:BigInt(c.digest.length),node:c.digest}}}),BJ=qwe;var Kwe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=k9(c);return D1(l,c,r,e,t,n,i)}),UJ=Kwe;var Wwe=r=>{function e(){return M(this,arguments,function*(t={}){let{start:n,end:o}=T1(r.length,t.offset,t.length),i=ph(r,0n,n,o);t.onProgress?.(new fe("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:o-n,fileSize:BigInt(r.byteLength)})),yield i})}return e},Gwe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){if(n.length>0)throw new Ic(`No link named ${t} found in raw node ${r}`);let c=yield s.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:Wwe(c),depth:i,size:BigInt(c.length),node:c}}}),VJ=Gwe;var Ywe=function(r){return f(this,null,function*(){return(yield dh.encode(r)).slice(0,8).reverse()})},Xwe=(r,e,t)=>f(null,null,function*(){let n=(e.tableSize()-1).toString(16).length;yield Promise.all(r.map(o=>f(null,null,function*(){if(o.Name==null)throw new Error("Unexpected Link without a Name");if(o.Name.length===n){let i=parseInt(o.Name,16);e._putObjectAt(i,new zi({hash:t._options.hash,bits:t._options.bits},e,i));return}yield t.put(o.Name.substring(2),!0)})))}),jJ=(r,e)=>r.toString(16).toUpperCase().padStart(e,"0").substring(0,e),Qwe=r=>{let e=r.bucket,t=[];for(;e._parent!=null;)t.push(e),e=e._parent;return t.push(e),t.reverse()},HJ=(r,e,t,n,o)=>f(null,null,function*(){if(n==null){if(r.Data==null)throw new Yn("no data in PBNode");let d;try{d=We.unmarshal(r.Data)}catch(p){throw new Yn(p.message)}if(d.type!=="hamt-sharded-directory")throw new Yn("not a HAMT");if(d.fanout==null)throw new Yn("missing fanout");let h=I1({hashFn:Ywe,bits:Math.log2(Number(d.fanout))});n={rootBucket:h,hamtDepth:1,lastBucket:h}}let i=(n.lastBucket.tableSize()-1).toString(16).length;yield Xwe(r.Links,n.lastBucket,n.rootBucket);let s=yield n.rootBucket._findNewBucketAndPos(e),a=jJ(s.pos,i),c=Qwe(s);c.length>n.hamtDepth&&(n.lastBucket=c[n.hamtDepth],a=jJ(n.lastBucket._posAtParent,i));let l=r.Links.find(d=>{if(d.Name==null)return!1;let h=d.Name.substring(0,i),p=d.Name.substring(i);return!(h!==a||p!==""&&p!==e)});if(l==null)return;if(l.Name!=null&&l.Name.substring(i)===e)return l.Hash;n.hamtDepth++;let u=yield t.get(l.Hash,o);return r=Br(u),HJ(r,e,t,n,o)}),$J=HJ;var Zwe=(r,e,t,n,o,i,s)=>{function a(){return M(this,arguments,function*(c={}){let l=c.offset??0,u=c.length??e.Links.length,d=e.Links.slice(l,u);c.onProgress?.(new fe("unixfs:exporter:walk:directory",{cid:r})),yield*Q(lr(d,h=>_n(h,p=>()=>f(null,null,function*(){let m=p.Name??"",y=`${n}/${m}`;return(yield o(p.Hash,m,y,[],i+1,s,c)).entry})),h=>Bo(h,{ordered:!0,concurrency:c.blockReadConcurrency}),h=>so(h,p=>p!=null)))})}return a},zJ=Zwe;function qJ(r,e,t,n,o,i,s){return f(this,null,function*(){if(e instanceof Uint8Array){let l=ph(e,n,o,i);t.push(l);return}if(e.Data==null)throw new Yn("no data in PBNode");let a;try{a=We.unmarshal(e.Data)}catch(l){throw new Yn(l.message)}if(a.data!=null){let l=a.data,u=ph(l,n,o,i);t.push(u),n+=BigInt(u.byteLength)}let c=[];if(e.Links.length!==a.blockSizes.length)throw new Yn("Inconsistent block sizes and dag links");for(let l=0;l<e.Links.length;l++){let u=e.Links[l],d=n,h=d+a.blockSizes[l];if((o>=d&&o<h||i>=d&&i<=h||o<d&&i>h)&&c.push({link:u,blockStart:n}),n=h,n>i)break}yield lr(c,l=>_n(l,u=>()=>f(null,null,function*(){let d=yield r.get(u.link.Hash,s);return I(v({},u),{block:d})})),l=>Bo(l,{ordered:!0,concurrency:s.blockReadConcurrency}),l=>f(null,null,function*(){try{for(var u=O(l),d,h,p;d=!(h=yield u.next()).done;d=!1){let{link:m,block:y,blockStart:b}=h.value;let x;switch(m.Hash.code){case un:x=Br(y);break;case Tr:x=y;break;default:t.end(new Yn(`Unsupported codec: ${m.Hash.code}`));return}let A=new mu({concurrency:1});A.on("error",P=>{t.end(P)}),A.add(()=>f(null,null,function*(){s.onProgress?.(new fe("unixfs:exporter:walk:file",{cid:m.Hash})),yield qJ(r,x,t,b,o,i,s)})),yield A.onIdle()}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield h.call(u))}finally{if(p)throw p[0]}}})),n>=i&&t.end()})}var Jwe=(r,e,t,n,o,i,s)=>{function a(){return M(this,arguments,function*(c={}){let l=t.fileSize();if(l===void 0)throw new Error("File was a directory");let{start:u,end:d}=T1(l,c.offset,c.length);if(d===0n)return;let h=0n,p=d-u,m=Xr();c.onProgress?.(new fe("unixfs:exporter:walk:file",{cid:r})),qJ(s,e,m,0n,u,d,c).catch(P=>{m.end(P)});try{for(var y=O(m),b,x,A;b=!(x=yield new S(y.next())).done;b=!1){let P=x.value;if(P!=null){if(h+=BigInt(P.byteLength),h>p)throw m.end(),new RJ("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");h===p&&m.end(),c.onProgress?.(new fe("unixfs:exporter:progress:unixfs:file",{bytesRead:h,totalBytes:p,fileSize:l})),yield P}}}catch{A=[x]}finally{try{b&&(x=y.return)&&(yield new S(x.call(y)))}finally{if(A)throw A[0]}}if(h<p)throw new NJ("Traversed entire DAG but did not read enough bytes")})}return a},nR=Jwe;var ebe=(r,e,t,n,o,i,s)=>{function a(c={}){return c.onProgress?.(new fe("unixfs:exporter:walk:hamt-sharded-directory",{cid:r})),KJ(e,n,o,i,s,c)}return a};function KJ(r,e,t,n,o,i){return M(this,null,function*(){let s=r.Links;if(r.Data==null)throw new Yn("no data in PBNode");let a;try{a=We.unmarshal(r.Data)}catch(m){throw new Yn(m.message)}if(a.fanout==null)throw new Yn("missing fanout");let c=(a.fanout-1n).toString(16).length,l=lr(s,m=>_n(m,y=>()=>f(null,null,function*(){let b=y.Name!=null?y.Name.substring(c):null;if(b!=null&&b!==""){let x=yield t(y.Hash,b,`${e}/${b}`,[],n+1,o,i);return{entries:x.entry==null?[]:[x.entry]}}else{let x=yield o.get(y.Hash,i);return r=Br(x),i.onProgress?.(new fe("unixfs:exporter:walk:hamt-sharded-directory",{cid:y.Hash})),{entries:KJ(r,e,t,n,o,i)}}})),m=>Bo(m,{ordered:!0,concurrency:i.blockReadConcurrency}));try{for(var u=O(l),d,h,p;d=!(h=yield new S(u.next())).done;d=!1){let{entries:m}=h.value;yield*Q(m)}}catch{p=[h]}finally{try{d&&(h=u.return)&&(yield new S(h.call(u)))}finally{if(p)throw p[0]}}})}var WJ=ebe;var tbe=(r,e)=>r.Links.find(n=>n.Name===e)?.Hash,rbe={raw:nR,file:nR,directory:zJ,"hamt-sharded-directory":WJ,metadata:(r,e,t,n,o,i,s)=>()=>[],symlink:(r,e,t,n,o,i,s)=>()=>[]},nbe=(r,e,t,n,o,i,s,a)=>f(null,null,function*(){let c=yield s.get(r,a),l=Br(c),u,d;if(e==null&&(e=r.toString()),l.Data==null)throw new Yn("no data in PBNode");try{u=We.unmarshal(l.Data)}catch(p){throw new Yn(p.message)}if(t==null&&(t=e),n.length>0){let p;if(u?.type==="hamt-sharded-directory"?p=yield $J(l,n[0],s):p=tbe(l,n[0]),p==null)throw new Ic("file does not exist");let m=n.shift(),y=`${t}/${m}`;d={cid:p,toResolve:n,name:m??"",path:y}}let h=rbe[u.type](r,l,u,t,o,i,s);if(h==null)throw new Ic("could not find content exporter");return u.isDirectory()?{entry:{type:"directory",name:e,path:t,cid:r,content:h,unixfs:u,depth:i,node:l,size:u.fileSize()},next:d}:{entry:{type:"file",name:e,path:t,cid:r,content:h,unixfs:u,depth:i,node:l,size:u.fileSize()},next:d}}),GJ=nbe;var obe={[un]:GJ,[Tr]:VJ,[Dy]:LJ,[Py]:FJ,[wn.code]:BJ,[yy]:UJ},YJ=(r,e,t,n,o,i,s)=>f(null,null,function*(){let a=obe[r.code];if(a==null)throw new kJ(`No resolver for code ${r.code}`);return a(r,e,t,n,YJ,o,i,s)}),XJ=YJ;var ibe=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),sbe=r=>{if(r instanceof Uint8Array)return{cid:ce.decode(r),toResolve:[]};let e=ce.asCID(r);if(e!=null)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));let t=ibe(r);return{cid:ce.parse(t[0]),toResolve:t.slice(1)}}throw new MJ(`Unknown path type ${r}`)};function oR(n,o){return M(this,arguments,function*(r,e,t={}){let{cid:i,toResolve:s}=sbe(r),a=i.toString(),c=a,l=s.length;for(;;){let u=yield new S(XJ(i,a,c,s,l,e,t));if(u.entry==null&&u.next==null)throw new Ic(`Could not resolve ${r}`);if(u.entry!=null&&(yield u.entry),u.next==null)return;s=u.next.toResolve,i=u.next.cid,a=u.next.name,c=u.next.path}})}function Vo(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield Ta(oR(r,e,t));if(i==null)throw new Ic(`Could not resolve ${r}`);return i})}function zS(n,o){return M(this,arguments,function*(r,e,t={}){let i=yield new S(Vo(r,e,t));if(i==null)return;if(yield i,i.type==="directory")try{for(var a=O(s(i,t)),c,l,u;c=!(l=yield new S(a.next())).done;c=!1){let d=l.value;yield d}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new S(l.call(a)))}finally{if(u)throw u[0]}}function s(d,h){return M(this,null,function*(){try{for(var p=O(d.content(h)),m,y,b;m=!(y=yield new S(p.next())).done;m=!1){let x=y.value;yield x,!(x instanceof Uint8Array)&&x.type==="directory"&&(yield*Q(s(x,h)))}}catch{b=[y]}finally{try{m&&(y=p.return)&&(yield new S(y.call(p)))}finally{if(b)throw b[0]}}})}})}var cR=xr(BS(),1);function KS(r){function e(t){return t instanceof qS?t:new qS(t,r)}return e}var qS=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}take(e){return f(this,null,function*(){let t=e;for(;this._availableBits<t;)yield this._produceMoreBits();let n=0;for(;t>0;){let o=this._buffers[this._currentBufferIndex],i=Math.min(o.availableBits(),t),s=o.take(i);n=(n<<i)+s,t-=i,this._availableBits-=i,o.availableBits()===0&&this._currentBufferIndex++}return n})}untake(e){let t=e;for(;t>0;){let n=this._buffers[this._currentBufferIndex],o=Math.min(n.totalBits()-n.availableBits(),t);n.untake(o),t-=o,this._availableBits+=o,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}_produceMoreBits(){return f(this,null,function*(){this._depth++;let e=this._depth>0?zt([this._value,Uint8Array.from([this._depth])]):this._value,t=yield this._hashFn(e),n=new iR(t);this._buffers.push(n),this._availableBits+=n.availableBits()})}},abe=[255,254,252,248,240,224,192,128],cbe=[1,3,7,15,31,63,127,255],iR=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let o=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,t),a=lbe(o,i-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function lbe(r,e,t){let n=ube(e,t);return(r&n)>>>e}function ube(r,e){return abe[r]&cbe[Math.min(e+r-1,7)]}var ww=BigInt(dh.code),hh=8;function P1(r){return f(this,null,function*(){return(yield dh.encode(r)).subarray(0,8).reverse()})}var JJ=xr(BS(),1);var Ma=(r,e,t)=>f(null,null,function*(){t.codec==null&&(t.codec=Ur);let n=yield wt.digest(r),o=ce.create(t.cidVersion,t.codec.code,n);return yield e.put(o,r,I(v({},t),{signal:t.signal})),o});var sR=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},WS=class extends sR{_bucket;constructor(e,t){super(e,t),this._bucket=I1({hashFn:P1,bits:8})}put(e,t){return f(this,null,function*(){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,yield this._bucket.put(e,t)})}get(e){return f(this,null,function*(){return this._bucket.get(e)})}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}eachChildSeries(){return M(this,null,function*(){for(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}})}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=ZJ(this._bucket,this,this.options),this.nodeSize)}flush(e){return M(this,null,function*(){try{for(var t=O(QJ(this._bucket,e,this,this.options)),n,o,i;n=!(o=yield new S(t.next())).done;n=!1){let s=o.value;yield I(v({},s),{path:this.path})}}catch{i=[o]}finally{try{n&&(o=t.return)&&(yield new S(o.call(t)))}finally{if(i)throw i[0]}}})}};function QJ(r,e,t,n){return M(this,null,function*(){let o=r._children,i=[],s=0n;for(let F=0;F<o.length;F++){let W=o.get(F);if(W==null)continue;let H=F.toString(16).toUpperCase().padStart(2,"0");if(W instanceof zi){let U;try{for(var p=O(QJ(W,e,null,n)),m,y,b;m=!(y=yield new S(p.next())).done;m=!1){let T=y.value;U=T}}catch{b=[y]}finally{try{m&&(y=p.return)&&(yield new S(y.call(p)))}finally{if(b)throw b[0]}}if(U==null)throw new Error("Could not flush sharded directory, no sub-shard found");i.push({Name:H,Tsize:Number(U.size),Hash:U.cid}),s+=U.size}else if(dbe(W.value)){let U=W.value,T;try{for(var x=O(U.flush(e)),A,P,L;A=!(P=yield new S(x.next())).done;A=!1){let N=P.value;T=N,yield T}}catch{L=[P]}finally{try{A&&(P=x.return)&&(yield new S(P.call(x)))}finally{if(L)throw L[0]}}if(T==null)throw new Error("Did not flush dir");let k=H+W.key;i.push({Name:k,Tsize:Number(T.size),Hash:T.cid}),s+=T.size}else{let U=W.value;if(U.cid==null)continue;let T=H+W.key,k=U.size;i.push({Name:T,Tsize:Number(k),Hash:U.cid}),s+=BigInt(k??0)}}let a=Uint8Array.from(o.bitField().reverse()),c=new We({type:"hamt-sharded-directory",data:a,fanout:BigInt(r.tableSize()),hashType:ww,mtime:t?.mtime,mode:t?.mode}),l={Data:c.marshal(),Links:i},u=Ct(Mr(l)),d=yield new S(Ma(u,e,n)),h=BigInt(u.byteLength)+s;yield{cid:d,unixfs:c,size:h}})}function dbe(r){return typeof r.flush=="function"}function ZJ(r,e,t){let n=r._children,o=[];for(let c=0;c<n.length;c++){let l=n.get(c);if(l==null)continue;let u=c.toString(16).toUpperCase().padStart(2,"0");if(l instanceof zi){let d=ZJ(l,null,t);o.push({Name:u,Tsize:Number(d),Hash:t.cidVersion===0?GS:YS})}else if(typeof l.value.flush=="function"){let h=l.value.nodeSize();o.push({Name:u+l.key,Tsize:Number(h),Hash:t.cidVersion===0?GS:YS})}else{let d=l.value;if(d.cid==null)continue;let h=u+l.key,p=d.size;o.push({Name:h,Tsize:Number(p),Hash:d.cid})}}let i=Uint8Array.from(n.bitField().reverse()),s=new We({type:"hamt-sharded-directory",data:i,fanout:BigInt(r.tableSize()),hashType:ww,mtime:e?.mtime,mode:e?.mode});return Ct(Mr({Data:s.marshal(),Links:o})).length}var GS=ce.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),YS=ce.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");var aR=Dt("helia:unixfs:commands:utils:hamt-utils"),XS=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),eee=(r,e,t)=>f(null,null,function*(){let n=new WS({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let i=0;i<e.length;i++)yield n._bucket.put(e[i].name,{size:e[i].size,cid:e[i].cid});let o=yield Ta(n.flush(r));if(o==null)throw new Error("Flushing shard yielded no result");return o}),QS=(r,e,t)=>f(null,null,function*(){let n=We.unmarshal(r[0].node.Data??new Uint8Array(0)),o=BigInt(Math.pow(2,hh));r.reverse();let i,s;for(let a=0;a<r.length;a++){let c=a===r.length-1,l=r[a],u=Uint8Array.from(l.children.bitField().reverse()),d=new We({type:"hamt-sharded-directory",data:u,fanout:o,hashType:ww});c&&(d.mtime=n.mtime,d.mode=n.mode),s={Data:d.marshal(),Links:l.node.Links};let h=Ct(Mr(s));if(i=yield Ma(h,e,t),!c){let p=r[a+1];if(p==null)throw new Error("Was not operating on shard root but also had no parent?");aR("updating link in parent sub-shard with prefix %s",p.prefix),p.node.Links=p.node.Links.filter(m=>m.Name!==p.prefix),p.node.Links.push({Name:p.prefix,Hash:i,Tsize:l.node.Links.reduce((m,y)=>m+(y.Tsize??0),h.byteLength)})}}if(i==null||s==null)throw new Error("Noting persisted");return{cid:i,node:s}}),ZS=(r,e,t,n)=>f(null,null,function*(){let i=KS(P1)(Z(e)),s=[];for(;;){let a=yield t.get(r,n),c=Br(a),l=new JJ.default,u=yield i.take(hh),d=XS(u);s.push({prefix:d,children:l,node:c});let h;for(let m of c.Links){let y=m.Name??"";if(y.length<2)throw new Error("Invalid HAMT - link name was too short");let b=parseInt(y.substring(0,2),16);l.set(b,!0),y.startsWith(d)&&(h=m)}if(h==null){aR("no link found with prefix %s for %s",d,e);break}let p=h.Name??"";if(p.length<2)throw new Error("Invalid HAMT - link name was too short");if(p.length===2){r=h.Hash,aR("descend into sub-shard with prefix %s",p);continue}break}return{path:s,hash:i}});function JS(r,e,t,n){return f(this,null,function*(){if(r.Data==null)throw new Error("DagPB node had no data");let o=We.unmarshal(r.Data),i;if(o.type==="directory")i=fbe(r);else if(o.type==="hamt-sharded-directory")i=yield tee(r,0,t,e,n);else throw new Error("Can only estimate the size of directories or shards");return i>t})}function fbe(r){let e=0;for(let t of r.Links)e+=(t.Name??"").length,e+=t.Hash.version===1?YS.bytes.byteLength:GS.bytes.byteLength;return e}function tee(r,e,t,n,o){return f(this,null,function*(){if(e>t)return t;if(r.Data==null||!We.unmarshal(r.Data).isDirectory())return e;for(let s of r.Links){let a=s.Name??"";if(a=a.substring(2),e+=a.length,e+=s.Hash.bytes.byteLength,s.Hash.code===un){let c=yield n.get(s.Hash,o),l=Br(c);e+=yield tee(l,e,t,n,o)}}return e})}var Ac=Dt("helia:unixfs:components:utils:add-link");function M1(r,e,t,n){return f(this,null,function*(){if(r.node.Data==null)throw new pn("Invalid parent passed to addLink");if(We.unmarshal(r.node.Data).type==="hamt-sharded-directory")return Ac("adding link to sharded directory"),mbe(r,e,t,n);Ac(`adding ${e.Name} (${e.Hash}) to regular directory`);let i=yield hbe(r,e,t,n);if(yield JS(i.node,t,n.shardSplitThresholdBytes,n)){Ac("converting directory to sharded directory");let s=yield pbe(i,t);i.cid=s.cid,i.node=Br(yield t.get(s.cid,n))}return i})}var pbe=(r,e)=>f(null,null,function*(){if(r.node.Data==null)throw new pn("Invalid parent passed to convertToShardedDirectory");let t=We.unmarshal(r.node.Data),n=yield eee(e,r.node.Links.map(o=>({name:o.Name??"",size:BigInt(o.Tsize??0),cid:o.Hash})),{mode:t.mode,mtime:t.mtime,cidVersion:r.cid.version});return Ac(`converted directory to sharded directory ${n.cid}`),n}),hbe=(r,e,t,n)=>f(null,null,function*(){let o=r.node.Links.filter(u=>{let d=u.Name===e.Name;if(d&&!n.allowOverwriting)throw new gw;return!d});if(o.push(e),r.node.Data==null)throw new gi("Parent node with no data passed to addToDirectory");let i=We.unmarshal(r.node.Data),s;if(i.mtime!=null){let u=Date.now(),d=Math.floor(u/1e3);i.mtime={secs:BigInt(d),nsecs:(u-d*1e3)*1e3},s=i.marshal()}else s=r.node.Data;r.node=Mr({Data:s,Links:o});let a=Ct(r.node),c=yield wt.digest(a),l=ce.create(r.cid.version,un,c);return yield t.put(l,a),{node:r.node,cid:l}}),mbe=(r,e,t,n)=>f(null,null,function*(){let{path:o,hash:i}=yield ZS(r.cid,e.Name,t,n),s=o[o.length-1];if(s==null)throw new Error("Invalid HAMT, could not generate path");let a=s.prefix,c=parseInt(a,16);Ac("next prefix for %s is %s",e.Name,a);let l=`${a}${e.Name}`,u=s.node.Links.find(d=>(d.Name??"").startsWith(a));if(u!=null)if(Ac("link %s was present in shard",l),u.Name===l){if(!n.allowOverwriting)throw new gw;Ac("overwriting %s in sub-shard",e.Name),s.node.Links=s.node.Links.filter(d=>d.Name!==l),s.node.Links.push({Name:l,Hash:e.Hash,Tsize:e.Tsize})}else{if(u.Name?.length===2)throw new Error("Existing link was sub-shard?!");{Ac("prefix %s already exists, creating new sub-shard",a);let d=s.node.Links.findIndex(b=>b.Name?.startsWith(a)),h=s.node.Links.splice(d,1)[0],p=(h.Name??"").substring(2),y=KS(P1)(Z(p));for(let b=0;b<o.length;b++)yield y.take(hh);for(;;){let b=yield y.take(hh),x=XS(b);h.Name=`${x}${p}`;let A=yield i.take(hh),P=XS(A);if(x===P){let F=new cR.default;F.set(A,!0),o.push({prefix:P,children:F,node:{Links:[]}});continue}let L=new cR.default;L.set(A,!0),L.set(b,!0),o.push({prefix:a,children:L,node:{Links:[h,{Name:`${P}${e.Name}`,Hash:e.Hash,Tsize:e.Tsize}]}});break}}}else Ac("link %s was not present in sub-shard",l),e.Name=l,s.node.Links.push(e),s.children.set(c,!0),Ac("adding %s to existing sub-shard",l);return QS(o,t,n)});function vd(n,o){return f(this,arguments,function*(r,e,t={}){let i=yield Vo(r,e,t);if(i.type!=="directory")throw new yd(`${r.toString()} was not a UnixFS directory`);return{cid:r,node:i.node}})}function k1(r,e,t,n){return f(this,null,function*(){let o=yield Vo(r,t,n);if(o.type!=="directory"&&o.type!=="file"&&o.type!=="raw")throw new Cc(`${r.toString()} was not a UnixFS node`);return{Name:e,Tsize:o.node instanceof Uint8Array?o.node.byteLength:gbe(o.node),Hash:r}})}function gbe(r){let e=r.Links.reduce((t,n)=>t+(n.Tsize??0),0);return Ct(r).byteLength+e}var ybe=Dt("helia:unixfs:components:utils:resolve");function Dc(r,e,t,n){return f(this,null,function*(){if(e==null||e==="")return{cid:r};let o=`/ipfs/${r}${e==null?"":`/${e}`}`,i=yield pa(oR(o,t,n));if(i.length===0)throw new jS("Could not find path in directory");return ybe("resolved %s to %c",e,r),{cid:i[i.length-1].cid,path:e,segments:i}})}function R1(r,e,t,n){return f(this,null,function*(){if(e.segments==null||e.segments.length===0)return r;let o=e.segments.pop();if(o==null)throw new Error("Insufficient segments");o.cid=r,e.segments.reverse();for(let i of e.segments){let[s,a]=yield Promise.all([vd(i.cid,t,n),k1(o.cid,o.name,t,n)]);r=(yield M1(s,a,t,I(v({},n),{allowOverwriting:!0,cidVersion:r.version}))).cid,i.cid=r,o=i}return r})}var vbe=kr.bind({ignoreUndefined:!0}),wbe={};function ree(n,o){return M(this,arguments,function*(r,e,t={}){let i=vbe(wbe,t),s=yield new S(Dc(r,i.path,e,i)),a=yield new S(Vo(s.cid,e,i));if(a.type!=="file"&&a.type!=="raw")throw new HS;if(a.content==null)throw new A1;yield*Q(a.content(i))})}var bbe=kr.bind({ignoreUndefined:!0}),Ebe=Dt("helia:unixfs:chmod"),xbe={recursive:!1,shardSplitThresholdBytes:262144};function nee(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=bbe(xbe,n),c=yield Dc(r,a.path,t,n);if(Ebe("chmod %c %d",c.cid,e),a.recursive){let y=yield lr(function(){return M(this,null,function*(){try{for(var b=O(zS(c.cid,t,n)),x,A,P;x=!(A=yield new S(b.next())).done;x=!1){let L=A.value;let F,W=[];if(L.type==="raw")F=new We({type:"file",data:L.node});else if(L.type==="file"||L.type==="directory")F=L.unixfs,W=L.node.Links;else throw new Cc;F.mode=e;let H={Data:F.marshal(),Links:W};yield{path:L.path,content:H}}}catch{P=[A]}finally{try{x&&(A=b.return)&&(yield new S(A.call(b)))}finally{if(P)throw P[0]}}})},b=>fh(b,t,I(v({},a),{dagBuilder:function(x,A){return M(this,null,function*(){try{for(var P=O(x),L,F,W;L=!(F=yield new S(P.next())).done;L=!1){let H=F.value;yield function(){return f(this,null,function*(){let U=H.content,T=Ct(U),k=yield Ma(T,A,I(v({},a),{cidVersion:r.version}));if(U.Data==null)throw new gi(`${k} had no data`);let N=We.unmarshal(U.Data);return{cid:k,size:BigInt(T.length),path:H.path,unixfs:N}})}}}catch{W=[F]}finally{try{L&&(F=P.return)&&(yield new S(F.call(P)))}finally{if(W)throw W[0]}}})}})),b=>f(null,null,function*(){return Ta(b)}));if(y==null)throw new gd(`Could not chmod ${c.cid.toString()}`);return R1(y.cid,c,t,a)}let l=yield t.get(c.cid,n),u,d=[];if(c.cid.code===Tr)u=new We({type:"file",data:l});else{let y=Br(l);if(y.Data==null)throw new gi(`${c.cid.toString()} had no data`);d=y.Links,u=We.unmarshal(y.Data)}u.mode=e;let h=Ct({Data:u.marshal(),Links:d}),p=yield wt.digest(h),m=ce.create(c.cid.version,un,p);return yield t.put(m,h),R1(m,c,t,a)})}var Sbe=kr.bind({ignoreUndefined:!0}),_be=Dt("helia:unixfs:cp"),Cbe={force:!1,shardSplitThresholdBytes:262144};function oee(i,s,a,c){return f(this,arguments,function*(r,e,t,n,o={}){let l=Sbe(Cbe,o);if(t.includes("/"))throw new pn("Name must not have slashes");let[u,d]=yield Promise.all([vd(e,n,l),k1(r,t,n,l)]);return _be('Adding %c as "%s" to %c',r,t,e),(yield M1(u,d,n,v({allowOverwriting:l.force,cidVersion:e.version},l))).cid})}var Ibe=kr.bind({ignoreUndefined:!0}),Abe={};function iee(n,o){return M(this,arguments,function*(r,e,t={}){let i=Ibe(Abe,t),s=yield new S(Dc(r,i.path,e,i)),a=yield new S(Vo(s.cid,e));if(a.type==="file"||a.type==="raw"){yield a;return}if(a.content==null)throw new A1;if(a.type!=="directory")throw new yd;yield*Q(a.content({offset:t.offset,length:t.length}))})}var Dbe=kr.bind({ignoreUndefined:!0}),see=Dt("helia:unixfs:mkdir"),Tbe={cidVersion:1,force:!1,shardSplitThresholdBytes:262144};function aee(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=Dbe(Tbe,n);if(e.includes("/"))throw new pn("Path must not have slashes");if((yield Vo(r,t,n)).type!=="directory")throw new yd(`${r.toString()} was not a UnixFS directory`);see("creating %s",e);let u={Data:new We({type:"directory",mode:a.mode,mtime:a.mtime}).marshal(),Links:[]},d=Ct(u),h=yield wt.digest(d),p=ce.create(a.cidVersion,un,h);yield t.put(p,d);let[m,y]=yield Promise.all([vd(r,t,a),k1(p,e,t,a)]);return see("adding empty dir called %s to %c",e,r),(yield M1(m,y,t,I(v({},a),{allowOverwriting:a.force}))).cid})}var t_=Dt("helia:unixfs:utils:remove-link");function cee(r,e,t,n){return f(this,null,function*(){if(r.node.Data==null)throw new gi("Parent node had no data");if(We.unmarshal(r.node.Data).type==="hamt-sharded-directory"){t_(`removing ${e} from sharded directory`);let i=yield Mbe(r,e,t,n);return(yield JS(i.node,t,n.shardSplitThresholdBytes,n))?i:(t_("converting shard to flat directory %c",r.cid),kbe(i,t,n))}return t_(`removing link ${e} regular directory`),Pbe(r,e,t,n)})}var Pbe=(r,e,t,n)=>f(null,null,function*(){r.node.Links=r.node.Links.filter(s=>s.Name!==e);let o=Ct(r.node),i=yield Ma(o,t,I(v({},n),{cidVersion:r.cid.version}));return t_(`Updated regular directory ${i}`),{node:r.node,cid:i}}),Mbe=(r,e,t,n)=>f(null,null,function*(){let{path:o}=yield ZS(r.cid,e,t,n),i=o[o.length-1];if(i==null)throw new Error("Invalid HAMT, could not generate path");let s=i.node.Links.filter(l=>(l.Name??"").substring(2)===e).map(l=>l.Name).pop();if(s==null)throw new Error("File not found");let a=s.substring(0,2),c=parseInt(a,16);if(i.node.Links=i.node.Links.filter(l=>l.Name!==s),i.children.unset(c),i.node.Links.length===1)for(;o.length!==1;){let l=o[o.length-1];if(l==null||l.node.Links.length>1)break;o.pop();let u=o[o.length-1];if(u==null)break;let d=l.node.Links[0];u.node.Links=u.node.Links.filter(h=>!(h.Name??"").startsWith(u.prefix)),u.node.Links.push({Hash:d.Hash,Name:`${u.prefix}${(d.Name??"").substring(2)}`,Tsize:d.Tsize})}return QS(o,t,n)}),kbe=(r,e,t)=>f(null,null,function*(){if(r.node.Data==null)throw new pn("Invalid parent passed to convertToFlatDirectory");let n={Links:[]},o=yield Vo(r.cid,e);if(o.type!=="directory")throw new Error("Unexpected node type");try{for(var c=O(o.content()),l,u,d;l=!(u=yield c.next()).done;l=!1){let h=u.value;let p=0;h.node instanceof Uint8Array?p=h.node.byteLength:p=Ct(h.node).length,n.Links.push({Hash:h.cid,Name:h.name,Tsize:p})}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield u.call(c))}finally{if(d)throw d[0]}}let i=We.unmarshal(r.node.Data);n.Data=new We({type:"directory",mode:i.mode,mtime:i.mtime}).marshal();let s=Ct(Mr(n));return{cid:yield Ma(s,e,{codec:Ur,cidVersion:r.cid.version,signal:t.signal}),node:n}});var Rbe=kr.bind({ignoreUndefined:!0}),Nbe=Dt("helia:unixfs:rm"),Obe={shardSplitThresholdBytes:262144};function lee(o,i,s){return f(this,arguments,function*(r,e,t,n={}){let a=Rbe(Obe,n);if(e.includes("/"))throw new pn("Name must not have slashes");let c=yield vd(r,t,a);return Nbe("Removing %s from %c",e,r),(yield cee(c,e,t,I(v({},a),{cidVersion:r.version}))).cid})}var uee=1877,r_=1604,Lbe=kr.bind({ignoreUndefined:!0}),Fbe=Dt("helia:unixfs:stat"),Bbe={};function dee(n,o){return f(this,arguments,function*(r,e,t={}){let i=Lbe(Bbe,t),s=yield Dc(r,t.path,e,i);Fbe("stat %c",s.cid);let a=yield Vo(s.cid,e,i);if(a.type==="raw")return t.extended===!0?Hbe(a):jbe(a);if(a.type==="file"||a.type==="directory")return t.extended===!0?Vbe(a,e,t.filter??new rg({filterSize:1024}),t):Ube(a);throw new Cc})}function Ube(r){return{type:r.type,cid:r.cid,unixfs:r.unixfs,mode:r.unixfs.mode??(r.unixfs.isDirectory()?uee:r_),mtime:r.unixfs.mtime,size:r.unixfs.fileSize()}}function Vbe(r,e,t,n){return f(this,null,function*(){let o=yield fee(r.cid,e,!1,t,n);return{type:r.type,cid:r.cid,unixfs:r.unixfs,size:r.unixfs.isDirectory()?o.dirSize:r.unixfs.fileSize(),mode:r.unixfs.mode??(r.unixfs.isDirectory()?uee:r_),mtime:r.unixfs.mtime,localSize:o.localSize,dagSize:o.dagSize,deduplicatedDagSize:o.deduplicatedDagSize,blocks:o.blocks,uniqueBlocks:o.uniqueBlocks}})}function jbe(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:r_,mtime:void 0,size:BigInt(r.node.byteLength)}}function Hbe(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:r_,mtime:void 0,size:BigInt(r.node.byteLength),localSize:BigInt(r.node.byteLength),dagSize:BigInt(r.node.byteLength),deduplicatedDagSize:BigInt(r.node.byteLength),blocks:1n,uniqueBlocks:1n}}function fee(r,e,t,n,o){return f(this,null,function*(){let i={dirSize:0n,localSize:0n,dagSize:0n,deduplicatedDagSize:0n,blocks:0n,uniqueBlocks:0n};try{let s=n.has(r.bytes);n.add(r.bytes);let a=yield e.get(r,o);if(i.blocks++,i.dagSize+=BigInt(a.byteLength),s||(i.uniqueBlocks++,i.deduplicatedDagSize+=BigInt(a.byteLength)),r.code===Tr)i.localSize+=BigInt(a.byteLength),t&&(i.dirSize+=BigInt(a.byteLength));else if(r.code===un){let c=Br(a),l;if(c.Data!=null&&(l=We.unmarshal(c.Data)),c.Links.length>0){for(let u of c.Links){let d=yield fee(u.Hash,e,$be(u,l),n,o);i.localSize+=d.localSize,i.dagSize+=d.dagSize,i.deduplicatedDagSize+=d.deduplicatedDagSize,i.blocks+=d.blocks,i.uniqueBlocks+=d.uniqueBlocks,i.dirSize+=d.dirSize}t&&l!=null&&(i.dirSize+=l.fileSize())}else{if(l==null)throw new gi(`PBNode ${r.toString()} had no data`);l.data!=null&&(i.localSize+=BigInt(l.data.byteLength??0)),t&&(i.dirSize+=l.fileSize())}}else throw new gd(`${r.toString()} was neither DAG_PB nor RAW`)}catch(s){if(s.name!=="NotFoundError"||o.offline!==!0)throw s}return i})}function $be(r,e){if(e==null)return!1;let t=r.Name;return t==null?!1:e.type==="directory"?!0:e.type==="hamt-sharded-directory"&&t.length>2}var zbe=kr.bind({ignoreUndefined:!0}),qbe=Dt("helia:unixfs:touch"),Kbe={recursive:!1,shardSplitThresholdBytes:262144};function pee(n,o){return f(this,arguments,function*(r,e,t={}){let i=zbe(Kbe,t),s=yield Dc(r,i.path,e,i),a=i.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(qbe("touch %c %o",s.cid,a),i.recursive){let m=yield lr(function(){return M(this,null,function*(){try{for(var y=O(zS(s.cid,e)),b,x,A;b=!(x=yield new S(y.next())).done;b=!1){let P=x.value;let L,F;if(P.type==="raw")L=new We({data:P.node}),F=[];else if(P.type==="file"||P.type==="directory")L=P.unixfs,F=P.node.Links;else throw new Cc;L.mtime=a;let W={Data:L.marshal(),Links:F};yield{path:P.path,content:W}}}catch{A=[x]}finally{try{b&&(x=y.return)&&(yield new S(x.call(y)))}finally{if(A)throw A[0]}}})},y=>fh(y,e,I(v({},i),{dagBuilder:function(b,x){return M(this,null,function*(){try{for(var A=O(b),P,L,F;P=!(L=yield new S(A.next())).done;P=!1){let W=L.value;yield function(){return f(this,null,function*(){let H=W.content,U=Ct(H),T=yield Ma(U,x,I(v({},i),{cidVersion:r.version}));if(H.Data==null)throw new gi(`${T} had no data`);let k=We.unmarshal(H.Data);return{cid:T,size:BigInt(U.length),path:W.path,unixfs:k}})}}}catch{F=[L]}finally{try{P&&(L=A.return)&&(yield new S(L.call(A)))}finally{if(F)throw F[0]}}})}})),y=>f(null,null,function*(){return Ta(y)}));if(m==null)throw new gd(`Could not chmod ${s.cid.toString()}`);return R1(m.cid,s,e,i)}let c=yield e.get(s.cid,t),l,u=[];if(s.cid.code===Tr)l=new We({data:c});else{let m=Br(c);if(u=m.Links,m.Data==null)throw new gi(`${s.cid.toString()} had no data`);l=We.unmarshal(m.Data)}l.mtime=a;let d=Ct({Data:l.marshal(),Links:u}),h=yield wt.digest(d),p=ce.create(s.cid.version,un,h);return yield e.put(p,d),R1(p,s,e,i)})}var n_=class{components;constructor(e){this.components=e}addAll(n){return M(this,arguments,function*(e,t={}){yield*Q($S(e,this.components.blockstore,t))})}addBytes(n){return f(this,arguments,function*(e,t={}){return AJ(e,this.components.blockstore,t)})}addByteStream(n){return f(this,arguments,function*(e,t={}){return DJ(e,this.components.blockstore,t)})}addFile(n){return f(this,arguments,function*(e,t={}){return TJ(e,this.components.blockstore,t)})}addDirectory(){return f(this,arguments,function*(e={},t={}){return PJ(e,this.components.blockstore,t)})}cat(n){return M(this,arguments,function*(e,t={}){yield*Q(ree(e,this.components.blockstore,t))})}chmod(o,i){return f(this,arguments,function*(e,t,n={}){return nee(e,t,this.components.blockstore,n)})}cp(i,s,a){return f(this,arguments,function*(e,t,n,o={}){return oee(e,t,n,this.components.blockstore,o)})}ls(n){return M(this,arguments,function*(e,t={}){yield*Q(iee(e,this.components.blockstore,t))})}mkdir(o,i){return f(this,arguments,function*(e,t,n={}){return aee(e,t,this.components.blockstore,n)})}rm(o,i){return f(this,arguments,function*(e,t,n={}){return lee(e,t,this.components.blockstore,n)})}stat(n){return f(this,arguments,function*(e,t={}){return dee(e,this.components.blockstore,t)})}touch(n){return f(this,arguments,function*(e,t={}){return pee(e,this.components.blockstore,t)})}};function hee(r){return new n_(r)}var dR=(r,e)=>e.some(t=>r instanceof t),mee,gee;function Wbe(){return mee||(mee=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gbe(){return gee||(gee=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var fR=new WeakMap,lR=new WeakMap,o_=new WeakMap;function Ybe(r){let e=new Promise((t,n)=>{let o=()=>{r.removeEventListener("success",i),r.removeEventListener("error",s)},i=()=>{t(wd(r.result)),o()},s=()=>{n(r.error),o()};r.addEventListener("success",i),r.addEventListener("error",s)});return o_.set(e,r),e}function Xbe(r){if(fR.has(r))return;let e=new Promise((t,n)=>{let o=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",s),r.removeEventListener("abort",s)},i=()=>{t(),o()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),o()};r.addEventListener("complete",i),r.addEventListener("error",s),r.addEventListener("abort",s)});fR.set(r,e)}var pR={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return fR.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wd(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function bee(r){pR=r(pR)}function Qbe(r){return Gbe().includes(r)?function(...e){return r.apply(hR(this),e),wd(this.request)}:function(...e){return wd(r.apply(hR(this),e))}}function Zbe(r){return typeof r=="function"?Qbe(r):(r instanceof IDBTransaction&&Xbe(r),dR(r,Wbe())?new Proxy(r,pR):r)}function wd(r){if(r instanceof IDBRequest)return Ybe(r);if(lR.has(r))return lR.get(r);let e=Zbe(r);return e!==r&&(lR.set(r,e),o_.set(e,r)),e}var hR=r=>o_.get(r);function i_(r,e,{blocked:t,upgrade:n,blocking:o,terminated:i}={}){let s=indexedDB.open(r,e),a=wd(s);return n&&s.addEventListener("upgradeneeded",c=>{n(wd(s.result),c.oldVersion,c.newVersion,wd(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function s_(r,{blocked:e}={}){let t=indexedDB.deleteDatabase(r);return e&&t.addEventListener("blocked",n=>e(n.oldVersion,n)),wd(t).then(()=>{})}var Jbe=["get","getKey","getAll","getAllKeys","count"],e3e=["put","add","delete","clear"],uR=new Map;function yee(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(uR.get(e))return uR.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,o=e3e.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(o||Jbe.includes(t)))return;let i=function(s,...a){return f(this,null,function*(){let c=this.transaction(s,o?"readwrite":"readonly"),l=c.store;return n&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),o&&c.done]))[0]})};return uR.set(e,i),i}bee(r=>I(v({},r),{get:(e,t,n)=>yee(e,t)||r.get(e,t,n),has:(e,t)=>!!yee(e,t)||r.has(e,t)}));var t3e=["continue","continuePrimaryKey","advance"],vee={},mR=new WeakMap,Eee=new WeakMap,r3e={get(r,e){if(!t3e.includes(e))return r[e];let t=vee[e];return t||(t=vee[e]=function(...n){mR.set(this,Eee.get(this)[e](...n))}),t}};function n3e(...r){return M(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new S(e.openCursor(...r))),!e)return;e=e;let t=new Proxy(e,r3e);for(Eee.set(t,e),o_.set(t,hR(e));e;)yield t,e=yield new S(mR.get(t)||e.continue()),mR.delete(t)})}function wee(r,e){return e===Symbol.asyncIterator&&dR(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&dR(r,[IDBIndex,IDBObjectStore])}bee(r=>I(v({},r),{get(e,t,n){return wee(e,t)?n3e:r.get(e,t,n)},has(e,t){return wee(e,t)||r.has(e,t)}}));var a_=class extends Zs{location;version;db;base;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1,this.base=t.base??IR}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return ce.createV1(Tr,Nt(this.base.decoder.decode(e.substring(1))))}open(){return f(this,null,function*(){try{let e=this.location;this.db=yield i_(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw new Ry(String(e))}})}close(){return f(this,null,function*(){this.db?.close()})}put(e,t,n){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{n?.signal?.throwIfAborted(),yield lt(this.db.put(this.location,t,this.#e(e)),n?.signal)}catch(o){throw new wu(String(o))}return e})}get(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");let n;try{t?.signal?.throwIfAborted(),n=yield lt(this.db.get(this.location,this.#e(e)),t?.signal)}catch(o){throw new wu(String(o))}if(n===void 0)throw new Xo;return n})}delete(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{t?.signal?.throwIfAborted(),yield lt(this.db.delete(this.location,this.#e(e)),t?.signal)}catch(n){throw new wu(String(n))}})}has(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");try{return t?.signal?.throwIfAborted(),!!(yield lt(this.db.getKey(this.location,this.#e(e)),t?.signal))}catch(n){throw new wu(String(n))}})}getAll(e){return M(this,null,function*(){if(this.db==null)throw new Error("Blockstore needs to be opened.");e?.signal?.throwIfAborted();for(let t of yield new S(this.db.getAllKeys(this.location))){e?.signal?.throwIfAborted();let n=this.#t(t.toString()),o=yield new S(this.get(n,e));yield{cid:n,block:o},e?.signal?.throwIfAborted()}})}destroy(){return f(this,null,function*(){yield s_(this.location)})}};var c_=class extends ha{location;version;db;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1}open(){return f(this,null,function*(){try{let e=this.location;this.db=yield i_(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw new Ry(String(e))}})}close(){return f(this,null,function*(){this.db?.close()})}put(e,t,n){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{n?.signal?.throwIfAborted(),yield lt(this.db.put(this.location,t,e.toString()),n?.signal)}catch(o){throw new wu(String(o))}return e})}get(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");let n;try{t?.signal?.throwIfAborted(),n=yield lt(this.db.get(this.location,e.toString()),t?.signal)}catch(o){throw new gA(String(o))}if(n===void 0)throw new Xo;return n})}has(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{return t?.signal?.throwIfAborted(),!!(yield lt(this.db.getKey(this.location,e.toString())))}catch(n){throw new gA(String(n))}})}delete(e,t){return f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");try{t?.signal?.throwIfAborted(),yield lt(this.db.delete(this.location,e.toString()),t?.signal)}catch(n){throw new yA(String(n))}})}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:n=>f(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");n?.signal?.throwIfAborted();let o=this.db.transaction(this.location,"readwrite");try{let i=e.filter(({key:s})=>t.find(a=>a.toString()===s.toString())==null).map(s=>()=>f(this,null,function*(){yield o.store.put(s.value,s.key.toString())})).concat(t.map(s=>()=>f(this,null,function*(){yield o.store.delete(s.toString())}))).concat(()=>f(this,null,function*(){yield o.done}));n?.signal?.throwIfAborted(),yield lt(Promise.all(i.map(s=>f(this,null,function*(){yield s()}))),n?.signal)}catch{o.abort()}})}}query(e,t){return M(this,null,function*(){let n=this.#e(e,(o,i)=>({key:o,value:i}),t);Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>so(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>Gf(o,i),n)),yield*Q(n)})}queryKeys(e,t){return M(this,null,function*(){let n=this.#e(e,o=>o,t);Array.isArray(e.filters)&&(n=e.filters.reduce((o,i)=>so(o,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((o,i)=>Gf(o,i),n)),yield*Q(n)})}#e(e,t,n){return M(this,null,function*(){if(this.db==null)throw new Error("Datastore needs to be opened.");let o=0,i=-1;n?.signal?.throwIfAborted();for(let s of yield new S(this.db.getAllKeys(this.location))){if(n?.signal?.throwIfAborted(),e.prefix!=null&&!s.toString().startsWith(e.prefix))continue;if(e.limit!=null&&o===e.limit)return;if(i++,e.offset!=null&&i<e.offset)continue;let a=new Ot(s.toString()),c;try{c=yield new S(this.get(a,n))}catch(l){if(l.name!=="NotFoundError")throw l;continue}c!=null&&(yield t(a,c),n?.signal?.throwIfAborted(),o++)}})}destroy(){return f(this,null,function*(){yield s_(this.location)})}};var bd=class r{constructor(e,t){this.shareLinkService=e}helia;fs;initialized=!1;initPromise;pathToCidStore;PATH_CID_DB="helia-path-mappings";PATH_CID_STORE="pathCidMappings";ensureInitialized(){return f(this,null,function*(){if(!this.initialized){if(this.initPromise){yield this.initPromise;return}this.initPromise=this.initialize(),yield this.initPromise}})}initialize(){return f(this,null,function*(){try{let e=new a_("helia-blocks"),t=new c_("helia-data");yield e.open(),yield t.open(),this.helia=yield YZ({blockstore:e,datastore:t}),this.fs=hee(this.helia),yield this.initializePathCidStore(),this.initialized=!0}catch(e){throw console.error("Failed to initialize Helia:",e),new Error("Helia initialization failed")}})}initializePathCidStore(){return f(this,null,function*(){return new Promise((e,t)=>{let n=indexedDB.open(this.PATH_CID_DB,1);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.pathToCidStore=n.result,e()},n.onupgradeneeded=o=>{let i=o.target.result;if(!i.objectStoreNames.contains(this.PATH_CID_STORE)){let s=i.createObjectStore(this.PATH_CID_STORE,{keyPath:"path"});s.createIndex("cid","cid",{unique:!1}),s.createIndex("timestamp","timestamp",{unique:!1})}}})})}write(e,t){return f(this,null,function*(){if(yield this.ensureInitialized(),!this.fs)throw new Error("Helia not initialized");try{let n=yield this.fs.addBytes(t);yield this.savePathCidMapping(e,n.toString()),console.log(`Stored ${e} in Helia with CID: ${n}`)}catch(n){throw console.error("Failed to write to Helia:",n),n}})}read(e){return f(this,null,function*(){if(yield this.ensureInitialized(),!this.fs)throw new Error("Helia not initialized");try{let t=yield this.getCidForPathPrivate(e);if(!t)throw new Error(`No content found for path: ${e}`);let{CID:n}=yield import("./chunk-EYCWZAI7.js"),o=n.parse(t),i=yield pa(this.fs.cat(o)),s=i.reduce((l,u)=>l+u.length,0),a=new Uint8Array(s),c=0;for(let l of i)a.set(l,c),c+=l.length;return a}catch(t){throw console.error("Failed to read from Helia:",t),t}})}exists(e){return f(this,null,function*(){return yield this.ensureInitialized(),(yield this.getCidForPathPrivate(e))!==null})}delete(e){return f(this,null,function*(){yield this.ensureInitialized(),yield this.deletePathCidMapping(e)})}list(){return f(this,null,function*(){return yield this.ensureInitialized(),this.pathToCidStore?new Promise((e,t)=>{let i=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).getAllKeys();i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)}):[]})}savePathCidMapping(e,t){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((n,o)=>{let a=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readwrite").objectStore(this.PATH_CID_STORE).put({path:e,cid:t,timestamp:new Date().toISOString()});a.onsuccess=()=>n(),a.onerror=()=>o(a.error)})})}getCidForPathPrivate(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).get(e);s.onsuccess=()=>{let a=s.result;t(a?a.cid:null)},s.onerror=()=>n(s.error)})})}deletePathCidMapping(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readwrite").objectStore(this.PATH_CID_STORE).delete(e);s.onsuccess=()=>t(),s.onerror=()=>n(s.error)})})}getStats(){return f(this,null,function*(){return yield this.ensureInitialized(),{blockCount:0,totalSize:0,pathCount:(yield this.list()).length}})}isHealthy(){return f(this,null,function*(){try{return yield this.ensureInitialized(),this.initialized&&this.helia!==void 0}catch{return!1}})}generateShareLink(e,t){return f(this,null,function*(){let n=yield this.getCidForPath(e);return n?this.shareLinkService.generateShareLink(n,{filename:t}):null})}generateMultipleShareLinks(e,t){return f(this,null,function*(){let n=yield this.getCidForPath(e);return n?this.shareLinkService.generateMultipleShareLinks(n,{filename:t}):[]})}getCidForPath(e){return f(this,null,function*(){return yield this.ensureInitialized(),yield this.getCidForPathInternal(e)})}getCidForPathInternal(e){return f(this,null,function*(){if(!this.pathToCidStore)throw new Error("Path-CID store not initialized");return new Promise((t,n)=>{let s=this.pathToCidStore.transaction([this.PATH_CID_STORE],"readonly").objectStore(this.PATH_CID_STORE).get(e);s.onsuccess=()=>{let a=s.result;t(a?a.cid:null)},s.onerror=()=>n(s.error)})})}ngOnDestroy(){this.helia&&this.helia.stop().catch(e=>{console.error("Error stopping Helia:",e)}),this.pathToCidStore&&this.pathToCidStore.close()}static \u0275fac=function(t){return new(t||r)(Ee(vm),Ee(Ws))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};function i3e(r,e){r&1&&(_(0,"p",12),C(1," IndexedDB is not available in your browser. "),E())}function s3e(r,e){r&1&&(_(0,"p",12),C(1," Warning: IPFS node not detected. Make sure IPFS is running on localhost:5001. "),E())}function a3e(r,e){r&1&&(_(0,"p",13),C(1," Note: Data is stored locally in IndexedDB and works offline. "),E())}function c3e(r,e){if(r&1){let t=Gt();_(0,"div",14)(1,"p")(2,"strong"),C(3,"Important:"),E(),C(4," Changing storage type will require a page reload. Your current in-memory data will be lost unless you're switching to IndexedDB. "),E(),_(5,"button",15),Ge("click",function(){at(t);let o=ne();return ct(o.applyChanges())}),C(6," Apply Changes & Reload "),E(),_(7,"button",16),Ge("click",function(){at(t);let o=ne();return ct(o.cancelChanges())}),C(8," Cancel "),E()()}}function l3e(r,e){if(r&1&&(_(0,"p"),C(1),E()),r&2){let t=ne(3);R(),rt("API Endpoint: ",t.ipfsConfig.apiEndpoint||"/api/v0")}}function u3e(r,e){if(r&1&&(_(0,"div",21)(1,"p"),C(2,"IPFS Status: "),_(3,"span"),C(4),E()(),Ke(5,l3e,2,1,"p",22),E()),r&2){let t=ne(2);R(3),Ko("healthy",t.ipfsHealthy)("unhealthy",!t.ipfsHealthy),R(),He(t.ipfsHealthy?"Connected":"Disconnected"),R(),re("ngIf",t.ipfsHealthy&&t.ipfsConfig)}}function d3e(r,e){r&1&&(_(0,"p"),C(1,"Browser-native IPFS node active"),E())}function f3e(r,e){if(r&1&&(_(0,"div",21)(1,"p"),C(2,"Helia Status: "),_(3,"span"),C(4),E()(),Ke(5,d3e,2,0,"p",22),E()),r&2){let t=ne(2);R(3),Ko("healthy",t.heliaHealthy)("unhealthy",!t.heliaHealthy),R(),He(t.heliaHealthy?"Running":"Not Initialized"),R(),re("ngIf",t.heliaHealthy)}}function p3e(r,e){r&1&&(_(0,"a",23)(1,"button",24),C(2," Migrate to IPFS/Helia \u2192 "),E()())}function h3e(r,e){if(r&1){let t=Gt();_(0,"div",1)(1,"h3"),C(2,"Storage Management"),E(),_(3,"div",17)(4,"p"),C(5,"Current storage provider: "),_(6,"strong"),C(7),E()(),Ke(8,u3e,6,6,"div",18)(9,f3e,6,6,"div",18),_(10,"button",19),Ge("click",function(){at(t);let o=ne();return ct(o.clearStorage())}),C(11," Clear All Local Data "),E(),Ke(12,p3e,3,0,"a",20),E()()}if(r&2){let t=ne();R(7),He(t.getStorageProviderName()),R(),re("ngIf",t.currentStorageType===t.StorageType.IPFS),R(),re("ngIf",t.currentStorageType===t.StorageType.HELIA),R(3),re("ngIf",t.canMigrate())}}var l_=class r{constructor(e,t,n){this.storageType=e;this.storageProvider=t;this.currentStorageType=this.storageType,this.selectedStorageType=this.storageType,this.ipfsConfig=n||null}StorageType=au;selectedStorageType;currentStorageType;indexedDbAvailable=!1;storageChanged=!1;ipfsHealthy=!1;heliaHealthy=!1;ipfsConfig=null;ngOnInit(){this.checkIndexedDbAvailability(),this.checkIPFSHealth(),this.checkHeliaHealth()}checkIndexedDbAvailability(){this.indexedDbAvailable=typeof window<"u"&&"indexedDB"in window}checkIPFSHealth(){return f(this,null,function*(){if(this.currentStorageType==="ipfs"&&this.storageProvider instanceof uu)try{this.ipfsHealthy=yield this.storageProvider.isHealthy()}catch{this.ipfsHealthy=!1}})}checkHeliaHealth(){return f(this,null,function*(){if(this.currentStorageType==="helia"&&this.storageProvider instanceof bd)try{this.heliaHealthy=yield this.storageProvider.isHealthy()}catch{this.heliaHealthy=!1}})}onStorageTypeChange(){this.storageChanged=this.selectedStorageType!==this.currentStorageType,this.selectedStorageType==="ipfs"&&this.checkIPFSHealthForSelection()}checkIPFSHealthForSelection(){return f(this,null,function*(){this.ipfsHealthy=!1})}applyChanges(){this.selectedStorageType!==this.currentStorageType&&(localStorage.setItem("cas-storage-type",this.selectedStorageType),this.reloadPage())}reloadPage(){window.location.reload()}cancelChanges(){this.selectedStorageType=this.currentStorageType,this.storageChanged=!1}clearStorage(){return f(this,null,function*(){if(confirm("Are you sure you want to clear all stored data? This action cannot be undone."))try{this.currentStorageType==="indexed-db"?(yield indexedDB.deleteDatabase("cas-storage"),alert("Storage cleared successfully. The page will reload."),this.reloadPage()):this.currentStorageType==="ipfs"?(yield indexedDB.deleteDatabase("cas-storage"),alert("Local cache cleared successfully. IPFS content remains on the network."),this.reloadPage()):this.currentStorageType==="helia"&&(yield indexedDB.deleteDatabase("helia-blocks"),yield indexedDB.deleteDatabase("helia-data"),yield indexedDB.deleteDatabase("helia-path-mappings"),alert("Helia storage cleared successfully. The page will reload."),this.reloadPage())}catch(e){console.error("Error clearing storage:",e),alert("Failed to clear storage. Please try again.")}})}getStorageProviderName(){switch(this.currentStorageType){case"in-memory":return"In-Memory";case"indexed-db":return"IndexedDB";case"ipfs":return"IPFS (External Node)";case"helia":return"Helia (Browser IPFS)";default:return"Unknown"}}canMigrate(){return this.currentStorageType==="in-memory"||this.currentStorageType==="indexed-db"}static \u0275fac=function(t){return new(t||r)(ye(qs),ye(ss),ye(Ws,8))};static \u0275cmp=mr({type:r,selectors:[["app-storage-settings"]],decls:42,vars:16,consts:[[1,"storage-settings"],[1,"settings-section"],[1,"description"],[1,"storage-options"],[1,"storage-option"],["type","radio","name","storageType",3,"ngModelChange","change","value","ngModel"],[1,"option-content"],["type","radio","name","storageType",3,"ngModelChange","change","value","ngModel","disabled"],["class","warning",4,"ngIf"],["class","info",4,"ngIf"],["class","info-message",4,"ngIf"],["class","settings-section",4,"ngIf"],[1,"warning"],[1,"info"],[1,"info-message"],[1,"apply-button",3,"click"],[1,"cancel-button",3,"click"],[1,"storage-info"],["class","ipfs-info",4,"ngIf"],[1,"danger-button",3,"click"],["routerLink","/settings/migration","class","migration-link",4,"ngIf"],[1,"ipfs-info"],[4,"ngIf"],["routerLink","/settings/migration",1,"migration-link"],[1,"migrate-button"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"h2"),C(2,"Storage Settings"),E(),_(3,"div",1)(4,"h3"),C(5,"Storage Provider"),E(),_(6,"p",2),C(7," Choose how your content is stored. In-memory storage is faster but data is lost when you close the browser. IndexedDB provides persistent storage across browser sessions. IPFS provides distributed storage across the network. "),E(),_(8,"div",3)(9,"label",4)(10,"input",5),yr("ngModelChange",function(i){return Dr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),Ge("change",function(){return n.onStorageTypeChange()}),E(),_(11,"div",6)(12,"strong"),C(13,"In-Memory Storage"),E(),_(14,"p"),C(15,"Fast, temporary storage. Data is lost when browser closes."),E()()(),_(16,"label",4)(17,"input",7),yr("ngModelChange",function(i){return Dr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),Ge("change",function(){return n.onStorageTypeChange()}),E(),_(18,"div",6)(19,"strong"),C(20,"IndexedDB Storage"),E(),_(21,"p"),C(22,"Persistent storage. Data is saved across browser sessions."),E(),Ke(23,i3e,2,0,"p",8),E()(),_(24,"label",4)(25,"input",5),yr("ngModelChange",function(i){return Dr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),Ge("change",function(){return n.onStorageTypeChange()}),E(),_(26,"div",6)(27,"strong"),C(28,"IPFS Storage (External Node)"),E(),_(29,"p"),C(30,"Distributed storage using IPFS network. Requires local IPFS node or gateway."),E(),Ke(31,s3e,2,0,"p",8),E()(),_(32,"label",4)(33,"input",5),yr("ngModelChange",function(i){return Dr(n.selectedStorageType,i)||(n.selectedStorageType=i),i}),Ge("change",function(){return n.onStorageTypeChange()}),E(),_(34,"div",6)(35,"strong"),C(36,"Helia Storage (Browser-Native IPFS)"),E(),_(37,"p"),C(38,"IPFS running directly in your browser. No external node required. Larger download size (~2-3MB)."),E(),Ke(39,a3e,2,0,"p",9),E()()(),Ke(40,c3e,9,0,"div",10),E(),Ke(41,h3e,13,4,"div",11),E()),t&2&&(R(10),re("value",n.StorageType.IN_MEMORY),gr("ngModel",n.selectedStorageType),R(6),Ko("disabled",!n.indexedDbAvailable),R(),re("value",n.StorageType.INDEXED_DB),gr("ngModel",n.selectedStorageType),re("disabled",!n.indexedDbAvailable),R(6),re("ngIf",!n.indexedDbAvailable),R(2),re("value",n.StorageType.IPFS),gr("ngModel",n.selectedStorageType),R(6),re("ngIf",n.selectedStorageType===n.StorageType.IPFS&&!n.ipfsHealthy),R(2),re("value",n.StorageType.HELIA),gr("ngModel",n.selectedStorageType),R(6),re("ngIf",n.selectedStorageType===n.StorageType.HELIA),R(),re("ngIf",n.storageChanged),R(),re("ngIf",n.currentStorageType!==n.StorageType.IN_MEMORY))},dependencies:[vr,Pn,ls,as,g9,Ka,Ks,Do,qa],styles:[".storage-settings[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.settings-section[_ngcontent-%COMP%]{background-color:#f9f9f9;border-radius:8px;padding:20px;margin-bottom:20px}.settings-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333}.description[_ngcontent-%COMP%]{color:#666;margin-bottom:20px}.storage-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.storage-option[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding:15px;background-color:#fff;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .3s}.storage-option[_ngcontent-%COMP%]:hover:not(.disabled){border-color:#3498db;box-shadow:0 2px 4px #0000001a}.storage-option.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.storage-option[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:15px;margin-top:5px}.option-content[_ngcontent-%COMP%]{flex:1}.option-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#333}.option-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.warning[_ngcontent-%COMP%]{color:#e74c3c!important;font-style:italic;margin-top:5px!important}.info[_ngcontent-%COMP%]{color:#3498db!important;font-style:italic;margin-top:5px!important}.info-message[_ngcontent-%COMP%]{margin-top:20px;padding:15px;background-color:#e8f4fd;border:1px solid #3498db;border-radius:4px}.info-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 15px;color:#2c3e50}.apply-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;margin-right:10px}.apply-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.apply-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.cancel-button[_ngcontent-%COMP%]{background-color:#95a5a6;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#7f8c8d}.storage-info[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:4px}.storage-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 15px}.danger-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#e74c3c;color:#fff;border:none;border-radius:4px;cursor:pointer}.danger-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}.ipfs-info[_ngcontent-%COMP%]{margin-bottom:15px}.ipfs-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.healthy[_ngcontent-%COMP%]{color:#27ae60;font-weight:700}.unhealthy[_ngcontent-%COMP%]{color:#e74c3c;font-weight:700}.migration-link[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;margin-left:10px}.migrate-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#8e44ad;color:#fff;border:none;border-radius:4px;cursor:pointer}.migrate-button[_ngcontent-%COMP%]:hover{background-color:#9b59b6}"]})};var u_=class r{constructor(e,t){this.currentStorageProvider=e;this.currentStorageType=t}progressSubject=new cn({totalItems:0,processedItems:0,successfulItems:0,failedItems:0,status:"idle",errors:[]});cancelSubject=new Ht;isRunning=!1;isCancelled=!1;progress$=this.progressSubject.asObservable();migrateToIPFS(n){return f(this,arguments,function*(e,t={}){if(this.isRunning)throw new Error("Migration is already in progress");if(this.currentStorageProvider===e)throw new Error("Cannot migrate to the same storage provider");this.isRunning=!0,this.isCancelled=!1,this.cancelSubject=new Ht;let{batchSize:o=10,deleteAfterMigration:i=!1,skipExisting:s=!0,filter:a}=t;try{this.updateProgress({status:"preparing"});let c=yield this.currentStorageProvider.list(),l=a?c.filter(a):c;this.updateProgress({totalItems:l.length,processedItems:0,successfulItems:0,failedItems:0,status:"migrating",errors:[]});for(let d=0;d<l.length;d+=o){if(this.isCancelled){this.updateProgress({status:"failed"});break}let h=l.slice(d,d+o);yield this.processBatch(h,e,s,i)}return this.progressSubject.value.failedItems===0?this.updateProgress({status:"completed"}):this.updateProgress({status:"failed"}),this.progressSubject.value}finally{this.isRunning=!1}})}processBatch(e,t,n,o){return f(this,null,function*(){let i=e.map(s=>this.migrateItem(s,t,n,o));yield Promise.all(i)})}migrateItem(e,t,n,o){return f(this,null,function*(){try{if(this.updateProgress({currentItem:e}),n&&(yield t.exists(e))){this.incrementProgress(!0);return}let i=yield this.currentStorageProvider.read(e);yield t.write(e,i),o&&(yield this.currentStorageProvider.delete(e)),this.incrementProgress(!0)}catch(i){let s=i instanceof Error?i.message:"Unknown error";this.incrementProgress(!1,{path:e,error:s})}})}incrementProgress(e,t){let n=this.progressSubject.value;e?this.updateProgress({processedItems:n.processedItems+1,successfulItems:n.successfulItems+1}):this.updateProgress({processedItems:n.processedItems+1,failedItems:n.failedItems+1,errors:t?[...n.errors,t]:n.errors})}cancelMigration(){this.isRunning&&(this.isCancelled=!0,this.cancelSubject.next(),this.cancelSubject.complete())}getMigrationStats(){return{canMigrate:this.currentStorageType!=="ipfs"&&this.currentStorageType!=="helia",currentStorageType:this.currentStorageType,estimatedItems:void 0}}estimateMigrationSize(){return f(this,null,function*(){let e=yield this.currentStorageProvider.list(),t=0,n=Math.min(10,e.length),o=0;for(let a=0;a<n;a++)try{let c=yield this.currentStorageProvider.read(e[a]);o+=c.length}catch{}let i=n>0?o/n:0;t=Math.round(i*e.length);let s=Math.round(t/(1024*1024));return{itemCount:e.length,totalSize:t,estimatedTime:s}})}updateProgress(e){this.progressSubject.next(v(v({},this.progressSubject.value),e))}reset(){this.progressSubject.next({totalItems:0,processedItems:0,successfulItems:0,failedItems:0,status:"idle",errors:[]})}isMigrationRunning(){return this.isRunning}static \u0275fac=function(t){return new(t||r)(Ee(ss),Ee(qs))};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};function g3e(r,e){if(r&1&&(_(0,"div",3)(1,"p",4),C(2),E()()),r&2){let t=ne();R(2),rt(" Your content is already stored in ",t.currentStorageType,". Migration is only available when using In-Memory or IndexedDB storage. ")}}function y3e(r,e){if(r&1&&(_(0,"div",11)(1,"h4"),C(2,"Migration Estimate"),E(),_(3,"div",12)(4,"div",13)(5,"span",14),C(6,"Total Items:"),E(),_(7,"span",15),C(8),E()(),_(9,"div",13)(10,"span",14),C(11,"Total Size:"),E(),_(12,"span",15),C(13),E()(),_(14,"div",13)(15,"span",14),C(16,"Estimated Time:"),E(),_(17,"span",15),C(18),E()()()()),r&2){let t=ne(2);R(8),He(t.estimate.itemCount),R(5),He(t.formatBytes(t.estimate.totalSize)),R(5),He(t.formatTime(t.estimate.estimatedTime))}}function v3e(r,e){if(r&1){let t=Gt();_(0,"div",16)(1,"h4"),C(2,"Migration Options"),E(),_(3,"div",17)(4,"label"),C(5,"Target Storage:"),E(),_(6,"select",18),yr("ngModelChange",function(o){at(t);let i=ne(2);return Dr(i.targetStorageType,o)||(i.targetStorageType=o),ct(o)}),_(7,"option",19),C(8,"IPFS (External Node)"),E(),_(9,"option",19),C(10,"Helia (Browser IPFS)"),E()()(),_(11,"div",17)(12,"label")(13,"input",20),yr("ngModelChange",function(o){at(t);let i=ne(2);return Dr(i.options.deleteAfterMigration,o)||(i.options.deleteAfterMigration=o),ct(o)}),E(),C(14," Delete files from source after successful migration "),E()(),_(15,"div",17)(16,"label")(17,"input",20),yr("ngModelChange",function(o){at(t);let i=ne(2);return Dr(i.options.skipExisting,o)||(i.options.skipExisting=o),ct(o)}),E(),C(18," Skip files that already exist in target "),E()(),_(19,"div",17)(20,"label"),C(21,"Batch Size:"),E(),_(22,"input",21),yr("ngModelChange",function(o){at(t);let i=ne(2);return Dr(i.options.batchSize,o)||(i.options.batchSize=o),ct(o)}),E()(),_(23,"div",22)(24,"button",23),Ge("click",function(){at(t);let o=ne(2);return ct(o.estimateMigration())}),C(25),E(),_(26,"button",24),Ge("click",function(){at(t);let o=ne(2);return ct(o.startMigration())}),C(27," Start Migration "),E()()()}if(r&2){let t=ne(2);R(6),gr("ngModel",t.targetStorageType),R(),re("value",t.StorageType.IPFS),R(2),re("value",t.StorageType.HELIA),R(4),gr("ngModel",t.options.deleteAfterMigration),R(4),gr("ngModel",t.options.skipExisting),R(5),gr("ngModel",t.options.batchSize),R(2),re("disabled",t.isEstimating),R(),rt(" ",t.isEstimating?"Estimating...":"Estimate Migration"," "),R(),re("disabled",!t.targetStorageType)}}function w3e(r,e){if(r&1&&(_(0,"div",29)(1,"span",14),C(2,"Failed:"),E(),_(3,"span",34),C(4),E()()),r&2){let t=ne(3);R(4),He(t.progress.failedItems)}}function b3e(r,e){if(r&1&&(_(0,"div",29)(1,"span",14),C(2,"Current File:"),E(),_(3,"span",15),C(4),E()()),r&2){let t=ne(3);R(4),He(t.progress.currentItem)}}function E3e(r,e){if(r&1&&(_(0,"li")(1,"strong"),C(2),E(),C(3),E()),r&2){let t=e.$implicit;R(2),rt("",t.path,":"),R(),rt(" ",t.error," ")}}function x3e(r,e){if(r&1&&(_(0,"div",35)(1,"h5"),C(2,"Errors:"),E(),_(3,"ul",36),Ke(4,E3e,4,2,"li",37),E()()),r&2){let t=ne(3);R(4),re("ngForOf",t.progress.errors)}}function S3e(r,e){if(r&1){let t=Gt();_(0,"div",25)(1,"h4"),C(2,"Migration Progress"),E(),_(3,"div",26),Wr(4,"div",27),E(),_(5,"div",28)(6,"div",29)(7,"span",14),C(8,"Status:"),E(),_(9,"span",15),C(10),E()(),_(11,"div",29)(12,"span",14),C(13,"Progress:"),E(),_(14,"span",15),C(15),E()(),_(16,"div",29)(17,"span",14),C(18,"Successful:"),E(),_(19,"span",30),C(20),E()(),Ke(21,w3e,5,1,"div",31)(22,b3e,5,1,"div",31),E(),Ke(23,x3e,5,1,"div",32),_(24,"div",22)(25,"button",33),Ge("click",function(){at(t);let o=ne(2);return ct(o.cancelMigration())}),C(26," Cancel Migration "),E()()()}if(r&2){let t=ne(2);R(4),v3("width",t.getProgressPercentage(),"%"),Ko("error",t.progress.status==="failed"),R(5),cI(t.progress.status),R(),He(t.progress.status),R(5),x0("",t.progress.processedItems," / ",t.progress.totalItems),R(5),He(t.progress.successfulItems),R(),re("ngIf",t.progress.failedItems>0),R(),re("ngIf",t.progress.currentItem),R(),re("ngIf",t.progress.errors.length>0)}}function _3e(r,e){if(r&1){let t=Gt();_(0,"div",38)(1,"div",39)(2,"h4"),C(3,"Migration Completed Successfully!"),E(),_(4,"p"),C(5),E(),_(6,"p",40),C(7," Remember to update your storage settings to use the new storage provider. "),E()(),_(8,"button",41),Ge("click",function(){at(t);let o=ne(2);return ct(o.resetMigration())}),C(9," Start New Migration "),E()()}if(r&2){let t=ne(2);R(5),x0("All ",t.progress.successfulItems," items have been migrated to ",t.targetStorageType,".")}}function C3e(r,e){if(r&1&&(_(0,"div",5)(1,"div",6)(2,"h3"),C(3,"Migrate to Distributed Storage"),E(),_(4,"p"),C(5),E()(),Ke(6,y3e,19,3,"div",7)(7,v3e,28,9,"div",8)(8,S3e,27,13,"div",9)(9,_3e,10,2,"div",10),E()),r&2){let t=ne();R(5),rt(" Transfer your content from ",t.getStorageTypeName(t.currentStorageType)," to a distributed storage system (IPFS or Helia). "),R(),re("ngIf",!t.isRunning&&t.estimate),R(),re("ngIf",!t.isRunning),R(),re("ngIf",t.isRunning&&t.progress),R(),re("ngIf",!t.isRunning&&t.progress&&t.progress.status==="completed")}}var d_=class r{constructor(e,t,n,o,i){this.migrationService=e;this.ipfsStorage=o;this.heliaStorage=i;this.currentStorageType=t}StorageType=au;canMigrate=!1;currentStorageType;targetStorageType;isRunning=!1;isEstimating=!1;progress;estimate;options={batchSize:10,deleteAfterMigration:!1,skipExisting:!0};destroy$=new Ht;ngOnInit(){let e=this.migrationService.getMigrationStats();this.canMigrate=e.canMigrate,this.migrationService.progress$.pipe(Nc(this.destroy$)).subscribe(t=>{this.progress=t,this.isRunning=t.status==="preparing"||t.status==="migrating"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}estimateMigration(){return f(this,null,function*(){this.isEstimating=!0;try{this.estimate=yield this.migrationService.estimateMigrationSize()}catch(e){console.error("Failed to estimate migration:",e)}finally{this.isEstimating=!1}})}startMigration(){return f(this,null,function*(){if(!this.targetStorageType)return;let e=this.targetStorageType==="ipfs"?this.ipfsStorage:this.heliaStorage;try{yield this.migrationService.migrateToIPFS(e,this.options)}catch(t){console.error("Migration failed:",t)}})}cancelMigration(){this.migrationService.cancelMigration()}resetMigration(){this.migrationService.reset(),this.estimate=void 0,this.targetStorageType=void 0}getProgressPercentage(){return!this.progress||this.progress.totalItems===0?0:this.progress.processedItems/this.progress.totalItems*100}getStorageTypeName(e){switch(e){case"in-memory":return"In-Memory Storage";case"indexed-db":return"IndexedDB";case"ipfs":return"IPFS";case"helia":return"Helia";default:return"Unknown"}}formatBytes(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}formatTime(e){return e<60?`${e} seconds`:e<3600?`${Math.floor(e/60)} minutes`:`${Math.floor(e/3600)} hours`}static \u0275fac=function(t){return new(t||r)(ye(u_),ye(qs),ye(ss),ye(uu),ye(bd))};static \u0275cmp=mr({type:r,selectors:[["app-migration"]],decls:5,vars:2,consts:[[1,"migration-container"],["class","migration-info",4,"ngIf"],["class","migration-content",4,"ngIf"],[1,"migration-info"],[1,"info-message"],[1,"migration-content"],[1,"migration-overview"],["class","migration-estimate",4,"ngIf"],["class","migration-options",4,"ngIf"],["class","migration-progress",4,"ngIf"],["class","migration-complete",4,"ngIf"],[1,"migration-estimate"],[1,"estimate-details"],[1,"estimate-item"],[1,"label"],[1,"value"],[1,"migration-options"],[1,"option-group"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],["type","checkbox",3,"ngModelChange","ngModel"],["type","number","min","1","max","50",1,"form-input",3,"ngModelChange","ngModel"],[1,"action-buttons"],[1,"btn-secondary",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"migration-progress"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-details"],[1,"progress-item"],[1,"value","success"],["class","progress-item",4,"ngIf"],["class","migration-errors",4,"ngIf"],[1,"btn-danger",3,"click"],[1,"value","error"],[1,"migration-errors"],[1,"error-list"],[4,"ngFor","ngForOf"],[1,"migration-complete"],[1,"success-message"],[1,"note"],[1,"btn-primary",3,"click"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"h2"),C(2,"Storage Migration"),E(),Ke(3,g3e,3,1,"div",1)(4,C3e,10,5,"div",2),E()),t&2&&(R(3),re("ngIf",!n.canMigrate),R(),re("ngIf",n.canMigrate))},dependencies:[vr,ja,Pn,Do,cu,lu,as,m9,f9,Wa,Ka,v9,y9,Ks],styles:[".migration-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.migration-info[_ngcontent-%COMP%]{background-color:#f0f8ff;padding:20px;border-radius:8px;margin-bottom:20px}.info-message[_ngcontent-%COMP%]{margin:0;color:#06c}.migration-content[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:20px;border-radius:8px}.migration-overview[_ngcontent-%COMP%]{margin-bottom:30px}.migration-overview[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333}.migration-estimate[_ngcontent-%COMP%]{background-color:#fff;padding:15px;border-radius:8px;margin-bottom:20px}.estimate-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:10px}.estimate-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;background-color:#f5f5f5;border-radius:4px}.label[_ngcontent-%COMP%]{font-weight:500;color:#666}.value[_ngcontent-%COMP%]{font-weight:600;color:#333}.migration-options[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;margin-bottom:20px}.option-group[_ngcontent-%COMP%]{margin-bottom:15px}.option-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.form-select[_ngcontent-%COMP%], .form-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.form-input[_ngcontent-%COMP%]{width:100px}input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2980b9}.btn-secondary[_ngcontent-%COMP%]{background-color:#95a5a6;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#7f8c8d}.btn-danger[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.migration-progress[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px}.progress-bar[_ngcontent-%COMP%]{width:100%;height:30px;background-color:#e0e0e0;border-radius:15px;overflow:hidden;margin-bottom:20px}.progress-fill[_ngcontent-%COMP%]{height:100%;background-color:#3498db;transition:width .3s ease}.progress-fill.error[_ngcontent-%COMP%]{background-color:#e74c3c}.progress-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:20px}.progress-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;background-color:#f5f5f5;border-radius:4px}.value.preparing[_ngcontent-%COMP%], .value.migrating[_ngcontent-%COMP%]{color:#3498db}.value.completed[_ngcontent-%COMP%], .value.success[_ngcontent-%COMP%]{color:#27ae60}.value.failed[_ngcontent-%COMP%], .value.error[_ngcontent-%COMP%]{color:#e74c3c}.migration-errors[_ngcontent-%COMP%]{background-color:#fee;padding:15px;border-radius:8px;margin-top:20px}.migration-errors[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-top:0;color:#c0392b}.error-list[_ngcontent-%COMP%]{margin:0;padding-left:20px;font-size:14px}.migration-complete[_ngcontent-%COMP%]{text-align:center;padding:20px}.success-message[_ngcontent-%COMP%]{background-color:#d4edda;padding:20px;border-radius:8px;margin-bottom:20px}.success-message[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;color:#155724}.note[_ngcontent-%COMP%]{font-style:italic;color:#666;margin-top:10px}"]})};var xee=[{path:"",component:sy},{path:"home",component:sy},{path:"content",component:v4},{path:"content/upload",component:w4},{path:"upload",redirectTo:"/content/upload",pathMatch:"full"},{path:"disot/create",component:b4},{path:"disot/verify",component:E4},{path:"settings",component:l_},{path:"settings/migration",component:d_}];var f_=class r{storage=new Map;write(e,t){return f(this,null,function*(){this.storage.set(e,t)})}read(e){return f(this,null,function*(){let t=this.storage.get(e);if(!t)throw new Error(`File not found: ${e}`);return t})}exists(e){return f(this,null,function*(){return this.storage.has(e)})}delete(e){return f(this,null,function*(){this.storage.delete(e)})}list(){return f(this,null,function*(){return Array.from(this.storage.keys())})}clear(){return f(this,null,function*(){this.storage.clear()})}getSize(){return f(this,null,function*(){let e=0;for(let t of this.storage.values())e+=t.length;return e})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=me({token:r,factory:r.\u0275fac,providedIn:"root"})};var See={mode:"api",gateway:"http://127.0.0.1:8081",apiEndpoint:"",timeout:3e4,retryAttempts:3,maxFileSize:100*1024*1024,enableEncryption:!1};var _ee={providers:[BC(),fI({eventCoalescing:!0}),a9(xee),LI(),{provide:Ws,useValue:See},{provide:qs,useFactory:gU},{provide:ss,useFactory:mU,deps:[f_,ym,uu,bd,qs]}]};var I3e=()=>({exact:!0}),p_=class r{title="cas-app";static \u0275fac=function(t){return new(t||r)};static \u0275cmp=mr({type:r,selectors:[["app-root"]],decls:22,vars:2,consts:[[1,"app-container"],[1,"app-header"],[1,"main-nav"],["routerLink","/","routerLinkActive","active",3,"routerLinkActiveOptions"],["routerLink","/content","routerLinkActive","active"],["routerLink","/content/upload","routerLinkActive","active"],["routerLink","/disot/create","routerLinkActive","active"],["routerLink","/disot/verify","routerLinkActive","active"],["routerLink","/settings","routerLinkActive","active"],[1,"main-content"],[1,"app-footer"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"header",1)(2,"h1"),C(3,"CAS/DISOT System"),E(),_(4,"nav",2)(5,"a",3),C(6,"Home"),E(),_(7,"a",4),C(8,"Content List"),E(),_(9,"a",5),C(10,"Upload"),E(),_(11,"a",6),C(12,"Create Entry"),E(),_(13,"a",7),C(14,"Verify"),E(),_(15,"a",8),C(16,"Settings"),E()()(),_(17,"main",9),Wr(18,"router-outlet"),E(),_(19,"footer",10)(20,"p"),C(21,"Decentralized Content Management System"),E()()()),t&2&&(R(5),re("routerLinkActiveOptions",lI(1,I3e)))},dependencies:[vr,ny,qa,s9],styles:[".app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column}.app-header[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff;padding:20px;box-shadow:0 2px 4px #0000001a}.app-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 15px;font-size:24px}.main-nav[_ngcontent-%COMP%]{display:flex;gap:20px}.main-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#ecf0f1;text-decoration:none;padding:8px 16px;border-radius:4px;transition:background-color .3s}.main-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#34495e}.main-nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#3498db}.main-content[_ngcontent-%COMP%]{flex:1;background-color:#f5f5f5;padding:20px}.app-footer[_ngcontent-%COMP%]{background-color:#2c3e50;color:#ecf0f1;text-align:center;padding:20px}.app-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}"]})};RI(p_,_ee).catch(r=>console.error(r));
